import{_ as xe}from"./exchange2-DmU0qu5E.js";import{_ as te,G as m,H as r,I as t,Q as c,X as se,Y as ne,z as P,x as be,r as oe,a2 as j,bl as we,y as L,D as q,E as ve,F as I,P as d,U as Q,Z as N,O as s,a4 as S,J as R,K as V,$ as U,N as Ae,a0 as Ie,B as Me,T as O}from"./vendor-Dr_RpJ_Y.js";import{D as ye,E as $e,F as C,G as De,H as Se,I as Ue,J as Ce,K as Be,L as Ne,a as Te,b as Le,g as w,k as Y,d as Z,e as x,j as B,w as Oe,M as ee,c as Re}from"./index-CU2nzZe6.js";import{b as Ve}from"./beiConstContract-BSRzZQRe.js";import{_ as Pe}from"./TokenBalance-CXGFvOYs.js";import{B as We}from"./BackIcon-CDrGaEPo.js";const ae="/static/images/exchange-arrow-DUUUA3Bw.svg",Fe="/static/images/exchange-1-DWoUal-O.svg",Ee="/static/images/exchange-DEkJ89KM.svg",ze={},Ge=l=>(se("data-v-ab66f6d2"),l=l(),ne(),l),Ke={class:"flex-center"},He={class:"skew absolute w-[104px] inline-flex justify-center items-center h-[34px]"},Je={class:"z-50 w-full h-full px-5 flex-center gap-2 rounded-full bg-[#ffd81f]"},Xe=Ge(()=>t("img",{src:Ee,class:"h-4",alt:""},null,-1)),je={class:"text-base font-semibold"};function qe(l,p){return r(),m("div",Ke,[t("div",He,[t("div",Je,[Xe,t("span",je,c(l.$t("assets.exchange")),1)])])])}const Qe=te(ze,[["render",qe],["__scopeId","data-v-ab66f6d2"]]),Ye=()=>{const l=ye(),p=l==null?void 0:l.cns,h=l==null?void 0:l.address,v={MAI:"mai",MCOIN:"mcoin",MUSD:"musd",USDT:"usdt"},b={MAI:"Mai",MCOIN:"Mcoin",MUSD:"Musd",USDT:"Usdt",BNB:"BNB"};return{swapToken:async(_,f,k)=>{try{const u=await p.estimateGas[`${v[_]}To${b[f]}`](C(k)),A=await(await p[`${v[_]}To${b[f]}`](C(k),{gasLimit:Ue(u,1e3),...Se})).wait();return Ce(A)}catch(u){return Be(u),Ne(u,h,`${v[_]}To${b[f]}`,{amount:C(k)})}},getAmountsOut:async(_,f,k)=>{const u=await $e(await p.PANCAKE_ROUTER()),A=u==null?void 0:u.cns;u==null||u.address;try{const y=await A.getAmountsOut(C(_),[f,k]);return De(y[1])}catch{return 0}}}},M=l=>(se("data-v-1ca5a8b6"),l=l(),ne(),l),Ze={class:"mx-4 mt-5 bg-white rounded-xl bg"},et={class:"px-3 pb-5 my-5"},tt={class:"flex justify-between"},st={class:"flex-start"},nt=["src"],ot={class:"mr-1 font-semibold"},at=M(()=>t("img",{src:ae,class:"w-4 mr-1",alt:""},null,-1)),lt={class:"opacity-80 flex-center"},ct={key:1},it={class:"bg-[#fff9f0] mt-1 rounded-lg p-2"},rt={class:"flex items-center justify-end gap-2 mt-2"},ut=["onClick"],dt=M(()=>t("img",{src:Fe,class:"w-10",alt:""},null,-1)),mt=[dt],pt={class:""},ft={class:"flex justify-between"},gt=["src"],ht={class:"font-semibold"},_t=M(()=>t("img",{src:ae,class:"w-4",alt:""},null,-1)),kt={class:"opacity-80 flex-center"},xt={key:1},bt={class:"bg-[#fff9f0] mt-3 rounded-lg py-1 px-2"},wt={class:"mt-2 text-center opacity-70"},vt={class:"gap-4 mt-5 font-semibold text-white flex-center"},At={class:"gap-1 flex-center"},It=M(()=>t("img",{src:xe,class:"w-4",alt:""},null,-1)),Mt={key:0,class:"gap-2 mt-5 flex-center"},yt=M(()=>t("div",{class:"w-[13px] h-[13px] rounded-full bg-[#ffd489] text-white text-xs flex-center"}," 1 ",-1)),$t={class:"gap-1 flex-center"},Dt={class:"px-4 py-4 text-sm font-normal text-white"},St={class:"mt-[30px]"},Ut=P({setup(l){const{loadingToggle:p}=Oe(),{t:h}=be(),{reloadStore:v}=Te(),{mcoinRate:b}=Re(),{getAmountsOut:W,swapToken:F}=Ye(),_=oe(!1),[f,k]=j(!1),[u,A]=j(!1),{withdrawTo:y,depositFor:le}=Ve(),{checkLoginAuth:ce}=Le(),e=we({percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],resouceAmount:null,toAmount:null,tokenIndex:0,token0:"MCOIN",token1:"MUSD",balance0:0,balance1:0,originTokens:["MCOIN","USDT","MUSD","MAI","WMAI"],tokens0:["MCOIN","USDT","MUSD","MAI","WMAI"],tokens1:["MUSD","USDT","BNB"],pairs:[{token0:"MCOIN",token1:"BNB"},{token0:"MCOIN",token1:"USDT"},{token0:"MCOIN",token1:"MUSD"},{token0:"MUSD",token1:"BNB"},{token0:"MUSD",token1:"MCOIN"},{token0:"MUSD",token1:"USDT"},{token0:"USDT",token1:"MCOIN"},{token0:"USDT",token1:"MUSD"},{token0:"MAI",token1:"WMAI"},{token0:"WMAI",token1:"MAI"}],authLoading:!0,exchangeLoading:!0,exchangeValue:null,resouceDisabled:!1,toDisabled:!1,pointRate:0,bnbRate:0,firstAuth:!1,isAuth:!1,allowanceAmount:0}),g=L(()=>({name:e.token0,icon:Y(`images/tokens/${e.token0}.png`),token:w[`${e.token0}`]})),$=L(()=>({name:e.token1,icon:Y(`images/tokens/${e.token1}.png`),token:w[`${e.token1}`]})),D=L(()=>({MUSDUSDT:1,USDTMUSD:1,MUSDMCOIN:e.pointRate,MCOINMUSD:1/e.pointRate*.99,USDTMCOIN:e.pointRate,MCOINUSDT:1/e.pointRate*.99,USDTBNB:e.bnbRate,MUSDBNB:e.bnbRate,MCOINBNB:e.bnbRate/e.pointRate*.99,MAIWMAI:1,WMAIMAI:1})[e.token0+e.token1]),E=n=>{const o=n.toString().split(".");return o.length>1&&o[1].length>4?`${o[0]}.${o[1].substring(0,4)}`:n},ie=()=>{e.resouceDisabled=!1,e.toDisabled=!0},re=()=>{e.resouceDisabled=!0,e.toDisabled=!1};q(()=>e.resouceAmount,n=>{e.resouceDisabled||(e.toAmount=x(n*D.value,4),e.isAuth=+e.allowanceAmount>=parseFloat(n||0)&&+e.allowanceAmount>0)},{immediate:!0,deep:!0}),q(()=>e.toAmount,n=>{e.toDisabled||(e.resouceAmount=x(n/D.value||0,4),e.isAuth=+e.allowanceAmount>=parseFloat(n||0)&&+e.allowanceAmount>0)});const ue=n=>{e.resouceDisabled=!1,e.toDisabled=!0,e.resouceAmount=x(+Me(e.balance0).times(n.value))},z=n=>{e.tokenIndex=n,k(!0)},de=async n=>{if(e[`token${e.tokenIndex}`]===n){k(!1);return}e[`token${e.tokenIndex}`]=n;var o=(e.pairs||[]).filter(i=>i[`token${e.tokenIndex}`]===n);e.tokenIndex||(e[`tokens${1-e.tokenIndex}`]=(o||[]).map(i=>i[`token${1-e.tokenIndex}`]),o=e[`tokens${1-e.tokenIndex}`]||[],e[`token${1-e.tokenIndex}`]=o.length?o[0]:""),e.exchangeValue=null,k(!1),e.resouceAmount=null,e.toAmount=null,T()},me=()=>{if(e.token1==="BNB")return;const n=e.token0;e.token0=e.token1,e.tokens0=e.originTokens;const o=(e.pairs||[]).filter(i=>i.token0===e.token0);e.tokens1=(o||[]).map(i=>i.token1),e.tokens1.indexOf(n)!==-1?e.token1=n:e.token1="",e.resouceAmount=null,e.toAmount=null,e.firstAuth=!1,e.isAuth=!1,T()},G=async()=>{e.authLoading=!0;const{allowance:n}=B(g.value.token);e.authLoading=!1;const o=e.token0==="MAI"||e.token0==="WMAI"?w.bei:w.swapPool,i=await n(o);i.success&&(e.allowanceAmount=+i.result||0,e.isAuth=+i.result>0&&+i.result>=(+e.resouceAmount||0),e.firstAuth=e.firstAuth||+i.result<=0)},pe=async()=>{A(!0),e.balance0=g.value.name==="BNB"?+await ee():+await B(g.value.token).balanceOf(),e.balance1=$.value.name==="BNB"?+await ee():+await B($.value.token).balanceOf(),A(!1)},fe=async()=>{e.pointRate=await b()},ge=async()=>{e.bnbRate=+await W(1,w.USDT,w.BNB)},he=async()=>{e.authLoading=!0;try{const n=g.value.name==="WMAI"||g.value.name==="MAI"?w.bei:w.swapPool;if(!(await B(g.value.token).approve(n)).success)return;G()}finally{e.authLoading=!1}},_e=async()=>{if(!e.resouceAmount)return O(h("assets.pleaseInput"));if(+e.resouceAmount>+e.balance0)return O(h("errorMsg.burn amount exceeds balance"));e.exchangeLoading=!0;try{if(!(e.token0==="MAI"?await le(x(e.resouceAmount,18)):e.token0==="WMAI"?await y(x(e.resouceAmount,18)):await F(e.token0,e.token1,x(e.resouceAmount,18))).success)return;O(h("assets.change")+h("common.success")),setTimeout(()=>{v.reload()},1500)}finally{e.exchangeLoading=!1}},T=async()=>{p(!0),await G(),await pe(),fe(),ge(),p(!1),e.authLoading=!1,e.exchangeLoading=!1};return ve(()=>{ce(!0)&&T()}),(n,o)=>{const i=I("van-icon"),K=I("van-loading"),H=I("VanField"),J=I("VanButton"),ke=I("VanPicker"),X=I("VanPopup");return r(),m("div",Ze,[d(Qe),t("div",et,[t("section",null,[t("div",tt,[t("div",st,[t("div",{onClick:o[0]||(o[0]=a=>z(0)),class:"flex-start"},[t("img",{src:s(g).icon,alt:"",class:"w-6 h-6 mr-1"},null,8,nt),t("span",ot,c(s(g).name),1),at]),s(g).name=="MCOIN"?(r(),N(i,{key:0,name:"question-o",onClick:o[1]||(o[1]=()=>{_.value=!0})})):Q("",!0)]),t("div",lt,[S(c(n.$t("assets.balance"))+" ",1),s(u)?(r(),N(K,{key:0,size:"18px"})):(r(),m("span",ct,c(s(Z)(s(x)(s(e).balance0||0))),1))])]),t("div",it,[d(H,{class:"bg-[#fff9f0] text-default opacity-50","input-align":"right",modelValue:s(e).resouceAmount,"onUpdate:modelValue":o[2]||(o[2]=a=>s(e).resouceAmount=a),onFocus:ie,type:"number",formatter:E,placeholder:"0"},null,8,["modelValue"]),t("div",rt,[(r(!0),m(R,null,V(s(e).percents,a=>(r(),m("div",{class:"text-xs text-[primary] border border-solid border-primary rounded-md px-1 py-[2px]",key:a.value,onClick:Ft=>ue(a)},c(a.name),9,ut))),128))])])]),t("div",{class:"mt-3 flex-center",onClick:me},mt),t("section",pt,[t("div",ft,[t("div",{class:"gap-1 flex-start",onClick:o[3]||(o[3]=a=>z(1))},[t("img",{src:s($).icon,alt:"",class:"w-6 h-6"},null,8,gt),t("span",ht,c(s($).name),1),_t]),t("div",kt,[S(c(n.$t("assets.balance"))+" ",1),s(u)?(r(),N(K,{key:0,size:"18px"})):(r(),m("span",xt,c(s(Z)(s(x)(s(e).balance1||0))),1))])]),t("div",bt,[d(H,{class:"bg-[#fff9f0] text-default opacity-50","input-align":"right",modelValue:s(e).toAmount,"onUpdate:modelValue":o[4]||(o[4]=a=>s(e).toAmount=a),onFocus:re,type:"number",formatter:E,placeholder:"0"},null,8,["modelValue"])])]),t("div",wt," 1 "+c(s(e).token0)+" = "+c(s(D)?s(x)(s(D),6).toString():"-")+" "+c(s(e).token1),1),t("div",vt,[d(J,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth,loading:s(e).authLoading,onClick:he},{default:U(()=>[S(c(n.$t("assets.auth"))+c(s(g).name),1)]),_:1},8,["disabled","loading"]),d(J,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:_e},{default:U(()=>[t("div",At,[It,S(" "+c(n.$t("assets.change")),1)])]),_:1},8,["loading","disabled"])]),s(e).firstAuth?(r(),m("div",Mt,[yt,t("div",$t,[(r(),m(R,null,V(3,a=>t("div",{key:a,class:"w-1 h-1 bg-[#ffd489] rounded-full"})),64))]),t("div",{class:Ae(["w-[13px] h-[13px] rounded-full border-gray2 border-solid border text-gray2 text-xs flex-center",{"bg-[#ffd489] text-white":s(e).isAuth}])}," 2 ",2)])):Q("",!0)]),d(X,{show:s(f),"onUpdate:show":o[6]||(o[6]=a=>Ie(f)?f.value=a:null),round:"",position:"bottom"},{default:U(()=>[d(ke,{"show-toolbar":"",columns:s(e).tokenIndex?s(e).tokens1:s(e).tokens0,onCancel:o[5]||(o[5]=a=>f.value=!1),onConfirm:de,"default-index":s(e).tokenIndex?s(e).tokens1.findIndex(a=>a===s(e).token1):s(e).tokens0.findIndex(a=>a===s(e).token0)},null,8,["columns","default-index"])]),_:1},8,["show"]),d(X,{closeable:"",show:_.value,"onUpdate:show":o[7]||(o[7]=a=>_.value=a),round:"",position:"center",style:{width:"90vw",background:"rgba(0, 0, 0, 0.8)"}},{default:U(()=>[t("div",Dt,[t("span",St,c(n.$t("exchange.exchange tips1")),1),t("span",null,c(n.$t("exchange.exchange tips2")),1),t("span",null,c(n.$t("exchange.exchange tips3")),1)])]),_:1},8,["show"])])}}}),Ct=te(Ut,[["__scopeId","data-v-1ca5a8b6"]]),Bt="/static/images/Union-HDW1eVf1.png",Nt="/static/images/avatar-GkmLP2IK.png",Tt={class:"relative p-5 overflow-hidden bg-gradient-to-b from-primary-004 to-yellow-002 rounded-b-xl"},Lt=t("img",{src:Bt,class:"absolute top-0 w-full h-auto left-0"},null,-1),Ot={class:"relative flex items-center justify-center"},Rt={class:"absolute left-0 -translate-y-1/2 top-1/2"},Vt=t("img",{src:Nt,class:"w-auto h-6 mr-2"},null,-1),Pt={class:"bg-white px-2.5 mt-2.5 rounded-xl relative"},Wt=P({setup(l){const p=oe(["MCOIN","MUSD","MAI","USDT","BNB","WMAI","LP"]);return(h,v)=>(r(),m("div",Tt,[Lt,t("header",Ot,[t("div",Rt,[d(We)]),Vt,t("div",null,c(h.$t("assets.myAssets")),1)]),t("div",Pt,[(r(!0),m(R,null,V(p.value,b=>(r(),N(Pe,{key:b,token:b,icon:!0,"token-name":!0,addTokenIcon:!0,class:"w-full justify-between py-2.5 border-b border-solid border-gray1 last:border-0 font-semibold"},null,8,["token"]))),128))])]))}}),Xt=P({setup(l){return(p,h)=>(r(),m("div",null,[d(Wt),d(Ct)]))}});export{Xt as default};
