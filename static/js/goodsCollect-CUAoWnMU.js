import{_ as O,y as G,w as P,E as F,F as b,G as a,H as l,K as m,a2 as v,O as I,a4 as R,Q as T,N as A,a0 as H,P as n,T as D,I as Q,J as U,aH as eo,Y as to,Z as so,bd as ao,bc as _,r as j,x as z,D as no,l as lo}from"./vendor-D6JO6WHW.js";import{_ as co}from"./mall-BNNzTN-n.js";import{_ as io}from"./cart-icon-CPmHbIVR.js";import{_ as ro}from"./buy-cart-3M2I0Qjc.js";import{P as M}from"./flashSale-DDyqLyYN.js";import{R as uo}from"./RatioBox-OiqLR9-W.js";import{_ as go}from"./GoodsPrice-DdCD8Nfm.js";import{_ as mo}from"./CardPrice-BnTYZM8H.js";import{_ as fo}from"./ShopMaskTips-wgA1ZEjb.js";import{r as X,e as ho,s as yo,q as ko}from"./index-Ds2hFbCb.js";import{q as Co,c as po,e as bo}from"./cart-DAeJxrsl.js";import{C as vo}from"./CartSubmitBar-BwoJmhVe.js";import{e as To,c as J}from"./goods-D9J6xzPW.js";import{B as xo}from"./BackIcon-CPUEW9je.js";import{_ as Io}from"./DefaultPage-D3WtL8iI.js";import"./MCOIN-BcbOHmhy.js";const Ao={class:"flex-center-bw"},wo={class:"flex-center-bw text-sm text-[#2E2008]"},$o={class:"font-semibold line-clamp-1"},Bo={class:"opacity-60 line-clamp-2"},Fo={class:"flex items-center mt-1 goods-tag"},Mo={class:"flex items-end mt-auto"},Lo={class:"text-sm font-bold mt-1.5"},No=["onClick"],qo={key:0,class:"h-auto w-7",src:io},So={key:1,class:"h-auto w-7",src:ro},Eo=G({props:{goods:null,number:null,isManage:{type:Boolean}},emits:["changeNumber","handleTo","handleAddCart","click"],setup(o,{emit:d}){const e=o,{t:h}=P(),y=async()=>{if(e.goods.stock===0&&e.goods.goodsTypes!=2){D(h("order.Insufficient stock"));return}e.goods.deliveryType===1?d("handleAddCart",e.goods):d("click")};return(g,k)=>{var x,w,$,c,B,r,q,S,L;const u=F("VanImage"),i=F("VanTag");return a(),b("div",Ao,[l("div",{class:"w-[80px] h-[80px] rounded-xl overflow-hidden mr-2 relative",onClick:k[0]||(k[0]=R(V=>d("handleTo",`/goodsDetail?id=${o.goods.goodsId}`),["stop"]))},[!+o.goods.stock&&+o.goods.goodsTypes!=2||o.goods.shopStatus==3||o.goods.shopStatus==4||o.goods.shopStatus==0||o.goods.status!=1?(a(),m(fo,{key:0,status:o.goods.status,stock:o.goods.stock,shopStatus:o.goods.shopStatus},null,8,["status","stock","shopStatus"])):v("",!0),I(u,{src:(o.goods.icons||o.goods.icon||"").split(",")[0],fit:"cover",class:"object-cover w-full h-full overflow-hidden"},null,8,["src"])]),l("div",{class:"flex-1 flex justify-between flex-col min-h-[80px]",onClick:k[1]||(k[1]=V=>o.isManage?"":d("handleTo",`/goodsDetail?id=${o.goods.goodsId}`))},[l("div",wo,[l("section",null,[l("div",$o,T(o.goods.goodsName),1),l("div",Bo,T(o.goods.goodsDesc),1)]),o.goods.payType!==2?(a(),m(uo,{key:0,ratio:o.goods.discountRatio||0},null,8,["ratio"])):v("",!0)]),l("div",Fo,[(x=o.goods)!=null&&x.goodsBoutiqueFlag||(w=o.goods)!=null&&w.boutiqueFlag?(a(),m(i,{key:0,color:"#FFE9E9","text-color":"#F61818"},{default:A(()=>[H(T(g.$t("cart.hotGoods")),1)]),_:1})):v("",!0),($=o.goods)!=null&&$.goodsBoutiqueFlag||(c=o.goods)!=null&&c.boutiqueFlag||((B=o.goods)==null?void 0:B.payType)===n(M).POINTS_AVAILABLE?(a(),m(i,{key:1,size:"medium",color:"#FFF7D2","text-color":"#AD941A"},{default:A(()=>[H(T(g.$t("cart.Pay with points")),1)]),_:1})):v("",!0),!((r=o.goods)!=null&&r.goodsBoutiqueFlag)&&!((q=o.goods)!=null&&q.boutiqueFlag)&&(((S=o.goods)==null?void 0:S.payType)==n(M).MIX||((L=o.goods)==null?void 0:L.payType)==n(M).STORE_CARD)?(a(),m(i,{key:2,color:"#E2FFEE","text-color":"#2E8F6C"},{default:A(()=>[H(T(g.$t("cart.Stored value payment available")),1)]),_:1})):v("",!0)]),l("section",Mo,[l("div",Lo,[o.goods.payType!==2?(a(),m(go,{key:0,price:o.goods.price},null,8,["price"])):v("",!0),o.goods.payType===2||o.goods.payType===3?(a(),m(mo,{key:1,class:"mt-0.5",price:o.goods.cardPrice,symbol:o.goods&&o.goods.symbol},null,8,["price","symbol"])):v("",!0)]),l("div",{onClick:R(y,["stop"]),class:"px-2 pt-2 ml-auto"},[o.goods.deliveryType===1?(a(),b("img",qo)):(a(),b("img",So))],8,No)])])])}}}),K=O(Eo,[["__scopeId","data-v-315a9808"]]),Do=o=>(to("data-v-33368e78"),o=o(),so(),o),Vo={class:"flex-start mt-2.5"},Ho=Do(()=>l("img",{src:co,class:"w-4 mr-1"},null,-1)),Oo={class:"text-base font-semibold"},Go={key:1,class:"min-w-min p-2.5"},Po=G({props:{cartInfo:null,isManage:{type:Boolean}},emits:["changeNumber","handelDel","handleTo"],setup(o,{emit:d}){const{cartInfo:e}=o,{t:h}=P(),y=u=>{eo.confirm({message:h("collect.remove"),confirmButtonText:h("common.confirm"),confirmButtonColor:"#FEA021",cancelButtonText:h("common.cancel")}).then(()=>{d("handelDel",u)}).catch(()=>{})},{loadingToggle:g}=X(),k=async u=>{if(u.stock===0&&u.goodsTypes!=2){D(h("order.Insufficient stock"));return}g(!0);const i=await Co(u.goodsId);g(!1),i.success&&D(h("cart.addTips"))};return(u,i)=>{const x=F("van-checkbox"),w=F("van-button"),$=F("van-swipe-cell");return a(),b("div",null,[l("div",Vo,[Ho,l("div",Oo,T(o.cartInfo.storeName||"-"),1)]),(a(!0),b(Q,null,U(o.cartInfo.goodsList,(c,B)=>(a(),b("div",{class:"bg-white mt-2.5 rounded-xl",key:B},[I($,null,{right:A(()=>[I(w,{class:"px-3 text-sm text-white rounded-r-xl",type:"danger",text:u.$t("common.delete"),onClick:r=>y(c.goodsId)},null,8,["text","onClick"])]),default:A(()=>[o.isManage?(a(),m(x,{key:0,name:c,class:"min-w-min p-2.5"},{default:A(()=>[I(K,{goods:c,isManage:o.isManage,number:c.number||1,class:"w-full flex-1 mb-2.5 last:mb-0",onChangeNumber:r=>d("changeNumber",c,r),onHandleTo:i[0]||(i[0]=r=>d("handleTo",r)),onHandleAddCart:k,onClick:()=>d("handleTo",`/goodsDetail?id=${c.id}`)},null,8,["goods","isManage","number","onChangeNumber","onClick"])]),_:2},1032,["name"])):(a(),b("div",Go,[I(K,{goods:c,isManage:o.isManage,number:c.number||1,class:"w-full flex-1 mb-2.5 last:mb-0",onChangeNumber:r=>d("changeNumber",c,r),onHandleTo:i[1]||(i[1]=r=>d("handleTo",r)),onHandleAddCart:k,onClick:()=>d("handleTo",`/goodsDetail?id=${c.id}`)},null,8,["goods","isManage","number","onChangeNumber","onClick"])]))]),_:2},1024)]))),128))])}}}),Ro=O(Po,[["__scopeId","data-v-33368e78"]]),_o={class:"bg-[#f2f0ef] safe-bottom-page"},jo={class:"px-2.5"},zo={class:"items-center gap-2 mt-2 flex-start"},Jo=G({setup(o){const{reloadStore:d}=ho(),e=ao({loading:!1,total:0,originList:[],formatList:[],list:[],goodsChecked:[]}),h=lo(),{loadingToggle:y}=X(),[g,k]=_(!1),u=t=>{h.push(t)},i=j(null),x=z(()=>e.formatList.length>0&&e.formatList.length===e.goodsChecked.length),w=z(()=>{let t=0;for(let s of e.goodsChecked)t+=(s.payType!==M.MC&&s.payType!==M.POINTS_AVAILABLE&&!s.goodsBoutiqueFlag?s.cardPrice:s.price)*1;return t}),$=async(t,s)=>{y(!0);const C=await po({goodsId:t.goodsId,number:s});y(!1),C.success&&(t.number=s)},c=()=>{x.value?r():B()},B=()=>{i.value.toggleAll(!0)},r=()=>{i.value.toggleAll()},q=async t=>{y(!0),(await J({goodsId:t,type:2})).success&&d.reload()},S=async()=>{E(!0);let t=[];e.goodsChecked.forEach(C=>{t.push(C.goodsId)});const s=await J({goodsId:t.join(","),type:2});E(!1),e.goodsChecked=[],s.success&&L()},L=async()=>{y(!0),e.loading=!0;const t=await To();y(!1),!(!t.success||!t.data)&&(t.data.forEach(s=>{s.goodsList=s.goodsList.map(C=>({...C,shopStatus:s.shopStatus}))}),e.list=t.data||[],e.list.forEach(s=>{e.formatList=e.formatList.concat(s.goodsList||[])}),e.total=e.formatList.length,e.loading=!1)},V=j(null),Y=async()=>{const{balanceOf:t}=yo(ko.MCOIN),s=await t();V.value=+s},[Z,E]=_(!1),{t:W}=P(),oo=async()=>{let t=e.goodsChecked.some(p=>p.goodsBoutiqueFlag||p.boutiqueFlag),s=e.goodsChecked.some(p=>!p.goodsBoutiqueFlag&&!p.boutiqueFlag),C=e.goodsChecked.some(p=>p.payType===M.STORE_CARD);if(t&&(s||C))return D(W("cart.goodsBoutiqueFlag"));E(!0);let f=[];e.goodsChecked.forEach(p=>{f.push(p.goodsId)});const N=await bo(f.join(","));if(E(!1),!N.success)return;u(t?"/submitOrderBoutiqueCart?type=3":"/submitOrderCart?type=3")};return no(()=>{L(),Y()}),(t,s)=>{const C=F("van-checkbox-group");return a(),b("div",_o,[l("div",jo,[I(C,{modelValue:n(e).goodsChecked,"onUpdate:modelValue":s[1]||(s[1]=f=>n(e).goodsChecked=f),ref:(f,N)=>{N.checkboxGroup=f,i.value=f},"checked-color":"#FEA021"},{default:A(()=>[l("div",zo,[I(xo),l("div",null,T(t.$t("collect.goodsCollect")),1),l("div",{class:"ml-auto text-sm font-normal text-primary",onClick:s[0]||(s[0]=f=>n(k)(!n(g)))},T(n(g)?t.$t("common.quteManage"):t.$t("common.manage")),1)]),!n(e).loading&&!n(e).list.length?(a(),m(Io,{key:0,title:t.$t("common.No products")},null,8,["title"])):(a(!0),b(Q,{key:1},U(n(e).list,(f,N)=>(a(),m(Ro,{key:N,isManage:n(g),cartInfo:f,onChangeNumber:$,onHandelDel:q,onHandleTo:u},null,8,["isManage","cartInfo"]))),128))]),_:1},8,["modelValue"])]),n(g)?(a(),m(vo,{key:0,goodsChecked:n(e).goodsChecked,isCheckAll:n(x),totalAmount:n(w),isCollect:!0,isManage:!0,loading:n(Z),onTotalCheck:c,onHandleCartBuy:oo,onHandleDelMult:S},null,8,["goodsChecked","isCheckAll","totalAmount","loading"])):v("",!0)])}}}),re=O(Jo,[["__scopeId","data-v-06d19080"]]);export{re as default};
