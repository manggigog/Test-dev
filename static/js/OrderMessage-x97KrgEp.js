import{_ as ie}from"./clear-post-Dw5zePxY.js";import{B as ce}from"./BackIcon-CDrGaEPo.js";import{_ as H,r as b,y as F,D as de,G as v,H as f,I as n,J as ae,K as se,N as ue,U as S,a1 as fe,Q as u,O as w,n as me,x as ne,z as pe,q as xe,o as ge,a2 as be,E as ve,bm as he,ad as _e,F as B,P as V,Z as X,bx as Y,$ as m,T as N}from"./vendor-Dr_RpJ_Y.js";import{l as ee}from"./shop-CeqcS6K2.js";import{z as ye,r as ke,b as we}from"./index-BckdT6oc.js";import{f as De,r as Ue,q as Te,a as Oe}from"./mall-BsPFqNQo.js";const Le=["onClick","id"],Ce={class:"text-sm text-b3 font-normal flex items-center"},$e={class:"label__wrap"},Ie={key:0,class:"fm-tab-underline"},Me={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16}},emits:["update:modelValue","change"],setup(p,{emit:r}){const l=p,c=b(null),C=b(null),M=b([]),T=F(()=>Array.isArray(l.options)?l.options:Object.values(l.options));function R(i){return i[l.valueKey]===l.modelValue}function D(i){r("update:modelValue",i[l.valueKey]),r("change",i[l.valueKey])}de(()=>l.modelValue,async()=>{l.scrollToSelected&&(await me(),E())},{immediate:!0});function E(){const i=T.value.findIndex(e=>R(e));if(i===-1)return;const $=document.getElementById(`fm-tab-item-${i}`),d=c.value;if($&&d){const e=$.offsetLeft-(l.scrollOffset||0);d.scrollTo({left:e,behavior:"smooth"})}}let U=!1,A=0,y=0;function k(i){U=!0,A=i.touches?i.touches[0].pageX:i.pageX,y=c.value.scrollLeft}function h(i){if(!U)return;const $=i.touches?i.touches[0].pageX:i.pageX,d=A-$;c.value.scrollLeft=y+d}function O(){U=!1}return(i,$)=>(f(),v("div",{class:"fm-tab",ref:(d,e)=>{e.tabWrapper=d,c.value=d},onMousedown:k,onTouchstart:k,onMousemove:h,onTouchmove:h,onMouseup:O,onMouseleave:O,onTouchend:O},[n("div",{class:"flex flex-nowrap justify-start items-center gap-4",ref:(d,e)=>{e.tabList=d,C.value=d}},[(f(!0),v(ae,null,se(w(T),(d,e)=>(f(),v("div",{key:d[p.valueKey]??e,class:ue([["fm-tab-item",{active:R(d)}],"relative last:pr-4"]),onClick:q=>D(d),ref:(q,s)=>{s.tabItems=q,M.value=q},id:`fm-tab-item-${e}`},[n("p",Ce,[n("span",$e,u(d[p.labelKey]),1),fe(i.$slots,"badge"+e,{},void 0,!0)]),R(d)?(f(),v("div",Ie)):S("",!0)],10,Le))),128))],512)],544))}},te=H(Me,[["__scopeId","data-v-524e1736"]]),Re={class:"w-full bg-white rounded-xl p-3 overflow-x-hidden"},Se={class:"title__wrap w-full flex justify-start items-center"},qe={key:0,class:"w-[8px] h-[8px] rounded-full mr-1.5 bg-[#FF8812] flex-shrink-0"},Ve={class:"text-base text-b1 font-normal text-ellipsis line-clamp-1 flex-1 min-w-0"},Fe={key:1,class:"text-xs font-normal border border-[#FF8812] rounded-[2px] px-1 text-[#FF8812] ml-1 flex-shrink-0"},Ee=["innerHTML"],Ae={class:"time__wrap w-full mt-2 no-wrap text-right"},Be={class:"text-sm text-b3 font-normal"},Ne={props:{item:{type:Object,default:()=>{}}},setup(p){const r=p,{t:l}=ne(),{currentLocale:c}=ye(),C={1:l("city.message_tab_Payment results"),2:l("city.message_tab_logistics"),3:l("city.message_tab_After-sales service"),4:l("city.message_tab_Offline services"),5:l("city.message_tab_Review"),11:l("city.message_tab_logistics"),12:l("city.message_tab_After-sales service"),13:l("city.message_tab_Restock"),14:l("city.message_tab_Review"),15:l("city.message_tab_Offline services")},M=F(()=>{const T=r.item[`content${ee[c.value]}`]||r.item.contentCn||r.item.contentEn;return T?T.replace(/<[^>]*>/g,""):""});return(T,R)=>(f(),v("div",Re,[n("div",Se,[p.item.readFlag?S("",!0):(f(),v("div",qe)),n("p",Ve,u(p.item[`title${w(ee)[w(c)]}`]||p.item.titleCn||p.item.titleEn),1),p.item.category?(f(),v("p",Fe,u(C[p.item.category]),1)):S("",!0)]),n("div",{class:"content__wrap w-full text-sm text-b2 font-normal mt-2 line-clamp-2",innerHTML:w(M)},null,8,Ee),n("div",Ae,[n("p",Be,u(w(ke)(p.item.createTime)),1)])]))}},je=H(Ne,[["__scopeId","data-v-34a48966"]]),ze={class:"w-full h-full bg-[#f2f0ef]"},Ke={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 bg-white"},Pe={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Xe={class:"font-bold text-base text-b1"},He={key:1,class:"w-5 h-5",src:ie,alt:"一键清空已读"},Ge={key:0},We={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Je={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Qe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ze={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ye={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},et={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},tt={key:1},at={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},st={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},nt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},lt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},rt={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},ot={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},it={class:"list__wrap w-full h-[calc(100vh-50px-34px)] z-10 overflow-y-auto scroll-smooth px-3 scrollPage"},ct=pe({name:"OrderMessage"});function dt(p){var Q,Z;const{t:r}=ne(),l=xe(),c=ge(),{checkLoginAuth:C}=we(),M=F(()=>{var a;return((a=c.query)==null?void 0:a.type)==1?"consumer":"merchant"}),T=F(()=>[{label:r("common.all"),value:null},{label:r("city.message_tab_Payment results"),value:1},{label:r("city.message_tab_logistics"),value:2},{label:r("city.message_tab_After-sales service"),value:3},{label:r("city.message_tab_Review"),value:5},{label:r("city.message_tab_Offline services"),value:4}]),R=F(()=>[{label:r("common.all"),value:null},{label:r("city.message_tab_logistics"),value:11},{label:r("city.message_tab_After-sales service"),value:12},{label:r("city.message_tab_Restock"),value:13},{label:r("city.message_tab_Review"),value:14},{label:r("city.message_tab_Offline services"),value:15}]),D=b((Q=c.query)!=null&&Q.category?+((Z=c.query)==null?void 0:Z.category):null),E=a=>{let o={...c.query,category:a};a||delete o.category,l.replace({path:"/orderMessage",query:o}),setTimeout(()=>{O()})},U=b(0),A=b(20),y=b(!1),k=b(!1),h=b([]),O=()=>{U.value=0,h.value=[],k.value=!1,i(),j()},i=()=>{C(!0)&&(k.value||(y.value=!0,U.value+=1,$()))},$=()=>{var x;const a=D.value,o={page:U.value,size:A.value,type:(x=c.query)==null?void 0:x.type,category:a};Te(o).then(t=>{if(t.success===!1){N(t.message||r("city.Data retrieval failed")),k.value=!0;return}if(a!=D.value){k.value=!0;return}const L=t.data||[],P=t.total||0;h.value=U.value===1?L:h.value.concat(L),(h.value.length>=P||L.length===0)&&(k.value=!0)}).catch(t=>{console.error("获取订单消息列表失败:",t),N(r("city.Network error please try again later")),k.value=!0}).finally(()=>{y.value=!1})},d=a=>{var L;const o=a.id;a.readFlag=!0;const x=(L=c.query)==null?void 0:L.type;q(o).then(()=>j(x)),a.goodsId;const t=a.orderId;switch(a.remindType){case 101:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 102:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 103:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 104:e("/refundDetail?id="+t);break;case 105:e("/refundDetail?id="+t);break;case 106:e("/editShopInfo");break;case 107:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 108:e("/buyerOrderList/buyerOrderDetail?id="+t);break;case 109:e("/evaluate-post?orderId="+t);break;case 110:e("/refundDetail?id="+t);break;case 111:e("/refundDetail?id="+t);break;case 112:e("/refundDetail?id="+t);break;case 113:e("/refundDetail?id="+t);break;case 114:e("/refundDetail?id="+t);break;case 115:e("/refundDetail?id="+t);break;case 116:e("/refundDetail?id="+t);break;case 117:e("/refundDetail?id="+t);break;case 118:e("/buyerOrderList?active=2");break;case 201:e("/sellerOrderDetail?id="+t);break;case 202:e("/merchantRefundDetail?id="+t);break;case 203:e("/shopGoods");break;case 204:e("/profile?path=merchant");break;case 205:e("/sellerOrderDetail?id="+t);break;case 206:e("/sellerOrderDetail?id="+t);break;case 207:e("/merchantRefundDetail?id="+t);break;case 208:e("/merchantRefundDetail?id="+t);break;case 209:e("/merchantRefundDetail?id="+t);break;case 210:e("/merchantRefundDetail?id="+t);break;case 213:e("/merchantRefundDetail?id="+t);break;case 214:e("/merchantRefundDetail?id="+t);break;case 2010:e("/sellerOrderDetail?id="+t);break;case 100102:e("/offlineConsumerDetail?id="+t);break;case 100103:e("/offlineConsumerDetail?id="+t);break;case 100104:e("/offlineEvaluateSubmit?id="+t);break;case 100202:e("/offlineMerchantDetail?id="+t);break;case 1002020:e("/offlineMerchantDetail?id="+t);break;case 100203:e("/offlineMerchantDetail?id="+t);break}},e=a=>{l.push(a)},q=async a=>{await Oe({id:a})},s=b({}),j=async(a=(o=>(o=c.query)==null?void 0:o.type)())=>{const x=await De({type:a});if(x.success){s.value=x.data||{};return}},g=a=>a===0?0:a>99?"99+":a,[G,W]=be(!1),z=b(null),le=()=>{var x;if(G.value)return;const a=Date.now();if(z.value&&a-z.value<2e3){N(r("city.Please do not click frequently"));return}const o={type:(x=c.query)==null?void 0:x.type};W(!0),Ue(o).then(t=>{t.success&&(N(r("city.Unread messages have been cleared")),re(),O())}).catch(t=>{console.error("清空已读失败:",t)}).finally(()=>{W(!1)}),z.value=a},re=async()=>{h.value.forEach(a=>{a.readFlag=!0})};let I=null;const oe=async()=>{const a=sessionStorage.getItem("orderMessage_scrollTop");+a?I.scrollTo({top:+a,left:0,behavior:"instant"}):sessionStorage.removeItem("orderMessage_scrollTop")},K=b(!1),J=()=>{K.value||(K.value=!0,setTimeout(()=>{sessionStorage.setItem("orderMessage_scrollTop",I.scrollTop+""),K.value=!1},500))};return ve(()=>{C(!0)&&(j(),I=document.querySelector(".scrollPage"),I.addEventListener("scroll",J))}),he(()=>{var a,o;if(C(!0))try{oe(),sessionStorage.getItem("orderMessage_refreshFlag")&&U.value>0&&(D.value=(a=c.query)!=null&&a.category?+((o=c.query)==null?void 0:o.category):null,O())}finally{sessionStorage.removeItem("orderMessage_refreshFlag")}}),_e(()=>{I==null||I.removeEventListener("scroll",J)}),(a,o)=>{const x=B("van-loading"),t=B("Empty"),L=B("van-list"),P=B("van-pull-refresh");return f(),v("div",ze,[n("section",Ke,[n("div",Pe,[V(ce)]),n("div",Xe,u(a.$t("home.Order Message")),1),n("div",{class:"absolute right-4 flex items-center gap-1 -translate-y-1/2 top-1/2 w-5 h-5",onClick:le},[w(G)?(f(),X(x,{key:0,size:"20"})):(f(),v("img",He))])]),w(M)==="consumer"?(f(),v("section",Ge,[V(te,{options:w(T),modelValue:D.value,"onUpdate:modelValue":o[0]||(o[0]=_=>D.value=_),onChange:E,"label-key":"label","value-key":"value"},Y({_:2},[s.value.totalUnread>0?{name:"badge0",fn:m(()=>[n("span",We,u(g(s.value.totalUnread)),1)])}:void 0,s.value.paymentUnread>0?{name:"badge1",fn:m(()=>[n("span",Je,u(g(s.value.paymentUnread)),1)])}:void 0,s.value.logisticsUnread>0?{name:"badge2",fn:m(()=>[n("span",Qe,u(g(s.value.logisticsUnread)),1)])}:void 0,s.value.aftersaleUnread>0?{name:"badge3",fn:m(()=>[n("span",Ze,u(g(s.value.aftersaleUnread)),1)])}:void 0,s.value.reviewUnread>0?{name:"badge4",fn:m(()=>[n("span",Ye,u(g(s.value.reviewUnread)),1)])}:void 0,s.value.offlineUnread>0?{name:"badge5",fn:m(()=>[n("span",et,u(g(s.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):S("",!0),w(M)==="merchant"?(f(),v("section",tt,[V(te,{options:w(R),modelValue:D.value,"onUpdate:modelValue":o[1]||(o[1]=_=>D.value=_),onChange:E,"label-key":"label","value-key":"value"},Y({_:2},[s.value.totalUnread>0?{name:"badge0",fn:m(()=>[n("span",at,u(g(s.value.totalUnread)),1)])}:void 0,s.value.logisticsUnread>0?{name:"badge1",fn:m(()=>[n("span",st,u(g(s.value.logisticsUnread)),1)])}:void 0,s.value.aftersaleUnread>0?{name:"badge2",fn:m(()=>[n("span",nt,u(g(s.value.aftersaleUnread)),1)])}:void 0,s.value.restockUnread>0?{name:"badge3",fn:m(()=>[n("span",lt,u(g(s.value.restockUnread)),1)])}:void 0,s.value.reviewUnread>0?{name:"badge4",fn:m(()=>[n("span",rt,u(g(s.value.reviewUnread)),1)])}:void 0,s.value.offlineUnread>0?{name:"badge5",fn:m(()=>[n("span",ot,u(g(s.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):S("",!0),n("section",it,[V(P,{modelValue:y.value,"onUpdate:modelValue":o[3]||(o[3]=_=>y.value=_),onRefresh:O,"animation-duration":"0"},{default:m(()=>[h.value.length===0&&!y.value?(f(),X(t,{key:0,name:a.$t("city.no message")},null,8,["name"])):S("",!0),V(L,{loading:y.value,"onUpdate:loading":o[2]||(o[2]=_=>y.value=_),finished:k.value,"finished-text":h.value.length===0?"":a.$t("common.no more"),onLoad:i},{default:m(()=>[(f(!0),v(ae,null,se(h.value,_=>(f(),X(je,{key:_.id,item:_,class:"mb-3 first:mt-3",onClick:ft=>d(_)},null,8,["item","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])])}}const ut=Object.assign(ct,{setup:dt}),ht=H(ut,[["__scopeId","data-v-c678f12c"]]);export{ht as default};
