import{_ as de,r as c,x as V,z as ve,F as a,G as l,H as t,I as j,J as O,R as q,a2 as w,a3 as he,Q as m,P as _,n as xe,y as be,bf as ge,E as N,K as F,N as W,O as k,a1 as we,D as ye,bj as Ie,by as ke,a4 as ue,bc as Ce,bd as Se,Y as $e,Z as Be,l as Te,a0 as fe}from"./vendor-BUT0HZ5j.js";import{_ as Ve,a as Le}from"./collect-CqBtZyCF.js";import{as as De,aG as Ae,e as Ee,aH as Ne,h as je,V as Pe,av as We,aw as Ge,aI as Ke}from"./index-BvL8wS8a.js";import{B as qe}from"./BackIcon-biFt6cm7.js";import{_ as Fe}from"./MCOIN-BcbOHmhy.js";import{_ as ze}from"./right-arrow-D3mVT5UK.js";import{_ as Me}from"./NoteList-DblPmja3.js";import"./WaterFull-CDtRtt9C.js";const Oe=["onClick","id"],Re={class:"relative"},He={class:"text-sm text-b3 font-normal flex items-center justify-center"},Ue={class:"label__wrap text-center"},Ye={key:0,class:"fm-tab-underline"},Je={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16},equalWidth:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(C,{emit:L}){const d=C,S=c(null),p=c(null),h=c([]),$=V(()=>Array.isArray(d.options)?d.options:Object.values(d.options));function f(i){return i[d.valueKey]===d.modelValue}function x(i){L("update:modelValue",i[d.valueKey]),L("change",i[d.valueKey])}ve(()=>d.modelValue,async()=>{d.scrollToSelected&&(await xe(),D())},{immediate:!0});function D(){const i=$.value.findIndex(v=>f(v));if(i===-1)return;const b=document.getElementById(`fm-tab-item-${i}`),n=S.value;if(b&&n){const v=b.offsetLeft-(d.scrollOffset||0);n.scrollTo({left:v,behavior:"smooth"})}}return(i,b)=>(l(),a("div",{class:"fm-tab",ref:(n,v)=>{v.tabWrapper=n,S.value=n}},[t("div",{class:"flex flex-nowrap items-center w-full",ref:(n,v)=>{v.tabList=n,p.value=n}},[(l(!0),a(j,null,O(_($),(n,v)=>(l(),a("div",{key:n[C.valueKey]??v,class:q([["fm-tab-item",{active:f(n)}],"relative w-1/2 flex justify-center items-center"]),onClick:y=>x(n),ref:(y,s)=>{s.tabItems=y,h.value=y},id:`fm-tab-item-${v}`},[t("div",Re,[t("p",He,[t("span",Ue,m(n[C.labelKey]),1),he(i.$slots,"badge"+v,{},void 0,!0)]),f(n)?(l(),a("div",Ye)):w("",!0)])],10,Oe))),128))],512)],512))}},Qe=de(Je,[["__scopeId","data-v-e5ec8da2"]]),Ze={key:0},Xe=["onClick"],et={class:"text-base font-semibold text-b1 w-auto"},tt=["onClick"],st={class:"w-full h-[100px] flex items-center justify-center rounded-lg overflow-hidden"},ot={class:"flex items-center justify-between mt-[5px] w-full"},lt={class:"text-xs text-b1 mr-1 line-clamp-1"},at={class:"flex items-center w-auto flex-shrink-0"},nt={class:"text-sm font-semibold text-b1"},rt=["onClick"],ct=t("span",{class:"text-xs text-b3 [writing-mode:vertical-rl] [text-orientation:mixed] font-normal"},"查看更多",-1),it=[ct],ut=be({props:{params:{default:{}}},emits:["handleTo"],setup(C,{expose:L,emit:d}){const S=C,p=ge({page:0,size:10}),h=c(0),$=c(!1),f=c(!1),x=c([]),D=async()=>{$.value=!0,p.page+=1,await i(),setTimeout(()=>{$.value=!1},1e3)},i=async()=>{const r=await Ae({...p,...S.params});if(!r.success){f.value=!0;return}if(!r.data||!r.data.records||!+r.data.total){f.value=!0;return}h.value=r.data.total,x.value=p.page===1?r.data.records:x.value.concat(r.data.records),x.value.length>=h.value&&(f.value=!0)},b=c(!1),n=V(()=>b.value||x.value.length<=3?x.value:x.value.slice(0,3)),v=r=>r.goodsList.slice(0,3),y=()=>{b.value=!b.value},s=r=>{d("handleTo","/shop?shopId="+r.shopId)},z=r=>{d("handleTo","/offlineGoodsDetail"+("?goodsId="+r.goodsId)+("&storeId="+S.params.storeId))},R=r=>{d("handleTo","/city/storefront/storeCombo?storeId="+S.params.storeId)};return L({total:h,finished:f}),(r,K)=>{const A=N("VanImage"),H=N("VanList");return l(),F(H,{loading:$.value,"onUpdate:loading":K[0]||(K[0]=u=>$.value=u),finished:f.value,"loading-text":r.$t("common.loading"),onLoad:D},{finished:W(()=>[h.value?w("",!0):(l(),F(De,{key:0,style:{padding:"52px 0 47px"},name:"商家未入驻"}))]),default:W(()=>[h.value?(l(),a("div",Ze,[(l(!0),a(j,null,O(_(n),(u,B)=>{var M;return l(),a("div",{key:B},[(M=u==null?void 0:u.goodsList)!=null&&M.length?(l(),a("div",{key:0,class:q(["mb-3 last:mb-0",{"border-b border-b-b4 pb-3":B<_(n).length-1}])},[t("div",{class:"flex items-center mb-2 cursor-pointer",onClick:I=>s(u)},[k(A,{src:u.shopPics?u.shopPics.split(",")[0]:"",class:"w-6 h-6 mr-1 rounded-[4px] overflow-hidden",alt:u.shopName,fit:"cover"},null,8,["src","alt"]),t("span",et,m(u.shopName),1),u.goodsList.length>3?(l(),F(A,{key:0,src:_(ze),class:"w-5 h-5 ml-1",alt:"arrow"},null,8,["src"])):w("",!0)],8,Xe),t("div",{class:q(["flex gap-3 pr-3",{"overflow-x-auto scrollbar-hide":u.goodsList.length>2}])},[(l(!0),a(j,null,O(v(u),(I,U)=>(l(),a("div",{key:I.goodsId,class:q(["flex-shrink-0",u.goodsList.length<=2?"w-[calc(50%-6px)]":"w-[140px]"]),onClick:Y=>z(I)},[t("div",st,[k(A,{src:I.goodsIcons?I.goodsIcons.split(",")[0]:"",class:"w-full h-full object-cover",alt:I.goodsName,fit:"cover"},null,8,["src","alt"])]),t("div",ot,[t("div",lt,m(I.goodsName),1),t("div",at,[k(A,{src:_(Fe),class:"w-4 h-4 mr-1",alt:"Mcoin"},null,8,["src"]),t("span",nt,m(I.goodsPrice),1)])])],10,tt))),128)),+u.storeShopGoodsCount>3?(l(),a("div",{key:0,class:"flex-shrink-0 w-[12px] flex items-center justify-center h-[110px]",onClick:I=>R()},it,8,rt)):w("",!0)],2)],2)):w("",!0)])}),128)),x.value.length>3?(l(),a("div",{key:0,class:"text-center text-b3 text-sm font-normal",onClick:y},m(b.value?"收起":`查看其他${x.value.length-3}家门店`),1)):w("",!0)])):w("",!0)]),_:1},8,["loading","finished","loading-text"])}}}),G=C=>($e("data-v-6b009996"),C=C(),Be(),C),dt={class:"relative w-full min-h-full",id:"storefront",style:{background:"#f2f0ef"}},vt={class:"flex flex-wrap items-center w-10"},ft=G(()=>t("p",{class:"text-base font-bold text-b1 text-center"},"门店详情",-1)),pt={key:0,src:Ve,alt:"收藏",class:"w-5 h-5"},mt={key:1,src:Le,alt:"取消",class:"w-5 h-5"},_t={class:"w-full h-[330px] bg-"},ht={class:"bg-white relative z-10"},xt={class:"shop-info rounded-t-xl bg-white w-ful p-3 mt-[-12px]"},bt={class:"text-base font-bold text-b1"},gt={class:"flex items-center justify-start mt-[2px] text-xs text-b3 font-normal"},wt=G(()=>t("div",{class:"divider bg-[#D9D9D9] h-[12px] w-[1px] mx-1"},null,-1)),yt=G(()=>t("div",{class:"divider bg-[#D9D9D9] h-[12px] w-[1px] mx-1"},null,-1)),It={class:"map-texture w-full h-fit rounded-lg overflow-hidden mt-3"},kt={key:0,class:"w-full h-full map-texture-bg flex items-center justify-between p-2"},Ct={class:"text-xs text-[#2E2008] leading-[18px] font-semibold"},St={key:0,class:"mt-1 text-xs text-[#585654] leading-[18px]"},$t=["src"],Bt=G(()=>t("div",{class:"mt-[1px] text-xs text-[#585654] leading-[18px]"}," 复制 ",-1)),Tt={class:"mt-2 w-full bg-white"},Vt={class:"p-3 pr-0 bg-white",id:"combo"},Lt={class:"mt-2 w-full bg-white",id:"note"},Dt={class:"p-3"},At=G(()=>t("div",{class:"text-[#2E2008] text-base font-semibold font-Puhui"}," 消费笔记 ",-1)),Et={class:"mt-2"},Nt=G(()=>t("div",{class:"h-[82px]"},null,-1)),jt={class:"button-group-bg fixed bottom-0 left-0 z-[11] w-full flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},Pt=fe(" 写笔记 "),Wt={key:0,round:"",class:"w-[58.5%] h-[46px] text-base font-semibold bg-yellow text-b1 rounded-full opacity-[0.7] flex justify-center items-center"},Gt=fe(" 我想要 "),Kt={setup(C){const L=we(),d=Te(),{cityMapStore:S}=Ee(),p=V(()=>{var e;return(e=L.query)!=null&&e.child?document.getElementById("storefront"):document.getElementById("fm-page")}),h=c(!1),$=c(0);let f=c(!0);const x=()=>{var e;(e=p.value)==null||e.addEventListener("scroll",D),D()},D=ke(()=>{var e,o;$.value=((e=p.value)==null?void 0:e.scrollY)||((o=p.value)==null?void 0:o.scrollTop),$.value<100?f.value=!1:f.value=!0},100),i=c([{label:"门店套餐",value:"bundle"},{label:"消费笔记",value:"note"}]),b=c(i.value[0].value),n=c([i.value[0]]),v=e=>{let o=null;e==="bundle"?o=document.querySelector("#combo"):e==="note"&&(o=document.querySelector("#note")),p.value&&o&&setTimeout(()=>{var T;p.value.scrollTo({top:((T=o==null?void 0:o.getBoundingClientRect())==null?void 0:T.top)||0,behavior:"smooth"})},100)},y=V(()=>{var e;return((e=L.query)==null?void 0:e.storeId)||""}),s=c({}),z=c([]),R=async()=>{var e,o;try{const T={id:y.value,longitude:S.locationCoords.lng||null,latitude:S.locationCoords.lat||null},E=await Ne(T);if(!E.success||!E.data)return;s.value=E.data,z.value=(e=E.data)!=null&&e.storeIcons?(o=E.data)==null?void 0:o.storeIcons.split(","):[]}catch{}},r=c(null),K=c(null),A=V(()=>{var e;return(e=K.value)==null?void 0:e.total}),H=V(()=>({storeId:y.value}));ve(()=>A.value,(e,o)=>{e?n.value=i.value:(n.value=[i.value[0]],b.value=i.value[0].value)},{immediate:!0,deep:!0});const u=async()=>{var o;if(h.value||!y.value)return;h.value=!0;const e=await Ke({id:y.value});h.value=!1,e.success&&(s.value.addWantCountFlag=!s.value.addWantCountFlag,s.value.wantCount=+(((o=s.value)==null?void 0:o.wantCount)||0)+1)},B=c(!1),M=async()=>{var o,T;if(B.value||!((o=s.value)!=null&&o.storeId))return;s.value.collectId=9999,B.value=!0;const e=await Ge({storeId:(T=s.value)==null?void 0:T.storeId});B.value=!1,e.success&&(s.value.collectId=e.data)},I=async()=>{var o;if(B.value||!((o=s.value)!=null&&o.storeId))return;let e=s.value.collectId;s.value.collectId=null,B.value=!0,await We({ids:[e]}),B.value=!1},U=V(()=>{var e;return((e=s.value)==null?void 0:e.goodsCategoryName1)||""}),Y=V(()=>{var e,o;return(e=s.value)!=null&&e.areaName2?((o=s.value)==null?void 0:o.areaName2)+"市":""}),J=e=>{d.push(e)},pe=()=>{S.setSelectedStore(s.value),J("/city/noteCreate?storeId="+y.value)};return ye(async()=>{x(),await R()}),Ie(()=>{var e;p.value&&((e=p.value)==null||e.removeEventListener("scroll",D))}),(e,o)=>{var Z,X,ee,te,se,oe,le,ae,ne,re,ce,ie;const T=N("VanImage"),E=N("van-swipe-item"),me=N("van-swipe"),Q=N("VanButton"),_e=N("router-view");return l(),a("div",dt,[t("header",{class:q(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-4 fixed",{"bg-white":_(f)," bg-transparent":!_(f)}])},[t("div",vt,[k(qe)]),ft,t("div",{onClick:o[0]||(o[0]=ue(g=>s.value.collectId?I():M(),["stop"]))},[s.value.collectId?(l(),a("img",pt)):(l(),a("img",mt))])],2),t("section",_t,[k(me,{class:"note-imgs-swiper",autoplay:3e3,"indicator-color":"oriange1"},{default:W(()=>[(l(!0),a(j,null,O(z.value,g=>(l(),F(E,{key:g},{default:W(()=>[k(T,{src:g,class:"w-full h-full overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),_:2},1024))),128))]),_:1})]),t("div",ht,[t("section",xt,[t("p",bt,m(((Z=s.value)==null?void 0:Z.storeName)||""),1),t("div",gt,[t("p",null,m(_(U)),1),+((X=s.value)==null?void 0:X.orderPersonCount15)>0?(l(),a(j,{key:0},[wt,t("p",null,m(_(Y))+"·热销第"+m(((ee=s.value)==null?void 0:ee.orderPersonCount15)||0)+"名 ",1)],64)):w("",!0),+((te=s.value)==null?void 0:te.storeSalesVolume15)>0?(l(),a(j,{key:1},[yt,t("p",null,"近15天"+m(((se=s.value)==null?void 0:se.storeSalesVolume15)||0)+"人下单",1)],64)):w("",!0)]),t("div",It,[(oe=s.value)!=null&&oe.storeAddress?(l(),a("div",kt,[t("div",null,[t("p",Ct,m(((le=s.value)==null?void 0:le.storeAddress)||""),1),(ae=s.value)!=null&&ae.distance?(l(),a("div",St," 距您直线"+m(((ne=s.value)==null?void 0:ne.distance)||0)+"m ",1)):w("",!0)]),t("div",{class:"shrink-0 flex flex-col items-center",onClick:o[1]||(o[1]=ue(g=>{var P;return _(je)(((P=s.value)==null?void 0:P.storeAddress)||"")},["stop"]))},[t("img",{class:"w-4 h-4",src:_(Pe)("cityMap/copy.svg"),alt:""},null,8,$t),Bt])])):w("",!0)])]),t("section",Tt,[k(Qe,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=g=>b.value=g),options:n.value,onChange:v,"label-key":"label","value-key":"value"},null,8,["modelValue","options"]),t("div",Vt,[k(ut,{ref:(g,P)=>{P.shopBundle=g,r.value=g},params:_(H),onHandleTo:J},null,8,["params"])])]),Ce(t("section",Lt,[t("div",Dt,[At,t("div",Et,[k(Me,{ref:(g,P)=>{P.noteList=g,K.value=g}},null,512)])])],512),[[Se,_(A)]])]),Nt,t("div",jt,[k(Q,{round:"",type:"primary",class:"flex-1 w-full h-[46px] rounded-full border border-solid border-[#000] bg-white text-[#2E2008] text-base font-semibold",onClick:pe},{default:W(()=>[Pt]),_:1}),(re=r.value)!=null&&re.finished&&((ce=r.value)==null?void 0:ce.total)===0?(l(),a(j,{key:0},[s.value.storeId&&!s.value.addWantCountFlag?(l(),a("div",Wt," 已有"+m(((ie=s.value)==null?void 0:ie.wantCount)||0)+"人想要 ",1)):(l(),F(Q,{key:1,round:"",class:"w-[58.5%] h-[46px] text-base font-semibold bg-yellow text-b1",loading:h.value,onClick:u},{default:W(()=>[Gt]),_:1},8,["loading"]))],64)):w("",!0)]),k(_e,{class:"child-view"})])}}},Yt=de(Kt,[["__scopeId","data-v-6b009996"]]);export{Yt as default};
