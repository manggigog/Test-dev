import{_ as K}from"./exchange2-BqAz_vBQ.js";import{_ as Q,y as R,w as X,bd as Y,bc as Z,x as k,r as W,D as ee,F as m,G as l,O as d,N as w,E as A,H as t,P as s,Q as o,a0 as p,K as M,I as se,J as te,B as ae,T as oe,Y as ne,Z as le}from"./vendor-CjApaIpB.js";import{_ as ce}from"./BgBox-DQlmQ9my.js";import{E as ie}from"./EcologyHeader-CnK0qTPC.js";import{q as f,g as B,r as de,s as r,c as C,d as u}from"./index-B3VH42pz.js";import{u as re}from"./lendingPoolContract-B-9pg28l.js";import"./bg-dot-BdvI4GrL.js";import"./UserLevel-ByuVqmJu.js";import"./avatarRing-DpEnkbQ2.js";import"./UserAsset-C4gxomNy.js";import"./TokenBalance-z2oXzaSp.js";const ue="/Test-dev/static/images/exchange-1-0tPEy7IE.svg",$=g=>(ne("data-v-31e5d0ec"),g=g(),le(),g),me={class:"relative h-full"},ge={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4"},pe={class:"flex-center-bw"},fe={class:"flex-start gap-2.5"},_e=["src"],he={class:"font-semibold"},be={class:"opacity-80 flex-center"},xe={key:1},ve={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},ke={class:"flex items-center justify-end gap-2 mt-2"},we=["onClick"],Ae=$(()=>t("img",{src:ue,class:"block w-20",alt:""},null,-1)),ye=[Ae],De={class:"flex-center-bw"},Se={class:"flex-start gap-2.5"},Ue=["src"],Le={class:"font-semibold"},Te={class:"opacity-80 flex-center"},Ve={key:1},Fe={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},Me={class:"mt-2 text-center opacity-70"},Be={class:"gap-4 mt-5 font-semibold text-white flex-center"},Ce={class:"gap-1 flex-center"},$e=$(()=>t("img",{src:K,class:"w-4",alt:""},null,-1)),Ie=R({setup(g){const{usdtAddress:_,musdAddress:h,deposit:I,withdraw:E}=re(),{loadingToggle:y}=de(),{t:N}=X(),e=Y({percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],token0:"USDT",token1:"MUSD",balance0:0,balance1:0,resouceAmount:null,toAmount:null,authLoading:!1,isAuth:!1,exchangeLoading:!1,allowanceAmount:0,resouceDisabled:!0,toDisabled:!0}),[D,S]=Z(!1),c=k(()=>({name:e.token0,icon:B(`images/tokens/${e.token0}.png`),token:f[`${e.token0}`]})),b=k(()=>({name:e.token1,icon:B(`images/tokens/${e.token1}.png`),token:f[`${e.token1}`]})),P=()=>{e.resouceDisabled=!1,e.toDisabled=!0},O=()=>{e.resouceDisabled=!0,e.toDisabled=!1},z=a=>{e.resouceDisabled=!1,e.resouceAmount=u(+ae(e.balance0).times(a.value))},U=k(()=>({MUSDUSDT:1,USDTMUSD:1})[e.token0+e.token1]),H=()=>{e.token0==="MUSD"?(e.token0="USDT",e.token1="MUSD"):(e.token0="MUSD",e.token1="USDT"),e.resouceAmount=0,v()},x=W(""),j=async()=>{const a=c.value.name==="MUSD"?await h():await _();x.value=a},L=async()=>{const a=await(await r(x.value)).allowance(f.lendingPool);e.isAuth=+a.result>0&&+a.result>=e.resouceAmount,e.allowanceAmount=a.result||0},q=async()=>{e.authLoading=!0;const{approve:a}=r(x.value),i=await a(f.lendingPool);e.authLoading=!1,i.success&&L()},G=async()=>{S(!0),e.balance0=c.value.name==="MUSD"?+await r(await h()).balanceOf():+await r(await _()).balanceOf(),e.balance1=b.value.name==="MUSD"?+await r(await h()).balanceOf():+await r(await _()).balanceOf(),S(!1)},J=async()=>{if(!e.resouceAmount||e.resouceAmount===0)return oe(N("assets.pleaseInput"));e.exchangeLoading=!0;let a;c.value.name==="MUSD"?a=await E(u(e.resouceAmount)):a=await I(u(e.resouceAmount)),e.exchangeLoading=!1,a.success&&(e.resouceAmount=0,v())},v=async()=>{y(!0),await j(),await L(),G(),y(!1),e.authLoading=!1,e.exchangeLoading=!1};return ee(async()=>{v()}),(a,i)=>{const T=A("van-loading"),V=A("VanField"),F=A("VanButton");return l(),m("div",me,[d(ie),d(ce,{icon:"images/ecology/exchange.png",text:a.$t("ecology.exchange")},{default:w(()=>[t("div",ge,[t("section",null,[t("div",pe,[t("div",fe,[t("img",{src:s(c).icon,alt:"",class:"w-6 h-6"},null,8,_e),t("span",he,o(s(c).name),1)]),t("div",be,[p(o(a.$t("assets.balance"))+" ",1),s(D)?(l(),M(T,{key:0,size:"18px"})):(l(),m("span",xe,o(s(C)(s(u)(s(e).balance0||0))),1))])]),t("div",ve,[d(V,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",modelValue:s(e).resouceAmount,"onUpdate:modelValue":i[0]||(i[0]=n=>s(e).resouceAmount=n),onFocus:P,type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",ke,[(l(!0),m(se,null,te(s(e).percents,n=>(l(),m("div",{class:"text-xs text-oriange1 border border-solid border-oriange1 rounded-md px-1 py-[2px] hover:bg-[#ffcd89]",key:n.value,onClick:Ee=>z(n)},o(n.name),9,we))),128))])])]),t("div",{class:"mt-3 flex-center"},[t("div",{class:"w-20",onClick:H},ye)]),t("section",null,[t("div",De,[t("div",Se,[t("img",{src:s(b).icon,alt:"",class:"w-6 h-6"},null,8,Ue),t("span",Le,o(s(b).name),1)]),t("div",Te,[p(o(a.$t("assets.balance"))+" ",1),s(D)?(l(),M(T,{key:0,size:"18px"})):(l(),m("span",Ve,o(s(C)(s(u)(s(e).balance1||0))),1))])]),t("div",Fe,[d(V,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",disabled:!0,modelValue:s(e).resouceAmount,"onUpdate:modelValue":i[1]||(i[1]=n=>s(e).resouceAmount=n),onFocus:O,type:"number",placeholder:"0"},null,8,["modelValue"])])]),t("div",Me," 1 "+o(s(e).token0)+" = "+o(s(U)?s(u)(s(U),6).toString():"-")+" "+o(s(e).token1),1),t("div",Be,[d(F,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth&&s(e).allowanceAmount>=s(e).resouceAmount,loading:s(e).authLoading,onClick:q},{default:w(()=>[p(o(a.$t("assets.auth"))+o(s(c).name),1)]),_:1},8,["disabled","loading"]),d(F,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:J},{default:w(()=>[t("div",Ce,[$e,p(" "+o(a.$t("assets.change")),1)])]),_:1},8,["loading","disabled"])])])]),_:1},8,["text"])])}}}),Re=Q(Ie,[["__scopeId","data-v-31e5d0ec"]]);export{Re as default};
