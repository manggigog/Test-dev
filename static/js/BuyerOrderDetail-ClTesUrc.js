import{_ as _t,z as Qe,y as v,G as y,H as n,U as m,I as s,O as a,Q as l,a3 as Re,X as As,Y as ks,r as k,E as Ie,P as j,B as M,a4 as P,J as ne,x as ie,F as Ft,Z as _,$ as J,N as Dt,D as _e,o as Cs,a2 as K,T as O,q as Ss}from"./vendor-Dr_RpJ_Y.js";import{_ as Bt}from"./edit-line-afMYMtOA.js";import{e as re,j as ae,g as E,f as Ke,h as ve,r as ke,c as Ye,V as Rs,a as Is,b as _s,i as Fs,C as Ce,G as Ds,Y as Bs,bL as Ns}from"./index-BckdT6oc.js";import{u as Nt}from"./useSelectAddress-CgNt0r_o.js";import{a as Ct,g as Ps,p as Es,h as Ze,q as Ls,n as Os,r as js,l as Xe,o as Pt,s as Ms}from"./useOrderActionButtons-CBZMA2Vd.js";import{_ as Us,a as Hs,R as St,b as qs,c as Gs}from"./remark-2opyrALq.js";import{B as Vs,V as Ws}from"./VoucherConfirm-CSRrzjx8.js";import{_ as Et}from"./CountdownLabel-BEWGrnUw.js";import{_ as Fe}from"./MCOIN-Bodfn-v1.js";import{_ as Ks}from"./USDT-Dlu99aCg.js";import{_ as zs}from"./FMCP-f3k58DsE.js";import{_ as Js}from"./link-DvRTrysK.js";import{_ as pe}from"./copy-w-F2Lv8QkV.js";import{P as Y}from"./order-H59PKTFP.js";import{p as Ys,a as Zs,d as et,b as Qs}from"./useOrderStatus-B4sCDXOr.js";import{_ as ze}from"./SubmitApprove-DRkN2msB.js";import{P as Xs}from"./PaySwitchPop-CH2Qnihk.js";import{_ as Rt}from"./EmptyTipsPop-DFfFg0cQ.js";import{B as eo}from"./BackIcon-CDrGaEPo.js";import{a as to,C as so,m as oo,D as It,E as ro,c as Se,n as Je,d as ao,F as no,G as io,r as lo}from"./order-BTAcEDew.js";import{p as uo}from"./piggyBank-u8s6wp9e.js";import"./flashSale-DDyqLyYN.js";import"./credit-EZuPIBEN.js";import"./useShipTemplate-4sMa-Tzi.js";import"./enums-DlE-aiss.js";import"./default-avatar-BIKCDGrQ.js";import"./useRefund-DuvymEPl.js";import"./useKeyboard-DcWqtm11.js";import"./selected-icon-Dcrtmy6G.js";const co=o=>(As("data-v-59ba96ea"),o=o(),ks(),o),mo={class:"p-3 break-all bg-white rounded-xl relative"},fo={key:0,class:"tipsCard w-full h-fit p-2 mb-1 text-left"},ho={class:"text-sm text-[#FF8812] font-normal font-Puhui"},yo={key:1,class:"tipsCard w-full h-fit p-2 mb-1 text-left"},vo={class:"text-sm text-[#FF8812] font-normal font-Puhui"},po={class:"font-semibold text-sm text-b1"},bo={class:"mt-1 text-b2 text-sm font-normal flex justify-between items-end"},wo={class:"ml-1"},xo=["onClick"],go=co(()=>s("img",{class:"w-5 h-5",src:Bt,alt:""},null,-1)),To=[go],$o=Qe({props:{order:null,showCopy:{type:Boolean,default:!0},canEdit:{type:Boolean},nowTime:null},emits:["handleTo"],setup(o,{emit:b}){const d=o,{setAddress:R}=Nt();v(()=>`${d.order.userAddress.provinceName??""}${d.order.userAddress.cityName??""}${d.order.userAddress.countyName??""}${d.order.userAddress.detailInfo??""} ${d.order.userAddress.userName??""} ${d.order.userAddress.telNumber??""}`);const C=()=>{R(d.order.userAddress),sessionStorage.setItem("order_remark",d.order.userAddress.postscript),b("handleTo","/userAddress?orderModify=1")},S=v(()=>{var I;return((I=d.order.modifyInfo)==null?void 0:I.status)===1||d.order.orderPostscriptUpdateReviewId}),N=v(()=>{var x,p;let I=(x=d.order.modifyInfo)!=null&&x.type?(p=d.order.modifyInfo)==null?void 0:p.type:d.order.orderPostscriptUpdateReviewType;return(I==1||I==3)&&Ct(d.order,d.nowTime)});return(I,x)=>(n(),y("div",mo,[a(N)&&o.canEdit?(n(),y("div",fo,[s("span",ho,l(I.$t("order.please check receive address")),1)])):!a(S)&&a(N)&&!I.isEdit?(n(),y("div",yo,[s("span",vo,l(I.$t("order.please check receive address")),1)])):m("",!0),s("div",po,l(o.order.userAddress.provinceName??"")+l(o.order.userAddress.cityName??"")+l(o.order.userAddress.countyName??"")+l(o.order.userAddress.detailInfo??""),1),s("div",bo,[s("div",null,[s("span",null,l(o.order.userAddress.userName),1),s("span",wo,l(o.order.userAddress.telNumber??""),1)]),o.canEdit&&!a(S)&&a(Ct)(o.order,o.nowTime)?(n(),y("div",{key:0,class:"shrink-0",onClick:Re(C,["stop"])},To,8,xo)):m("",!0)])]))}}),Ao=_t($o,[["__scopeId","data-v-59ba96ea"]]),ko={key:0,class:"p-3 break-all bg-white rounded-xl relative"},Co={class:"font-semibold text-base text-b1"},So=s("span",null,"请在",-1),Ro={class:"text-[#FF8812] mx-1"},Io=s("span",null,"内支付",-1),_o=s("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后订单将超时关闭 ",-1),Fo=["onClick"],Do=s("span",{class:"text-sm text-[#FF8812] font-normal"},"修改订单信息",-1),Bo=s("img",{class:"ml-0.5 w-4 h-4",src:Bt,alt:""},null,-1),No=[Do,Bo],Po={props:{order:{type:Object,required:!0},canEdit:{type:Boolean,default:!1}},emits:["timeDone","handleTo"],setup(o,{emit:b}){const d=o,R=k(!0),C=()=>{R.value||(R.value=!0,b("timeDone"))},S=()=>{const N=d.order;b("handleTo",`/buyerOrderList/buyerOrderDetail?id=${N.id}`)};return Ie(()=>{d.order.createTime>0&&(R.value=!1)}),(N,I)=>o.order.status===0?(n(),y("div",ko,[s("div",Co,[So,s("span",Ro,[j(Et,{class:"inline-block w-auto",startTime:o.order.createTime,duration:15,durationType:"minutes",showZero:!0,onDone:C},null,8,["startTime"])]),Io]),_o,o.canEdit?m("",!0):(n(),y("div",{key:0,class:"absolute top-[15px] right-3 flex items-center",onClick:Re(S,["stop"])},No,8,Fo))])):m("",!0)}},Eo={class:"p-3 py-4 break-all bg-white rounded-xl"},Lo={class:"title text-b1 text-sm font-semibold"},Oo={class:"content"},jo={class:"flex justify-between items-center mt-4"},Mo={class:"text-b3 text-sm font-normal"},Uo={class:"text-b1 text-sm font-normal text-right"},Ho={class:"flex justify-between items-center mt-4"},qo={class:"text-b3 text-sm font-normal"},Go={class:"text-b1 text-sm font-normal text-right flex items-center"},Vo=s("div",{class:"flex-shrink-0"},[s("img",{class:"w-4 h-4",src:Fe})],-1),Wo={class:"ml-1"},Ko={key:0,class:"flex justify-between items-center mt-4"},zo={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Jo={class:"text-b1 text-sm font-normal text-right flex items-center"},Yo={class:"mr-1"},Zo=s("div",{class:"flex-shrink-0"},[s("img",{class:"w-4 h-4",src:Fe})],-1),Qo={class:"ml-1"},Xo={key:1,class:"flex justify-between items-center mt-4"},er={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},tr={class:"text-b1 text-sm font-normal text-right flex items-center"},sr=s("div",{class:"mr-1"},"-",-1),or=s("div",{class:"flex-shrink-0"},[s("img",{class:"w-4 h-4",src:Fe})],-1),rr={class:"ml-1"},ar={class:"flex justify-between items-center mt-4"},nr={class:"text-b3 text-sm font-normal"},ir={class:"text-b1 text-sm font-normal text-right"},lr={class:"flex items-center justify-end gap-1"},dr={key:0,class:"flex items-center justify-end gap-1"},ur=s("img",{src:Ks,class:"w-4 h-4 inline-block"},null,-1),cr={key:1,class:"flex items-center justify-end gap-1"},mr=s("img",{src:Fe,class:"w-4 h-4"},null,-1),fr=P(" + "),hr=s("img",{src:zs,class:"w-4 h-4"},null,-1),yr={class:"flex justify-between items-center mt-4"},vr={class:"text-b3 text-sm font-normal"},pr={class:"text-b1 text-sm font-normal text-right"},br={class:"flex items-center"},wr={class:"flex justify-between items-center mt-4"},xr={class:"text-b3 text-sm font-normal"},gr=["href"],Tr=s("img",{src:Js,class:"w-5 h-5 ml-1",alt:""},null,-1),$r={key:1},Ar={class:"flex justify-between items-center mt-4"},kr={class:"text-b3 text-sm font-normal"},Cr=s("img",{src:pe,class:"w-5 h-5 ml-1",alt:""},null,-1),Sr={class:"flex justify-between items-center mt-4"},Rr={class:"text-b3 text-sm font-normal"},Ir=s("img",{src:pe,class:"w-5 h-5 ml-1",alt:""},null,-1),_r={key:1},Fr={key:2,class:"flex justify-between items-center mt-4"},Dr={class:"text-b3 text-sm font-normal"},Br={class:"text-b1 text-sm font-normal text-right"},Nr={key:3,class:"flex justify-between items-center mt-4"},Pr={class:"text-b3 text-sm font-normal"},Er={class:"text-b1 text-sm font-normal text-right"},Lr={key:4,class:"flex justify-between items-center mt-4"},Or={class:"text-b3 text-sm font-normal"},jr={class:"text-b1 text-sm font-normal text-right"},Mr={key:5,class:"flex justify-between items-center mt-4"},Ur={class:"text-b3 text-sm font-normal"},Hr={class:"text-b1 text-sm font-normal text-right"},qr={key:6,class:"flex justify-between items-center mt-4"},Gr={class:"text-b3 text-sm font-normal whitespace-nowrap"},Vr={class:"text-b1 text-sm font-normal text-right flex items-center"},Wr={class:"break-all flex-1"},Kr=s("img",{src:pe,class:"w-5 h-5",alt:""},null,-1),zr=[Kr],Jr={key:7,class:"flex justify-between items-center mt-4"},Yr=s("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货物流公司 ",-1),Zr={class:"text-b1 text-sm font-normal text-right break-all"},Qr={key:8,class:"flex justify-between items-center mt-4"},Xr=s("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 发货运单号 ",-1),ea={class:"text-b1 text-sm font-normal text-right flex items-center"},ta={class:"break-all flex-1"},sa=s("img",{src:pe,class:"w-5 h-5",alt:""},null,-1),oa=[sa],ra={key:9,class:"flex justify-between items-center mt-[16px]"},aa=s("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货物流公司 ",-1),na={class:"text-b1 text-sm font-normal text-right break-all"},ia={key:10,class:"flex justify-between items-center mt-[16px]"},la=s("div",{class:"text-b3 text-sm font-normal whitespace-nowrap"}," 退货运单号 ",-1),da={class:"text-b1 text-sm font-normal text-right flex items-center"},ua={class:"break-all flex-1"},ca=s("img",{src:pe,class:"w-5 h-5",alt:""},null,-1),ma=[ca],fa={props:{order:{type:Object,required:!0}},setup(o){const b=o,d=k(1),{tradeContributeSelfRate:R,mcoinRate:C}=Ye(),S=k(null),N=v(()=>1/S.value),I=async()=>{S.value=await C(),console.log("pointRate.value",S.value)};v(()=>{let h=0;return h=new M(b.order.totalAmount||0).minus(b.order.voucherAmount||0),re(h)});const x=v(()=>{var h;return!((h=b.order)!=null&&h.totalAmount)||!N.value?0:new M(b.order.totalAmount).times(N.value).toNumber()}),p=v(()=>{var u;const h=new M(((u=b.order)==null?void 0:u.totalAmount)||0),$=new M(t.value||0);return h.minus(b.order.paySource==Y.WITHDRAW_POINTS?$:0).toNumber()}),f=v(()=>{var $;const h=b.order.orderGoods||[];return h.length>0?h[0].discountRatio||0:(($=b.order.stores)==null?void 0:$.discountRatio)||0}),T=async()=>{d.value=await R()},g=v(()=>{var $;if(!(($=b.order)!=null&&$.orderGoods))return 0;let h=new M(0);return b.order.orderGoods.forEach(u=>{if(+b.order.payType==1&&+u.payType==3||+u.payType!=2&&+u.payType!=3){const A=new M(u.price).times(u.number).minus(u.goodsActivityReduceAmount||0).plus(u.goodsAdjustChangeAmount||0).times(new M(u.discountRatio||0).div(100));h=h.plus(A)}}),h.times(d.value).toNumber()}),B=k(0),t=v(()=>{var A;if(!((A=b.order)!=null&&A.orderGoods)||B.value<=0)return 0;const h=g.value||0,$=d.value;let u=0;return b.isBuyer?u=Math.min(B.value,new M(h).div($).times(.5).toNumber()):u=Math.min(b.order.voucherAmount,new M(h).div($).times(.5).toNumber()),u});return Ie(async()=>{B.value=await ae(E.FMCP).balanceOf(),await T(),await I()}),(h,$)=>{var u,A,U,Z,be,le,de;return n(),y("div",Eo,[s("div",Lo,[s("span",null,l(h.$t("order.orderInfo")),1)]),s("div",Oo,[s("div",jo,[s("div",Mo,l(h.$t("common.pay type method")),1),s("div",Uo,l(a(Ys)(+o.order.paySource)),1)]),s("div",Ho,[s("div",qo,l(h.$t("order.total price detail")),1),s("div",Go,[Vo,s("div",Wo,l(a(re)(o.order.totalAmountOriginal||o.order.totalAmount)),1)])]),o.order.merchantAdjustAmount?(n(),y("div",Ko,[s("div",zo,l(h.$t("order.merchant modify price")),1),s("div",Jo,[s("div",Yo,l(o.order.merchantAdjustAmount>0?"+":"-"),1),Zo,s("div",Qo,l(Math.abs(o.order.merchantAdjustAmount)||0),1)])])):m("",!0),o.order.fmGeneralActivity&&o.order.activityReduceAmount?(n(),y("div",Xo,[s("div",er,l(((u=o.order.fmGeneralActivity)==null?void 0:u.name)||"-"),1),s("div",tr,[sr,or,s("div",rr,l(a(re)(o.order.activityReduceAmount)),1)])])):m("",!0),s("div",ar,[s("div",nr,l(h.$t("order.total price actual buyer")),1),s("div",ir,[s("div",lr,[+o.order.paySource===a(Y).USDT_WALLET?(n(),y("div",dr,[ur,P(" "+l(a(re)(a(x))),1)])):(n(),y("div",cr,[mr,s("span",null,l(a(re)(a(p))),1)])),a(t)>0&&o.order.paySource==a(Y).WITHDRAW_POINTS?(n(),y(ne,{key:2},[fr,hr,P(" "+l(a(re)(a(t))),1)],64)):m("",!0)])])]),s("div",yr,[s("div",vr,l(h.$t("common.ratio")),1),s("div",pr,[s("div",br,l(a(f))+"%",1)])]),s("div",wr,[s("div",xr,l(h.$t("order.hash")),1),o.order.hash?(n(),y("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${a(E).chainConfig.blockExplorerUrls[0]}/tx/${o.order.hash}`},[P(l(a(Ke)(o.order.hash,"***",9,5)||"--")+" ",1),Tr],8,gr)):(n(),y("span",$r," -- "))]),s("div",Ar,[s("div",kr,l(h.$t("order.orderAddress")),1),s("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:$[0]||($[0]=se=>a(ve)(o.order.address))},[P(l(a(Ke)(o.order.address,"...",5,5))+" ",1),Cr])]),s("div",Sr,[s("div",Rr,l(h.$t("order.payAddress")),1),(A=o.order)!=null&&A.payAddress?(n(),y("div",{key:0,class:"text-b1 text-sm font-normal text-right flex items-center",onClick:$[1]||($[1]=se=>{var oe;return a(ve)((oe=o.order)==null?void 0:oe.payAddress)})},[P(l(a(Ke)((U=o.order)==null?void 0:U.payAddress,"...",5,5))+" ",1),Ir])):(n(),y("div",_r,"--"))]),o.order.createTime?(n(),y("div",Fr,[s("div",Dr,l(h.$t("order.createTime")),1),s("div",Br,l(a(ke)(o.order.createTime)),1)])):m("",!0),o.order.chainCreateTime?(n(),y("div",Nr,[s("div",Pr,l(h.$t("order.chainFinishTime")),1),s("div",Er,l(a(ke)(o.order.chainCreateTime)),1)])):m("",!0),o.order.expressTime?(n(),y("div",Lr,[s("div",Or,l(h.$t("order.expressTime")),1),s("div",jr,l(a(ke)(o.order.expressTime)),1)])):m("",!0),o.order.finishTime?(n(),y("div",Mr,[s("div",Ur,l(h.$t("order.finishTime")),1),s("div",Hr,l(o.order.finishTime?a(ke)(o.order.finishTime):"-"),1)])):m("",!0),o.order.id&&o.order.status!==0?(n(),y("div",qr,[s("div",Gr,l(h.$t("order.orderNumber")),1),s("div",Vr,[s("div",Wr,l(o.order.id),1),s("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:$[2]||($[2]=se=>a(ve)(o.order.id))},zr)])])):m("",!0),o.order.expressCompany?(n(),y("div",Jr,[Yr,s("div",Zr,l(o.order.expressCompany),1)])):m("",!0),o.order.expressNo?(n(),y("div",Qr,[Xr,s("div",ea,[s("div",ta,l(o.order.expressNo),1),s("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:$[3]||($[3]=se=>a(ve)(o.order.expressNo))},oa)])])):m("",!0),(Z=o.order.refundInfo)!=null&&Z.expressCompany?(n(),y("div",ra,[aa,s("div",na,l((be=o.order.refundInfo)==null?void 0:be.expressCompany),1)])):m("",!0),(le=o.order.refundInfo)!=null&&le.expressNo?(n(),y("div",ia,[la,s("div",da,[s("div",ua,l((de=o.order.refundInfo)==null?void 0:de.expressNo),1),s("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:$[4]||($[4]=se=>{var oe;return a(ve)((oe=o.order.refundInfo)==null?void 0:oe.expressNo)})},ma)])])):m("",!0)])])}}},ha={class:"flex justify-between items-center gap-3 mt-5 fixed left-0 right-0 bottom-0 safe-bottom px-3"},ya={key:0,class:"flex justify-between items-center gap-3 w-full"},va={class:"relative w-full flex-1"},pa={class:"relative w-full flex-1"},ba={key:0},wa={props:{order:{type:Object,required:!0},btnLoading:{type:Boolean,default:!1},nowTime:{type:Number,default:0},continuePayLoading:{type:Boolean,default:!1},cancelLoading:{type:Boolean,default:!1},voucherPrice:{type:Number,default:0},forceCancelLoading:{type:Boolean,default:!1},canEdit:{type:Boolean,default:!1},editLoading:{type:Boolean,default:!1},modifyFlag:{type:Boolean,default:!1}},emits:["handleDelay","handleDelayReceipt","handleTo","cancelOrder","continuePay","timeDone","handleExpress","handleSubmitEdit"],setup(o,{emit:b}){const d=o,{t:R}=ie(),C=v(()=>{const u=d.order||{};return u.status===0&&!u.hash}),S=v(()=>{const u=d.order||{},A=d.nowTime;return Ps(u,A)}),N=v(()=>{const u=d.order||{};return Es(u)}),I=v(()=>{const u=d.order||{};return Ze(u)}),x=v(()=>{const u=d.order||{},A=d.nowTime;return Ls(u,A)}),p=v(()=>{const u=d.order||{};return Os(u)}),f=v(()=>{const u=d.order||{},A=d.nowTime;return js(u,A)}),T=v(()=>{const u=d.order||{},A=d.nowTime;return Xe(u,A)}),g=()=>{b("handleExpress")},B=()=>{const u=d.order;b("handleTo",`/refundDetail?id=${u.id}`)},t=()=>{const u=d.order;let A=`/buyerOrderList/refundService?id=${u.id}`;u.creditFlag&&(A+="&type=credit"),b("handleTo",A)},h=()=>{b("handleSubmitEdit")},$=v(()=>{var u;return((u=d.order.modifyInfo)==null?void 0:u.status)===1||d.order.orderPostscriptUpdateReviewId});return(u,A)=>{const U=Ft("VanButton");return n(),y("div",ha,[a(C)?(n(),y("div",ya,[s("div",va,[o.modifyFlag?(n(),_(U,{key:0,round:"",class:"w-full flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",onClick:h,loading:o.editLoading},{default:J(()=>[P(l(u.$t("order.submit modify")),1)]),_:1},8,["loading"])):(n(),_(U,{key:1,round:"",class:"w-full flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:o.btnLoading||o.cancelLoading,disabled:o.continuePayLoading||o.order.hash,onClick:A[0]||(A[0]=Re(Z=>u.$emit("cancelOrder"),["stop"]))},{default:J(()=>[P(l(u.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"]))]),s("div",pa,[o.order.paySource!=a(Y).PIGGY_BANK&&o.order.paySource!=a(Y).WITHDRAW_POINTS?(n(),y("div",ba,[o.order.paySource==a(Y).USDT_WALLET?(n(),_(ze,{key:0,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:a(E).order,token:a(E).USDT,symbol:"USDT",loading:o.btnLoading,approveAmount:Number(o.order.paySource==a(Y).USDT_WALLET?o.order.totalUsdt:0)},null,8,["contract","token","loading","approveAmount"])):m("",!0),o.order.paySource!=a(Y).USDT_WALLET?(n(),_(ze,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:a(E).order,token:a(E).MCOIN,symbol:"mcoin",loading:o.btnLoading,approveAmount:Number(o.order.paySource===a(Y).USDT_WALLET?0:o.order.totalAmount)},null,8,["contract","token","loading","approveAmount"])):m("",!0)])):m("",!0),o.order.paySource==a(Y).WITHDRAW_POINTS&&o.voucherPrice&&o.voucherPrice>0?(n(),_(ze,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:a(E).order,token:a(E).FMCP,symbol:u.$t("voucher.voucher"),loading:o.btnLoading,approveAmount:Number(o.voucherPrice)},null,8,["contract","token","symbol","loading","approveAmount"])):m("",!0),j(U,{round:"",class:"w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:o.order.hash,loading:o.continuePayLoading||o.btnLoading,onClick:A[1]||(A[1]=Re(Z=>u.$emit("continuePay"),["stop"]))},{default:J(()=>[s("span",null,l(u.$t("order.continuePay")),1),j(Et,{class:"inline-block ml-1",startTime:o.order.createTime,duration:15,durationType:"minutes",showZero:!1},null,8,["startTime"])]),_:1},8,["disabled","loading"])])])):m("",!0),a(S)?(n(),y(ne,{key:1},[a($)?a($)?(n(),_(U,{key:1,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:""},{default:J(()=>[P(l(u.$t("order.wait merchant auth modify")),1)]),_:1})):m("",!0):(n(),_(U,{key:0,round:"",class:Dt(["flex-1 text-base h-[46px] rounded-full",o.modifyFlag?"main-btn text-b1":"border-btn gray-btn font-semibold text-b2"]),onClick:h,loading:o.editLoading},{default:J(()=>[P(l(o.modifyFlag?u.$t("order.submit modify apply"):u.$t("order.apply modify order info")),1)]),_:1},8,["class","loading"]))],64)):m("",!0),a(x)?(n(),_(U,{key:2,round:"",class:"flex-1 border-btn gray-btn font-semibold text-b2 text-base h-[46px] rounded-full",onClick:t,loading:o.btnLoading},{default:J(()=>[P(l(u.$t("order.afterSale")),1)]),_:1},8,["loading"])):m("",!0),a(N)?(n(),_(U,{key:3,round:"",class:"flex-1 border-btn gray-btn font-semibold text-b2 text-base h-[46px] rounded-full",onClick:t,loading:o.btnLoading},{default:J(()=>[P(l(u.$t("order.afterSale")),1)]),_:1},8,["loading"])):m("",!0),a(I)?(n(),_(U,{key:4,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:A[2]||(A[2]=Z=>u.$emit("handleDelayReceipt")),loading:o.btnLoading},{default:J(()=>[P(l(u.$t("order.confirmGeted")),1)]),_:1},8,["loading"])):m("",!0),a(f)?(n(),_(U,{key:5,round:"",class:"flex-1 border-btn gray-btn font-semibold text-b2 text-base h-[46px] rounded-full",onClick:B,loading:o.btnLoading},{default:J(()=>[P(l(u.$t("afterSale.After-sales details")),1)]),_:1},8,["loading"])):m("",!0),a(T).disabled?m("",!0):(n(),_(U,{key:6,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:a(T).disabled,onClick:A[3]||(A[3]=Z=>u.$emit("handleForcedRefund")),loading:o.forceCancelLoading},{default:J(()=>[P(l(u.$t("order.forced refund")),1)]),_:1},8,["disabled","loading"])),a(p)?(n(),_(U,{key:7,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:g,loading:o.btnLoading},{default:J(()=>[P(l(u.$t("afterSale.Returned items")),1)]),_:1},8,["loading"])):m("",!0)])}}},xa={key:0,class:"p-3 break-all bg-white rounded-xl"},ga={class:"font-semibold text-base text-b1 flex items-center justify-between"},Ta=s("span",null,"请在",-1),$a={class:"text-[#FF8812] mx-1"},Aa=s("span",null,"内确认收货",-1),ka=s("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后商家可确认收货 ",-1),Ca={key:1,class:"p-3 break-all bg-white rounded-xl"},Sa={class:"font-semibold text-base text-b1 flex items-center justify-between"},Ra=s("div",null,"请及时确认收货",-1),Ia=s("div",{class:"mt-1 font-normal text-sm text-b2"}," 长时间未收货商家可确认收货 ",-1),_a={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone","handleDelay"],setup(o,{emit:b}){const d=o,{t:R}=ie(),C=v(()=>{const g=Zs(d.order.expressTime,d.order.confirmLimit,d.nowTime);return g>0?g:0}),S=v(()=>C.value>0&&!d.order.merchantsConfirm),N=v(()=>{const g=et(d.order.merchantsConfirm,d.nowTime);return g>0?g:0}),I=v(()=>N.value<=0),x=v(()=>{const g=C.value;if(g<=0)return"00天00时00分00秒";const B=Math.floor(g/(1e3*60*60*24)),t=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),h=Math.floor(g%(1e3*60*60)/(1e3*60)),$=Math.floor(g%(1e3*60)/1e3);return`${B.toString().padStart(2,"0")}天${t.toString().padStart(2,"0")}时${h.toString().padStart(2,"0")}分${$.toString().padStart(2,"0")}秒`}),p=k(!0);_e(()=>C.value,(g,B)=>{g>0?p.value=!1:!p.value&&g<=0&&(p.value=!0,b("timeDone"))},{immediate:!0,deep:!0});const f=g=>Pt(g),T=()=>{b("handleDelay")};return(g,B)=>a(S)?(n(),y("div",xa,[s("div",ga,[s("div",null,[Ta,s("span",$a,l(a(x)),1),Aa]),f(o.order)?(n(),y("span",{key:0,class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:T,role:"button"},"延长收货")):m("",!0)]),ka])):a(I)?(n(),y("div",Ca,[s("div",Sa,[Ra,f(o.order)?(n(),y("span",{key:0,class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:T,role:"button"},"延长收货")):m("",!0)]),Ia])):m("",!0)}},Fa={key:0,class:"p-3 break-all bg-white rounded-xl"},Da={class:"font-semibold text-base text-b1 flex items-center justify-between"},Ba=s("span",null,"请在",-1),Na={class:"text-[#FF8812] mx-1"},Pa=s("span",null,"内确认收货",-1),Ea=s("div",{class:"mt-1 font-normal text-sm text-b2"}," 商家已确认收货，倒计时结束后将自动确认收货 ",-1),La={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone","handleDelay"],setup(o,{emit:b}){const d=o,{t:R}=ie(),C=v(()=>{const f=et(d.order.merchantsConfirm,d.nowTime);return f>0?f:0}),S=v(()=>C.value>0),N=v(()=>{const f=C.value;if(f<=0)return"00天00时00分00秒";const T=Math.floor(f/(1e3*60*60*24)),g=Math.floor(f%(1e3*60*60*24)/(1e3*60*60)),B=Math.floor(f%(1e3*60*60)/(1e3*60)),t=Math.floor(f%(1e3*60)/1e3);return`${T.toString().padStart(2,"0")}天${g.toString().padStart(2,"0")}时${B.toString().padStart(2,"0")}分${t.toString().padStart(2,"0")}秒`}),I=k(!0);_e(()=>C.value,(f,T)=>{f>0?I.value=!1:!I.value&&f<=0&&(I.value=!0,b("timeDone"))},{immediate:!0,deep:!0});const x=f=>Pt(f),p=()=>{b("handleDelay")};return(f,T)=>a(S)?(n(),y("div",Fa,[s("div",Da,[s("div",null,[Ba,s("span",Na,l(a(N)),1),Pa]),x(o.order)?(n(),y("span",{key:0,class:"text-sm text-[#FF8812] ml-auto font-normal",onClick:p,role:"button"},"延长收货")):m("",!0)]),Ea])):m("",!0)}},Oa={key:0,class:"p-3 break-all bg-white rounded-xl"},ja={class:"font-semibold text-base text-b1 flex items-center justify-start"},Ma={class:"text-b1"},Ua={key:0},Ha={class:"text-[#FF8812] mx-1"},qa={key:0,class:"mt-1 font-normal text-sm text-b2"},Ga={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["handleExpress","timeDone"],setup(o,{emit:b}){const d=o,{t:R}=ie(),C=v(()=>{var T;const p=new Date((T=d.order.refundInfo)==null?void 0:T.reviewTime).getTime()/1e3;return Qs(p,d.nowTime)}),S=v(()=>C.value>0),N=v(()=>{const p=C.value;if(p<=0)return`00${R("common.seconds")}`;const f=Math.floor(p/(1e3*60*60*24)),T=Math.floor(p%(1e3*60*60*24)/(1e3*60*60)),g=Math.floor(p%(1e3*60*60)/(1e3*60)),B=Math.floor(p%(1e3*60)/1e3);let t="";return f>0&&(t+=`${f}${R("common.day")}`),(T>0||f>0)&&(t+=`${T.toString().padStart(2,"0")}${R("common.hours")}`),(g>0||T>0||f>0)&&(t+=`${g.toString().padStart(2,"0")}${R("common.minutes")}`),t+=`${B.toString().padStart(2,"0")}${R("common.seconds")}`,t}),I=v(()=>{const p=d.order||{};return Ms(p)}),x=k(!0);return _e(()=>C.value,(p,f)=>{p>0?x.value=!1:!x.value&&p<=0&&(x.value=!0,b("timeDone"))},{immediate:!0,deep:!0}),(p,f)=>{const T=Ft("i18n-t");return a(I)?(n(),y("div",Oa,[s("div",ja,[s("span",Ma,[a(S)?(n(),y("span",Ua,[j(T,{keypath:"afterSale.The merchant has agreed to a return and refund Please return the item within x days",tag:"span"},{time:J(()=>[s("span",Ha,l(a(N)),1)]),_:1})])):(n(),y(ne,{key:1},[P(l(p.$t("afterSale.The product is not returned in time the after-sales service will automatically end")),1)],64))])]),a(S)?(n(),y("div",qa,[s("span",null,l(p.$t("afterSale.Refund will be issued after the merchant confirms receipt of the returned goods")),1)])):m("",!0)])):m("",!0)}}},Va={key:0,class:"p-3 break-all bg-white rounded-xl"},Wa={class:"font-semibold text-base text-b1"},Ka={class:"text-b1"},za={class:"mr-1"},Ja={class:"text-[#FF8812] mx-1"},Ya=s("span",null,null,-1),Za={key:0,class:"mt-1 font-normal text-sm text-b2"},Qa=Qe({props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(o,{emit:b}){const d=o,{t:R}=ie(),C=v(()=>x.value.time),S=v(()=>C.value>0),N=v(()=>{const f=C.value;if(f<=0)return`00${R("common.seconds")}`;const T=Math.floor(f/(1e3*60*60*24)),g=Math.floor(f%(1e3*60*60*24)/(1e3*60*60)),B=Math.floor(f%(1e3*60*60)/(1e3*60)),t=Math.floor(f%(1e3*60)/1e3);let h="";return T>0&&(h+=`${T}${R("common.day")}`),(g>0||T>0)&&(h+=`${g.toString().padStart(2,"0")}${R("common.hours")}`),(B>0||g>0||T>0)&&(h+=`${B.toString().padStart(2,"0")}${R("common.minutes")}`),h+=`${t.toString().padStart(2,"0")}${R("common.seconds")}`,h}),I=v(()=>x.value.visible),x=v(()=>{const f=d.order||{},T=d.nowTime||Date.now()/1e3;return Xe(f,T)}),p=k(!0);return _e(()=>C.value,(f,T)=>{f>0?p.value=!1:!p.value&&f<=0&&(p.value=!0,b("timeDone"))},{immediate:!0,deep:!0}),(f,T)=>a(I)?(n(),y("div",Va,[s("div",Wa,[s("span",Ka,[a(S)?(n(),y(ne,{key:0},[s("span",za,l(a(x).title1),1),s("span",Ja,l(a(N)),1)],64)):(n(),y(ne,{key:1},[P(l(a(x).title2),1)],64))]),Ya]),a(S)?(n(),y("div",Za,l(a(x).tips1),1)):m("",!0)])):m("",!0)}}),Xa={key:0},en={class:"p-3 break-all bg-white rounded-xl"},tn={class:"font-semibold text-base text-b1 flex items-center justify-start"},sn=s("div",{class:"mt-1 font-normal text-sm text-b2"},[s("span",null,"款项已退回您的钱包账户")],-1),on={props:{order:{type:Object,required:!0},role:{type:String,required:!1,default:"customer"}},setup(o){const b=o,d=v(()=>{var S;return((S=(b.order||{}).refundInfo)==null?void 0:S.refundStatus)==5}),R=()=>{var S;return((S=(b.order||{}).refundInfo)==null?void 0:S.refundType)==2?"退货退款已完成":"退款已完成"};return(C,S)=>a(d)?(n(),y("div",Xa,[s("div",en,[s("div",tn,[s("span",null,l(R()),1)]),sn])])):m("",!0)}},rn={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},an={class:"font-bold text-base text-b1"},nn={class:"px-3 safe-bottom pt-[50px] flex flex-col gap-3"},ln=Qe({props:{nowTime:null},setup(o){const b=o,{getUserDhKey:d,decryptAddressKey:R,decryptKey:C,cryptoAESWithBuyerSearch:S,encryptAddressKey:N,formatAddressData:I}=Rs(),{t:x}=ie(),p=Ss(),f=Cs(),{reloadStore:T}=Is(),{checkLoginAuth:g}=_s(),B=f.query.id,t=k(null),[h,$]=K(!1),[u,A]=K(!1),[U,Z]=K(!1),[be,le]=K(!1),de=k(null),se=k(!1),oe=e=>{const r=e.target.scrollTop;se.value=r>25},[Lt,tt]=K(!1),[Ot,st]=K(!1),jt=k(null),ue=k(0),[Mt,we]=K(!1),ot=k("");k(0);const De=k(!1),rt=k(0),xe=k(0),at=k(0),nt=k(0),it=k(0),[Ut,ce]=K(!1);k(!1);const{confirm:lt,senderDelay:Ht,submit:qt,senderForceCancel:Gt,senderCancelUnsend:Vt}=Fs(),{pointBalances:Wt,mcoinRate:Kt}=Ye(),{userMerchantCashs:zt,userTotalAmount:Jt}=uo(),Be=k(null),dt=v(()=>Be.value?1/Be.value:1),Ne=k(0),Pe=k([]),me=k(!1),ge=v(()=>ut.value||ct.value),ut=v(()=>{var r;let e=!1;for(let c in{provinceName:"",cityName:"",countyName:"",detailInfo:"",userName:"",telNumber:""})if(((r=t.value)==null?void 0:r.oldUserAddress[c])!=t.value.userAddress[c]){e=!0;break}return e}),ct=v(()=>{var r,c,i;return((c=(r=t.value)==null?void 0:r.oldUserAddress)==null?void 0:c.postscript)!=((i=t.value.userAddress)==null?void 0:i.postscript)}),[Yt,fe]=K(!1),Te=k(""),Ee=k(null),{getAddress:mt,setAddress:Zt}=Nt(),Le=k(!1),X=async()=>{var i,w,D,F,H,z,L,V,W,Q,ee,ye,te,At,kt;if(Le.value)return;Le.value=!0;const e=await to({id:B});Le.value=!1;let r={...(i=e.data)==null?void 0:i.userAddress,postscript:e.data.postscript};if((w=e.data)!=null&&w.userAddress&&(e.data.userAddress.postscript=e.data.postscript),(D=e.data)!=null&&D.userAddress&&((H=(F=e.data)==null?void 0:F.userAddress)!=null&&H.encryptFlag)){const q=await d(e.data.stores.id,(z=e.data)==null?void 0:z.submitMerchantPubKey);q&&(e.data.userAddress=R(e.data.userAddress,q))}if((L=e.data)!=null&&L.shippingHash){const q=await d(e.data.stores.id,(V=e.data)==null?void 0:V.shippingMerchantPubKey);if(q){const Ae=C(e.data.expressNo,q);Ae.hash===e.data.shippingHash&&(e.data.expressNo=Ae.decrypt,e.data.expressCompany=C(e.data.expressCompany,q).decrypt)}}if(!((W=e.data)!=null&&W.userEns)&&((Q=e.data)!=null&&Q.id)&&setTimeout(async()=>{let q=[];q.push(await Qt(x)),q.filter(Ae=>Ae.userEns),q.length&&so({enInfoList:q})}),(ee=e.data.refundInfo)!=null&&ee.shippingHash){const q=await d((ye=e.data.stores)==null?void 0:ye.id,(At=(te=e.data)==null?void 0:te.refundInfo)==null?void 0:At.shippingMerchantPubKey);q&&(e.data.refundInfo.expressNo=C(e.data.refundInfo.expressNo,q).decrypt,e.data.refundInfo.expressCompany=C(e.data.refundInfo.expressCompany,q).decrypt)}(e.data.status===0&&!e.data.hash||e.data.status===1)&&(me.value=!0);let c={...(kt=e.data)==null?void 0:kt.userAddress};t.value={...e.data,oldUserAddress:c,oldEnsUserAddress:r},e.data.orderPostscriptUpdateReviewId&&bs()},Qt=async e=>{var r,c,i,w,D,F,H,z,L;try{let W=((L=[(r=e==null?void 0:e.userAddress)==null?void 0:r.postscript,""+(((c=e==null?void 0:e.userAddress)==null?void 0:c.provinceName)||"")+(((i=e==null?void 0:e.userAddress)==null?void 0:i.cityName)||"")+(((w=e==null?void 0:e.userAddress)==null?void 0:w.countyName)||"")+(((D=e==null?void 0:e.userAddress)==null?void 0:D.detailInfo)||""),(F=e==null?void 0:e.userAddress)==null?void 0:F.telNumber,e==null?void 0:e.address,(H=e==null?void 0:e.stores)==null?void 0:H.storeName,(z=e==null?void 0:e.stores)==null?void 0:z.merchant,e==null?void 0:e.expressNo,e==null?void 0:e.expressCompany].filter(ee=>ee||ee===0))==null?void 0:L.join(""))||"",Q=await S(W);return{id:e.id,userEns:Q}}catch{}},Xt=async()=>{const e=await oo({page:1,size:999,status:2,type:2});e.success&&(Ne.value=e.total,Pe.value=e.data.filter(r=>(!r.merchantsConfirm||et(r.merchantsConfirm,b.nowTime)>0)&&Ze(r)),Ne.value=Pe.value.length)},Oe=k(1),{tradeContributeSelfRate:es}=Ye(),ts=v(()=>{var r;if(!((r=t.value)!=null&&r.orderGoods))return 0;let e=new M(0);return t.value.orderGoods.forEach(c=>{if(+t.value.payType==1&&+c.payType==3||+c.payType!=2&&+c.payType!=3){const i=new M(c.price).times(c.number).minus(c.goodsActivityReduceAmount||0).plus(c.goodsAdjustChangeAmount||0).times(new M(c.discountRatio||0).div(100));e=e.plus(i)}}),e.times(Oe.value).toNumber()}),je=v(()=>{var i;if(!((i=t.value)!=null&&i.orderGoods)||xe.value<=0)return 0;const e=ts.value||0,r=Oe.value;return Math.min(xe.value,new M(e).div(r).times(.5).toNumber())});Ie(async()=>{g(!0)&&(Oe.value=await es())});const ss=async()=>{try{const{balanceOf:e}=ae(E.MCOIN),r=await e();rt.value=+r;const c=await ae(E.FMCP).balanceOf();xe.value=+c;const i=await ae(E.USDT).balanceOf();at.value=+i,nt.value=+await Wt(),await rs()}catch(e){console.error("获取余额失败:",e)}},os=async()=>{try{Be.value=await Kt()}catch(e){console.error("获取汇率失败:",e)}},rs=async()=>{try{const{success:e,result:r}=await zt();if(!e)return;let c=0;const i=+await Jt(),w=r.amounts.map(F=>Ds(F));r.cashIds.map(F=>+F).forEach((F,H)=>{F!==0&&(c=+M(c).plus(w[H]||0).toString())}),it.value=+M(i).minus(c)}catch(e){console.error("获取余额宝余额失败:",e)}},as=()=>{st(!1),X()},Me=e=>{p.push(e)},[ft,Ue]=K(!1),[ns,He]=K(!1),ht=async()=>{He(!0)},is=async()=>{if(ft.value)return;if(t.value.allOrderId&&!(await It({allOrderId:t.value.allOrderId})).data){O.fail("正在确认您的订单状态，请勿重复提交");return}Ue(!0),(await ro({orderId:t.value.id})).success?(O.success(x("common. cancel success")),Ue(!1),p.go(-1),setTimeout(()=>{p.replace({path:"/buyerOrderList",query:{active:-1,type:1}})},50),setTimeout(()=>{location.reload()},100)):Ue(!1)},qe=async(e,r)=>{try{const{allowance:c}=ae(e);return+(await c(r)).result}catch{return 0}},ls=async()=>{var e,r,c;try{const i=(e=t.value)==null?void 0:e.paySource,w=(r=t.value)==null?void 0:r.totalAmount,D=Math.max(((c=t.value)==null?void 0:c.voucherAmount)||0,je.value);if(D&&i==Y.WITHDRAW_POINTS&&await qe(E.FMCP,E.order)<je.value)return O({message:x("common.approve")+x("voucher.voucher"),forbidClick:!0,duration:2e3}),!1;if(i==1){if(rt.value<w)return ce(!0),!1;if(await qe(E.MCOIN,E.order)<w)return O({message:x("common.approve")+"MCOIN",forbidClick:!0,duration:2e3}),!1}else if(i==5){if(at.value<w*dt.value)return ce(!0),!1;if(await qe(E.USDT,E.order)<w*dt.value)return O({message:x("common.approve")+"USDT",forbidClick:!0,duration:2e3}),!1}else if(i==4){if(+M(nt.value).times(.9)<+M(w).minus(D))return ce(!0),!1}else if(i==2&&it.value<w)return ce(!0),!1;return!0}catch{return!1}finally{$(!1),G(!1)}},yt=async()=>{if(await ls())try{if(!t.value.id||!t.value.allOrderId){O.fail(x("order.orderIdError")),G(!1);return}G(!0),await X();const r=await io({allOrderId:t.value.allOrderId,orderId:t.value.id});if(!r.success){G(!1);return}const{allOrderId:c,merchants:i,discounts:w,amounts:D,sources:F,buyer:H}=r.data;if(t.value.allOrderId=c,!(await It({allOrderId:t.value.allOrderId})).data){O.fail("正在确认您的订单状态，请勿重复提交"),G(!1);return}const L=await qt(c,i,w,D,F,H);if(!L.success){G(!1),await X();return}if(O.loading({message:x("order.wait block chain"),forbidClick:!0,duration:0}),await lo({allOrderId:c,hash:L.result.hash,orderId:t.value.id}),O.clear(),jt.value=L.result.hash,!L.result.hash){G(!1);return}let V;const W=async()=>{if(ue.value>=5){G(!1),st(!0),ue.value=0,await X();return}if(V=await Ns(L.result.hash),(V==null?void 0:V.status)===1){G(!1),tt(!0),ue.value=0,setTimeout(()=>{p.go(-1),setTimeout(()=>{p.replace({path:"/buyerOrderList",query:{active:1,type:1}})},50),setTimeout(()=>{location.reload()},100)},1e3);return}setTimeout(async()=>{ue.value++,W()},5e3)};W()}catch{G(!1),ue.value=0}},vt=k(!1),[pt,G]=K(!1),bt=async()=>{var r;if(pt.value)return;G(!0),vt.value=!0;try{await X()}catch{G(!1);return}if(((r=t.value)==null?void 0:r.status)!==0){O.fail("已支付订单，无需重复支付"),G(!1);return}if(wt()){De.value=!0,G(!1);return}await yt()},he=()=>{X()},$e=async()=>{A(!0)},ds=async e=>{if(!h.value){$(!0);try{const c=(await Se({orderIds:e.id})).data.ordIds;if(!(await Ht(c)).success)return;e.delayReceiveFlag=!0,e.confirmLimit=b.nowTime+86400*10,A(!1),O.success(x("order.delaySuccess")),setTimeout(()=>{T.reload()},3e3)}finally{$(!1)}}},us=async e=>{var r;$(!0);try{const i=(await Se({orderIds:e})).data.ordIds,w=await lt(i);if(!w.success||!(await Je({ordIds:i,hash:w.result.hash})).success)return;t.value.status=4,de.value.showToastPop(((r=w.result)==null?void 0:r.logs)||[])||(O.success(x("order.confirmSuccess")),p.replace({path:"/buyerOrderList",query:{active:4,type:1}}),setTimeout(()=>{f.params.refresh="1",p.push("/evaluate-my")},2e3))}finally{$(!1)}},cs=async()=>{Ne.value>1?Z(!0):us(B)},ms=async e=>{const r=e.join();le(!0);try{const i=(await Se({orderIds:r})).data.ordIds,w=await lt(i);if(!w.success||!(await Je({ordIds:i,hash:w.result.hash})).success)return;t.value.status=4,Z(!1),O.success(x("order.confirmSuccess")),p.replace({path:"/buyerOrderList",query:{active:4,type:1}}),setTimeout(()=>{f.params.refresh="1",p.push("/evaluate-my")},2e3)}finally{le(!1)}},fs=()=>{var e,r;((e=f.params)==null?void 0:e.quick)==="quickPay"&&hs(),((r=f.params)==null?void 0:r.quick)==="quickCancel"&&ys()},hs=()=>{O.loading({message:x("order.continuePay"),forbidClick:!0,duration:2e3}),bt()},ys=()=>{ht()},vs=()=>{we(!1),De.value&&(De.value=!1,yt())},wt=()=>{var w,D;if(!((w=t.value)!=null&&w.id))return!1;const e="orderMerchantAdjustMap";let r={};try{r=JSON.parse(localStorage.getItem(e)||"{}")}catch{r={}}const c=r[t.value.id],i=(D=t.value)==null?void 0:D.merchantAdjustAmount;return i&&(c===void 0||c!==String(i))?(sessionStorage.setItem("refreshOrderID",t.value.id.toString()),ot.value="订单金额发生变动，请留意订单信息变化",we(!0),r[t.value.id]=String(i),localStorage.setItem(e,JSON.stringify(r)),!0):!1},Ge=async()=>{p.push({path:"/refundExpress",query:{id:t.value.id}})},[xt,gt]=K(!1),ps=async()=>{if(!xt.value){gt(!0);try{const r=(await Se({orderIds:t.value.id+""})).data.ordIds,i=Ve.value.type===5||Ve.value.type===6||Ve.value.type===8?await Gt(r[0]):await Vt(r[0]);if(!i.success||!(await Je({ordIds:r,hash:i.result.transactionHash})).success)return}catch(e){O(e.message||e)}finally{gt(!1),setTimeout(()=>{X()},3e3)}}},Tt=v(()=>Ze(t.value)),Ve=v(()=>{const e=b.nowTime;return Xe(t.value,e)}),bs=async()=>{var r,c,i,w,D,F,H,z,L,V,W,Q,ee,ye;const e=await ao({id:t.value.orderPostscriptUpdateReviewId});if(e.msg==="success"){if(e.data.oldPostscript&&((r=e.data.oldPostscript)!=null&&r.encryptFlag)){const te=await d((c=t.value.stores)==null?void 0:c.id,t.value.submitMerchantPubKey);te&&(e.data.oldPostscript=R(e.data.oldPostscript,te))}if(e.data.newPostscript&&((i=e.data.newPostscript)!=null&&i.encryptFlag)){const te=await d((w=t.value.stores)==null?void 0:w.id,t.value.submitMerchantPubKey);te&&(e.data.newPostscript=R(e.data.newPostscript,te))}t.value={...t.value,modifyInfo:e.data},t.value.userAddress.id=(D=e.data.newPostscript)==null?void 0:D.addressId,t.value.userAddress.userName=(F=e.data.newPostscript)==null?void 0:F.userName,t.value.userAddress.telNumber=(H=e.data.newPostscript)==null?void 0:H.telNumber,t.value.userAddress.postalCode=(z=e.data.newPostscript)==null?void 0:z.postalCode,t.value.userAddress.provinceName=(L=e.data.newPostscript)==null?void 0:L.provinceName,t.value.userAddress.cityName=(V=e.data.newPostscript)==null?void 0:V.cityName,t.value.userAddress.countyName=(W=e.data.newPostscript)==null?void 0:W.countyName,t.value.userAddress.detailInfo=(Q=e.data.newPostscript)==null?void 0:Q.detailInfo,t.value.userAddress.encryptFlag=(ee=e.data.newPostscript)==null?void 0:ee.encryptFlag,t.value.userAddress.postscript=(ye=e.data.newPostscript)==null?void 0:ye.postscript}},ws=async()=>{var e;mt()&&(t.value.userAddress=mt(),Zt(null)),sessionStorage.getItem("order_remark")&&(t.value.userAddress.postscript=sessionStorage.getItem("order_remark"),sessionStorage.removeItem("order_remark"),(e=Ee.value)==null||e.setRemarkShow(!0))},xs=e=>{t.value.userAddress.postscript=e},We=k(!1),gs=()=>{We.value||(ge.value?t.value.status===0?Te.value=x("order.no pay you can modify"):Te.value=x("order.already pay you modify order info need merchant check"):Te.value=x("order.you no every modify"),fe(!0))},Ts=()=>{fe(!1),$s()},$s=async()=>{var i,w,D,F,H,z,L,V,W,Q;We.value=!0;const e=await d(t.value.stores.id,t.value.submitMerchantPubKey);let r={};e?(r=I(r,{...t.value.userAddress,postscript:t.value.userAddress.postscript},1),r=N(r,e),r.submitHash=r.hash):r=I(r,{...t.value.userAddress,postscript:t.value.userAddress.postscript},0),ut.value||(r={...r,addressId:t.value.addressId,userName:(i=t.value.oldEnsUserAddress)==null?void 0:i.userName,telNumber:(w=t.value.oldEnsUserAddress)==null?void 0:w.telNumber,postalCode:(D=t.value.oldEnsUserAddress)==null?void 0:D.postalCode,provinceName:(F=t.value.oldEnsUserAddress)==null?void 0:F.provinceName,cityName:(H=t.value.oldEnsUserAddress)==null?void 0:H.cityName,countyName:(z=t.value.oldEnsUserAddress)==null?void 0:z.countyName,detailInfo:(L=t.value.oldEnsUserAddress)==null?void 0:L.detailInfo,addressHash:t.value.addressHash,submitHash:(V=t.value.oldEnsUserAddress)==null?void 0:V.hash,encryptFlag:(W=t.value.oldEnsUserAddress)==null?void 0:W.encryptFlag}),ct.value||(r={...r,postscript:t.value.oldEnsUserAddress.postscript});const c=await no({orderId:B,postscript:{storeId:t.value.stores.id,postscript:r.postscript,addressId:r.addressId,userName:r.userName,telNumber:r.telNumber,postalCode:r.postalCode,provinceName:r.provinceName,cityName:r.cityName,countyName:r.countyName,detailInfo:r.detailInfo,addressHash:r.addressHash,submitHash:r.submitHash,encryptFlag:r.encryptFlag}});We.value=!1,c.msg==="success"&&(t.value.status===0?$t("您的订单信息已修改成功","toast-success.svg"):$t("修改申请已提交，请等待商家审核","toast-success.svg"),(Q=Ee.value)==null||Q.setRemarkShow(!1),await X())},$t=(e="",r="toast-warn.svg")=>{O({message:e,icon:Bs(r),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})};return Ie(async()=>{var e,r,c,i;if(g(!0)){if(((e=f.params)==null?void 0:e.quick)==="quickPay"&&O.loading({message:x("order.continuePay"),forbidClick:!0,duration:6e3}),Xt(),await X(),await ws(),await ss(),await os(),((r=t.value)==null?void 0:r.paySource)==Y.WITHDRAW_POINTS){const w=await ae(E.FMCP).balanceOf();xe.value=+w}((c=t.value)==null?void 0:c.status)===0&&!((i=f.params)!=null&&i.quick)&&wt(),fs()}}),(e,r)=>{var c;return n(),y("div",{class:"app-container font-Puhui main-bg safe-bottom-page",onScroll:oe},[s("section",{class:Dt(["header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md transition-all duration-300",{"bg-white":se.value}])},[s("div",rn,[j(eo)]),s("div",an,[s("span",null,l(e.$t("order.orderDetail")),1)])],2),t.value?(n(),y(ne,{key:0},[s("section",nn,[t.value.status===0&&!t.value.hash?(n(),_(Po,{key:0,order:t.value,canEdit:me.value,onTimeDone:he,onHandleTo:Me},null,8,["order","canEdit"])):m("",!0),a(Tt)?(n(),_(_a,{key:1,order:t.value,nowTime:o.nowTime,onTimeDone:he,onHandleDelay:$e},null,8,["order","nowTime"])):m("",!0),a(Tt)?(n(),_(La,{key:2,order:t.value,nowTime:o.nowTime,onTimeDone:he,onHandleDelay:$e},null,8,["order","nowTime"])):m("",!0),j(Qa,{order:t.value,nowTime:o.nowTime,onTimeDone:he},null,8,["order","nowTime"]),j(Ga,{order:t.value,nowTime:o.nowTime,onHandleExpress:Ge,onTimeDone:he},null,8,["order","nowTime"]),j(Us,{order:t.value,nowTime:o.nowTime,onHandleExpress:Ge,onHandleDelay:$e},null,8,["order","nowTime"]),j(on,{order:t.value},null,8,["order"]),t.value.userAddress?(n(),_(Ao,{key:3,order:t.value,canEdit:me.value,nowTime:o.nowTime,showCopy:!1,onHandleTo:Me},null,8,["order","canEdit","nowTime"])):m("",!0),j(Hs,{order:t.value,"show-price":!1,"show-shipping-template":!0},null,8,["order"]),t.value.status===0||t.value.status===1?(n(),_(St,{key:4,ref:(i,w)=>{w.remarkRef=i,Ee.value=i},order:t.value,isBuyer:"",canEdit:me.value,nowTime:o.nowTime,onSetFormRemark:xs},null,8,["order","canEdit","nowTime"])):m("",!0),t.value.status===0&&!t.value.hash?(n(),_(qs,{key:5,order:t.value,isBuyer:""},null,8,["order"])):m("",!0),t.value.status===0&&!t.value.hash?m("",!0):(n(),_(fa,{key:6,order:t.value},null,8,["order"])),t.value.status!==0&&t.value.status!==1?(n(),_(St,{key:7,order:t.value,isBuyer:""},null,8,["order"])):m("",!0),t.value.id&&t.value.status===0&&!t.value.hash?(n(),_(Gs,{key:8,order:t.value},null,8,["order"])):m("",!0),t.value.status==0&&t.value.hash?m("",!0):(n(),_(wa,{key:9,voucherPrice:a(je),order:t.value,btnLoading:a(h),cancelLoading:a(ft),continuePayLoading:a(pt),nowTime:o.nowTime,forceCancelLoading:a(xt),canEdit:me.value,modifyFlag:a(ge),onHandleDelay:$e,onHandleDelayReceipt:cs,onHandleTo:Me,onCancelOrder:ht,onContinuePay:bt,onHandleForcedRefund:ps,onHandleExpress:Ge,onHandleSubmitEdit:gs},null,8,["voucherPrice","order","btnLoading","cancelLoading","continuePayLoading","nowTime","forceCancelLoading","canEdit","modifyFlag"]))]),j(Ce,{show:a(u),title:e.$t("order.delayConfirm"),content:e.$t("order.delayTips"),showConfirm:!0,showReject:!0,confirmText:e.$t("common.confirm"),rejectText:e.$t("common.cancel"),noClose:"",onClose:r[0]||(r[0]=i=>a(A)(!1)),onReject:r[1]||(r[1]=i=>a(A)(!1)),onConfirm:r[2]||(r[2]=i=>ds(t.value))},null,8,["show","title","content","confirmText","rejectText"]),j(Vs,{loading:a(be),show:a(U),list:Pe.value,currentId:+a(B),onClose:r[3]||(r[3]=i=>a(Z)(!1)),onReceipt:ms},null,8,["loading","show","list","currentId"]),j(Ws,{ref:(i,w)=>{w.voucherConfirmRef=i,de.value=i},onReload:r[4]||(r[4]=i=>a(T).reload()),onHandleTo:r[5]||(r[5]=()=>{a(p).push("/voucher?active=1")})},null,512),a(Lt)?(n(),_(Rt,{key:0,onClose:r[6]||(r[6]=i=>a(tt)(!1)),text:e.$t("common.pay success")},null,8,["text"])):m("",!0),a(Ot)?(n(),_(Rt,{key:1,isError:!0,onClose:as,text:e.$t("order.fail")},null,8,["text"])):m("",!0),j(Xs,{paySource:+((c=t.value)==null?void 0:c.paySource),show:a(Ut),onClose:r[7]||(r[7]=i=>a(ce)(!1))},null,8,["paySource","show"]),j(Ce,{show:a(Mt),title:e.$t("common.tip"),content:ot.value,showConfirm:!0,showReject:vt.value,confirmText:e.$t("common.confirm"),noClose:"",onClose:r[8]||(r[8]=i=>a(we)(!1)),onConfirm:vs,onReject:r[9]||(r[9]=i=>a(we)(!1))},null,8,["show","title","content","showReject","confirmText"]),j(Ce,{show:a(Yt),title:e.$t("common.tip"),content:Te.value,showConfirm:!0,showReject:a(ge),confirmText:e.$t("common.confirm"),rejectText:e.$t("common.cancel"),noClose:"",onClose:r[10]||(r[10]=i=>a(fe)(!1)),onConfirm:r[11]||(r[11]=i=>a(ge)?Ts():a(fe)(!1)),onReject:r[12]||(r[12]=i=>a(fe)(!1))},null,8,["show","title","content","showReject","confirmText","rejectText"]),j(Ce,{show:a(ns),title:e.$t("order.cancelOrder"),content:e.$t("order.cancelOrderTips"),showConfirm:!0,showReject:!0,confirmText:e.$t("common.confirm"),rejectText:e.$t("common.cancel"),noClose:"",onClose:r[13]||(r[13]=i=>a(He)(!1)),onConfirm:is,onReject:r[14]||(r[14]=i=>a(He)(!1))},null,8,["show","title","content","confirmText","rejectText"])],64)):m("",!0)],32)}}}),On=_t(ln,[["__scopeId","data-v-8f89930e"]]);export{On as default};
