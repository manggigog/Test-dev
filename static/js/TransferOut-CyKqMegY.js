import{_ as me,z as ve,x as ge,a2 as j,r as i,bl as fe,y as he,E as xe,G as k,H as v,I as s,U as h,Z as I,P as B,Q as c,N as Z,a4 as ye,O as t,$ as Q,F as U,X as be,Y as _e,B as p,bZ as we,T as Ce}from"./vendor-Dr_RpJ_Y.js";import{N as R,_ as ke}from"./NumberKeyBoardInput-DCFXxH3d.js";import{B as Ie}from"./BackIcon-CDrGaEPo.js";import{e as x,G as V,j as J,g as W,k as A,cl as Be,K as Ae}from"./index-BckdT6oc.js";import{a as Fe}from"./storeValue-IjZb7Yt0.js";import{p as $e}from"./piggyBank-u8s6wp9e.js";import{_ as Ee}from"./EmptyTipsPop-DFfFg0cQ.js";import"./close-BkqxFSX4.js";const Me=F=>(be("data-v-9de7ecda"),F=F(),_e(),F),Ve={class:"px-3 bg-[#f2f0ef]"},Se={class:"gap-2 mt-2 flex-start"},Ne={class:"mt-2.5 flex"},Te={class:"absolute top-1/2 left-1/2 translate-x-[-56%] translate-y-[-50%] text-black z-50"},Le={class:"absolute top-1/2 left-1/2 translate-x-[-46%] translate-y-[-50%] text-black z-50"},Oe={key:0,class:"bg-white mt-2.5 p-4 rounded-xl text-[#2E2008]"},ze={class:"flex justify-between text-xs opacity-60"},je={class:"flex items-center"},Ue={key:1},Pe={class:"bg-[#FFF8EC] rounded-xl px-0.5 pr-2.5 py-2 mt-4 flex justify-between items-center w-full relative"},qe=["src"],De={class:"text-[#2E2008] text-base"},Xe={key:1,class:"mt-2.5 rounded-2xl wallet-bg p-4 text-[#2E2008"},Ye={class:"text-base opacity-60"},Ge={class:"bg-[#FFF8EC] rounded-xl p-2.5 mt-4"},He={class:"text-sm opacity-40"},Ke={class:"mt-1.5"},Ze={key:2,class:"bg-white mt-2.5 p-4 rounded-xl text-[#2E2008]"},Qe={class:"flex justify-between text-xs opacity-60"},Re={class:"bg-[#FFF8EC] rounded-xl px-0.5 pr-2.5 py-2 mt-4 flex justify-between items-center w-full relative"},Je={class:"flex-center"},We=["src"],et=Me(()=>s("div",{class:"w-[1px] h-[15px] bg-[#EBEBEB] mx-2"},null,-1)),tt={class:"bg-[#F9F9F9] rounded-xl py-2 px-2.5 mt-4"},at={class:"text-[#2E2008] text-base"},st=ve({setup(F){const{t:P}=ge(),{userIds:q,userMerchantCashs:ee,withdraw:te,pending:ae,transfer:se}=$e(),[D,X]=j(!1),f=i(0),Y=e=>{e!==f.value&&(f.value=e,u.value=null,g.value=null)},m=fe({address:"",remark:""}),[le,S]=j(!1),oe=async()=>{var a;let e=u.value;g.value&&(e=u.value>=x((a=l.value)==null?void 0:a.accountAmount)?g.value:u.value),E(!0);try{if(m.address=m.address.replace(/ +/g,"").replace(/[\r\n]/g,""),!we(m.address))return Ce(P("errorMsg.invalid address"));let d={success:!1};try{d=await se(Be(m.address),e,b.value,m.remark)}catch(r){Ae(r)}if(!d.success)return;u.value=null,g.value=null,T.value=null,w.value=null,C.value=null,L.value=null,m.address="",m.remark="",S(!0),z()}finally{E(!1),setTimeout(()=>{S(!1)},2e3)}},G=i(null),ne=async()=>{G.value=p(await J(W.MCOIN).balanceOf()).toString()},u=i(null),y=i([]),b=i(0),l=he(()=>y.value&&y.value.length>0?y.value.find(e=>e.storedCardId===b.value):{}),re=e=>{b.value=e,u.value=null,g.value=null,X(!1)},g=i(null),$=()=>{var e,a,d;g.value=(((e=l.value)==null?void 0:e.accountAmount)||0)+"",u.value=(a=l.value)!=null&&a.accountAmount?x((d=l.value)==null?void 0:d.accountAmount)+"":""},[H,E]=j(!1),ue=async()=>{var a;let e=u.value;g.value&&(e=u.value>=x((a=l.value)==null?void 0:a.accountAmount)?g.value:u.value),E(!0);try{if(!(await te(_.value+"",e,b.value+"")).success)return;u.value=null,g.value=null,T.value=null,w.value=null,C.value=null,L.value=null,z()}finally{E(!1)}},_=i(0),de=async()=>{const e=await q();_.value=+e,_.value&&await ce()},N=i({}),M=i([]),ce=async()=>{C.value="0";const{success:e,result:a}=await ee(_.value+"");if(e){const d=a.amounts.map(o=>V(o)),r=a.cashIds.map(o=>+o);r.forEach((o,n)=>{N.value[o]=d[n],o===0?w.value=p(w.value||0).plus(d[n]||0).toString():(M.value.push(r[n]),C.value=p(C.value||0).plus(p(d[n]||0)).toString())})}},T=i("0"),w=i("0"),C=i("0"),L=i("0"),ie=async()=>{const e=await q();_.value=e;const a=await ae(e.toString());let d="0";a.fixs.forEach(n=>{d=p(d).plus(p(V(n)||0)).toString()});let r="0";a.floats.forEach(n=>{r=p(r).plus(V(n)||0).toString()});let o="0";a.records.forEach(n=>{o=p(n.amount).plus(V(n.amount)||0).toString()}),T.value=new p(r).plus(new p(d)).plus(new p(o)).toString()},pe=async()=>{var a,d;y.value=[];const e=[];if(M.value&&M.value.length>0){const r=await Fe(M.value.join(","));for(let o=0;o<((a=r.data)==null?void 0:a.length);o++){if(!r.data[o].contract)continue;const n=p(await J(r.data[o].contract).balanceOf()).toString();let K=0;N.value[r.data[o].storedCardId||r.data[o].id]&&(K=N.value[r.data[o].storedCardId||r.data[o].id]),e.push({...r.data[o],storedCardId:r.data[o].storedCardId||r.data[o].id,walletShowName:r.data[o].shopName,quota:n,accountAmount:K})}}e.unshift({storedCardId:0,shopName:P("piggy.My_purse"),walletShowName:"Mcoin",quota:G.value,symbol:"MCOIN",symbolLogo:A("images/ecology/wallet.png"),contract:W.MCOIN,accountAmount:(d=p(w.value||0).plus(p(L.value||0)))==null?void 0:d.toString()}),y.value=e},O=i(!1),z=async()=>{O.value=!0,await ie(),await ne(),await de(),O.value=!1,pe()};return xe(()=>{z()}),(e,a)=>{const d=U("VanLoading"),r=U("VanButton"),o=U("van-field");return v(),k("div",Ve,[s("div",Se,[B(Ie),s("div",null,c(e.$t("piggy.Lightning Yuâ€™E Bao")),1)]),s("div",Ne,[s("div",{class:"relative w-1/2 overflow-hidden rounded-md",onClick:a[0]||(a[0]=n=>Y(0))},[s("div",{class:Z(["text-center trapezoid-t",{"trapezoid-t-active":f.value===0}])},null,2),s("div",Te,c(e.$t("piggy.TransferTYourself")),1)]),s("div",{class:"relative w-1/2 overflow-hidden rounded-md",onClick:a[1]||(a[1]=n=>Y(1))},[s("div",{class:Z(["text-center trapezoid-b",{"trapezoid-b-active":f.value===1}])},null,2),s("div",Le,c(e.$t("piggy.transferToOthers")),1)])]),f.value===0?(v(),k("div",Oe,[s("div",ze,[s("span",null,c(e.$t("piggy.Transfer_amount")),1),s("span",je,[ye(c(e.$t("piggy.Account_Balance"))+" ",1),O.value?(v(),I(d,{key:0,size:"18"})):(v(),k("span",Ue,c(t(l)&&t(x)(t(l).accountAmount||0,4))+" "+c(t(l)&&t(l).symbol),1))])]),s("div",Pe,[s("img",{class:"w-6 h-6 ml-2.5 mr-1",src:t(l).storedCardId?t(l).symbolLogo||t(A)("images/piggyBank/default-token.png"):t(A)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,qe),B(R,{class:"py-1.5 flex-1 bg-[#FFF8EC] text-lg font-bold text-[#2E2008]",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=n=>u.value=n),placeholder:"0",reg:/^\d+(\.\d{0,2})?$/,max:t(l)&&t(x)(t(l).accountAmount),onMaxInput:$,customMax:!0},null,8,["modelValue","reg","max"]),s("div",{class:"px-1.5 py-0.5 border-[1px] border-[#FBA923] border-solid rounded text-xs text-[#FBA923] font-medium absolute right-2.5",onClick:$}," MAX ")]),t(l)&&t(l).contract?(v(),I(r,{key:0,onClick:ue,loading:t(H),disabled:u.value<=0||+t(l).accountAmount<u.value,class:"btn mt-5 mb-1.5 block font-semibold bg-[#FED73A] h-[50px] w-full px-4 rounded-3xl text-base text-center leading-[50px]"},{default:Q(()=>[s("span",De,c(e.$t("piggy.Confirm_transfer_out")),1)]),_:1},8,["loading","disabled"])):h("",!0)])):h("",!0),f.value===1?(v(),k("div",Xe,[s("div",Ye,c(e.$t("piggy.TransferOtherBao")),1),s("div",Ge,[s("div",He,c(e.$t("home.receiveAddress")),1),s("div",Ke,[B(o,{rows:"1",autosize:{maxHeight:48},size:"large",class:"value","input-align":"left",modelValue:t(m).address,"onUpdate:modelValue":a[3]||(a[3]=n=>t(m).address=n),type:"textarea",placeholder:e.$t("shop.pleaseInput")+e.$t("home.receiveAddress")},null,8,["modelValue","placeholder"])])])])):h("",!0),f.value===1?(v(),k("div",Ze,[s("div",Qe,[s("span",null,c(e.$t("piggy.Transfer_amount")),1),s("span",null,c(e.$t("piggy.Account_Balance"))+c(t(l)&&t(x)(t(l).accountAmount||0,4))+" "+c(t(l)&&t(l).symbol),1)]),s("div",Re,[s("div",Je,[s("img",{class:"w-6 h-6 ml-2.5 rounded-full",src:t(l).storedCardId?t(l).symbolLogo||t(A)("images/piggyBank/default-token.png"):t(A)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,We),et]),B(R,{class:"py-1.5 flex-1 bg-[#FFF8EC] text-lg font-bold text-[#2E2008]",modelValue:u.value,"onUpdate:modelValue":a[4]||(a[4]=n=>u.value=n),placeholder:"0",reg:/^\d+(\.\d{0,2})?$/,max:t(l)&&t(x)(t(l).accountAmount),onMaxInput:$,customMax:!0},null,8,["modelValue","reg","max"]),s("div",{class:"px-1.5 py-0.5 border-[1px] border-[#FBA923] border-solid rounded text-xs text-[#FBA923] font-medium absolute right-2.5",onClick:$}," MAX ")]),s("div",tt,[B(o,{maxlength:"20",rows:"1",autosize:"",type:"textarea",modelValue:t(m).remark,"onUpdate:modelValue":a[5]||(a[5]=n=>t(m).remark=n),colon:"",label:e.$t("order.remark"),placeholder:e.$t("shop.pleaseInput")+e.$t("order.remark"),"input-align":"right"},null,8,["modelValue","label","placeholder"])]),t(l)&&t(l).contract?(v(),I(r,{key:0,onClick:oe,loading:t(H),disabled:u.value<=0||+t(l).accountAmount<u.value||!t(m).address,class:"btn mt-5 mb-1.5 block font-semibold bg-[#FED73A] h-[50px] w-full px-4 rounded-3xl text-base text-center leading-[50px]"},{default:Q(()=>[s("span",at,c(e.$t("piggy.Confirm_transfer_out")),1)]),_:1},8,["loading","disabled"])):h("",!0)])):h("",!0),t(D)?(v(),I(ke,{key:3,field:"accountAmount",currentTag:f.value,list:y.value,id:b.value,onClose:a[6]||(a[6]=n=>t(X)(!1)),onSelectCard:re,show:t(D)},null,8,["currentTag","list","id","show"])):h("",!0),t(le)?(v(),I(Ee,{key:4,onClose:a[7]||(a[7]=n=>t(S)(!1)),text:e.$t("common.Transfer_successful")},null,8,["text"])):h("",!0)])}}}),pt=me(st,[["__scopeId","data-v-9de7ecda"]]);export{pt as default};
