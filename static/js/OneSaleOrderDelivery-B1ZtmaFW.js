import{z as C,F as $,G as c,H as d,P as f,I as e,Q as o,O as n,_ as B,q as T,a2 as P,bl as F,U as S,Z as V,$ as H,a4 as M,o as U,r as G,E as R,J as A}from"./vendor-Dr_RpJ_Y.js";import{_ as O}from"./mcoin-logo-1-Deho8IWN.js";import{h as j}from"./useOrderStatus-Ch6Txdaf.js";import{r as q,V as D,bu as E,a as L,bp as z}from"./index-LRhcxFAI.js";import{l as K}from"./luckyShopContract-BBm_z_ss.js";import{B as J}from"./BackIcon-CDrGaEPo.js";const Q={class:"gap-2 mt-3 flex-center-bw"},Z={class:"flex flex-col justify-between flex-1 h-20"},W={class:"font-semibold flex-center-bw"},X=e("div",{class:"flex items-baseline gap-1 text-primary"},[e("img",{src:O,class:"w-3 h-3",alt:""}),e("span",null,"0"),e("span",{class:"text-xs"},"Mcoin")],-1),Y={class:"font-semibold text-primary flex-center-bw"},ee=e("div",{class:"opacity-60 text-default"},"x1",-1),se={class:"flex justify-end opacity-60"},te=C({props:{order:null},setup(r){const{order:p}=r,v=j();return(l,x)=>{const m=$("VanImage");return d(),c("div",Q,[f(m,{src:r.order.goodsMainImageUrls.split(",")[0],class:"w-20 h-20 overflow-hidden rounded-xl",fit:"cover",alt:""},null,8,["src"]),e("div",Z,[e("div",null,[e("div",W,[e("div",null,o(r.order.goodsTitle),1),X]),e("div",Y,[e("div",null,o(n(v)[r.order.commitStatus+""]),1),ee])]),e("div",se,o(l.$t("order.deliveryTime"))+" "+o(r.order.shippingTime&&n(q)(r.order.shippingTime)||"-"),1)])])}}}),oe={class:"px-3 py-4 mt-3 bg-white rounded-xl"},ae={class:"flex-center-bw"},re={class:"opacity-60"},ie={class:"mt-3 flex-center-bw"},ne={class:"opacity-60"},de={key:1,class:"text-right"},le={class:"mt-3 flex-center-bw"},ce={class:"opacity-60"},pe={key:1,class:"text-right"},me={key:0,class:"mt-5 flex-center"},ue=C({props:{order:null},setup(r){const p=r,{getMerchantDhKey:v,encryptKey:l}=D(),x=T(),{merchantComfirmSent:m}=K(),[w,_]=P(!1),s=F({expressCompany:"",expressNo:"",id:p.order.id}),g=async()=>{var u;const a=await v((u=p.order)==null?void 0:u.address);let t={expressCompany:s.expressCompany,expressNo:s.expressNo,id:s.id,shippingHash:null};if(a){const i=l(s.expressNo,a);t.expressNo=i.encrypt,t.shippingHash=i.hash;const b=l(s.expressCompany,a);t.expressCompany=b.encrypt}_(!0),(await E(t)).success&&(await m(p.order.odGoodsId)).success&&x.back(),_(!1)};return(a,t)=>{const y=$("VanField"),u=$("VanButton");return d(),c("div",null,[e("div",oe,[e("div",ae,[e("div",re,o(a.$t("order.deliveryType")),1),e("div",null,o(a.$t("order.deliveryMyself")),1)]),e("div",ie,[e("div",ne,o(a.$t("order.deliveryId")),1),r.order.commitStatus===30?(d(),V(y,{key:0,class:"flex-1","input-align":"right",modelValue:n(s).expressNo,"onUpdate:modelValue":t[0]||(t[0]=i=>n(s).expressNo=i),placeholder:a.$t("shop.pleaseInput")},null,8,["modelValue","placeholder"])):(d(),c("div",de,o(r.order.expressNo),1))]),e("div",le,[e("div",ce,o(a.$t("order.deliveryCompany")),1),r.order.commitStatus===30?(d(),V(y,{key:0,class:"flex-1","input-align":"right",modelValue:n(s).expressCompany,"onUpdate:modelValue":t[1]||(t[1]=i=>n(s).expressCompany=i),placeholder:a.$t("shop.pleaseInput")},null,8,["modelValue","placeholder"])):(d(),c("div",pe,o(r.order.expressCompany),1))])]),r.order.commitStatus===30?(d(),c("div",me,[f(u,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",loading:n(w),disabled:!n(s).expressNo||!n(s).expressCompany,onClick:g},{default:H(()=>[M(o(a.$t("order.Ship")),1)]),_:1},8,["loading","disabled"])])):S("",!0)])}}}),he=B(ue,[["__scopeId","data-v-3f7112b0"]]),ve={class:"px-3 bg-[#f2f0ef]"},ye={class:"gap-2 mt-2 flex-start"},fe={class:"px-3 py-4 mt-3 bg-white rounded-xl"},xe={class:"flex-center-bw"},_e={class:"opacity-60"},be={class:"font-semibold"},ge={class:"break-all"},$e={class:"mt-4 text-base font-semibold text-black"},Ce={class:"mt-1 opacity-60"},De=C({setup(r){const{commodities:p}=K(),{orderGoodsStore:v}=L(),{getMerchantDhKey:l,decryptAddressKey:x,decryptKey:m}=D(),_=U().query.id,s=G(null),g=async()=>{var i,b,N,k;const a=v.orderGood.id||_,t=await z({id:a}),y=["receiverCity","receiverCounty","receiverDetailInfo","receiverProvince","receiverPhone","receiver","postscript"];if((i=t.data)!=null&&i.submitHash){const h=await l((b=t.data)==null?void 0:b.address,(N=t.data)==null?void 0:N.submitUserPubKey);h&&(t.data=x(t.data,h,y))}if(t.data.shippingHash){const h=await l(t.data.address,(k=t.data)==null?void 0:k.shippingUserPubKey);if(h){const I=m(t.data.expressNo,h);I.hash===t.data.shippingHash&&(t.data.expressNo=I.decrypt,t.data.expressCompany=m(t.data.expressCompany,h).decrypt)}}s.value=t.data;const u=await p(s.value.odGoodsId);s.value.commitStatus=u.status};return R(async()=>{g()}),(a,t)=>(d(),c("div",ve,[e("div",ye,[f(J),e("div",null,o(a.$t("order.deliver")),1)]),s.value?(d(),c(A,{key:0},[e("div",fe,[e("div",xe,[e("div",_e,o(a.$t("order.orderNumber")),1),e("div",be,o(s.value.id),1)]),f(te,{order:s.value},null,8,["order"]),e("div",ge,[e("div",$e,o(s.value.receiverProvince??"")+o(s.value.receiverCity)+" "+o(s.value.receiverCounty)+o(s.value.receiverDetailInfo),1),e("div",Ce,o(s.value.receiver)+o(s.value.receiverPhone),1)])]),f(he,{order:s.value},null,8,["order"])],64)):S("",!0)]))}});export{De as default};
