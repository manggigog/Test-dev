import{_ as Q,y as M,bw as ae,r as p,z as Te,E as V,K as E,G as r,N as S,H as s,Q as d,O as h,a2 as $,a0 as U,P as t,be as $e,bp as ke,F as k,R as Se,a4 as R,Y as Ce,Z as Ie,bA as Ve,a8 as Ge,x as J,w as De,l as Fe,bf as Be,D as Ee,bh as Le,bj as Pe,I as ee,J as oe}from"./vendor-BUT0HZ5j.js";import{_ as _e,e as ne,u as ze}from"./index-hbwLMIYO.js";import{E as Oe}from"./EmptyTipsPop-B_UXoETD.js";import{_ as Re}from"./MCOIN-BcbOHmhy.js";import{_ as Ue}from"./ShopMaskTips-dKZ6_BUi.js";import{S as te}from"./shop-CeqcS6K2.js";import{S as qe}from"./SearchBox-UBMJTZli.js";import{B as Ae}from"./BackIcon-biFt6cm7.js";import{C as Ne}from"./ChangeRegion-D4QJkV6_.js";import{a as He,b as se,q as Me}from"./goods-ByZyWFLe.js";import{b as je}from"./mall-BLN1rOb_.js";import{D as Ke}from"./goods-BVwS8oFG.js";import"./search-Dwmdj_3F.js";import"./filter-B5MATEpa.js";import"./category-gHFe9XPA.js";import"./ChangeRegionPop-rzLGq3Y4.js";const Ze={class:"pt-8 pb-5 text-base text-center text-black"},Je={class:"px-8"},Qe={class:"py-1 border border-solid border-black-100"},Ye={class:"flex pt-8"},We=M({props:{show:{type:Boolean},text:null,inputTips:null,discountConfig:null,type:null},emits:["close","confirm","cancle"],setup(e,{emit:T}){const C=e,[G,D]=ae(!1),y=p(null),g=i=>i>30?"30":i||"";Te(()=>C.show,i=>{i&&(y.value=null)},{deep:!0});const f=()=>{if(y.value<C.discountConfig[0]||y.value>C.discountConfig[1]){D(!0);return}T("confirm",y,C.type),y.value=null};return(i,m)=>{const v=V("van-field"),n=V("van-button");return r(),E(_e,{width:"90%",show:e.show,name:i.$t("common.tip"),onClose:m[3]||(m[3]=()=>{T("close")})},{default:S(()=>[s("div",Ze,[s("div",null,d(e.text),1)]),s("div",Je,[s("div",Qe,[h(v,{class:"bg-[#FEFFF9]",modelValue:y.value,"onUpdate:modelValue":m[0]||(m[0]=x=>y.value=x),"input-align":"center",type:"digit",autocomplete:"off",placeholder:e.inputTips,formatter:g},null,8,["modelValue","placeholder"])])]),s("div",Ye,[h(n,{class:"plain-btn w-1/2 mx-2.5 text-[#FEA021] font-semibold",onClick:m[1]||(m[1]=()=>{T("close")})},{default:S(()=>[U(d(i.$t("common.cancel")),1)]),_:1}),h(n,{class:"w-1/2 mx-2.5 btn-orange btn-shadow text-white font-semibold",onClick:f},{default:S(()=>[U(d(i.$t("common.confirm")),1)]),_:1}),t(G)?(r(),E(Oe,{key:0,onClose:m[2]||(m[2]=x=>t(D)(!1)),text:e.inputTips},null,8,["text"])):$("",!0)])]),_:1},8,["show","name"])}}}),Xe=Q(We,[["__scopeId","data-v-9121d12e"]]),eo="/Test-dev/static/images/Subtract-DbxtK3SD.png",le=e=>(Ce("data-v-54047e1f"),e=e(),Ie(),e),oo={class:"relative mb-3 text-sm bg-white rounded-xl text-default"},to={class:"flex gap-2 px-4 py-3 relative border-b border-solid border-[#F9F8F5]"},so={class:"relative w-[60px] h-[60px]"},ao={key:0,class:"absolute top-0 left-0 z-10"},no={class:"subtract-text"},lo=le(()=>s("img",{class:"w-[33px] h-[33px]",src:eo},null,-1)),io={class:"flex flex-col flex-1 h-[60px] justify-between"},ro={class:"flex items-start"},uo={class:"mr-1 line-clamp-2"},co={key:0,class:"ml-auto mr-2 text-xs opacity-60 min-w-fit"},po={class:"flex items-center"},fo=le(()=>s("img",{src:Re,class:"w-4 h-4 mr-1.5"},null,-1)),vo={class:"flex items-baseline"},mo={class:"mr-1"},go={class:"relative flex justify-end gap-3 px-4 py-2 text-xs"},ho={class:"flex items-center justify-center gap-1"},yo={key:0,class:"absolute z-50 py-3 text-center right-0 transform-pop px-3.5 top-7 no-wrap"},xo=M({props:{goods:null,index:null,shopType:null},emits:["handleTo","handleDown","handleUp","handleDel","toFeatured"],setup(e,{emit:T}){const{accountStore:C}=ne(),[G,D]=$e(!1),y=p(null);return ke(y,()=>D(!1)),(g,f)=>{var n;const i=V("VanImage"),m=V("VanButton"),v=V("van-icon");return r(),k("div",oo,[s("div",to,[s("div",so,[e.goods.type!==t(te).SD?(r(),k("div",ao,[s("div",no,d(g.$t(`common.shop_type_${(n=e.goods)==null?void 0:n.type}`)),1),lo])):$("",!0),e.goods.status!=1||!+e.goods.stock?(r(),E(Ue,{key:1,status:e.goods.status,stock:e.goods.stock},null,8,["status","stock"])):$("",!0),h(i,{src:e.goods.icons&&e.goods.icons.split(",")[0],class:"w-[60px] h-[60px] rounded-md overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),s("div",io,[s("div",ro,[s("div",uo,d(e.goods.goodsName),1),e.goods.deliveryType===1?(r(),k("div",co,d(g.$t("shop.sellAmount"))+" "+d(e.goods.salesVolume||0),1)):$("",!0),+e.goods.goodsTypes!=2?(r(),k("div",{key:1,class:Se(["text-xs opacity-60 min-w-fit",{"ml-auto":e.goods.deliveryType!==1}])},d(g.$t("goods.stock"))+" "+d(e.goods.stock||0),3)):$("",!0)]),s("div",po,[fo,s("div",vo,[s("div",mo,d(e.goods.price)+"Mcoin",1)])])])]),s("div",go,[e.goods.status&&e.goods.status===1&&!t(C).isOnlyView?(r(),E(m,{key:0,round:"",hairline:"",type:"primary",class:"border border-solid border-default text-default h-[24px] px-5",loading:e.goods.loading,onClick:f[0]||(f[0]=R(()=>T("handleDown",e.goods,e.index),["stop"]))},{default:S(()=>[U(d(g.$t("shop.down")),1)]),_:1},8,["loading"])):$("",!0),e.goods.status&&e.goods.status===2&&!t(C).isOnlyView?(r(),E(m,{key:1,round:"",hairline:"",type:"primary",class:"border border-solid border-default text-default h-[24px] px-5",loading:e.goods.loading,onClick:f[1]||(f[1]=R(()=>T("handleUp",e.goods,e.index),["stop"]))},{default:S(()=>[U(d(g.$t("shop.up")),1)]),_:1},8,["loading"])):$("",!0),h(m,{round:"",hairline:"",type:"primary",class:"border border-solid border-default text-default h-[24px] px-5",loading:e.goods.loading,onClick:f[2]||(f[2]=()=>T("handleTo",`/shopGoods/editGoods?id=${e.goods.id}`))},{default:S(()=>[U(d(g.$t("shop.modify")),1)]),_:1},8,["loading"]),t(C).isOnlyView?$("",!0):(r(),k("div",{key:2,class:"relative",ref:(x,_)=>{_.target=x,y.value=x}},[h(m,{onClick:f[3]||(f[3]=R(x=>t(D)(!t(G)),["stop"])),round:"",hairline:"",class:"btn text-white bg-primary h-[24px] px-3",loading:e.goods.loading},{default:S(()=>[s("div",ho,[s("span",null,d(g.$t("shop.more")),1),h(v,{name:"play",class:"rotate-90"})])]),_:1},8,["loading"]),t(G)?(r(),k("div",yo,[s("div",{class:"no-wrap",onClick:f[4]||(f[4]=R(()=>T("handleTo",`/editFlashSaleGoods?id=${e.goods.id}`),["stop"]))},d(g.$t("shop.transform")),1),e.shopType!==t(te).SD&&e.goods.type!==e.shopType?(r(),k("div",{key:0,class:"pt-3 no-wrap",onClick:f[5]||(f[5]=R(()=>T("toFeatured",e.goods),["stop"]))},d(g.$t("goods.One-click transfer",{type:g.$t(`common.shop_type_${e.shopType}`)})),1)):$("",!0)])):$("",!0)],512))])])}}}),bo=Q(xo,[["__scopeId","data-v-54047e1f"]]),wo={class:"relative"},To={class:"sticky top-0 z-50 gap-2 px-3 pt-2 text-base flex-start bg1"},$o={class:"py-3 px-2.5 bg-[#f8f7f4]"},ko=M({name:"ShopGoods"});function So(e){Ve(o=>({"63a104c4":t(f)}));const{accountStore:T,clerkStore:C}=ne(),{getCurrentStoreId:G,getCurrentAccount:D}=ze(),y=p(null),{y:g}=Ge(y),f=J(()=>g.value>20?"#F9F7F4":"transparent"),{t:i}=De(),m=Fe(),v=p(0),n=Be({active:0,shopInfo:null,keyword:""}),x=J(()=>[{id:1,name:`${i("shop.selling")}(${v.value})`},{id:2,name:i("shop.watiShelf")},{id:0,name:i("shop.manuscript")}]),_=o=>{m.push(o)},u=p([]),z=p(!1),L=p(!1),P=p(0),ie=p(10),q=p(0),A=async()=>{L.value=!1,P.value=0,q.value=0,u.value=[],j()},N=p({}),de=async o=>{console.log(o),N.value=o,o.goodsType&&o.goodsType!=="all"&&(N.value.type=o.goodsType),delete N.value.goodsType,L.value=!1,P.value=0,q.value=0,u.value=[],j()},j=async()=>{z.value=!0,P.value+=1,await re(),z.value=!1},re=async(o,a)=>{var I;const c=await je({merchant:((I=await G())==null?void 0:I.merchant)||D(),status:x.value[n.active].id,page:P.value,size:ie.value,keyword:n.keyword,...N.value});if(z.value=!1,!c.success){L.value=!0;return}if(!c.data||!c.total){L.value=!0,u.value=P.value===1?[]:u.value,v.value=n.active?v.value:0;return}q.value=c.total,v.value=n.active?v.value:c.total,x.value[0].name=`${i("shop.selling")}(${v.value})`;const b=p([]);b.value=c.data.map(F=>({btnLoading:!1,...F})),u.value=P.value===1?b.value:u.value.concat(b.value),u.value.length>=q.value&&(L.value=!0)},ue=()=>{A()},ce=async(o,a)=>{o.loading=!0;const c={id:o.id,status:2},b=await se(c);o.loading=!1,b.success&&(u.value.splice(a,1),v.value=v.value-1,x.value[0].name=`${i("shop.selling")}(${v.value})`)},pe=async(o,a)=>{o.loading=!0;const c={id:o.id,status:1},b=await se(c);o.loading=!1,b.success&&(u.value.splice(a,1),v.value=v.value+1,x.value[0].name=`${i("shop.selling")}(${v.value})`)},fe=async(o,a)=>{o.loading=!0;const c=await He(o.id);o.loading=!1,c.success&&u.value.splice(a,1)},ve=J(()=>[3,30]),[me,Y]=ae(!1),ge=p(""),he=p(""),ye=p(1),W=p(null),K=async o=>{_(`/shopGoods/editGoods?id=${o.id}&boutique=1`)},xe=(o,a)=>{Y(!1),a===1&&(W.value.discountRatio=o,K()),a===2&&(W.value.balanceDiscountRatio=o,K())},be=async()=>{n.shopInfo=await G()};let O=null;const we=async()=>{const o=localStorage.getItem("shopGoods_scrollTop");+o?O.scrollTo({top:+o,left:0,behavior:"instant"}):localStorage.removeItem("shopGoods_scrollTop")},Z=p(!1),X=()=>{Z.value||(Z.value=!0,setTimeout(()=>{localStorage.setItem("shopGoods_scrollTop",O.scrollTop+""),Z.value=!1},500))};return Ee(()=>{be(),O=document.querySelector(".shopGoodsPage"),O.addEventListener("scroll",X)}),Le(async()=>{var o,a,c,b;C.isClerk&&A();try{we();const I=sessionStorage.getItem("shop_refresh_id");if(I==="add")A();else if(I){const F=await Me(I),l=u.value.findIndex(w=>{var B;return((B=w.goods)==null?void 0:B.id)==I});n.active==0?l>-1&&(u.value[l].goods=(o=F.data)==null?void 0:o.goods):n.active==1?l>-1&&u.value.splice(l,1):n.active==2&&l>-1&&(((a=F.data)==null?void 0:a.goods.status)===((c=u.value[l])==null?void 0:c.goods.status)?u.value[l].goods=(b=F.data)==null?void 0:b.goods:u.value.splice(l,1))}}finally{sessionStorage.removeItem("shop_refresh_id")}}),Pe(()=>{O.removeEventListener("scroll",X)}),(o,a)=>{const c=V("VanList"),b=V("VanTab"),I=V("VanTabs"),F=V("router-view");return r(),k("div",wo,[s("div",{class:"shopGoodsPage relative z-0 h-full pb-20 overflow-auto text-sm text-default bg",ref:(l,w)=>{w.shopGoodsRef=l,y.value=l}},[s("div",To,[h(Ae),s("div",null,d(o.$t("shop.sellingGoods")),1),h(Ne,{showIcon:!0,showDownIcon:!1,class:"ml-auto bg-gray1 px-2 rounded-[20px] border-2 border-solid border-white",style:{"box-shadow":"0px 0px 15px 0px rgba(51, 47, 42, 0.3) inset"}})]),h(I,{active:t(n).active,"onUpdate:active":a[3]||(a[3]=l=>t(n).active=l),onChange:ue,sticky:"","offset-top":44},{"nav-bottom":S(()=>{var l,w,B;return[s("div",$o,[h(qe,{modelValue:t(n).keyword,"onUpdate:modelValue":a[0]||(a[0]=H=>t(n).keyword=H),shopType:(w=(l=t(n))==null?void 0:l.shopInfo)==null?void 0:w.type,"delivery-type":t(Ke).online,onOnSubmit:A,onOnFilter:de,shopInfo:(B=t(n))==null?void 0:B.shopInfo},null,8,["modelValue","shopType","delivery-type","shopInfo"])])]}),default:S(()=>[(r(!0),k(ee,null,oe(t(x),l=>(r(),E(b,{title:l.name,key:l.id,class:"relative px-3"},{default:S(()=>[h(c,{loading:z.value,"onUpdate:loading":a[1]||(a[1]=w=>z.value=w),finished:L.value,"finished-text":o.$t("common.noMore"),"loading-text":o.$t("common.loading"),onLoad:j},{default:S(()=>[(r(!0),k(ee,null,oe(u.value,(w,B)=>{var H;return r(),E(bo,{key:w.goods.id,index:B,goods:w.goods,shopType:(H=t(n).shopInfo)==null?void 0:H.type,onHandleDown:ce,onHandleUp:pe,onHandleDel:fe,onHandleTo:_,onToFeatured:K},null,8,["index","goods","shopType"])}),128))]),_:1},8,["loading","finished","finished-text","loading-text"]),t(T).isOnlyView?$("",!0):(r(),k("button",{key:0,class:"btn-orange w-[180px] h-10 flex-center text-white font-semibold fixed x-center sm:bottom-[11%] bottom-9 z-10",onClick:a[2]||(a[2]=w=>_("/shopGoods/editGoods"))},d(o.$t("shop.releaseGoods")),1))]),_:2},1032,["title"]))),128))]),_:1},8,["active"])],512),h(Xe,{show:t(me),onClose:a[4]||(a[4]=l=>t(Y)(!1)),text:ge.value,inputTips:he.value,discountConfig:t(ve),onConfirm:xe,type:ye.value},null,8,["show","text","inputTips","discountConfig","type"]),h(F,{class:"child-view"})])}}const Co=M({...ko,setup:So}),No=Q(Co,[["__scopeId","data-v-62ac0d7a"]]);export{No as default};
