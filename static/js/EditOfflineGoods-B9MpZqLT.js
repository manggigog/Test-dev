import{y as le,r as C,x as oe,z as W,E as I,K as z,G as b,N as r,H as t,Q as u,O as m,a4 as J,F as T,J as ce,a2 as R,R as Q,P as l,I as ue,n as se,bf as ae,D as fe,bz as io,a0 as te,_ as ro,w as co,a1 as uo,l as go,be as ee,bG as De,bF as Pe,Y as po,Z as vo,T as Z,br as Le}from"./vendor-BUT0HZ5j.js";import{C as mo}from"./CommonVanProvider-BpsZUrD3.js";import{_ as Ue}from"./search-Dwmdj_3F.js";import{_ as he}from"./checked-C0ib8aDP.js";import{bG as be,az as fo,e as ho,u as bo,r as _o,V as pe,_ as xo,S as yo,X as wo,aL as Io,aQ as Fe,a2 as Re,q as Te}from"./index-hbwLMIYO.js";import{u as Oe}from"./upload-GisNQoOq.js";import{i as ve,c as ze}from"./offlineGoods-DvT2Go6q.js";import{S as me}from"./shop-CeqcS6K2.js";import"./BackIcon-biFt6cm7.js";const $o={class:"w-full py-4 pl-4 pr-2 bg-b6 rounded-[10px] overflow-hidden font-Puhui"},Co={class:"text-center felx-1 relative mr-2"},ko={class:"text-base font-bold"},Vo={class:"absolute right-0 top-0 pl-2"},So={class:"flex-1 bg-b5 rounded-3xl mr-2 mt-4 mb-2"},Bo=t("div",null,[t("img",{src:Ue,class:"w-4 h-4"})],-1),No={class:"categoryList pr-2 mr-2 overflow-y-auto"},Do=["id","onClick"],Po=["innerHTML"],Lo={key:0,class:"w-4 h-4",src:he,alt:""},Fo=le({props:{list:null,id:null,level:null},emits:["close","select"],setup(N,{emit:g}){const k=N,E=C(!0),_=C(""),p=oe(()=>{if(!_.value.trim())return k.list;const c=D(_.value),v=new RegExp(`(${c})`,"gi");return k.list.filter($=>$.goodsCategoryName.match(v))}),B=c=>{if(!_.value.trim())return c;const v=D(_.value),$=new RegExp(`(${v})`,"gi");return c.replace($,'<span class="highlight">$1</span>')},D=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=c=>{g("select",c.goodsCategoryId,c.goodsCategoryName),g("close")},j=c=>{const v=document.getElementById(c);v&&v.scrollIntoView({behavior:"smooth"})};return W(()=>k.id,async c=>{c&&(await se(),j(c))},{immediate:!0,deep:!0}),(c,v)=>{const $=I("van-icon"),P=I("VanField"),f=I("VanPopup");return b(),z(f,{teleport:"body",show:E.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:v[2]||(v[2]=i=>c.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"50%","border-radius":"16px 16px 0 0"}},{default:r(()=>[t("div",$o,[t("header",Co,[t("div",ko,u([c.$t("offline.one_category"),c.$t("offline.two_category"),c.$t("offline.three_category")][(N.level||1)-1])+" （"+u((N.list||[]).length)+"） ",1),t("div",Vo,[m($,{name:"cross",size:"20",onClick:v[0]||(v[0]=J(()=>{g("close")},["stop"]))})])]),t("div",So,[m(P,{modelValue:_.value,"onUpdate:modelValue":v[1]||(v[1]=i=>_.value=i),placeholder:c.$t("mall.Enter search keywords"),class:"w-[100% - 20px] text-center bg-transparent items-center",clearable:""},{"left-icon":r(()=>[Bo]),_:1},8,["modelValue","placeholder"])]),t("div",No,[(b(!0),T(ue,null,ce(l(p),i=>(b(),T("div",{key:i.goodsCategoryId,id:i.goodsCategoryId,class:"flex flex-1 justify-between py-4 border-b border-b-b4 last:border-none",onClick:L=>o(i)},[t("span",{class:Q({"text-newOrigin":i.goodsCategoryId===N.id}),innerHTML:B(i.goodsCategoryName)},null,10,Po),i.goodsCategoryId===N.id?(b(),T("img",Lo)):R("",!0)],8,Do))),128))])])]),_:1},8,["show"])}}}),Ro={class:"w-full py-4 p-3 bg-b6 rounded-[10px] overflow-hidden font-Puhui"},To={class:"text-center felx-1 relative mx-1"},Oo={class:"text-base font-bold"},zo={class:"absolute right-0 top-0 pl-2"},Uo={key:0,class:"flex-1 bg-b5 rounded-3xl mx-1 mt-4 mb-2"},qo=t("div",null,[t("img",{src:Ue,class:"w-4 h-4"})],-1),Eo={class:"flex-1 flex items-center gap-1 text-sm"},Go={class:"flex-1"},jo={class:"text-b3 line-clamp-1"},Mo={key:0,class:"w-4 h-4",src:he,alt:""},Ao=le({props:{id:null,name:null,level:null},emits:["close","select"],setup(N,{emit:g}){const k=N,E=C(!0),_=ae({total:0,loading:!1,finished:!1,list:[]}),p=ae({page:0,size:100,storeBrandNameLike:void 0}),B=C([]),D=C(null),o=f=>{B.value=[f.storeBrandId],j()},j=()=>{var i;const f=(i=_.list||[])==null?void 0:i.find(L=>L.storeBrandId===B.value[0]);g("select",f==null?void 0:f.storeBrandId,f==null?void 0:f.storeBrandName),g("close")},c=f=>{const i=document.getElementById(f);i&&i.scrollIntoView({behavior:"smooth"})};W(()=>k.id,async f=>{f&&(await se(),c(f))},{immediate:!0,deep:!0});const v=()=>{_.finished=!1,_.list=[],p.page=0,$()},$=async()=>{_.loading=!0,p.page+=1,await P(),_.loading=!1},P=async()=>{const{success:f,data:i}=await be(p);if(!f){_.finished=!0;return}const{records:L,total:a,current:x,pages:V}=i;if(!a||!L||!(L!=null&&L.length)){_.finished=!0;return}_.total=a,_.list=p.page===1?L:_.list.concat(L),+x>=+V&&(_.finished=!0)};return fe(()=>{k.id&&k.name&&(B.value=[k.id],p.storeBrandNameLike=k.name),$()}),(f,i)=>{const L=I("van-icon"),a=I("VanField"),x=I("VanImage"),V=I("van-checkbox"),O=I("van-checkbox-group"),X=I("VanList"),U=I("VanPopup");return b(),z(U,{teleport:"body",show:E.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:i[4]||(i[4]=y=>f.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"50%","border-radius":"16px 16px 0 0"}},{default:r(()=>[t("div",Ro,[t("header",To,[t("div",Oo,u(f.$t("offline.select_store_brand")),1),t("div",zo,[m(L,{name:"cross",size:"20",onClick:i[0]||(i[0]=J(()=>{g("close")},["stop"]))})])]),N.level?R("",!0):(b(),T("div",Uo,[m(a,{modelValue:l(p).storeBrandNameLike,"onUpdate:modelValue":i[1]||(i[1]=y=>l(p).storeBrandNameLike=y),placeholder:f.$t("offline.input_store_name"),class:"w-[100%-20px] text-center bg-transparent items-center",clearable:"",onClear:v,onKeyup:io(v,["enter"])},{"left-icon":r(()=>[qo]),"right-icon":r(()=>[t("div",{class:"text-newOrigin pl-1 ml-2",onClick:v},u(f.$t("common.search")),1)]),_:1},8,["modelValue","placeholder","onKeyup"])])),m(X,{loading:l(_).loading,"onUpdate:loading":i[3]||(i[3]=y=>l(_).loading=y),finished:l(_).finished,"immediate-check":!1,"loading-text":f.$t("common.loading"),onLoad:$,class:"shopList mx-1 overflow-y-auto h-[calc(100vh-200px)]"},{default:r(()=>[m(O,{modelValue:B.value,"onUpdate:modelValue":i[2]||(i[2]=y=>B.value=y),ref:(y,q)=>{q.checkboxGroup=y,D.value=y},max:1},{default:r(()=>[(b(!0),T(ue,null,ce(l(_).list,y=>(b(),z(V,{key:y.storeBrandId,name:y.storeBrandId,id:y.storeBrandId,"label-position":"left",class:"flex flex-1 justify-between py-4 border-b border-b-b4 last:border-none",onClick:q=>o(y)},{icon:r(q=>[q.checked?(b(),T("img",Mo)):R("",!0)]),default:r(()=>[t("div",Eo,[m(x,{src:((y==null?void 0:y.storeBrandIcon)||"").split(",")[0],radius:"4px",width:"32px",height:"32px",fit:"cover"},null,8,["src"]),t("div",Go,[t("div",{class:Q([{"text-newOrigin font-semibold":B.value.includes(y.storeBrandId)},"line-clamp-1"])},u(y.storeBrandName),3),t("div",jo,u(y.storeBrandDesc),1)])])]),_:2},1032,["name","id","onClick"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished","loading-text"])])]),_:1},8,["show"])}}}),Ko={class:"w-full py-4 p-3 bg-b6 rounded-[10px] overflow-hidden font-Puhui"},Ho={class:"text-center felx-1 relative mx-1"},Qo=t("div",{class:"text-base font-bold"}," 选择分店 ",-1),Xo={class:"absolute right-0 top-0 pl-2"},Jo={class:"rounded-[10px] bg-[#F5F5F5] h-[56px] w-full mt-4"},Yo={class:"flex items-center justify-start w-full h-full p-3"},Zo={class:"w-8 h-8 rounded-[4px] bg-[#D9D9D9]"},Wo={class:"ml-2"},et={class:"text-base font-semibold text-b1 line-clamp-1 flex-shrink-0"},ot={class:"flex-1 flex items-center gap-1 text-sm"},tt={class:"flex-1"},st={class:"text-b3 flex items-center gap-x-1"},at={class:"line-clamp-1"},lt={key:0,class:"w-4 h-4",src:he,alt:""},nt={class:"flex items-center gap-x-3 pt-4"},dt={class:"text-b1 text-sm"},it=le({props:{rootName:null,rootId:null,ids:null},emits:["close","select","changeBrand"],setup(N,{emit:g}){const k=N,E=C(""),_=C(!0),p=ae({total:0,loading:!1,finished:!1,list:[]}),B=ae({page:0,size:20,storeBrandId:k.rootId,overseasFlag:!1,storeNameLike:void 0}),D=C([]),o=C(null),j=oe(()=>{var a,x;return(a=p.list)!=null&&a.length?((x=p.list)==null?void 0:x.length)===D.value.length:!1});W(()=>k.rootName,async a=>{a&&(await se(),c())},{immediate:!0,deep:!0});const c=async()=>{const{success:a,data:x}=await be({page:1,size:1,storeBrandNameLike:k.rootName});if(a){const V=x.records.find(O=>O.storeBrandId===k.rootId);V&&V.storeBrandIcon?E.value=V.storeBrandIcon.split(",")[0]||"":E.value=""}},v=()=>{o.value.toggleAll(!j.value)},$=()=>{g("select",D.value,p.list.filter(a=>D.value.includes(a.storeId)).map(a=>a.storeName)),g("close")},P=()=>{g("changeBrand")},f=a=>{const x=document.getElementById(a);x&&x.scrollIntoView({behavior:"smooth"})};W(()=>k.ids,async a=>{a!=null&&a.length&&(D.value=a,await se(),f(a[0]))},{immediate:!0,deep:!0});const i=async()=>{p.loading=!0,B.page+=1,await L(),p.loading=!1},L=async()=>{B.storeBrandId=k.rootId,p.finished=!0;const{success:a,data:x}=await fo(B);if(p.loading=!1,!a){p.finished=!0;return}const{records:V,total:O,current:X,pages:U}=x;if(!O||!V||!(V!=null&&V.length)){p.finished=!0;return}p.total=O,p.list=B.page===1?V:p.list.concat(V),+X>=+U&&(p.finished=!0)};return fe(()=>{i()}),(a,x)=>{const V=I("van-icon"),O=I("VanImage"),X=I("van-checkbox"),U=I("van-checkbox-group"),y=I("VanList"),q=I("van-radio"),Y=I("VanButton"),ne=I("VanPopup");return b(),z(ne,{teleport:"body",show:_.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:x[3]||(x[3]=F=>a.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"50%","border-radius":"16px 16px 0 0"}},{default:r(()=>[t("div",Ko,[t("header",Ho,[Qo,t("div",Xo,[m(V,{name:"cross",size:"20",onClick:x[0]||(x[0]=J(()=>{g("close")},["stop"]))})])]),t("section",Jo,[t("div",Yo,[t("div",Zo,[m(O,{src:E.value||"",radius:"4px",width:"32px",height:"32px",fit:"cover"},null,8,["src"])]),t("div",Wo,[t("span",et,u(N.rootName),1)]),t("div",{class:"ml-auto pl-1 flex-shrink-0"},[t("span",{class:"text-[#FF8812] text-sm font-normal",onClick:P}," 更换品牌 ")])])]),m(y,{loading:l(p).loading,"onUpdate:loading":x[2]||(x[2]=F=>l(p).loading=F),finished:l(p).finished,"immediate-check":!1,"loading-text":a.$t("common.loading"),onLoad:i,class:"shopList h-[calc(100vh-230px)] mx-1 overflow-y-auto"},{default:r(()=>[m(U,{modelValue:D.value,"onUpdate:modelValue":x[1]||(x[1]=F=>D.value=F),ref:(F,M)=>{M.checkboxGroup=F,o.value=F}},{default:r(()=>[(b(!0),T(ue,null,ce(l(p).list,F=>(b(),z(X,{key:F.storeId,name:F.storeId,id:F,"label-position":"left",class:"flex flex-1 justify-between py-4 border-b border-b-b4 last:border-none"},{icon:r(M=>[M.checked?(b(),T("img",lt)):R("",!0)]),default:r(()=>[t("div",ot,[t("div",tt,[t("div",{class:Q([{"text-newOrigin font-semibold":D.value.includes(F.storeId)},"line-clamp-1"])},u(F.storeName),3),t("div",st,[t("span",at,u(F.storeAddress),1)])])])]),_:2},1032,["name","id"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished","loading-text"]),t("div",nt,[t("div",{onClick:v},[m(q,{checked:l(j),"checked-color":"#FF8812","icon-size":"16px"},{default:r(()=>[t("span",dt,u(a.$t("common.check all")),1)]),_:1},8,["checked"])]),m(Y,{class:"submit-btn flex-1 bg-yellow text-b1 text-base font-semibold border-none h-[46px]",round:"",onClick:$},{default:r(()=>[te(u(a.$t("offline.select_branch")),1),t("span",null,"("+u(D.value.length)+")",1)]),_:1})])])]),_:1},8,["show"])}}}),qe=N=>(po("data-v-50ac2a67"),N=N(),vo(),N),rt={class:"bg-white rounded-xl overflow-hidden mx-3 px-3 py-4 title"},ct={class:"text-b1 font-semibold"},ut={class:"border-b4 border-b border-solid pb-4 van-uploader__wrapper gap-1.5"},gt=["onClick"],pt={class:"van-image van-uploader__preview-image",style:{width:"60px",height:"60px"}},vt=["src"],mt=["onClick"],ft=qe(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),ht=[ft],bt={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},_t=["src"],xt={class:"text-xs font-light text-center text-b1 opacity-30"},yt={class:"border-b4 border-b border-solid"},wt={class:"text-default font-semibold"},It={key:0,class:"border-b4 border-b border-solid"},$t={class:"text-default font-semibold"},Ct={key:1,class:"border-b4 border-b border-solid"},kt={class:"text-default font-semibold"},Vt={class:"border-b4 border-b border-solid"},St={class:"text-default font-semibold"},Bt={key:0,class:"rounded-[10px] bg-[#F5F5F5] min-h-[56px] w-full mb-4 p-3"},Nt={class:"flex items-center justify-start w-full h-full"},Dt={class:"w-8 h-8 rounded-[4px] bg-[#D9D9D9]"},Pt={class:"ml-2"},Lt={class:"text-base font-semibold text-b1"},Ft={key:0,class:"mt-3 border-t border-t-b4 pt-3"},Rt={class:"pt-4 font-semibold text-b1"},Tt={class:"van-uploader__wrapper gap-1.5"},Ot=["onClick"],zt={class:"van-image van-uploader__preview-image",style:{width:"60px",height:"60px"}},Ut=["src"],qt=["onClick"],Et=qe(()=>t("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),Gt=[Et],jt={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Mt=["src"],At={class:"text-xs font-light text-center text-b1 opacity-30"},Kt={key:0,class:"bg-white rounded-xl m-3 overflow-hidden"},Ht={class:"text-default font-semibold"},Qt={class:"bg-white rounded-xl overflow-hidden m-3 px-3 title"},Xt={class:"border-b4 border-b border-solid"},Jt={class:"text-default font-semibold"},Yt={class:"text-default font-semibold"},Zt=te("%"),Wt={key:1,class:"fixed bottom-0 flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper sm:w-[375px] w-full left-[50%]",style:{transform:"translateX(-50%)"}},es={class:"text-b3 text-center text-sm mt-6"},os={class:"flex items-center justify-between mt-6"},ts=le({name:"EditOfflineGoods"});function ss(N){const{t:g}=co(),{accountStore:k,serviceCategoriesStore:E}=ho(),{getCurrentStoreId:_}=bo(),{loadingToggle:p}=_o(),B=uo(),D=go(),o=C({goodsId:null,shopId:null,goodsName:"",goodsIcons:"",goodsPrice:null,goodsDiscountRatio:null,goodsDesc:null,goodsPics:"",goodsStatus:1,goodsType:null,goodsCategoryId1:null,goodsCategoryName1:null,goodsCategoryId2:null,goodsCategoryName2:null,goodsCategoryId3:null,goodsCategoryName3:null,goodsCategoryId:null,storeBrandId:void 0}),j=oe(()=>!o.value.goodsName||c.value.length<=0||!o.value.goodsCategoryId1||!o.value.goodsCategoryId2||!o.value.goodsCategoryId3||!o.value.goodsPrice||!o.value.goodsDiscountRatio),c=C([]),v=C([]),$=C(0),P=C(0),f=C([]),i=C(1),L=C(null),a=ae({brandId:null,brandName:null,storeIds:[],storeNames:[]}),x=C(""),[V,O]=ee(!1),[X,U]=ee(!1),[y,q]=ee(!1),[Y,ne]=ee(!1),[F,M]=ee(!1),_e=oe(()=>({1:g("common.boutique"),2:g("mall.Best"),3:g("shop.Star Selection")})),xe=[[1,80],[4,30],[10,80],[20,80]],A=oe(()=>{let e=[1,80];return $.value&&(e=xe[P.value]),e}),Ee=e=>e.replace(/^(\d*\.?\d{0,4}).*$/,"$1"),ye=e=>{function s(n){let w=n.replace(/[^\d.]/g,"");return w=w.replace(/(\..*)\./g,"$1"),w=$.value?w.replace(/^(\d*\.?\d{0,0}).*$/,"$1"):w.replace(/^(\d*\.?\d{0,2}).*$/,"$1"),w}return e>A.value[1]?A.value[1].toString():s(e.toString())};W(()=>$.value,()=>{o.value.goodsDiscountRatio>0&&(o.value.goodsDiscountRatio=ye(o.value.goodsDiscountRatio))});const Ge=()=>{if(!$.value&&P.value&&o.value.goodsDiscountRatio>0){const e=xe[P.value];o.value.goodsDiscountRatio>=e[0]&&o.value.goodsDiscountRatio<=e[1]&&($.value=P.value)}},de=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var s=Math.random()*16|0,n=e==="x"?s:s&3|8;return n.toString(16)}),we=e=>{let s=!1;const n=ve.split(",");for(let w=0;w<n.length;w++)if(console.log(e==null?void 0:e.type,n[w]),(e==null?void 0:e.type)===n[w]){s=!0;break}return s||Z(g("common.uploadImgTypeTips",{format:n.map(w=>w.slice(6)).join("/")})),s},Ie=C(5),je=async e=>{if(c.value.length>=Ie.value||!we(e.file))return;Z.loading({message:g("common.uploading"),forbidClick:!0,duration:0});const s=await Re(e,"goodsImg"),n=await Oe(s);Z.clear(),n.success&&c.value.push({id:de(),url:Te.imgUrl+n.data})},Me=e=>{c.value.splice(e,1)},Ae=e=>{Le({images:c.value.map(s=>s.url),startPosition:e})},$e=C(5),Ke=async e=>{if(v.value.length>=$e.value||!we(e.file))return;Z.loading({message:g("common.uploading"),forbidClick:!0,duration:0});const s=await Re(e,"goodsDesc"),n=await Oe(s);Z.clear(),n.success&&v.value.push({id:de(),url:Te.imgUrl+n.data})},He=e=>{v.value.splice(e,1)},Qe=e=>{Le({images:v.value.map(s=>s.url),startPosition:e})},ge=(e,s,n)=>{f.value=Io(E.fullCategories,{idKey:"goodsCategoryId",parentKey:"goodsCategoryParentId",rootId:s}),L.value=e,i.value=n,ne(!0)},Xe=(e,s)=>{if(o.value[`goodsCategoryId${i.value}`]=e,o.value[`goodsCategoryName${i.value}`]=s,i.value<3)for(let n=i.value;n<3;n++)o.value[`goodsCategoryId${n+1}`]=null,o.value[`goodsCategoryName${n+1}`]=null},Je=()=>{a.brandId?U(!0):O(!0)},Ye=()=>{U(!1),O(!0)},Ze=(e,s)=>{a.brandName=s,e!==a.brandId&&(a.brandId=e,a.storeIds=[]),e&&U(!0)},We=(e,s)=>{a.storeIds=e||[],a.storeNames=s||[],U(!1)};W(()=>a.brandName,async e=>{e&&(await se(),eo())},{immediate:!0,deep:!0});const eo=async()=>{const{success:e,data:s}=await be({page:1,size:1,storeBrandNameLike:a.brandName});if(e){const n=s.records.find(w=>w.storeBrandId===a.brandId);n&&n.storeBrandIcon?x.value=n.storeBrandIcon.split(",")[0]||"":x.value=""}},K=e=>{Z({message:e,icon:pe("toast-warn.svg"),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},oo=()=>{o.value.goodsPrice<0&&(K(g("offline.price_tips")),o.value.goodsPrice=Math.abs(o.value.goodsPrice))},Ce=()=>{var e;return o.value.goodsName?c.value.length?((e=o.value)==null?void 0:e.goodsPrice)<=0?(K(g("shop.pleaseInput")+g("goods.price")),!1):!0:(K(g("offline.empty_image")),!1):(K(g("offline.offline_name_placeholder")),!1)},ke=async()=>{var n,w;const e=c.value.map(H=>H.url),s=v.value.map(H=>H.url);o.value.goodsType=$.value?P.value:me.SD,o.value.goodsIcons=e.join(","),o.value.goodsPics=s.join(","),o.value.shopId=(n=await _())==null?void 0:n.id,o.value.storeBrandId=a.brandId?a.brandId:void 0,o.value.storeBrandName=a.brandName?a.brandName:void 0,o.value.storeIds=(w=a.storeIds)!=null&&w.length?a.storeIds:void 0},to=async()=>{if(!Ce())return;q(!0),o.value.goodsStatus=ze.DRAFT,await ke();const{success:e,data:s}=await Fe(o.value);q(!1),e&&(o.value.goodsId=s,Ve())},so=async()=>{if(!Ce())return;if(!o.value.goodsCategoryId1)return K(g("shop.pleaseSelect")+g("offline.one_category"));if(!o.value.goodsCategoryId2)return K(g("shop.pleaseSelect")+g("offline.two_category"));if(!o.value.goodsCategoryId3)return K(g("shop.pleaseSelect")+g("offline.three_category"));if(!o.value.goodsDiscountRatio||o.value.goodsDiscountRatio<A.value[0]||+o.value.goodsDiscountRatio>A.value[1]){const n=g("offline.empty_discount")+`<div class="text-center ">(${A.value[0]}-${A.value[1]}%)</div>`;return K(n)}q(!0),o.value.goodsStatus=ze.Published,await ke();const{success:e,data:s}=await Fe(o.value);q(!1),e&&(o.value.goodsId=s,M(!0))},ao=()=>{var e,s;Se(),M(!1),(e=o.value)!=null&&e.goodsId&&D.replace({path:"/offlineGoodsDetail",query:{goodsId:(s=o.value)==null?void 0:s.goodsId}})},Ve=()=>{Se(),M(!1),D.back()},Se=()=>{var s;const e=((s=o.value)==null?void 0:s.goodsId)||B.query.goodsId||"add";sessionStorage.setItem("shop_offline_refresh_id",e.toString())},lo=async()=>{var n,w,H,ie,re;const e=(n=B.query)==null?void 0:n.goodsId;if(!e)return;const s=await wo(e.toString(),!0);s.success&&(o.value=s.data,o.value.goodsId=e.toString(),((w=o.value)==null?void 0:w.goodsType)!==me.SD&&P.value!==me.SD&&($.value=1),o.value.goodsIcons&&(c.value=(o.value.goodsIcons||"").split(",").map(G=>({id:de(),url:G}))),o.value.goodsPics&&(v.value=o.value.goodsPics.split(",").map(G=>({id:de(),url:G}))),o.value.goodsDiscountRatio<=0&&(o.value.goodsDiscountRatio=null),+o.value.storeBrandId&&(a.brandId=o.value.storeBrandId,a.brandName=(H=o.value)==null?void 0:H.storeBrandName,a.storeIds=(ie=o.value)==null?void 0:ie.stores.map(G=>G.storeId),a.storeNames=(re=o.value)==null?void 0:re.stores.map(G=>G.storeName),console.log(a.storeNames)))},no=async()=>{var n;const{success:e,data:s}=await yo((n=await _())==null?void 0:n.merchant);e&&(P.value=s==null?void 0:s.type)};return fe(async()=>{p(!0),E.init(),await no(),lo(),p(!1)}),(e,s)=>{const n=I("van-field"),w=I("van-uploader"),H=I("VanIcon"),ie=I("VanImage"),re=I("van-switch"),G=I("VanButton");return b(),z(mo,{title:e.$t("offline.published_goods"),class:"font-Puhui font-normal relative pb-20 bg-gray1",themeVars:{navBarBackgroundColor:"#F2F0EF"}},{default:r(()=>{var Be,Ne;return[t("div",rt,[t("div",ct,u(e.$t("offline.offline_name")),1),m(n,{modelValue:o.value.goodsName,"onUpdate:modelValue":s[0]||(s[0]=d=>o.value.goodsName=d),autosize:"",type:"text",placeholder:e.$t("offline.offline_name_placeholder"),maxlength:"50",class:"no-bt"},null,8,["modelValue","placeholder"]),t("div",ut,[m(l(Pe),De({class:"flex flex-wrap gap-1.5",modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=d=>c.value=d),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:r(({element:d,index:h})=>[t("div",{class:"van-uploader__preview",onClick:J(S=>Ae(h),["stop"])},[t("div",pt,[t("img",{src:d.url,class:"van-image__img rounded-md",style:{"object-fit":"cover"}},null,8,vt)]),t("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:J(S=>Me(h),["stop"])},ht,8,mt)],8,gt)]),_:1},16,["modelValue","handle"]),c.value.length<Ie.value?(b(),z(w,{key:0,accept:l(ve),afterRead:je},{default:r(()=>[t("div",bt,[t("img",{src:l(pe)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,_t),t("div",xt,u(e.$t("offline.main_image")),1)])]),_:1},8,["accept"])):R("",!0)]),t("div",yt,[m(n,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:s[2]||(s[2]=d=>{var h;return ge((h=o.value)==null?void 0:h.goodsCategoryId1,0,1)})},{label:r(()=>[t("div",wt,u(e.$t("offline.one_category")),1)]),input:r(()=>{var d,h,S;return[t("div",{class:Q(["dropdown text-b3",{"!text-b2":(d=o.value)==null?void 0:d.goodsCategoryId1,"down-active":i.value===1&&l(Y)}])},u((h=o.value)!=null&&h.goodsCategoryId1?(S=o.value)==null?void 0:S.goodsCategoryName1:e.$t("shop.pleaseSelect")),3)]}),_:1})]),(Be=o.value)!=null&&Be.goodsCategoryId1?(b(),T("div",It,[m(n,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:s[3]||(s[3]=d=>{var h,S;return ge((h=o.value)==null?void 0:h.goodsCategoryId2,(S=o.value)==null?void 0:S.goodsCategoryId1,2)})},{label:r(()=>[t("div",$t,u(e.$t("offline.two_category")),1)]),input:r(()=>{var d,h,S;return[t("div",{class:Q(["dropdown text-b3",{"!text-b2":(d=o.value)==null?void 0:d.goodsCategoryId2,"down-active":i.value===2&&l(Y)}])},u((h=o.value)!=null&&h.goodsCategoryId2?(S=o.value)==null?void 0:S.goodsCategoryName2:e.$t("shop.pleaseSelect")),3)]}),_:1})])):R("",!0),(Ne=o.value)!=null&&Ne.goodsCategoryId2?(b(),T("div",Ct,[m(n,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:s[4]||(s[4]=d=>{var h,S;return ge((h=o.value)==null?void 0:h.goodsCategoryId3,(S=o.value)==null?void 0:S.goodsCategoryId2,3)})},{label:r(()=>[t("div",kt,u(e.$t("offline.three_category")),1)]),input:r(()=>{var d,h,S;return[t("div",{class:Q(["dropdown text-b3",{"!text-b2":(d=o.value)==null?void 0:d.goodsCategoryId3,"down-active":i.value===3&&l(Y)}])},u((h=o.value)!=null&&h.goodsCategoryId3?(S=o.value)==null?void 0:S.goodsCategoryName3:e.$t("shop.pleaseSelect")),3)]}),_:1})])):R("",!0),t("div",Vt,[m(n,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:s[5]||(s[5]=d=>Je())},{label:r(()=>[t("div",St,u(e.$t("offline.brandInfo")),1)]),input:r(()=>{var d,h;return[t("div",{class:Q(["text-b3",{"!text-b2":l(a).brandId}])},[te(u((d=l(a).storeIds)!=null&&d.length?e.$t("offline.store_selected",{num:(h=l(a).storeIds)==null?void 0:h.length}):l(a).brandId?e.$t("offline.brand_selected",{num:1}):e.$t("shop.pleaseSelect"))+" ",1),m(H,{name:"arrow",class:"text-xs font-bold"})],2)]}),_:1}),l(a).brandId?(b(),T("div",Bt,[t("div",Nt,[t("div",Dt,[m(ie,{src:x.value||"",radius:"4px",width:"32px",height:"32px",fit:"cover"},null,8,["src"])]),t("div",Pt,[t("span",Lt,u(l(a).brandName||""),1)])]),l(a).storeIds.length?(b(),T("div",Ft,[(b(!0),T(ue,null,ce(l(a).storeNames,(d,h)=>(b(),T("div",{key:h,class:"text-b1 text-sm mb-2 last:mb-0"},u(d),1))),128))])):R("",!0)])):R("",!0)]),t("div",Rt,u(`${e.$t("goods.goodsDesc")}`),1),m(n,{modelValue:o.value.goodsDesc,"onUpdate:modelValue":s[6]||(s[6]=d=>o.value.goodsDesc=d),rows:"1",autosize:"",type:"textarea",placeholder:e.$t("goods.pleaseInputDesc"),class:"no-bt",style:{"padding-top":"8px !important","padding-bottom":"8px !important"}},null,8,["modelValue","placeholder"]),t("div",Tt,[m(l(Pe),De({class:"flex flex-wrap gap-1.5",modelValue:v.value,"onUpdate:modelValue":s[7]||(s[7]=d=>v.value=d),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:r(({element:d,index:h})=>[t("div",{class:"van-uploader__preview",onClick:J(S=>Qe(h),["stop"])},[t("div",zt,[t("img",{src:d.url,class:"van-image__img rounded-md",style:{"object-fit":"cover"}},null,8,Ut)]),t("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:J(S=>He(h),["stop"])},Gt,8,qt)],8,Ot)]),_:1},16,["modelValue","handle"]),v.value.length<$e.value?(b(),z(w,{key:0,accept:l(ve),afterRead:Ke},{default:r(()=>[t("div",jt,[t("img",{src:l(pe)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,Mt),t("div",At,u(e.$t("goods.descImage")),1)])]),_:1},8,["accept"])):R("",!0)])]),P.value?(b(),T("div",Kt,[m(n,{"input-align":"right",autocomplete:"off",class:"no-bt",style:{"padding-top":"16px !important","padding-bottom":"16px !important"},label:`*${e.$t("goods.setting boutique good"),{type:l(_e)[P.value]}}`},{label:r(()=>[t("div",Ht,u(`${e.$t("goods.setting boutique good",{type:l(_e)[P.value]})}`),1)]),input:r(()=>[m(re,{modelValue:$.value,"onUpdate:modelValue":s[8]||(s[8]=d=>$.value=d),"active-color":"#FF8812","inactive-color":"#B7B4B0","active-value":1,"inactive-value":0,size:"20"},null,8,["modelValue"])]),_:1},8,["label"])])):R("",!0),t("div",Qt,[t("div",Xt,[m(n,{"input-align":"right",type:"number",autocomplete:"off",modelValue:o.value.goodsPrice,"onUpdate:modelValue":s[9]||(s[9]=d=>o.value.goodsPrice=d),onBlur:oo,formatter:Ee,placeholder:e.$t("shop.pleaseInput"),class:"no-bt"},{label:r(()=>[t("div",Jt,u(e.$t("offline.mcPrice")),1)]),_:1},8,["modelValue","placeholder"])]),m(n,{class:"no-bt","input-align":"right",type:$.value?"digit":"number",autocomplete:"off",modelValue:o.value.goodsDiscountRatio,"onUpdate:modelValue":s[10]||(s[10]=d=>o.value.goodsDiscountRatio=d),formatter:ye,placeholder:`${e.$t("shop.pleaseInput")}${l(A)[0]}-${l(A)[1]}`,onBlur:Ge},{label:r(()=>[t("div",Yt,u(`${e.$t("offline.discountRatio")} `),1)]),"right-icon":r(()=>[Zt]),_:1},8,["type","modelValue","placeholder"])]),l(k).isOnlyView?R("",!0):(b(),T("div",Wt,[!l(B).query.goodsId||o.value.goodsStatus!==1?(b(),z(G,{key:0,round:"",type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-full border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:s[11]||(s[11]=d=>to()),loading:l(y)},{default:r(()=>[te(u(e.$t("goods.saveDraft")),1)]),_:1},8,["loading"])):R("",!0),m(G,{round:"",class:Q(["flex-1 min-w-[130px] h-[46px] text-base font-semibold",l(j)?"bg-b4 text-b2":"bg-btnOrBg text-b1"]),disabled:l(j),onClick:s[12]||(s[12]=d=>so()),loading:l(y)},{default:r(()=>[te(u(e.$t("goods.upimmediately")),1)]),_:1},8,["disabled","class","loading"])])),l(Y)?(b(),z(Fo,{key:2,list:f.value,level:i.value,id:L.value,onSelect:Xe,onClose:s[13]||(s[13]=d=>l(ne)(!1))},null,8,["list","level","id"])):R("",!0),l(V)?(b(),z(Ao,{key:3,id:l(a).brandId,name:l(a).brandName,onSelect:Ze,onClose:s[14]||(s[14]=d=>l(O)(!1))},null,8,["id","name"])):R("",!0),l(X)?(b(),z(it,{key:4,ids:l(a).storeIds,rootId:l(a).brandId,rootName:l(a).brandName,onSelect:We,onChangeBrand:Ye,onClose:s[15]||(s[15]=d=>l(U)(!1))},null,8,["ids","rootId","rootName"])):R("",!0),m(xo,{noClose:"",name:e.$t("offline.published_success"),show:l(F),onClose:s[17]||(s[17]=d=>l(M)(!1))},{default:r(()=>[t("div",es,u(e.$t("offline.published_success_desc")),1),t("div",os,[t("div",{class:"flex-1 h-[46px] leading-[44px] rounded-full text-center border border-solid-b4 mr-3",onClick:ao},u(e.$t("flashSale.check-the-details")),1),t("div",{class:"flex-1 h-[46px] leading-[46px] rounded-full text-center bg-yellow",onClick:s[16]||(s[16]=d=>Ve())},u(e.$t("common.back list")),1)])]),_:1},8,["name","show"])]}),_:1},8,["title"])}}const as=le({...ts,setup:ss}),vs=ro(as,[["__scopeId","data-v-50ac2a67"]]);export{vs as default};
