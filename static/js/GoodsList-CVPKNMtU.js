import{y as b,F as l,G as s,H as e,a4 as $,P as w,a2 as r,Q as v,_ as Y,a0 as Z,w as L,l as _,E as V,K as f,O as R,T as B,I as z,z as tt,r as k,N as et,bc as j,bd as H,J as st}from"./vendor-BUT0HZ5j.js";import{_ as E}from"./buy-cart-3M2I0Qjc.js";import{ak as ot,d as at,g as q,r as it}from"./index-hbwLMIYO.js";import{D as O}from"./goods-BVwS8oFG.js";import{_ as W}from"./ShopMaskTips-dKZ6_BUi.js";import{S as F}from"./shop-CeqcS6K2.js";import{_ as M}from"./GoodsPrice-Ai76_1qQ.js";import{b as nt}from"./mall-BLN1rOb_.js";import{W as lt}from"./WaterFull-CDtRtt9C.js";import{q as dt}from"./cart-BSpGAhYC.js";const ct=["src"],rt=b({name:"ActivePlaceholder"});function ut(t){return(m,d)=>{var o,y;return s(),l("div",{onClick:d[0]||(d[0]=$(u=>{var i;return w(ot)((i=t.info)==null?void 0:i.activePath)},["stop"])),class:"rounded-lg overflow-hidden min-h-[20px]"},[e("img",{src:t.type?(o=t.info)==null?void 0:o.activeImgGrid:(y=t.info)==null?void 0:y.activeImg,alt:""},null,8,ct)])}}const J=b({...rt,props:{info:null,type:null},setup:ut}),mt={key:0,class:"text-xs bg-[#FBA923] rounded-sm px-1 leading-normal mr-2.5 whitespace-nowrap text-white"},K=b({props:{type:{default:0}},setup(t){return(m,d)=>t.type!==w(F).SD?(s(),l("div",mt,v(t.type===w(F).SL?"精":t.type===w(F).PR?"优":"星"),1)):r("",!0)}}),gt={class:"absolute top-0 right-0 items-center gap-1 px-1.5 py-1 text-xs font-normal bg-ratio text-black-800 no-wrap rounded-tr-lg rounded-bl-lg"},vt={class:"font-semibold"},ft=Z("%"),yt=b({props:{ratio:null,tag:null},setup(t){const{ratio:m,tag:d}=t;return(o,y)=>(s(),l("div",gt,[e("span",null,v(t.tag||o.$t("common.ratio")),1),e("span",null,[e("span",vt,v(w(at)(t.ratio||0)),1),ft])]))}}),Q=Y(yt,[["__scopeId","data-v-6a6fc0c6"]]),ht={key:1,class:"relative w-full h-full text-right bg-white rounded-lg"},xt={class:"w-full max-h-[250px] relative overflow-hidden"},kt=["src"],$t={class:"px-1.5 pb-2.5"},wt={key:0,class:"mb-0.5 text-black-900 text-sm mt-1 text-left leading-normal flex items-center"},bt={class:"font-semibold line-clamp-1 h-[22px] leading-[22px]"},Tt={key:1,class:"w-full mb-1"},pt={key:2,class:"text-xs leading-tight tracking-tight text-left line-clamp-2 text-black-400"},Ct={class:"flex items-center mt-1 text-sm font-bold"},It={class:"flex-1 pr-1.5"},Pt={class:"mr-1.5 max-w-[60px] line-clamp-1 opacity-60 text-xxs"},St={class:"text-black mr-2.5 flex items-center"},At={class:"mr-1 underline text-xxs underline-offset-2 whitespace-nowrap"},Bt=e("span",null," > ",-1),qt=e("div",{class:"w-5 h-5 rounded-full flex justify-center items-center bg-[#FBA923] text-white text-sm"}," + ",-1),Ft=[qt],Lt=e("img",{class:"w-6 h-6",src:E},null,-1),Dt=[Lt],Nt=b({name:"GoodsGridItem"});function Gt(t,{emit:m}){const{t:d}=L(),o=_(),y=n=>{o.push(n)},u=n=>{n.goods.id&&o.push(`goodsDetail?id=${n.goods.id}`)},i=async n=>{if(n.goods.stock===0&&n.goods.goodsTypes!=2){B(d("order.Insufficient stock"));return}m("handleAddCart",n.goods)};return(n,a)=>{var C;const T=V("van-skeleton");return s(),l("div",{class:"mb-2 text-center",onClick:a[5]||(a[5]=g=>u(t.item))},[(C=t.item)!=null&&C.activeType?(s(),f(J,{key:0,info:t.item,type:"grid",onHandleTo:a[0]||(a[0]=g=>y(g))},null,8,["info"])):t.item.goods?(s(),l("div",ht,[e("div",xt,[(t.item.goods.status!=1||!+t.item.goods.stock)&&t.item.goods.goodsTypes!=2?(s(),f(W,{key:0,status:t.item.goods.status,stock:t.item.goods.stock},null,8,["status","stock"])):r("",!0),e("img",{src:t.item&&t.item.goods&&t.item.goods.icons&&t.item.goods.icons.split(",")[0]||w(q)("images/activity/boutique/squre_empty.png"),alt:"",class:"object-cover w-full h-auto aspect-square rounded-t-lg bg-black-100"},null,8,kt),t.item.goods.payType!==2&&t.item.goods.deliveryType===w(O).online?(s(),f(Q,{key:1,tag:n.$t("common.rebate"),ratio:t.item.goods.discountRatio||0},null,8,["tag","ratio"])):r("",!0)]),e("div",$t,[t.item.goods.goodsName?(s(),l("div",wt,[t.item.goods.type?(s(),f(K,{key:0,type:t.item.goods.type,class:"inline-block mr-1 align-text-top"},null,8,["type"])):r("",!0),e("span",bt,v(t.item.goods.goodsName||"-"),1)])):r("",!0),t.item.goods.id?r("",!0):(s(),l("div",Tt,[R(T,{row:t.index%2==0?1:2,class:"mx-2","row-width":["100%"]},null,8,["row"])])),t.item.goods.goodsDesc?(s(),l("div",pt,v(t.item.goods.goodsDesc),1)):r("",!0),e("div",Ct,[e("div",It,[t.item.goods.payType!==2?(s(),f(M,{key:0,color:"#000000",class:"text-base",price:t.item.goods.price},null,8,["price"])):r("",!0)])]),e("section",{class:"mt-1.5 flex-center-bw",onClick:a[4]||(a[4]=$(()=>{},["stop"]))},[e("div",{class:"items-center text-xs flex-center text-default",onClick:a[1]||(a[1]=$(g=>y(`/category?deliveryType=1&shopId=${t.item.stores.id}`),["stop"]))},[e("span",Pt,v(t.item.stores.storeName),1),e("div",St,[e("div",At,v(n.$t("collect.intoShop")),1),Bt])]),t.item.goods.deliveryType===1?(s(),l("div",{key:0,onClick:a[2]||(a[2]=$(g=>i(t.item),["stop"])),class:""},Ft)):(s(),l("div",{key:1,onClick:a[3]||(a[3]=$(g=>u(t.item),["stop"]))},Dt))])])])):r("",!0)])}}const jt=b({...Nt,props:{item:null,index:null},emits:["handleAddCart"],setup:Gt}),Ht={class:"w-[110px] h-[110px] relative"},Vt=["src"],Rt={class:"ml-2 flex-1 w-[0px]"},zt={class:"text-sm flex items-center mb-1.5 relative"},Et={class:"text-sm font-semibold leading-[0.875rem] truncate text-default"},Ot={class:"flex items-center"},Wt={class:"flex-1"},Mt={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},Jt={class:"flex text-sm font-bold items-center mt-1.5"},Kt={class:"items-center text-xs flex-center text-default"},Qt={class:"mr-1 underline text-xxs"},Ut=e("span",null," > ",-1),Xt={key:0,class:"text-xxs text-black-400"},Yt=["onClick"],Zt={key:0,class:"w-5 h-5 rounded-full flex justify-center items-center bg-[#FBA923] text-white text-sm"},_t={key:1,class:"w-6 h-6",src:E},te=e("div",{class:"flex items-center h-2.5"},[e("div",{class:"h-[1px] w-full bg-black-100"})],-1),ee=b({props:{data:null},emits:["handleTo","handleAddCart","click"],setup(t,{emit:m}){const d=t,{t:o}=L(),y=async()=>{if(d.data.goods.stock===0&&d.data.goods.goodsTypes!=2){B(o("order.Insufficient stock"));return}d.data.goods.deliveryType===1?m("handleAddCart",d.data.goods):m("click")};return(u,i)=>{var n,a;return s(),l(z,null,[(n=t.data)!=null&&n.activeType?(s(),f(J,{key:0,info:t.data,onHandleTo:i[0]||(i[0]=T=>m("handleTo",T))},null,8,["info"])):(a=t.data)!=null&&a.goods?(s(),l("section",{key:1,class:"flex items-start justify-between rounded-lg bg-white p-2.5 w-full",onClick:i[4]||(i[4]=T=>m("click"))},[e("div",Ht,[(t.data.goods.status!=1||!+t.data.goods.stock)&&t.data.goods.goodsTypes!=2?(s(),f(W,{key:0,status:t.data.goods.status,stock:t.data.goods.stock},null,8,["status","stock"])):r("",!0),e("img",{src:t.data&&t.data.goods&&t.data.goods.icons&&t.data.goods.icons.split(",")[0]||w(q)("images/activity/boutique/squre_empty.png"),alt:"",class:"rounded-lg w-[110px] h-[110px] aspect-square object-cover"},null,8,Vt),t.data.goods.payType!==2&&+t.data.goods.deliveryType===w(O).online?(s(),f(Q,{key:1,class:"flex-shrink-0 ml-auto",tag:u.$t("common.rebate"),ratio:t.data.goods.discountRatio||0},null,8,["tag","ratio"])):r("",!0)]),e("section",Rt,[e("div",zt,[t.data.goods.type?(s(),f(K,{key:0,type:t.data.goods.type,class:"mr-1",style:{flex:"0 0 auto"}},null,8,["type"])):r("",!0),e("div",Et,v(t.data.goods.goodsName),1)]),e("div",Ot,[e("div",Wt,[e("div",Mt,v(t.data.goods.goodsDesc),1),e("div",Jt,[t.data.goods.payType!==2?(s(),f(M,{key:0,price:t.data.goods.price,class:"text-base",color:"#000000"},null,8,["price"])):r("",!0)])])]),e("section",{class:"mt-5 flex-center-bw",onClick:i[3]||(i[3]=$(()=>{},["stop"]))},[e("div",Kt,[e("span",{class:"mr-1.5 max-w-[100px] line-clamp-1 text-xxs text-[#999999]",onClick:i[1]||(i[1]=$(T=>m("handleTo",`/category?deliveryType=1&shopId=${t.data.stores.id}`),["stop"]))},v(t.data.stores.storeName),1),e("div",{class:"text-black mr-2.5 flex items-center",onClick:i[2]||(i[2]=$(T=>m("handleTo",`/category?deliveryType=1&shopId=${t.data.stores.id}`),["stop"]))},[e("div",Qt,v(u.$t("collect.intoShop")),1),Ut]),t.data.goods.volume15>=100?(s(),l("div",Xt,v(u.$t("mall.15th sale",{salesVolume:t.data.goods.volume15||0})),1)):r("",!0)]),e("div",{onClick:$(y,["stop"]),class:"px-2"},[t.data.goods.deliveryType===1?(s(),l("div",Zt," + ")):(s(),l("img",_t))],8,Yt)])])])):r("",!0),te],64)}}}),se={key:0},oe=b({name:"mallGoodsList"});function ae(t,{expose:m,emit:d}){const o=t,{t:y}=L();tt(()=>o.viewFormat,c=>{c===1&&console.log(c)},{deep:!0});const u=k([]),i=k(!1),n=k(!1),a=k(0),T=k(10),C=k(0),g=k([]),I=k(0),U=k,D=async()=>{o.isSearchPage&&!o.searchParam.keyword&&!o.searchParam.classId||(i.value=!0,a.value+=1,await X(),setTimeout(()=>{i.value=!1},1e3))},X=async()=>{var h,P,x,S,A;const c=await nt({page:a.value,size:T.value,status:1,...o.searchParam,sortType:o.sortType});if(!c.success){n.value=!0;return}if(!c.data||!c.total||!((h=c.data)!=null&&h.length)){n.value=!0;return}if(C.value=c.total,g.value=c.data.map(p=>({goods:p.goods,stores:p.stores||U,card:p.card})),a.value===1&&!o.isSearchPage){const p={activeType:1,activePath:"/boutique-goods",activeImg:q("images/activity/advertise/Boutique.png"),activeImgGrid:q("images/activity/advertise/Boutique-grid.png")};I.value+=1,g.value.unshift(p)}if(a.value===2&&((P=o.activeInfo)!=null&&P.id)){const p={activeType:1,activePath:(x=o.activeInfo)==null?void 0:x.url,activeImg:((S=o.activeInfo)==null?void 0:S.activityListImgs)||null,activeImgGrid:((A=o.activeInfo)==null?void 0:A.activityWaterfallImgs)||null,...o.activeInfo};g.value.unshift(p),I.value+=1}u.value=a.value===1?g.value:u.value.concat(g.value),u.value.length-I.value>=C.value&&(n.value=!0)},{loadingToggle:N}=it(),G=async c=>{if(c.stock===0&&c.goodsTypes!=2){B(y("order.Insufficient stock"));return}N(!0);const h=await dt(c.id);N(!1),h.success&&(d("successAdd"),B(y("cart.addTips")))};return m({handleSearch:async()=>{u.value=[],a.value=0,C.value=0,I.value=0,n.value=!1,document.querySelector("#fm-page").scrollTo(0,0),await D()},list:u}),(c,h)=>{const P=V("VanList");return s(),f(P,{loading:i.value,"onUpdate:loading":h[2]||(h[2]=x=>i.value=x),finished:n.value,"finished-text":c.$t("common.noMore"),"loading-text":c.$t("common.loading"),onLoad:D},{default:et(()=>[u.value.length>0?(s(),l("div",se,[j(R(lt,{isSearchPage:t.isSearchPage,value:g.value,addTime:200,cardComponent:jt,onHandleTo:h[0]||(h[0]=x=>d("handleTo",x)),onHandleAddCart:G},null,8,["isSearchPage","value"]),[[H,t.viewFormat===0]]),j(e("div",null,[(s(!0),l(z,null,st(u.value,(x,S)=>(s(),f(ee,{key:S,data:x,onClick:()=>d("handleTo",`${t.goodsPath}?id=${x.goods.id}`),onHandleTo:h[1]||(h[1]=A=>d("handleTo",A)),onHandleAddCart:G},null,8,["data","onClick"]))),128))],512),[[H,t.viewFormat===1]])])):r("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}const ye=b({...oe,props:{searchParam:{default:()=>({keyword:"",sortType:1,orderBy:1,classId:null})},sortType:null,goodsPath:{default:"/goodsDetail"},viewFormat:{default:0},isSearchPage:{type:Boolean,default:!1},activeInfo:null},emits:["handleTo","successAdd"],setup:ae});export{ye as _,J as a};
