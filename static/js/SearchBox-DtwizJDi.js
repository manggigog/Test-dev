import{_ as ve,y as fe,w as he,bc as R,x as Z,o as I,r as u,bd as ye,z as Te,E as w,F as v,G as f,H as s,O as c,N as h,Q as i,bI as we,P as n,a2 as ge,I as D,J as O,R as k,a4 as W,$ as j,Y as be,Z as Ce}from"./vendor-CjApaIpB.js";import{_ as _e}from"./search-Dwmdj_3F.js";import{_ as De}from"./filter-B5MATEpa.js";import{a as ke}from"./category-B-Z_123B.js";import{u as Se,e as xe,a6 as S}from"./index-lKIcPnY0.js";import{D as Y}from"./goods-BVwS8oFG.js";import{S as $e}from"./shop-CeqcS6K2.js";const X=p=>(be("data-v-4f4218b8"),p=p(),Ce(),p),Ve={class:"flex items-center"},Ie={class:"flex-1 bg-white rounded-3xl search-input-box"},Ye=X(()=>s("div",null,[s("img",{src:_e,class:"w-4 h-4"})],-1)),Me=X(()=>s("img",{src:De,class:"w-full h-full"},null,-1)),Ee=[Me],Fe={class:"px-5"},Be={class:"mt-[18px] font-semibold text-base text-center"},Le={class:"text-sm font-semibold mt-4"},Ne={class:"flex items-center gap-2 mt-3"},Pe=["onClick"],Ue={class:"text-sm font-semibold mt-4"},Re={class:"flex items-center gap-2 mt-3 overflow-x-auto"},Oe=["onClick"],je={class:"mt-3 flex-start"},Ke={class:"mx-2"},ze={class:"text-sm font-semibold mt-4"},Ae={class:"flex flex-wrap items-center gap-3 mt-3"},Ge=["onClick"],qe={class:"pt-8 pb-4 flex-center-bw"},He={class:"text-base font-normal"},Je={class:"text-base font-semibold"},Qe=fe({props:{modelValue:null,deliveryType:{default:Y.online},shopType:null,shopInfo:null},emits:["update:modelValue","onSubmit","onFilter"],setup(p,{emit:x}){const r=p,{getCurrentStoreId:ee}=Se(),{serviceCategoriesStore:te}=xe(),{t:y}=he(),[M,$]=R(!1),K=Z(()=>r!=null&&r.shopType?[{id:-1,name:y("common.all")},{id:$e.SD,name:y("common.ordinary")},{id:r==null?void 0:r.shopType,name:y(`common.shop_type_${r==null?void 0:r.shopType}`)}]:[]),z=I().format("YYYY-MM-DD"),E=I().subtract("days",7).format("YYYY-MM-DD"),F=I().subtract("month",1).format("YYYY-MM-DD"),B=I().subtract("month",3).format("YYYY-MM-DD"),oe=Z(()=>[{id:1,label:y("shop.Last 7 days")},{id:2,label:y("shop.last month")},{id:3,label:y("shop.last 3 months")}]),[L,N]=R(!1),[P,V]=R(!1),d=u(new Date),g=u(new Date),se=u(new Date(new Date("2020/1/1").getTime())),b=u(new Date(new Date("2020/1/1").getTime())),l=ye({startTime:null,endTime:null}),A=u(null),le=()=>{x("onSubmit"),A.value.blur()},ne=()=>{l.startTime=null,l.endTime=null,T.value=null,C.value=null,d.value=new Date,g.value=new Date,_.value=-1,q()},G=()=>{N(!1),V(!1),(!l.startTime||!l.endTime)&&(l.endTime=null,l.startTime=null)},ae=e=>{d.value=new Date(S(e)),b.value=new Date(new Date(e).getTime()),l.startTime=S(d.value.toString()),T.value=null,N(!1),V(!0)},ie=e=>{g.value=new Date(S(e)),l.startTime=S(d.value.toString()),l.endTime=S(e),T.value=null,V(!1)},T=u(null),re=e=>{if(T.value!==e){switch(g.value=new Date(z),l.endTime=z,e){case 1:l.startTime=E,d.value=new Date(E),b.value=new Date(new Date(E).getTime()+60*1e3);break;case 2:l.startTime=F,d.value=new Date(F),b.value=new Date(new Date(F).getTime()+60*1e3);break;case 3:l.startTime=B,d.value=new Date(B),b.value=new Date(new Date(B).getTime()+60*1e3);break}T.value=e}},U=u([]),C=u(null),_=u(-1),de=async()=>{var t;const e=await ke({address:(t=await ee())==null?void 0:t.merchant});U.value=(e.data||[]).map(m=>({...m,goodsCategoryName:m==null?void 0:m.name,goodsCategoryId:m==null?void 0:m.id}))},me=e=>{C.value!==e&&(C.value=e)},q=()=>{const e={upStartTime:l.startTime?l.startTime+" 00:00:00":null,upEndTime:l.endTime?l.endTime+" 23:59:59":null,subclassId:C.value,type:_.value};_.value<0&&delete e.type,x("onFilter",e),$(!1)};return Te(()=>r.deliveryType,e=>{e===Y.online?de():U.value=te.categoriesTree},{immediate:!0}),(e,t)=>{const m=w("VanField"),H=w("van-datetime-picker"),J=w("van-popup"),ue=w("van-icon"),Q=w("VanButton"),ce=w("VanPopup");return f(),v(D,null,[s("div",Ve,[s("div",Ie,[c(m,{ref:(a,o)=>{o.searchRef=a,A.value=a},onKeyup:we(le,["enter"]),"model-value":p.modelValue,"onUpdate:modelValue":t[1]||(t[1]=a=>x("update:modelValue",a)),placeholder:e.$t("mall.Enter search keywords"),class:"w-[100% - 20px] text-center bg-transparent items-center",clearable:"",enterkeyhint:"search"},{"left-icon":h(()=>[Ye]),"right-icon":h(()=>[s("div",{onClick:t[0]||(t[0]=a=>x("onSubmit")),class:"text-newOrigin font-semibold leading-5"},i(e.$t("common.search")),1)]),_:1},8,["onKeyup","model-value","placeholder"])]),s("div",{class:"flex-shrink-0 w-5 h-5 ml-2",onClick:t[2]||(t[2]=a=>n($)(!0))},Ee)]),c(ce,{teleport:"body",show:n(M),"onUpdate:show":t[9]||(t[9]=a=>j(M)?M.value=a:null),round:"",position:"bottom",closeable:"",style:{"min-height":"40%","min-width":"280px",left:"50%",transform:"translate3d(-50%, 0, 0)"},class:"sm:w-[375px]","close-on-click-overlay":"",onClickOverlay:t[10]||(t[10]=a=>n($)(!1)),onClickCloseIcon:t[11]||(t[11]=a=>n($)(!1))},{default:h(()=>{var a;return[s("div",Fe,[s("div",Be,i(p.deliveryType===n(Y).online?e.$t("shop.Product filter"):e.$t("offline.goods_filter")),1),(a=n(K))!=null&&a.length?(f(),v(D,{key:0},[s("div",Le,i(p.deliveryType===n(Y).online?e.$t("shop.Shop goods type"):e.$t("offline.goods_type")),1),s("div",Ne,[(f(!0),v(D,null,O(n(K),o=>(f(),v("div",{key:o.id,class:k(["flex-1 type-cell",{"cell-active":o.id===_.value}]),onClick:()=>{_.value=o.id}},i(o.name),11,Pe))),128))])],64)):ge("",!0),s("div",Ue,i(e.$t("shop.Added time")),1),s("div",Re,[(f(!0),v(D,null,O(n(oe),o=>(f(),v("div",{class:k(["type-cell flex-1",{"cell-active":T.value==o.id}]),key:o.id,onClick:pe=>re(o.id)},i(o.label),11,Oe))),128))]),s("div",je,[s("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:t[3]||(t[3]=W(o=>n(N)(!0),["stop"]))},[s("div",{class:k({"opacity-30":!n(l).startTime})},i(n(l).startTime||e.$t("goods.selectStartTime")),3)]),c(J,{show:n(L),"onUpdate:show":t[5]||(t[5]=o=>j(L)?L.value=o:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:h(()=>[c(H,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=o=>d.value=o),"min-date":se.value,type:"date",title:e.$t("goods.selectStartTime"),onCancel:G,onConfirm:ae},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),s("div",Ke,[c(ue,{name:"minus"})]),s("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:t[6]||(t[6]=W(o=>n(V)(!0),["stop"]))},[s("div",{class:k({"opacity-30":!n(l).endTime})},i(n(l).endTime||e.$t("goods.selectEndTime")),3)]),c(J,{show:n(P),"onUpdate:show":t[8]||(t[8]=o=>j(P)?P.value=o:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:h(()=>[c(H,{modelValue:g.value,"onUpdate:modelValue":t[7]||(t[7]=o=>g.value=o),onConfirm:ie,"min-date":b.value,onCancel:G,type:"date",title:e.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),s("div",ze,i(e.$t("shop.Shop Category")),1),s("div",Ae,[(f(!0),v(D,null,O(U.value,o=>(f(),v("div",{class:k(["px-3 type-cell",{"cell-active":C.value==o.goodsCategoryId}]),key:o.goodsCategoryId,onClick:pe=>me(o.goodsCategoryId)},i(o.goodsCategoryName),11,Ge))),128))]),s("div",qe,[c(Q,{round:"",class:"!border-b4 text-b1 flex-1 h-[46px] mr-3",onClick:ne},{default:h(()=>[s("span",He,i(e.$t("common.reset")),1)]),_:1}),c(Q,{round:"",class:"btn-yellow flex-1 h-[46px] border-0",onClick:q},{default:h(()=>[s("span",Je,i(e.$t("common.confirm")),1)]),_:1})])])]}),_:1},8,["show"])],64)}}}),lt=ve(Qe,[["__scopeId","data-v-4f4218b8"]]);export{lt as S};
