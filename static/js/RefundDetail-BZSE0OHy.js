import{_ as Be,z as Ee,a2 as Ie,x as De,r as k,y as u,o as Ne,E as Ve,ad as Le,G as i,H as r,P as h,$ as m,q as Oe,F as R,U as d,Z as D,O as o,J as ie,K as Pe,I as t,a4 as y,Q as a,N as Ke,a3 as le,T as de,X as je,Y as Me}from"./vendor-Dr_RpJ_Y.js";import{_ as M}from"./copy-CQ_1jpuF.js";import{R as Ue}from"./RefundGoodItem-1PgT-WcT.js";import{i as Ge,V as He,b as ze,h as K,f as j,r as Je,w as We}from"./index-LRhcxFAI.js";import{_ as qe}from"./RecommendationFeed-CS4X1ZMu.js";import{C as Ye}from"./CommonVanProvider-KZuKVOde.js";import{P as Y}from"./flashSale-DDyqLyYN.js";import{a as Qe,c as Xe,n as Ze}from"./order-CCndJpZE.js";import{g as et}from"./refund-BDqMlYOE.js";import{g as tt,c as st,n as ot}from"./useOrderStatus-Ch6Txdaf.js";import{u as at}from"./useRefund-C-IvWu5-.js";import{l as nt,t as rt}from"./useOrderActionButtons-CMkfPUL1.js";import"./GoodsItem-r7Vc6Yzk.js";import"./credit-EZuPIBEN.js";import"./mcoin-logo-1-Deho8IWN.js";import"./useShipTemplate-Cz7Cav1B.js";import"./enums-DlE-aiss.js";import"./GoodsItem-BZ7xTQ5M.js";import"./buy-cart-m4kq4Bzt.js";import"./goods-BVwS8oFG.js";import"./ShopMaskTips-ClYuWX9C.js";import"./GoodsPrice-Dz5PcG19.js";import"./MCOIN-Bodfn-v1.js";import"./shop-CeqcS6K2.js";import"./mall-B6FBC7ih.js";import"./WaterFull-BoFTr9ol.js";/* empty css                                                              */import"./useShowActiveInfo-C3oF9tFm.js";import"./BackIcon-CDrGaEPo.js";const ut=""+new URL("../images/ic_round-auto-mode-l7j5TmeY.png",import.meta.url).href,N=V=>(je("data-v-1d954aa0"),V=V(),Me(),V),it={class:"refund-detail__container bg-transparent bg-gray1"},lt={key:0,class:"px-2 py-4 mt-3 bg-white rounded-xl"},dt={key:0},ct={class:"flex items-start",style:{}},ft={key:0,class:"flex-1 w-full pl-1 ml-1 opacity-60 line flex-nowrap"},mt={key:1,class:"text-[#2E2008] text-xs"},pt={key:0,class:"flex-1 mt-2 text-xs opacity-60"},vt={key:1,class:"flex items-start",style:{}},ht={class:"w-2/6"},yt={key:1},_t={class:"flex items-center justify-between"},wt={class:"gap-2 flex-start"},xt=N(()=>t("img",{src:ut,class:"w-[16px]"},null,-1)),gt={class:"text-[#2E2008] font-semibold"},Tt={class:"flex items-center justify-between mt-3"},bt={class:"opacity-60 text-[#2E2008]"},kt={class:"font-semibold"},Ct={key:0,class:"mt-2 text-xs opacity-60"},Ft={key:1,class:"mt-2 text-xs opacity-60"},St={key:2,class:"opacity-60 text-[#2E2008] mt-3"},At={key:0,class:"mt-4 flex-center-bw"},Rt={class:"opacity-60"},$t={class:"mt-4 flex-center-bw"},Bt={class:"opacity-60"},Et={key:2},It={class:"mt-4 flex-center-bw"},Dt={class:"opacity-60"},Nt=N(()=>t("img",{src:M,class:"w-4 h-4 ml-2",alt:""},null,-1)),Vt={class:"mt-4 flex-center-bw"},Lt={class:"opacity-60"},Ot=N(()=>t("img",{src:M,class:"w-4 h-4 ml-2",alt:""},null,-1)),Pt={class:"mt-4 flex-center-bw"},Kt={class:"opacity-60"},jt=N(()=>t("img",{src:M,class:"w-4 h-4 ml-2",alt:""},null,-1)),Mt={class:"mt-4 flex-center-bw"},Ut={class:"opacity-60"},Gt=N(()=>t("img",{src:M,class:"w-4 h-4 ml-2",alt:""},null,-1)),Ht={class:"mt-4 flex-center-bw"},zt={class:"opacity-60"},Jt={class:"mt-4 flex-center-bw"},Wt={class:"opacity-60"},qt={class:"flex justify-between gap-2 mt-4 text-right break-all"},Yt={class:"opacity-60 whitespace-nowrap"},Qt={key:2,class:"flex flex-wrap items-center justify-center gap-[20px] mt-[15px] overflow-hidden"},Xt={key:3,class:"mt-3 flex justify-center text-sm text-[#2E2008]"},Zt={class:"text-sm leading-6 text-black"},es={class:"text-primary"},ts={key:4,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},ss=Ee({setup(V){const{loadingToggle:Q}=We(),{senderForceCancel:ce,senderCancelUnsend:fe}=Ge(),{getUserDhKey:X,decryptAddressKey:me,decryptKey:Z}=He(),{checkLoginAuth:pe}=ze(),[U,ee]=Ie(!1),{t:l}=De(),ve=Ne(),he=Oe(),n=k(null),c=u(()=>n.value.refundInfo||{}),ye=ve.query.id,$=k(null),L=k(!1),B=k(0),G=k(!1),_e=()=>{G.value=!0},C=u(()=>{const{refundStatus:e,returnStatus:s,merchantInterveneStatus:F}=c.value;return e===1?1:e===2&&s==2&&!F?2:null}),H=u(()=>!!C.value),we=u(()=>{const{refundType:e}=c.value,s=e==1?l("refund.apply refund"):"申请退货退款";return n.value.payType===Y.STORE_CARD?[{title:s,value:0},{title:l("order.status4"),value:1},{title:l("order.blok comfirm"),value:2},{title:l("refund.refund success tips"),value:3}]:[{title:s,value:0},{title:l("refund.waiting deal with"),value:1},{title:l("order.blok comfirm"),value:2},{title:l("refund.refund success tips"),value:4}]}),xe=u(()=>{const{refundStatus:e}=c.value;return C.value==2?1:e}),te=u(()=>{var e;return((e=n.value)==null?void 0:e.payType)===Y.STORE_CARD||!H.value?!1:B.value>0&&!G.value}),ge=u(()=>C.value==2?"退货待商家收货中，超时未处理您可申请强制退款":l("refund.waiting refund tips")),Te=u(()=>C.value==2?"商家未收货您可申请强制退款":l("refund.not delivered the goods")),se=u(()=>{var e;return((e=c.value)==null?void 0:e.refundStatus)===6}),be=u(()=>{var e;return((e=n.value.refundInfo)==null?void 0:e.refundStatus)==1}),ke=async()=>{Q(!0);const{success:e}=await et({orderId:n.value.id});Q(!1),e&&(de(l("common.revoke success")),O())},z=k(!1),Ce=()=>{z.value=!0},J=u(()=>_.value.time),Fe=u(()=>_.value.type===5&&J.value>0&&!z.value),oe=u(()=>_.value.type===5&&(J.value===0||z.value)),W=k(!1),_=u(()=>{const e=new Date().getTime()/1e3;return nt(n.value,e)}),Se=async()=>{W.value=!0;try{const s=(await Xe({orderIds:n.value.id+""})).data.ordIds,E=_.value.type===5||_.value.type===6||_.value.type===8?await ce(s[0]):await fe(s[0]);if(!E.success||!(await Ze({ordIds:s,hash:E.result.transactionHash})).success)return;L.value=!0,setTimeout(()=>{O(),$.value=setInterval(()=>{L.value?O():(clearInterval($.value),$.value=null)},3e3)},1500)}catch(e){de(e.message||e)}finally{W.value=!1}},Ae=u(()=>oe.value||ae.value||ne.value||re.value),Re=u(()=>{if(oe.value)return l("refund.directly force a refund");if(ae.value)return"经平台介入支持买家，您可直接强制退款";if(ne.value)return l("refund.not delivered the goods");if(re.value)return l("refund.refund has been forced")}),ae=u(()=>_.value.type===6),ne=u(()=>!n.value||n.value.payType===Y.STORE_CARD||!H.value?!1:B.value<=0||G.value),re=u(()=>rt(n.value)),O=async()=>{var S,g,P,T,b,I,f,w,p,x;const e=JSON.parse(JSON.stringify(n.value)),s=await Qe({id:ye});if((S=s.data)!=null&&S.userAddress&&(s.data.userAddress.postscript=s.data.postscript),(g=s.data)!=null&&g.userAddress&&((T=(P=s.data)==null?void 0:P.userAddress)!=null&&T.encryptFlag)){const v=await X(s.data.stores.id,(b=s.data)==null?void 0:b.submitMerchantPubKey);v&&(s.data.userAddress=me(s.data.userAddress,v))}if(s.data.shippingHash){const v=await X(s.data.stores.id,(I=s.data)==null?void 0:I.shippingMerchantPubKey);if(v){const A=Z(s.data.expressNo,v);A.hash===s.data.shippingHash&&(s.data.expressNo=A.decrypt,s.data.expressCompany=Z(s.data.expressCompany,v).decrypt)}}n.value=s.data;const{refundStatus:F,returnStatus:E,merchantInterveneStatus:q}=c.value;if(C.value==1){const v=new Date((f=c.value)==null?void 0:f.submitTime).getTime()/1e3,A=new Date().getTime()/1e3;B.value=tt(v,A)}else if(C.value==2){const v=new Date((w=c.value)==null?void 0:w.expressTime).getTime()/1e3,A=new Date().getTime()/1e3;B.value=st(v,A)}L.value&&(e.payType==n.value.payType&&((p=e.refundInfo)==null?void 0:p.refundStatus)==((x=c.value)==null?void 0:x.refundStatus)||(L.value=!1))},$e=u(()=>at(n.value,!0)),ue=()=>{he.push(`/category?deliveryType=1&shopId=${n.value.stores.id}`)};return Ve(async()=>{pe(!0)&&await O()}),Le(()=>{clearInterval($.value),$.value=null}),(e,s)=>{const F=R("van-count-down"),E=R("VanStep"),q=R("VanSteps"),S=R("van-icon"),g=R("VanButton"),P=R("i18n-t");return r(),i("div",it,[h(Ye,{title:e.$t("order.refund title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage h-full px-3","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(T,b)=>{b.shopGoodsRef=T}},{default:m(()=>{var T,b,I;return[n.value?(r(),i("div",lt,[o(H)?(r(),i("div",dt,[h(q,{direction:"vertical",active:o(xe)},{default:m(()=>[(r(!0),i(ie,null,Pe(o(we),(f,w)=>(r(),D(E,{class:Ke(["text-xs",{"van-icon-checked::before":w===1}]),key:w},{default:m(()=>[w===1?(r(),i(ie,{key:0},[t("div",ct,[o(te)?(r(),i("div",ft,[h(F,{time:B.value,onFinish:_e},{default:m(p=>[y(a(e.$t("common.shop will",{time:p.days+e.$t("common.days")+p.hours+e.$t("common.hours")+p.minutes+e.$t("common.minutes")+p.seconds+e.$t("common.seconds")})),1)]),_:1},8,["time"])])):(r(),i("div",mt,a(o(Te)),1))]),o(te)?(r(),i("div",pt,a(o(ge)),1)):d("",!0)],64)):(r(),i("div",vt,[t("div",ht,a(f.title),1)]))]),_:2},1032,["class"]))),128))]),_:1},8,["active"])])):(r(),i("div",yt,[t("div",_t,[t("div",wt,[xt,t("div",gt,a(e.$t("refund.order status")),1)])]),t("div",Tt,[t("div",bt,a(e.$t("order.Current status of after-sales order")),1),t("div",kt,[t("span",null,a(o(ot)(n.value)||"--"),1)])]),o(se)?(r(),i("div",Ct,a(o(l)("refund.cancel order tips")),1)):d("",!0),o(se)?(r(),i("div",Ft,a(e.$t("common.cancel refund time"))+" ："+a(((T=o(c))==null?void 0:T.cancelTime)||"--"),1)):d("",!0),(b=o(c))!=null&&b.successTime?(r(),i("div",St,a(((I=o(c))==null?void 0:I.successTime)||"--"),1)):d("",!0)]))])):d("",!0),n.value?(r(),D(Ue,{key:1,order:n.value,isService:""},{default:m(()=>{var f,w,p;return[(f=o(c))!=null&&f.id?(r(),i("div",At,[t("div",Rt,a(e.$t("refund.No")),1),t("div",null,a(((w=o(c))==null?void 0:w.id)||"--"),1)])):d("",!0),t("div",$t,[t("div",Bt,a(e.$t("refund.reason text")),1),t("div",null,a(o($e)),1)]),o(U)?d("",!0):(r(),i("div",{key:1,class:"mt-4 text-center text-[#2E2008]",onClick:s[0]||(s[0]=le(x=>o(ee)(!0),["stop"]))},[t("span",null,a(e.$t("common.check more")),1),h(S,{class:"ml-2",name:"arrow-down"})])),o(U)?(r(),i("div",Et,[t("div",It,[t("div",Dt,a(e.$t("order.hash")),1),t("div",{class:"flex items-center",onClick:s[1]||(s[1]=x=>o(K)(n.value.hash))},[y(a(o(j)(n.value.hash,"***",9,5)||"-")+" ",1),Nt])]),t("div",Vt,[t("div",Lt,a(e.$t("order.create address")),1),t("div",{class:"flex items-center",onClick:s[2]||(s[2]=x=>o(K)(n.value.address))},[y(a(o(j)(n.value.address,"...",5,5))+" ",1),Ot])]),t("div",Pt,[t("div",Kt,a(e.$t("order.payAddress")),1),t("div",{class:"flex items-center",onClick:s[3]||(s[3]=x=>o(K)(n.value.payAddress))},[y(a(o(j)(n.value.payAddress,"...",5,5))+" ",1),jt])]),t("div",Mt,[t("div",Ut,a(e.$t("order.merchantAddress")),1),t("div",{class:"flex items-center",onClick:s[4]||(s[4]=x=>o(K)(n.value.stores.merchant))},[y(a(o(j)(n.value.stores.merchant,"...",5,5))+" ",1),Gt])]),t("div",Ht,[t("div",zt,a(e.$t("order.payTime")),1),t("div",null,a(o(Je)(n.value.createTime)),1)]),t("div",Jt,[t("div",Wt,a(e.$t("order.orderNumber")),1),t("div",null,a(n.value.id),1)]),t("div",qt,[t("div",Yt,a(e.$t("order.orderRemark")),1),t("div",null,a(((p=n.value.userAddress)==null?void 0:p.postscript)||"-"),1)])])):d("",!0),o(U)?(r(),i("div",{key:3,class:"mt-4 text-center text-[#2E2008]",onClick:s[5]||(s[5]=le(x=>o(ee)(!1),["stop"]))},[y(a(e.$t("refund.put way")),1),h(S,{class:"ml-2",name:"arrow-up"})])):d("",!0)]}),_:1},8,["order"])):d("",!0),n.value?(r(),i("div",Qt,[o(be)?(r(),D(g,{key:0,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:ke},{default:m(()=>[y(a(e.$t("refund.cancel refund")),1)]),_:1})):(r(),D(g,{key:1,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:ue},{default:m(()=>[y(a(e.$t("refund.make order")),1)]),_:1})),o(_).disabled?d("",!0):(r(),D(g,{key:2,loading:W.value,onClick:Se,disabled:o(_).disabled,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold"},{default:m(()=>[y(a(e.$t("order.forced refund")),1)]),_:1},8,["loading","disabled"])),h(g,{class:"text-[#FEA021] h-[40px] min-w-[130px] px-4 font-semibold btn-border",onClick:ue},{default:m(()=>[y(a(e.$t("refund.concat sales")),1)]),_:1})])):d("",!0),o(Fe)?(r(),i("div",Xt,[h(S,{name:"info-o",color:"red",size:"18px ",class:"mr-1"}),t("div",Zt,[h(F,{time:o(J),onFinish:Ce},{default:m(f=>[h(P,{keypath:"refund.userShopLockRefundTip",tag:"span"},{time:m(()=>[t("span",es,a(e.$t("refund.time",{days:f.days,hours:f.hours,minutes:f.minutes,seconds:f.seconds})),1)]),_:2},1024)]),_:1},8,["time"])])])):d("",!0),o(Ae)?(r(),i("div",ts," *"+a(o(Re)),1)):d("",!0),h(qe,{"title-text":o(l)("common.recommend_for_you"),class:"pt-[10px]"},null,8,["title-text"])]}),_:1},8,["title"])])}}}),Es=Be(ss,[["__scopeId","data-v-1d954aa0"]]);export{Es as default};
