import{_ as ge,r as c,y as T,D as ye,G as a,H as l,I as t,J as q,K as R,N as E,U as _,a1 as ke,Q as u,O as d,n as Ie,z as $e,o as xe,bl as Se,F as O,Z as H,$ as K,P as b,x as Te,E as Be,ad as Ve,a3 as X,X as Ae,Y as Le,q as Ne,a4 as je,T as _e}from"./vendor-Dr_RpJ_Y.js";import{_ as De,a as Fe}from"./collect-EjkhARjb.js";import{B as Oe,aQ as Pe,a as qe,b as Ee,Z as Ke,h as We,Y as ee,aR as Ge,w as ze,aK as Me,aL as Ue}from"./index-7OiUoGXy.js";import{u as Re}from"./useCityMap-CJiyuUmB.js";import{_ as be}from"./right-arrow-CaxjJ3WI.js";import{B as He}from"./BackIcon-CDrGaEPo.js";import{_ as Qe}from"./MCOIN-Bodfn-v1.js";import{_ as Ye}from"./ImgBoutiqueLable-B-2xCcw4.js";/* empty css                                                              *//* empty css                                                                 */import"./shop-CeqcS6K2.js";const Ze=["onClick","id"],Je={class:"relative"},Xe={class:"text-sm text-b3 font-normal flex items-center justify-center"},et={class:"label__wrap text-center"},tt={key:0,class:"fm-tab-underline"},st={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16},equalWidth:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(k,{emit:B}){const f=k,N=c(null),V=c(null),g=c([]),I=T(()=>Array.isArray(f.options)?f.options:Object.values(f.options));function y(m){return m[f.valueKey]===f.modelValue}function $(m){B("update:modelValue",m[f.valueKey]),B("change",m[f.valueKey])}ye(()=>f.modelValue,async()=>{f.scrollToSelected&&(await Ie(),w())},{immediate:!0});function w(){const m=I.value.findIndex(p=>y(p));if(m===-1)return;const h=document.getElementById(`fm-tab-item-${m}`),r=N.value;if(h&&r){const p=h.offsetLeft-(f.scrollOffset||0);r.scrollTo({left:p,behavior:"smooth"})}}return(m,h)=>(l(),a("div",{class:"fm-tab",ref:(r,p)=>{p.tabWrapper=r,N.value=r}},[t("div",{class:"flex flex-nowrap items-center w-full",ref:(r,p)=>{p.tabList=r,V.value=r}},[(l(!0),a(q,null,R(d(I),(r,p)=>(l(),a("div",{key:r[k.valueKey]??p,class:E([["fm-tab-item",{active:y(r)}],"relative w-1/2 flex justify-center items-center"]),onClick:S=>$(r),ref:(S,C)=>{C.tabItems=S,g.value=S},id:`fm-tab-item-${p}`},[t("div",Je,[t("p",Xe,[t("span",et,u(r[k.labelKey]),1),ke(m.$slots,"badge"+p,{},void 0,!0)]),y(r)?(l(),a("div",tt)):_("",!0)])],10,Ze))),128))],512)],512))}},ot=ge(st,[["__scopeId","data-v-591f336a"]]),lt={key:0},at={key:0},nt=["onClick"],rt={class:"text-base font-semibold text-b1 line-clamp-1"},ct=["onClick"],it={class:"shrink-0 w-[80px] h-[80px] rounded-lg overflow-hidden relative"},ut={class:"ml-2 w-full h-[80px] flex flex-col justify-between"},dt={class:"shrink-0"},ft={class:"text-sm text-b1 font-semibold line-clamp-1"},vt={class:"mt-1 text-sm text-b3 font-normal line-clamp-1"},pt={class:"shrink-0 flex items-center"},mt={class:"text-sm text-b1 font-semibold"},ht=$e({props:{params:{default:{}}},emits:["handleTo"],setup(k,{expose:B,emit:f}){const N=k,V=xe(),g=Se({page:0,size:99}),I=c(0),y=c(!1),$=c(!1),w=c([]),m=3,h=3,r=async()=>{y.value=!0,g.page+=1,await p(),y.value=!1},p=async()=>{const n=await Pe({...g,...N.params});if(!n.success){$.value=!0;return}if(!n.data||!n.data.records||!+n.data.total){$.value=!0;return}I.value=n.data.total,w.value=g.page===1?n.data.records:w.value.concat(n.data.records),w.value.length>=I.value&&($.value=!0)},S=c(!1),C=T(()=>w.value.filter(n=>+n.storeShopGoodsCount>0)),j=T(()=>S.value||C.value.length<=h?C.value:C.value.slice(0,h)),s=n=>n.goodsList.slice(0,m),W=()=>{S.value=!S.value},Q=n=>{f("handleTo","/shop?shopId="+n.shopId)},D=n=>{var A;const P=V.path.replace("storefront","offlineGoodsDetail");f("handleTo",P+("?goodsId="+n.goodsId)+("&storeId="+N.params.storeId)+((A=V.query)!=null&&A.child?"&child=1":""))};return B({total:I,finished:$,loading:y}),(n,P)=>{const A=O("VanImage"),Y=O("VanList");return l(),H(Y,{loading:y.value,"onUpdate:loading":P[0]||(P[0]=i=>y.value=i),finished:$.value,"loading-text":n.$t("common.loading"),onLoad:r},{finished:K(()=>[I.value?_("",!0):(l(),H(Oe,{key:0,style:{padding:"52px 0 47px"},name:n.$t("city.This store does not currently offer a payment proxy service")},null,8,["name"]))]),default:K(()=>[I.value?(l(),a("div",lt,[(l(!0),a(q,null,R(d(j),(i,G)=>{var z;return l(),a("div",{class:"mb-3 last:mb-0",key:G},[t("div",{class:E(G>0?"w-full border-b-[0.5px] border-b-b4 mb-3":"")},null,2),(z=i==null?void 0:i.goodsList)!=null&&z.length?(l(),a("div",at,[t("div",{class:"flex items-center mb-3 cursor-pointer",onClick:x=>Q(i)},[b(A,{src:i.shopPics?i.shopPics.split(",")[0]:"",class:"w-6 h-6 mr-1 rounded-[4px] overflow-hidden",alt:i.shopName,fit:"cover"},null,8,["src","alt"]),t("span",rt,u(i.shopName),1),b(A,{src:d(be),class:"w-4 h-4",alt:"arrow"},null,8,["src"])],8,nt),(l(!0),a(q,null,R(s(i),(x,te)=>(l(),a("div",{key:x.goodsId,class:"flex items-center mb-3 last:mb-0",onClick:Z=>D(x)},[t("div",it,[b(A,{src:x.goodsIcons?x.goodsIcons.split(",")[0]:"",class:"w-full h-full object-cover",alt:x.goodsName,fit:"cover"},null,8,["src","alt"]),b(Ye,{type:x.goodsType||null},null,8,["type"])]),t("div",ut,[t("div",dt,[t("div",ft,u(x.goodsName),1),t("div",vt,u(x.goodsDesc),1)]),t("div",pt,[b(A,{src:d(Qe),class:"w-4 h-4 mr-1",alt:"Mcoin"},null,8,["src"]),t("span",mt,u(x.goodsPrice),1)])])],8,ct))),128))])):_("",!0)])}),128)),d(C).length>h?(l(),a("div",{key:0,class:"text-center text-b3 text-sm font-normal",onClick:W},u(S.value?n.$t("common.collapse"):n.$t("city.Check out the other xx stores",{val:d(C).length-h})),1)):_("",!0)])):_("",!0)]),_:1},8,["loading","finished","loading-text"])}}}),_t=k=>(Ae("data-v-2ed4bd30"),k=k(),Le(),k),gt={class:"flex flex-wrap items-center w-10"},yt={class:"text-lg font-bold text-b1 text-center"},xt=["onClick"],bt=["alt"],wt=["alt"],Ct={class:"w-full h-[330px]"},kt={class:"relative z-10"},It={class:"shop-info rounded-t-xl bg-white w-ful p-3 mt-[-12px]"},$t={class:"flex justify-between items-start gap-1"},St={class:"text-lg font-bold text-b1"},Tt={key:0,class:"shrink-0 w-fit h-[28px] flex justify-center items-center"},Bt={class:"text-xs text-newOrigin bg-[#FFF8EC] border-[0.5px] border-[#FF8812] px-1 rounded-sm font-normal"},Vt={class:"flex items-center justify-start mt-[2px] text-xs text-b3 font-normal"},At=_t(()=>t("div",{class:"divider bg-[#D9D9D9] h-[12px] w-[1px] mx-1"},null,-1)),Lt={class:"map-texture w-full h-fit rounded-lg overflow-hidden mt-2"},Nt={key:0,class:"w-full h-full map-texture-bg flex items-center justify-between p-2"},jt={class:"text-xs text-[#2E2008] leading-[18px] font-semibold"},Dt={key:0,class:"mt-1 text-xs text-[#585654] leading-[18px]"},Ft=["src"],Ot={class:"mt-[1px] text-xs text-[#585654] leading-[18px]"},Pt={class:"mt-2 relative z-10 h-fit pb-2"},qt={class:"w-full bg-white"},Et={class:"p-3 bg-white",id:"combo"},Kt=["onClick"],Wt={class:"p-3 flex justify-between items-center"},Gt={class:"text-base font-medium text-b1"},zt={class:"flex justify-center items-center"},Mt={class:"text-xs text-b3 font-normal"},Ut={key:0,class:"button-group-bg fixed bottom-0 left-0 z-[11] w-full h-[82px] flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},Rt={key:0,round:"",class:"min-w-[58.5%] w-full h-[46px] text-base font-semibold bg-yellow text-b1 rounded-full opacity-[0.7] flex justify-center items-center"},Ht={setup(k){const{t:B}=Te(),f=xe(),N=Ne(),{loadingToggle:V}=ze(),{cityMapStore:g}=qe(),{distanceFormat:I}=Re(),{checkLoginAuth:y}=Ee(),$=T(()=>{var e;return(e=f.query)!=null&&e.child?document.getElementById("storefront"):document.getElementById("fm-page")}),w=c(!1);c(0);let m=c(!0);const h=c([{label:B("city.Store service"),value:"bundle"},{label:B("city.Consumer Notes"),value:"note"}]),r=c(h.value[0].value),p=c([h.value[0]]),S=e=>{let o=null;e==="bundle"?o=document.querySelector("#combo"):e==="note"&&(o=document.querySelector("#note")),$.value&&o&&setTimeout(()=>{var v;$.value.scrollTo({top:((v=o==null?void 0:o.getBoundingClientRect())==null?void 0:v.top)||0,behavior:"smooth"})},100)},C=T(()=>{var e,o,v;return s.value.storeId&&(s.value.addWantCountFlag||+((e=s.value)==null?void 0:e.wantCount))&&((o=D.value)==null?void 0:o.total)===0&&!((v=D.value)!=null&&v.loading)}),j=T(()=>{var e;return((e=f.query)==null?void 0:e.storeId)||""}),s=c({}),W=c([]),Q=async()=>{var e,o,v,M;try{const J={id:j.value,longitude:g.locationCoords.lng||((e=g.currentActiveCity)==null?void 0:e.areaLongitude)||null,latitude:g.locationCoords.lat||((o=g.currentActiveCity)==null?void 0:o.areaLatitude)||null},F=await Ke(J);if(!F.success||!F.data)return;s.value=F.data,W.value=(v=F.data)!=null&&v.storeIcons?(M=F.data)==null?void 0:M.storeIcons.split(","):[]}catch{}},D=c(null),n=c(null),P=T(()=>{var e;return(e=n.value)==null?void 0:e.total}),A=T(()=>({storeId:j.value}));ye(()=>P.value,(e,o)=>{p.value=[h.value[0]],r.value=h.value[0].value},{immediate:!0,deep:!0});const Y=async()=>{var o;if(!y(!0)||w.value||!j.value)return;w.value=!0;const e=await Ge({id:j.value});w.value=!1,e.success&&(s.value.addWantCountFlag=!s.value.addWantCountFlag,s.value.wantCount=+(((o=s.value)==null?void 0:o.wantCount)||0)+1)},i=c(!1),G=()=>{y(!0)&&(s.value.collectId?x():z())},z=async()=>{var o,v;if(i.value||!((o=s.value)!=null&&o.storeId))return;i.value=!0,V(!0);const e=await Ue({storeId:(v=s.value)==null?void 0:v.storeId});i.value=!1,V(!1),e.success&&(s.value.collectId=e.data,_e({message:B("common.collect success"),icon:ee("toast-success.svg"),duration:3e3}))},x=async()=>{var o,v;if(i.value||!((o=s.value)!=null&&o.storeId))return;i.value=!0,V(!0);const e=await Me({ids:[(v=s.value)==null?void 0:v.collectId]});i.value=!1,V(!1),e.success&&(s.value.collectId=null,_e({message:B("common.cancel collect"),icon:ee("toast-success.svg"),duration:3e3}))},te=T(()=>{var e;return((e=s.value)==null?void 0:e.goodsCategoryName3)||""});T(()=>{var e,o;return(e=s.value)!=null&&e.areaName2?((o=s.value)==null?void 0:o.areaName2)+"å¸‚":""});const Z=e=>{N.push(e)},we=()=>{var o;const e=f.path.replace("storefront","availableStores");Z(`${e}?brandId=${(o=s.value)==null?void 0:o.storeBrandId}&storeId=${j.value}`)};return Be(async()=>{await Q()}),Ve(()=>{}),(e,o)=>{var se,oe,le,ae,ne,re,ce,ie,ue,de,fe,ve,pe,me,he;const v=O("VanImage"),M=O("van-swipe-item"),J=O("van-swipe"),F=O("VanButton"),Ce=O("router-view");return l(),a("div",{class:E(["relative w-full h-full pt-[50px] font-Puhui",{"pb-[82px]":d(C)}]),id:"storefront",style:{background:"#f2f0ef"}},[t("div",{class:E(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-4 fixed bg-white rounded-none",{"!bg-white":d(m)}])},[t("div",gt,[b(He)]),t("p",yt,u(e.$t("city.Store Details")),1),t("div",{onClick:X(G,["stop"])},[s.value.collectId?(l(),a("img",{key:0,src:De,alt:e.$t("common.collect"),class:"w-5 h-5"},null,8,bt)):(l(),a("img",{key:1,src:Fe,alt:e.$t("common.cancel"),class:"w-5 h-5"},null,8,wt))],8,xt)],2),t("div",{class:E(["detail__wrap overflow-y-scroll flex flex-col",d(C)?"h-[calc(100vh-50px-82px)]":"h-[calc(100vh-50px)]"])},[t("section",Ct,[b(J,{class:"note-imgs-swiper",autoplay:3e3,"indicator-color":"oriange1"},{default:K(()=>[(l(!0),a(q,null,R(W.value,L=>(l(),H(M,{key:L},{default:K(()=>[b(v,{src:L,class:"w-full h-full overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),_:2},1024))),128))]),_:1})]),t("div",kt,[t("section",It,[t("div",$t,[t("p",St,u(((se=s.value)==null?void 0:se.storeName)||""),1),+s.value.storeGoodsCount>0?(l(),a("div",Tt,[t("div",Bt,u(e.$t("goods.Buying agent")),1)])):_("",!0)]),t("div",Vt,[t("p",null,u(d(te)),1),+((oe=s.value)==null?void 0:oe.orderPersonCount15)>0?(l(),a(q,{key:0},[At,t("p",null,u(e.$t("xx people placed orders in the last 15 days",{val:((le=s.value)==null?void 0:le.orderPersonCount15)||0})),1)],64)):_("",!0)]),t("div",Lt,[(ae=s.value)!=null&&ae.storeAddress?(l(),a("div",Nt,[t("div",null,[t("p",jt,u((ne=s.value)==null?void 0:ne.storeAddress),1),(re=s.value)!=null&&re.distance&&((ce=d(g).locationCoords)!=null&&ce.lat)&&((ie=d(g).locationCoords)!=null&&ie.lng)?(l(),a("div",Dt,u(d(I)(((ue=s.value)==null?void 0:ue.distance)||0,e.$t("city.straight line distance from you"))),1)):_("",!0)]),(de=s.value)!=null&&de.storeAddress?(l(),a("div",{key:0,class:"shrink-0 flex flex-col items-center",onClick:o[0]||(o[0]=X(L=>{var U;return d(We)((U=s.value)==null?void 0:U.storeAddress)},["stop"]))},[t("img",{class:"w-4 h-4",src:d(ee)("cityMap/copy.svg"),alt:""},null,8,Ft),t("div",Ot,u(e.$t("common.copy")),1)])):_("",!0)])):_("",!0)])])]),t("div",Pt,[t("section",qt,[b(ot,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=L=>r.value=L),options:p.value,onChange:S,"label-key":"label","value-key":"value"},null,8,["modelValue","options"]),t("div",Et,[b(ht,{ref:(L,U)=>{U.shopBundle=L,D.value=L},params:d(A),onHandleTo:Z},null,8,["params"])])]),((fe=s.value)==null?void 0:fe.storeCount)>1?(l(),a("section",{key:0,class:"mt-2 w-full bg-white",onClick:X(we,["stop"])},[t("div",Wt,[t("div",Gt,u(e.$t("city.Related branches")),1),t("div",zt,[t("span",Mt,u(e.$t("city.Available at xx stores",{val:((ve=s.value)==null?void 0:ve.storeCount)-1})),1),b(v,{src:d(be),class:"shrink-0 w-3 h-3",alt:"arrow"},null,8,["src"])])])],8,Kt)):_("",!0)])],2),d(C)?(l(),a("div",Ut,[(pe=D.value)!=null&&pe.finished&&((me=D.value)==null?void 0:me.total)===0?(l(),a(q,{key:0},[s.value.storeId&&!s.value.addWantCountFlag?(l(),a("div",Rt,u(e.$t("city.xx people already want it",{val:((he=s.value)==null?void 0:he.wantCount)||0})),1)):(l(),H(F,{key:1,round:"",class:"min-w-[58.5%] w-full h-[46px] text-base font-semibold bg-yellow text-b1",loading:w.value,onClick:Y},{default:K(()=>[je(u(e.$t("city.I want")),1)]),_:1},8,["loading"]))],64)):_("",!0)])):_("",!0),b(Ce,{class:"child-view !rounded-none sm:fixed"})],2)}}},ns=ge(Ht,[["__scopeId","data-v-2ed4bd30"]]);export{ns as default};
