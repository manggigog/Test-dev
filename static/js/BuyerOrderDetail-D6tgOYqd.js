import{y as He,x as I,F as y,G as u,H as t,Q as i,a2 as c,O as P,w as J,B as F,P as r,I as V,a0 as A,E as Rt,K as b,N as j,a4 as de,S as Me,r as x,D as ee,a9 as Ke,_ as Pt,a1 as It,bc as B,T as C,R as Bt,l as Lt}from"./vendor-D6JO6WHW.js";import{d as U,q as w,b as qe,h as ce,l as X,R as Ot,e as Nt,o as jt,f as _e,s as z,C as me,B as Ft,b1 as Et}from"./index-CybuWkSo.js";import{a as Mt,_ as Ue,b as qt,c as _t}from"./remark-abzETDta.js";import{B as Ut,V as Gt}from"./VoucherConfirm-CcVibg4U.js";import{_ as Ve}from"./CountdownLabel-DksXiFux.js";import{_ as Y}from"./MCOIN-BOqZVkND.js";import{_ as Wt}from"./USDT-CNsbs3BR.js";import{_ as Ht}from"./FMCP-yoa9RTPy.js";import{_ as Kt}from"./link-CItP-_Ep.js";import{_ as ve}from"./copy-w-Dr8nkqKW.js";import{P as L}from"./order-B5BGKYED.js";import{P as ye}from"./flashSale-DDyqLyYN.js";import{p as Vt}from"./useOrderStatus-DeHjEZ0k.js";import{i as zt,b as Jt,a as be,g as Yt}from"./orderTime-Dh0zcNgW.js";import{_ as fe}from"./SubmitApprove-MvmYqg3d.js";import{P as Zt}from"./PaySwitchPop-CxAUCNxa.js";import{_ as Ge}from"./EmptyTipsPop-D6ESfx-v.js";import{B as Qt}from"./BackIcon-CPUEW9je.js";import{a as Xt,l as es,C as ts,c as he,n as We,D as ss,E as os,t as as,u as rs}from"./order-BvqBwh3U.js";import{p as ns}from"./piggyBank-C5mmVwwX.js";import"./useShipTemplate-DNIdMMsN.js";import"./enums-DlE-aiss.js";import"./default-avatar-DfqlD94j.js";import"./selected-icon-CfPkLSlb.js";import"./useRefundStatus-DY13i5Fs.js";import"./success_logo-D0xzsGnH.js";const is={class:"p-3 break-all bg-white rounded-xl"},ls={class:"font-semibold text-sm text-b1"},us={class:"mt-1 text-b2 text-sm font-normal"},ds={class:"ml-1"},cs=He({props:{order:null,showCopy:{type:Boolean,default:!0}},setup(e){const{order:f}=e;return I(()=>`${f.userAddress.provinceName??""}${f.userAddress.cityName??""}${f.userAddress.countyName??""}${f.userAddress.detailInfo??""} ${f.userAddress.userName??""} ${f.userAddress.telNumber??""}`),(k,v)=>(u(),y("div",is,[t("div",ls,i(f.userAddress.provinceName??"")+i(f.userAddress.cityName??"")+i(f.userAddress.countyName??"")+i(f.userAddress.detailInfo??""),1),t("div",us,[t("span",null,i(f.userAddress.userName),1),t("span",ds,i(f.userAddress.telNumber??""),1)])]))}}),ms={key:0,class:"p-3 break-all bg-white rounded-xl"},fs={class:"font-semibold text-base text-b1"},hs=t("span",null,"请在",-1),ys={class:"text-[#FF8812] mx-1"},vs=t("span",null,"内支付",-1),bs=t("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后订单将超时关闭 ",-1),xs={props:{order:{type:Object,required:!0}},emits:["timeDone"],setup(e,{emit:f}){return(k,v)=>e.order.status===0?(u(),y("div",ms,[t("div",fs,[hs,t("span",ys,[P(Ve,{class:"inline-block w-auto",startTime:e.order.createTime,duration:15,durationType:"minutes",showZero:!0,onDone:v[0]||(v[0]=p=>f("timeDone"))},null,8,["startTime"])]),vs]),bs])):c("",!0)}},ps={class:"p-3 py-4 break-all bg-white rounded-xl"},ws={class:"title text-b1 text-sm font-semibold"},gs={class:"content"},Ts={class:"flex justify-between items-center mt-4"},$s={class:"text-b3 text-sm font-normal"},Cs={class:"text-b1 text-sm font-normal text-right"},ks={class:"flex justify-between items-center mt-4"},Ss={class:"text-b3 text-sm font-normal"},As={class:"text-b1 text-sm font-normal text-right flex items-center"},Ds=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Y})],-1),Rs={class:"ml-1"},Ps={key:0,class:"flex justify-between items-center mt-4"},Is={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Bs={class:"text-b1 text-sm font-normal text-right flex items-center"},Ls={class:"mr-1"},Os=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Y})],-1),Ns={class:"ml-1"},js={key:1,class:"flex justify-between items-center mt-4"},Fs={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Es={class:"text-b1 text-sm font-normal text-right flex items-center"},Ms=t("div",{class:"mr-1"},"-",-1),qs=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Y})],-1),_s={class:"ml-1"},Us={class:"flex justify-between items-center mt-4"},Gs={class:"text-b3 text-sm font-normal"},Ws={class:"text-b1 text-sm font-normal text-right flex items-center gap-1"},Hs=t("img",{class:"w-4 h-4",src:Wt},null,-1),Ks=A("( "),Vs=t("img",{class:"w-4 h-4",src:Y},null,-1),zs=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Y})],-1),Js=t("span",{class:"text-[#999]"},"+",-1),Ys=t("img",{class:"w-4 h-4",src:Ht},null,-1),Zs={class:"flex justify-between items-center mt-4"},Qs={class:"text-b3 text-sm font-normal"},Xs={class:"text-b1 text-sm font-normal text-right"},eo={class:"flex items-center"},to={class:"flex justify-between items-center mt-4"},so={class:"text-b3 text-sm font-normal"},oo=["href"],ao=t("img",{src:Kt,class:"w-5 h-5 ml-1",alt:""},null,-1),ro={key:1},no={class:"flex justify-between items-center mt-4"},io={class:"text-b3 text-sm font-normal"},lo=t("img",{src:ve,class:"w-5 h-5 ml-1",alt:""},null,-1),uo={key:2,class:"flex justify-between items-center mt-4"},co={class:"text-b3 text-sm font-normal"},mo={class:"text-b1 text-sm font-normal text-right"},fo={key:3,class:"flex justify-between items-center mt-4"},ho={class:"text-b3 text-sm font-normal"},yo={class:"text-b1 text-sm font-normal text-right"},vo={key:4,class:"flex justify-between items-center mt-4"},bo={class:"text-b3 text-sm font-normal"},xo={class:"text-b1 text-sm font-normal text-right"},po={key:5,class:"flex justify-between items-center mt-4"},wo={class:"text-b3 text-sm font-normal"},go={class:"text-b1 text-sm font-normal text-right"},To={key:6,class:"flex justify-between items-center mt-4"},$o={class:"text-b3 text-sm font-normal whitespace-nowrap"},Co={class:"text-b1 text-sm font-normal text-right flex items-center"},ko={class:"break-all flex-1"},So=t("img",{src:ve,class:"w-5 h-5",alt:""},null,-1),Ao=[So],Do={key:7,class:"flex justify-between items-center mt-4"},Ro={class:"text-b3 text-sm font-normal whitespace-nowrap"},Po={class:"text-b1 text-sm font-normal text-right break-all"},Io={key:8,class:"flex justify-between items-center mt-4"},Bo={class:"text-b3 text-sm font-normal whitespace-nowrap"},Lo={class:"text-b1 text-sm font-normal text-right flex items-center"},Oo={class:"break-all flex-1"},No=t("img",{src:ve,class:"w-5 h-5",alt:""},null,-1),jo=[No],Fo={props:{order:{type:Object,required:!0}},setup(e){const f=e,{t:k}=J(),v=I(()=>{let n=0;return n=new F(f.order.totalAmount||0).minus(f.order.voucherAmount||0),U(n)}),p=I(()=>{var m;const n=f.order.orderGoods||[];return n.length>0?n[0].discountRatio||0:((m=f.order.stores)==null?void 0:m.discountRatio)||0});return(n,m)=>{var $,O;return u(),y("div",ps,[t("div",ws,[t("span",null,i(n.$t("order.orderInfo")),1)]),t("div",gs,[t("div",Ts,[t("div",$s,i(n.$t("common.pay type method")),1),t("div",Cs,i(r(Vt)(+e.order.paySource)),1)]),t("div",ks,[t("div",Ss,i(n.$t("order.total price detail")),1),t("div",As,[Ds,t("div",Rs,i(r(U)(e.order.totalAmountOriginal||e.order.totalAmount)),1)])]),e.order.merchantAdjustAmount?(u(),y("div",Ps,[t("div",Is,i(n.$t("order.merchant modify price")),1),t("div",Bs,[t("div",Ls,i(e.order.merchantAdjustAmount>0?"+":"-"),1),Os,t("div",Ns,i(Math.abs(e.order.merchantAdjustAmount)||0),1)])])):c("",!0),e.order.fmGeneralActivity&&e.order.activityReduceAmount?(u(),y("div",js,[t("div",Fs,i((($=e.order.fmGeneralActivity)==null?void 0:$.name)||"-"),1),t("div",Es,[Ms,qs,t("div",_s,i(r(U)(e.order.activityReduceAmount)),1)])])):c("",!0),t("div",Us,[t("div",Gs,i(n.$t("order.total price actual buyer")),1),t("div",Ws,[+e.order.paySource===r(L).USDT_WALLET?(u(),y(V,{key:0},[Hs,A(" "+i(r(U)(e.order.totalUsdt))+" ",1),e.order.payType===r(ye).STORE_CARD?(u(),y(V,{key:0},[A(" （"+i(r(U)(e.order.totalAmount))+i((O=e.order.fmStoredCard)==null?void 0:O.symbol)+"） ",1)],64)):(u(),y(V,{key:1},[Ks,Vs,A(i(r(v))+" Mcoin)",1)],64))],64)):(u(),y(V,{key:1},[zs,t("div",null,i(r(v)),1),e.order.voucherAmount?(u(),y(V,{key:0},[Js,Ys,A(" "+i(r(U)(e.order.voucherAmount||0)),1)],64)):c("",!0)],64))])]),t("div",Zs,[t("div",Qs,i(n.$t("common.ratio")),1),t("div",Xs,[t("div",eo,i(r(p))+"%",1)])]),t("div",to,[t("div",so,i(n.$t("order.hash")),1),e.order.hash?(u(),y("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${r(w).chainConfig.blockExplorerUrls[0]}/tx/${e.order.hash}`},[A(i(r(qe)(e.order.hash,"***",9,5)||"--")+" ",1),ao],8,oo)):(u(),y("span",ro," -- "))]),t("div",no,[t("div",io,i(n.$t("order.payAddress")),1),t("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:m[0]||(m[0]=D=>r(ce)(e.order.address))},[A(i(r(qe)(e.order.address,"...",5,5))+" ",1),lo])]),e.order.createTime?(u(),y("div",uo,[t("div",co,i(n.$t("order.createTime")),1),t("div",mo,i(r(X)(e.order.createTime)),1)])):c("",!0),e.order.chainCreateTime?(u(),y("div",fo,[t("div",ho,i(n.$t("order.chainFinishTime")),1),t("div",yo,i(r(X)(e.order.chainCreateTime)),1)])):c("",!0),e.order.expressTime?(u(),y("div",vo,[t("div",bo,i(n.$t("order.expressTime")),1),t("div",xo,i(r(X)(e.order.expressTime)),1)])):c("",!0),e.order.finishTime?(u(),y("div",po,[t("div",wo,i(n.$t("order.finishTime")),1),t("div",go,i(e.order.finishTime?r(X)(e.order.finishTime):"-"),1)])):c("",!0),e.order.id&&e.order.status!==0?(u(),y("div",To,[t("div",$o,i(n.$t("order.orderNumber")),1),t("div",Co,[t("div",ko,i(e.order.id),1),t("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:m[1]||(m[1]=D=>r(ce)(e.order.id))},Ao)])])):c("",!0),e.order.expressCompany?(u(),y("div",Do,[t("div",Ro,i(n.$t("order.deliveryCompany")),1),t("div",Po,i(e.order.expressCompany),1)])):c("",!0),e.order.expressNo?(u(),y("div",Io,[t("div",Bo,i(n.$t("order.deliveryNum")),1),t("div",Lo,[t("div",Oo,i(e.order.expressNo),1),t("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:m[2]||(m[2]=D=>r(ce)(e.order.expressNo))},jo)])])):c("",!0)])])}}},Eo={class:"flex justify-between items-center gap-3 mt-5 fixed left-0 right-0 bottom-0 safe-bottom px-3"},Mo={key:0,class:"flex justify-between items-center gap-3 w-full"},qo={class:"relative w-full flex-1"},_o={class:"relative w-full flex-1"},Uo={key:0},Go={props:{order:{type:Object,required:!0},btnLoading:{type:Boolean,default:!1},nowTime:{type:Number,default:0},continuePayLoading:{type:Boolean,default:!1},cancelLoading:{type:Boolean,default:!1},voucherPrice:{type:Number,default:0}},emits:["handleDelay","handleDelayReceipt","handleTo","cancelOrder","continuePay","timeDone"],setup(e,{emit:f}){const{t:k}=J();return(v,p)=>{const n=Rt("VanButton");return u(),y("div",Eo,[e.order.status===0&&!e.order.hash?(u(),y("div",Mo,[t("div",qo,[e.order.hash?c("",!0):(u(),b(n,{key:0,round:"",class:"w-full flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:e.btnLoading||e.cancelLoading,disabled:e.continuePayLoading||e.order.hash,onClick:p[0]||(p[0]=de(m=>v.$emit("cancelOrder"),["stop"]))},{default:j(()=>[A(i(v.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"]))]),t("div",_o,[e.order.paySource!=r(L).PIGGY_BANK&&e.order.paySource!=r(L).WITHDRAW_POINTS?(u(),y("div",Uo,[e.order.paySource==r(L).USDT_WALLET?(u(),b(fe,{key:0,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(w).order,token:r(w).USDT,symbol:"USDT",loading:e.btnLoading,approveAmount:Number(e.order.paySource==r(L).USDT_WALLET?e.order.totalUsdt:0)},null,8,["contract","token","loading","approveAmount"])):c("",!0),e.order.paySource!=r(L).USDT_WALLET?(u(),b(fe,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(w).order,token:r(w).MCOIN,symbol:"mcoin",loading:e.btnLoading,approveAmount:Number(e.order.paySource===r(L).USDT_WALLET?0:e.order.totalAmount)},null,8,["contract","token","loading","approveAmount"])):c("",!0)])):c("",!0),e.order.paySource==r(L).WITHDRAW_POINTS&&e.voucherPrice&&e.voucherPrice>0?(u(),b(fe,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(w).order,token:r(w).FMCP,symbol:v.$t("voucher.voucher"),loading:e.btnLoading,approveAmount:Number(e.voucherPrice)},null,8,["contract","token","symbol","loading","approveAmount"])):c("",!0),e.order.hash?c("",!0):(u(),b(n,{key:2,round:"",class:"w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:e.order.hash,loading:e.continuePayLoading||e.btnLoading,onClick:p[1]||(p[1]=de(m=>v.$emit("continuePay"),["stop"]))},{default:j(()=>[t("span",null,i(v.$t("order.continuePay")),1),P(Ve,{class:"inline-block ml-1",startTime:e.order.createTime,duration:15,durationType:"minutes",showZero:!1},null,8,["startTime"])]),_:1},8,["disabled","loading"]))])])):c("",!0),e.order.status===2&&r(zt)(e.order.chainCreateTime,e.order.confirmLimit)&&r(Jt)(e.order.expressTime,e.nowTime)>0&&e.order.payType!==r(ye).STORE_CARD?(u(),b(n,{key:1,round:"",class:"flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:e.btnLoading,onClick:p[2]||(p[2]=de(m=>v.$emit("handleDelay"),["stop"]))},{default:j(()=>[A(i(v.$t("order.delayGeted")),1)]),_:1},8,["loading"])):c("",!0),+e.order.payType==+r(L).PIGGY_BANK&&e.order.status===4?(u(),b(r(Me),{key:2,to:`/refundService?id=${e.order.id}`,class:"flex-1"},{default:j(()=>[P(n,{round:"",class:"w-full gray-btn border-btn font-normal text-base h-[46px] rounded-full"},{default:j(()=>[A(i(v.$t("order.complaints")),1)]),_:1})]),_:1},8,["to"])):c("",!0),e.order.creditFlag&&e.order.refundStatus!=null&&e.order.status===1&&e.order.refundStatus===4?(u(),b(r(Me),{key:3,to:`/refundService?id=${e.order.id}&type=credit`,class:"flex-1"},{default:j(()=>[P(n,{round:"",class:"w-full gray-btn border-btn font-normal text-base h-[46px] rounded-full"},{default:j(()=>[A(i(v.$t("order.Platform intervention")),1)]),_:1})]),_:1},8,["to"])):c("",!0),e.order.status===2&&(!e.order.merchantsConfirm||r(be)(e.order.merchantsConfirm,e.nowTime)>0)?(u(),b(n,{key:4,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:p[3]||(p[3]=m=>v.$emit("handleDelayReceipt")),loading:e.btnLoading},{default:j(()=>[A(i(v.$t("order.confirmGeted")),1)]),_:1},8,["loading"])):c("",!0),e.order.status===1&&e.order.refundStatus!==1&&e.order.refundStatus<10&&e.order.payType!==r(ye).STORE_CARD?(u(),b(n,{key:5,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:p[4]||(p[4]=m=>v.$emit("handleTo",`/refundService?id=${e.order.id}`)),loading:e.btnLoading},{default:j(()=>[A(i(v.$t("order.refund")),1)]),_:1},8,["loading"])):c("",!0)])}}},Wo={key:0,class:"p-3 mt-3 break-all bg-white rounded-xl"},Ho={class:"font-semibold text-base text-b1"},Ko=t("span",null,"请在",-1),Vo={class:"text-[#FF8812] mx-1"},zo=t("span",null,"内确认收货",-1),Jo=t("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后商家可确认收货 ",-1),Yo={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(e,{emit:f}){const k=e,{t:v}=J(),p=x(Date.now());let n=null;const m=I(()=>{const o=Yt(k.order.expressTime,k.order.confirmLimit,k.nowTime);return o>0?o:0}),$=I(()=>m.value>0),O=I(()=>{const o=m.value;if(o<=0)return"00天00时00分00秒";const M=Math.floor(o/(1e3*60*60*24)),N=Math.floor(o%(1e3*60*60*24)/(1e3*60*60)),G=Math.floor(o%(1e3*60*60)/(1e3*60)),E=Math.floor(o%(1e3*60)/1e3);return`${M.toString().padStart(2,"0")}天${N.toString().padStart(2,"0")}时${G.toString().padStart(2,"0")}分${E.toString().padStart(2,"0")}秒`}),D=()=>{p.value=Date.now(),m.value<=0&&n&&(clearInterval(n),n=null,f("timeDone"))};return ee(()=>{D(),m.value>0&&(n=setInterval(D,1e3))}),Ke(()=>{n&&(clearInterval(n),n=null)}),(o,M)=>r($)?(u(),y("div",Wo,[t("div",Ho,[Ko,t("span",Vo,i(r(O)),1),zo]),Jo])):c("",!0)}},Zo={key:0,class:"p-3 break-all bg-white rounded-xl"},Qo={class:"font-semibold text-base text-b1"},Xo=t("span",null,"请在",-1),ea={class:"text-[#FF8812] mx-1"},ta=t("span",null,"内确认收货",-1),sa=t("div",{class:"mt-1 font-normal text-sm text-b2"}," 商家已确认收货，倒计时结束后将自动确认收货 ",-1),oa={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(e,{emit:f}){const k=e,{t:v}=J(),p=x(Date.now());let n=null;const m=I(()=>{const o=be(k.order.merchantsConfirm,k.nowTime);return o>0?o:0}),$=I(()=>m.value>0),O=I(()=>{const o=m.value;if(o<=0)return"00天00时00分00秒";const M=Math.floor(o/(1e3*60*60*24)),N=Math.floor(o%(1e3*60*60*24)/(1e3*60*60)),G=Math.floor(o%(1e3*60*60)/(1e3*60)),E=Math.floor(o%(1e3*60)/1e3);return`${M.toString().padStart(2,"0")}天${N.toString().padStart(2,"0")}时${G.toString().padStart(2,"0")}分${E.toString().padStart(2,"0")}秒`}),D=()=>{p.value=Date.now(),m.value<=0&&n&&(clearInterval(n),n=null,f("timeDone"))};return ee(()=>{D(),m.value>0&&(n=setInterval(D,1e3))}),Ke(()=>{n&&(clearInterval(n),n=null)}),(o,M)=>r($)?(u(),y("div",Zo,[t("div",Qo,[Xo,t("span",ea,i(r(O)),1),ta]),sa])):c("",!0)}},aa={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ra={class:"font-bold text-base text-b1"},na={class:"px-3 safe-bottom pt-[50px] flex flex-col gap-3"},ia=He({props:{nowTime:null},setup(e){const f=e,{getUserDhKey:k,decryptAddressKey:v,decryptKey:p}=Ot(),{t:n}=J(),m=Lt(),$=It(),{reloadStore:O}=Nt(),D=$.query.id,o=x(null),[M,N]=B(!1),[G,E]=B(!1),[ze,te]=B(!1),[Je,xe]=B(!1),pe=x(null),we=x(!1),Ye=s=>{const a=s.target.scrollTop;we.value=a>25},[Ze,ge]=B(!1),[Qe,Te]=B(!1),Xe=x(null),W=x(0),[et,Z]=B(!1),$e=x("");x(0);const se=x(!1),Ce=x(0),Q=x(0),ke=x(0),Se=x(0),Ae=x(0),[tt,H]=B(!1);x(!1);const{confirm:De,senderDelay:st,submit:ot}=jt(),{pointBalances:at,mcoinRate:rt}=_e(),{userMerchantCashs:nt,userTotalAmount:it}=ns(),oe=x(null),Re=I(()=>oe.value?1/oe.value:1),Pe=x(0),Ie=x([]),q=async()=>{var a,d,l,h,S,T,K;const s=await Xt({id:D});if((a=s.data)!=null&&a.userAddress&&(s.data.userAddress.postscript=s.data.postscript),(d=s.data)!=null&&d.userAddress&&((h=(l=s.data)==null?void 0:l.userAddress)!=null&&h.encryptFlag)){const R=await k(s.data.stores.id,(S=s.data)==null?void 0:S.submitMerchantPubKey);R&&(s.data.userAddress=v(s.data.userAddress,R))}if((T=s.data)!=null&&T.shippingHash){const R=await k(s.data.stores.id,(K=s.data)==null?void 0:K.shippingMerchantPubKey);if(R){const _=p(s.data.expressNo,R);_.hash===s.data.shippingHash&&(s.data.expressNo=_.decrypt,s.data.expressCompany=p(s.data.expressCompany,R).decrypt)}}o.value=s.data},lt=async()=>{const s=await es({page:1,size:999,status:2,type:2});s.success&&(Pe.value=s.total,Ie.value=s.data.filter(a=>!a.merchantsConfirm||be(a.merchantsConfirm,f.nowTime)>0))},ae=x(1),{tradeContributeSelfRate:ut}=_e(),dt=I(()=>{var a;if(!((a=o.value)!=null&&a.orderGoods))return 0;let s=new F(0);return o.value.orderGoods.forEach(d=>{if(+o.value.payType==1&&+d.payType==3||+d.payType!=2&&+d.payType!=3){const l=new F(d.price).times(d.number).minus(d.goodsActivityReduceAmount||0).plus(d.goodsAdjustChangeAmount||0).times(new F(d.discountRatio||0).div(100));s=s.plus(l)}}),s.times(ae.value).toNumber()}),re=I(()=>{var l;if(!((l=o.value)!=null&&l.orderGoods)||Q.value<=0)return 0;const s=dt.value||0,a=ae.value;return Math.min(Q.value,new F(s).div(a).times(.5).toNumber())});ee(async()=>{ae.value=await ut()});const ct=async()=>{try{const{balanceOf:s}=z(w.MCOIN),a=await s();Ce.value=+a;const d=await z(w.FMCP).balanceOf();Q.value=+d;const l=await z(w.USDT).balanceOf();ke.value=+l,Se.value=+await at(),await ft()}catch(s){console.error("获取余额失败:",s)}},mt=async()=>{try{oe.value=await rt()}catch(s){console.error("获取汇率失败:",s)}},ft=async()=>{try{const{success:s,result:a}=await nt();if(!s)return;let d=0;const l=+await it(),h=a.amounts.map(T=>Ft(T));a.cashIds.map(T=>+T).forEach((T,K)=>{T!==0&&(d=+F(d).plus(h[K]||0).toString())}),Ae.value=+F(l).minus(d)}catch(s){console.error("获取余额宝余额失败:",s)}},ht=()=>{Te(!1),q()},yt=s=>{m.push(s)},[Be,ne]=B(!1),[vt,ie]=B(!1),Le=async()=>{ie(!0)},bt=async()=>{if(Be.value)return;ne(!0),(await ts({orderId:o.value.id})).success?(C.success(n("common. cancel success")),ne(!1),m.go(-1),setTimeout(()=>{m.replace({path:"/buyerOrderList",query:{active:4,type:1}})},50),setTimeout(()=>{location.reload()},100)):ne(!1)},le=async(s,a)=>{try{const{allowance:d}=z(s);return+(await d(a)).result}catch{return 0}},xt=async()=>{var s,a,d;try{const l=(s=o.value)==null?void 0:s.paySource,h=(a=o.value)==null?void 0:a.totalAmount,S=Math.max(((d=o.value)==null?void 0:d.voucherAmount)||0,re.value);if(S&&l==L.WITHDRAW_POINTS&&await le(w.FMCP,w.order)<re.value)return C({message:n("common.approve")+n("voucher.voucher"),forbidClick:!0,duration:2e3}),!1;if(l==1){if(Ce.value<h)return H(!0),!1;if(await le(w.MCOIN,w.order)<h)return C({message:n("common.approve")+"MCOIN",forbidClick:!0,duration:2e3}),!1}else if(l==5){if(ke.value<h*Re.value)return H(!0),!1;if(await le(w.USDT,w.order)<h*Re.value)return C({message:n("common.approve")+"USDT",forbidClick:!0,duration:2e3}),!1}else if(l==4){if(+F(Se.value).times(.9)<+F(h).minus(S))return H(!0),!1}else if(l==2&&Ae.value<h)return H(!0),!1;return!0}catch{return!1}finally{N(!1),g(!1)}},Oe=async()=>{if(await xt())try{if(!o.value.id||!o.value.allOrderId){C.fail(n("order.orderIdError")),g(!1);return}g(!0),await q();const a=await ss({allOrderId:o.value.allOrderId,orderId:o.value.id});if(!a.success){g(!1);return}const{allOrderId:d,merchants:l,discounts:h,amounts:S,sources:T}=a.data;if(o.value.allOrderId=d,!(await os({allOrderId:o.value.allOrderId})).data){C.fail("有一笔交易正在进行中，请稍候再试"),g(!1);return}const R=await ot(d,l,h,S,T);if(!R.success){as({allOrderId:d}),g(!1),await q();return}if(C.loading({message:n("order.wait block chain"),forbidClick:!0,duration:0}),await rs({allOrderId:d,hash:R.result.hash,orderId:o.value.id}),C.clear(),Xe.value=R.result.hash,!R.result.hash){g(!1);return}let _;const Ee=async()=>{if(W.value>=5){g(!1),Te(!0),W.value=0,await q();return}if(_=await Et(R.result.hash),(_==null?void 0:_.status)===1){g(!1),ge(!0),W.value=0,setTimeout(()=>{m.go(-1),setTimeout(()=>{m.replace({path:"/buyerOrderList",query:{active:1,type:1}})},50),setTimeout(()=>{location.reload()},100)},1e3);return}setTimeout(async()=>{W.value++,Ee()},5e3)};Ee()}catch{g(!1),W.value=0}},Ne=x(!1),[pt,g]=B(!1),je=async()=>{var a;g(!0),Ne.value=!0;try{await q()}catch{g(!1);return}if(((a=o.value)==null?void 0:a.status)!==0){C.fail("已支付订单，无需重复支付"),g(!1);return}if(Fe()){se.value=!0,g(!1);return}await Oe()},ue=()=>{q()},wt=async()=>{E(!0)},gt=async s=>{N(!0);try{const d=(await he({orderIds:s.id})).data.ordIds;if(!(await st(d)).success)return;s.delayReceiveFlag=!0,s.confirmLimit=f.nowTime+w.datePeriod*10,E(!1),C.success(n("order.delaySuccess")),setTimeout(()=>{O.reload()},3e3)}finally{N(!1)}},Tt=async s=>{var a;N(!0);try{const l=(await he({orderIds:s})).data.ordIds,h=await De(l);if(!h.success||!(await We({ordIds:l,hash:h.result.hash})).success)return;o.value.status=4,pe.value.showToastPop(((a=h.result)==null?void 0:a.logs)||[])||(C.success(n("order.confirmSuccess")),m.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{$.params.refresh="1",m.push("/evaluate-my")},2e3))}finally{N(!1)}},$t=async()=>{Pe.value>1?te(!0):Tt(D)},Ct=async s=>{const a=s.join();xe(!0);try{const l=(await he({orderIds:a})).data.ordIds,h=await De(l);if(!h.success||!(await We({ordIds:l,hash:h.result.hash})).success)return;o.value.status=4,te(!1),C.success(n("order.confirmSuccess")),m.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{$.params.refresh="1",m.push("/evaluate-my")},2e3)}finally{xe(!1)}},kt=()=>{var s,a;((s=$.params)==null?void 0:s.quick)==="quickPay"&&St(),((a=$.params)==null?void 0:a.quick)==="quickCancel"&&At()},St=()=>{C.loading({message:n("order.continuePay"),forbidClick:!0,duration:2e3}),je()},At=()=>{Le()},Dt=()=>{Z(!1),se.value&&(se.value=!1,Oe())},Fe=()=>{var h,S;if(!((h=o.value)!=null&&h.id))return!1;const s="orderMerchantAdjustMap";let a={};try{a=JSON.parse(localStorage.getItem(s)||"{}")}catch{a={}}const d=a[o.value.id],l=(S=o.value)==null?void 0:S.merchantAdjustAmount;return l&&(d===void 0||d!==String(l))?(sessionStorage.setItem("refreshOrderID",o.value.id.toString()),$e.value="订单金额发生变动，请留意订单信息变化",Z(!0),a[o.value.id]=String(l),localStorage.setItem(s,JSON.stringify(a)),!0):!1};return ee(async()=>{var s,a,d,l;if(((s=$.params)==null?void 0:s.quick)==="quickPay"&&(C.loading({message:n("order.continuePay"),forbidClick:!0,duration:6e3}),g(!0)),lt(),await q(),await ct(),await mt(),((a=o.value)==null?void 0:a.paySource)==L.WITHDRAW_POINTS){const h=await z(w.FMCP).balanceOf();Q.value=+h}((d=o.value)==null?void 0:d.status)===0&&!((l=$.params)!=null&&l.quick)&&Fe(),kt()}),(s,a)=>{var d;return o.value?(u(),y("div",{key:0,class:"app-container font-Puhui main-bg safe-bottom-page",onScroll:Ye},[t("section",{class:Bt(["header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md transition-all duration-300",{"bg-white":we.value}])},[t("div",aa,[P(Qt)]),t("div",ra,[t("span",null,i(s.$t("order.orderDetail")),1)])],2),t("section",na,[o.value.status===2?(u(),b(Yo,{key:0,order:o.value,nowTime:e.nowTime,onTimeDone:ue},null,8,["order","nowTime"])):c("",!0),o.value.status===2?(u(),b(oa,{key:1,order:o.value,nowTime:e.nowTime,onTimeDone:ue},null,8,["order","nowTime"])):c("",!0),o.value.status===0&&!o.value.hash?(u(),b(xs,{key:2,order:o.value,onTimeDone:ue},null,8,["order"])):c("",!0),o.value.userAddress?(u(),b(cs,{key:3,order:o.value,showCopy:!1},null,8,["order"])):c("",!0),P(Mt,{order:o.value,"show-price":!1,"show-shipping-template":!0},null,8,["order"]),o.value.status===0?(u(),b(Ue,{key:4,order:o.value,isBuyer:""},null,8,["order"])):c("",!0),o.value.status===0&&!o.value.hash?(u(),b(qt,{key:5,order:o.value,isBuyer:""},null,8,["order"])):c("",!0),o.value.status!==0||o.value.hash?(u(),b(Fo,{key:6,order:o.value},null,8,["order"])):c("",!0),o.value.status!==0?(u(),b(Ue,{key:7,order:o.value,isBuyer:""},null,8,["order"])):c("",!0),o.value.id&&o.value.status===0?(u(),b(_t,{key:8,order:o.value},null,8,["order"])):c("",!0),o.value.status==0&&o.value.hash?c("",!0):(u(),b(Go,{key:9,voucherPrice:r(re),order:o.value,btnLoading:r(M),cancelLoading:r(Be),continuePayLoading:r(pt),nowTime:e.nowTime,onHandleDelay:wt,onHandleDelayReceipt:$t,onHandleTo:yt,onCancelOrder:Le,onContinuePay:je},null,8,["voucherPrice","order","btnLoading","cancelLoading","continuePayLoading","nowTime"]))]),P(me,{show:r(G),title:s.$t("order.delayConfirm"),content:s.$t("order.delayTips"),showConfirm:!0,showReject:!0,confirmText:"确定",rejectText:"取消",noClose:"",onClose:a[0]||(a[0]=l=>r(E)(!1)),onReject:a[1]||(a[1]=l=>r(E)(!1)),onConfirm:a[2]||(a[2]=l=>gt(o.value))},null,8,["show","title","content"]),P(Ut,{loading:r(Je),show:r(ze),list:Ie.value,currentId:+r(D),onClose:a[3]||(a[3]=l=>r(te)(!1)),onReceipt:Ct},null,8,["loading","show","list","currentId"]),P(Gt,{ref:(l,h)=>{h.voucherConfirmRef=l,pe.value=l},onReload:a[4]||(a[4]=l=>r(O).reload()),onHandleTo:a[5]||(a[5]=()=>{r(m).push("/voucher?active=1")})},null,512),r(Ze)?(u(),b(Ge,{key:0,onClose:a[6]||(a[6]=l=>r(ge)(!1)),text:s.$t("common.pay success")},null,8,["text"])):c("",!0),r(Qe)?(u(),b(Ge,{key:1,isError:!0,onClose:ht,text:s.$t("order.fail")},null,8,["text"])):c("",!0),P(Zt,{paySource:+((d=o.value)==null?void 0:d.paySource),show:r(tt),onClose:a[7]||(a[7]=l=>r(H)(!1))},null,8,["paySource","show"]),P(me,{show:r(et),title:s.$t("common.tip"),content:$e.value,showConfirm:!0,showReject:Ne.value,confirmText:"确定",noClose:"",onClose:a[8]||(a[8]=l=>r(Z)(!1)),onConfirm:Dt,onReject:a[9]||(a[9]=l=>r(Z)(!1))},null,8,["show","title","content","showReject"]),P(me,{show:r(vt),title:s.$t("order.cancelOrder"),content:s.$t("order.cancelOrderTips"),showConfirm:!0,showReject:!0,confirmText:"确定",noClose:"",onClose:a[10]||(a[10]=l=>r(ie)(!1)),onConfirm:bt,onReject:a[11]||(a[11]=l=>r(ie)(!1))},null,8,["show","title","content"])],32)):c("",!0)}}}),Oa=Pt(ia,[["__scopeId","data-v-7ff6afc3"]]);export{Oa as default};
