import{_ as P,z as L,x as V,q as H,o as N,r as o,a9 as R,bm as D,F as E,G as w,H as v,I as s,P as F,$,Q as B,Z as y,J as j,K as J,O as b,T as A}from"./vendor-Dr_RpJ_Y.js";import{B as K}from"./BoutiqueGoodItemv2-Bkb-DIU8.js";import{B as M}from"./BackIcon-CDrGaEPo.js";import{ar as O,w as Q,as as U,av as Z}from"./index-7OiUoGXy.js";import{_ as W}from"./DefaultPage-BbbCICPU.js";import"./RatioBox-C8BvsGJW.js";import"./GoodsPrice-Dz5PcG19.js";import"./MCOIN-Bodfn-v1.js";import"./ShopMaskTips-ClYuWX9C.js";import"./goods-BVwS8oFG.js";const X={class:"overflow-y-auto"},Y={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[44px] px-2.5 z-50"},tt={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},et={class:"font-semibold"},ot={class:"bg-white h-full"},at=L({name:"ActivityGood"});function st(lt){var C;const{t:g}=V(),h=H(),n=N(),S=O(),l=o(1);l.value=+((C=n.query)==null?void 0:C.type)||1;const i=o([]),u=o(!1),r=o(!1),c=o(0),_=o(10),p=o(0),d=o([]),f=o(0),q=R.throttle(()=>{const t=document.querySelector(".list-content");t&&(f.value=t.scrollTop)},200),I=()=>{const t=document.querySelector(".list-content");t&&(t.scrollTop=f.value)};D(()=>{var t,e;l.value!=+((t=n.query)==null?void 0:t.type)&&(l.value=+((e=n.query)==null?void 0:e.type)||1,c.value=0,i.value=[],r.value=!1,p.value=0,d.value=[],f.value=0),T(),I()});const z=async()=>{let t={};+l.value==1?t={page:c.value,size:_.value,status:1,sortType:3,boutiqueTop:!0,isActivity:99}:t={page:c.value,size:_.value,isActivity:1,boutiqueTop:!0};const e=await Z(t);if(!e.success||!e.data||!+e.total){r.value=!0,u.value=!1;return}p.value=e.total,d.value=e.data,i.value=c.value===1?d.value.length>0?d.value:[]:i.value.concat(d.value),i.value.length>=p.value&&(r.value=!0)},T=async()=>{u.value=!0,c.value+=1,await z(),setTimeout(()=>{u.value=!1},1e3)},{loadingToggle:k}=Q(),G=async t=>{if(t.stock===0&&t.goodsTypes!=2){A(g("order.Insufficient stock"));return}const e={needlogin:"true",...n.query};h.replace({path:n.path,query:e}),k(!0);const m=await U(t.id);k(!1),m.success&&(A(g("cart.addTips")),S.getCartCount())},x=t=>{h.push(t)};return(t,e)=>{const m=E("VanList");return v(),w("div",X,[s("section",Y,[s("div",tt,[F(M,null,{default:$(()=>[s("span",null,B(t.$t("common.return")),1)]),_:1})]),s("div",et,B(l.value===1?t.$t("activity.new"):t.$t("active.active")),1)]),s("div",{class:"list-content h-[calc(100vh-44px)] sticky top-[44px] overflow-auto rounded-t-[12px] bg-white",onScroll:e[1]||(e[1]=(...a)=>b(q)&&b(q)(...a))},[s("div",ot,[r.value&&p.value===0?(v(),y(W,{key:0,title:t.$t("common.No products")},null,8,["title"])):(v(),y(m,{key:1,class:"py-5 px-2.5 pt-2",loading:u.value,"onUpdate:loading":e[0]||(e[0]=a=>u.value=a),finished:r.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:T},{default:$(()=>[(v(!0),w(j,null,J(i.value,a=>(v(),y(K,{key:a.id,data:a,onClick:it=>x(`/goodsDetail?id=${a.id}`),onHandleAddCart:G,onHandleTo:x},null,8,["data","onClick"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"]))])],32)])}}const nt=L({...at,setup:st}),ht=P(nt,[["__scopeId","data-v-6a0ffccf"]]);export{ht as default};
