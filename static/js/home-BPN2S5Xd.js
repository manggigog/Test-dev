import{a as st,_ as ot}from"./2year-CYYQhC3g.js";import{_ as at}from"./adpng-DNKYgzzu.js";import{_ as R,F as h,G as u,H as o,Q as nt,Y as W,Z as j,y as it,l as ct,a1 as lt,bw as C,r as A,x as rt,bh as dt,E as L,O as I,K as G,a2 as Y,X as mt,N as D,I as E,J as H,P as f,aH as ut,o as v,T as m}from"./vendor-BUT0HZ5j.js";import{u as pt,e as ft,h as M}from"./index-k1FFr-1T.js";import{G as _t}from"./goodsItem-DZw0LlCW.js";import{c as gt,a as vt,h as ht,i as yt}from"./festivalActivities-BFq1MXfj.js";import{_ as B}from"./EmptyTipsPop-_FH8A6A8.js";import"./MCOIN-BcbOHmhy.js";import"./cart-D1U0eSk3.js";const wt="/Test-dev/static/images/cloud-Bm1cgOa4.png",xt="/Test-dev/static/images/more-E9N74XOk.svg",bt="/Test-dev/static/images/left-flash-COSh5QZ9.svg",kt="/Test-dev/static/images/right-flash-DBRaslZc.svg",q=r=>(W("data-v-67fd3e7e"),r=r(),j(),r),Ct={class:"tag__wrap"},At=q(()=>o("img",{src:bt,alt:""},null,-1)),It={class:"text-b6 text-base font-semibold leading-4"},Gt=q(()=>o("img",{src:kt,alt:""},null,-1)),Tt={props:{name:{type:String,default:""}},setup(r){return(g,k)=>(u(),h("div",Ct,[At,o("span",It,nt(r.name),1),Gt]))}},$t=R(Tt,[["__scopeId","data-v-67fd3e7e"]]),_=r=>(W("data-v-5d6f14df"),r=r(),j(),r),St={class:"active-container"},Lt=_(()=>o("img",{class:"header-bottom",src:wt},null,-1)),Yt=_(()=>o("img",{class:"w-[22px] h-[22px]",src:st,alt:"返回"},null,-1)),Dt=[Yt],Et={class:"body__wrap"},Ht=_(()=>o("span",{class:"text-[20px] text-b6 font-Puhui"}," 我要报名 ",-1)),Mt={class:"goods-list-container"},Bt={class:"goods-grid"},Rt=["onClick"],Wt=_(()=>o("span",{class:"text-[#FF8812] text-sm font-normal"},"查看更多",-1)),jt=_(()=>o("img",{src:xt,class:"w-5 h-5"},null,-1)),qt=[Wt,jt],Nt=_(()=>o("div",{class:"px-[65px] w-full flex justify-center items-center pt-5"},[o("img",{class:"logo-2-year",src:ot,alt:"2周年"})],-1)),Ot=_(()=>o("img",{src:at,alt:"广告"},null,-1)),Pt=[Ot],Ft=it({name:"520Home"});function Jt(r){pt();const g=ct(),k=lt(),[N,T]=C(!1),[O,$]=C(!1),[P,S]=C(),d=A({fmGeneralActivity:{},fmGeneralActivityLabelList:[],fmGeneralActivityRule:{}}),{accountStore:F}=ft();rt(()=>F.store.id);const J=async()=>{const e={generalActivityId:1};try{const t=await vt(e);t.code==1?(d.value=t.data,Z(),z(),V()):t.message&&m(t.message)}catch(t){console.error("获取活动信息失败:",t),m("获取活动信息失败")}},V=()=>{var a,s;const e=v(),t=v((s=(a=d.value)==null?void 0:a.fmGeneralActivity)==null?void 0:s.endTime);e.isAfter(t)&&$(!0)},Z=()=>{var t,a;const e=(a=(t=d.value)==null?void 0:t.fmGeneralActivity)==null?void 0:a.name;e&&(document.title=e)},y=A({}),z=()=>{var t,a,s,n;const e=((a=(t=d.value)==null?void 0:t.fmGeneralActivity)==null?void 0:a.activityMallImgs)||((n=(s=d.value)==null?void 0:s.fmGeneralActivity)==null?void 0:n.activityMainImgs)||"";if(e){const c=e.split(",")[0];y.value={backgroundImage:`url(${c})`};const l=new Image;l.onload=()=>{const i=l.naturalWidth,p=l.naturalHeight;if(i>0&&p>0){const x=document.documentElement.clientWidth>=375?375:document.documentElement.clientWidth,b=p/i*x;y.value={...y.value,height:`${b}px`}}},l.onerror=()=>{console.log("活动主图图片加载失败")},l.src=c}},w=A([]),Q=async()=>{try{const e=await ht();if(e.code==1&&e.data){const t=e.data||[],a=await Promise.all(t.map(async s=>{var c,l;const n={generalActivityId:((l=(c=d.value)==null?void 0:c.fmGeneralActivity)==null?void 0:l.id)||1,generalActivityClassifyId:s.id,status:2};try{const i=await yt(n);if(i.code==1&&i.data){const p=i.data.slice(0,4)||[];return{...s,goodsList:p}}else return i.message&&i.code!==1&&console.warn(`获取分类 ${s.name} 商品列表提示: ${i.message}`),{...s,goodsList:[]}}catch(i){return console.error(`获取分类 ${s.name} 的商品列表失败:`,i),{...s,goodsList:[]}}}));w.value=a.filter(s=>s.goodsList&&s.goodsList.length>0)}else e.message&&m(e.message),w.value=[]}catch(e){console.error("获取分类或商品列表过程中发生错误:",e),m("加载数据失败"),w.value=[]}},U=()=>{const e="https://metakey.pro/invite?code=cngkfc1i";M(e),ut.confirm({title:"群聊链接",message:"群聊链接已复制，请在手机浏览器打开",showCancelButton:!1}).then(()=>{M(e)})},X=e=>{const t={...e};Reflect.deleteProperty(t,"goodsList"),g.push({path:"520-classify",query:{id:t.id,name:t.name}})},K=()=>{var e,t;((t=(e=window.history)==null?void 0:e.state)==null?void 0:t.back)===null?g.replace({path:"/"}):g.back()},tt=async()=>{var s,n,c,l,i,p,x,b;const e={needlogin:"true",...k.query};g.replace({path:k.path,query:e});const t=new Date().getTime();if(console.log("当前时间",v(t).format("YYYY-MM-DD HH:mm:ss")),console.log("后台配置的报名开始时间",v((n=(s=d.value)==null?void 0:s.fmGeneralActivity)==null?void 0:n.applyStartTime).format("YYYY-MM-DD HH:mm:ss")),console.log("后台配置的报名结束时间",v((l=(c=d.value)==null?void 0:c.fmGeneralActivity)==null?void 0:l.applyEndTime).format("YYYY-MM-DD HH:mm:ss")),t<((p=(i=d.value)==null?void 0:i.fmGeneralActivity)==null?void 0:p.applyStartTime)){m("报名时间未开始");return}if(t>((b=(x=d.value)==null?void 0:x.fmGeneralActivity)==null?void 0:b.applyEndTime)){m("报名时间已结束");return}m.loading({message:"查询中..."});const a=await gt();if(a.code==1&&!a.data){m.clear(),S(!0);return}else a.code==1&&a.data&&setTimeout(()=>{m.clear(),g.push({path:"/520-index",query:{from:"fm"}})},500)},et=async()=>{await J()};return dt(()=>{Q()}),et(),(e,t)=>{const a=L("van-button"),s=L("van-overlay");return u(),h("div",St,[o("div",{class:"header__wrap",style:mt(y.value)},[o("div",{class:"join-im-btn",onClick:U},"活动讨论"),Lt,o("div",{class:"back-arrow w-[22px] h-[22px] absolute top-[11px] left-[9px]",onClick:K},Dt)],4),o("div",Et,[o("div",{class:"btn__wrap w-full",onClick:tt},[I(a,{class:"submit-btn"},{default:D(()=>[Ht]),_:1})]),(u(!0),h(E,null,H(w.value,n=>(u(),h("div",{class:"classify-group pb-3 pt-9",key:n.id},[I($t,{name:n.name},null,8,["name"]),o("div",Mt,[o("div",Bt,[(u(!0),h(E,null,H(n.goodsList,c=>(u(),G(_t,{key:c.id,goods:c},null,8,["goods"]))),128))])]),o("div",{class:"view-more-btn flex justify-center items-center mt-2",onClick:c=>X(n)},qt,8,Rt)]))),128)),Nt]),I(s,{show:f(N),onClick:t[1]||(t[1]=n=>f(T)(!1)),"z-index":"9999"},{default:D(()=>[o("div",{class:"ad-img-container",onClick:t[0]||(t[0]=n=>f(T)(!1))},Pt)]),_:1},8,["show"]),f(O)?(u(),G(B,{key:0,isError:!0,onClose:t[2]||(t[2]=n=>f($)(!1)),text:"很遗憾，活动已过期"})):Y("",!0),f(P)?(u(),G(B,{key:1,isError:!0,onClose:t[3]||(t[3]=n=>f(S)(!1)),text:"很遗憾根据您店铺以往数据综合评估暂不符合报名资质要求"})):Y("",!0)])}}const Vt=Object.assign(Ft,{setup:Jt}),oe=R(Vt,[["__scopeId","data-v-5d6f14df"]]);export{oe as default};
