import{_ as V,z as T,q as U,o as H,y as L,r as b,E as O,F as M,G as _,H as u,I as p,P as S,a3 as X,Z as z,O as $,Q as A,X as R,Y as W,x as Y,$ as F,K as E,J as P,N as D,D as K,U as N,n as J,a4 as Q,V as B,R as Z,S as ee,ab as te}from"./vendor-Dr_RpJ_Y.js";import{_ as se}from"./down-arrow-dGZh9nVp.js";import{a as q,g as ae,B as oe,aE as ne,Y as re,aF as le}from"./index-CU2nzZe6.js";import{H as ce}from"./HelpPop-DStj4MIe.js";import{_ as ie}from"./avatarRing-DtI_kRg6.js";import{O as ue}from"./OfflineMerchantLabel-Cz248kz6.js";import{u as de}from"./useCityMap-gT1oK5g9.js";const pe="/static/images/demo-bg-DyaCmFCf.png",fe="/static/images/search-ClCpHcy8.svg",G=s=>(R("data-v-724e909c"),s=s(),W(),s),me={class:"w-full px-3 py-4 bg-transparent font-Puhui flex flex-row justify-between items-center gap-3"},ve=["onClick"],ge={class:"text-sm text-b2 font-normal min-w-[28px] max-w-[56px]"},he={key:1,class:"line-clamp-1"},ye=G(()=>p("img",{src:se,class:"w-[9px] h-auto"},null,-1)),_e=G(()=>p("div",{class:"divider mx-2 ml-3"},null,-1)),xe={class:"search-box flex items-center justify-start gap-1"},be=G(()=>p("img",{src:fe,class:"w-4 h-4"},null,-1)),we={class:"text-sm text-b3 font-normal w-full"},Ce=T({setup(s){const{cityMapStore:c}=q(),r=U(),l=H(),m=()=>{r.push("/city/search")},g=()=>{r.push({path:"/city/selectArea",query:{mode:"change",from:encodeURIComponent(l.path)}})},x=L(()=>c.currentActiveCity||{}),a=b(0);L(()=>{const n=a.value;return n===0?0:n>99?"99+":n});const y=L(()=>{const n=v.value;return ae.metaKeyDownloadUrl+(n?`/invite?code=${n}`:"")}),v=b(""),d=b(!1);return L(()=>{var n;return{businessGroupId:(n=c.currentActiveCity)==null?void 0:n.businessGroupId}}),O(()=>{}),(n,f)=>{const i=M("van-loading");return u(),_("div",me,[p("div",{class:"w-full h-[36px] bg-white rounded-3xl flex items-center justify-start px-3 border-solid border-[1px] border-[#F1A840]",onClick:m},[p("div",{class:"city-selector flex items-center justify-start gap-1",onClick:X(g,["stop"])},[p("p",ge,[$(x).areaName?(u(),_("span",he,A($(x).areaName),1)):(u(),z(i,{key:0,size:"14"}))]),ye],8,ve),_e,p("div",xe,[be,p("p",we,A(n.$t("city.search_stores_services")),1)])]),S(ce,{show:d.value,"onUpdate:show":f[0]||(f[0]=w=>d.value=w),display:["download","account","wallet","auth"],downloadUrl:$(y),onClose:f[1]||(f[1]=w=>d.value=!1)},null,8,["show","downloadUrl"])])}}}),Ie=V(Ce,[["__scopeId","data-v-724e909c"]]),ke=["onClick"],$e=["src","alt"],Le={class:"text-sm text-b1 font-normal text-center no-wrap"},Se=T({props:{categoryList:{type:Array,default:()=>[]}},emits:["handleMenu","changeTab"],setup(s,{emit:c}){const r=s,{t:l}=Y(),m=L(()=>r.categoryList||[]),g=b(0),x=L(()=>{let v=m.value.slice(0,5),d=m.value.slice(5),n=[];n.push(v);for(let f=0;f<Math.ceil(d.length/10);f++)n.push(d.slice(f*10,(f+1)*10));return n}),a=v=>{g.value=v},y=v=>{c("handleMenu",v)};return(v,d)=>{const n=M("van-swipe-item"),f=M("van-swipe");return u(),z(f,{class:"font-Puhui linear__wrap min-h-[138.5px] pt-[55px]",loop:!1,onChange:a},{default:F(()=>[(u(!0),_(P,null,E($(x),(i,w)=>(u(),z(n,{key:w},{default:F(()=>[p("div",{class:D(["w-full px-[10px] flex flex-wrap content-start transition-all gap-y-[1.5px]",g.value===0?"h-[calc(138.5px-55px)]":"h-[calc(211px-55px)]"])},[(u(!0),_(P,null,E(i,(h,o)=>(u(),_("div",{class:"shrink-0 relative w-[20%] h-fit px-3 py-[5.5px] flex flex-col content-start items-center gap-1",key:w+":"+o,onClick:I=>y(h)},[p("img",{class:"shrink-0 w-[36px] h-[36px]",src:h.goodsCategoryIcon||$(ie),alt:h.goodsCategoryName+"-category"},null,8,$e),p("div",Le,A(h.goodsCategoryName),1)],8,ke))),128))],2)]),_:2},1024))),128))]),_:1})}}}),Ae=V(Se,[["__scopeId","data-v-007034dc"]]),ze="/static/images/wave-BD0prNuS.svg",Me=["onClick","id"],Te={class:"absolute -bottom-1 left-0 shrink-0 w-full flex justify-center items-center"},Ne={key:0,class:"w-fit h-[8px]",src:ze,alt:""},Fe={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16}},emits:["update:modelValue","change"],setup(s,{emit:c}){const r=s,l=b(null),m=b(null),g=b([]),x=L(()=>Array.isArray(r.options)?r.options:Object.values(r.options));function a(o){return o[r.valueKey]===r.modelValue}function y(o){c("update:modelValue",o[r.valueKey]),c("change",o[r.valueKey])}K(()=>r.modelValue,async()=>{r.scrollToSelected&&(await J(),v())},{immediate:!0});function v(){const o=x.value.findIndex(t=>a(t));if(o===-1)return;const I=document.getElementById(`category-tab-item-${o}`),e=l.value;if(I&&e){const t=I.offsetLeft-(r.scrollOffset||0);e.scrollTo({left:t,behavior:"smooth"})}}let d=!1,n=0,f=0;function i(o){d=!0,n=o.touches?o.touches[0].pageX:o.pageX,f=l.value.scrollLeft}function w(o){if(!d)return;const I=o.touches?o.touches[0].pageX:o.pageX,e=n-I;l.value.scrollLeft=f+e}function h(){d=!1}return(o,I)=>(u(),_("div",{class:"category-tab h-[103px] pt-[68px] px-3 linear__wrap",ref:(e,t)=>{t.tabWrapper=e,l.value=e},onMousedown:i,onTouchstart:i,onMousemove:w,onTouchmove:w,onMouseup:h,onMouseleave:h,onTouchend:h},[p("div",{class:"stickyTab flex flex-nowrap justify-start items-start gap-5",ref:(e,t)=>{t.tabList=e,m.value=e}},[(u(!0),_(P,null,E($(x),(e,t)=>(u(),_("div",{key:e[s.valueKey]??t,class:D(["relative shrink-0 mt-[1px] text-sm text-b2 font-normal last:px-3 last:-ml-3",a(e)?"!mt-0 !text-base !text-b1 !font-semibold":""]),onClick:k=>y(e),ref:(k,C)=>{C.tabItems=k,g.value=k},id:`category-tab-item-${t}`},[p("p",null,A(e[s.labelKey]),1),p("div",Te,[a(e)?(u(),_("img",Ne)):N("",!0)])],10,Me))),128))],512)],544))}},Pe=V(Fe,[["__scopeId","data-v-634f6dea"]]),De={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},Ve={class:"shop-content h-full ml-2 w-full"},je={class:"w-full text-base text-b1 font-semibold flex items-center justify-between"},Ee={class:"line-clamp-1"},Be={class:"text-sm text-b3 font-normal"},Ue={class:"h-[20px] text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},Oe={class:"engagement"},qe={key:0,class:"distance"},Ke={props:{backgroundColor:{type:String,default:""},store:{type:Object,default:()=>({})}},setup(s){const{distanceFormat:c}=de(),{cityMapStore:r}=q();return(l,m)=>{var x,a,y,v,d,n,f,i;const g=M("van-image");return u(),_("div",{class:"w-full p-3 bg-white rounded-xl flex items-center justify-start",style:B({backgroundColor:s.backgroundColor})},[p("div",De,[S(g,{width:"80",height:"80",fit:"cover",src:(((x=s.store)==null?void 0:x.storeIcons)||"").split(",")[0]},null,8,["src"]),+((a=s.store)==null?void 0:a.storeGoodsCount)>0?(u(),z(ue,{key:0})):N("",!0)]),p("div",Ve,[p("div",je,[p("span",Ee,A(((y=s.store)==null?void 0:y.storeName)||""),1)]),p("div",Be,A(((v=s.store)==null?void 0:v.goodsCategoryName3)||"")+" "+A(((d=s.store)==null?void 0:d.areaExtName3)||""),1),p("div",Ue,[p("span",Oe,[+((n=s.store)==null?void 0:n.wantCount)?(u(),_(P,{key:0},[Q(A(l.$t("city.xx people want",{val:s.store.wantCount})),1)],64)):N("",!0)]),(f=$(r).locationCoords)!=null&&f.lng&&((i=$(r).locationCoords)!=null&&i.lat)?(u(),_("span",qe,A($(c)(s.store.distance,l.$t("city.Distance from you"))),1)):N("",!0)])])],4)}}},Ge={class:"min-h-[calc(100vh-102px-env(safe-area-inset-bottom)-25px-3.5rem)] p-3 bg-[#f2f0ef] rounded-[20px_20px_0_0]"},He=T({props:{storeParams:{default:()=>{}}},setup(s){const c=s,{cityMapStore:r}=q(),l=U(),m=b(!1),g=b(0),x=b(20),a=b(!1),y=b([]),v=()=>{g.value=0,a.value=!1,y.value=[],d()},d=async()=>{g.value+=1,a.value=!1,m.value=!0,await n(),m.value=!1},n=async()=>{var t,k;let i=[];(r.locationCoords.lat&&r.locationCoords.lng||(t=r.currentActiveCity)!=null&&t.areaLatitude&&((k=r.currentActiveCity)!=null&&k.areaLongitude))&&i.push("asc|distance_order"),i.push("desc|store_home_order"),i.push("asc|store_id");let w=i.length?i.join(","):null;const h={page:g.value,size:x.value,...c.storeParams,sortBy:w},{success:o,data:I}=await ne(h);if(!o||!I||!I.total){a.value=!0;return}const e=I.records||[];e.forEach(C=>{C.shopName=C.storeName||C.shopName}),y.value=g.value===1?e:[...y.value,...e],y.value.length>=I.total&&(a.value=!0)},f=i=>{console.log(i),l.push({path:"/city/cityMap/storefront",query:{storeId:i.storeId,child:1}})};return K(()=>c.storeParams,i=>{i.areaIdPreviousLastLeaf&&v()},{immediate:!0,deep:!0}),O(()=>{}),(i,w)=>{const h=M("van-list");return u(),_("div",Ge,[y.value.length===0&&!m.value?(u(),z(oe,{key:0,name:i.$t("common.No data yet")},null,8,["name"])):(u(),z(h,{key:1,loading:m.value,"onUpdate:loading":w[0]||(w[0]=o=>m.value=o),finished:a.value,"finished-text":i.$t("common.noMore"),onLoad:d},{default:F(()=>[(u(!0),_(P,null,E(y.value,o=>(u(),z(Ke,{key:o.goodsId,store:o,class:"mb-3 :last:mb-0",onClick:I=>f(o)},null,8,["store","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"]))])}}}),Xe=T({props:{topId:{default:"fm-page"},svg:{default:"cityMap/backTop.svg"},size:{default:50},msize:{default:24},right:{default:16},bottom:{default:16},bg:{default:"#FFF"}},setup(s){const c=s;U();const r=b(null),{width:l,height:m}=Z(),{style:g}=ee(r,{initialValue:{x:l.value-(c.right+c.size),y:m.value-(c.bottom+c.size)},onMove:a=>{a.x>c.right&&(a.x=l.value-(c.right+c.size)),a.x<c.right&&(a.x=c.right),a.y>m.value-c.size&&(a.y=m.value-c.size),a.y<0&&(a.y=0)}}),x=()=>{const a=document.querySelector("#"+c.topId);a&&setTimeout(()=>{a.scrollTo({top:0})},50)};return O(()=>{}),(a,y)=>{const v=M("VanImage");return u(),_("div",{ref:(d,n)=>{n.el=d,r.value=d},style:B([$(g),{"touch-action":"none"}]),onClick:x,class:D(["fixed z-[49] flex items-center justify-center rounded-full shadow-[0_1px_16px_0_rgba(0,0,0,0.16)] cursor-pointer",`w-[${s.size}px] h-[${s.size}px] bg-[${s.bg}]`])},[S(v,{src:$(re)(s.svg),class:D(["overflow-hidden",`w-[${s.msize}px] h-[${s.msize}px]`]),alt:""},null,8,["src","class"])],6)}}}),Re=V(Xe,[["__scopeId","data-v-97ea034e"]]),We={class:"header__wrap relative"},Ye={key:1,class:"mt-3"},Je=T({name:"CityMap"});function Qe(s){var I;const c=H(),r=U(),{cityMapStore:l}=q(),m=L(()=>{var C;const e=((C=l.currentActiveCity)==null?void 0:C.areaIcon)||null;return{backgroundImage:`url(${e||pe})`}||{}}),g=b([]),x=async()=>{var C,j;const e={areaIdPreviousLastLeaf:((C=l.currentActiveCity)==null?void 0:C.areaId)||"",overseasFlag:((j=l.currentActiveCity)==null?void 0:j.overseasFlag)||!1},{success:t,data:k}=await le(e);t&&(g.value=k||[])};K(l.currentActiveCity,(e,t)=>{console.log("已选城市发生改变",{newCity:e==null?void 0:e.areaName,oldCity:t==null?void 0:t.areaName,hasAreaId:!!(e!=null&&e.areaId)}),e!=null&&e.areaId&&x()},{immediate:!0,deep:!0});const a=()=>{const e=setInterval(()=>{var t;(t=l.currentActiveCity)!=null&&t.areaId&&(x(),clearInterval(e))},500)},y=e=>{console.log(e),r.push({path:"/city/poi",query:{categoryId:e.goodsCategoryId}})},v=L(()=>{let e=g.value.map(t=>({label:t.goodsCategoryName,value:t.goodsCategoryId}));return e.unshift({label:"附近店铺",value:""}),e}),d=b(((I=v.value[0])==null?void 0:I.value)||""),n=e=>{d.value=e},f=L(()=>{var e,t,k,C;return{goodsCategoryId1:d.value,longitude:l.locationCoords.lng||((e=l.currentActiveCity)==null?void 0:e.areaLongitude)||null,latitude:l.locationCoords.lat||((t=l.currentActiveCity)==null?void 0:t.areaLatitude)||null,areaIdPreviousLastLeaf:((k=l.currentActiveCity)==null?void 0:k.areaId)||"",overseasFlag:((C=l.currentActiveCity)==null?void 0:C.overseasFlag)||!1}}),i=L(()=>document.querySelector("#fm-page")),w=b(0),h=b(!1),o=e=>{if(c.path!=="/city/cityMap"){i.value.removeEventListener("scroll",o);return}w.value=e.target.scrollTop,w.value>=81?h.value=!0:h.value=!1};return O(async()=>{await l.init(),a(),i.value.addEventListener("scroll",o)}),te(()=>{i.value.removeEventListener("scroll",o)}),(e,t)=>{const k=M("van-sticky"),C=M("router-view");return u(),_("div",{class:"app-container img__wrap",style:B($(m))},[S(k,{"z-index":"10"},{default:F(()=>[p("div",We,[S(Ie)])]),_:1}),h.value?(u(),z(k,{key:0,"z-index":"9"},{default:F(()=>[S(Pe,{options:$(v),modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=j=>d.value=j),onChange:n,"label-key":"label","value-key":"value"},null,8,["options","modelValue"])]),_:1})):(u(),_("div",Ye,[S(Ae,{categoryList:g.value,tabFixed:h.value,onHandleMenu:y},null,8,["categoryList","tabFixed"])])),h.value?(u(),_("div",{key:2,class:"imgSticky img__wrap sm:w-[375px] w-full h-[68px] fixed top-0 left-1/2 -translate-x-1/2 z-[8]",style:B($(m))},null,4)):N("",!0),p("div",{class:D(["bg-white pt-[5.5px] mt-[-0.5px]",h.value?"pt-[53px]":""])},[S(He,{storeParams:$(f)},null,8,["storeParams"])],2),S(Re,{size:40,msize:20,bottom:92}),S(C,{class:"child-view !rounded-none"})],4)}}const Ze=T({...Je,setup:Qe}),lt=V(Ze,[["__scopeId","data-v-065b9d53"]]);export{lt as default};
