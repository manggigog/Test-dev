import{_ as le,y as de,w as ue,bn as g,r as m,x as K,D as ce,F as me,a2 as O,P as i,G as q,H as s,O as u,K as pe,Q as l,a0 as y,E as w,N as $,$ as fe,T as C,l as ve,Y as he,Z as ge,a1 as ye,B as we}from"./vendor-CjApaIpB.js";import{_ as be}from"./AddressInfo-C21RjxfH.js";import{_ as _e}from"./EmptyTipsPop-C0Qo2Er1.js";import{O as xe}from"./OrderGoodsBox-CkUFnByH.js";import{c as ke,q as $e}from"./address-XzLIxHZC.js";import{R as Ce,f as Ae,d as Re,a1 as Se,aK as De,r as Be,aH as Ve}from"./index-DBW_ANsl.js";import{u as Ne}from"./useSelectAddress-CgNt0r_o.js";import{l as Ie}from"./luckyShopContract-4MaHABcp.js";import"./mall-BNNzTN-n.js";import"./MCOIN-BcbOHmhy.js";import"./OrderGoods-BVrospYW.js";import"./BoutiqueLable-BYJxmIGq.js";import"./shop-CeqcS6K2.js";import"./flashSale-DDyqLyYN.js";import"./ShopMaskTips-DfjY93ZI.js";import"./enums-DlE-aiss.js";const Pe=f=>(he("data-v-5081c72a"),f=f(),ge(),f),Le={key:0,class:"p-2.5"},Ke={class:"text-xl font-semibold"},Oe={class:"mt-2.5"},qe={class:"bg-white mt-2.5 rounded-xl p-2.5 flex items-center justify-between gap-2"},Ge={class:"flex-1"},Te={class:"bg-white mt-2.5 rounded-xl p-2.5"},Ee={class:"flex items-baseline justify-between mt-1"},Fe={class:"opacity-60"},Me={class:"text-right"},He=Pe(()=>s("div",{class:"text-base font-semibold"},"0Mcoin",-1)),Ue={class:"opacity-60"},je={class:"flex flex-col items-center my-[50px]"},ze={class:"p-2.5 pb-[150px]"},Qe={class:"relative text-center mb-2.5"},Ye=de({setup(f){const{generateKey:A,decryptAddressKey:G,getUserDhKey:T,encryptAddressKey:R,formatAddressData:S}=Ce(),{luckyComfirmRandom:E,commodities:F}=Ie(),{t:b}=ue(),{loadingToggle:D}=Be(),{getAddress:B,setAddress:M}=Ne(),{tradeContributeSelfRate:H}=Ae(),U=ye(),v=ve(),[j,z]=g(!1),[_,x]=g(!1),[Q,Y]=g(!0),[Z,V]=g(!1),k=m([]),a=m(),c=m(),p=m(""),h=m(1),J=K(()=>{var e;return((e=c.value)==null?void 0:e.price)*h.value}),W=K(()=>Re(N.value/100*J.value*I.value)),X=async()=>{if(B()){a.value=B(),M(null);return}const e=v.currentRoute.value.path,t=await $e();if(!t.success)return;k.value=t.data;const n=k.value.find(o=>o.isDefault===1)||k.value[0],d=await A("user",e);if(n!=null&&n.encryptFlag&&d){a.value=G(n,d);return}a.value=n},ee=async()=>{const e=await Ve(+U.query.id);e.success,c.value=e.data},N=m(null),te=async()=>{const e=await F(c.value.id);N.value=+we(+e.discountRate).div(1e4).toNumber()||20},se=e=>{e<1?h.value=1:h.value=e},ae=async()=>{var r,L;if(!a.value)return C(b("order.setAddress"));if((r=a.value)!=null&&r.encryptFlag&&!((L=a.value)!=null&&L.success))return C(b("order.reconfirm the information"));if(!Se(a.value.telNumber))return C(b("address.number was identified"));const e=v.currentRoute.value.path;V(!0);const t=await T(c.value.shopId),n=await A("user",e);let d;n&&!a.value.encryptFlag&&(d=R(a.value,n),await ke({...d,isDefault:a.value.isDefault?1:0}));let o={};if(t?(o=S(o,{...a.value,postscript:p.value},1),o=R(o,t),o.submitHash=o.hash):o=S(o,{...a.value,postscript:p.value},0),(await De({odGoodsId:c.value.id,...o})).success){const ie=await E(c.value.id);if(V(!1),!ie.success)return;v.replace({path:"/flashSale",query:{refresh:1}})}},I=m(0),oe=async()=>{I.value=await H()},ne=async()=>{D(!0),await X(),await ee(),await te(),oe(),D(!1),Y(!1)},re=e=>{v.push(e)};return ce(()=>{ne()}),(e,t)=>{const n=w("van-icon"),d=w("VanButton"),o=w("van-field"),P=w("VanPopup");return i(Q)?O("",!0):(q(),me("div",Le,[s("header",Ke,l(e.$t("order.submitOrder")),1),u(be,{class:"mt-2.5",defaultAddress:a.value,onClick:t[0]||(t[0]=r=>re("/userAddress"))},null,8,["defaultAddress"]),s("div",Oe,[u(xe,{needMask:!1,orderInfo:c.value,number:h.value,onChangeNumber:se,isDisabledEdit:!0,isDisabledEditCount:!0},null,8,["orderInfo","number"])]),s("div",qe,[s("div",Ge,l(e.$t("order.remark")),1),s("div",{class:"flex-1 text-right line-clamp-1 opacity-60 whitespace-nowrap",onClick:t[1]||(t[1]=r=>i(x)(!0))},[y(l(p.value?p.value:e.$t("order.noRemark"))+" ",1),u(n,{name:"arrow"})])]),s("div",Te,[s("div",null,l(e.$t("order.priceDetail")),1),s("div",Ee,[s("div",Fe,l(e.$t("order.total")),1),s("div",Me,[He,s("div",Ue,l(e.$t("order.getContribution",{num:i(W)})),1)])])]),s("div",je,[u(d,{class:"btn-orange btn-shadow w-[150px] h-[40px] text-white",loading:i(Z),onClick:ae},{default:$(()=>[y(l(e.$t("common.confirm")),1)]),_:1},8,["loading"])]),u(P,{show:i(_),"onUpdate:show":t[5]||(t[5]=r=>fe(_)?_.value=r:null),position:"bottom",round:"",style:{"text-align":"center"}},{default:$(()=>[s("div",ze,[s("div",Qe,[y(l(e.$t("order.submitOrder"))+" ",1),s("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:t[2]||(t[2]=r=>i(x)(!1))},[u(n,{name:"cross"})])]),u(o,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=r=>p.value=r),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:e.$t("order.remarkDes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),u(d,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",onClick:t[4]||(t[4]=r=>i(x)(!1))},{default:$(()=>[y(l(e.$t("common.confirm")),1)]),_:1})]),_:1},8,["show"]),i(j)?(q(),pe(_e,{key:0,onClose:t[6]||(t[6]=r=>i(z)(!1)),text:e.$t("common.pay success")},null,8,["text"])):O("",!0)]))}}}),mt=le(Ye,[["__scopeId","data-v-5081c72a"]]);export{mt as default};
