import{_ as G}from"./clear-post-iaUxhveN.js";import{B as J}from"./BackIcon-biFt6cm7.js";import{B as K}from"./BetweenTab-Bn5ZVRk8.js";import{l as z}from"./shop-CeqcS6K2.js";import{v as W,l as X}from"./index-BvL8wS8a.js";import{_ as R,w as D,x as Y,F as v,G as l,H as a,a2 as N,Q as m,P as y,y as Z,l as ee,a1 as te,r as c,z as ae,be as ne,D as se,E as w,O as k,K as I,bq as oe,N as g,I as le,J as re,T as C}from"./vendor-BUT0HZ5j.js";import{g as ie,r as ce,q as ue,s as de}from"./notice-CCZQIyjY.js";/* empty css                                                               */const me={class:"w-full bg-white rounded-xl p-3 overflow-x-hidden"},pe={class:"title__wrap w-full flex justify-start items-center"},fe={key:0,class:"w-[8px] h-[8px] rounded-full mr-1.5 bg-[#FF8812] flex-shrink-0"},ve={class:"text-base text-b1 font-normal text-ellipsis line-clamp-1 flex-1 min-w-0"},xe={key:1,class:"text-xs font-normal border border-[#FF8812] rounded-[2px] px-1 text-[#FF8812] ml-1 flex-shrink-0"},he=["innerHTML"],_e={class:"time__wrap w-full mt-2 no-wrap text-right"},ge={class:"text-sm text-b3 font-normal"},ye={props:{item:{type:Object,default:()=>{}}},setup(n){const u=n,{t:x}=D(),{currentLocale:h}=W(),U={1:x("notice.type.platform"),2:x("notice.type.site")},p=Y(()=>{const _=u.item[`content${z[h.value]}`]||u.item.contentCn||u.item.contentEn;return _?_.replace(/<[^>]*>/g,""):""});return(_,r)=>(l(),v("div",me,[a("div",pe,[n.item.readFlag?N("",!0):(l(),v("div",fe)),a("p",ve,m(n.item[`title${y(z)[y(h)]}`]||n.item.titleCn||n.item.titleEn),1),n.item.type?(l(),v("p",xe,m(U[n.item.type]),1)):N("",!0)]),a("div",{class:"content__wrap w-full text-sm text-b2 font-normal mt-2 line-clamp-2",innerHTML:y(p)},null,8,he),a("div",_e,[a("p",ge,m(y(X)(n.item.updateTime||n.item.createTime)),1)])]))}},be=R(ye,[["__scopeId","data-v-4256b51e"]]),we={class:"w-full h-full bg-[#f2f0ef]"},ke={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 bg-white"},Ce={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Ue={class:"font-bold text-base text-b1"},Le={key:1,class:"w-5 h-5",src:G,alt:"一键清空已读"},Te={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Fe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},$e={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ie={class:"list__wrap w-full h-[calc(100vh-50px-34px)] z-10 overflow-y-auto scroll-smooth px-3"},Ne=Z({name:"PostList"});function Ve(n){const{t:u}=D(),x=ee(),h=te(),U=[{label:u("notice.type.all"),value:0},{label:u("notice.type.platform"),value:1},{label:u("notice.type.site"),value:2}],p=c(0),_=c(20),r=c(!1),f=c(!1),i=c([]),b=c({type:(()=>{const e=h.query.type;if(e!==void 0){const t=parseInt(e);return[0,1,2].includes(t)?t:0}return 0})()});ae(()=>b.value.type,e=>{const t={...h.query};e===0?delete t.type:t.type=e.toString(),x.replace({query:t})},{immediate:!1});const[V,B]=ne(!1),L=c(null),j=()=>{if(V.value)return;const e=Date.now();if(L.value&&e-L.value<2e3){C("请勿频繁点击");return}const t={type:null};B(!0),ce(t).then(s=>{s.success&&(C("已清除未读消息"),H(),T())}).catch(s=>{console.error("清空已读失败:",s)}).finally(()=>{B(!1)}),L.value=e},H=async()=>{i.value.forEach(e=>{e.readFlag=!0})},T=()=>{p.value=0,i.value=[],f.value=!1,E(),q()},E=()=>{f.value||(r.value=!0,p.value+=1,M())},M=()=>{const e={...b.value,page:p.value,size:_.value};ue(e).then(t=>{if(t.success===!1){C(t.message||"获取数据失败"),f.value=!0;return}const s=t.data||[],$=t.total||0;i.value=p.value===1?s:i.value.concat(s),(i.value.length>=$||s.length===0)&&(f.value=!0)}).catch(t=>{console.error("获取公告列表失败:",t),C("网络错误，请稍后重试"),f.value=!0}).finally(()=>{r.value=!1})},O=e=>{T()},P=e=>{const t=e.id;e.readFlag=!0,S(t),x.push("/postDetail?id="+t)},S=async e=>{await de(e)},d=c({versionUnread:0,platformUnread:0,totalUnread:0}),q=async()=>{const e=await ie();if(e.success){d.value=e.data||{};return}console.log(e.data)};se(()=>{q()});const F=e=>e===0?0:e>99?"99+":e;return(e,t)=>{const s=w("van-loading"),$=w("Empty"),A=w("van-list"),Q=w("van-pull-refresh");return l(),v("div",we,[a("section",ke,[a("div",Ce,[k(J)]),a("div",Ue,m(e.$t("home.Announcement List Public")),1),a("div",{class:"absolute right-4 flex items-center gap-1 -translate-y-1/2 top-1/2 w-5 h-5",onClick:j},[y(V)?(l(),I(s,{key:0,size:"20"})):(l(),v("img",Le))])]),a("section",null,[k(K,{options:U,modelValue:b.value.type,"onUpdate:modelValue":t[0]||(t[0]=o=>b.value.type=o),onChange:O,"label-key":"label","value-key":"value"},oe({_:2},[d.value.totalUnread>0?{name:"badge0",fn:g(()=>[a("span",Te,m(F(d.value.totalUnread)),1)])}:void 0,d.value.platformUnread>0?{name:"badge1",fn:g(()=>[a("span",Fe,m(F(d.value.platformUnread)),1)])}:void 0,d.value.versionUnread>0?{name:"badge2",fn:g(()=>[a("span",$e,m(F(d.value.versionUnread)),1)])}:void 0]),1032,["modelValue"])]),a("section",Ie,[k(Q,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value=o),onRefresh:T,"animation-duration":"0"},{default:g(()=>[i.value.length===0&&!r.value?(l(),I($,{key:0,name:"暂无消息"})):N("",!0),k(A,{loading:r.value,"onUpdate:loading":t[1]||(t[1]=o=>r.value=o),finished:f.value,"finished-text":i.value.length===0?"":"没有更多了",onLoad:E},{default:g(()=>[(l(!0),v(le,null,re(i.value,o=>(l(),I(be,{key:o.id,item:o,class:"mb-3 first:mt-3",onClick:qe=>P(o)},null,8,["item","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])])}}const Be=Object.assign(Ne,{setup:Ve}),Se=R(Be,[["__scopeId","data-v-3c0cd0a6"]]);export{Se as default};
