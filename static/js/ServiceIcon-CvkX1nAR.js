import{w as J,b as W,a as Z,Y as y,h as X,aw as ee}from"./index-7OiUoGXy.js";import{z as R,x as K,r as _,E as M,F as x,Z as A,H as l,$ as P,I as t,Q as $,P as v,a3 as O,G as S,K as se,J as Q,_ as oe,y as j,a2 as I,D as z,U as L,O as f,q as te,a1 as ne,a0 as ae,T as V}from"./vendor-Dr_RpJ_Y.js";import{c as re,i as ie,s as ce}from"./convertToImage-BdAJcJnz.js";import{d as N}from"./active_empty-OYjsVrLW.js";import{H as le}from"./HelpPop-CAuHPFSL.js";const ue=""+new URL("../images/kefu-D_Ko4rIY.svg",import.meta.url).href,de=""+new URL("../images/arrow-gray-T4ECaI19.svg",import.meta.url).href,pe={class:"w-full py-4 px-4 safe-bottom overflow-hidden font-Puhui"},me={class:"text-center flex-1 relative mx-1 pb-4"},he={class:"text-lg leading-[26px] text-b1 font-bold"},fe={class:"absolute right-0 top-0"},ve={class:"bg-white rounded-xl px-3"},ge=["onClick"],we={class:"flex items-center gap-2"},ke={class:"text-sm text-b1 font-semibold line-clamp-1"},ye=t("img",{class:"shrink-0 w-5 h-5",src:de,alt:""},null,-1),xe=R({props:{serviceActions:null},emits:["close","selectService"],setup(u,{emit:m}){const{t:o}=K(),h=_(!0);return M(async()=>{}),(g,d)=>{const r=x("van-icon"),p=x("VanImage"),w=x("VanPopup");return l(),A(w,{teleport:"body",show:h.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:d[1]||(d[1]=n=>g.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%] bg-b5",style:{"border-radius":"16px 16px 0 0"}},{default:P(()=>[t("div",pe,[t("header",me,[t("div",he,$(g.$t("common.service")),1),t("div",fe,[v(r,{name:"cross",size:"24",onClick:d[0]||(d[0]=O(()=>{m("close")},["stop"]))})])]),t("div",ve,[(l(!0),S(Q,null,se(u.serviceActions,n=>(l(),S("div",{class:"py-3 flex justify-between items-center gap-2 border-b-[0.5px] border-b4 border-solid last:!border-0",key:n.id,onClick:i=>m("selectService",n)},[t("div",we,[v(p,{src:n==null?void 0:n.icon,radius:"32px",width:"32px",height:"32px",fit:"cover"},null,8,["src"]),t("span",ke,$(n.text),1)]),ye],8,ge))),128))])])]),_:1},8,["show"])}}}),Se={class:"img-box flex flex-col items-center gap-3"},_e=["src"],be={key:0,class:"text-lg leading-[26px] text-b1 font-bold"},Ce={key:0,class:"fixed left-0 w-full px-2.5 flex-center-bw top-1.5"},Ie={class:"ml-1 text-sm font-normal"},$e=R({props:{show:{type:Boolean},imgUrl:null,nickname:null},emits:["close","onSuccess"],setup(u,{emit:m}){const o=u,{loadingToggle:h}=J(),g=j(()=>o.imgUrl?o.imgUrl.startsWith("http")?o.imgUrl+"?"+new Date().getTime():N:N),[d,r]=I(!1),p=()=>{m("close")};z(()=>o.show,i=>{i&&r(!1)},{immediate:!0,deep:!0});const w=()=>{r(!0),h(!0),document.getElementById("serverQR")?setTimeout(()=>{n()},200):setTimeout(()=>{n()},3e3)},n=async()=>{let i=document.getElementById("serverQR");i.style.display="block";const c=await re(i);await ie(c)&&ce(c,"img")&&setTimeout(()=>{p(),r(!1),h(!1),m("onSuccess")},3e3)};return(i,c)=>{const k=x("van-icon"),B=x("VanButton"),T=x("VanPopup");return l(),A(T,{show:o.show,"onUpdate:show":c[1]||(c[1]=U=>o.show=U),teleport:"body",style:{background:"transparent"},onClickOverlay:p},{default:P(()=>[t("div",{class:"popup-content flex items-center justify-center",onClick:p},[t("div",{id:"serverQR",onClick:c[0]||(c[0]=O(()=>{},["stop"]))},[t("div",Se,[t("img",{class:"shrink-0",src:f(g),alt:"",crossOrigin:"anonymous"},null,8,_e),u.nickname?(l(),S("div",be,$(u.nickname),1)):L("",!0)])]),f(d)?L("",!0):(l(),S("div",Ce,[v(B,{class:"text-sm h-[30px] min-w-[65px] rounded-2xl text-white share-btn",onClick:O(w,["stop"])},{default:P(()=>[v(k,{name:"back-top",class:"rotate-180",size:"14"}),t("span",Ie,$(i.$t("common.save")),1)]),_:1},8,["onClick"]),t("div",{class:"share-btn w-[30px] h-[30px] rounded-full flex justify-center items-center text-white text-lg",onClick:p},[v(k,{name:"cross"})])]))])]),_:1},8,["show"])}}}),Le=oe($e,[["__scopeId","data-v-21a10ca8"]]),Be=t("img",{class:"w-5 h-5",src:ue},null,-1),Re=R({props:{show:{type:Boolean,default:!0},shop:null,showInfo:{type:Boolean},showClerk:{type:Boolean}},emits:["handleTo"],setup(u,{emit:m}){const o=u,{checkLoginAuth:h}=W(),{accountStore:g}=Z(),d=te(),{t:r}=K(),[p,w]=I(!1),[n,i]=I(!1),[c,k]=I(!1),B=j(()=>{var s,a;let e=[];return p.value?e.push({id:"metakey",icon:y("innerService/metakey.svg"),text:r("service.metakey chat")}):e.push({id:"downloadmetakey",icon:y("innerService/metakey.svg"),text:r("service.metakey chat")}),((s=g.account)==null?void 0:s.toLowerCase())!==((a=o.shop.merchant)==null?void 0:a.toLowerCase())&&e.push({id:"service",icon:y("innerService/service.svg"),text:r("common.service")}),o.showInfo&&e.push({id:"shopinfo",icon:y("shop/shop-info.svg"),text:r("order.shopInfo")}),o.showClerk&&(e=e.concat(D.value)),e}),T=()=>{k(!0)},U=e=>{var s;if(k(!1),e.id==="metakey"){if(!h(!0))return;try{window==null||window.handleCustomerService({shopId:(s=o.shop)==null?void 0:s.id})}catch(a){console.log(a)}}else if(e.id==="downloadmetakey")F();else if(e.id==="service"){if(!h(!0))return;d.push({path:"/innerServiceChat",query:{shopId:o.shop.id,storeName:o.shop.storeName,storeLogo:encodeURIComponent(o.shop.logo||(o.shop.scenery?o.shop.scenery.split(",")[0]:"")||"")}})}else e.id==="shopinfo"?Y():e.customerServiceLink?e.customerServiceLink.includes("img.s3")?(E.value=e.customerServiceLink,H.value=e.text,i(!0)):(V({message:r("common.link copy and open"),duration:4e3}),X(e.customerServiceLink)):V({message:r("common.no service")})},D=_([]),E=_(null),H=_(null),q=async()=>{const e=o.shop.id,s=await ee(e);if(s.success||s.msg==="SUCCESS"){let a=[];s.data.forEach(C=>{C.customerServiceLink&&a.push({text:C.nickname,id:C.id,customerServiceLink:C.customerServiceLink,disabled:!1,icon:y("shop/shop-info.svg")})}),D.value=a}},b=_(!1),F=()=>{b.value=!0},Y=()=>{var e,s;(e=o.shop)!=null&&e.merchant&&m("handleTo",`/shopInfo?address=${(s=o.shop)==null?void 0:s.merchant}`)},G=()=>{V({message:r("common.Saved successfully"),icon:y("toast-success.svg"),duration:3e3}),i(!1)};return z(()=>o.shop,e=>{e!=null&&e.id&&q()},{immediate:!0,deep:!0}),M(()=>{var e;(e=window.ethereum)!=null&&e.isMetaKey?w(!0):w(!1)}),(e,s)=>(l(),S(Q,null,[u.show?(l(),S("div",{key:0,onClick:T},[ne(e.$slots,"default",{},()=>[Be])])):L("",!0),f(c)?(l(),A(xe,{key:1,serviceActions:f(B),onSelectService:U,onClose:s[0]||(s[0]=a=>f(k)(!1))},null,8,["serviceActions"])):L("",!0),v(Le,{show:f(n),"onUpdate:show":s[1]||(s[1]=a=>ae(n)?n.value=a:null),imgUrl:E.value,nickname:H.value,onOnSuccess:G,onClose:s[2]||(s[2]=a=>f(i)(!1))},null,8,["show","imgUrl","nickname"]),v(le,{show:b.value,"onUpdate:show":s[3]||(s[3]=a=>b.value=a),display:["download","account","wallet","auth"],onClose:s[4]||(s[4]=a=>b.value=!1)},null,8,["show"])],64))}});export{Re as _};
