import{w as oe,F as c,G as l,H as e,Q as s,a2 as h,P as o,a0 as k,E as H,O as _,N as T,_ as ne,r as S,K as $,J as ge,R as ye,ba as we,bb as Ce,I as re,$ as Se,T as p,y as ae,l as $e,a1 as ke,bc as C,x as ee,D as Te}from"./vendor-D6JO6WHW.js";import{_ as De}from"./OfflineGoods-B2XKWwbl.js";import{_ as Oe}from"./OfflineStore-07wrZPej.js";import{a as Ee,_ as Le}from"./ServiceByStore-SaLl69jD.js";import{_ as K}from"./MCOIN-BcbOHmhy.js";import{_ as Re}from"./link-BVzz25qg.js";import{_ as le}from"./copy-w-7FY5xbhR.js";import{d as q,q as Ae,b as te,h as se,l as F,R as Pe,o as Ie,e as je,C as Ne,bd as Be,bf as Me}from"./index-koYZVdtr.js";import{a as m,o as Ve}from"./offlineGoods-Biq4pIIG.js";import{C as qe}from"./CommonVanProvider-CI5dtYow.js";import{_ as Fe}from"./EmptyTipsPop-Bp6uSD1l.js";import"./ImgBoutiqueLable-Dod52ZXF.js";import"./shop-CeqcS6K2.js";import"./BackIcon-CPUEW9je.js";const He={class:"p-3 break-all bg-white rounded-xl"},Ke={class:"title text-b1 text-sm font-semibold"},Ue={class:"content"},Ye={class:"flex justify-between items-center mt-[16px]"},Ge={class:"text-b3 text-sm font-normal"},ze={class:"text-b1 text-sm font-normal text-right"},Je={class:"flex justify-start items-center"},Qe=e("img",{class:"w-[17px] h-[17px] flex-shrink-0",src:K},null,-1),We={class:"text-b1 text-sm font-normal ml-1"},Xe={key:0,class:"flex justify-between items-center mt-[16px]"},Ze={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},et={class:"text-b1 text-sm font-normal text-right"},tt={class:"flex justify-start items-center"},st=e("span",{class:"text-b1 text-sm font-normal"}," - ",-1),ot=e("img",{class:"w-[17px] h-[17px] ml-1",src:K},null,-1),nt={class:"text-b1 text-sm font-normal ml-1"},rt={class:"flex justify-between items-center mt-[16px]"},at={class:"text-b3 text-sm font-normal"},lt={class:"text-b1 text-sm font-normal text-right"},it={class:"flex justify-start items-center"},ct=e("img",{class:"w-[17px] h-[17px]",src:K},null,-1),dt={class:"text-b1 text-sm font-normal ml-1"},ut={class:"flex justify-between items-center mt-[16px]"},mt={class:"text-b3 text-sm font-normal"},ft={class:"text-b1 text-sm font-normal text-right"},ht={class:"flex justify-between items-center mt-[16px]"},vt={class:"text-b3 text-sm font-normal"},_t=["href"],xt=e("img",{src:Re,class:"w-5 h-5 ml-1",alt:""},null,-1),pt={key:1},bt={class:"flex justify-between items-center mt-[16px]"},gt={class:"text-b3 text-sm font-normal"},yt=e("img",{src:le,class:"w-5 h-5 ml-1",alt:""},null,-1),wt={key:1,class:"flex justify-between items-center mt-[16px]"},Ct={class:"text-b3 text-sm font-normal"},St={class:"text-b1 text-sm font-normal text-right"},$t={key:2,class:"flex justify-between items-center mt-[16px]"},kt={class:"text-b3 text-sm font-normal"},Tt={class:"text-b1 text-sm font-normal text-right"},Dt={key:3,class:"flex justify-between items-center mt-[16px]"},Ot={class:"text-b3 text-sm font-normal"},Et={key:0},Lt={key:1},Rt={class:"text-b1 text-sm font-normal text-right"},At={key:4,class:"flex justify-between items-center mt-[16px]"},Pt={class:"text-b3 text-sm font-normal"},It={class:"text-b1 text-sm font-normal text-right"},jt={class:"flex justify-between items-center mt-[16px]"},Nt={class:"text-b3 text-sm font-normal whitespace-nowrap"},Bt={class:"text-b1 text-sm font-normal text-right flex items-center"},Mt={class:"break-all flex-1"},Vt=e("img",{src:le,class:"w-5 h-5",alt:""},null,-1),qt=[Vt],Ft={props:{order:{type:Object,required:!0,default:()=>({})}},setup(t){const{t:r}=oe();return(n,u)=>{var v;return l(),c("div",He,[e("div",Ke,s(n.$t("order.orderInfo")),1),e("div",Ue,[e("div",Ye,[e("div",Ge,s(n.$t("office.server price")),1),e("div",ze,[e("p",Je,[Qe,e("span",We,s(o(q)(t.order.orderTotalAmount)),1)])])]),t.order.actAmount?(l(),c("div",Xe,[e("div",Ze,s(((v=t.order.fmGeneralActivity)==null?void 0:v.name)||"-"),1),e("div",et,[e("p",tt,[st,ot,e("span",nt,s(o(q)(t.order.actAmount)),1)])])])):h("",!0),e("div",rt,[e("div",at,s(n.$t("order.total price actual")),1),e("div",lt,[e("p",it,[ct,e("span",dt,s(o(q)(t.order.orderRealAmount)),1)])])]),e("div",ut,[e("div",mt,s(n.$t("common.ratio")),1),e("div",ft,s(t.order.orderDiscountRatio)+"% ",1)]),e("div",ht,[e("div",vt,s(n.$t("order.hash")),1),t.order.orderTransactionHash?(l(),c("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${o(Ae).chainConfig.blockExplorerUrls[0]}/tx/${t.order.orderTransactionHash}`},[k(s(o(te)(t.order.orderTransactionHash,"***",9,5)||"--")+" ",1),xt],8,_t)):(l(),c("span",pt," -- "))]),e("div",bt,[e("div",gt,s(n.$t("offline.create address")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:u[0]||(u[0]=b=>o(se)(t.order.orderPayAddress))},[k(s(o(te)(t.order.orderPayAddress,"...",5,5))+" ",1),yt])]),t.order.createTime?(l(),c("div",wt,[e("div",Ct,s(n.$t("order.createTime")),1),e("div",St,s(o(F)(t.order.createTime)),1)])):h("",!0),t.order.payTime?(l(),c("div",$t,[e("div",kt,s(n.$t("order.chainFinishTime")),1),e("div",Tt,s(o(F)(t.order.payTime)),1)])):h("",!0),t.order.finishTime?(l(),c("div",Dt,[e("div",Ot,[t.order.orderStatus===o(m).CANCELLED?(l(),c("span",Et,s(n.$t("offline.cancel_time")),1)):(l(),c("span",Lt,s(n.$t("order.finishTime")),1))]),e("div",Rt,s(o(F)(t.order.finishTime)),1)])):h("",!0),t.order.orderStatus===o(m).CANCELLED?(l(),c("div",At,[e("div",Pt,s(n.$t("offline.cancel_reason")),1),e("div",It,s(t.order.cancelReason||"--"),1)])):h("",!0),e("div",jt,[e("div",Nt,s(n.$t("order.orderNumber")),1),e("div",Bt,[e("div",Mt,s(t.order.orderId||"--"),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:u[1]||(u[1]=b=>o(se)(t.order.orderId))},qt)])])])])}}},Ht={class:"flex justify-between items-center gap-3 fixed bottom-0 left-0 right-0 px-3 pb-4"},Kt={key:0,class:"relative w-full"},Ut={key:1,class:"relative w-full"},Yt={props:{order:{type:Object,default:()=>({})},cancelLoading:{type:Boolean,default:!1},deliverLoading:{type:Boolean,default:!1}},emits:["handleCancel","handleDeliver"],setup(t,{emit:r}){const n=()=>{r("handleCancel")},u=()=>{r("handleDeliver")};return(v,b)=>{const g=H("VanButton");return l(),c("div",Ht,[t.order.orderStatus===o(m).PAYMENT_SUCCESS?(l(),c("div",Kt,[_(g,{round:"",class:"w-full gray-btn border-btn font-normal text-base h-[46px] rounded-full",onClick:n,loading:t.cancelLoading,disabled:t.deliverLoading},{default:T(()=>[k(s(v.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"])])):h("",!0),t.order.orderStatus===o(m).PAYMENT_SUCCESS?(l(),c("div",Ut,[_(g,{round:"",class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:u,loading:t.deliverLoading,disabled:t.cancelLoading},{default:T(()=>[k(s(v.$t("order.Ship")),1)]),_:1},8,["loading","disabled"])])):h("",!0)])}}},Gt="/Test-dev/static/images/check-HLHTc74I.svg",zt={class:"flex flex-col justify-between px-4"},Jt={class:"flex-1"},Qt={class:"mt-[16px] font-semibold text-base text-center"},Wt={class:"mt-[16px]"},Xt=["onClick"],Zt={class:"ml-auto"},es={src:Gt,class:"w-5 h-5",alt:"已选"},ts={class:"py-4 flex justify-between"},ss={props:{show:{type:Boolean,default:!1}},emits:["close","selected"],setup(t,{emit:r}){const n=S({}),u=[{id:1,value:"客户不想购买"},{id:2,value:"缺货或库存问题"},{id:3,value:"下单信息错误"},{id:4,value:"恶意订单"},{id:5,value:"其他"}],v=()=>{n.value={},r("close")},b=y=>{n.value=y},g=()=>{if(!n.value.id)return p("请选择取消原因"),!1;r("selected",n.value)};return(y,D)=>{const a=H("VanButton"),O=H("van-popup");return l(),$(O,{show:t.show,"onUpdate:show":D[0]||(D[0]=f=>Se(show)?show.value=f:null),position:"bottom",round:"",onClose:v,closeable:""},{default:T(()=>[e("div",zt,[e("div",Jt,[e("div",Qt,s(y.$t("offline.select cancel order reason")),1),e("div",Wt,[(l(),c(re,null,ge(u,f=>e("div",{key:f.id,class:"select-item w-full h-[52px] border-b border-[#D9D9D9] flex items-center justify-start",onClick:U=>b(f)},[e("div",{class:ye(["text-sm",[n.value.id==f.id?"text-[#FF8812] font-semibold":"text-b1 font-normal"]])},s(f.value),3),e("div",Zt,[we(e("img",es,null,512),[[Ce,n.value.id==f.id]])])],8,Xt)),64))])]),e("div",ts,[_(a,{round:"",class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:g,disabled:!n.value},{default:T(()=>[k(s(y.$t("order.cancelOrder")),1)]),_:1},8,["disabled"])])])]),_:1},8,["show"])}}},os=ne(ss,[["__scopeId","data-v-7464a8f2"]]),ns={class:"px-3 pb-20 flex flex-col gap-3 safe-body overflow-y-auto"},rs={class:"w-full p-3 rounded-xl bg-white font-Puhui"},as=ae({name:"offlineMerchantDetail"});function ls(t){var X;const{t:r}=oe(),n=$e(),u=ke(),{getMerchantDhKey:v,decryptKey:b}=Pe(),{offlineMerchantCancel:g,offlineMerchantConfirm:y}=Ie(),D={[m.PAYMENT_FAILED]:r("order.fail"),[m.PAYING]:r("order.paying"),[m.PAYMENT_SUCCESS]:r("order.wait"),[m.CANCELLED]:r("order.canceled"),[m.COMPLETED]:r("order.completed"),[m.CLOSED]:r("order.closed")},a=S({orderRemark:""}),[O,f]=C(!1),[U,E]=C(!1),[ie,Y]=C(!1),{accountStore:A,clerkStore:L}=je(),[ce,P]=C(!1),I=S("发货成功"),j=S(!1),N=S(((X=u.query)==null?void 0:X.id)||""),G=async()=>new Promise(async d=>{var x,w,Z;f(!0);const i=await Be({id:N.value});if(f(!1),d(!0),p.clear(),!!i.success&&(a.value=i.data||{},(x=i.data)!=null&&x.orderCustomerAddress&&(w=i.data)!=null&&w.orderRemark&&(Z=i.data)!=null&&Z.orderSubmitCustomerPubKey))try{const R=await v(i.data.merchantAddress,i.data.orderSubmitCustomerPubKey);if(R){const be=b(i.data.orderRemark,R);a.value.orderRemark=be.decrypt}}catch(R){console.error("解密失败:",R)}}),z=async()=>{G()},J=ee(()=>Ve(a.value.orderType)),de=ee(()=>D[a.value.orderStatus]||"--"),B=S(null),[ue,M]=C(!1),me=()=>{if(A.isOnlyView)return p(r("order.Requires merchant account operation"));if(L.isClerk&&!L.clerkAuth)return p(r("order.Requires merchant account operation"));(a.value.orderStatus||null)===m.PAYMENT_SUCCESS?M(!0):p(r("offline.order status does not support cancel"))},fe=d=>{B.value=d,console.log("cancelReason",B.value),M(!1),_e()},[he,V]=C(!1),ve=r("offline.cancel important msg"),_e=()=>{V(!0)},Q=()=>{V(!1)},xe=async()=>{V(!1);const d={orderId:a.value.orderId,cancelReason:B.value.value||"其他"};E(!0);const i=await Me(d);if(E(!1),!i.success)return;const x=[a.value.chainOrderId];E(!0);const w=await g(x);E(!1),w.success&&(z(),j.value=!1,I.value=r("offline.successful of cancel "),P(!0),sessionStorage.setItem("merchant_offline_refresh_chainOrderId",N.value.toString()),n.go(-1))},W=async()=>{if(A.isOnlyView)return p(r("order.Requires merchant account operation"));if(L.isClerk&&!L.clerkAuth)return p(r("order.Requires merchant account operation"));const d=[a.value.chainOrderId];Y(!0);const i=await y(d);Y(!1),i.success&&(z(),j.value=!1,I.value="发货成功",P(!0),sessionStorage.setItem("merchant_offline_refresh_chainOrderId",N.value.toString()),setTimeout(()=>{n.go(-1)},1950))},pe=()=>{u.query.quick==="deliver"&&W()};return Te(async()=>{await G(),pe()}),(d,i)=>(l(),c(re,null,[_(qe,{title:d.$t("order.orderDetail"),class:"font-Puhui font-normal relative app-container main-bg","theme-vars":{"field-placeholder-text-color":"#A6A6A6",navBarBackgroundColor:"transparent"},ref:(x,w)=>{w.EvaluateDetailRef=x}},{default:T(()=>[e("section",ns,[_(Ee,{order:a.value,isBuyer:""},null,8,["order"]),e("div",rs,[_(Oe,{status:o(de),"show-order-status":"",store:{images:a.value.shopPics,name:a.value.shopName},loading:o(O)},null,8,["status","store","loading"]),o(J).GOODS?(l(),$(De,{key:0,class:"mt-3",showNum:"",goods:{goodsName:a.value.relName||"-",goodsIcons:a.value.relIcons,goodsPrice:a.value.relPrice||0,goodsNumber:a.value.relNumber||0}},null,8,["goods"])):o(J).STORE?(l(),$(Le,{key:1,price:a.value.relPrice,loading:o(O)},null,8,["price","loading"])):h("",!0)]),_(Ft,{order:a.value},null,8,["order"]),o(A).isOnlyView?h("",!0):(l(),$(Yt,{key:0,order:a.value,cancelLoading:o(U),deliverLoading:o(ie),onHandleCancel:me,onHandleDeliver:W},null,8,["order","cancelLoading","deliverLoading"]))])]),_:1},8,["title"]),_(os,{show:o(ue),onClose:i[0]||(i[0]=x=>o(M)(!1)),onSelected:fe},null,8,["show"]),_(Ne,{show:o(he),title:d.$t("common.tip"),content:o(ve),showConfirm:!0,showReject:!0,confirmText:d.$t("common.confirm"),noClose:"",onClose:Q,onConfirm:xe,onReject:Q},null,8,["show","title","content","confirmText"]),o(ce)?(l(),$(Fe,{key:0,onClose:i[1]||(i[1]=x=>o(P)(!1)),text:I.value,isError:j.value},null,8,["text","isError"])):h("",!0)],64))}const is=ae({...as,setup:ls}),Cs=ne(is,[["__scopeId","data-v-570a1790"]]);export{Cs as default};
