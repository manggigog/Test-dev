import{F as M,_ as te,I as ne}from"./FilterBox-Czzgo_L6.js";import{y as F,w as Z,x as I,F as $,G as y,H as e,Q as d,P as s,a0 as w,_ as ae,bc as N,bd as W,r as T,E as B,O as c,N as h,I as V,J as G,K as O,R as K,$ as z,Y as se,Z as oe,a1 as le,bj as E,D as ie}from"./vendor-CjApaIpB.js";import{M as Q,e as re}from"./index-lKIcPnY0.js";import{i as de}from"./integral-3wbsAgDF.js";import{B as ce}from"./BackIcon-D2Vm_lyR.js";const ue={class:"gap-3 mt-6 flex-start"},me={class:"flex flex-col justify-between h-10"},pe={class:"font-semibold"},fe={class:"text-xs opacity-60"},ge={class:"flex-1 text-base font-semibold text-right"},ve=F({props:{integral:null},setup(i){const{integral:g}=i,{t:o}=Z(),u=I(()=>({1:o("integral.consume"),2:o("integral.getFund"),3:o("integral.openVip"),4:o("ecology.flashSale"),5:o("integral.gasSubsidy"),10:o("integral.level"),20:o("integral.layer"),30:o("integral.recommend"),100:o("integral.nature")}));return(r,v)=>(y(),$("div",ue,[e("div",me,[e("div",pe,d(s(u)[+i.integral.tradeType]),1),e("div",fe,d(i.integral.time),1)]),e("div",ge,[e("span",null,d(+i.integral.tradeType==1||+i.integral.tradeType==2||+i.integral.tradeType==3||+i.integral.tradeType==4||+i.integral.tradeType==5?"+":"-"),1),w(d(i.integral.amount||0),1)])]))}}),he=i=>(se("data-v-318f494a"),i=i(),oe(),i),ye={class:"p-2.5 box-border max-h-[80vh]"},_e={class:"relative text-center mb-2.5 font-semibold"},xe={class:"mt-5"},Te={class:"text-base font-semibold"},be={class:"gap-2 mt-4 flex-center-bw"},we=he(()=>e("div",{class:"font-semibold"},"-",-1)),$e={class:"mt-5"},De={class:"mb-4 text-base font-semibold"},Ce={class:"flex flex-wrap items-center gap-3"},ke={class:"mt-5"},Se={class:"mb-4 text-base font-semibold"},Ye={class:"flex flex-wrap items-center gap-3"},Be={class:"py-[50px] grid grid-cols-2 gap-10"},Ve=F({props:{show:{type:Boolean},searchParams:null},emits:["close","confirm"],setup(i,{emit:g}){const{show:o,searchParams:u}=i,{t:r}=Z(),[v,_]=N(!1),[x,b]=N(!1),t=W({startTime:u.start,endTime:u.end,tradeTypes:[],gainTypes:0}),C=T(new Date(t.startTime)),k=T(new Date(t.endTime)),D=new Date,L=I(()=>new Date(t.startTime)),P=I(()=>[{id:0,name:r("integral.all")},{id:1,name:r("integral.add")},{id:2,name:r("jia-su")}]),m=I(()=>[{id:1,name:r("integral.consume")},{id:2,name:r("integral.getFund")},{id:3,name:r("integral.openVip")},{id:4,name:r("ecology.flashSale")},{id:100,name:r("integral.nature")},{id:10,name:r("integral.level")},{id:20,name:r("integral.layer")},{id:30,name:r("integral.recommend")},{id:5,name:r("integral.gasSubsidy")}]),f=(l,n)=>l==="year"?`${n+r("common.year")}`:l==="month"?`${n+r("common.month")}`:n,S=l=>{t.startTime=Q(l),_(!1)},p=l=>{t.endTime=Q(l),b(!1)},U=l=>{t.gainTypes=l},X=l=>{t.tradeTypes.find(Y=>Y===l)>=0?t.tradeTypes=t.tradeTypes.filter(Y=>Y!==l):t.tradeTypes.push(l)},ee=()=>{t.startTime=u.initStart||null,t.endTime=u.initEnd||null,t.gainTypes=0,t.tradeTypes=[],q()},q=()=>{g("confirm",t),g("close")},A=()=>{g("close"),t.startTime=u.start,t.endTime=u.end,t.gainTypes=+u.type||0,t.tradeTypes=u.tradeType?u.tradeType.split(","):[]};return(l,n)=>{const Y=B("van-icon"),H=B("VanButton"),j=B("van-popup"),J=B("van-datetime-picker");return y(),$(V,null,[c(j,{show:i.show,"onUpdate:show":n[2]||(n[2]=a=>z(o)?o.value=a:null),position:"bottom",round:"",onClickOverlay:A},{default:h(()=>[e("div",ye,[e("div",_e,[w(d(l.$t("integral.filter"))+" ",1),e("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:A},[c(Y,{name:"cross"})])]),e("div",xe,[e("div",Te,d(l.$t("integral.tradeTime")),1),e("div",be,[c(M,{class:"w-full min-h-[35px] text-center",onClick:n[0]||(n[0]=a=>s(_)(!0))},{default:h(()=>[w(d(s(t).startTime),1)]),_:1}),we,c(M,{class:"w-full min-h-[35px] text-center",onClick:n[1]||(n[1]=a=>s(b)(!0))},{default:h(()=>[w(d(s(t).endTime),1)]),_:1})])]),e("div",$e,[e("div",De,d(l.$t("integral.tradeType")),1),e("div",Ce,[(y(!0),$(V,null,G(s(P),a=>(y(),O(M,{key:a.id,class:K(["box-border",{active:a.id===s(t).gainTypes}]),onClick:R=>U(a.id)},{default:h(()=>[w(d(a.name),1)]),_:2},1032,["class","onClick"]))),128))])]),e("div",ke,[e("div",Se,d(l.$t("integral.tradeType")),1),e("div",Ye,[(y(!0),$(V,null,G(s(m),a=>(y(),O(M,{key:a.id,class:K({active:s(t).tradeTypes.find(R=>+R==+a.id)>=0}),onClick:R=>X(a.id)},{default:h(()=>[w(d(a.name),1)]),_:2},1032,["class","onClick"]))),128))])]),e("div",Be,[c(H,{class:"btn h-[40px] text-primary border border-solid border-primary",round:!0,onClick:ee},{default:h(()=>[w(d(l.$t("common.reset")),1)]),_:1}),c(H,{class:"btn-orange btn-shadow h-[40px] text-white",onClick:q},{default:h(()=>[w(d(l.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"]),c(j,{show:s(v),"onUpdate:show":n[5]||(n[5]=a=>z(v)?v.value=a:null),position:"bottom",round:""},{default:h(()=>[c(J,{type:"date",modelValue:C.value,"onUpdate:modelValue":n[3]||(n[3]=a=>C.value=a),formatter:f,"max-date":s(D),onCancel:n[4]||(n[4]=a=>s(_)(!1)),onConfirm:S},null,8,["modelValue","max-date"])]),_:1},8,["show"]),c(j,{show:s(x),"onUpdate:show":n[8]||(n[8]=a=>z(x)?x.value=a:null),position:"bottom",round:""},{default:h(()=>[c(J,{type:"date",modelValue:k.value,"onUpdate:modelValue":n[6]||(n[6]=a=>k.value=a),formatter:f,"max-date":s(D),"min-date":s(L),onCancel:n[7]||(n[7]=a=>s(b)(!1)),onConfirm:p},null,8,["modelValue","max-date","min-date"])]),_:1},8,["show"])],64)}}}),Me=ae(Ve,[["__scopeId","data-v-318f494a"]]),Ee={class:"bg-white rounded-xl px-5 py-2 mt-5 min-h-[70%]"},Ie={class:"flex justify-end"},Fe={class:"px-3 py-1 flex-center border border-[#BBBBBB] border-solid rounded-2xl"},Le=e("img",{src:te,class:"w-4",alt:""},null,-1),Pe=F({setup(i){const g=le(),o=W({initStart:E(new Date(new Date().setDate(new Date().getDate()-30)),"YYYY-MM-DD"),initEnd:E(new Date,"YYYY-MM-DD"),start:E(new Date(new Date().setDate(new Date().getDate()-30)),"YYYY-MM-DD"),end:E(new Date,"YYYY-MM-DD"),tradeType:null,type:null}),[u,r]=N(!1),v=T([]),_=T(!1),x=T(!1),b=T(0),t=T(10),C=T(0),k=async()=>{_.value=!0,b.value+=1,await L(),_.value=!1},D=T([]),L=async()=>{const m=await de({page:b.value,size:t.value,userAddress:g.query.address||null,...o});if(_.value=!1,!m.success){x.value=!0;return}if(!m.data||!m.total){x.value=!0;return}C.value=m.total,D.value=m.data,v.value=b.value===1?D.value:v.value.concat(D.value),v.value.length>=C.value&&(x.value=!0)},P=m=>{const{startTime:f,endTime:S,tradeTypes:p,gainTypes:U}=m;o.start=f||null,o.end=S||null,o.tradeType=p.length?p.join(","):null,o.type=U||null,b.value=0,x.value=!1,v.value=[],k()};return(m,f)=>{const S=B("VanList");return y(),$(V,null,[e("div",Ee,[e("div",Ie,[e("div",Fe,[Le,e("span",{onClick:f[0]||(f[0]=p=>s(r)(!0))},d(m.$t("integral.filter")),1)])]),c(S,{loading:_.value,"onUpdate:loading":f[1]||(f[1]=p=>_.value=p),finished:x.value,"finished-text":m.$t("common.noMore"),"loading-text":m.$t("common.loading"),onLoad:k},{default:h(()=>[(y(!0),$(V,null,G(v.value,p=>(y(),O(ve,{key:p.amount+p.time,integral:p},null,8,["integral"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),c(Me,{show:s(u),onClose:f[2]||(f[2]=p=>s(r)(!1)),onConfirm:P,searchParams:s(o)},null,8,["show","searchParams"])],64)}}}),Ue={class:"px-2.5"},je={class:"sticky top-0 z-10 bg-gradient-to-b from-primary-008/[1] to-primary-009 rounded-xl pt-2.5"},Re={class:"flex items-center gap-1"},ze={class:"text-base font-semibold"},He=F({setup(i){const{contributesStore:g}=re();return ie(()=>{g.fetchContributes()}),(o,u)=>(y(),$("div",Ue,[e("div",je,[e("header",Re,[c(ce),e("div",ze,d(o.$t("integral.changeDetail")),1)]),c(ne,{contributes:s(g).contributes,loading:s(g).loading},null,8,["contributes","loading"])]),c(Pe)]))}});export{He as default};
