import{W as H}from"./WaterFull-BoFTr9ol.js";import{_ as P,z as A,x as q,q as z,r as c,F as b,G as C,H as g,I as n,P as B,V as O,O as k,U as S,Q as w,a3 as L,aL as R,T as j,X as E,Y as J,D as U,Z as F,$ as T}from"./vendor-Dr_RpJ_Y.js";import{k as $,f as Y,Y as I,N as G,aI as W,aJ as K,w as Q,aH as X,B as Z,aY as ee}from"./index-7OiUoGXy.js";/* empty css                                                                 */const te=""+new URL("../images/delete-Cya47K7m.svg",import.meta.url).href,ae=e=>(E("data-v-472ed2de"),e=e(),J(),e),se={class:"w-full h-full bg-white rounded-[10px]"},oe={class:"p-2 font-Puhui"},le={class:"text-base text-[#222] font-semibold text-left text-ellipsis line-clamp-2"},ie={key:0,class:"mt-1.5 flex justify-between items-center"},ne=["onClick"],ce={class:"text-xs text-[#585654] font-normal leading-[18px] text-ellipsis line-clamp-1"},ue=["onClick"],de=["src"],re={class:"text-xs text-[#999] font-normal leading-[18px]"},me={key:1,class:"mt-1.5 flex justify-between items-center"},fe={class:"max-w-[80%] text-sm text-[#999] font-normal text-ellipsis line-clamp-1"},ve=["onClick"],ge=ae(()=>n("img",{src:te,alt:"",class:"shrink-0 w-4 h-4"},null,-1)),he=[ge],pe=A({props:{item:{default:{}},index:{default:0},position:{default:""},extData:{default:{}}},emits:["delete"],setup(e,{emit:N}){const s=e,{t:y}=q(),l=z(),{loadingToggle:u}=Q(),o=c(!1),h=()=>{var r,f;let a=((r=s.extData)==null?void 0:r.toDetailLink)+"?noteId="+s.item.storeNoteId;((f=s.extData)==null?void 0:f.toDetailLink)==="/city/cityMap/noteDetail"&&(a=a+"&child=1"),l.push(a)},_=()=>{console.log("clickAvatar")},p=async()=>{if(o.value)return;let a=s.item.addLikeCountFlag;s.item.addLikeCountFlag=!s.item.addLikeCountFlag,o.value=!0,a?(s.item.likeCount++,await W({id:s.item.storeNoteId})):(s.item.likeCount--,await K({id:s.item.storeNoteId})),o.value=!1},d=()=>{o.value||R.confirm({messageAlign:"center",message:"确认将这篇笔记删除？",confirmButtonText:y("shop.delete"),confirmButtonColor:"#FF507A",cancelButtonText:y("cart.thinkAgain"),cancelButtonColor:"#2E2008"}).then(async()=>{o.value=!0,u(!0);const a=await X({id:s.item.storeNoteId});o.value=!1,u(!1),a.success&&(D("删除成功","toast-success.svg"),N("delete"))}).catch(()=>{})},D=(a="",r="toast-warn.svg")=>{j({message:a,icon:I(r),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})};return(a,r)=>{const f=b("VanImage");return g(),C("div",{class:"mb-2 text-center",onClick:h},[n("div",se,[B(f,{src:e.item&&e.item.storeNotePics&&e.item.storeNotePics.split(",")[0]||k($)("images/activity/boutique/squre_empty.png"),alt:"",class:"object-cover w-full h-[120px] aspect-square rounded-t-lg overflow-hidden",style:O(e.position==="left"&&e.index%5===0?"height: 172px":""),fit:"cover"},null,8,["src","style"]),n("div",oe,[n("div",le,w(e.item.storeNoteTopic||""),1),e.extData.draft?e.extData.draft?(g(),C("div",me,[n("div",fe,w(k(G)(new Date().getTime(),"MM-DD HH:mm")),1),n("div",{onClick:L(d,["stop"])},he,8,ve)])):S("",!0):(g(),C("div",ie,[n("div",{class:"max-w-[70%] w-fit flex items-center",onClick:L(_,["stop"])},[B(f,{src:k($)("images/avatarRing.png"),class:"mr-1 shrink-0 w-4 h-4 rounded-full overflow-hidden",alt:""},null,8,["src"]),n("div",ce,w(k(Y)(e.item.userAddress||"","...",5,4)),1)],8,ne),n("div",{class:"shrink-0 flex items-center",onClick:L(p,["stop"])},[n("img",{src:e.item.addLikeCountFlag?k(I)("cityMap/like.svg"):k(I)("cityMap/like-full.svg"),alt:"",class:"mr-0.5 shrink-0 w-4 h-4"},null,8,de),n("div",re,w(e.item.likeCount||0),1)],8,ue)]))])])])}}}),xe=P(pe,[["__scopeId","data-v-472ed2de"]]),ke={key:0,class:"w-full"},ye={key:0},_e=A({props:{params:{default:{}},extData:{default:{}},toDetailLink:{default:"/city/noteDetail"}},emits:["handleTo"],setup(e,{expose:N,emit:s}){const y=e,l=c([]),u=c(!1),o=c(!1),h=c(0),_=c(10),p=c(0),d=c([]),D=c(null),a=t=>JSON.parse(JSON.stringify(t)),r=async()=>{u.value=!0,h.value+=1,await f(),setTimeout(()=>{u.value=!1},1e3)},f=async()=>{var m,v,i,x;const t=await ee({page:h.value,size:_.value,...y.params});if(!t.success){o.value=!0;return}if(!t.data||!((m=t.data)!=null&&m.total)||!((v=t.data)!=null&&v.records.length)){o.value=!0;return}p.value=((i=t.data)==null?void 0:i.total)||0,d.value=((x=t.data)==null?void 0:x.records)||[],l.value=h.value===1?a(d.value):l.value.concat(a(d.value)),l.value.length>=p.value&&(o.value=!0)},V=()=>{var t;l.value=[],u.value=!1,o.value=!1,h.value=0,p.value=0,d.value=[],(t=D.value)==null||t.clearData(),r()};U(()=>y.params,()=>{V()},{deep:!0,immediate:!0});const M=(t,m)=>{var i;const v=l.value.findIndex(x=>x.storeNoteId==t.storeNoteId);v>-1&&((i=D.value)==null||i.clearData(),l.value.splice(v,1),d.value=a(l.value))};return N({total:p}),(t,m)=>{const v=b("VanList");return g(),F(v,{loading:u.value,"onUpdate:loading":m[1]||(m[1]=i=>u.value=i),finished:o.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:r},{finished:T(()=>[l.value.length>0?(g(),C("span",ye,w(t.$t("common.no more")),1)):(g(),F(Z,{key:1,name:t.$t("common.No data yet")},null,8,["name"]))]),default:T(()=>[l.value.length>0?(g(),C("div",ke,[B(H,{ref:(i,x)=>{x.waterFull=i,D.value=i},value:d.value,addTime:0,cardComponent:xe,extData:{...e.extData,toDetailLink:e.toDetailLink},onHandleTo:m[0]||(m[0]=i=>s("handleTo")),onDelete:M},null,8,["value","extData"])])):S("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}});export{_e as _};
