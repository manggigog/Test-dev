import{z as Q,q as te,F as W,G as y,H as c,I as r,P as K,Z as S,U as j,Q as V,J as E,a4 as ne,O as N,V as R,$ as Y,K as ee,_ as ae,x as ce,o as le,y as oe,r as u,bu as ie,E as re,bj as ue,a3 as X,bk as de,D as fe}from"./vendor-Dr_RpJ_Y.js";import{C as ve}from"./CommonVanProvider-KZuKVOde.js";import{M as me}from"./Map-Bttu8F4F.js";import{O as pe}from"./OfflineMerchantLabel-Cz248kz6.js";import{a as Z,aF as he,aV as ye,aW as ge,B as xe,aE as Ie}from"./index-BckdT6oc.js";import{u as se}from"./useCityMap-VqEHfq08.js";import{_ as Ce}from"./SearchBar-C8hJeDlC.js";import"./BackIcon-CDrGaEPo.js";import"./iconAssets-DyRcdBzl.js";import"./localMark-D3Prsc6Q.js";import"./search-C4fLtTfY.js";import"./delete-BlDblrKv.js";const _e={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},be={class:"shop-content h-full ml-2 w-full"},Le={class:"w-full text-base text-b1 font-semibold flex items-center justify-between line-clamp-1"},ke={class:"line-clamp-1"},we={class:"text-sm text-b3 font-normal"},$e={class:"h-[20px] text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},Ae={class:"engagement"},Fe={key:0,class:"distance"},Ve=Q({props:{storeInfo:{default:{}},backgroundColor:{default:"#fff"}},setup(n){const f=n,k=te(),{cityMapStore:e}=Z(),{distanceFormat:g}=se(),p=()=>{k.push(`/city/poi/storefront?storeId=${f.storeInfo.storeId}&child=1`)};return(w,m)=>{var h,v,x,q,d,b,A;const $=W("van-image");return c(),y("div",{class:"w-full h-[104px] rounded-xl p-3 mb-3 flex items-center justify-start",style:R({backgroundColor:n.backgroundColor}),onClick:p},[r("div",_e,[K($,{width:"80",height:"80",fit:"cover",src:n.storeInfo.storeIcons?n.storeInfo.storeIcons.split(",")[0]:""},null,8,["src"]),+n.storeInfo.storeGoodsCount>0?(c(),S(pe,{key:0})):j("",!0)]),r("div",be,[r("div",Le,[r("span",ke,V(((h=n.storeInfo)==null?void 0:h.storeName)||""),1)]),r("div",we,V(((v=n.storeInfo)==null?void 0:v.goodsCategoryName3)||"")+" "+V(((x=n.storeInfo)==null?void 0:x.areaExtName3)||""),1),r("div",$e,[r("span",Ae,[+((q=n.storeInfo)==null?void 0:q.wantCount)?(c(),y(E,{key:0},[ne(V(w.$t("city.xx people want",{val:n.storeInfo.wantCount})),1)],64)):j("",!0)]),(d=N(e).locationCoords)!=null&&d.lng&&((b=N(e).locationCoords)!=null&&b.lat)?(c(),y("span",Fe,V(N(g)((A=n.storeInfo)==null?void 0:A.distance,w.$t("city.Distance from you"))),1)):j("",!0)])])],4)}}}),qe={class:"w-full h-full bg-[#F2F0EF] px-3 pt-3 overflow-y-scroll"},Me={props:{storeList:{type:Array,default:()=>[]}},setup(n){return(f,k)=>{const e=W("van-list");return c(),y("div",qe,[K(e,{"finished-text":f.$t("common.no more")},{default:Y(()=>[(c(!0),y(E,null,ee(n.storeList,g=>(c(),S(Ve,{key:g.id,"store-info":g,"background-color":"#fff"},null,8,["store-info"]))),128))]),_:1},8,["finished-text"])])}}},Ne=["onClick"],Se={class:"mt-[-1px] pt-[1px] w-full h-fit max-h-[calc(100vh-50px-48px-32px)] overflow-y-scroll bg-white px-3"},Oe=["onClick"],Pe=Q({props:{modelValue:null},emits:["update:modelValue","change"],setup(n,{expose:f,emit:k}){var B,T,z;const{t:e}=ce(),g=le(),{cityMapStore:p}=Z(),w=oe(()=>[{key:"goodsCategoryId1",label:v.value?m(h.value,v.value):e("city.all category"),isAct:$("goodsCategoryId1",v.value),loading:x.value},{key:"distance",label:A.value?m(b.value,A.value):e("city.all distance"),isAct:$("distance",A.value)},{key:"areaIdLastLeaf",label:M.value?m(O.value,M.value):e("city.all area"),isAct:$("areaIdLastLeaf",M.value),loading:P.value}]),m=(l,I)=>{var F;return(F=l.find(s=>I==s.value))==null?void 0:F.label},$=(l,I)=>!!(a.value&&o.value===l)||I,h=u([]),v=u(((B=g.query)==null?void 0:B.categoryId)||null),x=u(!1),q=l=>{v.value=l},d=async()=>{var s,C;x.value=!0;const l={areaIdPreviousLastLeaf:((s=p.currentActiveCity)==null?void 0:s.areaId)||"3501",overseasFlag:((C=p.currentActiveCity)==null?void 0:C.overseasFlag)||!1},{success:I,data:F}=await he(l);x.value=!1,I&&(h.value=F?F.map(_=>({value:_.goodsCategoryId,label:_.goodsCategoryName,..._})):[],h.value.unshift({value:null,label:e("city.all category")}))},b=u([{value:null,label:e("city.all distance")},{value:500,label:"<500m"},{value:1e3,label:"<1km"},{value:2e3,label:"<2km"},{value:5e3,label:"<5km"}]),A=u(((T=g.query)==null?void 0:T.distance)||null),O=u([]),M=u(((z=g.query)==null?void 0:z.area)||null),P=u(!1),G=async()=>{P.value=!0;const{success:l,data:I}=await ye();if(P.value=!1,!l)return;let s=ge(I,{idKey:"areaId",parentKey:"areaParentId",childrenKey:"children",rootId:"0"}).find(_=>{var D;return((D=p.currentActiveCity)==null?void 0:D.areaParentId)==_.areaId}),C=s==null?void 0:s.children.find(_=>{var D;return((D=p.currentActiveCity)==null?void 0:D.areaId)==_.areaId});O.value=C!=null&&C.children?C==null?void 0:C.children.map(_=>({value:_.areaId,label:_.areaExtName,..._})):[],O.value.unshift({value:null,label:e("city.all area")})},t=u(null),a=u(!1),o=u(""),i=u([]),L=l=>{if(o.value=="goodsCategoryId1")return v.value==l.value;if(o.value=="distance")return A.value==l.value;if(o.value=="areaIdLastLeaf")return M.value==l.value},U=l=>{if(o.value===l&&a.value){a.value=!1;return}o.value=l,a.value=!0,a.value&&(o.value=="goodsCategoryId1"?i.value=h.value:o.value=="distance"?i.value=b.value:o.value=="areaIdLastLeaf"&&(i.value=O.value))};ie(t,()=>a.value=!1);const H=l=>{var I,F;if(o.value=="goodsCategoryId1")v.value=l.value;else if(o.value=="distance")if((I=p.locationCoords)!=null&&I.lat&&((F=p.locationCoords)!=null&&F.lng))A.value=l.value;else{p.clearNoAuthErrorFlag(),p.setNoAuthError(),a.value=!1;return}else o.value=="areaIdLastLeaf"&&(M.value=l.value);a.value=!1,J(),k("change",o.value,l.value)},J=()=>{const l={goodsCategoryId1:v.value,distance:A.value,areaIdLastLeaf:M.value};k("update:modelValue",l)};return re(()=>{d(),G()}),f({setCategory1Act:q}),(l,I)=>{const F=W("van-loading");return c(),y("div",{class:"relative flex items-center gap-[3px]",ref:(s,C)=>{C.selectBox=s,t.value=s}},[(c(!0),y(E,null,ee(N(w),(s,C)=>(c(),y("div",{class:"shrink-0 flex justify-center items-center",style:R(`width: calc(100% / ${N(w).length});`),onClick:X(_=>s.loading?"":U(s.key),["stop"]),key:s.key},[s.loading?(c(),S(F,{key:0,size:"20px"})):(c(),y(E,{key:1},[r("div",{class:"text-sm text-[#585654] font-normal",style:R(s.isAct?"color: #ff8812":"")},V(s.label),5),r("div",{class:"trapezoid shrink-0 ml-1.5",style:R(s.isAct?"border-top: 4px solid #ff8812":"")},null,4)],64))],12,Ne))),128)),ue(r("div",{class:"absolute top-[32px] z-[49] w-full h-[calc(100vh-50px-48px-32px)] bg-[rgba(0,0,0,0.5)]",onClick:I[0]||(I[0]=X(s=>a.value=!1,["stop"]))},[r("div",Se,[(c(!0),y(E,null,ee(i.value,(s,C)=>(c(),y("div",{class:"mb-3 w-full text-sm text-[#585654]",style:R(L(s)?"color:#FF8812;font-weight:600":""),key:s.value,onClick:X(_=>H(s),["stop"])},V(s.label),13,Oe))),128))])],512),[[de,a.value]])],512)}}}),je=ae(Pe,[["__scopeId","data-v-fad2a98a"]]),Ee={class:"w-full flex gap-2"},Be={class:"shrink-0 w-[80px] h-[80px] rounded-lg overflow-hidden"},Te=["src"],ze={class:"w-full flex flex-col justify-between"},De={class:"shrink-0"},Re={class:"text-base text-b1 font-semibold line-clamp-1"},Ke={class:"mt-1 text-b3 text-sm font-normal line-clamp-1"},Ge={key:0,class:"w-full text-right text-b3 text-sm font-normal line-clamp-1"},Ue=Q({props:{storeInfo:null},setup(n){const f=n,k=te(),{distanceFormat:e}=se(),{cityMapStore:g}=Z(),p=oe(()=>{var m,$;return(m=f.storeInfo)!=null&&m.storeIcons?($=f.storeInfo)==null?void 0:$.storeIcons.split(","):[]}),w=()=>{k.push(`/city/poi/storefront?storeId=${f.storeInfo.storeId}&child=1`)};return(m,$)=>{var h,v,x,q,d,b;return c(),y("div",{class:"w-full h-fit bg-white rounded-xl p-3 shadow-[0_0.5px_16px_0_rgba(0,0,0,0.16)]",onClick:w},[r("div",Ee,[r("div",Be,[r("img",{src:N(p)[0],alt:"shop",class:"w-full h-full object-cover"},null,8,Te)]),r("div",ze,[r("div",De,[r("div",Re,V(((h=n.storeInfo)==null?void 0:h.storeName)||""),1),r("div",Ke,V(((v=n.storeInfo)==null?void 0:v.storeAddress)||""),1)]),(x=n.storeInfo)!=null&&x.distance&&((q=N(g).locationCoords)!=null&&q.lat)&&((d=N(g).locationCoords)!=null&&d.lng)?(c(),y("div",Ge,V(N(e)((b=n.storeInfo)==null?void 0:b.distance,m.$t("city.Distance from you"))),1)):j("",!0)])])])}}}),He=ae(Ue,[["__scopeId","data-v-45fef4c4"]]),Je={class:"h-[calc(100vh-50px)] w-full overflow-hidden"},Qe={class:"px-3 pb-3"},We={class:"pb-3"},Ze={class:"h-[calc(100%-48px-32px)] bg-[#F2F0EF]"},Xe=Q({setup(n){var M,P,G;const f=le(),k=te(),{cityMapStore:e}=Z(),{getUserLocation:g}=se(),p=u(null),w=u(!1),m=u(f.query.mode||"list"),$=()=>{m.value=m.value==="map"?"list":"map",k.replace({query:{...f.query,mode:m.value}})},h=u({keyword:""}),v=()=>{b()},x=u({goodsCategoryId1:((M=f.query)==null?void 0:M.categoryId)||null,distance:((P=f.query)==null?void 0:P.distance)||null,areaIdLastLeaf:((G=f.query)==null?void 0:G.area)||null}),q=(t,a)=>{let o={...f.query};t==="goodsCategoryId1"&&(o.categoryId=a),t==="distance"&&(o.distance=a),t==="areaIdLastLeaf"&&(o.area=a),o=Object.fromEntries(Object.entries(o).filter(([i,L])=>L)),k.replace({query:o}),b()},d=u([]),b=()=>{var o,i,L,U,H,J,B;w.value=!0;let t=[];(e.locationCoords.lat&&e.locationCoords.lng||(o=e.currentActiveCity)!=null&&o.areaLatitude&&((i=e.currentActiveCity)!=null&&i.areaLongitude))&&t.push("asc|distance");let a=t.length?t.join(","):null;Ie({size:9999,storeNameLike:((L=h.value)==null?void 0:L.keyword)||null,areaIdPreviousLastLeaf:((U=e.currentActiveCity)==null?void 0:U.areaId)||"3501",overseasFlag:((H=e.currentActiveCity)==null?void 0:H.overseasFlag)||!1,longitude:e.locationCoords.lng||((J=e.currentActiveCity)==null?void 0:J.areaLongitude)||null,latitude:e.locationCoords.lat||((B=e.currentActiveCity)==null?void 0:B.areaLatitude)||null,sortBy:a,...x.value}).then(T=>{d.value=[],setTimeout(()=>{var z;d.value=((z=T.data)==null?void 0:z.records)||[]},50)}).catch(T=>{d.value=[]}).finally(()=>{w.value=!1})},A=t=>{k.push(t)},O=oe(()=>{var t,a,o;return{longitude:e.locationCoords.lng||((t=e.currentActiveCity)==null?void 0:t.areaLongitude)||null,latitude:e.locationCoords.lat||((a=e.currentActiveCity)==null?void 0:a.areaLatitude)||null,areaIdPreviousLastLeaf:((o=e.currentActiveCity)==null?void 0:o.areaId)||""}});return fe(()=>O.value,(t,a)=>{t!=null&&t.areaIdPreviousLastLeaf&&b()},{immediate:!0,deep:!0}),re(async()=>{var t,a;e.currentActiveCity?(t=e.locationCoords)!=null&&t.lat&&((a=e.locationCoords)!=null&&a.lng)||e.setNoAuthError():await g()}),(t,a)=>{const o=W("router-view");return c(),S(ve,{title:t.$t("city.City Map"),class:"bg-white font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(i,L)=>{L.searchRef=i}},{right:Y(()=>[r("div",{class:"text-sm font-normal text-b2",onClick:$},V(m.value==="map"?t.$t("city.List mode"):t.$t("city.Map mode")),1)]),default:Y(()=>[r("div",Je,[r("div",Qe,[K(Ce,{modelValue:h.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=i=>h.value.keyword=i),placeholder:t.$t("city.Please enter the store name"),"search-button-text":t.$t("common.search"),onSearch:v,onClear:v},null,8,["modelValue","placeholder","search-button-text"])]),r("div",We,[K(je,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=i=>x.value=i),onChange:q,ref:(i,L)=>{L.storeFilterRef=i,p.value=i}},null,8,["modelValue"])]),r("section",Ze,[d.value&&d.value.length===0&&!w.value?(c(),S(xe,{key:0,class:"!bg-transparent",name:t.$t("common.No stores yet")},null,8,["name"])):j("",!0),m.value==="map"?(c(),y(E,{key:1},[d.value&&d.value.length>0?(c(),S(me,{key:0,storeList:d.value,storeComponent:He,ref:(i,L)=>{L.mapRef=i},onHandleTo:A},null,8,["storeList"])):j("",!0)],64)):(c(),S(Me,{key:2,storeList:d.value},null,8,["storeList"]))])]),K(o,{class:"child-view"})]),_:1},8,["title"])}}}),dt=ae(Xe,[["__scopeId","data-v-6412f6e4"]]);export{dt as default};
