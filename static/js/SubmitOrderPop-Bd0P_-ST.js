import{_ as I,y as E,r as l,D as R,E as T,F as V,G as i,H as d,O as N,a0 as u,Q as r,N as S,Y as K,Z as Q,be as z,x,B as A,K as _,P as c,a2 as D}from"./vendor-BUT0HZ5j.js";import{l as O}from"./luckyShopContract-C1ZxeFcQ.js";import{O as J}from"./OrderGoodsBox-Bl5qzppE.js";import{_ as L}from"./OrderPopBorder-Bkze0cHV.js";import{f as U,d as W,q as X}from"./index-DDhEkd_5.js";import{_ as ee}from"./ApproveButton-DqI4LibG.js";const te="/Test-dev/static/images/success-DvZwai7Y.png",se=o=>(K("data-v-3c4bb187"),o=o(),Q(),o),oe={class:"pt-6 pb-10"},ae={class:"text-base text-[#2E2008]"},ne={class:"mr-1 font-semibold"},ce=se(()=>d("img",{src:te,class:"w-[178px] h-[144px] object-cover my-10 mx-auto"},null,-1)),le=E({props:{id:null},emits:["close"],setup(o,{emit:m}){const{id:t}=o,{commodities:h}=O(),p=l(0),g=async()=>{const a=await h(t);p.value=a.endTime*1e3-new Date().getTime()};return R(()=>{g()}),(a,n)=>{const f=T("van-count-down"),v=T("VanButton");return i(),V("div",oe,[d("div",ae,[d("span",ne,[N(f,{millisecond:"",time:p.value,format:"HH:mm:ss:SS"},null,8,["time"])]),u(r(a.$t("order.no group tips")),1)]),ce,N(v,{class:"btn-detail w-[200px] h-[40px] rounded-3xl text-[#FB1A18] font-semibold",onClick:n[0]||(n[0]=()=>{m("close")})},{default:S(()=>[u(r(a.$t("common.return")),1)]),_:1})])}}}),ie=I(le,[["__scopeId","data-v-3c4bb187"]]),re={key:0},ue={class:"pt-4 text-left"},de={class:"text-[#FB1A18] text-lg"},me=E({props:{show:{type:Boolean,default:!1},goods:null,remaining:null,limitEach:null},emits:["close","success"],setup(o,{emit:m}){const t=o,{payToken:h,buy:p,commodities:g}=O(),{tradeContributeSelfRate:a}=U(),n=l(!1),[f,v]=z(!1),b=l(null),s=l(1),k=l(0),B=x(()=>{var e;return+A((e=t.goods)==null?void 0:e.price).times(s.value)}),M=x(()=>W(C.value/100*B.value*k.value)),w=x(()=>Math.min(+t.remaining,+t.limitEach)),F=e=>{if(e<1)s.value=1;else{if(+w.value<+e){s.value=+w.value;return}s.value=+e}},C=l(null),H=async()=>{var y;const e=await g((y=t.goods)==null?void 0:y.id);C.value=+A(+e.discountRate).div(1e4).toNumber()||20},P=async()=>{k.value=await a()},$=()=>{v(!1),s.value=1,m("close")},G=async()=>{P(),H(),await q(),await Y()},Y=async()=>{},Z=async()=>{n.value=!0;const e=await p(t.goods.id,s.value);n.value=!1,e.success&&j()},j=()=>{m("success",s.value),v(!0)},q=async()=>{b.value=await h()};return R(()=>{G()}),(e,y)=>(i(),_(L,{show:t.show,onClose:$,title:c(f)?e.$t("order.purchase success"):e.$t("order.submitOrder")},{default:S(()=>[c(f)?(i(),_(ie,{key:1,id:t.goods.id,onClose:$},null,8,["id"])):(i(),V("div",re,[t.goods?(i(),_(J,{key:0,isDisabledEdit:!0,orderInfo:t.goods,number:s.value,"max-number":+c(w),onChangeNumber:F,needMask:!1},null,8,["orderInfo","number","max-number"])):D("",!0),d("div",ue,[u(r(e.$t("order.group intergral")),1),d("span",de,r(c(M)),1),u(" "+r(e.$t("common.credit")),1)]),b.value?(i(),_(ee,{key:1,contract:c(X).luckyShop,token:b.value,approveAmount:c(B),loading:n.value,fallBack:Z,class:"text-sm my-8 h-[40px] min-w-[150px] rounded-3xl text-white btn-pink"},{default:S(()=>[u(r(e.$t("flashSale.buyNow")),1)]),_:1},8,["contract","token","approveAmount","loading"])):D("",!0)]))]),_:1},8,["show","title"]))}}),be=I(me,[["__scopeId","data-v-35283b72"]]);export{be as S};
