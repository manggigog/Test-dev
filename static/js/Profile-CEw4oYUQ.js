import{_ as H,y as L,w as Z,x as G,F as b,G as _,H as s,I as z,J as ce,X as pe,P as o,a2 as B,Q as g,a1 as me,r as S,O as x,bc as M,D as J,E as A,K as U,N as R,a0 as E,$ as Te,T as j,Y as ve,Z as he,l as Re,z as Fe,bd as Oe,bf as Ee,R as de}from"./vendor-CjApaIpB.js";import{U as h,M as ke,a as Me,b as Ae}from"./Merchant-P-W-UEwx.js";import{V as I,e as V,r as Be,S as W,Q as Le,b as ge,_ as xe,m as Pe}from"./index-B3VH42pz.js";import{P as T}from"./profileEnum-CXsMKuND.js";import{q as De,o as Ue}from"./order-Ch3HoLCn.js";import{g as He}from"./notice-Bp6llI5x.js";import{_ as Ve}from"./close-DLkDHnDK.js";import{L as qe,I as ze}from"./LevelPop-6vMiUUkg.js";import{s as je,i as Ge,b as Je,c as fe,d as Qe,u as Xe,e as Ke}from"./user-DYGd6ROD.js";import{_ as Ye}from"./RecommendationFeed-CxFvyEuG.js";import{A as Ze}from"./AddParentIdPop-BqAVnZJX.js";import"./level-BMr8jGFx.js";import"./offlineGoods-Biq4pIIG.js";import"./UpgradeStorePop-CNXGfJJx.js";import"./BoutiqueLable-BYJxmIGq.js";import"./shop-CeqcS6K2.js";import"./PopHeader-RH2zyPSz.js";import"./TokenBalance-z2oXzaSp.js";import"./level-DAN5anGA.js";import"./GoodsList-Dvv932jn.js";import"./buy-cart-3M2I0Qjc.js";import"./goods-BVwS8oFG.js";import"./ShopMaskTips-DfjY93ZI.js";import"./GoodsPrice-6cXbNaVi.js";import"./MCOIN-BcbOHmhy.js";import"./mall-CSm_yT_y.js";import"./cart-BIjmsZJP.js";import"./useShowActiveInfo-Bo8u93rX.js";import"./festivalActivities-cygKzd0Y.js";import"./nft-CbUU_aqn.js";const We={class:"w-full h-fit py-[16px] px-[12px] bg-white rounded-[12px] flex flex-wrap font-Puhui"},et=["onClick"],tt={class:"relative"},ot=["src"],nt={key:0,class:"absolute top-[-5px] right-[1px] translate-x-1/2 min-w-[6px] w-fit h-[14px] px-1 bg-[#F44] rounded-[12px] text-white text-[10px] leading-[14px] font-normal text-center border-[1px] border-solid border-white box-content"},st={class:"mt-[4px] text-[14px] text-[#2E2008] font-normal font-Puhui leading-[20px] text-center"},at={class:"mt-[16px] w-full h-fit py-[16px] px-[12px] bg-white rounded-[12px] flex flex-wrap font-Puhui"},rt=["onClick"],lt={class:"relative"},it=["src"],ut={class:"mt-[4px] text-[14px] text-[#2E2008] font-normal font-Puhui leading-[20px] text-center"},ct=L({props:{unreadCount:null},emits:["handleMenu"],setup(l,{emit:f}){const{t:n}=Z(),w=m=>m===0?0:m>99?"99+":m,v=G(()=>[{text:n("user.payRecord"),img:I("profile2/consumerOption/PaymentHistory.svg"),type:h.INTERNL,url:"/buyerBill"},{text:n("user.pointsDetails"),img:I("profile2/consumerOption/PointsChangeDetails.svg"),type:h.INTERNL,url:"/integralDetail"},{text:n("user.balanceDetails"),img:I("profile2/consumerOption/BalanceChangeDetails.svg"),type:h.INTERNL,url:" /balanceDetail"},{text:n("profile.collect"),img:I("profile2/consumerOption/GoodsCollect.svg"),type:h.INTERNL,url:"/goodsCollect"},{text:n("profile.follow"),img:I("profile2/consumerOption/ShopAttention.svg"),type:h.INTERNL,url:"/shopsCollect"},{text:n("order.receive address"),img:I("profile2/consumerOption/DeliveryAddress.svg"),type:h.INTERNL,url:"/userAddress"},{text:n("voucher.voucher"),img:I("profile2/consumerOption/Vouchers.svg"),type:h.INTERNL,url:"/voucher"},{text:n("profile.public notice"),img:I("profile2/consumerOption/volume-down-line.svg"),type:h.INTERNL,url:"/postList"},{text:n("flashSale.flashSaleOrder"),img:I("profile2/consumerOption/LightningPurchaseOrders.svg"),type:h.INTERNL,url:"/buyerFlashSaleOrder?type=2"},{text:n("user.comminicate"),img:I("profile2/consumerOption/CommunityExchangeSection.svg"),type:h.OPTIONS,key:"concat"}]),y=G(()=>[{text:n("user.Improve Maker Level"),img:I("profile2/consumerOption/ImproveMakerLevel.svg"),type:h.OPTIONS,key:"level"},{text:n("ecology.otc"),img:I("profile2/consumerOption/OTC-Transactions.svg"),type:h.INTERNL,url:"/ecology-otcTransaction"},{text:n("common.inviteFriend"),img:I("profile2/consumerOption/InviteFriends.svg"),type:h.OPTIONS,key:"invite"},{text:n("common.myNft"),img:I("profile2/consumerOption/MyNFT.svg"),type:h.OPTIONS,key:"nft"},{text:n("ranking.Ecological help list"),img:I("profile2/consumerOption/ranking.svg"),type:h.INTERNL,url:"/talentRankingV1?type=2&cycleType=2"}]);return(m,$)=>(_(),b(z,null,[s("div",We,[(_(!0),b(z,null,ce(o(v),(t,r)=>(_(),b("div",{class:"w-[25%] flex flex-col items-center",style:pe(r<Math.floor((o(v).length-1)/4)*4?"margin-bottom: 16px":""),key:r,onClick:()=>f("handleMenu",t)},[s("div",tt,[s("img",{class:"shrink-0 w-[24px] h-[24px]",src:t.img,alt:""},null,8,ot),t.url==="/postList"&&+l.unreadCount.totalUnread>0?(_(),b("div",nt,g(w(l.unreadCount.totalUnread)),1)):B("",!0)]),s("div",st,g(t.text),1)],12,et))),128))]),s("div",at,[(_(!0),b(z,null,ce(o(y),(t,r)=>(_(),b("div",{class:"w-[25%] flex flex-col items-center",style:pe(r<Math.floor((o(y).length-1)/4)*4?"margin-bottom: 16px":""),key:r,onClick:()=>f("handleMenu",t)},[s("div",lt,[s("img",{class:"shrink-0 w-[24px] h-[24px]",src:t.img,alt:""},null,8,it)]),s("div",ut,g(t.text),1)],12,rt))),128))])],64))}}),pt=H(ct,[["__scopeId","data-v-165b60f9"]]),dt=L({emits:["handleTo","handleReplace","handleMenu"],setup(l,{expose:f,emit:n}){const w=me(),{accountStore:v}=V(),y=S({versionUnread:0,platformUnread:0,totalUnread:0}),m=async()=>{const a=await He();a.success&&(y.value=a.data)},$=S({afterSales:0,completed:0,toBeDelivered:0,waitingForReceipt:0}),t=async()=>{const a=await De({type:2});a.success&&($.value=a.data)},r=S({afterSales:0,completed:0,toBeDelivered:0,waitingForReceipt:0}),i=async()=>{var d;const a=await Ue({orderCustomerAddress:v.account||((d=v.sign)==null?void 0:d.address)});a.success&&(r.value=a.data)},p=a=>{a==="online"?t():a==="offline"&&i()};return f({init:async()=>{var d;console.log("consumer init");const a=((d=w.query)==null?void 0:d.tab)||"online";p(a),m()}}),(a,d)=>(_(),b(z,null,[x(ke,{activeTab:o(T).CONSUMER,orderCount:$.value,offlineOrderCount:r.value,onHandleTo:d[0]||(d[0]=N=>n("handleTo",N)),onHandleReplace:d[1]||(d[1]=(N,P)=>n("handleReplace",N,P)),onUpdateOrderData:p},null,8,["activeTab","orderCount","offlineOrderCount"]),x(pt,{unreadCount:y.value,onHandleMenu:d[2]||(d[2]=N=>n("handleMenu",N))},null,8,["unreadCount"])],64))}}),ft=l=>(ve("data-v-2c4ddcca"),l=l(),he(),l),mt={class:"w-[85vw] max-w-[375px] px-5 py-6 bg-popBg"},vt={class:"pb-5 flex-center-bw"},ht={class:"flex-start"},gt=ft(()=>s("img",{src:Ve,class:"w-[10px] h-[10px]",alt:""},null,-1)),xt=[gt],yt=E("%"),_t={class:"mt-5 flex-center"},wt=L({props:{show:{type:Boolean}},emits:["close"],setup(l,{emit:f}){const{show:n}=l,{t:w}=Z(),{accountStore:v}=V(),{loadingToggle:y}=Be(),[m,$]=M(!1),t=S(0),r=async()=>{y(!0);const u=await W(v.account);u.success&&u.data&&(t.value=u.data.discountRatio),y(!1)},i=u=>u>80?80:u,p=async()=>{if(!Number(t.value)){j.fail(w("common.pleaseInput"));return}$(!0),(await Le({discountRatio:t.value})).success&&($(!1),f("close"),setTimeout(()=>{r()},1e3))};return J(()=>{r()}),(u,a)=>{const d=A("van-field"),N=A("VanButton"),P=A("VanPopup");return _(),U(P,{show:l.show,"onUpdate:show":a[2]||(a[2]=D=>Te(n)?n.value=D:null),round:""},{default:R(()=>[s("div",mt,[s("div",vt,[s("div",ht,[s("span",null,g(u.$t("common.ratiodEdit")),1)]),s("div",{onClick:a[0]||(a[0]=D=>f("close"))},xt)]),s("div",null,[x(d,{class:"bg-gray1 rounded-3xl","input-align":"center",modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=D=>t.value=D),type:"digit",placeholder:u.$t("shop.pleaseInputPoint"),formatter:i,disabled:o(m)},{"right-icon":R(()=>[yt]),_:1},8,["modelValue","placeholder","disabled"]),s("div",_t,[x(N,{class:"px-20 font-bold text-white h-9 btn-orange",onClick:p,loading:o(m)},{default:R(()=>[E(g(u.$t("common.edit")),1)]),_:1},8,["loading"])])])])]),_:1},8,["show"])}}}),Ct=H(wt,[["__scopeId","data-v-2c4ddcca"]]),It=l=>(ve("data-v-720e2866"),l=l(),he(),l),St={class:"flex flex-col items-center justify-center"},$t={class:"text-sm"},bt={class:"text-primary"},Nt=E(" 嘗試遷移店舖信息至您的地址 "),Tt={class:"text-primary"},Rt=E(" 是否同意遷移。 "),Ft={key:0,class:"border border-primary rounded-lg p-2.5 mt-4 bg-[#FFFAF4] flex items-start"},Ot=It(()=>s("div",{class:"text-xs opacity-70 ml-1.5 leading-5"}," 監測到當前地址下有店舖信息，同意遷移將合併新舊店舖信息 ",-1)),Et={class:"flex items-center justify-center w-full gap-3 mt-4"},kt={key:1,class:"mt-3 text-xs font-normal"},Mt=L({props:{show:{type:Boolean},info:null},emits:["close"],setup(l,{emit:f}){const n=l,{accountStore:w}=V(),v=n.info[0].shop,y=S(null),m=async()=>{var u;const{data:i,success:p}=await Ge((v==null?void 0:v.id)||((u=n.info[0])==null?void 0:u.id));p&&(y.value=i)},$=S(-1),t=async i=>{var u;if(await m(),y.value&&i!==3){j("已經遷移過，請勿重複操作");return}(await je({id:(u=n.info[0])==null?void 0:u.id,status:i})).success&&(i===3?j("拒绝成功"):j("同意成功"),i===3?f("close",i):f("close"))},r=async()=>{var p;const i=await W(((p=w.store)==null?void 0:p.merchant)||w.account);i.success&&i.data&&($.value=i.data.status)};return J(()=>{r()}),(i,p)=>{const u=A("van-icon"),a=A("VanButton");return _(),U(xe,{show:l.show,noBorder:!0,noClose:!0,onClose:p[2]||(p[2]=()=>{f("close")})},{default:R(()=>{var d;return[s("div",St,[s("div",$t,[s("span",bt,g((d=o(v))==null?void 0:d.storeName),1),Nt,s("span",Tt,g(o(ge)(o(w).account)),1),Rt]),$.value===1?(_(),b("div",Ft,[x(u,{name:"warning",color:"#FEA021",size:"18"}),Ot])):B("",!0),s("div",Et,[x(a,{round:"",class:"border border-solid border-[#CDCDCD] h-[40px] w-full flex-1 font-medium text-sm",onClick:p[0]||(p[0]=N=>t(3))},{default:R(()=>[s("span",null,g(i.$t("common.reject")),1)]),_:1}),x(a,{round:"",class:"btn-yellow h-[40px] w-full flex-1 font-semibold text-sm",onClick:p[1]||(p[1]=N=>t(2))},{default:R(()=>[E(g(i.$t("common.agree")),1)]),_:1})]),l.info.length>0?(_(),b("div",kt,g(i.$t("user.migrate length",{num:l.info.length})),1)):B("",!0)])]}),_:1},8,["show"])}}}),At=H(Mt,[["__scopeId","data-v-720e2866"]]),Bt={class:"flex flex-col items-center justify-center"},Lt={class:"text-sm"},Pt={class:"text-primary"},Dt={class:"text-primary"},Ut={key:0,class:"border border-primary rounded-lg p-2.5 mt-4 bg-[#FFFAF4] flex items-start"},Ht={class:"text-xs opacity-70 ml-1.5 leading-5"},Vt={class:"w-full flex items-center justify-center gap-3 mt-4"},qt={key:1,class:"text-xs font-normal mt-3"},zt=L({props:{show:{type:Boolean},approveInfo:null,approveIndex:null},emits:["close"],setup(l,{emit:f}){const n=l,{accountStore:w}=V(),v=n.approveInfo[n.approveIndex].shop,y=S(-1),m=async t=>{(await Je({id:n.approveInfo[n.approveIndex].id,status:t})).success&&(t===3?f("close",t):f("close"))},$=async()=>{var r;const t=await W(((r=w.store)==null?void 0:r.merchant)||w.account);t.success&&t.data&&(y.value=t.data.status)};return J(()=>{$()}),(t,r)=>{const i=A("van-icon"),p=A("VanButton");return _(),U(xe,{show:l.show,noBorder:!0,noClose:!0,onClose:r[2]||(r[2]=()=>{f("close")})},{default:R(()=>[s("div",Bt,[s("div",Lt,[s("span",Pt,g(o(v).storeName),1),E(" "+g(t.$t("user.use tips"))+" ",1),s("span",Dt,g(o(ge)(o(w).account)),1),E(" "+g(t.$t("user.approveShop")),1)]),y.value===1?(_(),b("div",Ut,[x(i,{name:"warning",color:"#FEA021",size:"18"}),s("div",Ht,g(t.$t("user.approve shop tips2")),1)])):B("",!0),s("div",Vt,[x(p,{round:"",class:"border border-solid border-[#CDCDCD] h-[40px] w-full flex-1 font-medium text-sm",onClick:r[0]||(r[0]=u=>m(3))},{default:R(()=>[s("span",null,g(t.$t("common.reject")),1)]),_:1}),x(p,{round:"",class:"btn-yellow h-[40px] w-full flex-1 font-semibold text-sm",onClick:r[1]||(r[1]=u=>m(2))},{default:R(()=>[E(g(t.$t("common.agree")),1)]),_:1})]),l.approveInfo.length>0?(_(),b("div",qt,g(t.$t("user.approve length",{num:l.approveInfo.length})),1)):B("",!0)])]),_:1},8,["show"])}}}),jt=H(zt,[["__scopeId","data-v-57d700dc"]]),Gt={class:"linear-bg"},Jt={class:"mt-[16px] w-full z-[10] overflow-hidden px-[12px]"},Qt={class:"flex items-start gap-[24px]"},Xt=L({name:"Profile"});function Kt(l){const{t:f}=Z(),n=Re(),w=me(),{accountStore:v}=V(),[y,m]=M(!1),[$,t]=M(!1),[r,i]=M(!1),[p,u]=M(!1),[a,d]=M(!1),[N,P]=M(!1),{isUserExists:D}=Pe();Fe(()=>w.path,(e,c)=>{c==="/clerk/index"&&e==="/profile"&&K()});const Q=S(null),q=S(null),ee=S(0),ye=()=>{t(!1),i(!0)},X=Oe({userInfo:{address:v.account}}),_e=G(()=>[{id:T.CONSUMER,name:f("common.consumerSide")},{id:T.MERCHANT,name:f("common.merchantSide")}]),F=G(()=>{var e;return((e=w.query)==null?void 0:e.path)??T.CONSUMER}),te=S(!1),we=e=>{e.id!==F.value&&(e.id===T.MERCHANT&&fe(),localStorage.setItem("profile_query",JSON.stringify({path:e.id})),n.push(`/profile?path=${e.id}`),te.value=!0,setTimeout(()=>{te.value=!1,ue()},500))},k=e=>{n.push(e)},oe=(e,c)=>{localStorage.setItem("profile_query",JSON.stringify(c)),n.replace({path:e,query:c})},Ce=()=>{m(!1),ne()},Ie=()=>{d(!1),K()},ne=async()=>{var c,C;const e=await Qe({type:2,page:1,size:99});Q.value=(c=e.data)==null?void 0:c.filter(O=>O.status===1).reverse(),((C=Q.value)==null?void 0:C.length)>0&&(m(!0),ee.value=0)},Se=async()=>{var c,C,O;const e=await Ke({type:2,page:1,size:99});if(((c=e.data)==null?void 0:c.findIndex(Y=>Y.status===2))>-1){q.value=[];return}q.value=(C=e.data)==null?void 0:C.filter(Y=>Y.status===1).reverse(),((O=q.value)==null?void 0:O.length)>0&&d(!0)},se=async e=>{if(e.type===h.INTERNL&&e.url)return k(e.url);if(e.type===h.OPTIONS){if(e.key==="invite"&&i(!0),e.key==="level"&&t(!0),e.key==="ratio"&&u(!0),e.key==="concat"&&k("/concat"),e.key==="nft"){if(ae.value)return k("/matrixNFT");P(!0)}}else e.type===h.EXTERNAL&&e.url&&window.open(e.url,"_blank")},$e=async()=>{const e=await Xe(v.account);!e.success||!e.data||(X.userInfo=e.data)},ae=S(!1),re=async()=>{const e=await D();ae.value=e},be=()=>{re(),k("/matrixNFT")},Ne=S(!1),le=S(null),ie=S(null),ue=async()=>{var e,c;F.value===T.CONSUMER?(e=le.value)==null||e.init():(c=ie.value)==null||c.init()},K=async()=>{await v.changeStore({}),Ne.value=!0,await $e(),ne(),Se(),re(),F.value===T.MERCHANT&&fe()};return J(async()=>{}),Ee(()=>{console.log("onActivated"),K(),ue()}),(e,c)=>(_(),b("div",Gt,[x(Me,{info:o(X).userInfo,active:o(F),"tab-list":o(_e),onChangeTab:we,onSetLevelShow:c[0]||(c[0]=C=>o(t)(!0))},null,8,["info","active","tab-list"]),s("div",Jt,[s("div",Qt,[s("div",{class:de(["shrink-0 w-full transition delay-0 duration-500 ease-in-out",{"consumer-in-merchant-out":o(F)===o(T).CONSUMER,"consumer-out-merchant-in":o(F)===o(T).MERCHANT}])},[x(dt,{ref:(C,O)=>{O.ConsumerRef=C,le.value=C},onHandleTo:k,onHandleMenu:se,onHandleReplace:oe},null,512)],2),s("div",{class:de(["shrink-0 w-full transition delay-0 duration-500 ease-in-out",{"consumer-out-merchant-in":o(F)===o(T).MERCHANT,"consumer-in-merchant-out":o(F)===o(T).CONSUMER}])},[x(Ae,{ref:(C,O)=>{O.MerchantRef=C,ie.value=C},onHandleTo:k,onHandleMenu:se,onHandleReplace:oe},null,512)],2)]),x(qe,{show:o($),userInfo:o(X).userInfo,onClose:c[1]||(c[1]=C=>o(t)(!1)),onInvite:ye,onHandleTo:k},null,8,["show","userInfo"]),x(ze,{show:o(r),onClose:c[2]||(c[2]=C=>o(i)(!1))},null,8,["show"]),x(Ct,{show:o(p),onClose:c[3]||(c[3]=C=>o(u)(!1))},null,8,["show"]),o(y)?(_(),U(jt,{key:0,show:o(y),approveInfo:Q.value,approveIndex:ee.value,onClose:Ce},null,8,["show","approveInfo","approveIndex"])):B("",!0),o(a)?(_(),U(At,{key:1,show:o(a),info:q.value,onClose:Ie},null,8,["show","info"])):B("",!0),x(Ye,{"title-text":o(f)("common.recommend_for_you")},null,8,["title-text"]),x(Ze,{show:o(N),onClose:c[4]||(c[4]=C=>o(P)(!1)),onOnSuccess:be},null,8,["show"])])]))}const Yt=L({...Xt,setup:Kt}),Ro=H(Yt,[["__scopeId","data-v-05054e29"]]);export{Ro as default};
