import{_ as le,y as de,w as ue,bw as g,r as m,x as O,D as ce,F as me,a2 as q,P as i,G,H as s,O as u,K as pe,Q as l,a0 as b,E as y,N as $,$ as fe,T as C,l as ve,Y as he,Z as ge,a1 as be,B as ye}from"./vendor-BUT0HZ5j.js";import{_ as we}from"./AddressInfo-CgO24TCv.js";import{_ as _e}from"./EmptyTipsPop-_FH8A6A8.js";import{O as xe}from"./OrderGoodsBox-DpotCSv3.js";import{c as ke,q as $e}from"./address-DRxoJInl.js";import{R as Ce,f as Ae,d as Re,a1 as Se,be as De,r as Be,bb as Ve}from"./index-BvL8wS8a.js";import{u as Ne}from"./useSelectAddress-CgNt0r_o.js";import{l as Ie}from"./luckyShopContract-Bj1eEjXA.js";import"./mall-BNNzTN-n.js";import"./MCOIN-BcbOHmhy.js";import"./OrderGoods-DJU_6rWX.js";import"./BoutiqueLable-r45nG6V6.js";import"./shop-CeqcS6K2.js";import"./flashSale-DDyqLyYN.js";import"./ShopMaskTips-dKZ6_BUi.js";import"./enums-DlE-aiss.js";const Pe=f=>(he("data-v-5081c72a"),f=f(),ge(),f),Le={key:0,class:"p-2.5"},Oe={class:"text-xl font-semibold"},qe={class:"mt-2.5"},Ge={class:"bg-white mt-2.5 rounded-xl p-2.5 flex items-center justify-between gap-2"},Ke={class:"flex-1"},Te={class:"bg-white mt-2.5 rounded-xl p-2.5"},Ee={class:"flex items-baseline justify-between mt-1"},Fe={class:"opacity-60"},Me={class:"text-right"},Ue=Pe(()=>s("div",{class:"text-base font-semibold"},"0Mcoin",-1)),je={class:"opacity-60"},ze={class:"flex flex-col items-center my-[50px]"},He={class:"p-2.5 pb-[150px]"},Qe={class:"relative text-center mb-2.5"},Ye=de({setup(f){const{generateKey:A,decryptAddressKey:K,getUserDhKey:T,encryptAddressKey:R,formatAddressData:S}=Ce(),{luckyComfirmRandom:E,commodities:F}=Ie(),{t:w}=ue(),{loadingToggle:D}=Be(),{getAddress:B,setAddress:M}=Ne(),{tradeContributeSelfRate:U}=Ae(),j=be(),v=ve(),[z,H]=g(!1),[_,x]=g(!1),[Q,Y]=g(!0),[Z,V]=g(!1),k=m([]),a=m(),c=m(),p=m(""),h=m(1),J=O(()=>{var e;return((e=c.value)==null?void 0:e.price)*h.value}),W=O(()=>Re(N.value/100*J.value*I.value)),X=async()=>{if(B()){a.value=B(),M(null);return}const e=v.currentRoute.value.path,t=await $e();if(!t.success)return;k.value=t.data;const r=k.value.find(o=>o.isDefault===1)||k.value[0],d=await A("user",e);if(r!=null&&r.encryptFlag&&d){a.value=K(r,d);return}a.value=r},ee=async()=>{const e=await Ve(+j.query.id);e.success,c.value=e.data},N=m(null),te=async()=>{const e=await F(c.value.id);N.value=+ye(+e.discountRate).div(1e4).toNumber()||20},se=e=>{e<1?h.value=1:h.value=e},ae=async()=>{var n,L;if(!a.value)return C(w("order.setAddress"));if((n=a.value)!=null&&n.encryptFlag&&!((L=a.value)!=null&&L.success))return C(w("order.reconfirm the information"));if(!Se(a.value.telNumber))return C(w("address.number was identified"));const e=v.currentRoute.value.path;V(!0);const t=await T(c.value.shopId),r=await A("user",e);let d;r&&!a.value.encryptFlag&&(d=R(a.value,r),await ke({...d,isDefault:a.value.isDefault?1:0}));let o={};if(t?(o=S(o,{...a.value,postscript:p.value},1),o=R(o,t),o.submitHash=o.hash):o=S(o,{...a.value,postscript:p.value},0),(await De({odGoodsId:c.value.id,...o})).success){const ie=await E(c.value.id);if(V(!1),!ie.success)return;v.replace({path:"/flashSale",query:{refresh:1}})}},I=m(0),oe=async()=>{I.value=await U()},re=async()=>{D(!0),await X(),await ee(),await te(),oe(),D(!1),Y(!1)},ne=e=>{v.push(e)};return ce(()=>{re()}),(e,t)=>{const r=y("van-icon"),d=y("VanButton"),o=y("van-field"),P=y("VanPopup");return i(Q)?q("",!0):(G(),me("div",Le,[s("header",Oe,l(e.$t("order.submitOrder")),1),u(we,{class:"mt-2.5",defaultAddress:a.value,onClick:t[0]||(t[0]=n=>ne("/userAddress"))},null,8,["defaultAddress"]),s("div",qe,[u(xe,{needMask:!1,orderInfo:c.value,number:h.value,onChangeNumber:se,isDisabledEdit:!0,isDisabledEditCount:!0},null,8,["orderInfo","number"])]),s("div",Ge,[s("div",Ke,l(e.$t("order.remark")),1),s("div",{class:"flex-1 text-right line-clamp-1 opacity-60 whitespace-nowrap",onClick:t[1]||(t[1]=n=>i(x)(!0))},[b(l(p.value?p.value:e.$t("order.noRemark"))+" ",1),u(r,{name:"arrow"})])]),s("div",Te,[s("div",null,l(e.$t("order.priceDetail")),1),s("div",Ee,[s("div",Fe,l(e.$t("order.total")),1),s("div",Me,[Ue,s("div",je,l(e.$t("order.getContribution",{num:i(W)})),1)])])]),s("div",ze,[u(d,{class:"btn-orange btn-shadow w-[150px] h-[40px] text-white",loading:i(Z),onClick:ae},{default:$(()=>[b(l(e.$t("common.confirm")),1)]),_:1},8,["loading"])]),u(P,{show:i(_),"onUpdate:show":t[5]||(t[5]=n=>fe(_)?_.value=n:null),position:"bottom",round:"",style:{"text-align":"center"}},{default:$(()=>[s("div",He,[s("div",Qe,[b(l(e.$t("order.submitOrder"))+" ",1),s("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:t[2]||(t[2]=n=>i(x)(!1))},[u(r,{name:"cross"})])]),u(o,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=n=>p.value=n),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:e.$t("order.remarkDes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),u(d,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",onClick:t[4]||(t[4]=n=>i(x)(!1))},{default:$(()=>[b(l(e.$t("common.confirm")),1)]),_:1})]),_:1},8,["show"]),i(z)?(G(),pe(_e,{key:0,onClose:t[6]||(t[6]=n=>i(H)(!1)),text:e.$t("common.pay success")},null,8,["text"])):q("",!0)]))}}}),mt=le(Ye,[["__scopeId","data-v-5081c72a"]]);export{mt as default};
