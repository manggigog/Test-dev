import{_ as wt,z as Y,F as j,Z as B,H as y,$ as m,I as s,Q as h,P as d,a4 as z,r as p,D as ne,U as N,G as X,K as no,a3 as be,V as ut,J as io,x as ro,bB as q,y as b,o as co,bU as vo,E as po,n as O,ab as mo,O as r,bK as nt,a0 as we,bx as fo,T as $,a9 as Ge,q as ho,X as go,Y as yo,bJ as it,by as rt}from"./vendor-Dr_RpJ_Y.js";import{_ as wo}from"./tips-DZsPLL66.js";import{E as bo}from"./EmptyTipsPop-IgJtI54h.js";import{y as Fo,a as xo,u as _o,b as To,C as te,bI as ue,e as Do,$ as Co,bJ as $o,Y as dt,ax as ct,ay as vt,a7 as pt,g as mt,s as Vo}from"./index-CU2nzZe6.js";import{_ as ko}from"./clerk-select-CyxOtqoc.js";import{B as So}from"./BackIcon-CDrGaEPo.js";import{a as Eo}from"./category-CPc0zbBB.js";import{q as Io,b as Bo}from"./goods-CMFNhadQ.js";import{u as ft}from"./upload-GBdaxjFw.js";import{P as ht}from"./flashSale-DDyqLyYN.js";import{D as Me,G as gt}from"./goods-BVwS8oFG.js";import{i as yt}from"./offlineGoods-DvT2Go6q.js";import{D as Ao}from"./DescriptionPop-BI53EHcZ.js";const Ro={class:"py-8 text-base text-center text-black"},Po={class:"flex"},Lo=Y({props:{show:{type:Boolean}},emits:["close","confirm","cancel"],setup(c,{emit:f}){return(g,n)=>{const i=j("van-button");return y(),B(Fo,{width:"90%",show:c.show,name:g.$t("common.tip"),onClose:n[2]||(n[2]=()=>{f("close")})},{default:m(()=>[s("div",Ro,[s("div",null,h(g.$t("shop.good_tips1")),1)]),s("div",Po,[d(i,{class:"plain-btn w-1/2 mx-2.5 text-[#FEA021] font-semibold",onClick:n[0]||(n[0]=()=>{f("cancel")})},{default:m(()=>[z(h(g.$t("common.cancel")),1)]),_:1}),d(i,{class:"w-1/2 mx-2.5 btn-orange btn-shadow text-white font-semibold",onClick:n[1]||(n[1]=()=>{f("confirm")})},{default:m(()=>[z(h(g.$t("common.confirm")),1)]),_:1})])]),_:1},8,["show","name"])}}}),Uo=wt(Lo,[["__scopeId","data-v-4446bae0"]]),qo={class:"relative min-h-[304px] p-[16px] flex flex-col h-[50vh]"},No={class:"flex items-center text-[#2E2008] pb-4 shrink-0"},Go=s("div",{class:"w-4 h-4"},null,-1),Mo={class:"flex-1 text-base font-semibold text-center"},Ho={class:"flex-1 overflow-y-auto"},Oo=["onClick"],jo={class:"w-full flex justify-between items-center"},zo={key:0,class:"w-[20px] h-[20px]",src:ko,alt:""},ve=Y({props:{show:{type:Boolean,default:!1},list:{default:()=>[]},title:{default:""},modelValue:null},emits:["update:show","confirm","close"],setup(c,{emit:f}){const g=c,n=p(g.modelValue);ne(()=>g.show,oe=>{oe&&(n.value=g.modelValue)});const i=oe=>{n.value=oe.value,_()},_=()=>{f("confirm",n.value),f("update:show",!1)},me=()=>{f("update:show",!1),f("close")};return(oe,le)=>{const Fe=j("van-icon"),Q=j("Empty"),xe=j("van-popup");return y(),B(xe,{show:c.show,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:me},{default:m(()=>[s("div",qo,[s("div",No,[Go,s("span",Mo,h(c.title),1),s("div",{class:"flex items-center justify-center",onClick:me},[d(Fe,{name:"cross",size:"20"})])]),s("div",Ho,[c.list.length===0?(y(),B(Q,{key:0,name:"没有选项",class:"!py-12"})):N("",!0),(y(!0),X(io,null,no(c.list,(A,_e)=>(y(),X("div",{class:"w-full min-h-[56px] py-[16px] flex items-center cursor-pointer",style:ut(_e===c.list.length-1?"border-bottom: 0":"border-bottom: 1px solid #D9D9D9"),key:A.value,onClick:be(Z=>i(A),["stop"])},[s("div",jo,[s("div",{class:"flex items-center w-full text-sm",style:ut(n.value===A.value?"color: #FF8812; font-weight: 600":"color: #2E2008; font-weight: 400")},h(A.text),5),n.value===A.value?(y(),X("img",zo)):N("",!0)])],12,Oo))),128))])])]),_:1},8,["show"])}}}),Wo=Y({props:{show:{type:Boolean},list:null,modelValue:null},emits:["update:show","confirm"],setup(c,{emit:f}){const g=i=>{f("update:show",i)},n=i=>{f("confirm",i)};return(i,_)=>(y(),B(ve,{show:c.show,list:c.list,title:i.$t("common.cate-eyes"),modelValue:c.modelValue,"onUpdate:show":g,onConfirm:n},null,8,["show","list","title","modelValue"]))}}),Jo=Y({props:{show:{type:Boolean},list:null,modelValue:null},emits:["update:show","confirm"],setup(c,{emit:f}){const g=i=>{f("update:show",i)},n=i=>{f("confirm",i)};return(i,_)=>(y(),B(ve,{show:c.show,list:c.list,title:i.$t("goods.deliveryType"),modelValue:c.modelValue,"onUpdate:show":g,onConfirm:n},null,8,["show","list","title","modelValue"]))}}),Ko=Y({props:{show:{type:Boolean},list:null,modelValue:null},emits:["update:show","confirm"],setup(c,{emit:f}){const g=i=>{f("update:show",i)},n=i=>{f("confirm",i)};return(i,_)=>(y(),B(ve,{show:c.show,list:c.list,title:i.$t("goods.Set product type"),modelValue:c.modelValue,"onUpdate:show":g,onConfirm:n},null,8,["show","list","title","modelValue"]))}}),Xo=Y({props:{show:{type:Boolean},list:null,modelValue:null},emits:["update:show","confirm"],setup(c,{emit:f}){const g=i=>{f("update:show",i)},n=i=>{f("confirm",i)};return(i,_)=>(y(),B(ve,{show:c.show,list:c.list,title:i.$t("goods.Inventory Warning"),modelValue:c.modelValue,"onUpdate:show":g,onConfirm:n},null,8,["show","list","title","modelValue"]))}}),Yo=Y({props:{show:{type:Boolean},list:null,modelValue:null},emits:["update:show","confirm"],setup(c,{emit:f}){const g=i=>{f("update:show",i)},n=i=>{f("confirm",i)};return(i,_)=>(y(),B(ve,{show:c.show,list:c.list,title:i.$t("goods.shippingTemplate"),modelValue:c.modelValue,"onUpdate:show":g,onConfirm:n},null,8,["show","list","title","modelValue"]))}}),pe=c=>(go("data-v-c4c91ec6"),c=c(),yo(),c),Qo={class:"h-ful !bg-gray1 font-Puhui pb-20",style:{"background-image":"none"}},Zo={class:"sticky top-0 z-10 bg-white px-1 py-3"},el={class:"flex items-center gap-x-1"},tl={class:"text-lg"},ol={class:"bg-white rounded-xl overflow-hidden m-3 px-3 py-4 title"},ll={class:"text-b1 font-semibold"},sl={class:"border-b4 border-b border-solid pb-4"},al={class:"van-uploader__wrapper"},ul=["data-uuid","onClick"],nl={class:"van-image van-uploader__preview-image handle",style:{width:"60px",height:"60px"}},il=["onClick"],rl=pe(()=>s("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),dl=[rl],cl={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},vl=["src"],pl={class:"text-xs font-light text-center text-b1 opacity-30"},ml={class:"border-b4 border-b border-solid"},fl={class:"text-default font-semibold"},hl={class:"pt-4 font-semibold text-b1"},gl={class:"van-uploader__wrapper"},yl=["onClick"],wl={class:"van-image van-uploader__preview-image handle",style:{width:"60px",height:"60px"}},bl=["onClick"],Fl=pe(()=>s("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),xl=[Fl],_l={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Tl=["src"],Dl={class:"text-xs font-light text-center text-b1 opacity-30"},Cl={class:"bg-white rounded-xl overflow-hidden m-3"},$l={class:"text-default font-semibold"},Vl={class:"bg-white rounded-xl overflow-hidden m-3"},kl={class:"text-b1 font-semibold"},Sl={class:"bg-white rounded-xl m-3 overflow-hidden"},El={key:0,class:"overflow-hidden"},Il={class:"text-default font-semibold"},Bl=pe(()=>s("div",{class:"mx-3 bg-b4 w-[calc(100% - 24)] h-[1px]"},null,-1)),Al={class:"overflow-hidden"},Rl={class:"flex items-center text-b1 font-semibold"},Pl=pe(()=>s("img",{class:"w-full h-auto",src:wo},null,-1)),Ll=[Pl],Ul={class:"bg-white rounded-xl overflow-hidden m-3 px-3 title"},ql={class:"border-[#EAEAEA] border-b border-solid"},Nl={class:"text-default whitespace-nowrap font-semibold"},Gl={class:"whitespace-nowrap"},Ml={class:"border-b4 border-b border-solid"},Hl={class:"text-default font-semibold"},Ol={class:"text-default font-semibold"},jl=z("%"),zl={key:0,class:"bg-white rounded-xl overflow-hidden m-3 px-3 title"},Wl={class:"border-[#EAEAEA] border-b border-solid"},Jl={class:"text-default font-semibold"},Kl={class:"text-default font-semibold"},Xl={key:0,class:"border-b4 border-t border-solid"},Yl={class:"text-b1 font-semibold"},Ql=z("%"),Zl={class:"bg-white rounded-xl overflow-hidden m-3"},es={class:"text-b1 font-semibold"},ts={key:1,class:"fixed bottom-0 left-0 w-full flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},os=pe(()=>s("div",null,[z(" 您修改了"),s("span",{style:{color:"#f44"}},"正在上架"),z("的商品的信息，还未保存,离开页面会丢失这些更改，您确定要离开吗 ")],-1)),ls=Y({setup(c){const{accountStore:f}=xo(),{getCurrentStoreId:g}=_o(),{t:n}=ro(),i=co(),_=ho(),{checkLoginAuth:me}=To(),[oe,le]=q(!1),[Fe,Q]=q(!1),[xe,A]=q(!1),[_e,Z]=q(!1),[He,P]=q(!1),[Oe,fe]=q(!1),[bt,je]=q(!1),[Ft,ze]=q(!1),[xt,he]=q(!1),[_t,We]=q(!1),Te=p(!1),De=p(!1),Ce=p(!1),$e=p(!1),Ve=p(!1),o=p({id:null,icons:"",goodsName:"",isHot:0,price:null,discountRatio:null,balanceDiscountRatio:null,subclassId:null,goodsDesc:null,goodsPic:"",deliveryType:1,status:1,payType:1,stock:null,goodsTypes:null,warnType:null,warnValue:null,shopId:null,shippingTemplateId:0}),F=p([]),T=p([]),W=p(0),D=p(0),V=p(null),Je=b(()=>[{value:1,text:n("goods.Phone bill recharge")},{value:2,text:n("goods.Buying agent")},{value:null,text:n("goods.other")}]),Ke=b(()=>[{value:1,text:n("goods.Proportional")},{value:2,text:n("goods.By value")}]),E=p(1),Xe=b(()=>D.value?[{value:Me.online,text:n("common.send")}]:[{value:Me.online,text:n("common.send")},{value:Me.offeline,text:n("common.offline")}]),Tt=b(()=>D.value?n("common.pay methods ten"):n("common.pay methods three")),Dt=b(()=>[{url:"goods/rechargeGood",text:n("goods.Phone bill recharge"),subText:n("goods.rechargeTips")},{url:"goods/agentGood",text:n("goods.Buying agent"),subText:n("goods.agentTips")}]),ke=b(()=>{const e=Ye.value.find(t=>t.value===S.value);return e?e.text:""}),Se=b(()=>{const e=Xe.value.find(t=>t.value===E.value);return e?e.text:""}),Ee=b(()=>{const e=Je.value.find(t=>t.value===V.value);return e?e.text:""}),Ie=b(()=>{const e=Ke.value.find(t=>t.value===o.value.warnType);return e?e.text:""}),Ct=e=>{E.value!==e&&(E.value=e,je(!0))},$t=e=>{o.value.warnType!==e&&(o.value.warnType=e,o.value.warnValue=null)},Vt=b(()=>{const e=i.query.id?"编辑商品":"发布商品";return document.title=e,e}),kt=b(()=>o.value.status===0?"立即上架":o.value.status===1?"保存并发布":"立即上架"),St=()=>{D.value=1,o.value.discountRatio=o.value.discountRatio>I.value[1]?I.value[1]:o.value.discountRatio,fe(!1)},Et=()=>{tt(),fe(!1)},S=p(0),Ye=b(()=>{let e=Qe.value.filter(t=>t.type===E.value);return e=e.map(t=>({value:t.id,text:t.name})),e});ne(He,e=>{e&&setTimeout(()=>{P(!1)},3e3)});const Qe=p([]),It=async()=>{var t;const e=await Eo({address:(t=await g())==null?void 0:t.merchant});e.success&&(Qe.value=e.data||[])},Ze=p(!1),Bt=async()=>{const e=i.query.id,t=i.query.boutique;if(!e)return;const a=await Io(+e);a.success&&(o.value=a.data.goods,t&&(o.value.boutiqueFlag=!0,o.value.type=J.value),o.value.icons&&(F.value=(o.value.icons||"").split(",").map(u=>({id:ue(),url:u}))),o.value.goodsPic&&(T.value=o.value.goodsPic.split(",").map(u=>({id:ue(),url:u}))),o.value.payType=ht.MC,o.value.cardPrice=null,W.value=o.value.isHot,D.value=o.value.type>0?1:0,E.value=o.value.deliveryType,S.value=o.value.subclassId||null,V.value=+o.value.goodsTypes||null)},ie=p(5),At=async e=>{let t=Array.isArray(e)?e:[e],a=F.value.length+t.length;if(a>ie.value&&(t=t.slice(0,ie.value-F.value.length)||[]),t.length!==0){$.loading({message:n("common.uploading"),forbidClick:!0,duration:0});for(const u of t){const v=ct(u.file);if(!v.valid){$(v.tips);return}const C=vt(u.file);if(!C.valid){$(C.tips);return}try{const x=await pt(u,"goodsImg"),l=await ft(x);l.success?F.value.push({id:ue(),url:mt.imgUrl+l.data}):$(n("comomn.Image upload failed"))}catch(x){console.error(x),$(n("comomn.Image upload failed"))}}$.clear(),a>ie.value&&$(`最多只能上传${ie.value}张图片`)}},Rt=e=>{F.value.splice(e,1)},Pt=e=>{rt({images:F.value.map(t=>t.url),startPosition:e})},re=p(5),Lt=async e=>{let t=Array.isArray(e)?e:[e],a=T.value.length+t.length;if(a>re.value&&(t=t.slice(0,re.value-T.value.length)||[]),t.length!==0){$.loading({message:n("common.uploading"),forbidClick:!0,duration:0});for(const u of t){const v=ct(u.file);if(!v.valid){$(v.tips);return}const C=vt(u.file);if(!C.valid){$(C.tips);return}try{const x=await pt(u,"goodsDesc"),l=await ft(x);l.success?T.value.push({id:ue(),url:mt.imgUrl+l.data}):$(n("comomn.Image upload failed"))}catch(x){console.error(x),$(n("comomn.Image upload failed"))}}$.clear(),a>re.value&&$(`最多只能上传${re.value}张图片`)}},Ut=e=>{T.value.splice(e,1)},qt=e=>{rt({images:T.value.map(t=>t.url),startPosition:e})},et=p(!1),se=p(!1),de=p([]),ee=p(""),G=p(null),Nt=()=>{const e=i.query.id||"add";sessionStorage.setItem("shop_refresh_id",e.toString())},Be=async()=>{et.value=!1,o.value.status=0,await st(),at(),U(),L.value=!1,R.value=!0,k.value=null},Gt=e=>{const t=e.target.value||0;t>=1e7?o.value.price=9999999:parseInt(t)!==parseFloat(t)&&(o.value.price=Number(Do(t)))},Mt=()=>{o.value.price<0&&($(n("goods.price tips")),o.value.price=Math.abs(o.value.price)),o.value.price>=1e7&&(o.value.price=9999999)},M=p(null),tt=async()=>{if(!F.value.length)return M.value=n("goods.emptyImg"),P(!0);if(!S.value)return M.value=n("goods.Set product category"),P(!0);if(!o.value.goodsName||o.value.price<=0||!o.value.goodsName.trim())return M.value=n("goods.notEmpty"),P(!0);if(!o.value.discountRatio||o.value.discountRatio<I.value[0]||+o.value.discountRatio>I.value[1])return M.value=n("shop.emptyRadio")+`<span class="text-lg font-bold text-red-400 ">(${I.value[0]}-${I.value[1]}%)</span>`,P(!0);if(!o.value.stock&&o.value.stock!==0&&+V.value!==gt.AGENT)return M.value=n("goods.Please enter stock"),P(!0);if(V.value!==2){if(!o.value.warnType)return M.value=n("goods.Please select the inventory warning method"),P(!0);if(!+o.value.warnValue)return M.value=o.value.warnType===1?n("goods.Please set the ratio1"):n("goods.Please set the value2"),P(!0)}if(!D.value&&!Oe.value&&J.value&&o.value.discountRatio>=20&&E.value===1)return fe(!0);se.value=!0,et.value=!1,o.value.status=1,await st(),at()},ot=b(()=>({1:n("common.boutique"),2:n("mall.Best"),3:n("shop.Star Selection")})),J=p(0),Ht=async()=>{var a;const{success:e,data:t}=await Co((a=await g())==null?void 0:a.merchant);e&&(J.value=t==null?void 0:t.type)},I=b(()=>{let e=[1,80];if(!D.value)return e;switch(J.value){case 1:e=[4,30];break;case 2:e=[10,80];break;case 3:e=[20,80];break;default:e=[1,80];break}return e});ne(D,e=>{e===1&&(o.value.discountRatio=o.value.discountRatio>I.value[1]?I.value[1]:o.value.discountRatio)});const Ot=b(()=>+o.value.discountRatio&&D.value?+o.value.discountRatio:null),Ae=b(()=>{const e=!!(o.value.goodsName&&o.value.goodsName.trim()),t=!!(o.value.goodsDesc&&o.value.goodsDesc.trim()),a=!!(F.value&&F.value.length>0),u=!!(T.value&&T.value.length>0),v=o.value.price!==null&&o.value.price!==void 0&&o.value.price>0,C=!!o.value.discountRatio,x=S.value!==null&&S.value!==0,l=V.value!==null&&V.value!==void 0,w=o.value.stock===-1||o.value.stock>0;return Object.values({hasGoodsName:e,hasGoodsDesc:t,hasMainImg:a,hasDescImg:u,hasPrice:v,hasDiscountRatio:C,hasSubclassId:x,hasGoodsTypes:l,hasStock:w}).every(uo=>uo===!1)}),jt=async()=>{var a;const e={page:1,size:9999,address:(a=await g())==null?void 0:a.merchant},t=await $o(e);if(t.success){if(de.value=Array.isArray(t.data)?t.data:[],!o.value.id&&!o.value.shippingTemplateId){const u=de.value.find(v=>v.defaultFlag);u&&(ee.value=u.name,G.value=u.id,o.value.shippingTemplateId=u.id)}else if(o.value.shippingTemplateId){const u=de.value.find(v=>v.id===o.value.shippingTemplateId);u&&(ee.value=u.name,G.value=u.id)}}},zt=b(()=>[...de.value.map(e=>({value:e.id,text:e.name}))]);ne(G,e=>{if(e){const t=de.value.find(a=>a.id===e);t&&(ee.value=t.name,o.value.shippingTemplateId=e)}else ee.value="",o.value.shippingTemplateId=0});const Wt=e=>e>I.value[1]?I.value[1].toString():e||"",Jt=e=>+o.value.warnType==1?e>100?"100":e||null:+o.value.warnType==2?e>+o.value.stock?o.value.stock:e||null:e,lt=()=>{S.value=null,je(!1)},st=async()=>{var a;const e=F.value.map(u=>u.url),t=T.value.map(u=>u.url);o.value.type=D.value?J.value:0,o.value.icons=e.join(","),o.value.goodsPic=t.join(","),o.value.isHot=W.value,o.value.boutiqueFlag=null,o.value.deliveryType=E.value,o.value.subclassId=S.value||null,o.value.payType=ht.MC,o.value.goodsTypes=V.value||null,o.value.shopId=(a=await g())==null?void 0:a.id,o.value.balanceDiscountRatio=Ot.value},ce="goods_draft_data",K=b(()=>{var e;return((e=f.store)==null?void 0:e.id)+"_"+f.account}),k=p(null),ae=p(null),L=p(!1),R=p(!1),Re=p(!1),H=()=>({goods:Ge.cloneDeep(o.value),imgList:Ge.cloneDeep(F.value),descImgList:Ge.cloneDeep(T.value),isHot:W.value,boutiqueFlag:D.value,goodsTypes:V.value,deliveryType:E.value,subclassId:S.value,selectedTemplateId:G.value}),Pe=(e,t=!1)=>{try{const a={...e,isManualSave:t,timestamp:Date.now()};let u=Le();u&&!u.goods?u={...u,[K.value]:a}:u={[K.value]:a},localStorage.setItem(ce,JSON.stringify(u))}catch(a){console.error("保存表单数据失败:",a)}},Le=()=>{try{const e=localStorage.getItem(ce);return e?JSON.parse(e):null}catch(e){return console.error("获取缓存数据失败:",e),null}},Ue=()=>{var e;try{const t=Le();return!t||!t[K.value]||!((e=t[K.value])!=null&&e.goods)?null:t[K.value]}catch(t){return console.error("恢复表单数据失败:",t),null}},U=()=>{try{let e=Le();e&&e[K.value]&&e[K.value].goods?(delete e[K.value],Object.keys(e).length===0?localStorage.removeItem(ce):localStorage.setItem(ce,JSON.stringify(e))):localStorage.removeItem(ce)}catch(e){console.error("清空表单数据失败:",e)}},Kt=e=>{if(e)try{e.goods&&Object.assign(o.value,e.goods),e.imgList&&Array.isArray(e.imgList)&&(F.value=e.imgList.map(t=>({id:t.id||ue(),url:t.url}))),e.descImgList&&Array.isArray(e.descImgList)&&(T.value=e.descImgList.map(t=>({id:t.id||ue(),url:t.url}))),e.isHot!==void 0&&(W.value=e.isHot),e.boutiqueFlag!==void 0&&(D.value=e.boutiqueFlag),e.goodsTypes!==void 0&&(V.value=e.goodsTypes),e.deliveryType!==void 0&&(E.value=e.deliveryType),e.subclassId!==void 0&&(S.value=e.subclassId),e.selectedTemplateId!==void 0&&(G.value=e.selectedTemplateId)}catch(t){console.error("填充表单数据失败:",t)}},qe=e=>{if(!e)return!1;const t=H();if(!t)return!1;const a=(u,v)=>{if(u===v)return!0;if(!u||!v||typeof u!="object"||typeof v!="object")return!1;const C=Object.keys(u),x=Object.keys(v);if(C.length!==x.length)return!1;for(const l of C){if(!x.includes(l))return!1;if(Array.isArray(u[l])&&Array.isArray(v[l])){if(u[l].length!==v[l].length)return!1;for(let w=0;w<u[l].length;w++)if(l==="imgList"||l==="descImgList"){if(u[l][w].url!==v[l][w].url)return!1}else if(!a(u[l][w],v[l][w]))return!1}else if(typeof u[l]=="object"&&typeof v[l]=="object"&&u[l]!==null&&v[l]!==null){if(!a(u[l],v[l]))return!1}else if(u[l]!==v[l])return!1}return!0};return!a(t,e)};ne([()=>o.value,()=>F.value,()=>T.value,()=>W.value,()=>D.value,()=>V.value,()=>E.value,()=>S.value,()=>G.value],()=>{if(Ze.value&&k.value){if(L.value=qe(k.value),!qe(ae.value))U();else if(Ae.value)U();else if(!R.value){const t=H();Pe(t,!1)}}},{deep:!0});const at=async()=>{var t;const e=await Bo(o.value);if(!e.success){se.value=!1;return}Nt(),U(),L.value=!1,R.value=!0,k.value=null,o.value.status===1?_.replace({path:"/editSuccess",query:{id:(t=e.data)==null?void 0:t.id}}):_.back(),setTimeout(()=>{se.value=!1},1500)},Xt=()=>{const e=H();Pe(e,!0),le(!1),R.value=!0,L.value=!1,O(()=>{_.back()})},Yt=()=>{U(),le(!1),R.value=!0,Qt(),L.value=!1,k.value=null,O(()=>{_.back()})},Qt=()=>{o.value={id:null,icons:"",goodsName:"",isHot:0,price:null,discountRatio:null,balanceDiscountRatio:null,subclassId:null,goodsDesc:null,goodsPic:"",deliveryType:1,status:1,payType:1,stock:null,goodsTypes:null,warnType:null,warnValue:null,shopId:null,shippingTemplateId:0},F.value=[],T.value=[],W.value=0,D.value=0,V.value=null,E.value=1,S.value=0,G.value=null,ee.value=""},Ne=()=>{const e=Ue();e&&(Kt(e),O(()=>{k.value=H(),Pe(e,!0)})),he(!1)},ge=()=>{U(),he(!1),We(!1),O(()=>{k.value=H(),L.value=!1})},Zt=()=>{U(),Q(!1),R.value=!0,L.value=!1,k.value=null,O(()=>{_.back()})},eo=()=>{Q(!1)},to=async()=>{A(!1),R.value=!0,await Be()},oo=()=>{U(),A(!1),R.value=!0,L.value=!1,k.value=null,O(()=>{_.back()})},lo=async()=>{Z(!1),R.value=!0;try{await Be(),U(),Z(!1)}catch(e){console.error("保存草稿并退出失败:",e)}},so=()=>{U(),Z(!1),R.value=!0,O(()=>{_.back()})},ao=()=>{const e=Ue();_.back(),setTimeout(()=>{var a,u;let t={};(a=e.goods)!=null&&a.id&&(t.id=(u=e.goods)==null?void 0:u.id),_.push({name:"EditGoods",query:t,params:{restoreWithoutInquire:1}})},100)};return vo((e,t,a)=>{if(se.value){a();return}if(R.value){a();return}if(Vo.versions.ios&&!Re.value){a();return}Re.value=!1;const u=!!i.query.id,v=!u,C=o.value.status===1,x=o.value.status===0,l=o.value.status===2,w=qe(ae.value);if(u&&C&&k.value&&w){Q(!0),a(!1);return}if(u&&x&&k.value&&w){A(!0),a(!1);return}if(u&&l&&k.value&&w){Z(!0),a(!1);return}if(v&&k.value&&!Ae.value){le(!0),a(!1);return}a()}),ne(()=>i.path,e=>{e!=="/shopGoods/editGoods"&&(Q(!1),A(!1),Z(!1),le(!1))},{immediate:!0,deep:!0}),po(async()=>{var a,u,v;if(!me(!0))return;await Ht(),It();const e=!i.query.id,t=Ue();t&&e&&!((a=t.goods)!=null&&a.id)&&(t.isManualSave||i.params.restoreWithoutInquire?(ae.value={...H()},Ne(),await O(),L.value=!0):he(!0)),await Bt(),await jt(),t&&!e&&((u=t.goods)==null?void 0:u.id)==i.query.id&&(i.params.restoreWithoutInquire?(ae.value={...H()},Ne(),await O(),L.value=!0):he(!0)),k.value=H(),ae.value||(ae.value={...H()}),t&&((v=t.goods)==null?void 0:v.id)!=i.query.id&&We(!0),Ze.value=!0}),mo(()=>{}),(e,t)=>{const a=j("van-field"),u=j("VanImage"),v=j("van-uploader"),C=j("van-switch"),x=j("VanButton");return y(),X("div",Qo,[s("header",Zo,[s("div",el,[d(So,{onBack:t[0]||(t[0]=l=>Re.value=!0)}),s("span",tl,h(r(Vt)),1)])]),s("div",ol,[s("div",ll,h(`${e.$t("goods.goodsName")}`),1),d(a,{modelValue:o.value.goodsName,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.goodsName=l),autosize:"",type:"text",placeholder:e.$t("goods.pleaseInputTitle"),maxlength:"50",class:"no-bt"},null,8,["modelValue","placeholder"]),s("div",sl,[s("div",al,[d(r(it),nt({class:"flex flex-wrap",modelValue:F.value,"onUpdate:modelValue":t[2]||(t[2]=l=>F.value=l),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:m(({element:l,index:w})=>[s("div",{class:"van-uploader__preview","data-uuid":l.id,onClick:ye=>Pt(w)},[s("div",nl,[d(u,{src:l.url,class:"van-image__img",radius:"6px",fit:"cover"},null,8,["src"])]),s("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:be(ye=>Rt(w),["stop"])},dl,8,il)],8,ul)]),_:1},16,["modelValue","handle"]),F.value.length<ie.value?(y(),B(v,{key:0,accept:r(yt),afterRead:At,multiple:""},{default:m(()=>[s("div",cl,[s("img",{src:r(dt)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,vl),s("div",pl,h(e.$t("goods.goodsImage")),1)])]),_:1},8,["accept"])):N("",!0)])]),s("div",ml,[d(a,{"input-align":"right",autocomplete:"off",class:"no-bt",readonly:"","is-link":"",modelValue:r(ke),"onUpdate:modelValue":t[3]||(t[3]=l=>we(ke)?ke.value=l:null),placeholder:e.$t("shop.pleaseSelect"),onClick:t[4]||(t[4]=l=>Te.value=!0)},{label:m(()=>[s("div",fl,h(`${e.$t("common.cate-eyes")}`),1)]),_:1},8,["modelValue","placeholder"])]),s("div",hl,h(`${e.$t("goods.goodsDesc")}`),1),d(a,{modelValue:o.value.goodsDesc,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.goodsDesc=l),rows:"1",autosize:"",type:"textarea",placeholder:e.$t("goods.pleaseInputDesc"),class:"no-bt"},null,8,["modelValue","placeholder"]),s("div",gl,[d(r(it),nt({class:"flex flex-wrap",modelValue:T.value,"onUpdate:modelValue":t[6]||(t[6]=l=>T.value=l),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:m(({element:l,index:w})=>[s("div",{class:"van-uploader__preview",onClick:ye=>qt(w)},[s("div",wl,[d(u,{src:l.url,class:"van-image__img",radius:"6px",fit:"cover"},null,8,["src"])]),s("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:be(ye=>Ut(w),["stop"])},xl,8,bl)],8,yl)]),_:1},16,["modelValue","handle"]),T.value.length<re.value?(y(),B(v,{key:0,accept:r(yt),afterRead:Lt,multiple:""},{default:m(()=>[s("div",_l,[s("img",{src:r(dt)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,Tl),s("div",Dl,h(e.$t("goods.descImage")),1)])]),_:1},8,["accept"])):N("",!0)])]),s("div",Cl,[d(a,{"input-align":"right",autocomplete:"off",class:"single-cell",label:`${e.$t("goods.deliveryType")}`,readonly:"","is-link":"",modelValue:r(Se),"onUpdate:modelValue":t[7]||(t[7]=l=>we(Se)?Se.value=l:null),onClick:t[8]||(t[8]=l=>De.value=!0)},{label:m(()=>[s("div",$l,h(`${e.$t("goods.deliveryType")} `),1)]),_:1},8,["label","modelValue"])]),s("div",Vl,[d(a,{"input-align":"right",autocomplete:"off",label:`${e.$t("goods.isHot")}`,class:"no-bt"},{label:m(()=>[s("div",kl,h(`${e.$t("goods.isHot")}`),1)]),input:m(()=>[d(C,{modelValue:W.value,"onUpdate:modelValue":t[9]||(t[9]=l=>W.value=l),"active-color":"#FF8812","inactive-color":"#B7B4B0","active-value":1,"inactive-value":0,size:"20"},null,8,["modelValue"])]),_:1},8,["label"])]),s("div",Sl,[J.value>0?(y(),X("div",El,[d(a,{"input-align":"right",autocomplete:"off",class:"no-bt",label:`*${e.$t("goods.setting boutique good"),{type:r(ot)[J.value]}}`},{label:m(()=>[s("div",Il,h(`${e.$t("goods.setting boutique good",{type:r(ot)[J.value]})}`),1)]),input:m(()=>[d(C,{modelValue:D.value,"onUpdate:modelValue":t[10]||(t[10]=l=>D.value=l),"active-color":"#FF8812","inactive-color":"#B7B4B0","active-value":1,"inactive-value":0,size:"20"},null,8,["modelValue"])]),_:1},8,["label"]),Bl])):N("",!0),s("div",Al,[d(a,{"input-align":"right",autocomplete:"off",label:e.$t("goods.Set product type"),readonly:"","is-link":"",modelValue:r(Ee),"onUpdate:modelValue":t[12]||(t[12]=l=>we(Ee)?Ee.value=l:null),onClick:t[13]||(t[13]=l=>Ce.value=!0)},{label:m(()=>[s("div",Rl,[z(h(e.$t("goods.Set product type"))+" ",1),s("div",{class:"w-4 ml-1.5",onClick:t[11]||(t[11]=be(l=>r(ze)(!0),["stop"]))},Ll)])]),_:1},8,["label","modelValue"])])]),s("div",Ul,[s("div",ql,[d(a,{"input-align":"right",autocomplete:"off",class:"fixed-width"},{label:m(()=>[s("div",Nl,h(`${e.$t("goods.pay methods")}`),1)]),input:m(()=>[s("div",Gl,h(r(Tt)),1)]),_:1})]),s("div",Ml,[d(a,{"input-align":"right",type:"number",autocomplete:"off",modelValue:o.value.price,"onUpdate:modelValue":t[14]||(t[14]=l=>o.value.price=l),onInput:Gt,onBlur:Mt,placeholder:e.$t("shop.pleaseInput"),class:"no-bt"},{label:m(()=>[s("div",Hl,h(`mc${e.$t("goods.price")} `),1)]),_:1},8,["modelValue","placeholder"])]),d(a,{class:"no-bt","input-align":"right",type:D.value?"digit":"number",autocomplete:"off",modelValue:o.value.discountRatio,"onUpdate:modelValue":t[15]||(t[15]=l=>o.value.discountRatio=l),formatter:Wt,placeholder:`${e.$t("shop.pleaseInput")}${r(I)[0]}-${r(I)[1]}`},{label:m(()=>[s("div",Ol,h(`${e.$t("goods.discountRatio")} `),1)]),"right-icon":m(()=>[jl]),_:1},8,["type","modelValue","placeholder"])]),+V.value!==r(gt).AGENT?(y(),X("div",zl,[s("div",Wl,[d(a,{"input-align":"right",type:"digit",maxlength:"9",autocomplete:"off",modelValue:o.value.stock,"onUpdate:modelValue":t[16]||(t[16]=l=>o.value.stock=l),placeholder:e.$t("shop.pleaseInput")},{label:m(()=>[s("div",Jl,h(`${e.$t("goods.stock")} `),1)]),_:1},8,["modelValue","placeholder"])]),d(a,{"input-align":"right",autocomplete:"off",label:`${e.$t("goods.Inventory Warning")}`,class:"no-bt",readonly:"","is-link":"",modelValue:r(Ie),"onUpdate:modelValue":t[17]||(t[17]=l=>we(Ie)?Ie.value=l:null),placeholder:e.$t("shop.pleaseSelect"),onClick:t[18]||(t[18]=l=>$e.value=!0)},{label:m(()=>[s("div",Kl,h(`${e.$t("goods.Inventory Warning")}`),1)]),_:1},8,["label","modelValue","placeholder"]),o.value.warnType?(y(),X("div",Xl,[d(a,{"input-align":"right",type:"digit",autocomplete:"off",modelValue:o.value.warnValue,"onUpdate:modelValue":t[19]||(t[19]=l=>o.value.warnValue=l),placeholder:e.$t("shop.pleaseInput"),formatter:Jt,class:"no-bt"},fo({label:m(()=>[s("div",Yl,h(` ${o.value.warnType===1?e.$t("goods.Please set the ratio"):e.$t("goods.Please set the value")}`),1)]),_:2},[o.value.warnType===1?{name:"right-icon",fn:m(()=>[Ql])}:void 0]),1032,["modelValue","placeholder"])])):N("",!0)])):N("",!0),s("div",Zl,[d(a,{"input-align":"right",autocomplete:"off",class:"single-cell",label:`${e.$t("goods.shippingTemplate")}`,readonly:"","is-link":"",modelValue:ee.value,"onUpdate:modelValue":t[20]||(t[20]=l=>ee.value=l),placeholder:e.$t("shop.pleaseSelect"),onClick:t[21]||(t[21]=l=>Ve.value=!0)},{label:m(()=>[s("div",es,h(` ${e.$t("goods.shippingTemplate")}`),1)]),_:1},8,["label","modelValue","placeholder"])]),r(f).isOnlyView?N("",!0):(y(),X("div",ts,[!r(i).query.id||o.value.status!==1?(y(),B(x,{key:0,type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-md border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:t[22]||(t[22]=l=>Be()),loading:se.value,disabled:r(Ae)},{default:m(()=>[z(h(e.$t("goods.saveDraft")),1)]),_:1},8,["loading","disabled"])):N("",!0),d(x,{class:"flex-1 min-w-[130px] h-[46px] rounded-md bg-btnOrBg text-b1 text-base font-semibold",onClick:t[23]||(t[23]=l=>tt()),loading:se.value,disabled:!o.value.goodsName},{default:m(()=>[z(h(r(kt)),1)]),_:1},8,["loading","disabled"])])),d(Wo,{show:Te.value,list:r(Ye),modelValue:S.value,"onUpdate:show":t[24]||(t[24]=l=>Te.value=l),onConfirm:t[25]||(t[25]=l=>S.value=l)},null,8,["show","list","modelValue"]),d(Jo,{show:De.value,list:r(Xe),modelValue:E.value,"onUpdate:show":t[26]||(t[26]=l=>De.value=l),onConfirm:Ct},null,8,["show","list","modelValue"]),d(Ko,{show:Ce.value,list:r(Je),modelValue:V.value,"onUpdate:show":t[27]||(t[27]=l=>Ce.value=l),onConfirm:t[28]||(t[28]=l=>V.value=l)},null,8,["show","list","modelValue"]),d(Xo,{show:$e.value,list:r(Ke),modelValue:o.value.warnType,"onUpdate:show":t[29]||(t[29]=l=>$e.value=l),onConfirm:$t},null,8,["show","list","modelValue"]),d(Yo,{show:Ve.value,list:r(zt),modelValue:G.value,"onUpdate:show":t[30]||(t[30]=l=>Ve.value=l),onConfirm:t[31]||(t[31]=l=>G.value=l)},null,8,["show","list","modelValue"]),r(He)?(y(),B(bo,{key:2,onClose:t[32]||(t[32]=l=>r(P)(!1)),text:M.value},null,8,["text"])):N("",!0),d(Uo,{show:r(Oe),onClose:t[33]||(t[33]=l=>r(fe)(!1)),onConfirm:St,onCancel:Et},null,8,["show"]),d(te,{show:r(bt),title:e.$t("common.tip"),content:e.$t("goods.re choose category"),confirmText:e.$t("common.confirm"),"show-reject":!1,onClose:lt,onConfirm:lt},null,8,["show","title","content","confirmText"]),d(Ao,{list:r(Dt),show:r(Ft),onClose:t[34]||(t[34]=l=>r(ze)(!1))},null,8,["list","show"]),d(te,{show:r(oe),noHeader:"",content:"保留此次编辑？",showConfirm:!0,showReject:!0,confirmText:"保留",rejectText:"不保留",onClose:t[35]||(t[35]=l=>r(le)(!1)),onConfirm:Xt,onReject:Yt},null,8,["show"]),d(te,{show:r(xt),noHeader:"",content:"你有未编辑完成的商品，是否继续？",showConfirm:!0,showReject:!0,confirmText:"编辑",rejectText:"放弃",onClose:ge,onConfirm:Ne,onReject:ge},null,8,["show"]),d(te,{show:r(_t),noHeader:"",content:"检测到你有一个上次编辑未保存的商品，是否离开当前页面前往编辑？",showConfirm:!0,showReject:!0,confirmText:"前往编辑",rejectText:"放弃",contentClass:"!text-left",onClose:ge,onConfirm:ao,onReject:ge},null,8,["show"]),d(te,{show:r(Fe),noHeader:"",showConfirm:!0,showReject:!0,confirmText:"取消",rejectText:"离开",contentClass:"!text-left",onClose:t[36]||(t[36]=l=>r(Q)(!1)),onConfirm:eo,onReject:Zt},{default:m(()=>[os]),_:1},8,["show"]),d(te,{show:r(xe),noHeader:"",content:"是否保存修改？",showConfirm:!0,showReject:!0,confirmText:"保存",rejectText:"不保存",onClose:t[37]||(t[37]=l=>r(A)(!1)),onConfirm:to,onReject:oo},null,8,["show"]),d(te,{show:r(_e),noHeader:"",content:"退出后不会保存本次编辑内容,您可以选择保存草稿,以便后续编辑",showConfirm:!0,showReject:!0,confirmText:"保存草稿并退出",rejectText:"直接退出",contentClass:"!text-left",confirmStyle:{width:"100%",fontSize:"16px",whiteSpace:"nowrap"},rejectStyle:{width:"100%",whiteSpace:"nowrap"},onClose:t[38]||(t[38]=l=>r(Z)(!1)),onConfirm:lo,onReject:so},null,8,["show"])])}}}),ys=wt(ls,[["__scopeId","data-v-c4c91ec6"]]);export{ys as default};
