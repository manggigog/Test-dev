import{z as fe,q as ve,r as B,y as M,B as Z,E as he,F as L,G as d,H as i,I as e,a1 as je,a3 as H,O as r,Q as a,J as te,K as se,P as b,U as S,a4 as R,_ as Ne,x as Ve,o as Oe,a2 as V,bl as Ue,Z as O,$ as E,bW as qe,a0 as de,T as c,a9 as ze,bj as z,bk as ee,bt as Me,bJ as He,bK as Ge,N as ce,by as Je,X as Ke,Y as We}from"./vendor-Dr_RpJ_Y.js";import{_ as _e}from"./arrow-down-KnMZ5gZc.js";import{_ as xe}from"./check-DoEtABZT.js";import{B as Ye}from"./BackIcon-CDrGaEPo.js";import{_ as Qe}from"./credit-EZuPIBEN.js";import{_ as be}from"./MCOIN-Bodfn-v1.js";import{_ as Xe}from"./USDT-Dlu99aCg.js";import{u as Ze,f as et}from"./useOrderStatus-CUBDjZMz.js";import{P as tt}from"./order-H59PKTFP.js";import{c as st,e as pe,i as ot,w as at,Y as nt,a7 as lt,g as ut}from"./index-7OiUoGXy.js";import{u as it}from"./useShipTemplate-VxaDU85Q.js";import{d as rt}from"./default-avatar-BIKCDGrQ.js";import{_ as dt}from"./EmptyTipsPop-DFfFg0cQ.js";import{c as ct,a as pt}from"./order-D0_No2Ew.js";import{b as mt,c as ft,d as vt,f as ht}from"./refund-Bg6bFzAK.js";import{i as me}from"./offlineGoods-DvT2Go6q.js";import{u as _t}from"./upload-C8f1eCjL.js";import"./enums-DlE-aiss.js";const xt={class:"p-3 mt-3 bg-white rounded-xl font-Puhui"},bt={class:"flex justify-between"},yt={class:"flex items-center overflow-hidden"},gt=["src"],wt={class:"text-sm font-semibold text-b1 line-clamp-1 ml-1"},Et={class:"shrink-0 max-w-[120px] font-semibold text-[#FF8812] text-sm line-clamp-1"},Bt={class:"flex w-full gap-2"},Ft={class:"w-[calc(100%-40px-60px)] flex-1 flex flex-col min-h-[5rem] justify-between"},kt={class:"flex items-baseline justify-between font-semibold"},Ct={class:"text-base text-b1 font-semibold line-clamp-1 text-ellipsis"},$t={key:0,class:"flex-shrink-0 flex items-center text-xs text-[#34C2A9]"},Tt=e("img",{src:Qe,class:"w-5 h-5"},null,-1),St={class:"text-sm text-b3 font-normal h-[40px]"},Rt={class:"ml-1"},It={key:0,class:"flex justify-between"},Dt={class:"text-sm font-normal text-b3 line-clamp-1"},At={class:"text-b1 text-sm font-semibold"},Lt={key:0,class:"flex items-center"},Pt=e("img",{class:"w-4 h-4 mr-1 font-normal text-sm",src:be},null,-1),jt={key:1,class:"flex items-center"},Nt=e("img",{class:"w-4 h-4 mr-1 font-normal text-sm",src:Xe},null,-1),Vt={class:"flex items-center whitespace-nowrap"},Ot=R("( "),Ut=e("img",{class:"w-4 h-4 mr-1 font-normal text-sm",src:be},null,-1),qt=fe({props:{order:null,isList:{type:Boolean},showPrice:{type:Boolean,default:!0},showShippingTemplate:{type:Boolean,default:!1}},setup(p){const P=p,J=ve(),j=B(null),y=M(()=>1/j.value),K=async()=>{const{mcoinRate:u}=st();j.value=await u()};M(()=>{var u;return!((u=P.order)!=null&&u.totalAmount)||!y.value?0:new Z(P.order.totalAmount).times(y.value).toNumber()});const N=u=>{J.push(u)},{getExpressTypeText:U}=it(),F=u=>{const g=new Z(u.price).times(u.number).minus(u.goodsActivityReduceAmount||0).plus(u.goodsAdjustChangeAmount||0).toNumber();return pe(g||0)},I=u=>{const g=new Z(u.price).times(u.number).minus(u.goodsActivityReduceAmount||0).plus(u.goodsAdjustChangeAmount||0).times(y.value).toNumber();return pe(g||0)};return he(async()=>{await K()}),(u,g)=>{const v=L("VanImage");return i(),d("div",xt,[e("div",bt,[e("div",{class:"flex-start",onClick:g[0]||(g[0]=H(m=>N(`/category?deliveryType=1&shopId=${p.order.stores.id}`),["stop"]))},[e("div",yt,[e("img",{src:p.order.stores.logo||r(rt),class:"flex-shrink-0 w-[24px] h-[24px] rounded-[4px] object-cover"},null,8,gt),e("div",wt,a(p.order.stores.storeName||"--"),1)])]),e("div",Et,a(r(Ze)(p.order)),1)]),(i(!0),d(te,null,se(p.order.orderGoods,m=>(i(),d("div",{class:"mt-4",key:m.goodsName},[e("div",null,[e("div",Bt,[b(v,{onClick:H(oe=>N(`/buyerOrderList/detail?id=${m.goodsId}`),["stop"]),src:(m.icons||"").split(",")[0],class:"shrink-0 w-20 h-20 overflow-hidden rounded-[8px]",alt:"",fit:"cover"},null,8,["onClick","src"]),e("div",Ft,[e("div",null,[e("div",kt,[e("div",Ct,[R(a(m.goodsName)+" ",1),m.creditFlag?(i(),d("div",$t,[Tt,R(" "+a(u.$t("order.Credit Collection")),1)])):S("",!0)])]),e("div",St,[e("span",null,a(u.$t("order.quantity",{number:m.number||0})),1),e("span",Rt,a(r(U)(m)),1)]),p.showPrice?(i(),d("div",It,[e("span",Dt,a(u.$t("common.total"))+"： ",1),e("div",At,[+p.order.paySource!==r(tt).USDT_WALLET?(i(),d("div",Lt,[Pt,e("span",null,a(F(m)),1)])):(i(),d("div",jt,[Nt,R(" "+a(I(m))+" ",1),e("span",Vt,[Ot,Ut,R(" "+a(F(m))+")",1)])]))])])):S("",!0)])])])])]))),128)),je(u.$slots,"default")])}}}),G=p=>(Ke("data-v-6e43e0a6"),p=p(),We(),p),zt={class:"px-3 pb-[100px] main-bg"},Mt={class:"header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md bg-[#FED73A]"},Ht={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Gt={class:"font-bold text-base text-b1"},Jt={class:"safe-bottom pt-[50px]"},Kt={class:"px-3 mt-3 bg-white rounded-xl font-semibold"},Wt=G(()=>e("p",{class:"shrink-0 text-b1 font-semibold text-sm"},"退款类型",-1)),Yt={class:"ml-auto flex items-center gap-0"},Qt={class:"text-b3 font-normal text-sm not-italic"},Xt={key:0,class:"line-clamp-1"},Zt={key:1},es=G(()=>e("img",{src:_e,class:"w-4 h-4"},null,-1)),ts={class:"shrink-0 text-b1 font-semibold text-sm"},ss={class:"ml-auto flex items-center gap-0"},os={class:"text-b3 font-normal text-sm not-italic"},as={key:0,class:"line-clamp-1"},ns={key:1},ls=G(()=>e("img",{src:_e,class:"w-4 h-4"},null,-1)),us={class:"px-3 py-4 mt-3 bg-white rounded-xl font-semibold min-h-[100px]"},is={class:"text-b1 text-sm font-semibold"},rs={class:"text-count"},ds={class:"text-sm text-b3 font-normal text-right"},cs={class:"van-uploader__wrapper gap-1.5 mt-2"},ps=["onClick"],ms={class:"van-image van-uploader__preview-image overflow-hidden",style:{width:"73px",height:"73px"}},fs=["src"],vs=["onClick"],hs=G(()=>e("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),_s=[hs],xs={class:"w-[73px] h-[73px] bg-transparent rounded-md border-b3 border-dashed border text-center flex flex-col justify-center items-center text-[#d9d9d9]"},bs=["src"],ys={class:"text-xs font-light text-center text-b3"},gs={class:"text-xxs font-light text-center text-b3"},ws={class:"fixed bottom-0 left-0 right-0 p-4 px-3 bg-transparent safe-bottom w-full"},Es={class:"mt-[16px] mb-[16px] text-center font-bold text-base"},Bs={class:"px-4 reason-list"},Fs=["onClick"],ks={class:"ml-auto"},Cs={src:xe,class:"w-5 h-5",alt:"已选"},$s={class:"text-center w-full p-4"},Ts={class:"mt-[16px] mb-[16px] text-center font-bold text-base bg-transparent"},Ss={class:"px-4 reason-list"},Rs=["onClick"],Is={class:"ml-auto"},Ds={src:xe,class:"w-5 h-5",alt:"已选"},As={class:"text-center w-full p-4"},Ls=fe({setup(p){const{loadingToggle:P}=at(),{senderProtest:J}=ot(),j=Oe(),y=ve(),{locale:K,t:N}=Ve(),U=j.query.id;j.query.role;const F=B({}),[I,u]=V(!0),[g,v]=V(!1),[m,oe]=V(!1);Ue({reasonList:[],checked:null});const s=B({type:null,typeId:null,reasonId:null,reason:null,content:"",pictures:[]}),ae=M(()=>s.value.type.optionType==3?"退货异常-":Y.value.orderStatus==1?"未收到货-":Y.value.orderStatus==2?"商家已发货-":""),ye=M(()=>!s.value.typeId||!s.value.reasonId),h=B([]),W=B(3),ge=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=Math.random()*16|0,l=t==="x"?o:o&3|8;return l.toString(16)}),we=t=>{let o=!1;const l=me.split(",");for(let f=0;f<l.length;f++)if((t==null?void 0:t.type)===l[f]){o=!0;break}return o||c(N("common.uploadImgTypeTips",{format:l.map(f=>f.slice(6)).join("/")})),o},Ee=async t=>{if(h.value.length>=W.value||!we(t.file))return;c.loading({message:N("common.uploading"),forbidClick:!0,duration:0});const o=await lt(t,"goodsImg"),l=await _t(o);c.clear(),l.success&&h.value.push({id:ge(),url:ut.imgUrl+l.data})},Be=t=>{h.value.splice(t,1)},Fe=t=>{Je({images:h.value.map(o=>o.url),startPosition:t})},ke=async()=>{const t=await pt({id:U});F.value=t.data,u(!1)},Ce=async()=>{try{v(!0);const t=await ct({orderIds:F.value.id+""}),o=t.data.ordIds&&t.data.ordIds[0];return await J(o)}catch(t){return c(t.message||t),!1}},$e=async()=>{var _,w;if(!s.value.typeId){c("请选择退款类型");return}if(!s.value.reasonId){c("请选择退款原因");return}if(!((_=s.value.type)!=null&&_.optionType)){c("退款类型错误，无法继续");return}let t=null,o=null,l=null,f=null,$=null;try{v(!0),$={imgs:h.value.length>0?h.value.map(x=>x.url).join(","):"",content:s.value.content||""},f={orderId:F.value.id,refundType:s.value.type.refundType,refundReasonId:s.value.reason.id,evidence:ze.isEmpty($)?null:JSON.stringify($)},t=F.value.creditFlag||null,o=s.value.type.optionType,l=s.value.type.refundType}catch(x){c(x.message||x)}finally{v(!1)}let A=!1;(o==2&&l==1||o==3)&&(A=!0);let T=null;if(o==3?T=mt:o==2?T=ft:o==1&&(T=vt),!T)return;let n=null;if(A&&(v(!0),n=await Ce(),!n.success)){v(!1);return}try{v(!0),n!=null&&n.success&&(f.hash=(w=n.result)==null?void 0:w.transactionHash);const{success:x}=await T(f);x||v(!1)}catch(x){c(x.message||x),v(!1)}Te()},Te=()=>{Se()},Se=()=>{s.value.type.optionType==3?(y.go(-3),setTimeout(()=>{y.push({path:"/sellerOrderList",query:{type:1,active:0}})},100)):s.value.type.optionType==2?(y.go(-1),setTimeout(()=>{y.replace("/refundList")},50)):(y.go(-3),setTimeout(()=>{y.push({path:"/buyerOrderList",query:{active:-1}})},100))},Y=B({orderStatus:null}),D=B([]),k=B(null),[Q,ne]=V(!1),Re=()=>{k.value=s.value.type,ne(!0)},Ie=()=>{ne(!1)},le=t=>{if(!t||!t.id){c("请选择退款类型");return}k.value=t},ue=(t=!0)=>{if(!k.value){c("请选择退款类型");return}s.value.type=k.value,s.value.typeId=k.value.id,s.value.reasonId=null,s.value.reason=null,C.value=null,q.value=D.value.find(l=>l.id===k.value.id).reasonList||[];const o=et(K.value)||"jtName";q.value.forEach(l=>{l.name=l[o]||l.jtName||"--"}),Ie(),t&&setTimeout(()=>{re()},200)},C=B(null),[X,ie]=V(!1),q=B([]),re=()=>{C.value=s.value.reason,ie(!0)},De=()=>{if(!C.value){c("请选择退款原因");return}s.value.reason=C.value,s.value.reasonId=C.value.id,ie(!1)},Ae=t=>{C.value=t},Le=()=>{const t=U||"";if(!t){c("缺少订单信息，无法获取售后业务！");return}ht(t).then(o=>{if(o.success){Y.value=o.data||{};const l=o.data.options||[];if(l.length<=0){c("暂无售后选项，请确认订单状态");return}let f=1;l.forEach($=>{$.id=f++}),D.value=l,D.value.length===1&&(le(D.value[0]),ue(!1))}else c("获取售后类型失败")}).catch(o=>{})},Pe=async()=>{P(!0),await ke(),await Le(),P(!1)};return he(async()=>{await Pe()}),(t,o)=>{const l=L("van-skeleton"),f=L("van-uploader"),$=L("VanButton"),A=L("Empty"),T=L("VanPopup");return i(),d("div",zt,[e("section",Mt,[e("div",Ht,[b(Ye)]),e("div",Gt,a(t.$t("order.deliver")),1)]),e("section",Jt,[b(l,{title:"",row:3,loading:r(I),round:"",class:"p-3 mt-3 bg-white rounded-xl"},{default:E(()=>[F.value?(i(),O(qt,{key:0,class:"!mt-0",order:F.value,showShippingTemplate:""},null,8,["order"])):S("",!0)]),_:1},8,["loading"]),e("section",Kt,[b(l,{title:"",row:1,loading:r(I),round:"",class:"p-1"},{default:E(()=>[e("div",{class:"cell-item flex items-center justify-start gap-2",onClick:Re},[Wt,e("span",Yt,[e("span",Qt,[s.value.typeId?(i(),d("span",Xt,a(s.value.type.optionTitle||"--"),1)):(i(),d("span",Zt,a(t.$t("shop.pleaseSelect")),1))]),es])]),s.value.typeId?(i(),d("div",{key:0,class:"cell-item flex items-center justify-start gap-2",onClick:re},[e("p",ts,a(s.value.type.optionType==2||s.value.type.optionType==3?"平台介入原因":"退款原因"),1),e("span",ss,[e("span",os,[s.value.reasonId?(i(),d("span",as,a(r(ae))+" "+a(s.value.reason.name),1)):(i(),d("span",ns,a(t.$t("shop.pleaseSelect")),1))]),ls])])):S("",!0)]),_:1},8,["loading"])]),b(qe,{name:"appeal-fade"},{default:E(()=>[z(e("section",us,[e("p",is,a(t.$t("order.appeal content")),1),z(e("textarea",{"onUpdate:modelValue":o[0]||(o[0]=n=>s.value.content=n),placeholder:"输入凭证有利于平台与商家更好处理售后问题",maxlength:150,class:"w-full h-full bg-transparent min-h-[60px] text-sm font-normal resize-none mt-2"},null,512),[[Me,s.value.content,void 0,{trim:!0}]]),e("div",rs,[e("div",ds,a(s.value.content?s.value.content.length:0)+" / 150 ",1)]),e("div",cs,[b(r(He),Ge({class:"flex flex-wrap gap-1.5 h-[73px]",modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=n=>h.value=n),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:E(({element:n,index:_})=>[e("div",{class:"van-uploader__preview overflow-hidden",onClick:H(w=>Fe(_),["stop"])},[e("div",ms,[e("img",{src:n.url,class:"van-image__img rounded-md",style:{"object-fit":"cover"}},null,8,fs)]),e("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"Delete",onClick:H(w=>Be(_),["stop"])},_s,8,vs)],8,ps)]),_:1},16,["modelValue","handle"]),h.value&&h.value.length<W.value?(i(),O(f,{key:0,accept:r(me),afterRead:Ee},{default:E(()=>[e("div",xs,[e("img",{src:r(nt)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,bs),e("div",ys,a(t.$t("common.add img")),1),e("div",gs,a(h.value.length+1)+" / "+a(W.value),1)])]),_:1},8,["accept"])):S("",!0)])],512),[[ee,s.value.typeId&&s.value.reasonId&&s.value.type.optionType!=1]])]),_:1}),e("div",ws,[b($,{loading:r(g),disabled:r(ye),class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:$e},{default:E(()=>[R(a(t.$t("ecology.submitApplication")),1)]),_:1},8,["loading","disabled"])])]),b(T,{show:r(Q),"onUpdate:show":o[2]||(o[2]=n=>de(Q)?Q.value=n:null),round:"",position:"bottom",closeable:"",style:{height:"auto",maxHeight:"80%"}},{default:E(()=>[e("div",Es,a(t.$t("refund.select refund type")),1),e("div",Bs,[D.value.length===0&&!r(I)?(i(),O(A,{key:0,name:"无可选退款类型"})):S("",!0),(i(!0),d(te,null,se(D.value,n=>{var _,w;return i(),d("div",{key:n.id,class:"select-item w-full h-[52px] border-b border-[#D9D9D9] flex items-center justify-start font-normal :last:border-b-0",onClick:x=>le(n)},[e("div",{class:ce(["text-sm flex items-center whitespace-pre-wrap",[((_=k.value)==null?void 0:_.id)==n.id?"text-[#FF8812] font-semibold":"text-b1 font-normal"]])},[e("span",null,a(n.optionTitle),1)],2),e("div",ks,[z(e("img",Cs,null,512),[[ee,((w=k.value)==null?void 0:w.id)==n.id]])])],8,Fs)}),128))]),e("div",$s,[b($,{loading:r(g),disabled:!k.value,class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:ue},{default:E(()=>[R(a(t.$t("common.next step")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),b(T,{show:r(X),"onUpdate:show":o[3]||(o[3]=n=>de(X)?X.value=n:null),round:"",position:"bottom",closeable:!0,style:{height:"auto",maxHeight:"80%"}},{default:E(()=>[e("div",Ts,a(s.value.type.optionType==2||s.value.type.optionType==3?"选择平台介入原因":"选择退款原因"),1),e("div",Ss,[q.value.length===0&&!r(I)?(i(),O(A,{key:0,name:"无可选退款原因"})):S("",!0),(i(!0),d(te,null,se(q.value,n=>{var _,w;return i(),d("div",{key:n.id,class:"select-item w-full h-[52px] border-b border-[#D9D9D9] flex items-center justify-start font-normal :last:border-b-0",onClick:x=>Ae(n)},[e("div",{class:ce(["text-sm flex items-center whitespace-pre-wrap",[((_=C.value)==null?void 0:_.id)==n.id?"text-[#FF8812] font-semibold":"text-b1 font-normal"]])},[e("span",null,a(r(ae))+a(n.name),1)],2),e("div",Is,[z(e("img",Ds,null,512),[[ee,((w=C.value)==null?void 0:w.id)==n.id]])])],8,Rs)}),128))]),e("div",As,[b($,{loading:r(g),disabled:!C.value,class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:De},{default:E(()=>[R(a(t.$t("common.confirm")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"]),r(m)?(i(),O(dt,{key:0,onClose:o[4]||(o[4]=n=>r(oe)(!1)),text:t.$t("shop.shippingTemplate.submitSuccess")},null,8,["text"])):S("",!0)])}}}),eo=Ne(Ls,[["__scopeId","data-v-6e43e0a6"]]);export{eo as default};
