import{_ as $,y as b,l as A,a1 as V,r as g,x as C,E as y,F as f,G as u,H as o,a4 as P,K as F,P as x,Q as k,Y as N,Z as B,w as j,N as M,J as L,I as S,D,O as h,R as z,U,V as q,X as R,z as G}from"./vendor-BUT0HZ5j.js";import{_ as H}from"./down-arrow-Ba_kjgtn.js";import{e as T,V as O,al as W}from"./index-hbwLMIYO.js";import{_ as J}from"./avatarRing-DpEnkbQ2.js";import{_ as K}from"./NoteList-DQ9QLTK3.js";import{R as Q}from"./ReleaseNotes-DrnmgWQH.js";import{u as X}from"./useCityMap-fPla5ZMg.js";import"./WaterFull-CDtRtt9C.js";const Y="/Test-dev/static/images/demo-bg-DyaCmFCf.png",Z="/Test-dev/static/images/search-ClCpHcy8.svg",E=t=>(N("data-v-49abc4ac"),t=t(),B(),t),ee={class:"w-full px-3 py-4 bg-transparent font-Puhui flex flex-row justify-between items-center gap-3"},te=["onClick"],se={class:"text-sm text-b2 font-normal min-w-[28px] max-w-[56px]"},ae={key:1,class:"line-clamp-1"},oe=E(()=>o("img",{src:H,class:"w-[9px] h-auto"},null,-1)),ce=E(()=>o("div",{class:"divider mx-2 ml-3"},null,-1)),ne={class:"search-box flex items-center justify-start gap-1"},re=E(()=>o("img",{src:Z,class:"w-4 h-4"},null,-1)),le={class:"text-sm text-b3 font-normal w-full"},ie=b({setup(t){const{cityMapStore:s}=T(),c=A(),v=V(),n=g(20);C(()=>{const r=n.value;return r===0?0:r>99?"99+":r});const d=()=>{c.push("/city/search")},p=()=>{c.push({path:"/city/selectArea",query:{mode:"change",from:encodeURIComponent(v.path)}})},a=C(()=>s.currentActiveCity||{});return(r,l)=>{const _=y("van-loading");return u(),f("div",ee,[o("div",{class:"w-full h-[36px] bg-b5 rounded-3xl flex items-center justify-start px-3 border-solid border-[1px] border-[#F1A840]",onClick:d},[o("div",{class:"city-selector flex items-center justify-start gap-1",onClick:P(p,["stop"])},[o("p",se,[x(a).areaName?(u(),f("span",ae,k(x(a).areaName),1)):(u(),F(_,{key:0,size:"14"}))]),oe],8,te),ce,o("div",ne,[re,o("p",le,k(r.$t("offline.store_search")),1)])])])}}}),ue=$(ie,[["__scopeId","data-v-49abc4ac"]]),de={class:"w-full h-full pt-[20px] pb-[22px] px-[0] flex flex-wrap"},pe=["onClick"],_e=["src","alt"],me={class:"mt-[4px] font-base text-[#2E2008] font-Puhui text-center no-wrap"},fe=b({props:{categoryList:{type:Array,default:()=>[]}},emits:["handleMenu"],setup(t,{emit:s}){const c=t,{t:v}=j(),n=C(()=>c.categoryList||[]),d=p=>{s("handleMenu",p)};return(p,a)=>{const r=y("van-swipe-item"),l=y("van-swipe");return u(),F(l,{class:"font-Puhui"},{default:M(()=>[(u(!0),f(S,null,L(Math.ceil(x(n).length/5),(_,m)=>(u(),F(r,{key:m},{default:M(()=>[o("div",de,[(u(!0),f(S,null,L(x(n).slice(m*5,(m+1)*5),(e,i)=>(u(),f("div",{class:"relative w-[20%] flex flex-col items-center",key:m+":"+i,onClick:w=>d(e)},[o("img",{class:"shrink-0 w-[40px] h-[40px]",src:e.goodsCategoryIcon||x(J),alt:e.goodsCategoryName+"的分类"},null,8,_e),o("div",me,k(e.goodsCategoryName),1)],8,pe))),128))])]),_:2},1024))),128))]),_:1})}}}),ve=$(fe,[["__scopeId","data-v-3f254d00"]]),he=t=>(N("data-v-2323856e"),t=t(),B(),t),ge={class:"w-full h-full min-h-[70vh]"},xe=he(()=>o("div",{class:"header-bg mb-[-100px]"},null,-1)),ye={class:"flex items-center gap-[20px]"},be=["onClick"],we={class:"px-3 pb-3"},Ie=b({setup(t){var r;const{cityMapStore:s}=T(),c=g(!1),v=l=>{c.value=l},n=g([{label:"广场",value:"all",params:{releaseFlag:!0}},{label:"附近",value:"area",params:{areaId:((r=s==null?void 0:s.currentActiveCity)==null?void 0:r.areaId)||"",overseasFlag:s.selectedCountry!=="cn",releaseFlag:!0}}]),d=g(n.value[0].label),p=g(n.value[0].params),a=l=>{d.value=l.value,p.value=l.params};return D(()=>{a(n.value[0])}),(l,_)=>{const m=y("van-sticky");return u(),f("div",ge,[xe,h(m,{zIndex:"49","offset-top":0,onChange:_[0]||(_[0]=e=>v(e))},{default:M(()=>[o("div",{class:z(["w-full h-fit px-3 pt-3 pb-2",{"bg-[#fff]":c.value}])},[o("div",ye,[(u(!0),f(S,null,L(n.value,e=>(u(),f("div",{class:z(["text-sm text-[#585654] font-Puhui",d.value===e.value?"item-active-bg ":""]),key:e.value,onClick:P(i=>a(e),["stop"])},k(e.label),11,be))),128))])],2)]),_:1}),o("div",we,[h(K,{params:p.value,toDetailLink:"/city/cityMap/noteDetail"},null,8,["params"])])])}}}),$e=$(Ie,[["__scopeId","data-v-2323856e"]]),Ce=b({props:{topId:{default:"fm-page"},svg:{default:"cityMap/backTop.svg"},size:{default:50},msize:{default:24},right:{default:16},bottom:{default:16},bg:{default:"#FFF"}},setup(t){const s=t;A();const c=g(null),{width:v,height:n}=U(),{style:d}=q(c,{initialValue:{x:v.value-(s.right+s.size),y:n.value-(s.bottom+s.size)},onMove:a=>{a.x>s.right&&(a.x=v.value-(s.right+s.size)),a.x<s.right&&(a.x=s.right),a.y>n.value-s.size&&(a.y=n.value-s.size),a.y<0&&(a.y=0)}}),p=()=>{const a=document.querySelector("#"+s.topId);a&&setTimeout(()=>{a.scrollTo({top:0})},50)};return D(()=>{}),(a,r)=>{const l=y("VanImage");return u(),f("div",{ref:(_,m)=>{m.el=_,c.value=_},style:R([x(d),{"touch-action":"none"}]),onClick:p,class:z(["fixed z-[49] flex items-center justify-center rounded-full shadow-[0_1px_16px_0_rgba(0,0,0,0.16)] cursor-pointer",`w-[${t.size}px] h-[${t.size}px] bg-[${t.bg}]`])},[h(l,{src:x(O)(t.svg),class:z(["overflow-hidden",`w-[${t.msize}px] h-[${t.msize}px]`]),alt:""},null,8,["src","class"])],6)}}}),ke=$(Ce,[["__scopeId","data-v-97ea034e"]]),ze=t=>(N("data-v-0d8142a3"),t=t(),B(),t),Fe={class:"app-container"},Me=ze(()=>o("div",{class:"linear__wrap absolute bottom-[-1px] w-full left-0 h-[72px]"},null,-1)),Le={class:"tab__wrap mt-[-36px] h-fit"},Se={class:"recommend-wall__wrap w-full bg-[#F2F0EF]"},Ae=b({name:"CityMap"});function Ne(t){const s=A(),{cityMapStore:c}=T(),{getUserLocation:v}=X(),n=C(()=>{var I;const e=((I=c.currentActiveCity)==null?void 0:I.areaIcon)||null;return{backgroundImage:`url(${e||Y})`}||{}}),d=g(!1),p=g(""),a=async()=>{try{d.value=!0,p.value="",await v()}catch{}finally{d.value=!1}},r=g([]),l=async()=>{var I;const e={areaIdPreviousLastLeaf:(I=c.currentActiveCity)==null?void 0:I.areaId,overseasFlag:c.selectedCountry!=="cn"},{success:i,data:w}=await W(e);i&&(r.value=w||[])};G(c.currentActiveCity,(e,i)=>{console.log("已选城市发生改变",{newCity:e==null?void 0:e.areaName,oldCity:i==null?void 0:i.areaName,hasAreaId:!!(e!=null&&e.areaId)}),e!=null&&e.areaId&&l()},{immediate:!0,deep:!0});const _=()=>{const e=setInterval(()=>{var i;(i=c.currentActiveCity)!=null&&i.areaId&&(l(),clearInterval(e))},500)},m=e=>{console.log(e),s.push({path:"/city/poi",query:{categoryId:e.goodsCategoryId}})};return D(async()=>{await c.init(),await a(),_(),document.addEventListener("visibilitychange",async function(){document.hidden?console.log("cityMap hidden"):(console.log("cityMap show"),await a())})}),(e,i)=>{const w=y("router-view");return u(),f("div",Fe,[o("div",{class:"header__wrap relative",style:R(x(n))},[h(ue),Me],4),o("div",Le,[h(ve,{onHandleMenu:m,categoryList:r.value},null,8,["categoryList"])]),o("div",Se,[h($e)]),h(Q,{svg:"cityMap/releaseNote-white-fill.svg",size:40,msize:20,bottom:144}),h(ke,{size:40,msize:20,bottom:92}),h(w,{class:"child-view"})])}}const Be=b({...Ae,setup:Ne}),qe=$(Be,[["__scopeId","data-v-0d8142a3"]]);export{qe as default};
