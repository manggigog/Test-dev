import{w as Z,F as c,G as n,H as e,Q as o,a2 as u,P as s,a0 as $,E as ve,O as x,N as B,_ as pe,y as ee,l as be,a1 as ge,r as g,be as p,x as z,D as ye,K as T,I as Ce,T as b}from"./vendor-BUT0HZ5j.js";import{_ as we}from"./OfflineGoods-BjltvH3M.js";import{_ as Se}from"./OfflineStore-CFe1JKHJ.js";import{a as ke,_ as Te,O as $e}from"./OrderCancelSelectorPop-BgEL31kE.js";import{_ as M}from"./MCOIN-BcbOHmhy.js";import{_ as Ee}from"./link-BVzz25qg.js";import{_ as te}from"./copy-w-7FY5xbhR.js";import{d as N,q as Oe,b as W,h as X,l as j,R as De,o as Le,e as Ae,C as Re,bI as Pe,bJ as Ie}from"./index-hbwLMIYO.js";import{a as m,o as Ne}from"./offlineGoods-DvT2Go6q.js";import{C as je}from"./CommonVanProvider-BpsZUrD3.js";import{_ as Be}from"./EmptyTipsPop-_FH8A6A8.js";import"./ImgBoutiqueLable-BF5Xoxsv.js";import"./shop-CeqcS6K2.js";import"./BackIcon-biFt6cm7.js";const Me={class:"p-3 break-all bg-white rounded-xl"},qe={class:"title text-b1 text-sm font-semibold"},Ve={class:"content"},Fe={class:"flex justify-between items-center mt-[16px]"},He={class:"text-b3 text-sm font-normal"},Ke={class:"text-b1 text-sm font-normal text-right"},Ye={class:"flex justify-start items-center"},Ge=e("img",{class:"w-[17px] h-[17px] flex-shrink-0",src:M},null,-1),Ue={class:"text-b1 text-sm font-normal ml-1"},Je={key:0,class:"flex justify-between items-center mt-[16px]"},Qe={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},ze={class:"text-b1 text-sm font-normal text-right"},We={class:"flex justify-start items-center"},Xe=e("span",{class:"text-b1 text-sm font-normal"}," - ",-1),Ze=e("img",{class:"w-[17px] h-[17px] ml-1",src:M},null,-1),et={class:"text-b1 text-sm font-normal ml-1"},tt={class:"flex justify-between items-center mt-[16px]"},st={class:"text-b3 text-sm font-normal"},ot={class:"text-b1 text-sm font-normal text-right"},rt={class:"flex justify-start items-center"},nt=e("img",{class:"w-[17px] h-[17px]",src:M},null,-1),at={class:"text-b1 text-sm font-normal ml-1"},lt={class:"flex justify-between items-center mt-[16px]"},it={class:"text-b3 text-sm font-normal"},ct={class:"text-b1 text-sm font-normal text-right"},dt={class:"flex justify-between items-center mt-[16px]"},mt={class:"text-b3 text-sm font-normal"},ut=["href"],ft=e("img",{src:Ee,class:"w-5 h-5 ml-1",alt:""},null,-1),ht={key:1},xt={class:"flex justify-between items-center mt-[16px]"},_t={class:"text-b3 text-sm font-normal"},vt=e("img",{src:te,class:"w-5 h-5 ml-1",alt:""},null,-1),pt={key:1,class:"flex justify-between items-center mt-[16px]"},bt={class:"text-b3 text-sm font-normal"},gt={class:"text-b1 text-sm font-normal text-right"},yt={key:2,class:"flex justify-between items-center mt-[16px]"},Ct={class:"text-b3 text-sm font-normal"},wt={class:"text-b1 text-sm font-normal text-right"},St={key:3,class:"flex justify-between items-center mt-[16px]"},kt={class:"text-b3 text-sm font-normal"},Tt={key:0},$t={key:1},Et={class:"text-b1 text-sm font-normal text-right"},Ot={key:4,class:"flex justify-between items-center mt-[16px]"},Dt={class:"text-b3 text-sm font-normal"},Lt={class:"text-b1 text-sm font-normal text-right"},At={class:"flex justify-between items-center mt-[16px]"},Rt={class:"text-b3 text-sm font-normal whitespace-nowrap"},Pt={class:"text-b1 text-sm font-normal text-right flex items-center"},It={class:"break-all flex-1"},Nt=e("img",{src:te,class:"w-5 h-5",alt:""},null,-1),jt=[Nt],Bt={props:{order:{type:Object,required:!0,default:()=>({})}},setup(t){const{t:a}=Z();return(l,f)=>{var _;return n(),c("div",Me,[e("div",qe,o(l.$t("order.orderInfo")),1),e("div",Ve,[e("div",Fe,[e("div",He,o(l.$t("office.server price")),1),e("div",Ke,[e("p",Ye,[Ge,e("span",Ue,o(s(N)(t.order.orderTotalAmount)),1)])])]),t.order.actAmount?(n(),c("div",Je,[e("div",Qe,o(((_=t.order.fmGeneralActivity)==null?void 0:_.name)||"-"),1),e("div",ze,[e("p",We,[Xe,Ze,e("span",et,o(s(N)(t.order.actAmount)),1)])])])):u("",!0),e("div",tt,[e("div",st,o(l.$t("order.total price actual")),1),e("div",ot,[e("p",rt,[nt,e("span",at,o(s(N)(t.order.orderRealAmount)),1)])])]),e("div",lt,[e("div",it,o(l.$t("common.ratio")),1),e("div",ct,o(t.order.orderDiscountRatio)+"% ",1)]),e("div",dt,[e("div",mt,o(l.$t("order.hash")),1),t.order.orderTransactionHash?(n(),c("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${s(Oe).chainConfig.blockExplorerUrls[0]}/tx/${t.order.orderTransactionHash}`},[$(o(s(W)(t.order.orderTransactionHash,"***",9,5)||"--")+" ",1),ft],8,ut)):(n(),c("span",ht," -- "))]),e("div",xt,[e("div",_t,o(l.$t("offline.create address")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:f[0]||(f[0]=y=>s(X)(t.order.orderPayAddress))},[$(o(s(W)(t.order.orderPayAddress,"...",5,5))+" ",1),vt])]),t.order.createTime?(n(),c("div",pt,[e("div",bt,o(l.$t("order.createTime")),1),e("div",gt,o(s(j)(t.order.createTime)),1)])):u("",!0),t.order.payTime?(n(),c("div",yt,[e("div",Ct,o(l.$t("order.chainFinishTime")),1),e("div",wt,o(s(j)(t.order.payTime)),1)])):u("",!0),t.order.finishTime?(n(),c("div",St,[e("div",kt,[t.order.orderStatus===s(m).CANCELLED?(n(),c("span",Tt,o(l.$t("offline.cancel_time")),1)):(n(),c("span",$t,o(l.$t("order.finishTime")),1))]),e("div",Et,o(s(j)(t.order.finishTime)),1)])):u("",!0),t.order.orderStatus===s(m).CANCELLED?(n(),c("div",Ot,[e("div",Dt,o(l.$t("offline.cancel_reason")),1),e("div",Lt,o(t.order.cancelReason||"--"),1)])):u("",!0),e("div",At,[e("div",Rt,o(l.$t("order.orderNumber")),1),e("div",Pt,[e("div",It,o(t.order.orderId||"--"),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:f[1]||(f[1]=y=>s(X)(t.order.orderId))},jt)])])])])}}},Mt={class:"flex justify-between items-center gap-3 fixed bottom-0 left-0 right-0 px-3 pb-4"},qt={key:0,class:"relative w-full"},Vt={key:1,class:"relative w-full"},Ft={props:{order:{type:Object,default:()=>({})},cancelLoading:{type:Boolean,default:!1},deliverLoading:{type:Boolean,default:!1}},emits:["handleCancel","handleDeliver"],setup(t,{emit:a}){const l=()=>{a("handleCancel")},f=()=>{a("handleDeliver")};return(_,y)=>{const C=ve("VanButton");return n(),c("div",Mt,[t.order.orderStatus===s(m).PAYMENT_SUCCESS?(n(),c("div",qt,[x(C,{round:"",class:"w-full gray-btn border-btn font-normal text-base h-[46px] rounded-full",onClick:l,loading:t.cancelLoading,disabled:t.deliverLoading},{default:B(()=>[$(o(_.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"])])):u("",!0),t.order.orderStatus===s(m).PAYMENT_SUCCESS?(n(),c("div",Vt,[x(C,{round:"",class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:f,loading:t.deliverLoading,disabled:t.cancelLoading},{default:B(()=>[$(o(_.$t("order.Ship")),1)]),_:1},8,["loading","disabled"])])):u("",!0)])}}},Ht={class:"px-3 pb-20 flex flex-col gap-3 safe-body overflow-y-auto"},Kt={class:"w-full p-3 rounded-xl bg-white font-Puhui"},Yt=ee({name:"offlineMerchantDetail"});function Gt(t){var J;const{t:a}=Z(),l=be(),f=ge(),{getMerchantDhKey:_,decryptKey:y}=De(),{offlineMerchantCancel:C,offlineMerchantConfirm:se}=Le(),oe={[m.PAYMENT_FAILED]:a("order.fail"),[m.PAYING]:a("order.paying"),[m.PAYMENT_SUCCESS]:a("order.wait"),[m.CANCELLED]:a("order.canceled"),[m.COMPLETED]:a("order.completed"),[m.CLOSED]:a("order.closed")},r=g({orderRemark:""}),[q,V]=p(!1),[re,w]=p(!1),[ne,F]=p(!1),{accountStore:E,clerkStore:S}=Ae(),[ae,O]=p(!1),D=g("发货成功"),L=g(!1),A=g(((J=f.query)==null?void 0:J.id)||""),H=async()=>new Promise(async d=>{var h,v,Q;V(!0);const i=await Pe({id:A.value});if(V(!1),d(!0),b.clear(),!!i.success&&(r.value=i.data||{},(h=i.data)!=null&&h.orderCustomerAddress&&(v=i.data)!=null&&v.orderRemark&&(Q=i.data)!=null&&Q.orderSubmitCustomerPubKey))try{const k=await _(i.data.merchantAddress,i.data.orderSubmitCustomerPubKey);if(k){const _e=y(i.data.orderRemark,k);r.value.orderRemark=_e.decrypt}}catch(k){console.error("解密失败:",k)}}),K=async()=>{H()},Y=z(()=>Ne(r.value.orderType)),le=z(()=>oe[r.value.orderStatus]||"--"),R=g(null),[ie,P]=p(!1),ce=()=>{if(E.isOnlyView)return b(a("order.Requires merchant account operation"));if(S.isClerk&&!S.clerkAuth)return b(a("order.Requires merchant account operation"));(r.value.orderStatus||null)===m.PAYMENT_SUCCESS?P(!0):b(a("offline.order status does not support cancel"))},de=d=>{R.value=d,console.log("cancelReason",R.value),P(!1),fe()},[me,I]=p(!1),ue=a("offline.cancel important msg"),fe=()=>{I(!0)},G=()=>{I(!1)},he=async()=>{I(!1);const d={orderId:r.value.orderId,cancelReason:R.value.value||"其他",cancelSource:0};w(!0);const i=await Ie(d);if(w(!1),!i.success)return;const h=[r.value.chainOrderId];w(!0);const v=await C(h);w(!1),v.success&&(K(),L.value=!1,D.value=a("offline.successful of cancel "),O(!0),sessionStorage.setItem("merchant_offline_refresh_chainOrderId",A.value.toString()),l.go(-1))},U=async()=>{if(E.isOnlyView)return b(a("order.Requires merchant account operation"));if(S.isClerk&&!S.clerkAuth)return b(a("order.Requires merchant account operation"));const d=[r.value.chainOrderId];F(!0);const i=await se(d);F(!1),i.success&&(K(),L.value=!1,D.value="发货成功",O(!0),sessionStorage.setItem("merchant_offline_refresh_chainOrderId",A.value.toString()),setTimeout(()=>{l.go(-1)},1950))},xe=()=>{f.query.quick==="deliver"&&U()};return ye(async()=>{await H(),xe()}),(d,i)=>(n(),c(Ce,null,[x(je,{title:d.$t("order.orderDetail"),class:"font-Puhui font-normal relative app-container main-bg","theme-vars":{"field-placeholder-text-color":"#A6A6A6",navBarBackgroundColor:"transparent"},ref:(h,v)=>{v.EvaluateDetailRef=h}},{default:B(()=>[e("section",Ht,[x(ke,{order:r.value,isBuyer:""},null,8,["order"]),e("div",Kt,[x(Se,{status:s(le),"show-order-status":"",store:{images:r.value.shopPics,name:r.value.shopName},loading:s(q)},null,8,["status","store","loading"]),s(Y).GOODS?(n(),T(we,{key:0,class:"mt-3",showNum:"",goods:{goodsName:r.value.relName||"-",goodsIcons:r.value.relIcons,goodsPrice:r.value.relPrice||0,goodsNumber:r.value.relNumber||0}},null,8,["goods"])):s(Y).STORE?(n(),T(Te,{key:1,price:r.value.relPrice,loading:s(q)},null,8,["price","loading"])):u("",!0)]),x(Bt,{order:r.value},null,8,["order"]),s(E).isOnlyView?u("",!0):(n(),T(Ft,{key:0,order:r.value,cancelLoading:s(re),deliverLoading:s(ne),onHandleCancel:ce,onHandleDeliver:U},null,8,["order","cancelLoading","deliverLoading"]))])]),_:1},8,["title"]),x($e,{show:s(ie),onClose:i[0]||(i[0]=h=>s(P)(!1)),onSelected:de},null,8,["show"]),x(Re,{show:s(me),title:d.$t("common.tip"),content:s(ue),showConfirm:!0,showReject:!0,confirmText:d.$t("common.confirm"),noClose:"",onClose:G,onConfirm:he,onReject:G},null,8,["show","title","content","confirmText"]),s(ae)?(n(),T(Be,{key:0,onClose:i[1]||(i[1]=h=>s(O)(!1)),text:D.value,isError:L.value},null,8,["text","isError"])):u("",!0)],64))}const Ut=ee({...Yt,setup:Gt}),is=pe(Ut,[["__scopeId","data-v-59cc4ca5"]]);export{is as default};
