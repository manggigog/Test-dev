import{_ as R,z as M,x as te,y as P,r as h,F,G as E,H as T,I as e,O as o,Q as a,a4 as x,V as be,Z as I,U as K,$ as g,P as y,bB as ee,K as X,N as O,J as Z,a0 as Q,X as Se,Y as _e,bl as ae,E as ye,B as Te,a2 as G,q as $e}from"./vendor-Dr_RpJ_Y.js";import{r as V,bk as xe,k as Ce,y as se,Y as ke,u as Be,a as Fe,bl as De,br as Ie}from"./index-CU2nzZe6.js";import{l as oe}from"./luckyShopContract-DunEf0Vg.js";import{B as Le}from"./BackIcon-CDrGaEPo.js";const Ne={class:"bg-white px-2.5 pt-2.5 rounded-xl text-sm text-[#2E2008] mb-4"},Pe={class:"flex"},Ee=["src"],Ve={class:"flex flex-col justify-between",style:{width:"calc(100% - 5.625rem)"}},Ue={class:"w-full"},Ae={class:"w-full font-semibold truncate"},Re={class:"mt-1 opacity-60"},Me={class:"opacity-60"},ze={class:"py-4 border-b-box"},He={class:"opacity-60"},qe={class:"mt-1"},Ge={class:"flex items-center justify-between py-4"},je={class:"text-xs opacity-60"},Ye=M({props:{data:null,loading:{type:Boolean},systemTime:null},emits:["cancleHandle","refund","handleTo"],setup(s,{emit:u}){const r=s,{t:n}=te(),w=P(()=>V(r.data.startTime)),m=P(()=>V(r.data.endTime)),b=P(()=>V(r.data.createTime)),C=h({toBeDrawn:"#FB1A18",success:"#009536",error:"#FB1A18",notStarted:"#FB9318",processing:"#84C61A",cancel:"#A7A7A7"}),k=P(()=>({toBeDrawn:n("flashSale.Tobedrawn"),success:n("flashSale.goodsuceess"),error:n("flashSale.gooderror"),notStarted:n("flashSale.notStart"),processing:n("flashSale.progressing"),cancel:n("flashSale.Cancelled")})),$=P(()=>{const l=r.data;let v="processing";switch(l.status){case 10:{const d=+l.endTime,i=+l.startTime,D=xe(r.systemTime)*1e3,L=d-D,c=D-i;L<0?v="error":c<0&&(v="notStarted");break}case 15:v="toBeDrawn";break;case 20:case 30:case 40:case 50:case 200:case 300:v="success";break;case 400:v="cancel";break;case 500:v="error";break}return v}),f=()=>{u("cancleHandle",r.data)},N=()=>{u("refund",r.data)};return(l,v)=>{const d=F("van-button");return T(),E("div",Ne,[e("div",Pe,[e("div",{onClick:v[0]||(v[0]=()=>{u("handleTo",`/saleGoodDetail?id=${s.data.id}`)})},[e("img",{class:"w-20 h-20 rounded-xl mr-2.5 object-cover",src:s.data.mainImageUrls||o(Ce)("images/goods/defaultImg.png"),alt:"",srcset:""},null,8,Ee)]),e("div",Ve,[e("div",Ue,[e("div",Ae,a(s.data.title),1),e("div",Re,[x(a(l.$t("flashSale.status")),1),e("span",{style:be(`color: ${C.value[o($)]};`)},a(o(k)[o($)]),5)])]),e("div",Me,a(l.$t("flashSale.UnitandTotalPrice"))+a(s.data.price)+"/"+a(s.data.totalPrice),1)])]),e("div",ze,[e("div",He,a(l.$t("flashSale.activityTime")),1),e("div",qe,a(o(w))+" - "+a(o(m)),1)]),e("div",Ge,[e("div",je,a(l.$t("flashSale.participationtime"))+a(o(b)),1),o($)=="notStarted"?(T(),I(d,{key:0,loading:s.loading,"loading-text":l.$t("common.cancel"),class:"rounded-md h-7 leading-7 px-4 bg-[#fed1d1] text-[#FB1A18] font-medium",onClick:f},{default:g(()=>[x(a(l.$t("common.cancel")),1)]),_:1},8,["loading","loading-text"])):K("",!0),o($)=="error"&&s.data.status==10?(T(),I(d,{key:1,loading:s.loading,"loading-text":l.$t("flashSale.refund"),class:"rounded-md h-7 leading-7 px-4 bg-[#FB1A18] text-white font-medium",onClick:N},{default:g(()=>[x(a(l.$t("flashSale.refund")),1)]),_:1},8,["loading","loading-text"])):K("",!0),o($)=="error"&&s.data.status==500?(T(),I(d,{key:2,loading:s.loading,"loading-text":l.$t("flashSale.refund"),class:"rounded-md h-7 leading-7 px-4 bg-[#D9D9D9] text-[#fff] font-medium"},{default:g(()=>[x(a(l.$t("flashSale.refund")),1)]),_:1},8,["loading","loading-text"])):K("",!0)])])}}}),Je=R(Ye,[["__scopeId","data-v-50f00116"]]),Ke={class:"py-8 text-base text-center text-black"},Oe={class:"font-semibold"},Qe={class:"flex"},Xe=M({props:{show:{type:Boolean},goodName:null},emits:["close","confirm"],setup(s,{emit:u}){const r=()=>{u("confirm"),u("close")};return(n,w)=>{const m=F("van-button");return T(),I(se,{width:"90%",show:s.show,name:n.$t("refund.Apply"),onClose:w[1]||(w[1]=()=>{u("close")})},{default:g(()=>[e("div",Ke,[x(a(n.$t("flashSale.cancelTip1"))+" ",1),e("span",Oe,a(s.goodName),1),x(" "+a(n.$t("flashSale.cancelTip2")),1)]),e("div",Qe,[y(m,{class:"plain-btn w-1/2 mx-2.5 text-[#2E2008] font-semibold",onClick:w[0]||(w[0]=()=>{u("close")})},{default:g(()=>[x(a(n.$t("common.cancel")),1)]),_:1}),y(m,{class:"w-1/2 mx-2.5 btn-pink text-white font-semibold",onClick:r},{default:g(()=>[x(a(n.$t("common.confirm")),1)]),_:1})])]),_:1},8,["show","name"])}}}),Ze=R(Xe,[["__scopeId","data-v-da486850"]]),j=s=>(Se("data-v-7dcdab2e"),s=s(),_e(),s),We={class:"p-5 relative text-sm text-[#2E2008]"},et={class:"relative text-base font-semibold text-center"},tt=j(()=>e("span",null,"筛选",-1)),at=["src"],st={class:"mt-4"},ot=j(()=>e("div",{class:"font-bold text-black"},"状态",-1)),nt={class:"flex flex-wrap mt-4"},lt={class:"mt-2.5"},it=j(()=>e("div",{class:"font-bold text-black"},"参与时间",-1)),dt=j(()=>e("div",{class:"w-3 h-[2px] mx-3.5 bg-[#2E2008]"},null,-1)),ct=M({props:{show:{type:Boolean},tabList:null},emits:["close","confirm"],setup(s,{emit:u}){const[r,n]=ee(!1),[w,m]=ee(!1),b=h(),C=h(),k=h(new Date(2023,0,1)),$=h(),f=h({startTime:null,endTime:null}),N=()=>{n(!1),m(!1),(!f.value.startTime||!f.value.endTime)&&(f.value.endTime=null,f.value.startTime=null)},l=d=>{b.value=V(d),$.value=d,n(!1),m(!0)},v=d=>{C.value=V(d),f.value.startTime=b.value,f.value.endTime=V(d),m(!1)};return(d,i)=>{const D=F("van-datetime-picker"),L=F("van-popup");return T(),I(L,{class:"",round:"",show:s.show,"onUpdate:show":i[6]||(i[6]=c=>Q(show)?show.value=c:null),position:"bottom",onClose:i[7]||(i[7]=()=>{u("close")})},{default:g(()=>[e("div",We,[e("div",et,[tt,e("div",{class:"w-5 h-5 absolute right-[-0.625rem] top-1/2 translate-y-[-50%]",onClick:i[0]||(i[0]=()=>{u("close")})},[e("img",{class:"w-5 h-5",src:o(ke)("flashSale/close-icon.svg")},null,8,at)])]),e("div",st,[ot,e("div",nt,[(T(!0),E(Z,null,X(s.tabList,c=>(T(),E("div",{class:O(["rounded-md text-center py-2 px-3 bg-[#F5F5F5] mr-5 min-w-[4.125rem] mb-4 status",{"status-active":c.value==1}]),key:c.value},a(c.title),3))),128))])]),e("div",lt,[it,e("div",{class:"flex items-center mt-4",onClick:i[1]||(i[1]=c=>o(n)(!0))},[e("div",{class:O(["flex-1 py-1.5 bg-[#F5F5F5] rounded-md text-center",{"text-xs":f.value.startTime}])},a(f.value.startTime||"起始时间"),3),dt,e("div",{class:O(["flex-1 py-1.5 bg-[#F5F5F5] rounded-md text-center",{"text-xs":f.value.endTime}])},a(f.value.endTime||"结束时间"),3)])])]),y(L,{show:o(r),"onUpdate:show":i[3]||(i[3]=c=>Q(r)?r.value=c:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1},{default:g(()=>[y(D,{modelValue:b.value,"onUpdate:modelValue":i[2]||(i[2]=c=>b.value=c),"min-date":k.value,type:"datetime",title:d.$t("goods.selectStartTime"),onCancel:N,onConfirm:l},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),y(L,{show:o(w),"onUpdate:show":i[5]||(i[5]=c=>Q(w)?w.value=c:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1},{default:g(()=>[y(D,{modelValue:C.value,"onUpdate:modelValue":i[4]||(i[4]=c=>C.value=c),onConfirm:v,"min-date":$.value,onCancel:N,type:"datetime",title:d.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),_:1},8,["show"])}}}),ut=R(ct,[["__scopeId","data-v-7dcdab2e"]]),rt={class:"py-8 text-base font-light text-center text-default"},mt={class:"font-semibold"},ft={class:"text-[#FB1A18]"},vt=M({props:{show:{type:Boolean},goodName:null,amount:null},emits:["close","confirm"],setup(s,{emit:u}){const{rates:r}=oe(),n=ae({rate:.1}),w=()=>{u("confirm"),u("close")};async function m(){n.rate=await r(0)}return ye(()=>{m()}),(b,C)=>{const k=F("van-button");return T(),I(se,{width:"90%",show:s.show,name:b.$t("flashSale.refund"),onClose:C[0]||(C[0]=()=>{u("close")})},{default:g(()=>[e("div",rt,[x(a(b.$t("flashSale.claimDepositTip1"))+" ",1),e("span",mt,a(s.goodName),1),x(" "+a(b.$t("flashSale.claimDepositTip2"))+" ",1),e("span",ft,a(o(Te)(s.amount).times(o(n).rate)||0)+"MC",1),x(" "+a(b.$t("flashSale.claimTip3")),1)]),y(k,{class:"block w-1/2 mx-auto font-semibold text-white btn-pink",onClick:w},{default:g(()=>[x(a(b.$t("common.claim")),1)]),_:1})]),_:1},8,["show","name"])}}}),pt=R(vt,[["__scopeId","data-v-1ffd35f8"]]),ht={class:"w-full bg-[#f9f5f7] min-h-screen"},gt={class:"sticky top-0 bg-[#f9f5f7] z-10"},wt={class:"flex px-2.5 text-[#2E2008] items-center h-10"},bt={class:"font-medium"},St={class:"px-4 pt-2.5"},_t=M({setup(s){const{getCurrentStoreId:u}=Be(),{offShelf:r,merchantBack:n,commodityBatch:w}=oe(),{t:m}=te(),{reloadStore:b}=Fe(),C=h(""),k=h(!1),$=h(!1),f=h(0),N=h(10),l=h(0),[,v]=G(!1),d=P(()=>[{title:m("order.all"),value:null},{title:m("flashSale.notStart"),value:1},{title:m("flashSale.progressing"),value:2},{title:m("flashSale.goodsuceess"),value:3},{title:m("flashSale.gooderror"),value:4},{title:m("flashSale.Cancelled"),value:5}]),[i,D]=G(!1),[L,c]=G(!1),[ne,le]=G(!1),S=h(null),ie=t=>{S.value=t,D(!0)},de=()=>{le(!1)},ce=t=>{Y.status!==d.value[t.name].value&&(Y.status=d.value[t.name].value,pe())},ue=async()=>{v(!0),S.value.loading=!0;const t=await r(S.value.id);S.value.loading=!1,v(!1),t.success&&(S.value.status=400)},re=t=>{S.value=t,c(!0)},me=async t=>{t.loading=!0;const _=await n(t.id);t.loading=!1,_.success&&(S.value.status=500)},fe=$e(),ve=t=>{fe.push(t)},Y=ae({status:null}),pe=()=>{$.value=!1,f.value=0,l.value=0,U.value=[]},U=h([]),he=async()=>{var H,q;k.value=!0;const t=await Ie({page:f.value,size:N.value},{...Y,shopId:(H=await u())==null?void 0:H.id});if(!t.success||!t.data||!t.total){$.value=!0;return}l.value=t.total;const _=t.data.map(p=>p.id),J=await w(_);for(let p=0;p<t.data.length;p++){t.data[p].status=(q=J[p])==null?void 0:q.status,t.data[p].loading=!1;const A=t.data[p].mainImageUrls.split(",").filter(B=>B!==""&&B!==null&&B!==void 0&&!Number.isNaN(B));t.data[p].mainImageUrls=A&&A.length>0?A[0]:""}const z=t.data;U.value=f.value===1?z:U.value.concat(z),U.value.length>=l.value&&($.value=!0)},W=h(null),ge=async()=>{const{data:t}=await De();W.value=t||null},we=async()=>{k.value=!0,f.value+=1,await ge(),await he(),k.value=!1};return(t,_)=>{const J=F("VanList"),z=F("van-tab"),H=F("van-tabs"),q=F("van-pull-refresh");return T(),E("div",ht,[e("header",gt,[e("div",wt,[y(Le),e("span",bt,a(t.$t("flashSale.ParticipationRecord")),1)])]),y(q,{onRefresh:o(b).reload,class:"w-full min-h-screen"},{default:g(()=>[y(H,{active:C.value,"onUpdate:active":_[1]||(_[1]=p=>C.value=p),type:"card",onClickTab:ce,sticky:"","offset-top":"5px"},{default:g(()=>[(T(!0),E(Z,null,X(o(d),(p,A)=>(T(),I(z,{title:p.title,key:A},{default:g(()=>[e("div",St,[y(J,{loading:k.value,"onUpdate:loading":_[0]||(_[0]=B=>k.value=B),finished:$.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:we},{default:g(()=>[(T(!0),E(Z,null,X(U.value,B=>(T(),I(Je,{systemTime:W.value,key:B,onCancleHandle:ie,onRefund:re,data:B,loading:B.loading,onHandleTo:ve},null,8,["systemTime","data","loading"]))),128))]),_:2},1032,["loading","finished","finished-text","loading-text"])])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1},8,["onRefresh"]),y(Ze,{show:o(i),goodName:S.value&&S.value.title,onClose:_[2]||(_[2]=()=>{o(D)(!1)}),onConfirm:ue},null,8,["show","goodName"]),y(pt,{show:o(L),goodName:S.value&&S.value.title,amount:S.value&&S.value.totalPrice,onClose:_[3]||(_[3]=p=>o(c)(!1)),onConfirm:_[4]||(_[4]=p=>me(S.value))},null,8,["show","goodName","amount"]),y(ut,{onClose:de,show:o(ne),tabList:o(d)},null,8,["show","tabList"])])}}}),Ct=R(_t,[["__scopeId","data-v-7c54eeac"]]);export{Ct as default};
