import{y as T,E as b,F as d,G as n,I as V,J as R,R as Q,K as _,a2 as L,H as A,Q as x,w as X,a1 as Y,l as W,r as i,x as $,z as Z,D as ee,O as G,P as m,N as te,X as ae,br as oe}from"./vendor-D6JO6WHW.js";import{_ as le}from"./GoodsEvaluateItem-Dw0vChoR.js";import{_ as S}from"./DefaultPage-BzxZwbSN.js";import{_ as ue}from"./EvalHeader-DCYwVIR9.js";import{i as ne,j as se,k as ie}from"./order-CkOCrxKr.js";import{a5 as re,g as q}from"./index-CbIwihlz.js";import"./BackIcon-CPUEW9je.js";const ve={class:"flex items-center gap-2 overflow-x-auto"},de=["onClick"],ce={key:1},me=T({props:{list:null,value:null},emits:["change"],setup(y,{emit:f}){return(p,z)=>{const v=b("van-icon");return n(),d("div",ve,[(n(!0),d(V,null,R(y.list,l=>(n(),d("div",{class:Q(["flex items-center flex-shrink-0 px-2 text-sm leading-6 rounded",{" bg-primary text-white":y.value===l.id,"bg-yellow-004":y.value!==l.id}]),key:l.id,onClick:C=>f("change",l.id)},[l.id===1?(n(),_(v,{key:0,class:"mr-1.5",name:"photo-o",size:"16"})):L("",!0),A("span",null,x(l.name),1),l.id?(n(),d("span",ce,"("+x(l.count)+")",1)):L("",!0)],10,de))),128))])}}}),fe={class:"px-2.5 font-normal"},ge={class:"bg-white rounded-xl p-2.5 min-h-[calc(100%-44px)]"},pe=T({name:"EvaluateGood"});function Ce(y){const{t:f}=X(),p=Y(),z=W(),v=i(null),l=i(null),C=i(!0),a=i({}),F=async()=>{const e=await ne(l.value);e.success&&(C.value=e.data.defaultGoodFlag,a.value=e.data)},u=i(null),M=$(()=>{let e=0;const t=a.value.goodCount-a.value.defaultGoodCount,o=a.value.differenceCount-a.value.notContentDifferenceCount;switch(u.value){case 1:e=a.value.imgCount;break;case 2:e=t;break;case 3:e=o;break;default:e=o+t+a.value.imgCount;break}return e}),N=$(()=>{var t,o,w,r;let e=0;switch(u.value){case 1:e=0;break;case 2:e=(t=a.value)==null?void 0:t.defaultGoodCount;break;case 3:e=(o=a.value)==null?void 0:o.notContentDifferenceCount;break;default:e=((w=a.value)==null?void 0:w.defaultGoodCount)+((r=a.value)==null?void 0:r.notContentDifferenceCount);break}return e}),O=$(()=>{var e,t,o;return[{id:null,name:f("common.all"),count:k.value},{id:1,name:f("evaluate.picture"),count:(e=a.value)==null?void 0:e.imgCount},{id:2,name:f("evaluate.Good reviews"),count:(t=a.value)==null?void 0:t.goodCount},{id:3,name:f("evaluate.Bad review"),count:(o=a.value)==null?void 0:o.differenceCount}]}),U=e=>{u.value!==e&&(u.value=e,P())},g=i(!1),c=i(!1),s=i([]),h=i(0),B=i(10),k=i(0),j=async()=>{const e=v.value?se:ie,t=v.value?{page:h.value,size:B.value,shopId:v.value}:{page:h.value,size:B.value,goodsId:l.value,commentLevel:u.value,commentDefaultGoodFlag:0},o=await e(t);if(!o.success){c.value=!0;return}if(!o.data||!o.total){c.value=!0;return}k.value=o.total,s.value=h.value===1?o.data:s.value.concat(o.data),s.value.length>=k.value&&(c.value=!0)},D=$(()=>{if(s.value&&s.value.length>0){const e=[];for(let t=0;t<s.value.length;t++)s.value[t].commentImages&&s.value[t].commentImages.length>0&&e.push(...s.value[t].commentImages.split(","));return e}return[]}),H=e=>{const t=D.value.findIndex(o=>o===e);oe({images:D.value,closeable:!0,showIndex:!0,startPosition:t})},E=async()=>{var e;if(C.value&&((e=a.value)==null?void 0:e.defaultGoodCount)>0){g.value=!1,c.value=!0;return}g.value=!0,h.value+=1,await j(),setTimeout(()=>{g.value=!1},1e3)},P=()=>{s.value=[],h.value=0,k.value=0,c.value=!1,g.value=!1,E()},J=async()=>{u.value=null,C.value=!0,await F(),P()},I=e=>{z.push(e)};return Z(()=>p.query.goodsId,e=>{p.path.includes("/evaluate-good?goodsId=")&&l.value!==e&&l.value&&(l.value=e,console.log("222"),J())},{deep:!0,immediate:!0}),ee(()=>{l.value=p.query.goodsId,v.value=p.query.shopId,l.value&&F(),v.value}),(e,t)=>{const o=b("VanList"),w=b("router-view");return n(),d("div",fe,[G(ue,{title:v.value?"門店評價":e.$t("evaluate.product review")},null,8,["title"]),A("div",ge,[G(me,{list:m(O),value:u.value,onChange:U},null,8,["list","value"]),a.value.defaultGoodCount>0&&(C.value&&u.value!==1&&u.value!==3||u.value===2&&a.value.defaultGoodCount===a.value.goodCount)?(n(),_(S,{key:0,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:m(q)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:m(re)(a.value.defaultLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):!m(M)&&m(N)>0?(n(),d("div",{key:1,class:"py-8 text-sm text-center",onClick:t[0]||(t[0]=r=>I(`/evaluate-good-default?goodsId=${l.value}&commentLevel=${u.value}`))},x(e.$t("evaluate.without content",{num:m(N)})),1)):c.value&&k.value===0?(n(),_(S,{key:2,needTextTop:!0,titleColor:"#A45E00",url:m(q)("images/evaluate_empty.png"),title:e.$t("evaluate.No reviews yet"),top:"9rem",iconSize:"16rem"},null,8,["url","title"])):(n(),_(o,{key:3,class:"mt-4",loading:g.value,"onUpdate:loading":t[2]||(t[2]=r=>g.value=r),finished:c.value,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:E},{default:te(()=>[(n(!0),d(V,null,R(s.value,(r,K)=>(n(),_(le,{onImgPre:H,style:ae(K===s.value.length-1?"margin-bottom: 1rem":""),onClick:he=>I(`/evaluate-detail?goodOrderId=${r.id}`),data:r,key:r.id},null,8,["style","onClick","data"]))),128)),a.value.defaultGoodCount>0&&u.value!==1&&u.value!==3?(n(),d("div",{key:0,class:"text-sm text-center",onClick:t[1]||(t[1]=r=>I(`/evaluate-good-default?goodsId=${l.value}&commentLevel=${u.value}`))},x(e.$t("evaluate.without content",{num:a.value.defaultGoodCount})),1)):L("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"]))]),G(w,{class:"child-view bg-[#f2f0ef]"})])}}const Ge=T({...pe,setup:Ce});export{Ge as default};
