import{_ as Me,z as Ee,x as Oe,a2 as te,bl as Se,j as R,y as me,r as d,F as b,G as w,H as m,P as h,Z as j,U,$ as g,J as G,K as ee,O as t,I as a,Q as p,N as K,a3 as Te,a0 as ve,o as Ge,E as He,q as Je,ag as Qe,a4 as Ie,X as Xe,Y as Ze}from"./vendor-Dr_RpJ_Y.js";import{_ as We}from"./filter-MXpgl_BE.js";import{_ as et,o as tt,a as at}from"./BillItemOnline-D-TNoODb.js";import{o as st,a as nt}from"./bill-WdqwAY2M.js";import{V as Ne,aA as V,b as ot,a as lt,u as it,bK as rt,$ as ut,f as ct}from"./index-CU2nzZe6.js";import{B as Pe,P as B}from"./bill-DDCezy34.js";import{C as dt}from"./CommonVanProvider-KZuKVOde.js";import{B as mt}from"./BetweenTab-nGcUWfRT.js";import"./copy-w-Dr8nkqKW.js";import"./MCOIN-BOqZVkND.js";import"./link-CItP-_Ep.js";import"./useOrderStatus-CfUN23nj.js";import"./BackIcon-CDrGaEPo.js";/* empty css                                                               */const vt={class:"flex flex-col justify-between"},ft={class:"font-semibold text-base text-center px-4 pt-[18px] pb-4"},pt={class:"overflow-y-auto flex-1 px-4 pb-4"},ht={class:"text-sm font-semibold"},yt={class:"flex items-center gap-2 mt-3 overflow-x-auto"},wt=["onClick"],Tt={class:"mt-3 flex-start"},gt={class:"mx-2"},bt={class:"flex-center-bw flex justify-between gap-3 bg-white px-3 py-4"},_t={class:"text-base font-normal"},kt={class:"text-base font-semibold"},Ct=Ee({props:{shopId:null,merchant:null},setup(H,{expose:ge}){const{shopId:$,merchant:be}=H,{t:ae}=Oe(),{getMerchantDhKey:v,decryptKey:_e}=Ne(),[J,Q]=te(!1),u=Se({list:[],page:0,size:20,loading:!1,finished:!1}),fe=R().format("YYYY-MM-DD"),_=R().subtract("days",7).format("YYYY-MM-DD"),S=R().subtract("month",1).format("YYYY-MM-DD"),D=R().subtract("month",3).format("YYYY-MM-DD"),O=me(()=>[{id:1,label:ae("shop.Last 7 days")},{id:2,label:ae("shop.last month")},{id:3,label:ae("shop.last 3 months")}]),[se,X]=te(!1),[ne,N]=te(!1),f=d(new Date),A=d(new Date),ke=d(new Date(new Date("2020/1/1").getTime())),z=d(new Date(new Date("2020/1/1").getTime())),o=Se({startTime:null,endTime:null}),q=()=>{o.startTime=null,o.endTime=null,M.value=null,f.value=null,A.value=null,Z()},I=()=>{X(!1),N(!1),(!o.startTime||!o.endTime)&&(o.endTime=null,o.startTime=null)},Ce=r=>{f.value=new Date(V(r)),z.value=new Date(new Date(r).getTime()),o.startTime=V(f.value.toString()),M.value=null,X(!1),N(!0)},x=r=>{A.value=new Date(V(r)),o.startTime=V(f.value.toString()),o.endTime=V(r),M.value=null,N(!1)},M=d(null),oe=r=>{if(M.value!==r){switch(A.value=new Date(fe),o.endTime=fe,r){case 1:o.startTime=_,f.value=new Date(_),z.value=new Date(new Date(_).getTime()+60*1e3);break;case 2:o.startTime=S,f.value=new Date(S),z.value=new Date(new Date(S).getTime()+60*1e3);break;case 3:o.startTime=D,f.value=new Date(D),z.value=new Date(new Date(D).getTime()+60*1e3);break}M.value=r}},Z=()=>{le(),Q(!1)},le=()=>{u.list=[],u.page=0,u.finished=!1,pe()},pe=async()=>{u.loading||(u.loading=!0,u.page+=1,await ie(),u.loading=!1)},ie=async()=>{var T;const{success:r,data:n,total:P}=await st({shopId:$,page:u.page,size:u.size,startTime:o.startTime?o.startTime+" 00:00:00":void 0,endTime:o.endTime?o.endTime+" 23:59:59":void 0});if(!r){u.finished=!0;return}if(!n||!n.length){u.finished=!0;return}if($)for(let k=0;k<n.length;k++){const L=n[k];if(L.remark&&L.submitUserPubKey){const Y=await v(be,L.submitUserPubKey);if(Y){const{decrypt:i}=_e(L.remark,Y);i&&(L.remark=i)}}}u.list=u.page===1?n:u.list.concat(n),+P<=+((T=u.list)==null?void 0:T.length)&&(u.finished=!0)};return ge({setPopShow:Q}),(r,n)=>{const P=b("Empty"),T=b("VanList"),k=b("van-datetime-picker"),L=b("van-popup"),Y=b("van-icon"),i=b("VanButton"),he=b("VanPopup");return m(),w(G,null,[h(T,{loading:t(u).loading,finished:t(u).finished,"finished-text":"","loading-text":r.$t("common.loading"),onLoad:pe},{default:g(()=>{var c;return[(m(!0),w(G,null,ee(t(u).list,re=>(m(),j(et,{key:re.id,bill:re,type:t(Pe).COLLECT},null,8,["bill","type"]))),128)),!t(u).loading&&t(u).finished&&((c=t(u).list)==null?void 0:c.length)<=0?(m(),j(P,{key:0,name:r.$t("common.noMore")},null,8,["name"])):U("",!0)]}),_:1},8,["loading","finished","loading-text"]),t(J)?(m(),j(he,{key:0,show:t(J),"onUpdate:show":n[6]||(n[6]=c=>ve(J)?J.value=c:null),round:"",position:"bottom",closeable:"",class:"sm:w-[375px]",style:{"max-height":"75vh","min-width":"280px",left:"50%",transform:"translate3d(-50%, 0, 0)"},"close-on-click-overlay":"",onClickOverlay:n[7]||(n[7]=c=>t(Q)(!1)),onClickCloseIcon:n[8]||(n[8]=c=>t(Q)(!1))},{default:g(()=>[a("div",vt,[a("div",ft,p(r.$t("common.filter")),1),a("div",pt,[a("div",ht,p(r.$t("common.time")),1),a("div",yt,[(m(!0),w(G,null,ee(t(O),c=>(m(),w("div",{class:K(["type-cell flex-1",{"cell-active":M.value==c.id}]),key:c.id,onClick:re=>oe(c.id)},p(c.label),11,wt))),128))]),a("div",Tt,[a("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:n[0]||(n[0]=Te(c=>t(X)(!0),["stop"]))},[a("div",{class:K({"opacity-30":!t(o).startTime})},p(t(o).startTime||r.$t("goods.selectStartTime")),3)]),h(L,{show:t(se),"onUpdate:show":n[2]||(n[2]=c=>ve(se)?se.value=c:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:g(()=>[h(k,{modelValue:f.value,"onUpdate:modelValue":n[1]||(n[1]=c=>f.value=c),"min-date":ke.value,type:"date",title:r.$t("goods.selectStartTime"),onCancel:I,onConfirm:Ce},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),a("div",gt,[h(Y,{name:"minus"})]),a("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:n[3]||(n[3]=Te(c=>t(N)(!0),["stop"]))},[a("div",{class:K({"opacity-30":!t(o).endTime})},p(t(o).endTime||r.$t("goods.selectEndTime")),3)]),h(L,{show:t(ne),"onUpdate:show":n[5]||(n[5]=c=>ve(ne)?ne.value=c:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:g(()=>[h(k,{modelValue:A.value,"onUpdate:modelValue":n[4]||(n[4]=c=>A.value=c),onConfirm:x,"min-date":z.value,onCancel:I,type:"date",title:r.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])])]),a("div",bt,[h(i,{round:"",class:"!border !border-solid !border-b4 text-b1 flex-1 h-[46px]",onClick:q},{default:g(()=>[a("span",_t,p(r.$t("common.reset")),1)]),_:1}),h(i,{round:"",class:"btn-yellow flex-1 h-[46px] border-0",onClick:Z},{default:g(()=>[a("span",kt,p(r.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"])):U("",!0)],64)}}}),Dt=Me(Ct,[["__scopeId","data-v-615a3459"]]),xt=H=>(Xe("data-v-43f45eb4"),H=H(),Ze(),H),$t=xt(()=>a("img",{src:We,class:"w-5 h-5"},null,-1)),St=[$t],Lt={key:0,class:"px-3 text-sm h-[calc(100vh-95px)] overflow-y-auto mt-3"},Yt={key:1},Vt={class:"flex flex-col max-h-[90vh] justify-between"},It={class:"flex-1 overflow-y-scroll px-4 pb-4"},Mt={class:"mt-[18px] font-semibold text-base text-center"},Et={class:"overflow-y-auto flex-1"},Ot={class:"text-sm font-semibold mt-4"},Nt={class:"flex items-center gap-2 mt-3 overflow-x-auto"},Pt=["onClick"],Ft={class:"mt-3 flex-start"},Bt={class:"mx-2"},Ut={key:0,class:"mt-4"},jt={class:"text-sm font-semibold"},Kt={class:"flex items-center justify-start gap-3 mt-3 flex-wrap"},Rt=["onClick"],At={class:"mt-4"},zt={class:"text-sm font-semibold"},qt={class:"flex items-center justify-start gap-3 mt-3 flex-wrap"},Gt=["onClick"],Ht={class:"flex justify-between gap-3 px-3 py-4"},Jt=Ee({setup(H){var Ye;const{checkLoginAuth:ge}=ot(),{t:$}=Oe(),{getMerchantDhKey:be,decryptKey:ae}=Ne(),{accountStore:v}=lt(),_e=Ge(),J=Je(),[Q,u]=te(!1),{getCurrentStoreId:fe}=it(),_=d([]),S=d(!1),D=d(!1),O=d(0),se=d(20),X=d(0),ne=Pe.COLLECT,N=d(null),f=d(Number(((Ye=_e.query)==null?void 0:Ye.payChannel)||B.ONLINE)),A=[{label:$("shop.on-line"),value:B.ONLINE},{label:$("shop.off-line"),value:B.OFFLINE}],ke=e=>{f.value=e,O.value=0,_.value=[],J.replace({query:{payChannel:e}}),f.value===B.OFFLINE&&De()},z=()=>{var e;f.value===B.OFFLINE?o.value=!0:N.value&&((e=N.value)==null||e.setPopShow(!0))},o=d(!1),q=d(null),I=d(""),Ce=me(()=>tt()),x=d([]),M=R().format("YYYY-MM-DD"),oe=R().subtract("days",7).format("YYYY-MM-DD"),Z=R().subtract("month",1).format("YYYY-MM-DD"),le=R().subtract("month",3).format("YYYY-MM-DD"),pe=me(()=>[{id:1,label:$("shop.Last 7 days")},{id:2,label:$("shop.last month")},{id:3,label:$("shop.last 3 months")}]),[ie,r]=te(!1),[n,P]=te(!1),T=d(new Date),k=d(new Date),L=d(new Date(new Date("2020/1/1").getTime())),Y=d(new Date(new Date("2020/1/1").getTime())),i=Se({startTime:null,endTime:null}),he=()=>{r(!1),P(!1),(!i.startTime||!i.endTime)&&(i.endTime=null,i.startTime=null)},c=e=>{T.value=new Date(V(e)),Y.value=new Date(new Date(e).getTime()),i.startTime=V(T.value.toString()),W.value=null,r(!1),P(!0)},re=e=>{k.value=new Date(V(e)),i.startTime=V(T.value.toString()),i.endTime=V(e),W.value=null,P(!1)},W=d(null),Fe=e=>{if(W.value!==e){switch(k.value=new Date(M),i.endTime=M,e){case 1:i.startTime=oe,T.value=new Date(oe),Y.value=new Date(new Date(oe).getTime()+60*1e3);break;case 2:i.startTime=Z,T.value=new Date(Z),Y.value=new Date(new Date(Z).getTime()+60*1e3);break;case 3:i.startTime=le,T.value=new Date(le),Y.value=new Date(new Date(le).getTime()+60*1e3);break}W.value=e}},Be=e=>{if(e===""){x.value=[];return}const l=x.value.findIndex(E=>E===+e);l>-1?x.value.splice(l,1):x.value.push(+e)},ue=me(()=>{var e;return(e=v.store)==null?void 0:e.id}),ce=me(()=>{var E,F,C;if(!((E=v.store)!=null&&E.id))return!0;const e=(F=v.store)!=null&&F.merchant?(C=v.store)==null?void 0:C.merchant.toLowerCase():"",l=v.account?v.account.toLowerCase():"";return e===l?Ue():je(),e===l}),Ue=async()=>{const e=await fe();if(!(e!=null&&e.id))return;const l=await rt({shopId:e.id,page:1,size:100});l.success&&(q.value=l.data||[],ce.value&&(q.value.unshift({nickname:$("common.myself"),address:v.account}),q.value.unshift({nickname:$("common.all"),address:""})))},je=()=>{var e;q.value=[{id:1,nickname:(e=v.store)==null?void 0:e.nickname,address:v.account}]},De=async()=>{S.value||(S.value=!0,O.value+=1,await Le(),S.value=!1)},Ke=async()=>{O.value=1,D.value=!1,_.value=[],await Le()},xe=d([]),Le=async()=>{var l,E;const e=await nt({page:O.value,size:se.value,shopId:ue.value,merchantAddress:(l=v.store)!=null&&l.id?(E=v.store)==null?void 0:E.merchant:v.account,orderCashierAddress:ce.value?I.value||null:v.account,orderTypes:ce.value?x.value.length>0?x.value:null:[3],startTime:i.startTime?i.startTime+" 00:00:00":void 0,endTime:i.endTime?i.endTime+" 23:59:59":void 0});if(S.value=!1,!e.success){D.value=!0;return}if(!e.data||!e.data.total){D.value=!0;return}if(X.value=e.data.total,ue.value)for(let F=0;F<e.data.records.length;F++){const C=e.data.records[F];if(C.merchantAddress&&C.orderSubmitCustomerPubKey){const de=await be(C.merchantAddress,C.orderSubmitCustomerPubKey);if(de){const{decrypt:ye}=ae(C.orderRemark,de);ye&&(C.orderRemark=ye)}}}xe.value=e.data.records,_.value=O.value===1?xe.value:_.value.concat(xe.value),_.value.length>=X.value&&(D.value=!0)},Re=()=>{o.value=!1,O.value=0,D.value=!1,_.value=[],De()},$e=()=>{o.value=!1},Ae=()=>{ce.value&&(I.value=""),x.value=[],i.startTime=null,i.endTime=null,W.value=null,T.value=null,k.value=null,Ke(),$e()},ze=e=>{I.value===e?I.value="":I.value=e},qe=async()=>{if(ge(!0))try{if(u(!1),!ue.value){const e=await ut(v.account);e.success&&e.data&&(await v.changeStore(e.data),ue.value=e.data.id)}}catch(e){console.error(e)}finally{u(!0)}};return He(async()=>{qe()}),(e,l)=>{const E=b("Empty"),F=b("VanList"),C=b("van-datetime-picker"),de=b("van-popup"),ye=b("van-icon"),Ve=b("VanButton");return m(),j(dt,{title:e.$t("shop.fundDetail"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{"popup-close-icon-color":"#000"}},{right:g(()=>{var y;return[t(ce)&&((y=t(v).store)!=null&&y.id)||f.value===t(B).OFFLINE?(m(),w("div",{key:0,class:"flex-shrink-0 w-5 ml-3",onClick:z},St)):U("",!0)]}),default:g(()=>[h(mt,{options:A,"label-key":"label","value-key":"value",modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=y=>f.value=y),onChange:ke},null,8,["modelValue"]),t(Q)?(m(),w("div",Lt,[f.value===t(B).ONLINE?(m(),j(Dt,{key:0,"shop-id":t(ue),merchant:e.merchant,ref:(y,s)=>{s.onlineRef=y,N.value=y}},null,8,["shop-id","merchant"])):f.value===t(B).OFFLINE?(m(),w("div",Yt,[h(F,{loading:S.value,finished:D.value,"finished-text":"","loading-text":e.$t("common.loading"),onLoad:De},{default:g(()=>{var y;return[(m(!0),w(G,null,ee(_.value,s=>(m(),j(at,{key:s.id,type:t(ne),bill:s},null,8,["type","bill"]))),128)),!S.value&&D.value&&((y=_.value)==null?void 0:y.length)<=0?(m(),j(E,{key:0,name:e.$t("common.noMore")},null,8,["name"])):U("",!0)]}),_:1},8,["loading","finished","loading-text"])])):U("",!0),o.value?(m(),j(t(Qe),{key:2,show:o.value,"onUpdate:show":l[7]||(l[7]=y=>o.value=y),round:"",position:"bottom",closeable:"",class:"sm:w-[375px]",style:{"max-height":"90vh",left:"50%",transform:"translate3d(-50%, 0, 0)"},"close-on-click-overlay":"",onClickOverlay:$e,onClickCloseIcon:$e},{default:g(()=>{var y;return[a("div",Vt,[a("div",It,[a("div",Mt,p(e.$t("common.filter")),1),a("div",Et,[a("div",Ot,p(e.$t("common.time")),1),a("div",Nt,[(m(!0),w(G,null,ee(t(pe),s=>(m(),w("div",{class:K(["type-cell flex-1",{"cell-active":W.value==s.id}]),key:s.id,onClick:we=>Fe(s.id)},p(s.label),11,Pt))),128))]),a("div",Ft,[a("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:l[1]||(l[1]=Te(s=>t(r)(!0),["stop"]))},[a("div",{class:K({"opacity-30":!t(i).startTime})},p(t(i).startTime||e.$t("goods.selectStartTime")),3)]),h(de,{show:t(ie),"onUpdate:show":l[3]||(l[3]=s=>ve(ie)?ie.value=s:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:g(()=>[h(C,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=s=>T.value=s),"min-date":L.value,type:"date",title:e.$t("goods.selectStartTime"),onCancel:he,onConfirm:c},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),a("div",Bt,[h(ye,{name:"minus"})]),a("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:l[4]||(l[4]=Te(s=>t(P)(!0),["stop"]))},[a("div",{class:K({"opacity-30":!t(i).endTime})},p(t(i).endTime||e.$t("goods.selectEndTime")),3)]),h(de,{show:t(n),"onUpdate:show":l[6]||(l[6]=s=>ve(n)?n.value=s:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:g(()=>[h(C,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=s=>k.value=s),onConfirm:re,"min-date":Y.value,onCancel:he,type:"date",title:e.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),(y=t(v).store)!=null&&y.id?(m(),w("div",Ut,[a("div",jt,p(e.$t("common.cashierStatus")),1),a("div",Kt,[(m(!0),w(G,null,ee(q.value,s=>(m(),w("div",{class:K(["type-cell whitespace-nowrap border-none",{"cell-active":I.value==s.address}]),key:s.id,onClick:we=>ze(s.address)},p(s.nickname||t(ct)(s.address,"...",4,4)),11,Rt))),128))]),a("div",At,[a("div",zt,p(e.$t("common.orderType")),1),a("div",qt,[(m(!0),w(G,null,ee(t(Ce),s=>(m(),w("div",{class:K(["type-cell min-w-min whitespace-nowrap border-none",{"cell-active":s.key===""&&!x.value.length||s.key!==""&&x.value.findIndex(we=>we==s.key)>-1}]),key:s.key,onClick:we=>Be(s.key)},p(s.label),11,Gt))),128))])])])):U("",!0)])]),a("div",Ht,[h(Ve,{round:"",class:"flex-1 h-[46px] !border !border-solid !border-b4 text-base text-b1 font-normal",onClick:Ae},{default:g(()=>[Ie(p(e.$t("common.reset")),1)]),_:1}),h(Ve,{round:"",class:"btn-yellow flex-1 h-[46px] border-0 text-base text-b1 font-semibold",onClick:Re},{default:g(()=>[Ie(p(e.$t("common.confirm")),1)]),_:1})])])]}),_:1},8,["show"])):U("",!0)])):U("",!0)]),_:1},8,["title"])}}}),ca=Me(Jt,[["__scopeId","data-v-43f45eb4"]]);export{ca as default};
