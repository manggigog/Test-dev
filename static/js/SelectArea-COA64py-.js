import{_ as ee,y as U,G as i,H as s,I as n,Q as d,J as f,K as I,U as v,O as r,z as ue,x as de,r as p,o as ve,D as me,a9 as ye,E as pe,ab as fe,Z as b,$ as N,q as _e,F as q,P as S,a4 as F,T as Q,X as Ce,Y as he}from"./vendor-Dr_RpJ_Y.js";import{C as ge}from"./CommonVanProvider-KZuKVOde.js";import{a as xe,b as ke,aZ as x,a_ as X,B as W,aV as be}from"./index-BckdT6oc.js";import{u as Ne}from"./useCityMap-VqEHfq08.js";import{B as Se}from"./BetweenTab-nGcUWfRT.js";import{_ as $e}from"./SearchBar-C8hJeDlC.js";import"./BackIcon-CDrGaEPo.js";/* empty css                                                               */import"./search-C4fLtTfY.js";import"./delete-BlDblrKv.js";const Ae=""+new URL("../images/gps-gray-Brgff8nc.svg",import.meta.url).href,te=""+new URL("../images/flag-DsGJY6jz.svg",import.meta.url).href,Le={class:"active-cities_container px-4"},we={class:"test-sm text-b3 font-normal"},Ee=["onClick"],Re={key:0},Pe={key:1,src:te,class:"w-[18px] h-[18px] ml-1"},Fe={props:{cityList:{type:Array,default:()=>[]},limit:{type:[Number,String],default:5}},emits:["click"],setup(h,{emit:k}){const e=h,V=U(()=>e.cityList.slice(0,e.limit)),$=m=>{k("set",m)};return(m,A)=>(s(),i("div",Le,[n("p",we,d(m.$t("city.Cities currently open")),1),n("div",null,[(s(!0),i(f,null,I(r(V),l=>(s(),i("div",{key:l.name,class:"active-cities-item h-[52px] border-b border-solid border-[#E5E5E5] flex items-center justify-start text-sm font-normal text-b1",onClick:_=>$(l)},[n("span",null,d(l.areaName),1),Number(l.storeCount)>0?(s(),i("span",Re,"("+d(m.$t("city.There are 5 stores that can be purchased on behalf of others",{val:l.storeCount}))+" )",1)):v("",!0),l.visitedFlag?(s(),i("img",Pe)):v("",!0)],8,Ee))),128))])]))}},Ie=ee(Fe,[["__scopeId","data-v-75d0c656"]]),Ve=h=>(Ce("data-v-4412c35d"),h=h(),he(),h),Be={class:"px-3 pb-2"},De={class:"h-[calc(100vh-127px)] overflow-y-auto relative"},Oe={key:0,class:"search-result"},Te={class:"px-4 pt-3"},qe={class:"text-sm font-normal text-b3"},Ue={class:"py-4 flex items-center justify-start gap-3"},je=Ve(()=>n("img",{src:Ae,class:"w-4 h-4 mr-1"},null,-1)),Ke={class:"text-sm font-normal text-b1"},He={class:"text-sm font-normal text-b1"},Me={class:"text-sm font-normal text-b1"},ze={key:0},Ge={class:"relative"},Je={class:"flex items-center justify-start"},Ye={class:"custom-title"},Ze={key:0,src:te,class:"w-[18px] h-[18px] ml-1"},Qe=ue({setup(h){var M;const{t:k}=de(),{cityMapStore:e}=xe(),{checkLoginAuth:V}=ke(),{getUserLocation:$}=Ne(),m=ve(),A=_e(),l=p(null),_=p([]),B=p(!1),D=p(!1),y=p([]),c={CN:!1,OVERSEAS:!0},se=[{label:k("city.domestic_include_HongKong_Macao_Taiwan"),value:c.CN},{label:k("city.overseas"),value:c.OVERSEAS}],a=p({status:((M=e.currentActiveCity)==null?void 0:M.overseasFlag)||!1,keyword:"",isSelector:m.query.mode==="select",fromRoute:m.query.from?decodeURIComponent(String(m.query.from)):""}),O=p([]);me(()=>l.value,t=>{t?O.value=Object.keys(l.value):O.value=[]},{immediate:!0,deep:!0});const ae=U(()=>ye.isEmpty(l.value)),j=U(()=>a.value.keyword.trim()!==""&&B.value),oe=t=>{a.value.status=t,l.value=[],j.value?(t===c.CN?l.value=x(e.regions,"areaNamePinyinFirstPrefix",2):l.value=x(e.overseasRegions,"areaNamePinyinFirstPrefix",1),K(a.value.keyword)):t===c.CN?l.value=x(e.regions,"areaNamePinyinFirstPrefix",2):l.value=x(e.overseasRegions,"areaNamePinyinFirstPrefix",1),y.value=e.getActiveCitiesList(t!==c.CN)||[],T(y.value)},K=async t=>{if(console.log("搜索关键词:",t),!t.trim()){_.value=[];return}B.value=!0;try{const o={areaLevel:a.value.status==c.CN?"2":"1",keywords:t.trim()};D.value=!0,Q.loading({message:k("common.search_loading"),duration:0,forbidClick:!1});const C=await be(a.value.status,o);_.value=C.data||[]}catch(o){console.error("搜索失败:",o),_.value=[]}finally{Q.clear(),D.value=!1}},ie=()=>{_.value=[],B.value=!1},le=()=>{g(e.locationCity),setTimeout(()=>{$("reset")},1e3)},g=t=>{!t||!t.areaName||(a.value.isSelector?e.setSelectedArea(t):e.setCurrentCity(t,"manual"),a.value.fromRoute==="back"?A.back():A.replace({path:a.value.fromRoute}))},H=p({}),re=async()=>{y.value=e.getActiveCitiesList(a.value.status!==c.CN)||[];try{const[t,o]=await Promise.all([X({overseasFlag:!1}),X({overseasFlag:!0})]),C=t.data||[],L=o.data||[];e.setActiveCitiesList(C,!1),e.setActiveCitiesList(L,!0),y.value=a.value.status===c.CN?C:L,T(y.value)}catch(t){console.error("获取开通城市失败:",t),y.value=e.getActiveCitiesList(a.value.status!==c.CN)||[],T(y.value)}},T=t=>{t.forEach(o=>{o.visitedFlag&&(H.value[o.areaName]=!0)})},ne=()=>{V(!0)&&A.push("/city/footprints")};return pe(()=>{e.regions||e.init(),a.value.status===c.CN?l.value=x(e.regions,"areaNamePinyinFirstPrefix",2):l.value=x(e.overseasRegions,"areaNamePinyinFirstPrefix",1),re(),document.querySelector("#app").style.minHeight="580px"}),fe(()=>{document.querySelector("#app").style.minHeight=null}),(t,o)=>{const C=q("van-cell"),L=q("van-index-anchor"),ce=q("van-index-bar");return s(),b(ge,{title:t.$t("city.current_location"),class:"bg-white font-Puhui font-normal relative min-h-[560px]","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(w,E)=>{E.searchRef=w}},{right:N(()=>[a.value.isSelector?v("",!0):(s(),i("div",{key:0,class:"text-sm font-normal text-b2",onClick:ne},d(t.$t("city.footprints")),1))]),default:N(()=>{var w,E,z,G,J,Y,Z;return[n("section",null,[n("div",Be,[S($e,{modelValue:a.value.keyword,"onUpdate:modelValue":o[0]||(o[0]=u=>a.value.keyword=u),placeholder:t.$t("city.search_city_name_pinyin"),"search-button-text":t.$t("common.search"),onSearch:K,onClear:ie},null,8,["modelValue","placeholder","search-button-text"])]),S(Se,{options:se,"label-key":"label","value-key":"value",modelValue:a.value.status,"onUpdate:modelValue":o[1]||(o[1]=u=>a.value.status=u),onChange:oe,class:"relative z-10"},null,8,["modelValue"]),n("section",De,[r(j)?(s(),i("div",Oe,[_.value.length===0&&!D.value?(s(),b(W,{key:0,name:t.$t("common.search_result_null")},null,8,["name"])):v("",!0),(s(!0),i(f,null,I(_.value,u=>(s(),b(C,{class:"w-full",title:u.areaName,key:u.areaId,onClick:R=>g(u)},null,8,["title","onClick"]))),128))])):(s(),i(f,{key:1},[n("div",Te,[n("p",qe,d(t.$t("city.current_location_last_select")),1),n("div",Ue,[n("div",{class:"area-box position-box",onClick:o[2]||(o[2]=u=>r(e).locationCity?le():r($)("reset"))},[je,n("span",Ke,[r(e).locationCity?(s(),i(f,{key:0},[F(d(((w=r(e).locationCity)==null?void 0:w.areaName)||"--"),1)],64)):r(e).locationCity?(s(),i(f,{key:2},[F(d(t.$t("city.location_loading")),1)],64)):(s(),i(f,{key:1},[F(d(t.$t("city.location_error")),1)],64))])]),a.value.status===c.CN&&r(e).lastSelectCity&&((E=r(e).lastSelectCity)==null?void 0:E.areaId)!=((z=r(e).locationCity)==null?void 0:z.areaId)?(s(),i("div",{key:0,class:"area-old-box position-box",onClick:o[3]||(o[3]=u=>g(r(e).lastSelectCity))},[n("span",He,d((G=r(e).lastSelectCity)==null?void 0:G.areaName),1)])):v("",!0),a.value.status===c.OVERSEAS&&r(e).lastSelectOverseasCity&&((J=r(e).lastSelectOverseasCity)==null?void 0:J.areaId)!=((Y=r(e).locationCity)==null?void 0:Y.areaId)?(s(),i("div",{key:1,class:"area-old-box position-box",onClick:o[4]||(o[4]=u=>g(r(e).lastSelectOverseasCity))},[n("span",Me,d((Z=r(e).lastSelectOverseasCity)==null?void 0:Z.areaName),1)])):v("",!0)])]),a.value.status===c.CN?(s(),i("div",ze,[S(Ie,{cityList:y.value,onSet:g,limit:5},null,8,["cityList"])])):v("",!0),n("div",Ge,[r(ae)?(s(),b(W,{key:0,name:t.$t("city.No regional data available")},null,8,["name"])):v("",!0),S(ce,{sticky:!0,"index-list":O.value,teleport:"#app",class:"select-area-index-bar"},{default:N(()=>[(s(!0),i(f,null,I(l.value,(u,R)=>(s(),i("div",{key:R},[S(L,{index:R},{default:N(()=>[F(d(R),1)]),_:2},1032,["index"]),(s(!0),i(f,null,I(u,P=>(s(),b(C,{key:P.areaId,onClick:Xe=>g(P)},{title:N(()=>[n("p",Je,[n("span",Ye,d(P.areaName),1),H.value[P.areaName]?(s(),i("img",Ze)):v("",!0)])]),_:2},1032,["onClick"]))),128))]))),128))]),_:1},8,["index-list"])])],64))])])]}),_:1},8,["title"])}}}),ct=ee(Qe,[["__scopeId","data-v-4412c35d"]]);export{ct as default};
