import{_ as J}from"./exchange2-Ct9Hfzza.js";import{_ as K,z as Q,x as Y,bl as Z,a2 as q,y as k,r as W,E as ee,G as m,H as l,P as d,$ as w,F as A,I as t,O as s,Q as o,a4 as g,Z as M,J as se,K as te,B as ae,T as oe,X as ne,Y as le}from"./vendor-Dr_RpJ_Y.js";import{_ as ce}from"./BgBox-BPYkjYKw.js";import{E as ie}from"./EcologyHeader-BPtmKFe-.js";import{g as f,k as $,w as de,j as r,d as B,e as u}from"./index-BckdT6oc.js";import{u as re}from"./lendingPoolContract-tbgZb2R3.js";import"./bg-dot-DBVQRM9t.js";import"./UserLevel-CbykZCNm.js";import"./avatarRing-CLGxkH-F.js";import"./level-Bg_EjCZQ.js";import"./UserAsset-1GWHoCRN.js";import"./TokenBalance-k05Fh-Ks.js";const ue=""+new URL("../images/exchange-1-0tPEy7IE.svg",import.meta.url).href,C=p=>(ne("data-v-31e5d0ec"),p=p(),le(),p),me={class:"relative h-full"},pe={class:"bg-[#FFFDF8] rounded-2xl shadow-inset-2 px-2 py-4"},ge={class:"flex-center-bw"},fe={class:"flex-start gap-2.5"},_e=["src"],he={class:"font-semibold"},be={class:"opacity-80 flex-center"},xe={key:1},ve={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},ke={class:"flex items-center justify-end gap-2 mt-2"},we=["onClick"],Ae=C(()=>t("img",{src:ue,class:"block w-20",alt:""},null,-1)),ye=[Ae],De={class:"flex-center-bw"},Se={class:"flex-start gap-2.5"},Ue=["src"],Le={class:"font-semibold"},Te={class:"opacity-80 flex-center"},Ve={key:1},Fe={class:"bg-[#fff9f0] mt-3 rounded-lg p-2"},Me={class:"mt-2 text-center opacity-70"},$e={class:"gap-4 mt-5 font-semibold text-white flex-center"},Be={class:"gap-1 flex-center"},Ce=C(()=>t("img",{src:J,class:"w-4",alt:""},null,-1)),Ie=Q({setup(p){const{usdtAddress:_,musdAddress:h,deposit:I,withdraw:E}=re(),{loadingToggle:y}=de(),{t:P}=Y(),e=Z({percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],token0:"USDT",token1:"MUSD",balance0:0,balance1:0,resouceAmount:null,toAmount:null,authLoading:!1,isAuth:!1,exchangeLoading:!1,allowanceAmount:0,resouceDisabled:!0,toDisabled:!0}),[D,S]=q(!1),c=k(()=>({name:e.token0,icon:$(`images/tokens/${e.token0}.png`),token:f[`${e.token0}`]})),b=k(()=>({name:e.token1,icon:$(`images/tokens/${e.token1}.png`),token:f[`${e.token1}`]})),N=()=>{e.resouceDisabled=!1,e.toDisabled=!0},O=()=>{e.resouceDisabled=!0,e.toDisabled=!1},z=a=>{e.resouceDisabled=!1,e.resouceAmount=u(+ae(e.balance0).times(a.value))},U=k(()=>({MUSDUSDT:1,USDTMUSD:1})[e.token0+e.token1]),j=()=>{e.token0==="MUSD"?(e.token0="USDT",e.token1="MUSD"):(e.token0="MUSD",e.token1="USDT"),e.resouceAmount=0,v()},x=W(""),H=async()=>{const a=c.value.name==="MUSD"?await h():await _();x.value=a},L=async()=>{const a=await(await r(x.value)).allowance(f.lendingPool);e.isAuth=+a.result>0&&+a.result>=e.resouceAmount,e.allowanceAmount=a.result||0},R=async()=>{e.authLoading=!0;const{approve:a}=r(x.value),i=await a(f.lendingPool);e.authLoading=!1,i.success&&L()},X=async()=>{S(!0),e.balance0=c.value.name==="MUSD"?+await r(await h()).balanceOf():+await r(await _()).balanceOf(),e.balance1=b.value.name==="MUSD"?+await r(await h()).balanceOf():+await r(await _()).balanceOf(),S(!1)},G=async()=>{if(!e.resouceAmount||e.resouceAmount===0)return oe(P("assets.pleaseInput"));e.exchangeLoading=!0;let a;c.value.name==="MUSD"?a=await E(u(e.resouceAmount)):a=await I(u(e.resouceAmount)),e.exchangeLoading=!1,a.success&&(e.resouceAmount=0,v())},v=async()=>{y(!0),await H(),await L(),X(),y(!1),e.authLoading=!1,e.exchangeLoading=!1};return ee(async()=>{v()}),(a,i)=>{const T=A("van-loading"),V=A("VanField"),F=A("VanButton");return l(),m("div",me,[d(ie),d(ce,{icon:"images/ecology/exchange.png",text:a.$t("ecology.exchange")},{default:w(()=>[t("div",pe,[t("section",null,[t("div",ge,[t("div",fe,[t("img",{src:s(c).icon,alt:"",class:"w-6 h-6"},null,8,_e),t("span",he,o(s(c).name),1)]),t("div",be,[g(o(a.$t("assets.balance"))+" ",1),s(D)?(l(),M(T,{key:0,size:"18px"})):(l(),m("span",xe,o(s(B)(s(u)(s(e).balance0||0))),1))])]),t("div",ve,[d(V,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",modelValue:s(e).resouceAmount,"onUpdate:modelValue":i[0]||(i[0]=n=>s(e).resouceAmount=n),onFocus:N,type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",ke,[(l(!0),m(se,null,te(s(e).percents,n=>(l(),m("div",{class:"text-xs text-oriange1 border border-solid border-oriange1 rounded-md px-1 py-[2px] hover:bg-[#ffcd89]",key:n.value,onClick:Ee=>z(n)},o(n.name),9,we))),128))])])]),t("div",{class:"mt-3 flex-center"},[t("div",{class:"w-20",onClick:j},ye)]),t("section",null,[t("div",De,[t("div",Se,[t("img",{src:s(b).icon,alt:"",class:"w-6 h-6"},null,8,Ue),t("span",Le,o(s(b).name),1)]),t("div",Te,[g(o(a.$t("assets.balance"))+" ",1),s(D)?(l(),M(T,{key:0,size:"18px"})):(l(),m("span",Ve,o(s(B)(s(u)(s(e).balance1||0))),1))])]),t("div",Fe,[d(V,{class:"bg-[#fff9f0] text-4xl font-bold","input-align":"left",disabled:!0,modelValue:s(e).resouceAmount,"onUpdate:modelValue":i[1]||(i[1]=n=>s(e).resouceAmount=n),onFocus:O,type:"number",placeholder:"0"},null,8,["modelValue"])])]),t("div",Me," 1 "+o(s(e).token0)+" = "+o(s(U)?s(u)(s(U),6).toString():"-")+" "+o(s(e).token1),1),t("div",$e,[d(F,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth&&s(e).allowanceAmount>=s(e).resouceAmount,loading:s(e).authLoading,onClick:R},{default:w(()=>[g(o(a.$t("assets.auth"))+o(s(c).name),1)]),_:1},8,["disabled","loading"]),d(F,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:G},{default:w(()=>[t("div",Be,[Ce,g(" "+o(a.$t("assets.change")),1)])]),_:1},8,["loading","disabled"])])])]),_:1},8,["text"])])}}}),Ye=K(Ie,[["__scopeId","data-v-31e5d0ec"]]);export{Ye as default};
