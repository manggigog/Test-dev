import{_ as D,z as L,q as V,y as F,F as B,G as y,H as n,I as t,P as k,O as f,Q as v,Z as h,U as T,a3 as N,X as A,Y as G,j as mo,J as P,K as R,af as fo,x as go,o as po,bl as ho,r as b,a2 as J,E as _o,bm as vo,$ as q}from"./vendor-Dr_RpJ_Y.js";import{_ as Q}from"./MCOIN-Bodfn-v1.js";import{_ as X}from"./store-odfdGeH-.js";import{_ as Y}from"./shop-arrow-right-BMae5SG7.js";import{R as W}from"./RatioBox-C8BvsGJW.js";import{_ as oo}from"./ImgBoutiqueLable-B-2xCcw4.js";import{e as to,R as so,C as yo,a9 as wo,aa as xo}from"./index-7OiUoGXy.js";import{C as bo}from"./CommonVanProvider-KZuKVOde.js";import{B as $o}from"./BetweenTab-nGcUWfRT.js";import{_ as Io}from"./EmptyTipsPop-DFfFg0cQ.js";import"./shop-CeqcS6K2.js";import"./BackIcon-CDrGaEPo.js";/* empty css                                                               */const ko=""+new URL("../images/dark-delete-Bo7Z4RyI.svg",import.meta.url).href,z=o=>(A("data-v-57a1c80a"),o=o(),G(),o),Co=["data-store-name"],So={class:"shrink-0 offline-goods-img__wrap w-[60px] h-[60px] overflow-hidden relative"},Bo={class:"offline-goods-info__wrap ml-2 flex-1 min-h-[60px]",style:{width:"calc(100% - 60px - 8px)"}},To={class:"w-full items-start flex flex-col justify-between h-[60px]"},Lo={class:"w-full"},Ho={class:"font-semibold text-sm line-clamp-1"},Oo={class:"flex items-center justify-start font-Puhui"},Eo={class:"flex items-center"},jo=z(()=>t("img",{src:Q,class:"w-4 h-4 mr-1"},null,-1)),qo={class:"text-b1 font-semibold text-sm"},No=["onClick"],Po={class:"font-normal text-b3 text-sm flex items-center justify-start"},Ro=z(()=>t("img",{src:X,class:"w-4 h-4"},null,-1)),Do={class:"line-clamp-1"},Vo=z(()=>t("img",{src:Y,class:"w-4 h-4"},null,-1)),Fo=L({props:{goods:{type:Object,default:()=>({})}},setup(o){const l=o,m=V(),w=F(()=>{var e;return(((e=l.goods.icons)==null?void 0:e.split(","))||[""])[0]}),$=()=>{var e,a;const c=((e=l.goods)==null?void 0:e.id)||((a=l.goods)==null?void 0:a.goodsId);c&&m.push({path:"/goodsDetail",query:{id:c,activated:1}})},d=()=>{var e;const c=(e=l.goods)==null?void 0:e.shopId;c&&m.push({path:"/shop",query:{shopId:c,activated:1}})};return(c,e)=>{const a=B("VanImage");return n(),y("section",{class:"flex items-start bg-white p-3 rounded-xl","data-store-name":o.goods.shopName,onClick:$},[t("div",So,[k(a,{src:f(w),class:"offline-goods-img w-[60px] h-[60px] rounded-lg overflow-hidden",alt:c.$t("goods.goodsImage"),fit:"cover"},null,8,["src","alt"]),k(oo,{type:+o.goods.type||null},null,8,["type"])]),t("div",Bo,[t("div",To,[t("div",Lo,[t("div",Ho,v(o.goods.goodsName||""),1)]),t("div",Oo,[t("div",Eo,[jo,t("div",qo,v(f(to)(o.goods.price)),1)]),o.goods.discountRatio?(n(),h(W,{key:0,class:"ratio-box ml-2 !px-1",tag:c.$t("common.rebate"),ratio:o.goods.discountRatio},null,8,["tag","ratio"])):T("",!0)]),t("div",{class:"w-full",onClick:N(d,["stop"])},[t("div",Po,[Ro,t("span",Do,v(o.goods.storeName||"--"),1),Vo])],8,No)])])],8,Co)}}}),Ao=D(Fo,[["__scopeId","data-v-57a1c80a"]]),U=o=>(A("data-v-6a59516e"),o=o(),G(),o),Go=["data-store-name"],zo={class:"shrink-0 offline-goods-img__wrap w-[60px] h-[60px] overflow-hidden relative"},Uo={class:"offline-goods-info__wrap ml-2 flex-1 min-h-[60px]",style:{width:"calc(100% - 60px - 8px)"}},Mo={class:"w-full items-start flex flex-col justify-between h-[60px]"},Zo={class:"w-full"},Jo={class:"font-semibold text-sm line-clamp-1"},Ko={class:"flex items-center justify-start font-Puhui"},Qo={class:"flex items-center"},Xo=U(()=>t("img",{src:Q,class:"w-4 h-4 mr-1"},null,-1)),Yo={class:"text-b1 font-semibold text-sm"},Wo={class:"w-full"},ot={class:"font-normal text-b3 text-sm flex items-center justify-start"},tt=U(()=>t("img",{src:X,class:"w-4 h-4"},null,-1)),st={class:"line-clamp-1"},et=["onClick"],at={key:0},nt=["onClick"],lt=U(()=>t("img",{src:Y,class:"w-4 h-4"},null,-1)),it=L({props:{goods:{type:Object,default:()=>({})}},setup(o){const l=o,m=V(),w=F(()=>{var a;return(((a=l.goods.goodsIcons)==null?void 0:a.split(","))||[""])[0]}),$=()=>{var p,C,I;const e=(p=l.goods)==null?void 0:p.goodsId;if(!e)return;let a={};e&&(a.goodsId=e),(C=l.goods)!=null&&C.storeId&&(a.storeId=(I=l.goods)==null?void 0:I.storeId),m.push({path:"/offlineGoodsDetail",query:{...a,activated:1}})},d=()=>{var a;const e=(a=l.goods)==null?void 0:a.shopId;e&&m.push({path:"/shop",query:{shopId:e,activated:1}})},c=()=>{var a;const e=(a=l.goods)==null?void 0:a.storeId;e&&m.push({path:"/storefront",query:{storeId:e,activated:1}})};return(e,a)=>{const p=B("VanImage");return n(),y("section",{class:"flex items-start bg-white p-3 rounded-xl","data-store-name":o.goods.shopName,onClick:$},[t("div",zo,[k(p,{src:f(w),class:"offline-goods-img w-[60px] h-[60px] rounded-lg overflow-hidden",alt:e.$t("goods.goodsImage"),fit:"cover"},null,8,["src","alt"]),k(oo,{type:+o.goods.goodsType||null},null,8,["type"])]),t("div",Uo,[t("div",Mo,[t("div",Zo,[t("div",Jo,v(o.goods.goodsName||""),1)]),t("div",Ko,[t("div",Qo,[Xo,t("div",Yo,v(f(to)(o.goods.goodsPrice)),1)]),o.goods.goodsDiscountRatio?(n(),h(W,{key:0,class:"ratio-box ml-2 !px-1",tag:e.$t("common.rebate"),ratio:o.goods.goodsDiscountRatio},null,8,["tag","ratio"])):T("",!0)]),t("div",Wo,[t("div",ot,[tt,t("span",st,[t("span",{onClick:N(d,["stop"])},v(o.goods.shopName||""),9,et),o.goods.storeName&&o.goods.shopName?(n(),y("span",at," · ")):T("",!0),t("span",{onClick:N(c,["stop"])},v(o.goods.storeName||""),9,nt)]),lt])])])])],8,Go)}}}),ct=D(it,[["__scopeId","data-v-6a59516e"]]),rt={class:""},dt={class:"dat__wrap text-sm font-b1 font-normal"},ut={class:"log-list__wrap mt-3"},K={props:{data:{type:Object,default:()=>({})},isOffline:{type:Boolean,default:!1}},setup(o){const l=o,m=F(()=>mo().isSame(l.data.day,"day"));return(w,$)=>(n(),y("div",rt,[t("p",dt,v(f(m)?w.$t("common.today"):o.data.day),1),t("div",ut,[(n(!0),y(P,null,R(o.data.goodsList||[],(d,c)=>(n(),y("div",{key:c},[(n(),h(fo(o.isOffline?ct:Ao),{goods:d,class:"mb-3 :last:mb-0"},null,8,["goods"]))]))),128))])]))}},mt=o=>so("GET","/goodsLook/history",o),ft=()=>so("POST","/goodsLook/clear",null),gt=o=>(A("data-v-1a664071"),o=o(),G(),o),pt=gt(()=>t("img",{class:"w-[20px] h-auto",src:ko},null,-1)),ht=[pt],_t={class:"scrollPage p-3 h-[calc(100vh-83px)] overflow-y-auto"},vt=L({name:"BrowsingHistory"});function yt(o){const{t:l}=go(),m=V(),w=po(),$=[{label:l("shop.on-line"),value:1},{label:l("shop.off-line"),value:2}],d=ho({type:Number(w.query.type)||1}),c=s=>{d.type=s||1,m.replace({query:{type:s}}),H()},e=b(!1),a=b(!1),p=b(0),C=b(5),I=b(0),_=b([]),H=()=>{p.value=0,I.value=0,a.value=!1,_.value=[],M()},M=async()=>{e.value=!0,p.value+=1,await eo(),e.value=!1},eo=async()=>{let s=null;if(d.type===1&&(s=await mt({page:p.value,size:C.value})),d.type===2){const u=await wo({page:p.value,size:C.value,sortBy:"desc|create_time"});s={success:u.success,data:u.data.records||[],total:u.data.total||0},s.data&&s.data.forEach(g=>{g.goodsList=g.goodsLooks||[]})}if(!s.success){a.value=!0;return}if(!s.data||!s.total){a.value=!0;return}I.value=s.total;const i=s.data||[];_.value=ao(_.value,i),_.value.length>=I.value&&(a.value=!0)},ao=(s,i)=>{if(p.value===1)return i;const u=[...s];return i.forEach(g=>{const r=u.findIndex(x=>x.day===g.day);r!==-1?u[r].goodsList=[...u[r].goodsList,...g.goodsList]:u.push(g)}),u},[no,O]=J(!1),[lo,E]=J(!1),io=async()=>{let s=null;d.type===1&&(s=await ft()),d.type===2&&(s=await xo()),s.success&&(H(),E(!0)),setTimeout(()=>{E(!1)},1e3)},Z=()=>{O(!1)},co=()=>{io(),O(!1)};let S=null;const ro=async()=>{const s=localStorage.getItem("browsingHistory_scrollTop");+s?(console.log("setCacheScrollTop",+s),S.scrollTo({top:+s,left:0,behavior:"instant"})):localStorage.removeItem("browsingHistory_scrollTop")},j=b(!1),uo=()=>{j.value||(j.value=!0,setTimeout(()=>{localStorage.setItem("browsingHistory_scrollTop",S.scrollTop+""),j.value=!1},500))};return _o(()=>{S=document.querySelector(".scrollPage"),S.addEventListener("scroll",uo)}),vo(()=>{var s,i,u,g;ro(),!(((g=(u=(i=(s=m==null?void 0:m.options)==null?void 0:s.history)==null?void 0:i.state)==null?void 0:u.forward)==null?void 0:g.indexOf("activated=1"))>-1&&_.value.length)&&H()}),(s,i)=>{const u=B("Empty"),g=B("van-list");return n(),h(bo,{title:s.$t("common.browsing history"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(r,x)=>{x.browsingHistoryRef=r}},{right:q(()=>[t("div",{onClick:i[0]||(i[0]=r=>f(O)(!0))},ht)]),default:q(()=>[t("div",null,[k($o,{class:"between-tab__wrap",options:$,"label-key":"label","value-key":"value",modelValue:f(d).type,"onUpdate:modelValue":i[1]||(i[1]=r=>f(d).type=r),onChange:c},null,8,["modelValue"]),t("div",_t,[_.value.length===0&&!e.value?(n(),h(u,{key:0,name:s.$t("common.no records")},null,8,["name"])):(n(),h(g,{key:1,loading:e.value,"onUpdate:loading":i[2]||(i[2]=r=>e.value=r),"finished-text":s.$t("common.noMore"),"loading-text":s.$t("common.loading"),finished:a.value,onLoad:M,"immediate-check":!0},{default:q(()=>[f(d).type===1?(n(!0),y(P,{key:0},R(_.value,(r,x)=>(n(),h(K,{key:x,data:r,isOffline:!1},null,8,["data"]))),128)):(n(!0),y(P,{key:1},R(_.value,(r,x)=>(n(),h(K,{key:x,data:r,isOffline:!0},null,8,["data"]))),128))]),_:1},8,["loading","finished-text","loading-text","finished"]))])]),k(yo,{show:f(no),title:"删除确认",content:"确定要删除全部浏览记录吗？",showConfirm:!0,showReject:!0,rejectText:"取消",confirmText:"确认",onClose:Z,onReject:Z,onConfirm:co,confirmStyle:{background:"#f44",color:"white"}},null,8,["show"]),f(lo)?(n(),h(Io,{key:0,isError:!1,onClose:i[3]||(i[3]=r=>f(E)(!1)),text:"删除成功"})):T("",!0)]),_:1},8,["title"])}}const wt=L({...vt,setup:yt}),jt=D(wt,[["__scopeId","data-v-1a664071"]]);export{jt as default};
