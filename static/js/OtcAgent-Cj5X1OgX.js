import{_ as ke}from"./combustion-retR3UhG.js";import{O as Ce,_ as Fe,a as Se,b as Oe,c as Pe,d as Me,e as ue,C as Be,f as Ee,g as Ie}from"./ContributionPop-CDNUWwQg.js";import{_ as ye,z as ae,r as d,bl as Z,y as de,B as A,D as me,a2 as oe,E as ve,F as B,G as E,H as x,I as e,P as m,U as j,Q as a,O as n,Z as J,$ as C,a4 as R,X as he,Y as xe,q as Ve,ab as Le}from"./vendor-Dr_RpJ_Y.js";import{o as Te}from"./OtcAgent-DbyQlQZS.js";import{o as _e}from"./OTCContract-Cb1B50DA.js";import{ai as Y,b9 as pe,G as be,g as Ue,e as De,ba as fe,w as Ne}from"./index-7OiUoGXy.js";import{C as je}from"./Combustion-CfrYh9Vr.js";import{l as Re}from"./otc-DQ7C8aiz.js";import{_ as qe}from"./BgBox-CMS_qDm1.js";import"./exchangeContract-DP98fDGp.js";import"./bg-dot-DBVQRM9t.js";const q=i=>(he("data-v-70d6b57b"),i=i(),xe(),i),ze={class:"relative"},Ge={key:0},He=q(()=>e("img",{class:"w-[51.5%]",src:Fe,alt:""},null,-1)),Qe=q(()=>e("img",{class:"w-[51.5%] absolute top-0 right-0",src:Se,alt:""},null,-1)),Xe={class:"flex items-center z-10 h-full absolute top-0 w-full text-xs font-medium text-[#2E2008]"},Ye={class:"flex-1 text-center text-white"},Ze={key:1},Je=q(()=>e("img",{class:"w-[51.5%]",src:Oe,alt:""},null,-1)),Ke=q(()=>e("img",{class:"w-[51.5%] absolute top-0 right-0",src:Pe,alt:""},null,-1)),We={class:"flex items-center z-10 h-full absolute top-0 w-full text-xs font-medium text-[#2E2008]"},et={class:"flex-1 text-center text-white"},tt={class:"flex items-center text-[0.65rem] text-[#2E2008] mt-2"},st={class:"opacity-60 whitespace-nowrap"},nt={class:"ml-auto"},ot=q(()=>e("img",{class:"w-3 h-3",src:Me},null,-1)),at=[ot],lt={class:"flex justify-between items-center bg-[#F6F2EB] mt-1.5 rounded-xl py-1 px-2 text-[#2E2008]"},it={class:"text-xs opacity-60 whitespace-nowrap"},ct={class:"text-xs opacity-60 whitespace-nowrap"},rt={class:"flex justify-between items-center bg-[#F6F2EB] my-2 rounded-xl py-1 px-2 text-[#2E2008]"},ut={class:"text-xs opacity-60 whitespace-nowrap"},dt={class:"text-xs opacity-60 whitespace-nowrap"},mt={class:"flex justify-between items-center bg-[#F6F2EB] mt-2 rounded-xl py-1 px-2 text-[#2E2008]"},pt={class:"text-xs opacity-60 whitespace-nowrap"},bt={class:"text-xs opacity-60 whitespace-nowrap"},ft={class:"flex justify-between text-[0.65rem] text-[#2E2008] mt-2.5"},yt={class:"opacity-60"},vt={class:"flex flex-col items-center justify-center mt-2.5 text-white"},ht={key:0,class:"opacity-60 text-[0.65rem] text-[#2E2008] mt-2.5"},xt={class:"my-2 bg-[#F6F2EB] p-2 rounded-xl"},_t={class:"flex justify-between text-[0.65rem] text-[#2E2008]"},gt={class:"opacity-60 whitespace-nowrap"},wt={class:"flex justify-between text-[0.65rem] text-[#2E2008]"},$t={class:"opacity-60 whitespace-nowrap"},At=ae({props:{type:null,lastPrice:null},emits:["changeTab","success","handleTo"],setup(i,{expose:F,emit:S}){const y=i,{mai:_,MIN_AMOUNT:W,musd:O,balances:ee,estimateBuy:z,estimateSell:p}=_e(),{buy:G,sell:H}=Te(),b=d("MUSD"),I=s=>{b.value=s==="buy"?"MUSD":"MAI",ne(),S("changeTab",s),X()},V=()=>{t.price=Math.round(t.price/.05)*.05},t=Z({number:null,price:null,totalAmount:null}),Q=de(()=>{if(t.price){if(y.type==="buy")return $[b.value]/t.price;if(y.type==="sell")return $[b.value]*t.price}else return 0;return 0}),L=de(()=>{const s={immediate:0,remain:0};return t.totalAmount&&(y.type==="buy"?(s.immediate=+A(t.number).minus(o.value.remain),s.remain=o.value.remain):y.type==="sell"&&(s.immediate=+A(t.number).minus(o.value.remain),s.remain=o.value.remain)),s}),g=d(!0),P=d(!0),v=d(!0),T=()=>{g.value=!1,P.value=!0,v.value=!0},U=()=>{g.value=!0,P.value=!1,v.value=!0},w=()=>{g.value=!0,P.value=!0,v.value=!1};me(()=>t.price,s=>{if(g.value)return;M.value.resetValue();const u=new A(t.number),k=new A(s);t.totalAmount=+u.times(k),r()});const M=d(null),D=d(!1);me(()=>t.number,s=>{if(P.value)return;f.value?(w(),D.value=!0,f.value=!1):M.value.resetValue();const u=new A(t.price),k=new A(s);t.totalAmount=+k.times(u),r()});const l=s=>{v.value||(!f.value&&!D.value?M.value.resetValue():(D.value=!1,f.value=!1),t.price||(t.price=y.lastPrice),t.number=s/t.price,r())},o=d({gain:null,remain:null}),r=async()=>{if(t.number&&t.price&&t.totalAmount){const s=y.type==="buy"?await z(t.price,t.number):await p(t.price,t.number);s.success&&(o.value.gain=be(s.result.gain),o.value.remain=be(s.result.remain))}else o.value.gain=null,o.value.remain=null},f=d(!1),N=s=>{t.price&&(f.value=!0,y.type==="buy"?(w(),t.totalAmount=+new A(s*$[b.value]*.01)):(U(),t.number=+new A(s*$[b.value]*.01)))},X=()=>{t.number=null,t.price=null,t.totalAmount=null},c=d(0),te=async()=>{const s=await W();c.value=+s},se=Z({MAI:"",MUSD:""}),$=Z({MAI:0,MUSD:0}),ge=async()=>{se.MUSD=await O(),se.MAI=await _()},we=async()=>{const s=await ee(se[b.value],Ue.otcAgent);$[b.value]=De(+s)},[le,ie]=oe(!1),ce=async()=>{ie(!0);const s=y.type==="buy"?await G(t.price,t.number):await H(t.price,t.number);ie(!1),s.success&&(ne(),S("success"))},$e=s=>{T(),t.price=s},ne=async()=>{X(),await we()};return ve(async()=>{te(),await ge(),ne()}),F({setPrice:$e}),(s,u)=>{const k=B("VanField"),re=B("VanButton");return x(),E("div",null,[e("div",ze,[i.type=="buy"?(x(),E("div",Ge,[He,Qe,e("div",Xe,[e("span",Ye,a(s.$t("otc.buyIn")),1),e("span",{class:"flex-1 text-center opacity-60",onClick:u[0]||(u[0]=h=>I("sell"))},a(s.$t("otc.sellOut")),1)])])):j("",!0),i.type=="sell"?(x(),E("div",Ze,[Je,Ke,e("div",We,[e("span",{class:"flex-1 text-center opacity-60",onClick:u[1]||(u[1]=h=>I("buy"))},a(s.$t("otc.buyIn")),1),e("span",et,a(s.$t("otc.sellOut")),1)])])):j("",!0)]),e("div",tt,[e("span",st,a(s.$t("otc.Available")),1),e("span",nt,a(n(Y)(n($)[b.value]))+" "+a(i.type==="buy"?"MUSD":"MAI"),1),e("div",{class:"ml-1.5",onClick:u[2]||(u[2]=()=>{S("handleTo",`/otc-recharge-agent?type=${i.type}`)})},at)]),e("div",lt,[e("span",it,a(s.$t("mall.price")),1),m(k,{"input-align":"right",class:"flex-1 bg-[#F6F2EB] text-base font-bold text-[#2E2008]",modelValue:n(t).price,"onUpdate:modelValue":u[3]||(u[3]=h=>n(t).price=h),onFocus:T,type:"number",placeholder:"0",formatter:n(pe),onBlur:V},null,8,["modelValue","formatter"]),e("span",ct,a((i.type==="buy","MUSD")),1)]),e("div",rt,[e("span",ut,a(s.$t("ecology.quantity")),1),m(k,{"input-align":"right",class:"flex-1 bg-[#F6F2EB] text-base font-bold text-[#2E2008]",modelValue:n(t).number,"onUpdate:modelValue":u[4]||(u[4]=h=>n(t).number=h),onFocus:U,type:"number",placeholder:"0",formatter:n(pe)},null,8,["modelValue","formatter"]),e("span",dt,a((i.type==="buy","MAI")),1)]),m(Ce,{ref:(h,Ae)=>{Ae.OtcSliderRef=h,M.value=h},onChange:N},null,512),e("div",mt,[e("span",pt,a(s.$t("otc.Turnover")),1),m(k,{"input-align":"right",class:"flex-1 bg-[#F6F2EB] text-base font-bold text-[#2E2008]",onFocus:w,modelValue:n(t).totalAmount,"onUpdate:modelValue":[u[5]||(u[5]=h=>n(t).totalAmount=h),l],type:"number",placeholder:"0"},null,8,["modelValue"]),e("span",bt,a((i.type==="buy","MUSD")),1)]),e("div",ft,[e("span",yt,a(i.type==="buy"?s.$t("otc.Availabletobuy"):s.$t("otc.Availableforsale")),1),e("span",null,a(n(Y)(n(Q)))+" "+a(i.type==="buy"?"MAI":"MUSD"),1)]),e("div",vt,[i.type==="buy"?(x(),J(re,{key:0,onClick:ce,disabled:+n(t).price<=0||n(t).number<c.value||n(t).totalAmount>n($)[b.value],loading:n(le),class:"font-semibold h-[38px] w-full px-4 rounded-xl text-base",style:{"background-color":"#14d8a9"}},{default:C(()=>[R(a(s.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(x(),J(re,{key:1,onClick:ce,disabled:+n(t).price<=0||n(t).number<c.value||n(t).number>n($)[b.value],loading:n(le),class:"font-semibold h-[38px] w-full px-4 rounded-xl text-base",style:{"background-color":"#ff507a"}},{default:C(()=>[R(a(s.$t("common.submit")),1)]),_:1},8,["disabled","loading"]))]),y.type==="sell"?(x(),E("div",ht,a(s.$t("otc.otcTip",{num:"30%"})),1)):j("",!0),e("div",xt,[e("div",_t,[e("span",gt,a(s.$t("flashSale.Expected-to-close-immediately")),1),e("span",null,a(n(Y)(n(L).immediate))+" "+a((i.type==="buy","MAI")),1)]),e("div",wt,[e("span",$t,a(s.$t("flashSale.Estimated-order-quantity")),1),e("span",null,a(n(Y)(n(L).remain))+" "+a((i.type==="buy","MAI")),1)])])])}}}),kt=ye(At,[["__scopeId","data-v-70d6b57b"]]),K=i=>(he("data-v-537d27ec"),i=i(),xe(),i),Ct={class:"bg-[#FFFDF8] rounded-xl p-4 pt-4 pb-3.5"},Ft={class:"flex items-center justify-between"},St=K(()=>e("span",{class:"text-lg text-[rgb(46,32,8)]"},"MAI/MUSD",-1)),Ot=K(()=>e("img",{class:"w-7 h-7",src:ke},null,-1)),Pt=[Ot],Mt=K(()=>e("img",{class:"w-7 h-7",src:Ee},null,-1)),Bt=[Mt],Et=K(()=>e("img",{class:"w-7 h-7",src:Ie},null,-1)),It=[Et],Vt={class:"flex mt-2"},Lt={class:"w-5/12 mr-2"},Tt={class:"my-1.5"},Ut={class:"text-2xl font-bold text-[#F36B07] text-center"},Dt={class:"text-xs text-[#2E2008] opacity-60 text-center"},Nt={class:"mb-2"},jt={class:"opacity-40"},Rt={class:"pb-3 text-center"},qt={class:"w-7/12 ml-2"},zt={class:"border-t border-[#e5e4df] border-solid py-2.5 flex justify-between text-[#2E2008]"},Gt=ae({props:{isOld:{type:Boolean}},setup(i){const{loadingToggle:F}=Ne(),S=Ve(),{priceList:y}=_e(),_=d(!1),W=d(["0.05","0.1"]),O=d(.05),ee=async l=>{if(O.value=l,!v.value){_.value=!1;return}await U(),_.value=!1},z=l=>{var o=[];if(Object.keys(l).length<=0)return[];for(const r in l){const f={amount:l[r],price:r};o.push(f)}return o},p=Z({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),[G,H]=oe(!1),[b,I]=oe(!1),V=d("buy"),t=l=>{V.value=l},Q=d(null),L=l=>{Q.value.setPrice(l.price)},g=async()=>{const l=await Re();l.success&&(p.lastPrice=l.data&&+l.data.price||0)},P=d(50),v=d(null),T=async()=>{const l=await y(P.value);v.value=l.result,U()},U=async()=>{const l=fe(v.value.buyPriceList,v.value.buySumList,O.value);p.buyOrderList=z(l).sort((r,f)=>f.price-r.price).filter(r=>r.amount>=.01);const o=fe(v.value.sellPriceList,v.value.sellSumList,O.value);p.sellOrderList=z(o).sort((r,f)=>r.price-f.price).filter(r=>r.amount>=.01)},w=l=>{S.push(l)},M=async()=>{F(!0),await T(),await Promise.all([g()]),F(!1)};ve(async()=>{await M()});const D=setInterval(()=>{T()},3e3);return Le(()=>{clearInterval(D)}),(l,o)=>{const r=B("van-icon"),f=B("van-picker"),N=B("VanButton"),X=B("van-popup");return x(),E("div",Ct,[e("div",Ft,[St,e("div",null,[e("div",{class:"w-7 h-7 inline-block mr-2.5",onClick:o[0]||(o[0]=c=>n(H)(!0))},Pt),e("div",{class:"w-7 h-7 inline-block mr-2.5",onClick:o[1]||(o[1]=c=>n(I)(!0))},Bt),e("div",{class:"inline-block w-7 h-7",onClick:o[2]||(o[2]=c=>w(`/otc-recharge-agent?type=${V.value}`))},It)])]),e("div",Vt,[e("div",Lt,[m(ue,{type:"sell",list:n(p).sellOrderList,onOnClick:L},null,8,["list"]),e("div",Tt,[e("div",Ut,a(n(p).lastPrice),1),e("div",Dt,a(l.$t("ecology.Latesttransactionprice")),1)]),m(ue,{type:"buy",list:n(p).buyOrderList,onOnClick:L},null,8,["list"]),e("div",Nt,[e("div",{class:"rounded bg-[#F6F2EB] py-1 px-2 flex-center-bw",onClick:o[3]||(o[3]=c=>_.value=!0)},[e("div",jt,a(O.value),1),m(r,{name:"arrow-down"})]),m(X,{show:_.value,"onUpdate:show":o[6]||(o[6]=c=>_.value=c),round:"",position:"bottom"},{default:C(()=>[m(f,{columns:W.value,onCancel:o[4]||(o[4]=c=>_.value=!1),onConfirm:ee},null,8,["columns"]),e("div",Rt,[m(N,{class:"w-[150px] h-[40px] rounded-3xl bg-white text-[#FEA021] border-orange",onClick:o[5]||(o[5]=c=>_.value=!1)},{default:C(()=>[R(a(l.$t("common.cancel")),1)]),_:1})])]),_:1},8,["show"])])]),e("div",qt,[m(kt,{lastPrice:n(p).lastPrice,ref:(c,te)=>{te.OtcOperateRef=c,Q.value=c},type:V.value,onChangeTab:t,onHandleTo:w,onSuccess:g},null,8,["lastPrice","type"])])]),e("div",zt,[m(N,{class:"btn h-auto py-1.5 flex-1 mr-1.5 rounded-md text-xs font-medium",onClick:o[7]||(o[7]=c=>w("/entrust?key=Agent"))},{default:C(()=>[R(a(l.$t("otc.Currentorder")),1)]),_:1}),m(N,{class:"btn h-auto py-1.5 flex-1 ml-1.5 rounded-md text-xs font-medium",onClick:o[8]||(o[8]=c=>w("/historyEntrust?key=Agent"))},{default:C(()=>[R(a(l.$t("otc.historyorder")),1)]),_:1})]),n(G)?(x(),J(je,{key:0,show:n(G),lastPrice:n(p).lastPrice,musd:n(p).musd,mai:n(p).token,onClose:o[9]||(o[9]=c=>n(H)(!1)),onSuccess:g},null,8,["show","lastPrice","musd","mai"])):j("",!0),n(b)?(x(),J(Be,{key:1,lastPrice:n(p).lastPrice,show:n(b),onClose:o[10]||(o[10]=c=>n(I)(!1)),onSetOtcType:t},null,8,["lastPrice","show"])):j("",!0)])}}}),Ht=ye(Gt,[["__scopeId","data-v-537d27ec"]]),Qt={class:"h-full relative"},as=ae({setup(i){return(F,S)=>(x(),E("div",Qt,[m(qe,{icon:"svg/ecology/otc.svg",text:F.$t("ecology.otc")},{default:C(()=>[m(Ht)]),_:1},8,["text"])]))}});export{as as default};
