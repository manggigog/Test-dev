import{_ as J,z as Q,r as d,a2 as q,E as ne,F,G as w,H as c,I as l,P as x,$ as L,Z as B,O as a,J as ae,a3 as E,Q as M,x as qe,a0 as ze,j as G,X as we,Y as ke,K as xe,N as W,U as z,q as Ye,R as je,y as oe,D as Ue,a4 as Qe,bv as He,bx as Oe,V as Ke}from"./vendor-Dr_RpJ_Y.js";import{N as Ge}from"./NoRanking-D6NZKsWK.js";import{R as ye,_ as We,a as Je}from"./RankingShopItem-APtpzlne.js";import{b as $e,u as Xe,$ as Ze,k as ge,f as et,a as tt,bB as _e,Y as ot,C as st}from"./index-CU2nzZe6.js";import{q as se,a as nt,b as at}from"./beiRanking-B5hPI_dv.js";import{q as lt}from"./user-CDTMM2rk.js";import{b as Ce}from"./beiExtRewardContract-B7mJr7nC.js";import{_ as rt}from"./calendar-yellow-DuCGlPYa.js";import{S as ut}from"./ShopVotePop-3A0HJTbL.js";import{V as it}from"./VoteRewardPop-DfWpLD45.js";import{C as ct}from"./CommonVanProvider-KZuKVOde.js";import{B as dt}from"./BackIcon-CDrGaEPo.js";import"./Lottie_v2-DIiMHpUu.js";import"./member-CkdtKF8y.js";import"./SkewCard-C0W1kxOf.js";import"./shop-CeqcS6K2.js";import"./beiConstContract-BSRzZQRe.js";import"./useKeyboard-DcWqtm11.js";const pt="/static/images/house-DNyMjcNF.png",vt="/static/images/store_title-D2qn3MNS.png",ht="/static/images/search-line-DiUN1tEO.svg",ft="/static/images/cat-ip-rRx8dUh9.png",mt=["onClick"],gt={class:"box-bg"},_t=["onClick"],wt=Q({props:{month:null},emits:["toApply","toApplyShop","toQuit"],setup(f,{expose:y,emit:S}){const{checkLoginAuth:m,isLogin:D}=$e(),{voteMonthTimestampView:t}=Ce(),g=Xe().getCurrentAccount(),r=d(null),h=d(null),T=()=>{var u,s;m(!0)&&((u=r.value)!=null&&u.id&&((s=r.value)==null?void 0:s.status)===1?S("toApply"):S("toApplyShop"))},[_,p]=q(!1),A=async()=>{p(!0);const{success:u,data:s}=await Ze();if(!u||(s==null?void 0:s.status)!==1){if(r.value={...s,status:0,shopAddress:g},!r.value.storeName){const{success:i,data:v}=await lt();i&&(v!=null&&v.nickName)&&(r.value.storeName=v==null?void 0:v.nickName)}p(!1);return}r.value=s,r.value.shopAddress=s==null?void 0:s.merchant,r.value.shopId=s==null?void 0:s.id,Y()},Y=async()=>{var v,k,$;if(!((v=r.value)!=null&&v.shopId))return;p(!0);const{result:u}=await t(),{success:s,data:i}=await se({shopId:(k=r.value)==null?void 0:k.shopId,month:+u.thisMonthTime});p(!1),!(!s||!i)&&(h.value=i,(($=h.value)==null?void 0:$.status)!==1&&(h.value.sort=null))},P=()=>{m(!1)&&A()};return ne(()=>{P()}),y({getRankingInfo:Y}),(u,s)=>{var v;const i=F("VanLoading");return c(),w("div",{class:"fixed bottom-0 w-full sm:w-[375px] mx-auto",onClick:E(T,["stop"])},[l("div",gt,[x(ye,{rankItem:h.value||r.value,hideScore:((v=h.value)==null?void 0:v.status)!==1,showPower:!0,class:"pl-4 pr-5"},{right:L(()=>{var k,$,C,N;return[a(_)?(c(),B(i,{key:0,size:"20"})):(c(),w(ae,{key:1},[((k=r.value)==null?void 0:k.status)===1&&(($=h.value)==null?void 0:$.status)===1?(c(),w("div",{key:0,class:"bg-[#FFF8EC] text-[#7D3619] font-semibold rounded-md px-3 py-1.5 min-w-[52px]",onClick:s[0]||(s[0]=E(le=>S("toQuit"),["stop"]))},M(u.$t("ranking.Exit list")),1)):(c(),w("div",{key:1,class:"btn-linear text-b6 font-semibold px-3 py-1.5 min-w-[52px]",onClick:E(T,["stop"])},M((C=r.value)!=null&&C.id&&((N=r.value)==null?void 0:N.status)===1?u.$t("ranking.Go and apply"):u.$t("shop.applyShop")),9,_t))],64))]}),_:1},8,["rankItem","hideScore"])])],8,mt)}}}),kt=J(wt,[["__scopeId","data-v-4022e765"]]),xt=f=>(we("data-v-1ed5e45f"),f=f(),ke(),f),yt=xt(()=>l("img",{class:"w-4 h-4",src:rt,alt:""},null,-1)),$t={key:0},Ct={key:1},bt={class:"flex items-end px-5 py-4 text-sm"},St=Q({props:{pageType:null},emits:["changeTime"],setup(f,{emit:y}){const S=f,{t:m}=qe(),[D,t]=q(!1),{voteMonthTimestampView:g}=Ce(),r=d(),h=d(new Date),T=d(new Date),_=d(""),p=d(""),A=()=>{r.value=h.value,p.value=G(r.value).format("MM"),_.value=G(r.value).format("YYYY"),t(!1),y("changeTime",{years:_.value,cycle:p.value})},Y=async()=>{const{result:s}=await g();h.value=new Date(+s.thisMonthTime*1e3),p.value=G(h.value).format("MM"),_.value=G(h.value).format("YYYY")},P=()=>{r.value=null,h.value=T.value,p.value="",_.value="",t(!1),y("changeTime",{years:1e4})},u=(s,i)=>s==="month"?`${i}${m("common.month")}`:i;return ne(async()=>{S.pageType!=="record"&&await Y(),_.value&&y("changeTime",{years:_.value,cycle:p.value})}),(s,i)=>{const v=F("van-datetime-picker"),k=F("van-popup");return c(),w("div",{class:"text-[#4D2E0F] font-semibold flex flex-shrink-0 pl-1.5 pr-2 items-center gap-0.5 h-7 bg-[#FFF8EC] rounded-3xl",onClick:i[3]||(i[3]=$=>a(t)(!0))},[yt,_.value&&p.value?(c(),w("span",$t,M(_.value+"-"+p.value),1)):(c(),w("span",Ct,M(s.$t("ranking.overall_ranking")),1)),x(k,{round:"",teleport:"body",show:a(D),"onUpdate:show":i[2]||(i[2]=$=>ze(D)?D.value=$:null),position:"bottom",style:{height:"40%"}},{default:L(()=>[l("div",bt,[l("div",{class:"opacity-50",onClick:P},M(s.$t("ranking.overall_ranking")),1),l("div",{class:"ml-auto text-[#FEA021] text-sm",onClick:i[0]||(i[0]=$=>A())},M(s.$t("common.confirm")),1)]),x(v,{"swipe-duration":"200",modelValue:h.value,"onUpdate:modelValue":i[1]||(i[1]=$=>h.value=$),type:"year-month",title:"","max-date":T.value,"show-toolbar":!1,formatter:u},null,8,["modelValue","max-date"])]),_:1},8,["show"])])}}}),It=J(St,[["__scopeId","data-v-1ed5e45f"]]),Tt={class:"flex items-end justify-center mx-[7px] mt-12"},Rt=["onClick"],Vt=["onClick"],Ft={class:"relative w-[50px] h-[50px] rounded-full avatar-img mx-auto"},Dt=["src"],At=["src"],Pt=["onClick"],Bt={class:"max-w-[90%] line-clamp-1 text-center text-[#7D3100]"},Lt={key:0,class:"flex flex-col items-center"},Et={class:"text-xs text-b2 leading-[18px]"},Mt=["onClick"],Nt={class:"relative text-[#4D2E0F] text-right text-[22px] font-BebasNeue"},qt={key:0,class:"absolute right-[-22px] bottom-0 text-xs flex gap-x-1 min-w-fit"},zt=Q({props:{rankingTopList:null,showPower:{type:Boolean}},emits:["voteShop","toDetail"],setup(f,{emit:y}){const{rankingTopList:S}=f;return(m,D)=>(c(),w("div",Tt,[(c(!0),w(ae,null,xe(f.rankingTopList,(t,g)=>(c(),w("div",{key:g,class:W(["min-h-[120px] text-center relative px-1",`bg-linear__${g==1?"one":g==0?"two":"three"}`]),onClick:E(r=>y("voteShop",t),["stop"])},[l("div",{class:"-mt-[15px] relative",onClick:E(r=>y("toDetail",t),["stop"])},[l("div",Ft,[l("img",{src:((t==null?void 0:t.logo)||"").split()[0]||a(ge)("images/ranking/noPosition.png"),class:"object-cover w-full h-full rounded-full"},null,8,Dt),l("img",{src:a(ge)(`images/ranking/top_${g}.png`),class:"w-8 h-auto absolute -top-4 -left-4"},null,8,At)])],8,Vt),l("div",{class:"mt-2 flex justify-center items-center",onClick:E(r=>y("toDetail",t),["stop"])},[l("div",Bt,M((t==null?void 0:t.storeName)||m.$t("ranking.Waiting for a vacant position")),1)],8,Pt),t?(c(),w("div",Lt,[l("div",Et,M(a(et)(t==null?void 0:t.shopAddress,"**",0,4)),1),l("div",{class:"flex items-center justify-center gap-x-1 mt-2",onClick:E(r=>y("voteShop",t),["stop"])},[l("div",Nt,[x(We,{score:t==null?void 0:t.score},null,8,["score"]),f.showPower?(c(),w("div",qt,[x(Je,{direction:t==null?void 0:t.direction,onCompletePlay:()=>{t.direction=null}},null,8,["direction","onCompletePlay"])])):z("",!0)])],8,Mt),l("div",{class:W(["-mt-6 w-8 h-4 font-bold text-base text-center text-[#995C1F] index-number",{up:(t==null?void 0:t.preHeat)&&+(t==null?void 0:t.sort)<+(t==null?void 0:t.preHeat),down:(t==null?void 0:t.preHeat)&&+(t==null?void 0:t.sort)>+(t==null?void 0:t.preHeat)}])},null,2)])):z("",!0)],10,Rt))),128))]))}}),Yt=J(zt,[["__scopeId","data-v-5aa8ab90"]]),j=f=>(we("data-v-7d6de0f9"),f=f(),ke(),f),jt={class:"parent-view",id:"ranking"},Ut={class:"flex flex-col w-full h-auto bg-mask parent-view"},Qt={class:"h-[50px] text-b2 flex items-center justify-between px-3"},Ht=Qe(" 规则 "),Ot={key:0,class:"absolute -right-1 top-0 w-2 h-2 bg-error rounded-full"},Kt={class:"px-4 pt-5 pb-3 relative"},Gt=j(()=>l("img",{src:pt,class:"w-[156px] h-auto absolute left-10 -top-6 -z-[11]"},null,-1)),Wt=j(()=>l("div",{class:"min-h-[44px] relative -z-10"},[l("img",{src:vt,class:"w-[200px] h-auto"})],-1)),Jt={class:"mt-5 flex items-center gap-x-2 relative"},Xt=j(()=>l("img",{src:ht,class:"w-4 h-4"},null,-1)),Zt=[Xt],eo=j(()=>l("div",{class:"text-newOrigin font-semibold"},"搜索",-1)),to=j(()=>l("img",{src:ft,class:"w-[150px] h-auto absolute left-[203px] -top-3 -z-0"},null,-1)),oo=["onClick"],so=j(()=>l("span",{class:"text-sm text-[#663D15]"},"奖励记录",-1)),no=Q({name:"TalentRanking"});function ao(f){const{checkLoginAuth:y}=$e(),S=Ye(),m=d(null),D=d(),{height:t}=je(),g=d(null),r=o=>{+o.years>=1e4?m.value=1e4:m.value=_e(`${o.years}-${o.cycle}`),Pe()},{rankingStore:h}=tt(),T=d(!1),_=d(!1),p=d(!1),A=d(0),Y=d(20),P=d(0),u=d([]),s=d(null),[i,v]=q(!1),[k,$]=q(!1),C=d(null),N=oe(()=>+_e()==+m.value),le=async()=>{const{success:o,data:e,params:b}=await at({page:A.value,size:Y.value,month:m.value,shopNameLike:C.value});if(!o||!e||!(e!=null&&e.total)||b.month&&+b.month!=+m.value){P.value=e==null?void 0:e.total,p.value=!0;return}const I=(e==null?void 0:e.records)||[];P.value=e.total,u.value=A.value===1?I:u.value.concat(I),u.value&&u.value.length>=P.value&&(p.value=!0)},re=oe(()=>u.value?k.value?u.value:u.value.slice(3):[]),be=oe(()=>k.value?[]:[u.value[1],u.value[0],u.value[2]]),R=d({shopId:null,score:null}),[ue,ie]=q(!1),ce=o=>{y(!0)&&(!(o!=null&&o.shopId)||!N.value||(R.value=o,ie(!0)))},de=o=>{o!=null&&o.shopId&&(R.value=o,U(`/talentRanking/rankingShop?shopId=${o.shopId}`))},[Se,H]=q(!1),[Ie,pe]=q(!1),Te=async()=>{var e;pe(!0);const{success:o}=await nt();H(!1),o&&(O(),(e=g.value)==null||e.getRankingInfo(),pe(!1))},ve=async()=>{_.value=!0,A.value+=1,await le(),_.value=!1},X=d(null),Re=()=>{X.value&&X.value.handleShowReward()},Ve=async(o,e,b=!1)=>{var I;o!=null&&o.shopId&&(e.direct===200?o.score+=e==null?void 0:e.differ:o.score-=e==null?void 0:e.differ,o.direction=e.direct,g.value&&((I=g.value)==null||I.getRankingInfo()),setTimeout(()=>{o.direction=null,b&&Re()},2e3),setTimeout(async()=>{const{success:ee,data:te}=await se({shopId:o==null?void 0:o.shopId,month:m.value});ee&&(o.score=te.score)},5e3))},Fe=async()=>{var b,I;if(!(R!=null&&R.value.shopId))return;const{success:o,data:e}=await se({shopId:(b=R.value)==null?void 0:b.shopId,month:m.value});o&&(R.value.score=e.score,g.value&&((I=g.value)==null||I.getRankingInfo()))},De=()=>{var o;s.value&&((o=s.value)==null||o.focus())};Ue(()=>C.value,async(o,e)=>{var b;!o&&e&&i.value&&(s.value&&((b=s.value)==null||b.blur()),k.value&&K())},{immediate:!1,deep:!0});const O=()=>{A.value=0,p.value=!1,u.value=[],ve()},K=()=>{var o;$(!!(C!=null&&C.value)),(o=s.value)==null||o.blur(),O()},Ae=()=>{T.value=!1,O()},Pe=()=>{Z&&(Le.value=Z.scrollTop),O()},U=o=>{S.push(o)},Be=()=>{if(!y(!0))return;(S.options.history.state.back||"").toString().includes("talentRanking")?S.replace("/rankingReward"):U("/rankingReward")};let Z=null;const Le=d(0);return ne(()=>{D.value=t.value,Z=document.querySelector(".list__wrap")}),(o,e)=>{const b=F("VanField"),I=F("VanConfigProvider"),ee=F("VanImage"),te=F("VanList"),Ee=F("van-pull-refresh"),Me=F("router-view");return c(),B(ct,{class:"h-full font-Puhui font-normal relative",style:Ke([{background:"linear-gradient(180deg, #fed820 3%, #fea020 30%, #fed820 85%)"},{minHeight:`${D.value}px`}]),themeVars:{navBarBackgroundColor:"transparent",navBarIconColor:"#000"}},{default:L(()=>{var he,fe;return[l("div",jt,[l("div",Ut,[l("div",Qt,[x(dt),l("div",{class:"pl-2 relative",onClick:e[0]||(e[0]=n=>U("/talentRanking/rankingRule"))},[Ht,(he=a(h))!=null&&he.ruleRead?z("",!0):(c(),w("div",Ot))])]),l("div",Kt,[Gt,Wt,l("div",Jt,[x(It,{pageType:"list",onChangeTime:r}),x(I,{"theme-vars":{"field-placeholder-text-color":"#4D2E0F","field-input-text-color":"#4D2E0F"},class:"flex-1"},{default:L(()=>[x(b,{ref:(n,V)=>{V.searchRef=n,s.value=n},class:W(["bg-[#FFF8EC] rounded-full h-7 flex items-center font-normal pl-1.5 pr-2 transition-all duration-300 relative z-10",a(i)||C.value?"flex-1":"w-[60px]"]),onFocus:e[1]||(e[1]=n=>a(v)(!0)),onBlur:e[2]||(e[2]=n=>a(v)(!1)),modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=n=>C.value=n),clearable:"",placeholder:a(i)?"":"搜索",onClear:K,onKeyup:He(K,["enter"]),enterkeyhint:"search",onClickRightIcon:K},Oe({"left-icon":L(()=>[l("div",{onClick:De},Zt)]),_:2},[a(i)||C.value?{name:"right-icon",fn:L(()=>[eo])}:void 0]),1032,["class","modelValue","placeholder","onKeyup"])]),_:1})]),to]),x(Ee,{modelValue:T.value,"onUpdate:modelValue":e[6]||(e[6]=n=>T.value=n),onRefresh:Ae,class:"list__wrap relative flex-1 overflow-auto rounded-t-xl mx-2"},{default:L(()=>[a(k)?z("",!0):(c(),w("div",{key:0,class:"absolute z-10 -right-1 top-4 w-fit h-fit py-[5px] px-2 bg-[#FFE4AD] border border-solid border-[rgba(255,255,255,0.64)] rounded-s-full flex items-center min-w-fit",onClick:E(Be,["stop"])},[so,x(ee,{class:"ml-[2px] w-4 h-4",src:a(ot)("ranking/record_arrow.svg")},null,8,["src"])],8,oo)),!a(k)&&u.value.length>0?(c(),B(Yt,{key:1,rankingTopList:a(be),showPower:a(N),onVoteShop:e[4]||(e[4]=n=>ce(n)),onToDetail:e[5]||(e[5]=n=>de(n))},null,8,["rankingTopList","showPower"])):z("",!0),!_.value&&p.value&&P.value==0?(c(),B(Ge,{key:2})):(c(),B(te,{key:3,loading:_.value,finished:p.value,"finished-text":o.$t("common.noMore"),"immediate-check":!1,class:"min-h-[40vh] pb-[100px] relative z-10",onLoad:ve},{default:L(()=>[(c(!0),w(ae,null,xe(a(re),(n,V)=>{var me;return c(),B(ye,{key:n.id,rankItem:n,showPower:a(N),onVoteShop:Ne=>ce(n),onToDetail:Ne=>de(n),class:W(["relative",{"active-bottom":V+1!==((me=a(re))==null?void 0:me.length)}])},null,8,["rankItem","showPower","onVoteShop","onToDetail","class"])}),128))]),_:1},8,["loading","finished","finished-text"]))]),_:1},8,["modelValue"])]),a(N)&&!a(k)?(c(),B(kt,{key:0,ref:(n,V)=>{V.userOwnerRef=n,g.value=n},month:m.value,onToApply:e[7]||(e[7]=n=>U("/joinRanking")),onToApplyShop:e[8]||(e[8]=n=>U("/editShopInfo")),onToQuit:e[9]||(e[9]=n=>a(H)(!0))},null,8,["month"])):z("",!0)]),a(ue)?(c(),B(ut,{key:0,show:a(ue),shopId:(fe=R.value)==null?void 0:fe.shopId,teleport:"#ranking",onClose:e[10]||(e[10]=n=>a(ie)(!1)),onVoteSuccess:e[11]||(e[11]=(n,V)=>Ve(R.value,n,V))},null,8,["show","shopId"])):z("",!0),x(it,{ref:(n,V)=>{V.voteRewardRef=n,X.value=n}},null,512),x(st,{show:a(Se),content:"您的店铺本月已存在被投票充电记录，本次退出榜单操作将在下月生效",showConfirm:!0,showReject:!0,loading:a(Ie),confirmText:"确认退榜",noClose:"","content-class":"text-b1 font-semibold",onClose:e[12]||(e[12]=n=>a(H)(!1)),onConfirm:Te,onReject:e[13]||(e[13]=n=>a(H)(!1))},null,8,["show","loading"]),x(Me,{class:"child-view",onVoteSuccess:Fe})]}),_:1},8,["style"])}}const lo=Q({...no,setup:ao}),So=J(lo,[["__scopeId","data-v-7d6de0f9"]]);export{So as default};
