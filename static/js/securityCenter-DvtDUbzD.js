import{_ as _e,r as p,a2 as m,y,E as ye,ab as Ce,Z as Te,H as b,$ as S,q as be,F as Se,I as e,P as u,G as P,U as H,Q as q,O as a,a3 as Le,bj as Ae,bt as Ve,X as Ie,Y as ke,T as r,u as Me}from"./vendor-Dr_RpJ_Y.js";import{a as Ue}from"./activityContract-DdLskHFl.js";import{b as We,c as Re,C,ab as N,ac as O,u as je}from"./index-LRhcxFAI.js";import{u as z}from"./account-BO76kx0M.js";import{s as De}from"./zsbmd-kDP-np3s.js";import{g as Ee}from"./tqyz-CanXzQHZ.js";import{C as $e}from"./CommonVanProvider-D__Wy38-.js";import{S as Be}from"./Switch-DuYcYVSQ.js";import{g as F}from"./utils-DPKQXUBz.js";import"./BackIcon-CDrGaEPo.js";const Ge=""+new URL("../images/info-BH9yhxEU.svg",import.meta.url).href,Pe=""+new URL("../images/txgn-C1_MnSqT.png",import.meta.url).href,He=""+new URL("../images/kqtx-DQHuRIAa.png",import.meta.url).href,qe=""+new URL("../images/wtqy-D40Ei3ID.png",import.meta.url).href,x=_=>(Ie("data-v-3898016e"),_=_(),ke(),_),Ne={class:"p-3 font-Puhui"},Oe={key:0,class:"mb-3 flex items-center gap-1 rounded-xl border border-b6 bg-[#f44] p-2"},ze=x(()=>e("img",{src:Ge,alt:"多签提示",class:"w-4 h-4"},null,-1)),Fe={class:"text-sm text-b6 font-normal"},Qe={class:"flex items-center flex-1 gap-2"},Xe={class:"w-9 h-9"},Ye=["src"],Ze=x(()=>e("div",{class:"flex-1"},[e("div",{class:"text-sm text-b1 font-normal"},"提取功能")],-1)),Je={class:"flex items-center flex-1 gap-2"},Ke={class:"w-9 h-9"},et=["src"],tt=x(()=>e("div",{class:"flex-1"},[e("div",{class:"text-sm text-b1 font-normal"},"网体授权")],-1)),st={class:"flex items-center flex-1 gap-2"},ot={class:"w-9 h-9"},nt=["src"],at=x(()=>e("div",{class:"flex-1"},[e("div",{class:"text-sm text-b1 font-normal"},"赠送白名单")],-1)),rt={class:"flex items-center flex-1 gap-2"},lt={class:"w-9 h-9"},ct=["src"],it=["onClick"],ut=x(()=>e("div",{class:"text-sm text-b1 font-normal"},"安全验证",-1)),ft={class:"flex items-center gap-2"},dt={class:"text-sm font-normal text-b3"},mt={class:"h-[56px]"},ht={setup(_){const{checkLoginAuth:Q}=We(),{memberLevels:X}=Re(),{requireBanWithdraw:Y,secondConfirmView:Z}=Ue(),T=be(),v=p(0),[pt,L]=m(!1),J=async()=>{L(!0),v.value=await X(),L(!1)},K=y(()=>v.value>=9),ee=()=>{T.push("/securityApplyList")},[g,A]=m(!1),c=p(null),[w,f]=m(!1),[te,V]=m(!1),se=async()=>{try{A(!0),f(!0);const t=await Y();console.log("res",t==null?void 0:t.success),c.value=(t==null?void 0:t.success)||!1}catch{c.value=!1}finally{A(!1),f(!1)}},oe=()=>{if(g.value){r.fail("初始化，请稍候");return}if(v.value>=9){r.fail("V9用户无法操作");return}V(!0)},I=()=>{console.log("关闭申请弹窗"),V(!1)},ne=y(()=>c.value?"是否申请关闭提取功能 ?":"是否申请开启提取功能 ?"),ae=y(()=>c.value?"关闭提取功能需V9等级确认。":"开启提取功能需v9等级确认。"),re=y(()=>c.value?"确认关闭":"确认开启"),le=async()=>{if(!w.value){f(!0);try{const t=F(),s=await N(t),o=await O(t);if(!o.success){r.fail("用户拒绝操作"),f(!1);return}const n={type:c.value?0:1,message:t,messageHash:s.result,signature:o.result};console.log("params",n);const i=await z(n);i.success?(I(),r.success("申请已经发出"),setTimeout(()=>{location.reload()},1e3)):r.fail(i.msg)}catch(t){console.error("切换提取状态失败:",t)}finally{f(!1)}}},[ce,k]=m(!1),[ie,M]=m(!1),ue=()=>{if(g.value){r.fail("初始化，请稍候");return}if(v.value>=9){r.fail("V9用户无法操作");return}k(!0)},U=()=>{k(!1)},fe=()=>{U(),M(!0)},W=()=>{d.value="",M(!1)},d=p(""),de=async()=>{if(!w.value)try{if(!d.value){r.fail("请输入新地址");return}const t=je().getCurrentAccount();if(d.value.toLowerCase()==t.toLowerCase()){r.fail("新地址不能和旧地址一致");return}if(!Me.isAddress(d.value)){r.fail("请输入正确的地址");return}f(!0);const s=F(),o=await N(s),n=await O(s);if(!n.success){r.fail("用户拒绝操作"),f(!1);return}const i={applyInfo:d.value,type:2,message:s,messageHash:o.result,signature:n.result},G=await z(i);G.success?(W(),r.success("申请已经发出"),setTimeout(()=>{location.reload()},1e3)):r.fail(G.message)}catch(t){console.error("网体授权失败:",t)}finally{f(!1)}},R=p(0),h=p(""),j=p(0);let l=null;const me=t=>{if(t<=0)return"";const s=Math.floor(t/86400),o=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),i=t%60;return s>0?`${s}天${o}时${n}分`:o>0?`${o}时${n}分`:n>0?`${n}分${i}秒`:`${i}秒`},D=()=>{const t=Math.floor(Date.now()/1e3),s=j.value-t;s>0?h.value=me(s):(h.value="",E())},E=async()=>{var t;try{const s=await Z();if(console.log("res",s),s.success){R.value=((t=s.result.agreeExpired)==null?void 0:t.length)||0;const{frozen:o}=s.result||{},n=(o==null?void 0:o.toNumber())||0;j.value=n;const i=Math.floor(Date.now()/1e3);n>i?(D(),l&&clearInterval(l),l=setInterval(()=>{D()},1e3)):(l&&(clearInterval(l),l=null),h.value="")}}catch(s){console.error("获取提取验证状态失败:",s),h.value="",l&&(clearInterval(l),l=null)}},he=()=>{if(g.value){r.fail("初始化，请稍候");return}if(v.value>=9){r.fail("V9用户无法操作");return}T.push("/securitySendWhiteList")},pe=()=>{if(g.value){r.fail("初始化，请稍候");return}T.push("/securityWithdrawVerifyConfig")},[ve,$]=m(!1),ge=()=>{$(!0)},B=()=>{$(!1)},we=()=>{Q(!0)&&(J(),se(),E())},xe=()=>{we()};return ye(()=>{xe()}),Ce(()=>{l&&(clearInterval(l),l=null)}),(t,s)=>{const o=Se("van-icon");return b(),Te($e,{title:"安全中心",class:"font-Puhui font-normal relative pb-20 bg-gray1",themeVars:{navBarBackgroundColor:"#ffffff"}},{right:S(()=>[a(K)?(b(),P("span",{key:0,class:"text-sm text-b2 font-normal",role:"button",onClick:ee},"操作申请")):H("",!0)]),default:S(()=>[e("div",Ne,[h.value?(b(),P("div",Oe,[ze,e("p",Fe," 当前安全验证功能关闭中，将于"+q(h.value)+"后关闭 ",1)])):H("",!0),e("div",{class:"bg-white rounded-[12px] px-3 py-4 mb-3 flex items-center justify-between",onClick:oe},[e("div",Qe,[e("div",Xe,[e("img",{src:c.value?a(Pe):a(He),class:"w-full h-full",alt:"提取功能"},null,8,Ye)]),Ze]),e("div",null,[u(Be,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=n=>c.value=n),loading:a(w)||a(g),isAsync:""},null,8,["modelValue","loading"])])]),e("div",{class:"bg-white rounded-[12px] px-3 py-4 flex items-center justify-between mb-3",onClick:ue},[e("div",Je,[e("div",Ke,[e("img",{src:a(qe),class:"w-full h-full",alt:"授权"},null,8,et)]),tt]),u(o,{name:"arrow",color:"#999"})]),e("div",{class:"bg-white rounded-[12px] px-3 py-4 flex items-center justify-between mb-3 active:opacity-80",onClick:he},[e("div",st,[e("div",ot,[e("img",{src:a(De),class:"w-full h-full",alt:"赠送白名单"},null,8,nt)]),at]),u(o,{name:"arrow",color:"#999"})]),e("div",{class:"bg-white rounded-[12px] px-3 py-4 flex items-center justify-between active:opacity-80",onClick:pe},[e("div",rt,[e("div",lt,[e("img",{src:a(Ee),class:"w-full h-full",alt:"提取验证"},null,8,ct)]),e("div",{class:"flex-1 flex items-center gap-1",onClick:Le(ge,["stop"])},[ut,u(o,{name:"info-o",color:"#999"})],8,it)]),e("div",ft,[e("p",dt," 已添加"+q(R.value)+"个验证地址 ",1),u(o,{name:"arrow",color:"#999"})])])]),u(C,{show:a(te),title:a(ne),content:a(ae),showConfirm:!0,showReject:!1,confirmText:a(re),loading:a(w),onClose:I,onConfirm:le},null,8,["show","title","content","confirmText","loading"]),u(C,{show:a(ce),title:"是否要进行网体授权?",content:"提交授权申请后需V9等级地址确认可执行。",showConfirm:!0,showReject:!1,confirmText:"确认",onClose:U,onConfirm:fe},null,8,["show"]),u(C,{show:a(ie),title:"请输入授权地址",showConfirm:!0,showReject:!1,confirmText:"确认",loading:a(w),onClose:W,onConfirm:de},{default:S(()=>[e("div",mt,[Ae(e("textarea",{"onUpdate:modelValue":s[1]||(s[1]=n=>d.value=n),placeholder:"请输入新地址，请注意地址填写正确",class:"w-full h-[56px] rounded-lg bg-[#f5f5f5] p-2 text-b1"},null,512),[[Ve,d.value,void 0,{trim:!0}]])])]),_:1},8,["show","loading"]),u(C,{show:a(ve),title:"安全验证",content:"开启功能后,通证权益LP解押/MAI解押/抵押借贷的归还借贷功能需要多签授权才能操作",showConfirm:!0,showReject:!1,confirmText:"确认",onClose:B,onConfirm:B},null,8,["show"])]),_:1})}}},Lt=_e(ht,[["__scopeId","data-v-3898016e"]]);export{Lt as default};
