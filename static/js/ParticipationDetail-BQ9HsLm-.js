import{_ as U,y as M,w as te,x as P,r as h,E as D,F as E,G as T,H as e,P as o,Q as a,a0 as x,X as be,K as I,a2 as O,N as g,O as y,bw as ee,J as Y,R as Q,I as Z,$ as X,Y as _e,Z as Se,bf as ae,D as ye,B as Te,be as q,l as $e}from"./vendor-BUT0HZ5j.js";import{l as V,b5 as xe,g as Ce,_ as se,V as ke,u as Be,e as De,b6 as Fe,bc as Ie}from"./index-DDhEkd_5.js";import{l as oe}from"./luckyShopContract-C1ZxeFcQ.js";import{B as Le}from"./BackIcon-biFt6cm7.js";const Ne={class:"bg-white px-2.5 pt-2.5 rounded-xl text-sm text-[#2E2008] mb-4"},Pe={class:"flex"},Ee=["src"],Ve={class:"flex flex-col justify-between",style:{width:"calc(100% - 5.625rem)"}},Ae={class:"w-full"},Re={class:"w-full font-semibold truncate"},Ue={class:"mt-1 opacity-60"},Me={class:"opacity-60"},He={class:"py-4 border-b-box"},ze={class:"opacity-60"},Ge={class:"mt-1"},qe={class:"flex items-center justify-between py-4"},je={class:"text-xs opacity-60"},Je=M({props:{data:null,loading:{type:Boolean},systemTime:null},emits:["cancleHandle","refund","handleTo"],setup(s,{emit:u}){const r=s,{t:n}=te(),w=P(()=>V(r.data.startTime)),m=P(()=>V(r.data.endTime)),b=P(()=>V(r.data.createTime)),C=h({toBeDrawn:"#FB1A18",success:"#009536",error:"#FB1A18",notStarted:"#FB9318",processing:"#84C61A",cancel:"#A7A7A7"}),k=P(()=>({toBeDrawn:n("flashSale.Tobedrawn"),success:n("flashSale.goodsuceess"),error:n("flashSale.gooderror"),notStarted:n("flashSale.notStart"),processing:n("flashSale.progressing"),cancel:n("flashSale.Cancelled")})),$=P(()=>{const l=r.data;let v="processing";switch(l.status){case 10:{const d=+l.endTime,i=+l.startTime,F=xe(r.systemTime)*1e3,L=d-F,c=F-i;L<0?v="error":c<0&&(v="notStarted");break}case 15:v="toBeDrawn";break;case 20:case 30:case 40:case 50:case 200:case 300:v="success";break;case 400:v="cancel";break;case 500:v="error";break}return v}),f=()=>{u("cancleHandle",r.data)},N=()=>{u("refund",r.data)};return(l,v)=>{const d=D("van-button");return T(),E("div",Ne,[e("div",Pe,[e("div",{onClick:v[0]||(v[0]=()=>{u("handleTo",`/saleGoodDetail?id=${s.data.id}`)})},[e("img",{class:"w-20 h-20 rounded-xl mr-2.5 object-cover",src:s.data.mainImageUrls||o(Ce)("images/goods/defaultImg.png"),alt:"",srcset:""},null,8,Ee)]),e("div",Ve,[e("div",Ae,[e("div",Re,a(s.data.title),1),e("div",Ue,[x(a(l.$t("flashSale.status")),1),e("span",{style:be(`color: ${C.value[o($)]};`)},a(o(k)[o($)]),5)])]),e("div",Me,a(l.$t("flashSale.UnitandTotalPrice"))+a(s.data.price)+"/"+a(s.data.totalPrice),1)])]),e("div",He,[e("div",ze,a(l.$t("flashSale.activityTime")),1),e("div",Ge,a(o(w))+" - "+a(o(m)),1)]),e("div",qe,[e("div",je,a(l.$t("flashSale.participationtime"))+a(o(b)),1),o($)=="notStarted"?(T(),I(d,{key:0,loading:s.loading,"loading-text":l.$t("common.cancel"),class:"rounded-md h-7 leading-7 px-4 bg-[#fed1d1] text-[#FB1A18] font-medium",onClick:f},{default:g(()=>[x(a(l.$t("common.cancel")),1)]),_:1},8,["loading","loading-text"])):O("",!0),o($)=="error"&&s.data.status==10?(T(),I(d,{key:1,loading:s.loading,"loading-text":l.$t("flashSale.refund"),class:"rounded-md h-7 leading-7 px-4 bg-[#FB1A18] text-white font-medium",onClick:N},{default:g(()=>[x(a(l.$t("flashSale.refund")),1)]),_:1},8,["loading","loading-text"])):O("",!0),o($)=="error"&&s.data.status==500?(T(),I(d,{key:2,loading:s.loading,"loading-text":l.$t("flashSale.refund"),class:"rounded-md h-7 leading-7 px-4 bg-[#D9D9D9] text-[#fff] font-medium"},{default:g(()=>[x(a(l.$t("flashSale.refund")),1)]),_:1},8,["loading","loading-text"])):O("",!0)])])}}}),Ke=U(Je,[["__scopeId","data-v-50f00116"]]),Oe={class:"py-8 text-base text-center text-black"},Qe={class:"font-semibold"},Xe={class:"flex"},Ye=M({props:{show:{type:Boolean},goodName:null},emits:["close","confirm"],setup(s,{emit:u}){const r=()=>{u("confirm"),u("close")};return(n,w)=>{const m=D("van-button");return T(),I(se,{width:"90%",show:s.show,name:n.$t("refund.Apply"),onClose:w[1]||(w[1]=()=>{u("close")})},{default:g(()=>[e("div",Oe,[x(a(n.$t("flashSale.cancelTip1"))+" ",1),e("span",Qe,a(s.goodName),1),x(" "+a(n.$t("flashSale.cancelTip2")),1)]),e("div",Xe,[y(m,{class:"plain-btn w-1/2 mx-2.5 text-[#2E2008] font-semibold",onClick:w[0]||(w[0]=()=>{u("close")})},{default:g(()=>[x(a(n.$t("common.cancel")),1)]),_:1}),y(m,{class:"w-1/2 mx-2.5 btn-pink text-white font-semibold",onClick:r},{default:g(()=>[x(a(n.$t("common.confirm")),1)]),_:1})])]),_:1},8,["show","name"])}}}),Ze=U(Ye,[["__scopeId","data-v-da486850"]]),j=s=>(_e("data-v-7dcdab2e"),s=s(),Se(),s),We={class:"p-5 relative text-sm text-[#2E2008]"},et={class:"relative text-base font-semibold text-center"},tt=j(()=>e("span",null,"筛选",-1)),at=["src"],st={class:"mt-4"},ot=j(()=>e("div",{class:"font-bold text-black"},"状态",-1)),nt={class:"flex flex-wrap mt-4"},lt={class:"mt-2.5"},it=j(()=>e("div",{class:"font-bold text-black"},"参与时间",-1)),dt=j(()=>e("div",{class:"w-3 h-[2px] mx-3.5 bg-[#2E2008]"},null,-1)),ct=M({props:{show:{type:Boolean},tabList:null},emits:["close","confirm"],setup(s,{emit:u}){const[r,n]=ee(!1),[w,m]=ee(!1),b=h(),C=h(),k=h(new Date(2023,0,1)),$=h(),f=h({startTime:null,endTime:null}),N=()=>{n(!1),m(!1),(!f.value.startTime||!f.value.endTime)&&(f.value.endTime=null,f.value.startTime=null)},l=d=>{b.value=V(d),$.value=d,n(!1),m(!0)},v=d=>{C.value=V(d),f.value.startTime=b.value,f.value.endTime=V(d),m(!1)};return(d,i)=>{const F=D("van-datetime-picker"),L=D("van-popup");return T(),I(L,{class:"",round:"",show:s.show,"onUpdate:show":i[6]||(i[6]=c=>X(show)?show.value=c:null),position:"bottom",onClose:i[7]||(i[7]=()=>{u("close")})},{default:g(()=>[e("div",We,[e("div",et,[tt,e("div",{class:"w-5 h-5 absolute right-[-0.625rem] top-1/2 translate-y-[-50%]",onClick:i[0]||(i[0]=()=>{u("close")})},[e("img",{class:"w-5 h-5",src:o(ke)("flashSale/close-icon.svg")},null,8,at)])]),e("div",st,[ot,e("div",nt,[(T(!0),E(Z,null,Y(s.tabList,c=>(T(),E("div",{class:Q(["rounded-md text-center py-2 px-3 bg-[#F5F5F5] mr-5 min-w-[4.125rem] mb-4 status",{"status-active":c.value==1}]),key:c.value},a(c.title),3))),128))])]),e("div",lt,[it,e("div",{class:"flex items-center mt-4",onClick:i[1]||(i[1]=c=>o(n)(!0))},[e("div",{class:Q(["flex-1 py-1.5 bg-[#F5F5F5] rounded-md text-center",{"text-xs":f.value.startTime}])},a(f.value.startTime||"起始时间"),3),dt,e("div",{class:Q(["flex-1 py-1.5 bg-[#F5F5F5] rounded-md text-center",{"text-xs":f.value.endTime}])},a(f.value.endTime||"结束时间"),3)])])]),y(L,{show:o(r),"onUpdate:show":i[3]||(i[3]=c=>X(r)?r.value=c:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1},{default:g(()=>[y(F,{modelValue:b.value,"onUpdate:modelValue":i[2]||(i[2]=c=>b.value=c),"min-date":k.value,type:"datetime",title:d.$t("goods.selectStartTime"),onCancel:N,onConfirm:l},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),y(L,{show:o(w),"onUpdate:show":i[5]||(i[5]=c=>X(w)?w.value=c:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1},{default:g(()=>[y(F,{modelValue:C.value,"onUpdate:modelValue":i[4]||(i[4]=c=>C.value=c),onConfirm:v,"min-date":$.value,onCancel:N,type:"datetime",title:d.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),_:1},8,["show"])}}}),ut=U(ct,[["__scopeId","data-v-7dcdab2e"]]),rt={class:"py-8 text-base font-light text-center text-default"},mt={class:"font-semibold"},ft={class:"text-[#FB1A18]"},vt=M({props:{show:{type:Boolean},goodName:null,amount:null},emits:["close","confirm"],setup(s,{emit:u}){const{rates:r}=oe(),n=ae({rate:.1}),w=()=>{u("confirm"),u("close")};async function m(){n.rate=await r(0)}return ye(()=>{m()}),(b,C)=>{const k=D("van-button");return T(),I(se,{width:"90%",show:s.show,name:b.$t("flashSale.refund"),onClose:C[0]||(C[0]=()=>{u("close")})},{default:g(()=>[e("div",rt,[x(a(b.$t("flashSale.claimDepositTip1"))+" ",1),e("span",mt,a(s.goodName),1),x(" "+a(b.$t("flashSale.claimDepositTip2"))+" ",1),e("span",ft,a(o(Te)(s.amount).times(o(n).rate)||0)+"MC",1),x(" "+a(b.$t("flashSale.claimTip3")),1)]),y(k,{class:"block w-1/2 mx-auto font-semibold text-white btn-pink",onClick:w},{default:g(()=>[x(a(b.$t("common.claim")),1)]),_:1})]),_:1},8,["show","name"])}}}),pt=U(vt,[["__scopeId","data-v-1ffd35f8"]]),ht={class:"w-full bg-[#f9f5f7] min-h-screen"},gt={class:"sticky top-0 bg-[#f9f5f7] z-10"},wt={class:"flex px-2.5 text-[#2E2008] items-center h-10"},bt={class:"font-medium"},_t={class:"px-4 pt-2.5"},St=M({setup(s){const{getCurrentStoreId:u}=Be(),{offShelf:r,merchantBack:n,commodityBatch:w}=oe(),{t:m}=te(),{reloadStore:b}=De(),C=h(""),k=h(!1),$=h(!1),f=h(0),N=h(10),l=h(0),[,v]=q(!1),d=P(()=>[{title:m("order.all"),value:null},{title:m("flashSale.notStart"),value:1},{title:m("flashSale.progressing"),value:2},{title:m("flashSale.goodsuceess"),value:3},{title:m("flashSale.gooderror"),value:4},{title:m("flashSale.Cancelled"),value:5}]),[i,F]=q(!1),[L,c]=q(!1),[ne,le]=q(!1),_=h(null),ie=t=>{_.value=t,F(!0)},de=()=>{le(!1)},ce=t=>{J.status!==d.value[t.name].value&&(J.status=d.value[t.name].value,pe())},ue=async()=>{v(!0),_.value.loading=!0;const t=await r(_.value.id);_.value.loading=!1,v(!1),t.success&&(_.value.status=400)},re=t=>{_.value=t,c(!0)},me=async t=>{t.loading=!0;const S=await n(t.id);t.loading=!1,S.success&&(_.value.status=500)},fe=$e(),ve=t=>{fe.push(t)},J=ae({status:null}),pe=()=>{$.value=!1,f.value=0,l.value=0,A.value=[]},A=h([]),he=async()=>{var z,G;k.value=!0;const t=await Ie({page:f.value,size:N.value},{...J,shopId:(z=await u())==null?void 0:z.id});if(!t.success||!t.data||!t.total){$.value=!0;return}l.value=t.total;const S=t.data.map(p=>p.id),K=await w(S);for(let p=0;p<t.data.length;p++){t.data[p].status=(G=K[p])==null?void 0:G.status,t.data[p].loading=!1;const R=t.data[p].mainImageUrls.split(",").filter(B=>B!==""&&B!==null&&B!==void 0&&!Number.isNaN(B));t.data[p].mainImageUrls=R&&R.length>0?R[0]:""}const H=t.data;A.value=f.value===1?H:A.value.concat(H),A.value.length>=l.value&&($.value=!0)},W=h(null),ge=async()=>{const{data:t}=await Fe();W.value=t||null},we=async()=>{k.value=!0,f.value+=1,await ge(),await he(),k.value=!1};return(t,S)=>{const K=D("VanList"),H=D("van-tab"),z=D("van-tabs"),G=D("van-pull-refresh");return T(),E("div",ht,[e("header",gt,[e("div",wt,[y(Le),e("span",bt,a(t.$t("flashSale.ParticipationRecord")),1)])]),y(G,{onRefresh:o(b).reload,class:"w-full min-h-screen"},{default:g(()=>[y(z,{active:C.value,"onUpdate:active":S[1]||(S[1]=p=>C.value=p),type:"card",onClickTab:ce,sticky:"","offset-top":"5px"},{default:g(()=>[(T(!0),E(Z,null,Y(o(d),(p,R)=>(T(),I(H,{title:p.title,key:R},{default:g(()=>[e("div",_t,[y(K,{loading:k.value,"onUpdate:loading":S[0]||(S[0]=B=>k.value=B),finished:$.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:we},{default:g(()=>[(T(!0),E(Z,null,Y(A.value,B=>(T(),I(Ke,{systemTime:W.value,key:B,onCancleHandle:ie,onRefund:re,data:B,loading:B.loading,onHandleTo:ve},null,8,["systemTime","data","loading"]))),128))]),_:2},1032,["loading","finished","finished-text","loading-text"])])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1},8,["onRefresh"]),y(Ze,{show:o(i),goodName:_.value&&_.value.title,onClose:S[2]||(S[2]=()=>{o(F)(!1)}),onConfirm:ue},null,8,["show","goodName"]),y(pt,{show:o(L),goodName:_.value&&_.value.title,amount:_.value&&_.value.totalPrice,onClose:S[3]||(S[3]=p=>o(c)(!1)),onConfirm:S[4]||(S[4]=p=>me(_.value))},null,8,["show","goodName","amount"]),y(ut,{onClose:de,show:o(ne),tabList:o(d)},null,8,["show","tabList"])])}}}),Ct=U(St,[["__scopeId","data-v-7c54eeac"]]);export{Ct as default};
