import{z as w,G as _,H as d,I as h,Q as U,a3 as N,_ as A,r as C,F as M,P,$ as T,J as V,K as Z,Z as I,af as F,N as G,y as H,D as K,E as Q,ab as j,U as J,X,Y}from"./vendor-Dr_RpJ_Y.js";import{a as q,b as O}from"./index-CU2nzZe6.js";import{S as z,P as $,L as W}from"./iconAssets-DsommeAx.js";const ee="/static/images/add-BGs4QptK.svg",te=h("img",{src:ee,class:"w-4 h-4"},null,-1),oe={class:"text-xs font-normal text-b2"},ae=w({emits:["handleTo"],setup(a,{emit:f}){return(u,s)=>(d(),_("div",{class:"w-[44px] h-[44px] bg-white rounded-lg flex flex-col items-center justify-center",onClick:s[0]||(s[0]=N(o=>f("handleTo","/city/merchantCreate"),["stop"]))},[te,h("p",oe,U(u.$t("city.add store")),1)]))}}),se={class:"swiper-card-container"},ne={class:"card-wrapper"},re=w({props:{cardData:null,storeComponent:null},emits:["changeIndex"],setup(a,{expose:f,emit:u}){const s=C(null),o=C(0),x=r=>{o.value=r,u("changeIndex",r)};return f({activeIndex:o,updateActiveIndex:r=>{o.value=r,s.value&&s.value.swipeTo(r)}}),(r,t)=>{const p=M("van-swipe-item"),i=M("van-swipe");return d(),_("div",se,[P(i,{ref:(l,c)=>{c.swiperRef=l,s.value=l},active:o.value,"onUpdate:active":t[0]||(t[0]=l=>o.value=l),loop:!1,"show-indicators":!1,touchable:!0,class:"custom-swiper",onChange:x},{default:T(()=>[(d(!0),_(V,null,Z(a.cardData,(l,c)=>(d(),I(p,{key:l.id,class:G(["swipe-item",{right:o.value+1===c,left:o.value-1===c}])},{default:T(()=>[h("div",ne,[(d(),I(F(a.storeComponent),{"store-info":l,idx:c},null,8,["store-info","idx"]))])]),_:2},1032,["class"]))),128))]),_:1},8,["active"])])}}}),le=A(re,[["__scopeId","data-v-407ff22f"]]),ce=a=>(X("data-v-c7b630fe"),a=a(),Y(),a),ie={class:"w-full h-full relative"},de=ce(()=>h("div",{id:"map",class:"w-full h-full relative z-0"},null,-1)),ue={class:"absolute bottom-[12px] left-0 right-0 z-10"},pe=w({props:{storeList:null,storeComponent:null,availableStore:{type:Boolean}},emits:["changeIndex","handleTo"],setup(a,{expose:f,emit:u}){const s=a,{cityMapStore:o}=q(),{checkLoginAuth:x}=O(),v=C(0),r=C(null);let t=null,p=[],i=null;const l=H(()=>{var e,n;return o.locationCoords.lng&&o.locationCoords.lat?{lng:o.locationCoords.lng,lat:o.locationCoords.lat}:{lng:(e=o.currentActiveCity)==null?void 0:e.areaLongitude,lat:(n=o.currentActiveCity)==null?void 0:n.areaLatitude}});K(()=>s.storeList,()=>{s.storeList.length>0&&setTimeout(()=>{t&&(B(),D(),b(),c())},300)},{immediate:!0,deep:!0});const c=()=>{try{const e=l.value;t=L.map("map",{center:[e.lat,e.lng],zoom:12,trackResize:!0,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"",subdomains:"abcd",maxZoom:17,minZoom:7}).addTo(t)}catch{}finally{}},b=()=>{const e=s.storeList[v.value];e&&e.storeLatitude&&e.storeLongitude&&t.flyTo([e.storeLatitude,e.storeLongitude],15,{duration:.8,easeLinearity:1})},B=()=>{y(),s.storeList.forEach((e,n)=>{if(e.storeLatitude&&e.storeLongitude){const m=n===v.value?z:$,g=L.marker([e.storeLatitude,e.storeLongitude],{icon:m}).addTo(t);g.on("click",()=>{S(n,!0)}),p.push(g)}})},y=()=>{p.forEach(e=>{t&&t.removeLayer(e)}),p=[]},D=()=>{i&&t&&t.removeLayer(i);const e=l.value;e.lat&&e.lng&&(i=L.marker([e.lat,e.lng],{icon:W}).addTo(t))},k=()=>{p.forEach((e,n)=>{const m=n===v.value?z:$;e.setIcon(m)})},S=(e,n=!1)=>{v.value=e,n&&r.value&&r.value.updateActiveIndex(e),u("changeIndex",e),b(),n?k():setTimeout(()=>{k()},600)},E=e=>{x(!0)&&u("handleTo",e)},R=()=>{y(),i&&t&&(t.removeLayer(i),i=null),t&&(t.remove(),t=null)};return Q(()=>{c()}),j(()=>{R()}),f({initMap:c}),(e,n)=>(d(),_("div",ie,[de,a.availableStore?J("",!0):(d(),I(ae,{key:0,class:"absolute bottom-[128px] right-[20px] z-10 shadow-[0_0.5px_16px_0_rgba(0,0,0,0.16)]",onHandleTo:E})),h("div",ue,[P(le,{ref:(m,g)=>{g.draggableCardListRef=m,r.value=m},"card-data":a.storeList,storeComponent:a.storeComponent,onChangeIndex:S},null,8,["card-data","storeComponent"])])]))}}),he=A(pe,[["__scopeId","data-v-c7b630fe"]]);export{he as M};
