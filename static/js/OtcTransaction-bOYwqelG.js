import{_ as Ie}from"./combustion-retR3UhG.js";import{_ as oe,z as ae,x as he,y as G,F as V,G as T,H as u,I as t,P as R,O as e,Q as s,Z as P,J as ie,K as we,$ as L,a4 as k,N as le,a1 as Be,bK as Me,a0 as se,bl as de,r as Q,D as xe,a2 as X,E as pe,U as ne,X as Oe,Y as Ce}from"./vendor-Dr_RpJ_Y.js";import{aP as Fe,bd as Le,u as Se,b4 as Pe,J as H,G as $e,L as q,be as ce,H as ye,I as fe,K as be,F as te,e as S,j as Y,g as re,d as ke,b6 as ge,a as Ue,w as Te}from"./index-BckdT6oc.js";import{e as De}from"./exchangeContract-B1aA4qeU.js";import{_ as Ve}from"./BgBox-BPYkjYKw.js";import{E as Re}from"./EcologyHeader-BPtmKFe-.js";import"./bg-dot-DBVQRM9t.js";import"./UserLevel-CbykZCNm.js";import"./avatarRing-CLGxkH-F.js";import"./level-Bg_EjCZQ.js";import"./UserAsset-1GWHoCRN.js";import"./TokenBalance-k05Fh-Ks.js";const Ee=""+new URL("../images/sell-DFmehKtE.svg",import.meta.url).href,Ne=""+new URL("../images/buy-C0LQi4x6.svg",import.meta.url).href,je={class:"pt-5"},ze={class:"flex items-center h-5 text-[#2E2008] text-base"},qe=["src"],Ge={class:"font-semibold ml-0.5"},He={class:"bg-[#FFF1D9]/[0.6] rounded-xl mt-2.5 py-4 pb-1.5"},We={class:"w-full"},Ke={class:"flex px-4"},Ze={class:"w-4/12 my-th"},Je={class:"w-5/12 my-th"},Qe={class:"w-3/12 my-th"},Xe={key:1,class:"max-h-36 w-full overflow-auto pt-1.5 px-4 list-box"},Ye={class:"w-4/12 text-overflow"},et={class:"text-base font-medium text-[#2E2008]"},tt={class:"w-5/12 text-overflow"},st={class:"text-base font-medium text-[#2E2008]"},nt={class:"w-3/12 text-overflow"},ot=ae({props:{type:null,list:null,isOld:{type:Boolean}},emits:["onClick","onCheckMyOrder"],setup(a,{emit:c}){const{type:l,list:D}=a,x=he(),U=G(()=>{const M={icon:Ee,title:x.t("ecology.Sellorders"),subTitle:x.t("ecology.mysellorder"),btnText:x.t("ecology.buyin")};return l==="buy"&&(M.icon=Ne,M.title=x.t("ecology.buyorder"),M.subTitle=x.t("ecology.mybill"),M.btnText=x.t("ecology.sellout")),M}),A=M=>{c("onClick",l,M)},B=()=>{c("onCheckMyOrder",l)};return(M,p)=>{const E=V("van-icon"),h=V("van-skeleton"),O=V("VanButton");return u(),T("div",je,[t("div",ze,[t("img",{src:e(U).icon,class:"w-5",alt:""},null,8,qe),t("span",Ge,s(e(U).title),1),t("span",{class:"ml-auto font-medium opacity-80",onClick:B},s(e(U).subTitle),1),R(E,{class:"mx-px text-sm font-semibold",name:"arrow",onClick:B})]),t("div",He,[t("div",We,[t("div",Ke,[t("span",Ze,s(M.$t("mall.price")),1),t("span",Je,s(M.$t("ecology.quantity")),1),t("span",Qe,s(M.$t("shop.operation")),1)]),e(Fe)?(u(),P(h,{key:0,class:"mt-3",row:3})):(u(),T("div",Xe,[(u(!0),T(ie,null,we(a.list,b=>(u(),T("div",{class:"flex w-full py-2.5",key:b.price},[t("span",Ye,[t("span",et,s(b.price),1)]),t("span",tt,[t("span",st,s(b.amount),1)]),t("span",nt,[R(O,{class:le(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:$=>A(b),disabled:a.isOld},{default:L(()=>[k(s(e(U).btnText),1)]),_:2},1032,["class","onClick","disabled"])])]))),128))]))])])])}}}),Ae=oe(ot,[["__scopeId","data-v-7aa55814"]]),at={class:"w-[21rem] p-5 bg-[#FFFDF8] text-xs text-[#2E2008]"},lt={class:"flex justify-between items-center pb-4 header font-semibold text-base"},ct=ae({props:{show:{type:Boolean},title:null},emits:["close"],setup(a,{emit:c}){const{show:l,title:D}=a,x=()=>{c("close")};return(U,A)=>{const B=V("van-icon"),M=V("van-popup");return u(),P(M,Me(U.$attrs,{show:a.show,"onUpdate:show":A[0]||(A[0]=p=>se(l)?l.value=p:null),round:"","overlay-class":"",onClose:x}),{default:L(()=>[t("div",at,[t("div",lt,[t("span",null,s(a.title),1),R(B,{name:"cross",class:"font-semibold text-xl",onClick:x})]),t("div",null,[Be(U.$slots,"default",{},void 0,!0)])])]),_:3},16,["show"])}}}),ve=oe(ct,[["__scopeId","data-v-7a3c5a48"]]),ue=()=>{const a=Le(),c=a==null?void 0:a.cns,l=a==null?void 0:a.address,D=Se().getCurrentAccount(),x=async()=>{try{const n=await c.USDT();return H(n)}catch(n){return q(n,l,"USDT",{})}},U=async()=>{try{const n=await c.MUSD();return H(n)}catch(n){return q(n,l,"MUSD",{})}},A=async()=>{try{const n=await c.MAI();return H(n)}catch(n){return q(n,l,"MAI",{})}},B=async()=>{try{const n=await c.MIN_AMOUNT();return $e(n)}catch{return 0}},M=async()=>{try{const n=await c.MIN_REMAIN_AMOUNT();return H(n)}catch(n){return q(n,l,"MIN_REMAIN_AMOUNT",{})}},p=async()=>{try{const n=await c.lastPrice();return ce(n.toString())}catch{return 0}},E=async n=>{try{const m=await c.getMarketPrices(n);return H(m)}catch(m){return q(m,l,"getMarketPrices",{direct:n})}},h=async(n,m)=>{try{const f=await c.getPriceTotals(n,te(m));return H(f)}catch(f){return q(f,l,"getPriceTotals",{direct:n,price:te(m)})}},O=async(n,m)=>{try{const f=await c.getMarketIds(n,m);return H(f)}catch(f){return q(f,l,"getMarketIds",{direct:n,price:m})}},b=async n=>{try{const m=await c.getOrderInfo(n);return H(m)}catch(m){return q(m,l,"getOrderInfo",{id:n})}},$=async(n,m,f)=>{try{const N=await(await c.pending(n,te(m),te(f))).wait();return H(N)}catch(N){return be(N),q(N,l,"pending",{direct:n,price:te(m),amount:te(f)})}},g=async n=>{try{const f=await(await await c.batchTrade(n)).wait();return H(f)}catch(m){return be(m),q(m,l,"batchTrade",{ids:n})}},r=async(n,m)=>{try{const f=await c.estimateGas.trade(n,te(m)),J=await(await await c.trade(n,te(m),{gasLimit:fe(f,3e3),...ye})).wait();return H(J)}catch(f){return be(f),q(f,l,"trade",{id:n,amount:te(m)})}},i=async()=>{try{const n=await c.getPendingIds(D);return H(n)}catch(n){return q(n,l,"getPendingIds",{account:D})}},v=async n=>{try{const m=await c.estimateGas.cancel(n),N=await(await await c.cancel(n.toString(),{gasLimit:fe(m,3e3),...ye})).wait();return H(N)}catch(m){return be(m),q(m,l,"cancel",{id:n.toString()})}},I=async()=>{try{return await c.priceOracle()}catch(n){return q(n,l,"priceOracle",{})}};return{pending:$,usdtAddress:x,MIN_AMOUNT:B,MIN_REMAIN_AMOUNT:M,lastPrice:p,getMarketPrices:E,getPriceTotals:h,getMarketIds:O,getOrderInfo:b,batchTrade:g,trade:r,getPendingIds:i,cancel:v,musdAddress:U,maiAddress:A,burnMAI:async()=>{try{const n=await c.estimateGas.burnMAI(),f=(await c.burnMAI({gasLimit:fe(n,3e3),...ye})).wait();return H(f)}catch(n){return q(n,l,"burnMAI",{})}},burnMusd:async()=>{try{const n=await c.estimateGas.burnMusd(),f=(await c.burnMusd({gasLimit:fe(n,3e3),...ye})).wait();return H(f)}catch(n){return q(n,l,"burnMusd",{})}},burnMAIFund:async()=>{try{const n=await c.burnMAIFund();return ce(n.toString())}catch{return 0}},burnMUSDFund:async()=>{try{const n=await c.burnMUSDFund();return ce(n.toString())}catch{return 0}},getPrice:async n=>{const m=await I(),f=Pe(m),N=f==null?void 0:f.cns,J=f==null?void 0:f.address,d=n||await A();try{const w=await N.getPrice(d);return H($e(w))}catch(w){return q(w,J,"getPrice",{tokenAdress:d})}}}},rt={class:"mt-4 text-base font-bold"},it={class:"flex-center-bw"},dt={class:"opacity-80"},ut={class:"mt-1 flex-center-bw"},mt={class:"opacity-80"},pt={class:"mt-4 text-[#2E2008]"},yt={class:"text-sm font-medium"},ft={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},bt={class:"text-base opacity-60"},gt={class:"mt-5 text-sm font-medium"},ht={class:"bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},wt={class:"flex flex-col items-center justify-center mt-5"},vt={key:0,class:"mt-5 text-xs text-center"},_t={lass:"mt-1"},xt={key:1,class:"mt-5 text-xs text-center"},$t={class:"mt-1"},kt=ae({props:{show:{type:Boolean},type:null,lastPrice:null},emits:["update:show","success"],setup(a,{emit:c}){const{show:l,type:D}=a,{t:x}=he(),{musdAddress:U,MIN_AMOUNT:A,maiAddress:B,pending:M}=ue(),p=de({number:null,price:null}),E=G(()=>{const o={title:x("ecology.Pendingpurchase"),numberText:x("ecology.buyquantity"),priceText:x("ecology.buyprice")};return D==="sell"&&(o.title=x("ecology.Hangforsale"),o.numberText=x("ecology.sellquantity"),o.priceText=x("ecology.sellingprice")),o}),h=G(()=>Z.value>0&&(D==="buy"?Z.value>=O.value:Z.value>=+p.number));xe(()=>p.price,o=>{b.value||(O.value=+o*+p.number)}),xe(()=>p.number,o=>{$.value||(O.value=+o*+p.price)});const O=Q(null),b=Q(!1),$=Q(!1),g=()=>{b.value=!1,$.value=!0},r=()=>{b.value=!0,$.value=!1},[i,v]=X(!1),I=()=>{c("update:show",!1)},j=Q(""),W=async()=>{const o=D==="buy"?await U():await B();o.success&&(j.value=o.result)},C=async()=>{v(!0);const o=await await Y(j.value).approve(re.otc);v(!1),o.success&&K()},Z=Q(null),K=async()=>{v(!0);const o=await(await Y(j.value)).allowance(re.otc);Z.value=o.result||0,v(!1)},n=Q(0),m=async()=>{const o=await A();n.value=+o},f=Q(0),N=async()=>{const o=await Y(j.value).balanceOf();f.value=+o},[J,d]=X(!1),w=async()=>{d(!0);const o=await M(D==="buy"?1:2,p.price,p.number);d(!1),o.success&&(I(),c("success"))},y=async()=>{K(),m(),N()};return pe(async()=>{await W(),y()}),(o,F)=>{const _=V("VanField"),ee=V("VanButton");return u(),P(ve,{show:a.show,"onUpdate:show":F[2]||(F[2]=z=>se(l)?l.value=z:null),title:e(E).title,onClose:I},{default:L(()=>[t("div",rt,[t("div",it,[t("span",null,s(o.$t("ecology.new price",{token:"MAI"})),1),t("span",dt,s(a.lastPrice),1)]),t("div",ut,[t("span",null,s(o.$t("common.balance",{token:a.type==="buy"?"MUSD":"MAI"})),1),t("span",mt,s(e(S)(f.value)),1)])]),t("div",pt,[t("div",yt,s(e(E).priceText),1),t("div",ft,[R(_,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:e(p).price,"onUpdate:modelValue":F[0]||(F[0]=z=>e(p).price=z),onFocus:g,type:"number",placeholder:"0"},null,8,["modelValue"]),t("span",bt,s((a.type==="buy","MUSD")),1)]),t("div",gt,s(e(E).numberText),1),t("div",ht,[R(_,{class:"bg-[#fff9f0] text-3xl font-bold",onFocus:r,modelValue:e(p).number,"onUpdate:modelValue":F[1]||(F[1]=z=>e(p).number=z),type:"number",placeholder:"0"},null,8,["modelValue"])]),t("div",wt,[e(h)?a.type==="buy"?(u(),P(ee,{key:1,onClick:w,disabled:+e(p).price<=0||e(p).number<n.value||O.value>f.value,loading:e(J),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:L(()=>[k(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(u(),P(ee,{key:2,onClick:w,disabled:+e(p).price<=0||e(p).number<n.value||e(p).number>f.value,loading:e(J),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:L(()=>[k(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(u(),P(ee,{key:0,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",loading:e(i),onClick:C},{default:L(()=>[k(s(o.$t("assets.auth"))+" "+s(a.type==="buy"?"MUSD":"MAI"),1)]),_:1},8,["loading"]))]),a.type=="sell"?(u(),T("div",vt,[t("div",null,s(o.$t("ecology.hand num"))+" "+s(n.value)+"MAI, "+s(o.$t("ecology.otcDeduct")),1),t("div",_t," * "+s(o.$t("ecology.estimated get"))+s(e(S)(O.value*.7))+" MUSD, "+s(o.$t("ecology.estimated consume"))+" "+s(e(S)(e(p).number))+" MAI ",1)])):(u(),T("div",xt,[t("div",null,s(o.$t("ecology.hand num"))+" "+s(n.value)+" MAI",1),t("div",$t," *"+s(o.$t("ecology.estimated get"))+s(e(S)(e(p).number))+" MAI, "+s(o.$t("ecology.estimated consume"))+s(O.value)+" MUSD ",1)]))])]),_:1},8,["show","title"])}}}),At=oe(kt,[["__scopeId","data-v-0a534fbf"]]),Mt={class:"mt-5"},It={class:"flex justify-between"},Bt={class:"text-base font-semibold"},Ot={class:"text-base font-medium opacity-80"},Ct={class:"flex justify-between mt-2.5"},Ft={class:"text-base font-semibold"},Lt={class:"text-base font-medium opacity-80"},St={class:"flex justify-between mt-6"},Pt={class:"text-sm font-medium"},Ut={class:"text-sm opacity-80"},Tt={class:"flex justify-between items-center bg-[#fff9f0] rounded-lg py-2.5 pr-2.5 mt-2.5"},Dt={class:"flex flex-col items-center justify-center mt-5"},Vt={class:"mt-5"},Rt={key:0,class:"mt-2 text-left"},Et={class:"text-[#FBA923]"},Nt={class:"text-[#FBA923]"},jt=k(" MUSD "),zt={key:1,class:"mt-2"},qt={class:"text-[#FBA923]"},Gt={class:"text-[#FBA923]"},Ht=ae({props:{show:{type:Boolean},type:null,token:null,musd:null,orderInfo:null,isAuth:{type:Boolean},musdBalance:null,tokenBalance:null,musdAllowance:null,tokenAllowance:null,otcAddress:null},emits:["update:show","approve","success"],setup(a,{emit:c}){const l=a,{trade:D}=ue(),x=G(()=>+l.tokenAllowance>=+b.number&&+l.tokenAllowance>0),U=G(()=>+l.musdAllowance>=+b.number*+l.orderInfo.price&&+l.musdAllowance>0),A=de({isAuth:!1,btnLoading:!1}),B=G(()=>l.orderInfo.remain<b.number),M=G(()=>l.orderInfo.remain>10?`1-${S(l.orderInfo.remain-10)} || ${l.orderInfo.remain}`:l.orderInfo.remain),p=G(()=>l.type==="buy"?1:2),E=()=>{c("update:show",!1)},h=async()=>{A.btnLoading=!0;let g;if(p.value===1?g=await Y(l.token).approve(l.otcAddress):g=await Y(l.musd).approve(l.otcAddress),!g.success)return A.btnLoading=!1;A.isAuth=!0,c("approve"),A.btnLoading=!1},O=async()=>{A.btnLoading=!0;try{(await D(l.orderInfo.id,+b.number)).success&&c("success")}finally{A.btnLoading=!1}},b=de({number:""}),$=()=>{p.value===1?b.number=+l.tokenBalance<+l.orderInfo.remain?l.tokenBalance:l.orderInfo.remain:b.number=+l.musdBalance/l.orderInfo.price<+l.orderInfo.remain?+l.musdBalance/l.orderInfo.price:l.orderInfo.remain};return(g,r)=>{const i=V("VanField"),v=V("VanButton");return u(),P(ve,{show:a.show,"onUpdate:show":r[1]||(r[1]=I=>se(show)?show.value=I:null),title:a.type=="sell"?g.$t("otc.buyIn"):g.$t("otc.sellOut"),onClose:E,overlay:!1},{default:L(()=>[t("div",Mt,[t("div",It,[t("span",Bt,s(g.$t("mall.price")),1),t("span",Ot,s(e(S)(a.orderInfo.price||0,4))+" MUSD",1)]),t("div",Ct,[t("span",Ft,s(g.$t("ecology.total")),1),t("span",Lt,s(e(S)(a.orderInfo.remain||0,4))+" MAI",1)]),t("div",St,[t("span",Pt,s(a.type=="sell"?g.$t("ecology.buyquantity"):g.$t("ecology.sellquantity")),1),t("span",Ut,s(a.type=="sell"?"MUSD":"MAI")+s(g.$t("assets.balance"))+s(a.type=="sell"?a.musdBalance:a.tokenBalance),1)]),t("div",Tt,[R(i,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:e(b).number,"onUpdate:modelValue":r[0]||(r[0]=I=>e(b).number=I),type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",{class:"px-1.5 py-1 border-[1px] rounded border-[#FBA923] border-solid text-xs text-[#FBA923] font-medium",onClick:$}," MAX ")]),t("div",Dt,[(a.type==="sell"?e(U):e(x))?(u(),P(v,{key:0,loading:e(A).btnLoading,disabled:!e(b).number||+e(b).number<=0||e(B),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",onClick:O},{default:L(()=>[k(s(g.$t("common.submit")),1)]),_:1},8,["loading","disabled"])):(u(),P(v,{key:1,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",disabled:!e(b).number||+e(b).number<=0||e(B),loading:e(A).btnLoading,onClick:h},{default:L(()=>[k(s(g.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading"]))]),t("div",Vt,s(g.$t("ecology.tips",{Currency:a.type=="sell"?"MAI":"MUSD",num:e(M)})),1),a.type==="sell"?(u(),T("div",Rt,[k(" *"+s(g.$t("ecology.estimated get"))+" ",1),t("span",Et,s(e(b).number||0),1),k(" MAI, "+s(g.$t("ecology.estimated consume"))+" ",1),t("span",Nt,s(e(S)(+a.orderInfo.price*+e(b).number)),1),jt])):(u(),T("div",zt,[k(" *"+s(g.$t("ecology.estimated get"))+" ",1),t("span",qt,s(e(S)(+e(b).number*+a.orderInfo.price*.7)),1),k(" MUSD, "+s(g.$t("ecology.estimated consume"))+" ",1),t("span",Gt,s(+e(b).number||0),1),k(" MAI, "+s(g.$t("ecology.otcDeduct")),1)]))])]),_:1},8,["show","title"])}}}),Wt=oe(Ht,[["__scopeId","data-v-d00e60c8"]]),Kt={class:"mt-4 text-base font-bold flex-center-bw"},Zt={class:"mt-4"},Jt={class:"text-sm text-[#2E2008] font-medium"},Qt={class:"flex flex-col items-center justify-center mt-5 text-sm font-semibold text-white"},Xt={key:0,class:"mt-4 text-xs text-center"},Yt={class:"mt-1"},es={class:"mt-1"},ts={class:"text-[#FBA923]"},ss={class:"text-[#FBA923]"},ns=k(" MAI "),os={key:1,class:"mt-4 text-xs text-center"},as={class:"mt-1"},ls={class:"text-[#FBA923]"},cs={class:"text-[#FBA923]"},rs=k(" MUSD "),is=ae({props:{show:{type:Boolean},type:null,price:null,token:null,musd:null},emits:["update:show","success"],setup(a,{emit:c}){const{show:l,type:D,price:x,token:U,musd:A}=a,B=he(),{getMarketIds:M,getOrderInfo:p,batchTrade:E}=ue(),h=re.otc,[O,b]=X(!1),$=Q([]),g=d=>{$.value=d},r=de({orderInfo:{},amountShow:!1,list:[],btnLoading:!1,tokenAllowance:"",tokenBalance:"",musdAllowance:"",musdBalance:""}),i=G(()=>r.list.reduce((w,y)=>$.value.find(o=>o===y.id)?w+y.remain:w,0)),v=G(()=>r.list.reduce((w,y)=>$.value.find(o=>o===y.id)?w+y.remain*y.price:w,0)),I=G(()=>+r.tokenAllowance>=+i.value&&+r.tokenAllowance>0),j=G(()=>+r.musdAllowance>=+v.value),W=G(()=>{const d={title:B.t("ecology.buy"),btnText:B.t("ecology.buyin"),batchBtnText:B.t("ecology.Bulkbuy"),btnClass:"btn-green"};return D==="buy"&&(d.title=B.t("ecology.Sell"),d.btnText=B.t("ecology.sellout"),d.batchBtnText=B.t("ecology.sellinbulk"),d.btnClass="btn-pink"),d}),C=G(()=>D==="buy"?1:2),Z=()=>{c("update:show",!1)},K=async()=>{const d=await Y(A).allowance(re.otc);r.musdAllowance=d.result,r.musdBalance=String(S(await Y(A).balanceOf()));const w=await Y(U).allowance(re.otc);r.tokenAllowance=w.result,r.tokenBalance=String(S(await Y(U).balanceOf()))},n=async()=>{const d=await M(C.value,te(x)),w=[];for(let y=0;y<d.result.length;y++){const o=await p(d.result[y]);w.push({id:d.result[y],price:x,remain:ce(o.result.remain.toString())})}r.list=w},m=async()=>{r.btnLoading=!0;let d;if(C.value===1?d=await Y(U).approve(re.otc):d=await Y(A).approve(re.otc),!d.success)return r.btnLoading=!1;await K(),f()},f=async()=>{const d=r.list.reduce((w,y)=>$.value.find(o=>o===y.id)?w+y.remain:w,0);if(C.value===1){if(d>r.tokenAllowance&&d<=r.tokenBalance)return m()}else if(d>r.musdAllowance&&d<=r.musdBalance)return m();r.btnLoading=!0;try{(await E($.value)).success&&c("success")}finally{r.btnLoading=!1}},N=d=>{r.orderInfo=d,b(!0)},J=()=>{b(!1),c("success")};return pe(async()=>{r.btnLoading=!0,await K(),await n(),r.btnLoading=!1}),(d,w)=>{const y=V("van-checkbox"),o=V("VanButton"),F=V("van-checkbox-group");return u(),T(ie,null,[R(ve,{show:a.show,"onUpdate:show":w[1]||(w[1]=_=>se(l)?l.value=_:null),title:`${a.price}${e(W).title}`,onClose:Z,"close-on-click-overlay":!e(O)},{default:L(()=>[t("div",Kt,[a.type=="buy"?(u(),T(ie,{key:0},[t("span",null,s(d.$t("common.balance",{token:"MAI"})),1),t("span",null,s(e(r).tokenBalance||0),1)],64)):(u(),T(ie,{key:1},[t("span",null,s(d.$t("common.balance",{token:"MUSD"})),1),t("span",null,s(e(r).musdBalance||0),1)],64))]),t("div",Zt,[R(F,{modelValue:$.value,"onUpdate:modelValue":w[0]||(w[0]=_=>$.value=_),onChange:g},{default:L(()=>[(u(!0),T(ie,null,we(e(r).list,_=>(u(),T("div",{class:"flex justify-between items-center bg-[#fff9f0] rounded-lg p-2.5 mt-2.5",key:_.id},[R(y,{name:_.id,"icon-size":"1rem","checked-color":a.type==="sell"?"#14D8A9":"#EA1649"},{default:L(()=>[t("span",Jt,s(e(S)(_.remain||0,4))+" MAI",1)]),_:2},1032,["name","checked-color"]),R(o,{class:le(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:ee=>N(_)},{default:L(()=>[k(s(e(W).btnText),1)]),_:2},1032,["class","onClick"])]))),128))]),_:1},8,["modelValue"]),t("div",Qt,[(a.type==="sell"?!e(j):!e(I))?(u(),P(o,{key:0,disabled:!$.value.length,loading:e(r).btnLoading,class:le(["flex-1 w-40 py-3",e(W).btnClass]),onClick:m},{default:L(()=>[k(s(d.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading","class"])):(u(),P(o,{key:1,disabled:!$.value.length,loading:e(r).btnLoading,class:le(["flex-1 w-40 py-3",e(W).btnClass]),onClick:f},{default:L(()=>[k(s(e(W).batchBtnText),1)]),_:1},8,["disabled","loading","class"]))]),a.type=="buy"?(u(),T("div",Xt,[t("div",Yt,s(d.$t("ecology.otcDeduct")),1),t("div",es,[k(" *"+s(d.$t("ecology.estimated get"))+" ",1),t("span",ts,s(e(S)(e(v)*.7)),1),k(" MUSD，"+s(d.$t("ecology.estimated consume"))+" ",1),t("span",ss,s(e(S)(e(i))),1),ns])])):(u(),T("div",os,[t("div",as,[k(" *"+s(d.$t("ecology.estimated get"))+" ",1),t("span",ls,s(e(S)(e(i))),1),k(" MAI，"+s(d.$t("ecology.estimated consume"))+" ",1),t("span",cs,s(e(S)(e(v))),1),rs])]))])]),_:1},8,["show","title","close-on-click-overlay"]),e(O)?(u(),P(Wt,{key:0,type:a.type,show:e(O),"onUpdate:show":w[2]||(w[2]=_=>se(O)?O.value=_:null),token:a.token,musd:a.musd,isAuth:a.type=="sell"?e(j):e(I),isMusdtAuth:e(j),orderInfo:e(r).orderInfo,musdBalance:e(r).musdBalance,tokenBalance:e(r).tokenBalance,otcAddress:e(h),tokenAllowance:e(r).tokenAllowance,musdAllowance:e(r).musdAllowance,onApprove:K,onSuccess:J},null,8,["type","show","token","musd","isAuth","isMusdtAuth","orderInfo","musdBalance","tokenBalance","otcAddress","tokenAllowance","musdAllowance"])):ne("",!0)],64)}}}),ds=oe(is,[["__scopeId","data-v-c02d36b2"]]),us={class:"flex items-center justify-between mb-4"},ms={class:"flex font-semibold"},ps={key:1},ys={class:"flex items-center justify-between pt-5 t-border"},fs={class:"opacity-80"},bs={class:"text-[#2E2008] font-semibold"},gs={key:1},hs={class:"flex items-center justify-between mt-5"},ws={class:"opacity-80"},vs={class:"text-[#2E2008] font-semibold"},_s={key:1},xs={class:"flex items-center justify-between mt-5"},$s=ae({props:{show:{type:Boolean},musd:null,mai:null},emits:["close","success"],setup(a,{emit:c}){const{lastPrice:l}=De(),{burnMAI:D,burnMusd:x,burnMAIFund:U,burnMUSDFund:A}=ue(),[B,M]=X(!1),[p,E]=X(!1),[h,O]=X(!1),[b,$]=X(!1),[g,r]=X(!1),i=de({musdBalance:null,maiBalance:null,maiPrice:null}),v=()=>{c("close")},I=async()=>{M(!0),i.maiBalance=String(S(await U())),M(!1)},j=async()=>{E(!0),i.musdBalance=String(S(await A())),E(!1)},W=async()=>{$(!0);const n=await D();$(!1),n.success&&K()},C=async()=>{r(!0);const n=await x();r(!1),n.success&&K()},Z=async()=>{O(!0),i.maiPrice=+await l(),O(!1)},K=()=>{Z(),I(),j()};return pe(async()=>{await K()}),(n,m)=>{const f=V("van-loading"),N=V("van-icon"),J=V("VanLoading"),d=V("VanButton"),w=V("van-popup");return u(),P(w,{show:a.show,"onUpdate:show":m[0]||(m[0]=y=>se(show)?show.value=y:null),round:"",style:{padding:"20px"},onClose:v},{default:L(()=>[t("div",us,[t("div",ms,[k(s(n.$t("ecology.price"))+": ",1),e(h)?(u(),P(f,{key:0,size:"18px"})):(u(),T("span",ps,s(e(S)(e(i).maiPrice,6))+" MUSD",1))]),R(N,{name:"cross",size:"18px",onClick:v})]),t("div",ys,[t("div",fs,"MUSD "+s(n.$t("ecology.canBurn")),1),t("div",bs,[e(p)?(u(),P(J,{key:0,size:"18"})):(u(),T("span",gs,s(e(ke)(e(i).musdBalance||0)),1))])]),t("div",hs,[t("div",ws,"MAI "+s(n.$t("ecology.canBurn")),1),t("div",vs,[e(B)?(u(),P(J,{key:0,size:"18"})):(u(),T("span",_s,s(e(ke)(e(i).maiBalance||0)),1))])]),t("div",xs,[R(d,{class:"btn h-[35px] min-w-[120px] px-4 text-white font-semibold mr-4",loading:e(g),disabled:e(i).musdBalance<=0,onClick:C},{default:L(()=>[k(s(n.$t("ecology.burn",{token:"MUSD"})),1)]),_:1},8,["loading","disabled"]),R(d,{class:"btn h-[35px] min-w-[120px] px-4 text-white font-semibold",loading:e(b),disabled:e(i).maiBalance<=0,onClick:W},{default:L(()=>[k(s(n.$t("ecology.burn",{token:"MAI"})),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"])}}}),ks=oe($s,[["__scopeId","data-v-7c8fe999"]]),As=""+new URL("../images/Rectangle_L_O-CWbZvLrI.svg",import.meta.url).href,Ms=""+new URL("../images/Rectangle_L_W-CZS7CLEN.svg",import.meta.url).href,Is=""+new URL("../images/Rectangle_R_O-4n4iOOR3.svg",import.meta.url).href,Bs=""+new URL("../images/Rectangle_R_W-BigIS_qZ.svg",import.meta.url).href,Os={class:"w-[21rem] bg-[#FFFDF8] text-xs text-[#2E2008]"},Cs={class:"container"},Fs={class:"flex items-center justify-between px-5 py-4 text-base font-semibold"},Ls={class:"relative flex h-10"},Ss=["src"],Ps=["src"],Us={class:"h-10 z-10 flex items-center w-[21rem] text-base font-medium"},Ts={class:"p-2.5 maxH overflow-auto"},Ds={class:"flex justify-between header pb-2.5"},Vs={class:"text-xl font-bold"},Rs={class:"flex justify-between mt-2.5 text-sm"},Es={class:"opacity-80"},Ns={class:"font-semibold"},js={class:"flex justify-between mt-2.5 text-sm"},zs={class:"opacity-80"},qs={class:"font-semibold"},Gs={class:"flex justify-between mt-2.5 text-sm"},Hs={class:"opacity-80"},Ws={class:"font-semibold"},Ks=ae({props:{show:{type:Boolean},type:null},emits:["update:show","success"],setup(a,{emit:c}){const{show:l,type:D}=a,{getPendingIds:x,cancel:U,getOrderInfo:A}=ue(),B=()=>{c("update:show",!1)},M=G(()=>p.value==="buy"?$.value.filter(i=>i.direct===1):$.value.filter(i=>i.direct===2)),p=Q("buy"),E=i=>{p.value!==i&&(p.value=i)},h=G(()=>p.value==="buy"?Ms:As),O=G(()=>p.value==="sell"?Bs:Is),b=Q([]),$=Q([]),g=async()=>{const i=await x();i.success&&(b.value=i.result,b.value.forEach(async v=>{const I=await A(v);$.value.push({direct:+I.result.direct,price:S(ge(I.result.price)),total:S(ge(I.result.total)),remain:S(ge(I.result.remain)),token:I.result.token,sender:I.result.sender,status:+I.result.status,id:v,loading:!1})}))},r=async i=>{i.loading=!0;const v=await U(i.id);i.loading=!1,v.success&&(B(),c("success"))};return pe(()=>{p.value=D,g()}),(i,v)=>{const I=V("van-icon"),j=V("VanButton"),W=V("van-popup");return u(),P(W,Me(i.$attrs,{show:a.show,"onUpdate:show":v[2]||(v[2]=C=>se(l)?l.value=C:null),style:{height:"80vh"},round:"","overlay-class":"",onClose:B}),{default:L(()=>[t("div",Os,[t("div",Cs,[t("div",Fs,[t("span",null,s(i.$t("ecology.mypendingorder")),1),R(I,{name:"cross",class:"text-xl font-semibold",onClick:B})]),t("div",Ls,[t("img",{class:le(["h-10 absolute left-0 bottom-[-1px]",{"z-10":p.value=="buy"}]),src:e(h),alt:""},null,10,Ss),t("img",{class:le(["h-10 absolute right-0 bottom-[-1px]",{"z-10":p.value=="sell"}]),src:e(O),alt:""},null,10,Ps),t("div",Us,[t("span",{class:le(["text-[#2E2008] flex-1 text-center",{"text-[#FEA021]":p.value=="buy"}]),onClick:v[0]||(v[0]=C=>E("buy"))},s(i.$t("ecology.mybill")),3),t("span",{class:le(["text-[#2E2008] opacity-60 flex-1 text-center",{"text-[#FEA021]":p.value=="sell"}]),onClick:v[1]||(v[1]=C=>E("sell"))},s(i.$t("ecology.mysellorder")),3)])])]),t("div",Ts,[(u(!0),T(ie,null,we(e(M),(C,Z)=>(u(),T("div",{class:"bg-[#FFF1D9]/[0.4] rounded p-2.5 mt-2.5 order-box",key:Z},[t("div",Ds,[t("span",Vs,s(C.price||0),1),C.status==1?(u(),P(j,{key:0,class:"btn-border px-3.5 h-[28px] rounded-2xl text-xs text-[#FBA923] font-medium min-w-[65px] text-center"},{default:L(()=>[k(s(i.$t("ecology.completed")),1)]),_:1})):ne("",!0),C.status==0?(u(),P(j,{key:1,onClick:K=>r(C),loading:C.loading,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:L(()=>[k(s(i.$t("ecology.revoke")),1)]),_:2},1032,["onClick","loading"])):ne("",!0),C.status===2?(u(),P(j,{key:2,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:L(()=>[k(s(i.$t("ecology.canceled")),1)]),_:1})):ne("",!0)]),t("div",Rs,[t("span",Es,s(i.$t("ecology.Totalendingorders")),1),t("span",Ns,s(C.total||0)+" MAI",1)]),t("div",js,[t("span",zs,s(i.$t("ecology.transactionquantity")),1),t("span",qs,s(C.total-C.remain||0)+" MAI",1)]),t("div",Gs,[t("span",Hs,s(i.$t("ecology.remainingquantity")),1),t("span",Ws,s(C.remain||0)+" MAI",1)])]))),128))])])]),_:1},16,["show"])}}}),Zs=oe(Ks,[["__scopeId","data-v-6cfa95f7"]]),_e=a=>(Oe("data-v-1087f20c"),a=a(),Ce(),a),Js={class:"bg-[#FFFDF8] rounded-xl p-2.5 pt-5 pb-3.5"},Qs={class:"flex-center relative flex-col text-[#F36B07] rounded-xl bg-[#FFF1D9]/[0.6] py-5 font-normal text-sm"},Xs={class:"text-3xl font-bold"},Ys=_e(()=>t("span",{class:"ml-2"},"MUSD",-1)),en={class:"text-[#2E2008] font-medium opacity-60"},tn=_e(()=>t("img",{src:Ie},null,-1)),sn=[tn],nn={class:"pt-2.5 pb-1 flex justify-between text-white font-semibold text-sm"},on=_e(()=>t("div",{class:"w-5"},null,-1)),an=ae({props:{isOld:{type:Boolean}},setup(a){const{loadingToggle:c}=Te(),{lastPrice:l,getMarketPrices:D,getMarketIds:x,maiAddress:U,musdAddress:A,getOrderInfo:B}=ue(),{reloadStore:M}=Ue(),p=1,E=2,h=de({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),O=Q(),b=Q(""),$=Q(""),[g,r]=X(!1),[i,v]=X(!1),[I,j]=X(!1),[W,C]=X(!1),Z=y=>{b.value=y,r(!0)},K=(y,o)=>{O.value=o.price,$.value=y,v(!0)},n=y=>{$.value=y,j(!0)},m=async()=>{const y=await l();h.lastPrice=y||0},f=async()=>{const y=await U(),o=await A();h.token=y.result,h.musd=o.result},N=async()=>{const y=await D(E),o=[];for(let F=0;F<y.result.length;F++){const _=await x(E,y.result[F]);let ee=0;for(let z=0;z<_.result.length;z++){const me=await B(_.result[z]);ee+=ce(me.result.remain.toString())}o.push({price:ce(y.result[F].toString()),amount:S(ee)}),h.sellOrderList=o.filter(z=>z.amount!==0),h.sellOrderList=h.sellOrderList.sort((z,me)=>z.price-me.price)}},J=async()=>{const y=await D(p),o=[];for(let F=0;F<y.result.length;F++){const _=await x(p,y.result[F]);let ee=0;for(let z=0;z<_.result.length;z++){const me=await B(_.result[z]);ee+=ce(me.result.remain.toString())}o.push({price:ce(y.result[F].toString()),amount:S(ee)})}h.buyOrderList=o.filter(F=>F.amount!==0),h.buyOrderList=h.buyOrderList.sort((F,_)=>_.price-F.price)},d=async()=>{M.reload(),J(),N(),m(),v(!1)},w=async()=>{c(!0),await Promise.all([f(),m(),N(),J()]),c(!1)};return pe(async()=>{await w()}),(y,o)=>{const F=V("VanButton");return u(),T("div",Js,[t("div",Qs,[t("div",null,[t("span",Xs,s(e(h).lastPrice),1),Ys]),t("div",en,s(y.$t("ecology.Latesttransactionprice")),1),a.isOld?ne("",!0):(u(),T("div",{key:0,onClick:o[0]||(o[0]=_=>e(C)(!0)),class:"absolute top-3 right-3 w-[25px] h-[25px]"},sn))]),t("div",nn,[R(F,{class:"flex-1 h-10 px-4 btn-green",onClick:o[1]||(o[1]=_=>Z("buy")),disabled:a.isOld},{default:L(()=>[k(s(y.$t("ecology.Pendingpurchase")),1)]),_:1},8,["disabled"]),on,R(F,{class:"flex-1 h-10 px-4 btn-pink",onClick:o[2]||(o[2]=_=>Z("sell")),disabled:a.isOld},{default:L(()=>[k(s(y.$t("ecology.Hangforsale")),1)]),_:1},8,["disabled"])]),R(Ae,{type:"sell",onOnClick:K,onOnCheckMyOrder:n,list:e(h).sellOrderList,isOld:a.isOld},null,8,["list","isOld"]),R(Ae,{type:"buy",onOnClick:K,onOnCheckMyOrder:n,list:e(h).buyOrderList,isOld:a.isOld},null,8,["list","isOld"]),e(g)?(u(),P(At,{key:0,show:e(g),"onUpdate:show":o[3]||(o[3]=_=>se(g)?g.value=_:null),onSuccess:d,type:b.value,lastPrice:e(h).lastPrice},null,8,["show","type","lastPrice"])):ne("",!0),e(i)?(u(),P(ds,{key:1,show:e(i),"onUpdate:show":o[4]||(o[4]=_=>se(i)?i.value=_:null),type:$.value,price:O.value,token:e(h).token,musd:e(h).musd,onSuccess:d},null,8,["show","type","price","token","musd"])):ne("",!0),e(I)?(u(),P(Zs,{key:2,show:e(I),"onUpdate:show":o[5]||(o[5]=_=>se(I)?I.value=_:null),type:$.value,isOld:a.isOld,success:"handleSuccess"},null,8,["show","type","isOld"])):ne("",!0),e(W)?(u(),P(ks,{key:3,show:e(W),lastPrice:e(h).lastPrice,musd:e(h).musd,mai:e(h).token,onClose:o[6]||(o[6]=_=>e(C)(!1)),onSuccess:m},null,8,["show","lastPrice","musd","mai"])):ne("",!0)])}}}),ln=oe(an,[["__scopeId","data-v-1087f20c"]]),cn={class:"relative h-full"},rn=ae({setup(a){return(c,l)=>(u(),T("div",cn,[R(Re),R(Ve,{icon:"svg/ecology/otc.svg",text:`${c.$t("ecology.otc")}2.0`},{default:L(()=>[R(ln,{isOld:!1})]),_:1},8,["text"])]))}}),xn=oe(rn,[["__scopeId","data-v-adea3b14"]]);export{xn as default};
