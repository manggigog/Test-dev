import{_ as ie,x as I,F as u,G as t,H as n,I as _,J as V,a2 as C,Q as g,P as l,Y as re,Z as ce,y as xe,r as x,a1 as ge,a7 as ke,D as be,a9 as Ee,K as D,N as F,l as Ne,E as T,O as A,a0 as $,T as le}from"./vendor-BUT0HZ5j.js";import{C as De}from"./CommonVanProvider-BpsZUrD3.js";import{e as Fe,aN as b,aO as ue,as as ne,aK as Ae}from"./index-DDhEkd_5.js";import{u as Se}from"./useCityMap-SBIl8UZu.js";import{B as Le}from"./BetweenTab-Bn5ZVRk8.js";import{_ as we}from"./SearchBar-DUv-Q4mh.js";import"./BackIcon-biFt6cm7.js";/* empty css                                                               */import"./search-Dwmdj_3F.js";import"./delete-C3qvlPYO.js";const Be="/Test-dev/static/images/gps-C70Ke3rM.svg",ve="/Test-dev/static/images/flag-DsGJY6jz.svg",Re=d=>(re("data-v-7e70a18a"),d=d(),ce(),d),Ie={class:"active-cities_container px-4"},Ve=Re(()=>n("p",{class:"test-sm text-b3 font-normal"},"当前开通的城市",-1)),$e=["onClick"],Oe={key:0},Te={key:1,src:ve,class:"w-[18px] h-[18px] ml-1"},qe={props:{cityList:{type:Array,default:()=>[]},limit:{type:[Number,String],default:5}},emits:["click"],setup(d,{emit:e}){const S=d,E=I(()=>S.cityList.slice(0,S.limit)),N=r=>{e("set",r)};return(r,f)=>(t(),u("div",Ie,[Ve,n("div",null,[(t(!0),u(_,null,V(l(E),m=>(t(),u("div",{key:m.name,class:"active-cities-item h-[52px] border-b border-solid border-[#E5E5E5] flex items-center justify-start text-sm font-normal text-b1",onClick:L=>N(m)},[n("span",null,g(m.areaName),1),Number(m.storeCount)>0?(t(),u("span",Oe,"(入驻门店"+g(m.storeCount)+"家)",1)):C("",!0),m.visitedFlag?(t(),u("img",Te)):C("",!0)],8,$e))),128))])]))}},je=ie(qe,[["__scopeId","data-v-7e70a18a"]]),de=d=>(re("data-v-23737cce"),d=d(),ce(),d),Ke={class:"px-3 pb-2"},Ue={class:"h-[calc(100vh-127px)] overflow-y-auto relative"},Pe={key:0,class:"search-result"},He={class:"px-4 pt-3"},ze=de(()=>n("p",{class:"text-sm font-normal text-b3"},"当前定位城市/上次选择",-1)),Ge={class:"py-4 flex items-center justify-start gap-3"},Je=de(()=>n("img",{src:Be,class:"w-4 h-4 mr-1"},null,-1)),Ye={class:"text-sm font-normal text-[#FF8812]"},Qe=$(" 定位失败 "),Ze=$(" 定位中... "),We={class:"text-sm font-normal text-b1"},Xe={class:"text-sm font-normal text-b1"},Me={key:0},et={class:"relative"},tt={class:"flex items-center justify-start"},st={class:"custom-title"},at={key:0,src:ve,class:"w-[18px] h-[18px] ml-1"},ot=xe({setup(d){const{cityMapStore:e}=Fe(),{getUserLocation:S}=Se(),E=ge(),N=Ne(),r=x(null),f=x([]),m=x(!1),L=x(!1),p=x([]),i={CN:0,OVERSEAS:1},me=[{label:"国内(含港澳台)",value:i.CN},{label:"海外",value:i.OVERSEAS}],s=x({status:(e==null?void 0:e.selectedCountry)==="cn"?i.CN:i.OVERSEAS,keyword:"",isSelector:E.query.mode==="select",fromRoute:E.query.from?decodeURIComponent(String(E.query.from)):""}),q=I(()=>r.value?(s.value.status===i.CN,Object.keys(r.value)):[]),Ce=I(()=>ke.isEmpty(r.value)),j=I(()=>s.value.keyword.trim()!==""&&m.value),pe=o=>{s.value.status=o,j.value?(o===i.CN?r.value=b(e==null?void 0:e.regions):r.value=b(e==null?void 0:e.overseasRegions),K(s.value.keyword)):o===i.CN?r.value=b(e==null?void 0:e.regions):r.value=b(e==null?void 0:e.overseasRegions),p.value=e.getActiveCitiesList(o!==i.CN)||[],O(p.value),console.log(q.value)},K=async o=>{if(console.log("搜索关键词:",o),!o.trim()){f.value=[];return}m.value=!0;try{const a={areaLevel:"2",keywords:o.trim()};L.value=!0,le.loading({message:"搜索中...",duration:0,forbidClick:!1});const y=await Ae(s.value.status,a);f.value=y.data||[]}catch(a){console.error("搜索失败:",a),f.value=[]}finally{le.clear(),L.value=!1}},_e=()=>{f.value=[],m.value=!1},k=o=>{if(!(!o||!o.areaName)){if(s.value.isSelector)e.setSelectedArea(o);else{const a=s.value.status===i.CN?"cn":"overseas";e.setCurrentCity(o,"manual",a)}s.value.fromRoute==="back"?N.back():N.replace({path:s.value.fromRoute})}},U=x({}),fe=async()=>{p.value=e.getActiveCitiesList(s.value.status!==i.CN)||[];try{const[o,a]=await Promise.all([ue({overseasFlag:!1}),ue({overseasFlag:!0})]),y=o.data||[],w=a.data||[];e.setActiveCitiesList(y,!1),e.setActiveCitiesList(w,!0),p.value=s.value.status===i.CN?y:w,O(p.value)}catch(o){console.error("获取开通城市失败:",o),p.value=e.getActiveCitiesList(s.value.status!==i.CN)||[],O(p.value)}},O=o=>{o.forEach(a=>{a.visitedFlag&&(U.value[a.areaName]=!0)})},ye=()=>{N.push("/city/footprints")};return be(()=>{e!=null&&e.regions||e.init(),s.value.status===i.CN?r.value=b(e==null?void 0:e.regions):r.value=b(e==null?void 0:e.overseasRegions),fe(),document.querySelector("#app").style.minHeight="580px"}),Ee(()=>{document.querySelector("#app").style.minHeight=null}),(o,a)=>{const y=T("van-cell"),w=T("van-index-anchor"),he=T("van-index-bar");return t(),D(De,{title:"当前位置",class:"bg-white font-Puhui font-normal relative min-h-[560px]","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(B,R)=>{R.searchRef=B}},{right:F(()=>[s.value.isSelector?C("",!0):(t(),u("div",{key:0,class:"text-sm font-normal text-b2",onClick:ye}," 足迹 "))]),default:F(()=>{var B,R,P,H,z,G,J,Y,Q,Z,W,X,M,ee,te,se,ae,oe;return[n("section",null,[n("div",Ke,[A(we,{modelValue:s.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=v=>s.value.keyword=v),placeholder:"搜索城市名称/拼音","search-button-text":"搜索",onSearch:K,onClear:_e},null,8,["modelValue"])]),A(Le,{options:me,"label-key":"label","value-key":"value",modelValue:s.value.status,"onUpdate:modelValue":a[1]||(a[1]=v=>s.value.status=v),onChange:pe,class:"relative z-10"},null,8,["modelValue"]),n("section",Ue,[l(j)?(t(),u("div",Pe,[f.value.length===0&&!L.value?(t(),D(ne,{key:0,name:"暂无搜索结果"})):C("",!0),(t(!0),u(_,null,V(f.value,v=>(t(),D(y,{class:"w-full",title:v.areaName,key:v.areaId,onClick:c=>k(v)},null,8,["title","onClick"]))),128))])):(t(),u(_,{key:1},[n("div",He,[ze,n("div",Ge,[n("div",{class:"area-box position-box",onClick:a[2]||(a[2]=v=>{var c,h;return(c=l(e))!=null&&c.locationCity?k((h=l(e))==null?void 0:h.locationCity):l(S)("reset")})},[Je,n("span",Ye,[(B=l(e))!=null&&B.locationCity?(t(),u(_,{key:0},[$(g(((P=(R=l(e))==null?void 0:R.locationCity)==null?void 0:P.areaName)||"--"),1)],64)):(H=l(e))!=null&&H.locationCity?(t(),u(_,{key:2},[Ze],64)):(t(),u(_,{key:1},[Qe],64))])]),s.value.status===i.CN&&((z=l(e))!=null&&z.lastSelectCity)&&((J=(G=l(e))==null?void 0:G.lastSelectCity)==null?void 0:J.areaId)!=((Q=(Y=l(e))==null?void 0:Y.locationCity)==null?void 0:Q.areaId)?(t(),u("div",{key:0,class:"area-old-box position-box",onClick:a[3]||(a[3]=v=>{var c;return k((c=l(e))==null?void 0:c.lastSelectCity)})},[n("span",We,g((W=(Z=l(e))==null?void 0:Z.lastSelectCity)==null?void 0:W.areaName),1)])):C("",!0),s.value.status===i.OVERSEAS&&((X=l(e))!=null&&X.lastSelectOverseasCity)&&((ee=(M=l(e))==null?void 0:M.lastSelectOverseasCity)==null?void 0:ee.areaId)!=((se=(te=l(e))==null?void 0:te.locationCity)==null?void 0:se.areaId)?(t(),u("div",{key:1,class:"area-old-box position-box",onClick:a[4]||(a[4]=v=>{var c;return k((c=l(e))==null?void 0:c.lastSelectOverseasCity)})},[n("span",Xe,g((oe=(ae=l(e))==null?void 0:ae.lastSelectOverseasCity)==null?void 0:oe.areaName),1)])):C("",!0)])]),s.value.status===i.CN?(t(),u("div",Me,[A(je,{cityList:p.value,onSet:k,limit:5},null,8,["cityList"])])):C("",!0),n("div",et,[l(Ce)?(t(),D(ne,{key:0,name:"暂无地区数据"})):C("",!0),A(he,{sticky:!0,"index-list":l(q),teleport:"#app",class:"select-area-index-bar"},{default:F(()=>[(t(!0),u(_,null,V(r.value,(v,c)=>(t(),u("div",{key:c},[A(w,{index:c},{default:F(()=>[$(g(c),1)]),_:2},1032,["index"]),(t(!0),u(_,null,V(v,h=>(t(),D(y,{key:h.areaId,onClick:lt=>k(h)},{title:F(()=>[n("p",tt,[n("span",st,g(h.areaName),1),U.value[h.areaName]?(t(),u("img",at)):C("",!0)])]),_:2},1032,["onClick"]))),128))]))),128))]),_:1},8,["index-list"])])],64))])])]}),_:1},512)}}}),_t=ie(ot,[["__scopeId","data-v-23737cce"]]);export{_t as default};
