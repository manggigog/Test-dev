import{_ as L,y as B,bw as U,r as z,z as y,E as c,F as d,G as n,O as u,N as r,I as A,J as E,K as S,H as m,a2 as C,Q as l,P as a,a4 as q,a0 as g,Y as H,Z as M}from"./vendor-BUT0HZ5j.js";import{_ as j}from"./point-arrow-BVnEJLj4.js";import{e as G,d as h,g as J,_ as K}from"./index-hbwLMIYO.js";import{P as v}from"./order-H59PKTFP.js";import{u as Q}from"./usePointRelase-3focXSC4.js";const Y=i=>(H("data-v-bb5719ba"),i=i(),M(),i),Z={class:"payment-method-selector bg-b6 rounded-xl overflow-hidden"},X={class:"custom-title flex items-center justify-start gap-2"},ee=["onClick"],te=Y(()=>m("img",{src:j,class:"w-4 h-4 mx-3"},null,-1)),oe={class:"text-xs text-b3 flex"},ae={key:1},se={key:2,class:"flex"},ne={key:1},le={class:"text-sm text-b2 my-4 leading-5"},ie={class:"flex justify-center gap-x-2"},re=B({name:"PaymentMethodSelector"});function ce(i,{expose:V,emit:k}){const x=i,{contributesStore:s}=G(),{handleNaturePointsToast:w}=Q(),[$,p]=U(!1),f=z(x.modelValue.toString()),D=e=>{f.value=e.toString(),k("update:modelValue",e),k("change",e)},N=()=>{var e,o,b,_;(e=s.releaseData)!=null&&e.remainTotal&&+((o=s.releaseData)==null?void 0:o.remainTotal)>0&&(!((b=s.releaseData)!=null&&b.nextSubmitDate)||new Date().getTime()>=+((_=s.releaseData)==null?void 0:_.nextSubmitDate))?w(P):p(!0)},P=()=>{let e=0;const o=async()=>{console.log("payment-method-selector getPointBalance"),k("getPointBalance"),s.fetchContributes(),await Promise.all([s.fetchUserRelase(),s.getNaturalReleaseTimes()]),e++,e<3&&setTimeout(o,3e3)};o()},R=()=>{p(!1),w(P)};return y(()=>x.modelValue,e=>{f.value=e.toString()}),y(()=>x.boutique,e=>{if(e)try{setTimeout(()=>{s.fetchContributes(),s.fetchUserRelase(),s.getNaturalReleaseTimes()},150)}catch(o){console.warn("Failed to obtain points related data",o)}},{immediate:!0,deep:!0}),V({selectedPaySource:f}),(e,o)=>{const b=c("van-image"),_=c("van-loading"),I=c("van-radio"),O=c("van-cell"),W=c("van-cell-group"),F=c("van-radio-group"),T=c("VanButton");return n(),d("div",Z,[u(F,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t)},{default:r(()=>[(n(!0),d(A,null,E(i.paymentOptions,t=>(n(),S(W,{key:t.source},{default:r(()=>[u(O,{center:"",title:e.$t(t.name),clickable:"",onClick:()=>D(t.source)},{icon:r(()=>[u(b,{src:a(J)(t.icon),class:"w-6 h-6 mr-3"},null,8,["src"])]),title:r(()=>[m("div",X,[m("span",null,l(e.$t(t.name)),1),t.source===a(v).WITHDRAW_POINTS&&a(h)(a(s).freeRelease)>0?(n(),d("div",{key:0,class:"text-xs font-normal text-newOrigin flex-center",onClick:q(N,["stop"])},[g(l(e.$t("integral.keshifang",{num:a(h)(a(s).freeRelease)})),1),te],8,ee)):C("",!0)]),m("div",oe,[g(l(e.$t("huabei.nowCanUse",{symbol:t.source===a(v).USDT_WALLET?`(${t.symbol})`:null}))+" ",1),i.loading?(n(),S(_,{key:0,size:"14"})):(n(),d("span",ae,l(a(h)(t.balance)),1)),t.source===a(v).WITHDRAW_POINTS?(n(),d("span",se,[g(" /"+l(e.$t("integral.order_can_use"))+" ",1),i.loading?(n(),S(_,{key:0,size:"14"})):(n(),d("span",ne,l(a(h)(t.availableBalance)),1))])):C("",!0)])]),"right-icon":r(()=>[u(I,{"icon-size":"16px",name:t.source.toString(),"checked-color":"#FF8812"},null,8,["name"])]),_:2},1032,["title","onClick"])]),_:2},1024))),128))]),_:1},8,["modelValue"]),u(K,{show:a($),name:e.$t("common.tip"),onClose:o[2]||(o[2]=t=>a(p)(!1))},{default:r(()=>[m("div",le,l(e.$t("integral.relaseTip")),1),m("div",ie,[u(T,{type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-full border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:o[1]||(o[1]=t=>a(p)(!1))},{default:r(()=>[g(l(e.$t("common.cancel")),1)]),_:1}),u(T,{class:"bg-btnOrBg rounded-full w-full text-b1 font-semibold",onClick:R},{default:r(()=>[g(l(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["show","name"])])}}const ue=B({...re,props:{paymentOptions:null,modelValue:{default:v.WALLET},boutique:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:modelValue","change","getPointBalance"],setup:ce}),pe=L(ue,[["__scopeId","data-v-bb5719ba"]]);export{pe as P};
