import{_ as x,z as _,x as j,a2 as z,r as u,y as G,D as J,E as M,Z as F,H as A,$ as p,o as H,q as Q,F as i,I as D,G as Z,U as W,P as s,a3 as N,O as v,a4 as X,Q as Y,T as ee}from"./vendor-Dr_RpJ_Y.js";import{C as ae}from"./CommonVanProvider-D__Wy38-.js";import{c as oe}from"./address-pRtYXpmU.js";import{V as le,a as te,z as se,a5 as ne,a6 as ue,s as re}from"./index-LRhcxFAI.js";import{u as de}from"./useKeyboard-DcWqtm11.js";import"./BackIcon-CDrGaEPo.js";const ie={class:"p-3 relative text-center safe-page-body"},me={class:"overflow-hidden rounded-xl bg-white px-3"},ce={key:0,class:"relative px-3 pt-4"},fe=_({setup(pe){const{isKeyboardVisible:g}=de(),{generateKey:V,encryptAddressKey:C}=le(),{regionStore:I}=te(),{currentLocale:k}=se(),b=H(),m=Q(),{t:S,messages:E}=j(),h=E.value[k.value][`${I.country}areaList`],[w,y]=z(!1),r=u(!1),d=u(""),l=u({userName:null,telNumber:null,provinceName:null,cityName:null,countyName:null,country:"",isDefault:!1,detailInfo:null,areaCode:null}),R=G(()=>I.country==="CN"?3:2),q=()=>{const a=sessionStorage.getItem("editAddress")||"";if(!a)return;const e=JSON.parse(a);l.value=e,l.value.isDefault=!!(e.isDefault&&e.isDefault>=1),d.value=e.provinceName+"/"+e.cityName+"/"+e.countyName,Object.entries(h.city_list).forEach(n=>{n[1]===e.cityName&&(l.value.areaCode=n[0])})},U=a=>{l.value.provinceName=a[0].name,l.value.cityName=a[1].name,l.value.countyName=(a[2]??"").name,d.value=[...new Set(a.map(e=>e.name))].join("/"),r.value=!1},B=async()=>{if(!w.value){if(!ne(l.value.telNumber))return ee(S("address.number was identified"));if(b.query.refundEdit){sessionStorage.setItem("refundTempAddress",JSON.stringify(l.value)),m.back();return}if(y(!0),b.query.shopId){const a=m.currentRoute.value.path,e=await V("merchant",a);let t;e?t=C(l.value,e):t=l.value;const n=await ue({...t,shopId:Number(b.query.shopId),isDefault:1});if(y(!1),!n.success)return}else{const a=m.currentRoute.value.path,e=await V("user",a);let t;e?t=C(l.value,e):t=l.value;const n=await oe({...t,isDefault:l.value.isDefault?1:0});if(y(!1),!n.success)return}m.back()}},$=u(null),c=u({}),f=u("");J(()=>g.value,a=>{re.versions.ios&&a&&L()},{immediate:!1});const L=()=>{var a;try{(a=$.value)==null||a.focus(),setTimeout(()=>{var e;console.log(1),(e=c.value[f.value])==null||e.focus()},50)}catch{console.error("iOS键盘滚动问题处理失败")}};return M(()=>{q(),sessionStorage.setItem("editRefundAddress","1")}),(a,e)=>{const t=i("van-field"),n=i("van-area"),P=i("van-popup"),T=i("van-cell-group"),K=i("VanButton");return A(),F(ae,{title:a.$t("common.address"),class:"!bg-gray1 font-Puhui font-normal relative shopGoodsPage",style:{"background-image":"none"},"theme-vars":{"field-placeholder-text-color":"#A6A6A6","cell-border-color":"#D9D9D9"}},{default:p(()=>[D("div",ie,[D("div",me,[s(T,{inset:""},{default:p(()=>[s(t,{modelValue:l.value.userName,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.userName=o),label:a.$t("common.name"),placeholder:a.$t("common.name"),ref:o=>c.value.userName=o,onClick:e[1]||(e[1]=N(o=>f.value="userName",["stop"]))},null,8,["modelValue","label","placeholder"]),s(t,{modelValue:l.value.telNumber,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.telNumber=o),label:a.$t("common.phone"),placeholder:a.$t("common.phone"),ref:o=>c.value.telNumber=o,onClick:e[3]||(e[3]=N(o=>f.value="telNumber",["stop"]))},null,8,["modelValue","label","placeholder"]),s(t,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=o=>d.value=o),"is-link":"",readonly:"",label:a.$t("common.area"),placeholder:a.$t("common.area"),onClick:e[5]||(e[5]=o=>r.value=!0)},null,8,["modelValue","label","placeholder"]),s(P,{show:r.value,"onUpdate:show":e[8]||(e[8]=o=>r.value=o),round:"",position:"bottom"},{default:p(()=>[s(n,{modelValue:l.value.areaCode,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.areaCode=o),title:a.$t("common.area"),"area-list":v(h),"columns-num":v(R),onCancel:e[7]||(e[7]=o=>r.value=!1),onConfirm:U},null,8,["modelValue","title","area-list","columns-num"])]),_:1},8,["show"]),s(t,{modelValue:l.value.detailInfo,"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.detailInfo=o),label:a.$t("common.detail address"),placeholder:a.$t("common.detail address"),ref:o=>c.value.detailInfo=o,onClick:e[10]||(e[10]=N(o=>f.value="detailInfo",["stop"]))},null,8,["modelValue","label","placeholder"])]),_:1})])]),v(g)?W("",!0):(A(),Z("div",ce,[s(K,{type:"primary",round:"",class:"w-full h-[46px] bg-yellow !border-none text-b1 text-base font-semibold",onClick:B,loading:v(w),disabled:!l.value.userName||!l.value.telNumber||!d.value||!l.value.detailInfo},{default:p(()=>[X(Y(a.$t("common.save")),1)]),_:1},8,["loading","disabled"])])),s(t,{class:"!fixed !w-0 !h-0 !opacity-0",ref:(o,O)=>{O.virtualInputRef=o,$.value=o}},null,512)]),_:1},8,["title"])}}}),Ce=x(fe,[["__scopeId","data-v-98efa2c8"]]);export{Ce as default};
