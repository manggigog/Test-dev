import{_ as Ie}from"./combustion-B5iiG1l4.js";import{_ as oe,y as ae,w as he,x as G,E as V,F as D,G as u,H as t,O as E,P as e,Q as s,K as T,I as ie,J as we,N as S,a0 as k,R as le,a3 as Be,bx as Me,$ as se,bd as de,r as Y,z as xe,bc as J,D as pe,a2 as ne,Y as Oe,Z as Ce}from"./vendor-CjApaIpB.js";import{ar as Fe,au as Se,u as Le,an as Te,F as H,B as $e,H as q,av as ce,D as ye,E as fe,G as be,A as te,d as L,s as X,q as re,c as ke,a8 as ge,e as Pe,r as De}from"./index-CduCwCyL.js";import{e as Ue}from"./exchangeContract-DkM5oC35.js";import{_ as Ve}from"./BgBox-QNA9sAiG.js";import{E as Ee}from"./EcologyHeader-BDfUIJP7.js";import"./bg-dot-BdvI4GrL.js";import"./UserLevel-DUmca5OI.js";import"./avatarRing-DpEnkbQ2.js";import"./UserAsset-DBKC3FQY.js";import"./TokenBalance-C5PGnAls.js";const Re="/Test-dev/static/images/sell-DFmehKtE.svg",Ne="/Test-dev/static/images/buy-C0LQi4x6.svg",je={class:"pt-5"},ze={class:"flex items-center h-5 text-[#2E2008] text-base"},qe=["src"],Ge={class:"font-semibold ml-0.5"},He={class:"bg-[#FFF1D9]/[0.6] rounded-xl mt-2.5 py-4 pb-1.5"},We={class:"w-full"},Ze={class:"flex px-4"},Ke={class:"w-4/12 my-th"},Qe={class:"w-5/12 my-th"},Ye={class:"w-3/12 my-th"},Je={key:1,class:"max-h-36 w-full overflow-auto pt-1.5 px-4 list-box"},Xe={class:"w-4/12 text-overflow"},et={class:"text-base font-medium text-[#2E2008]"},tt={class:"w-5/12 text-overflow"},st={class:"text-base font-medium text-[#2E2008]"},nt={class:"w-3/12 text-overflow"},ot=ae({props:{type:null,list:null,isOld:{type:Boolean}},emits:["onClick","onCheckMyOrder"],setup(a,{emit:c}){const{type:l,list:U}=a,x=he(),P=G(()=>{const M={icon:Re,title:x.t("ecology.Sellorders"),subTitle:x.t("ecology.mysellorder"),btnText:x.t("ecology.buyin")};return l==="buy"&&(M.icon=Ne,M.title=x.t("ecology.buyorder"),M.subTitle=x.t("ecology.mybill"),M.btnText=x.t("ecology.sellout")),M}),A=M=>{c("onClick",l,M)},B=()=>{c("onCheckMyOrder",l)};return(M,p)=>{const R=V("van-icon"),h=V("van-skeleton"),O=V("VanButton");return u(),D("div",je,[t("div",ze,[t("img",{src:e(P).icon,class:"w-5",alt:""},null,8,qe),t("span",Ge,s(e(P).title),1),t("span",{class:"ml-auto font-medium opacity-80",onClick:B},s(e(P).subTitle),1),E(R,{class:"mx-px text-sm font-semibold",name:"arrow",onClick:B})]),t("div",He,[t("div",We,[t("div",Ze,[t("span",Ke,s(M.$t("mall.price")),1),t("span",Qe,s(M.$t("ecology.quantity")),1),t("span",Ye,s(M.$t("shop.operation")),1)]),e(Fe)?(u(),T(h,{key:0,class:"mt-3",row:3})):(u(),D("div",Je,[(u(!0),D(ie,null,we(a.list,b=>(u(),D("div",{class:"flex w-full py-2.5",key:b.price},[t("span",Xe,[t("span",et,s(b.price),1)]),t("span",tt,[t("span",st,s(b.amount),1)]),t("span",nt,[E(O,{class:le(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:$=>A(b),disabled:a.isOld},{default:S(()=>[k(s(e(P).btnText),1)]),_:2},1032,["class","onClick","disabled"])])]))),128))]))])])])}}}),Ae=oe(ot,[["__scopeId","data-v-7aa55814"]]),at={class:"w-[21rem] p-5 bg-[#FFFDF8] text-xs text-[#2E2008]"},lt={class:"flex justify-between items-center pb-4 header font-semibold text-base"},ct=ae({props:{show:{type:Boolean},title:null},emits:["close"],setup(a,{emit:c}){const{show:l,title:U}=a,x=()=>{c("close")};return(P,A)=>{const B=V("van-icon"),M=V("van-popup");return u(),T(M,Me(P.$attrs,{show:a.show,"onUpdate:show":A[0]||(A[0]=p=>se(l)?l.value=p:null),round:"","overlay-class":"",onClose:x}),{default:S(()=>[t("div",at,[t("div",lt,[t("span",null,s(a.title),1),E(B,{name:"cross",class:"font-semibold text-xl",onClick:x})]),t("div",null,[Be(P.$slots,"default",{},void 0,!0)])])]),_:3},16,["show"])}}}),ve=oe(ct,[["__scopeId","data-v-7a3c5a48"]]),ue=()=>{const a=Se(),c=a==null?void 0:a.cns,l=a==null?void 0:a.address,U=Le().getCurrentAccount(),x=async()=>{try{const n=await c.USDT();return H(n)}catch(n){return q(n,l,"USDT",{})}},P=async()=>{try{const n=await c.MUSD();return H(n)}catch(n){return q(n,l,"MUSD",{})}},A=async()=>{try{const n=await c.MAI();return H(n)}catch(n){return q(n,l,"MAI",{})}},B=async()=>{try{const n=await c.MIN_AMOUNT();return $e(n)}catch{return 0}},M=async()=>{try{const n=await c.MIN_REMAIN_AMOUNT();return H(n)}catch(n){return q(n,l,"MIN_REMAIN_AMOUNT",{})}},p=async()=>{try{const n=await c.lastPrice();return ce(n.toString())}catch{return 0}},R=async n=>{try{const m=await c.getMarketPrices(n);return H(m)}catch(m){return q(m,l,"getMarketPrices",{direct:n})}},h=async(n,m)=>{try{const f=await c.getPriceTotals(n,te(m));return H(f)}catch(f){return q(f,l,"getPriceTotals",{direct:n,price:te(m)})}},O=async(n,m)=>{try{const f=await c.getMarketIds(n,m);return H(f)}catch(f){return q(f,l,"getMarketIds",{direct:n,price:m})}},b=async n=>{try{const m=await c.getOrderInfo(n);return H(m)}catch(m){return q(m,l,"getOrderInfo",{id:n})}},$=async(n,m,f)=>{try{const N=await(await c.pending(n,te(m),te(f))).wait();return H(N)}catch(N){return be(N),q(N,l,"pending",{direct:n,price:te(m),amount:te(f)})}},g=async n=>{try{const f=await(await await c.batchTrade(n)).wait();return H(f)}catch(m){return be(m),q(m,l,"batchTrade",{ids:n})}},r=async(n,m)=>{try{const f=await c.estimateGas.trade(n,te(m)),Q=await(await await c.trade(n,te(m),{gasLimit:fe(f,3e3),...ye})).wait();return H(Q)}catch(f){return be(f),q(f,l,"trade",{id:n,amount:te(m)})}},i=async()=>{try{const n=await c.getPendingIds(U);return H(n)}catch(n){return q(n,l,"getPendingIds",{account:U})}},v=async n=>{try{const m=await c.estimateGas.cancel(n),N=await(await await c.cancel(n.toString(),{gasLimit:fe(m,3e3),...ye})).wait();return H(N)}catch(m){return be(m),q(m,l,"cancel",{id:n.toString()})}},I=async()=>{try{return await c.priceOracle()}catch(n){return q(n,l,"priceOracle",{})}};return{pending:$,usdtAddress:x,MIN_AMOUNT:B,MIN_REMAIN_AMOUNT:M,lastPrice:p,getMarketPrices:R,getPriceTotals:h,getMarketIds:O,getOrderInfo:b,batchTrade:g,trade:r,getPendingIds:i,cancel:v,musdAddress:P,maiAddress:A,burnMAI:async()=>{try{const n=await c.estimateGas.burnMAI(),f=(await c.burnMAI({gasLimit:fe(n,3e3),...ye})).wait();return H(f)}catch(n){return q(n,l,"burnMAI",{})}},burnMusd:async()=>{try{const n=await c.estimateGas.burnMusd(),f=(await c.burnMusd({gasLimit:fe(n,3e3),...ye})).wait();return H(f)}catch(n){return q(n,l,"burnMusd",{})}},burnMAIFund:async()=>{try{const n=await c.burnMAIFund();return ce(n.toString())}catch{return 0}},burnMUSDFund:async()=>{try{const n=await c.burnMUSDFund();return ce(n.toString())}catch{return 0}},getPrice:async n=>{const m=await I(),f=Te(m),N=f==null?void 0:f.cns,Q=f==null?void 0:f.address,d=n||await A();try{const w=await N.getPrice(d);return H($e(w))}catch(w){return q(w,Q,"getPrice",{tokenAdress:d})}}}},rt={class:"mt-4 text-base font-bold"},it={class:"flex-center-bw"},dt={class:"opacity-80"},ut={class:"mt-1 flex-center-bw"},mt={class:"opacity-80"},pt={class:"mt-4 text-[#2E2008]"},yt={class:"text-sm font-medium"},ft={class:"flex justify-between items-center bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},bt={class:"text-base opacity-60"},gt={class:"mt-5 text-sm font-medium"},ht={class:"bg-[#fff9f0] mt-3 rounded-lg py-1.5 pr-2.5"},wt={class:"flex flex-col items-center justify-center mt-5"},vt={key:0,class:"mt-5 text-xs text-center"},_t={lass:"mt-1"},xt={key:1,class:"mt-5 text-xs text-center"},$t={class:"mt-1"},kt=ae({props:{show:{type:Boolean},type:null,lastPrice:null},emits:["update:show","success"],setup(a,{emit:c}){const{show:l,type:U}=a,{t:x}=he(),{musdAddress:P,MIN_AMOUNT:A,maiAddress:B,pending:M}=ue(),p=de({number:null,price:null}),R=G(()=>{const o={title:x("ecology.Pendingpurchase"),numberText:x("ecology.buyquantity"),priceText:x("ecology.buyprice")};return U==="sell"&&(o.title=x("ecology.Hangforsale"),o.numberText=x("ecology.sellquantity"),o.priceText=x("ecology.sellingprice")),o}),h=G(()=>K.value>0&&(U==="buy"?K.value>=O.value:K.value>=+p.number));xe(()=>p.price,o=>{b.value||(O.value=+o*+p.number)}),xe(()=>p.number,o=>{$.value||(O.value=+o*+p.price)});const O=Y(null),b=Y(!1),$=Y(!1),g=()=>{b.value=!1,$.value=!0},r=()=>{b.value=!0,$.value=!1},[i,v]=J(!1),I=()=>{c("update:show",!1)},j=Y(""),W=async()=>{const o=U==="buy"?await P():await B();o.success&&(j.value=o.result)},C=async()=>{v(!0);const o=await await X(j.value).approve(re.otc);v(!1),o.success&&Z()},K=Y(null),Z=async()=>{v(!0);const o=await(await X(j.value)).allowance(re.otc);K.value=o.result||0,v(!1)},n=Y(0),m=async()=>{const o=await A();n.value=+o},f=Y(0),N=async()=>{const o=await X(j.value).balanceOf();f.value=+o},[Q,d]=J(!1),w=async()=>{d(!0);const o=await M(U==="buy"?1:2,p.price,p.number);d(!1),o.success&&(I(),c("success"))},y=async()=>{Z(),m(),N()};return pe(async()=>{await W(),y()}),(o,F)=>{const _=V("VanField"),ee=V("VanButton");return u(),T(ve,{show:a.show,"onUpdate:show":F[2]||(F[2]=z=>se(l)?l.value=z:null),title:e(R).title,onClose:I},{default:S(()=>[t("div",rt,[t("div",it,[t("span",null,s(o.$t("ecology.new price",{token:"MAI"})),1),t("span",dt,s(a.lastPrice),1)]),t("div",ut,[t("span",null,s(o.$t("common.balance",{token:a.type==="buy"?"MUSD":"MAI"})),1),t("span",mt,s(e(L)(f.value)),1)])]),t("div",pt,[t("div",yt,s(e(R).priceText),1),t("div",ft,[E(_,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:e(p).price,"onUpdate:modelValue":F[0]||(F[0]=z=>e(p).price=z),onFocus:g,type:"number",placeholder:"0"},null,8,["modelValue"]),t("span",bt,s((a.type==="buy","MUSD")),1)]),t("div",gt,s(e(R).numberText),1),t("div",ht,[E(_,{class:"bg-[#fff9f0] text-3xl font-bold",onFocus:r,modelValue:e(p).number,"onUpdate:modelValue":F[1]||(F[1]=z=>e(p).number=z),type:"number",placeholder:"0"},null,8,["modelValue"])]),t("div",wt,[e(h)?a.type==="buy"?(u(),T(ee,{key:1,onClick:w,disabled:+e(p).price<=0||e(p).number<n.value||O.value>f.value,loading:e(Q),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:S(()=>[k(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(u(),T(ee,{key:2,onClick:w,disabled:+e(p).price<=0||e(p).number<n.value||e(p).number>f.value,loading:e(Q),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base"},{default:S(()=>[k(s(o.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(u(),T(ee,{key:0,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",loading:e(i),onClick:C},{default:S(()=>[k(s(o.$t("assets.auth"))+" "+s(a.type==="buy"?"MUSD":"MAI"),1)]),_:1},8,["loading"]))]),a.type=="sell"?(u(),D("div",vt,[t("div",null,s(o.$t("ecology.hand num"))+" "+s(n.value)+"MAI, "+s(o.$t("ecology.otcDeduct")),1),t("div",_t," * "+s(o.$t("ecology.estimated get"))+s(e(L)(O.value*.7))+" MUSD, "+s(o.$t("ecology.estimated consume"))+" "+s(e(L)(e(p).number))+" MAI ",1)])):(u(),D("div",xt,[t("div",null,s(o.$t("ecology.hand num"))+" "+s(n.value)+" MAI",1),t("div",$t," *"+s(o.$t("ecology.estimated get"))+s(e(L)(e(p).number))+" MAI, "+s(o.$t("ecology.estimated consume"))+s(O.value)+" MUSD ",1)]))])]),_:1},8,["show","title"])}}}),At=oe(kt,[["__scopeId","data-v-0a534fbf"]]),Mt={class:"mt-5"},It={class:"flex justify-between"},Bt={class:"text-base font-semibold"},Ot={class:"text-base font-medium opacity-80"},Ct={class:"flex justify-between mt-2.5"},Ft={class:"text-base font-semibold"},St={class:"text-base font-medium opacity-80"},Lt={class:"flex justify-between mt-6"},Tt={class:"text-sm font-medium"},Pt={class:"text-sm opacity-80"},Dt={class:"flex justify-between items-center bg-[#fff9f0] rounded-lg py-2.5 pr-2.5 mt-2.5"},Ut={class:"flex flex-col items-center justify-center mt-5"},Vt={class:"mt-5"},Et={key:0,class:"mt-2 text-left"},Rt={class:"text-[#FBA923]"},Nt={class:"text-[#FBA923]"},jt=k(" MUSD "),zt={key:1,class:"mt-2"},qt={class:"text-[#FBA923]"},Gt={class:"text-[#FBA923]"},Ht=ae({props:{show:{type:Boolean},type:null,token:null,musd:null,orderInfo:null,isAuth:{type:Boolean},musdBalance:null,tokenBalance:null,musdAllowance:null,tokenAllowance:null,otcAddress:null},emits:["update:show","approve","success"],setup(a,{emit:c}){const l=a,{trade:U}=ue(),x=G(()=>+l.tokenAllowance>=+b.number&&+l.tokenAllowance>0),P=G(()=>+l.musdAllowance>=+b.number*+l.orderInfo.price&&+l.musdAllowance>0),A=de({isAuth:!1,btnLoading:!1}),B=G(()=>l.orderInfo.remain<b.number),M=G(()=>l.orderInfo.remain>10?`1-${L(l.orderInfo.remain-10)} || ${l.orderInfo.remain}`:l.orderInfo.remain),p=G(()=>l.type==="buy"?1:2),R=()=>{c("update:show",!1)},h=async()=>{A.btnLoading=!0;let g;if(p.value===1?g=await X(l.token).approve(l.otcAddress):g=await X(l.musd).approve(l.otcAddress),!g.success)return A.btnLoading=!1;A.isAuth=!0,c("approve"),A.btnLoading=!1},O=async()=>{A.btnLoading=!0;try{(await U(l.orderInfo.id,+b.number)).success&&c("success")}finally{A.btnLoading=!1}},b=de({number:""}),$=()=>{p.value===1?b.number=+l.tokenBalance<+l.orderInfo.remain?l.tokenBalance:l.orderInfo.remain:b.number=+l.musdBalance/l.orderInfo.price<+l.orderInfo.remain?+l.musdBalance/l.orderInfo.price:l.orderInfo.remain};return(g,r)=>{const i=V("VanField"),v=V("VanButton");return u(),T(ve,{show:a.show,"onUpdate:show":r[1]||(r[1]=I=>se(show)?show.value=I:null),title:a.type=="sell"?g.$t("otc.buyIn"):g.$t("otc.sellOut"),onClose:R,overlay:!1},{default:S(()=>[t("div",Mt,[t("div",It,[t("span",Bt,s(g.$t("mall.price")),1),t("span",Ot,s(e(L)(a.orderInfo.price||0,4))+" MUSD",1)]),t("div",Ct,[t("span",Ft,s(g.$t("ecology.total")),1),t("span",St,s(e(L)(a.orderInfo.remain||0,4))+" MAI",1)]),t("div",Lt,[t("span",Tt,s(a.type=="sell"?g.$t("ecology.buyquantity"):g.$t("ecology.sellquantity")),1),t("span",Pt,s(a.type=="sell"?"MUSD":"MAI")+s(g.$t("assets.balance"))+s(a.type=="sell"?a.musdBalance:a.tokenBalance),1)]),t("div",Dt,[E(i,{class:"bg-[#fff9f0] text-3xl font-bold",modelValue:e(b).number,"onUpdate:modelValue":r[0]||(r[0]=I=>e(b).number=I),type:"number",placeholder:"0"},null,8,["modelValue"]),t("div",{class:"px-1.5 py-1 border-[1px] rounded border-[#FBA923] border-solid text-xs text-[#FBA923] font-medium",onClick:$}," MAX ")]),t("div",Ut,[(a.type==="sell"?e(P):e(x))?(u(),T(v,{key:0,loading:e(A).btnLoading,disabled:!e(b).number||+e(b).number<=0||e(B),class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",onClick:O},{default:S(()=>[k(s(g.$t("common.submit")),1)]),_:1},8,["loading","disabled"])):(u(),T(v,{key:1,class:"font-semibold btn h-[38px] min-w-[130px] px-4 rounded-3xl text-base",disabled:!e(b).number||+e(b).number<=0||e(B),loading:e(A).btnLoading,onClick:h},{default:S(()=>[k(s(g.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading"]))]),t("div",Vt,s(g.$t("ecology.tips",{Currency:a.type=="sell"?"MAI":"MUSD",num:e(M)})),1),a.type==="sell"?(u(),D("div",Et,[k(" *"+s(g.$t("ecology.estimated get"))+" ",1),t("span",Rt,s(e(b).number||0),1),k(" MAI, "+s(g.$t("ecology.estimated consume"))+" ",1),t("span",Nt,s(e(L)(+a.orderInfo.price*+e(b).number)),1),jt])):(u(),D("div",zt,[k(" *"+s(g.$t("ecology.estimated get"))+" ",1),t("span",qt,s(e(L)(+e(b).number*+a.orderInfo.price*.7)),1),k(" MUSD, "+s(g.$t("ecology.estimated consume"))+" ",1),t("span",Gt,s(+e(b).number||0),1),k(" MAI, "+s(g.$t("ecology.otcDeduct")),1)]))])]),_:1},8,["show","title"])}}}),Wt=oe(Ht,[["__scopeId","data-v-d00e60c8"]]),Zt={class:"mt-4 text-base font-bold flex-center-bw"},Kt={class:"mt-4"},Qt={class:"text-sm text-[#2E2008] font-medium"},Yt={class:"flex flex-col items-center justify-center mt-5 text-sm font-semibold text-white"},Jt={key:0,class:"mt-4 text-xs text-center"},Xt={class:"mt-1"},es={class:"mt-1"},ts={class:"text-[#FBA923]"},ss={class:"text-[#FBA923]"},ns=k(" MAI "),os={key:1,class:"mt-4 text-xs text-center"},as={class:"mt-1"},ls={class:"text-[#FBA923]"},cs={class:"text-[#FBA923]"},rs=k(" MUSD "),is=ae({props:{show:{type:Boolean},type:null,price:null,token:null,musd:null},emits:["update:show","success"],setup(a,{emit:c}){const{show:l,type:U,price:x,token:P,musd:A}=a,B=he(),{getMarketIds:M,getOrderInfo:p,batchTrade:R}=ue(),h=re.otc,[O,b]=J(!1),$=Y([]),g=d=>{$.value=d},r=de({orderInfo:{},amountShow:!1,list:[],btnLoading:!1,tokenAllowance:"",tokenBalance:"",musdAllowance:"",musdBalance:""}),i=G(()=>r.list.reduce((w,y)=>$.value.find(o=>o===y.id)?w+y.remain:w,0)),v=G(()=>r.list.reduce((w,y)=>$.value.find(o=>o===y.id)?w+y.remain*y.price:w,0)),I=G(()=>+r.tokenAllowance>=+i.value&&+r.tokenAllowance>0),j=G(()=>+r.musdAllowance>=+v.value),W=G(()=>{const d={title:B.t("ecology.buy"),btnText:B.t("ecology.buyin"),batchBtnText:B.t("ecology.Bulkbuy"),btnClass:"btn-green"};return U==="buy"&&(d.title=B.t("ecology.Sell"),d.btnText=B.t("ecology.sellout"),d.batchBtnText=B.t("ecology.sellinbulk"),d.btnClass="btn-pink"),d}),C=G(()=>U==="buy"?1:2),K=()=>{c("update:show",!1)},Z=async()=>{const d=await X(A).allowance(re.otc);r.musdAllowance=d.result,r.musdBalance=String(L(await X(A).balanceOf()));const w=await X(P).allowance(re.otc);r.tokenAllowance=w.result,r.tokenBalance=String(L(await X(P).balanceOf()))},n=async()=>{const d=await M(C.value,te(x)),w=[];for(let y=0;y<d.result.length;y++){const o=await p(d.result[y]);w.push({id:d.result[y],price:x,remain:ce(o.result.remain.toString())})}r.list=w},m=async()=>{r.btnLoading=!0;let d;if(C.value===1?d=await X(P).approve(re.otc):d=await X(A).approve(re.otc),!d.success)return r.btnLoading=!1;await Z(),f()},f=async()=>{const d=r.list.reduce((w,y)=>$.value.find(o=>o===y.id)?w+y.remain:w,0);if(C.value===1){if(d>r.tokenAllowance&&d<=r.tokenBalance)return m()}else if(d>r.musdAllowance&&d<=r.musdBalance)return m();r.btnLoading=!0;try{(await R($.value)).success&&c("success")}finally{r.btnLoading=!1}},N=d=>{r.orderInfo=d,b(!0)},Q=()=>{b(!1),c("success")};return pe(async()=>{r.btnLoading=!0,await Z(),await n(),r.btnLoading=!1}),(d,w)=>{const y=V("van-checkbox"),o=V("VanButton"),F=V("van-checkbox-group");return u(),D(ie,null,[E(ve,{show:a.show,"onUpdate:show":w[1]||(w[1]=_=>se(l)?l.value=_:null),title:`${a.price}${e(W).title}`,onClose:K,"close-on-click-overlay":!e(O)},{default:S(()=>[t("div",Zt,[a.type=="buy"?(u(),D(ie,{key:0},[t("span",null,s(d.$t("common.balance",{token:"MAI"})),1),t("span",null,s(e(r).tokenBalance||0),1)],64)):(u(),D(ie,{key:1},[t("span",null,s(d.$t("common.balance",{token:"MUSD"})),1),t("span",null,s(e(r).musdBalance||0),1)],64))]),t("div",Kt,[E(F,{modelValue:$.value,"onUpdate:modelValue":w[0]||(w[0]=_=>$.value=_),onChange:g},{default:S(()=>[(u(!0),D(ie,null,we(e(r).list,_=>(u(),D("div",{class:"flex justify-between items-center bg-[#fff9f0] rounded-lg p-2.5 mt-2.5",key:_.id},[E(y,{name:_.id,"icon-size":"1rem","checked-color":a.type==="sell"?"#14D8A9":"#EA1649"},{default:S(()=>[t("span",Qt,s(e(L)(_.remain||0,4))+" MAI",1)]),_:2},1032,["name","checked-color"]),E(o,{class:le(["align-middle btn rounded px-3.5 h-6 leading-6",{"btn-buy":a.type=="buy"}]),onClick:ee=>N(_)},{default:S(()=>[k(s(e(W).btnText),1)]),_:2},1032,["class","onClick"])]))),128))]),_:1},8,["modelValue"]),t("div",Yt,[(a.type==="sell"?!e(j):!e(I))?(u(),T(o,{key:0,disabled:!$.value.length,loading:e(r).btnLoading,class:le(["flex-1 w-40 py-3",e(W).btnClass]),onClick:m},{default:S(()=>[k(s(d.$t("ecology.authorized")),1)]),_:1},8,["disabled","loading","class"])):(u(),T(o,{key:1,disabled:!$.value.length,loading:e(r).btnLoading,class:le(["flex-1 w-40 py-3",e(W).btnClass]),onClick:f},{default:S(()=>[k(s(e(W).batchBtnText),1)]),_:1},8,["disabled","loading","class"]))]),a.type=="buy"?(u(),D("div",Jt,[t("div",Xt,s(d.$t("ecology.otcDeduct")),1),t("div",es,[k(" *"+s(d.$t("ecology.estimated get"))+" ",1),t("span",ts,s(e(L)(e(v)*.7)),1),k(" MUSD，"+s(d.$t("ecology.estimated consume"))+" ",1),t("span",ss,s(e(L)(e(i))),1),ns])])):(u(),D("div",os,[t("div",as,[k(" *"+s(d.$t("ecology.estimated get"))+" ",1),t("span",ls,s(e(L)(e(i))),1),k(" MAI，"+s(d.$t("ecology.estimated consume"))+" ",1),t("span",cs,s(e(L)(e(v))),1),rs])]))])]),_:1},8,["show","title","close-on-click-overlay"]),e(O)?(u(),T(Wt,{key:0,type:a.type,show:e(O),"onUpdate:show":w[2]||(w[2]=_=>se(O)?O.value=_:null),token:a.token,musd:a.musd,isAuth:a.type=="sell"?e(j):e(I),isMusdtAuth:e(j),orderInfo:e(r).orderInfo,musdBalance:e(r).musdBalance,tokenBalance:e(r).tokenBalance,otcAddress:e(h),tokenAllowance:e(r).tokenAllowance,musdAllowance:e(r).musdAllowance,onApprove:Z,onSuccess:Q},null,8,["type","show","token","musd","isAuth","isMusdtAuth","orderInfo","musdBalance","tokenBalance","otcAddress","tokenAllowance","musdAllowance"])):ne("",!0)],64)}}}),ds=oe(is,[["__scopeId","data-v-c02d36b2"]]),us={class:"flex items-center justify-between mb-4"},ms={class:"flex font-semibold"},ps={key:1},ys={class:"flex items-center justify-between pt-5 t-border"},fs={class:"opacity-80"},bs={class:"text-[#2E2008] font-semibold"},gs={key:1},hs={class:"flex items-center justify-between mt-5"},ws={class:"opacity-80"},vs={class:"text-[#2E2008] font-semibold"},_s={key:1},xs={class:"flex items-center justify-between mt-5"},$s=ae({props:{show:{type:Boolean},musd:null,mai:null},emits:["close","success"],setup(a,{emit:c}){const{lastPrice:l}=Ue(),{burnMAI:U,burnMusd:x,burnMAIFund:P,burnMUSDFund:A}=ue(),[B,M]=J(!1),[p,R]=J(!1),[h,O]=J(!1),[b,$]=J(!1),[g,r]=J(!1),i=de({musdBalance:null,maiBalance:null,maiPrice:null}),v=()=>{c("close")},I=async()=>{M(!0),i.maiBalance=String(L(await P())),M(!1)},j=async()=>{R(!0),i.musdBalance=String(L(await A())),R(!1)},W=async()=>{$(!0);const n=await U();$(!1),n.success&&Z()},C=async()=>{r(!0);const n=await x();r(!1),n.success&&Z()},K=async()=>{O(!0),i.maiPrice=+await l(),O(!1)},Z=()=>{K(),I(),j()};return pe(async()=>{await Z()}),(n,m)=>{const f=V("van-loading"),N=V("van-icon"),Q=V("VanLoading"),d=V("VanButton"),w=V("van-popup");return u(),T(w,{show:a.show,"onUpdate:show":m[0]||(m[0]=y=>se(show)?show.value=y:null),round:"",style:{padding:"20px"},onClose:v},{default:S(()=>[t("div",us,[t("div",ms,[k(s(n.$t("ecology.price"))+": ",1),e(h)?(u(),T(f,{key:0,size:"18px"})):(u(),D("span",ps,s(e(L)(e(i).maiPrice,6))+" MUSD",1))]),E(N,{name:"cross",size:"18px",onClick:v})]),t("div",ys,[t("div",fs,"MUSD "+s(n.$t("ecology.canBurn")),1),t("div",bs,[e(p)?(u(),T(Q,{key:0,size:"18"})):(u(),D("span",gs,s(e(ke)(e(i).musdBalance||0)),1))])]),t("div",hs,[t("div",ws,"MAI "+s(n.$t("ecology.canBurn")),1),t("div",vs,[e(B)?(u(),T(Q,{key:0,size:"18"})):(u(),D("span",_s,s(e(ke)(e(i).maiBalance||0)),1))])]),t("div",xs,[E(d,{class:"btn h-[35px] min-w-[120px] px-4 text-white font-semibold mr-4",loading:e(g),disabled:e(i).musdBalance<=0,onClick:C},{default:S(()=>[k(s(n.$t("ecology.burn",{token:"MUSD"})),1)]),_:1},8,["loading","disabled"]),E(d,{class:"btn h-[35px] min-w-[120px] px-4 text-white font-semibold",loading:e(b),disabled:e(i).maiBalance<=0,onClick:W},{default:S(()=>[k(s(n.$t("ecology.burn",{token:"MAI"})),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"])}}}),ks=oe($s,[["__scopeId","data-v-7c8fe999"]]),As="/Test-dev/static/images/Rectangle_L_O-CWbZvLrI.svg",Ms="/Test-dev/static/images/Rectangle_L_W-CZS7CLEN.svg",Is="/Test-dev/static/images/Rectangle_R_O-4n4iOOR3.svg",Bs="/Test-dev/static/images/Rectangle_R_W-BigIS_qZ.svg",Os={class:"w-[21rem] bg-[#FFFDF8] text-xs text-[#2E2008]"},Cs={class:"container"},Fs={class:"flex items-center justify-between px-5 py-4 text-base font-semibold"},Ss={class:"relative flex h-10"},Ls=["src"],Ts=["src"],Ps={class:"h-10 z-10 flex items-center w-[21rem] text-base font-medium"},Ds={class:"p-2.5 maxH overflow-auto"},Us={class:"flex justify-between header pb-2.5"},Vs={class:"text-xl font-bold"},Es={class:"flex justify-between mt-2.5 text-sm"},Rs={class:"opacity-80"},Ns={class:"font-semibold"},js={class:"flex justify-between mt-2.5 text-sm"},zs={class:"opacity-80"},qs={class:"font-semibold"},Gs={class:"flex justify-between mt-2.5 text-sm"},Hs={class:"opacity-80"},Ws={class:"font-semibold"},Zs=ae({props:{show:{type:Boolean},type:null},emits:["update:show","success"],setup(a,{emit:c}){const{show:l,type:U}=a,{getPendingIds:x,cancel:P,getOrderInfo:A}=ue(),B=()=>{c("update:show",!1)},M=G(()=>p.value==="buy"?$.value.filter(i=>i.direct===1):$.value.filter(i=>i.direct===2)),p=Y("buy"),R=i=>{p.value!==i&&(p.value=i)},h=G(()=>p.value==="buy"?Ms:As),O=G(()=>p.value==="sell"?Bs:Is),b=Y([]),$=Y([]),g=async()=>{const i=await x();i.success&&(b.value=i.result,b.value.forEach(async v=>{const I=await A(v);$.value.push({direct:+I.result.direct,price:L(ge(I.result.price)),total:L(ge(I.result.total)),remain:L(ge(I.result.remain)),token:I.result.token,sender:I.result.sender,status:+I.result.status,id:v,loading:!1})}))},r=async i=>{i.loading=!0;const v=await P(i.id);i.loading=!1,v.success&&(B(),c("success"))};return pe(()=>{p.value=U,g()}),(i,v)=>{const I=V("van-icon"),j=V("VanButton"),W=V("van-popup");return u(),T(W,Me(i.$attrs,{show:a.show,"onUpdate:show":v[2]||(v[2]=C=>se(l)?l.value=C:null),style:{height:"80vh"},round:"","overlay-class":"",onClose:B}),{default:S(()=>[t("div",Os,[t("div",Cs,[t("div",Fs,[t("span",null,s(i.$t("ecology.mypendingorder")),1),E(I,{name:"cross",class:"text-xl font-semibold",onClick:B})]),t("div",Ss,[t("img",{class:le(["h-10 absolute left-0 bottom-[-1px]",{"z-10":p.value=="buy"}]),src:e(h),alt:""},null,10,Ls),t("img",{class:le(["h-10 absolute right-0 bottom-[-1px]",{"z-10":p.value=="sell"}]),src:e(O),alt:""},null,10,Ts),t("div",Ps,[t("span",{class:le(["text-[#2E2008] flex-1 text-center",{"text-[#FEA021]":p.value=="buy"}]),onClick:v[0]||(v[0]=C=>R("buy"))},s(i.$t("ecology.mybill")),3),t("span",{class:le(["text-[#2E2008] opacity-60 flex-1 text-center",{"text-[#FEA021]":p.value=="sell"}]),onClick:v[1]||(v[1]=C=>R("sell"))},s(i.$t("ecology.mysellorder")),3)])])]),t("div",Ds,[(u(!0),D(ie,null,we(e(M),(C,K)=>(u(),D("div",{class:"bg-[#FFF1D9]/[0.4] rounded p-2.5 mt-2.5 order-box",key:K},[t("div",Us,[t("span",Vs,s(C.price||0),1),C.status==1?(u(),T(j,{key:0,class:"btn-border px-3.5 h-[28px] rounded-2xl text-xs text-[#FBA923] font-medium min-w-[65px] text-center"},{default:S(()=>[k(s(i.$t("ecology.completed")),1)]),_:1})):ne("",!0),C.status==0?(u(),T(j,{key:1,onClick:Z=>r(C),loading:C.loading,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:S(()=>[k(s(i.$t("ecology.revoke")),1)]),_:2},1032,["onClick","loading"])):ne("",!0),C.status===2?(u(),T(j,{key:2,class:"px-3.5 h-[28px] border-[1px] rounded-2xl border-transparent border-solid text-xs text-[#FF507A] font-medium min-w-[65px] text-center bg-[#FF507A]/[0.2]"},{default:S(()=>[k(s(i.$t("ecology.canceled")),1)]),_:1})):ne("",!0)]),t("div",Es,[t("span",Rs,s(i.$t("ecology.Totalendingorders")),1),t("span",Ns,s(C.total||0)+" MAI",1)]),t("div",js,[t("span",zs,s(i.$t("ecology.transactionquantity")),1),t("span",qs,s(C.total-C.remain||0)+" MAI",1)]),t("div",Gs,[t("span",Hs,s(i.$t("ecology.remainingquantity")),1),t("span",Ws,s(C.remain||0)+" MAI",1)])]))),128))])])]),_:1},16,["show"])}}}),Ks=oe(Zs,[["__scopeId","data-v-6cfa95f7"]]),_e=a=>(Oe("data-v-1087f20c"),a=a(),Ce(),a),Qs={class:"bg-[#FFFDF8] rounded-xl p-2.5 pt-5 pb-3.5"},Ys={class:"flex-center relative flex-col text-[#F36B07] rounded-xl bg-[#FFF1D9]/[0.6] py-5 font-normal text-sm"},Js={class:"text-3xl font-bold"},Xs=_e(()=>t("span",{class:"ml-2"},"MUSD",-1)),en={class:"text-[#2E2008] font-medium opacity-60"},tn=_e(()=>t("img",{src:Ie},null,-1)),sn=[tn],nn={class:"pt-2.5 pb-1 flex justify-between text-white font-semibold text-sm"},on=_e(()=>t("div",{class:"w-5"},null,-1)),an=ae({props:{isOld:{type:Boolean}},setup(a){const{loadingToggle:c}=De(),{lastPrice:l,getMarketPrices:U,getMarketIds:x,maiAddress:P,musdAddress:A,getOrderInfo:B}=ue(),{reloadStore:M}=Pe(),p=1,R=2,h=de({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),O=Y(),b=Y(""),$=Y(""),[g,r]=J(!1),[i,v]=J(!1),[I,j]=J(!1),[W,C]=J(!1),K=y=>{b.value=y,r(!0)},Z=(y,o)=>{O.value=o.price,$.value=y,v(!0)},n=y=>{$.value=y,j(!0)},m=async()=>{const y=await l();h.lastPrice=y||0},f=async()=>{const y=await P(),o=await A();h.token=y.result,h.musd=o.result},N=async()=>{const y=await U(R),o=[];for(let F=0;F<y.result.length;F++){const _=await x(R,y.result[F]);let ee=0;for(let z=0;z<_.result.length;z++){const me=await B(_.result[z]);ee+=ce(me.result.remain.toString())}o.push({price:ce(y.result[F].toString()),amount:L(ee)}),h.sellOrderList=o.filter(z=>z.amount!==0),h.sellOrderList=h.sellOrderList.sort((z,me)=>z.price-me.price)}},Q=async()=>{const y=await U(p),o=[];for(let F=0;F<y.result.length;F++){const _=await x(p,y.result[F]);let ee=0;for(let z=0;z<_.result.length;z++){const me=await B(_.result[z]);ee+=ce(me.result.remain.toString())}o.push({price:ce(y.result[F].toString()),amount:L(ee)})}h.buyOrderList=o.filter(F=>F.amount!==0),h.buyOrderList=h.buyOrderList.sort((F,_)=>_.price-F.price)},d=async()=>{M.reload(),Q(),N(),m(),v(!1)},w=async()=>{c(!0),await Promise.all([f(),m(),N(),Q()]),c(!1)};return pe(async()=>{await w()}),(y,o)=>{const F=V("VanButton");return u(),D("div",Qs,[t("div",Ys,[t("div",null,[t("span",Js,s(e(h).lastPrice),1),Xs]),t("div",en,s(y.$t("ecology.Latesttransactionprice")),1),a.isOld?ne("",!0):(u(),D("div",{key:0,onClick:o[0]||(o[0]=_=>e(C)(!0)),class:"absolute top-3 right-3 w-[25px] h-[25px]"},sn))]),t("div",nn,[E(F,{class:"flex-1 h-10 px-4 btn-green",onClick:o[1]||(o[1]=_=>K("buy")),disabled:a.isOld},{default:S(()=>[k(s(y.$t("ecology.Pendingpurchase")),1)]),_:1},8,["disabled"]),on,E(F,{class:"flex-1 h-10 px-4 btn-pink",onClick:o[2]||(o[2]=_=>K("sell")),disabled:a.isOld},{default:S(()=>[k(s(y.$t("ecology.Hangforsale")),1)]),_:1},8,["disabled"])]),E(Ae,{type:"sell",onOnClick:Z,onOnCheckMyOrder:n,list:e(h).sellOrderList,isOld:a.isOld},null,8,["list","isOld"]),E(Ae,{type:"buy",onOnClick:Z,onOnCheckMyOrder:n,list:e(h).buyOrderList,isOld:a.isOld},null,8,["list","isOld"]),e(g)?(u(),T(At,{key:0,show:e(g),"onUpdate:show":o[3]||(o[3]=_=>se(g)?g.value=_:null),onSuccess:d,type:b.value,lastPrice:e(h).lastPrice},null,8,["show","type","lastPrice"])):ne("",!0),e(i)?(u(),T(ds,{key:1,show:e(i),"onUpdate:show":o[4]||(o[4]=_=>se(i)?i.value=_:null),type:$.value,price:O.value,token:e(h).token,musd:e(h).musd,onSuccess:d},null,8,["show","type","price","token","musd"])):ne("",!0),e(I)?(u(),T(Ks,{key:2,show:e(I),"onUpdate:show":o[5]||(o[5]=_=>se(I)?I.value=_:null),type:$.value,isOld:a.isOld,success:"handleSuccess"},null,8,["show","type","isOld"])):ne("",!0),e(W)?(u(),T(ks,{key:3,show:e(W),lastPrice:e(h).lastPrice,musd:e(h).musd,mai:e(h).token,onClose:o[6]||(o[6]=_=>e(C)(!1)),onSuccess:m},null,8,["show","lastPrice","musd","mai"])):ne("",!0)])}}}),ln=oe(an,[["__scopeId","data-v-1087f20c"]]),cn={class:"relative h-full"},rn=ae({setup(a){return(c,l)=>(u(),D("div",cn,[E(Ee),E(Ve,{icon:"svg/ecology/otc.svg",text:`${c.$t("ecology.otc")}2.0`},{default:S(()=>[E(ln,{isOld:!1})]),_:1},8,["text"])]))}}),_n=oe(rn,[["__scopeId","data-v-adea3b14"]]);export{_n as default};
