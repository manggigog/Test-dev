var H=Object.defineProperty;var q=(r,t,l)=>t in r?H(r,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[t]=l;var b=(r,t,l)=>q(r,typeof t!="symbol"?t+"":t,l);import{bh as N,bS as F,n as K,_ as $,y as O,l as V,r as i,D as A,E,F as p,G as u,H as o,Q as I,bc as M,a2 as U,bo as J,bz as P,I as T,J as L,R as Q,K as w,N as W,Y,Z}from"./vendor-BUT0HZ5j.js";import{_ as X}from"./search-Dwmdj_3F.js";import{_ as ee}from"./delete-C3qvlPYO.js";import{H as oe}from"./HomeGoodsItem-CYZaKOv7.js";import{as as se,aA as te,bj as le}from"./index-hbwLMIYO.js";import"./store-CPx32ymB.js";import"./MCOIN-BcbOHmhy.js";import"./useCityMap-fPla5ZMg.js";import"./RatioBox-1s0IUNNW.js";import"./ImgBoutiqueLable-BF5Xoxsv.js";import"./shop-CeqcS6K2.js";class ae{constructor(t,l){b(this,"scrollTop");b(this,"selector");b(this,"key");this.scrollTop=0,this.selector=t,this.key=l,N(()=>{if(sessionStorage.getItem(this.key)=="1"){sessionStorage.removeItem(this.key),this.clearScrollTop();return}K(()=>{const c=document.querySelector(this.selector);c&&(c.scrollTop=this.scrollTop)})}),F(()=>{const n=document.querySelector(this.selector);this.scrollTop=n?n.scrollTop:0})}clearScrollTop(){this.scrollTop=0}getScrollTop(){return this.scrollTop}setScrollTop(t){this.scrollTop=t}}const m=r=>(Y("data-v-f39bfb86"),r=r(),Z(),r),re={class:"app-container"},ne={class:"header__wrap w-full h-[50px]"},ce={class:"header__title h-full"},ie={class:"h-full flex items-center justify-center"},de={class:"text-b1 text-base font-bold"},ue={class:"search__wrap w-full h-[48px] px-3 pb-3"},_e={class:"search__input w-full h-full bg-white rounded-3xl flex items-center justify-center px-3 py-2.5"},fe=m(()=>o("div",{class:"search__icon flex-shrink-0"},[o("img",{src:X,class:"w-4 h-4"})],-1)),he=["onKeyup"],pe=m(()=>o("img",{src:ee,class:"w-4 h-4",alt:""},null,-1)),me=[pe],ge=m(()=>o("span",{class:"text-[#FF8812] text-sm font-semibold whitespace-nowrap"}," 搜索 ",-1)),ve=[ge],ye={class:"list__wrap"},be=m(()=>o("div",{class:"category__shadow fixed left-0 bottom-0 w-[80px] h-14 safe-bottom sm:bottom-[0%] lg:bottom-[0%] z-[10] box-content"},null,-1)),xe={class:"category__wrap overflow-y-scroll"},we=["onClick"],Ce={class:"text-sm category-name"},ke=m(()=>o("div",{class:"bg-[#f5f5f5] h-[88px]"},null,-1)),Se={class:"goods__wrap overflow-y-scroll"},Ie=O({name:"OfflineHome"});function Te(r){const t=V(),l=i(""),n=i("-1"),c=i(!1),h=i(0),B=i(20),f=i(!1),_=i([]),g=i([]),G=s=>{n.value=s,k()},j=async()=>{try{const{success:s,data:d}=await le();if(!s)return;let e=(d||[]).filter(a=>+a.goodsCount>0);e=e.map(a=>({...a,goodsCategoryName:a.goodsCategoryName.slice(0,4)})),e.unshift({goodsCategoryId:"-1",goodsCategoryName:"推荐"}),g.value=e}catch(s){console.error("获取类目数据失败:",s),g.value=[]}},D=()=>{l.value="",x()},C=i(null),x=()=>{c.value||(h.value=0,f.value=!1,_.value=[],v(),C.value.blur())},k=()=>{h.value=0,f.value=!1,_.value=[],v()},v=async()=>{c.value=!0,h.value+=1,f.value=!1,await R(),c.value=!1},R=async()=>{let s={};n.value==="-1"?s={sortBy:"desc|goods_sales_volume,desc|goods_id",goodsCategoryId1:null}:s={sortBy:null,goodsCategoryId1:n.value||null};const d={page:h.value,size:B.value,goodsStatus:1,goodsNameLike:l.value,...s},{success:y,data:e}=await te(d);if(!y||!e||!e.total){f.value=!0;return}const a=e.records||[];_.value=h.value===1?a:[..._.value,...a],_.value.length>=e.total&&(f.value=!0)},z=s=>{t.push({path:"/offlineGoodsDetail",query:{goodsId:s.goodsId}})};return A(()=>{new ae(".goods__wrap","offline_home_scroll"),v()}),N(()=>{sessionStorage.getItem("reset_offline_home_scroll")=="1"&&(sessionStorage.removeItem("reset_offline_home_scroll"),k()),j()}),(s,d)=>{const y=E("van-list");return u(),p("div",re,[o("div",ne,[o("div",ce,[o("div",ie,[o("div",de,I(s.$t("offline.main title")),1)])])]),o("div",ue,[o("div",_e,[fe,M(o("input",{ref:(e,a)=>{a.searchRef=e,C.value=e},type:"text","onUpdate:modelValue":d[0]||(d[0]=e=>l.value=e),class:"w-full h-full bg-transparent ml-1 font-normal",placeholder:"请输入搜寻关键字",onKeyup:P(x,["enter"]),enterkeyhint:"search"},null,40,he),[[J,l.value]]),l.value?(u(),p("div",{key:0,class:"flex-shrink-0 flex items-center justify-center",onClick:D},me)):U("",!0),o("div",{class:"search__btn ml-2 flex-shrink-0",onClick:x},ve)])]),o("div",ye,[be,o("div",xe,[(u(!0),p(T,null,L(g.value,(e,a)=>{var S;return u(),p("div",{key:e.goodsCategoryId,class:Q(["category__item h-[44px] min-h-[44px] w-full flex items-center justify-center font-normal text-b2",{"bg-white !text-b1 font-semibold selected-category":n.value===e.goodsCategoryId,"selected-category-prev":n.value===((S=g.value[a+1])==null?void 0:S.goodsCategoryId)}]),onClick:Ne=>G(e.goodsCategoryId)},[o("span",Ce,I(e.goodsCategoryName||"/"),1)],10,we)}),128)),ke]),o("div",Se,[_.value.length===0&&!c.value?(u(),w(se,{key:0,name:"暂无搜索结果"})):(u(),w(y,{key:1,loading:c.value,"onUpdate:loading":d[1]||(d[1]=e=>c.value=e),finished:f.value,"finished-text":"没有更多了",onLoad:v},{default:W(()=>[(u(!0),p(T,null,L(_.value,e=>(u(),w(oe,{key:e.goodsId,goods:e,class:"mb-4 :last:mb-0",onClick:a=>z(e),"show-store-name":""},null,8,["goods","onClick"]))),128))]),_:1},8,["loading","finished"]))])])])}}const Le=Object.assign(Ie,{setup:Te}),Ve=$(Le,[["__scopeId","data-v-f39bfb86"]]);export{Ve as default};
