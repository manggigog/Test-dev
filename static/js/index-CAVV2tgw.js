import{_ as ke}from"./kefu-BZ7ykajd.js";import{_ as se,y as G,x as O,F as l,G as a,a2 as d,P as _,R as z,Q as C,H as s,I as j,J as oe,w as le,K as y,O as R,a0 as xe,a4 as be,T as K,a1 as Te,l as we,r as c,a8 as $e,z as Z,bf as _e,D as Ce,E as M,N as E,Y as Ie,Z as Le}from"./vendor-D6JO6WHW.js";import{e as Se,v as qe,g as Ae,aO as De,r as Ne,W as Be,aP as Re,aQ as ze,aR as Ee,aD as Ge}from"./index-koYZVdtr.js";import{a as Me}from"./shop-CeqcS6K2.js";import{_ as Oe}from"./cart-icon-CPmHbIVR.js";import{_ as je}from"./buy-cart-3M2I0Qjc.js";import{_ as Pe}from"./BoutiqueLable-B4X4LLB8.js";import{R as ee}from"./RatioBox-CM_1wIbR.js";import{_ as Fe}from"./ShopMaskTips-wgA1ZEjb.js";import{_ as te}from"./GoodsPrice-DdCD8Nfm.js";import{_ as ae}from"./CardPrice-BnTYZM8H.js";import{D as Ve}from"./goods-BVwS8oFG.js";import{M as He}from"./MallTabBar-YLXE0FHn.js";import{B as Ke}from"./BackIcon-CPUEW9je.js";import{a as Ue}from"./category-Dm8ZK1uH.js";import{q as Ye}from"./cart-BNEQnint.js";import{q as Qe}from"./mall-xABougXB.js";import{_ as We}from"./DefaultPage-DoXw2rGZ.js";import{H as Je}from"./HomeGoodsItem-BPDTM1Zj.js";import"./MCOIN-BcbOHmhy.js";import"./ImgBoutiqueLable-Dod52ZXF.js";const Xe="/Test-dev/static/images/flashSale-DOaFK4_-.png",Ze="/Test-dev/static/images/unflashSale-CjYqec_P.png",et={class:"relative z-20 whitespace-nowrap flex justify-center gap-16 px-12 py-2.5 overflow-hidden bg-white rounded-t-lg sort-shadow text-black-400 text-sm font-normal"},tt={class:"flex items-center gap-1"},at={key:0,class:"w-4 h-4",src:Xe},st={key:1,class:"w-4 h-4",src:Ze},ot=G({props:{deliveryType:null},emits:["change"],setup(e,{emit:h}){const{useShopStore:i}=Se(),T=O(()=>i.shopMenus&&i.shopMenus.includes(4)),r=O(()=>i.shopMenus&&i.shopMenus.includes(3));return(n,m)=>(a(),l("div",et,[_(T)?(a(),l("div",{key:0,class:z({active:e.deliveryType===1}),onClick:m[0]||(m[0]=p=>h("change",1))},C(n.$t("common.send")),3)):d("",!0),_(T)?(a(),l("div",{key:1,class:z({active:e.deliveryType===2}),onClick:m[1]||(m[1]=p=>h("change",2))},C(n.$t("shop.offline server")),3)):d("",!0),_(r)?(a(),l("div",{key:2,class:z({active:e.deliveryType===3}),onClick:m[2]||(m[2]=p=>h("change",3))},[s("div",tt,[e.deliveryType===3?(a(),l("img",at)):(a(),l("img",st)),s("span",null,C(n.$t("order.onesale order")),1)])],2)):d("",!0)]))}}),lt=se(ot,[["__scopeId","data-v-3069830c"]]),nt={class:"relative w-[100px] h-full overflow-hidden border-solid border-r-2 border-primary-008"},it={class:"w-[98px] h-full overflow-y-auto flex flex-col gap-2 py-4"},rt=["onClick"],dt={class:"font-normal leading-6 text-center"},ct=G({props:{list:{default:()=>[]},flashSaleList:{default:()=>[]},classId:{default:null},shopId:null,deliveryType:null},emits:["change"],setup(e,{emit:h}){const i=e,{currentLocale:T}=qe(),r=O(()=>i.deliveryType===3?i.flashSaleList.map(n=>({...n,name:n[`${Me[T.value]}Name`]})):i.list.filter(n=>+n.type==+i.deliveryType||!n.type));return(n,m)=>(a(),l("div",nt,[s("div",it,[(a(!0),l(j,null,oe(_(r),p=>(a(),l("div",{class:z(["relative py-1.5 pl-4 pr-2 text-sm text-black-400",{"text-black-800 bg-primary-008":e.classId===p.id}]),key:p.id,onClick:P=>h("change",p.id)},[s("span",dt,C(p.name),1)],10,rt))),128))])]))}}),ut="/Test-dev/static/images/offline-black-OiwvbEll.svg",vt="/Test-dev/static/images/Rob-CY-NIaX_.png",yt="/Test-dev/static/images/Robed-BOyO2jaS.png",mt={class:"flex items-start justify-between"},ft={class:"w-[90px] h-[90px] relative"},pt=["src"],ht={class:"text-sm flex items-center mb-1.5 relative"},gt={class:"text-sm flex-1 w-0 font-semibold leading-[0.875rem] truncate text-default mr-1"},kt={class:"flex items-center"},xt={class:"flex-1"},bt={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},Tt={key:0,class:"flex items-center gap-1"},wt={class:"inline-flex bg-[#FED73A] items-center gap-1 px-1.5 py-1 text-xs font-bold rounded bg-ratio text-black no-wrap"},$t=s("img",{class:"w-[1rem] h-[1rem]",src:ut},null,-1),_t={key:1,class:"text-sm font-bold"},Ct={class:"flex items-end mt-1"},It=["onClick"],Lt={key:0,class:"w-6 h-6",src:Oe},St={key:1,class:"w-6 h-6",src:je},qt={key:1,class:"flex w-full"},At={key:0,class:"text-sm font-bold"},Dt={class:"ml-auto"},Nt={key:0,class:"w-5 h-5 mr-2",src:vt},Bt={key:1,class:"w-5 h-5 mr-2",src:yt},Rt=s("div",{class:"flex items-center h-2.5"},[s("div",{class:"h-[1px] w-full bg-black-100"})],-1),zt=G({props:{data:null,deliveryType:null},emits:["handleAddCart","click"],setup(e,{emit:h}){const i=e,{t:T}=le(),r=async()=>{if(i.data.goods.stock===0&&i.data.goods.goodsTypes!=2){K(T("order.Insufficient stock"));return}i.data.goods.deliveryType===1?h("handleAddCart",i.data.goods):h("click")};return(n,m)=>(a(),l(j,null,[e.data.goods?(a(),l("div",{key:0,class:"w-full py-3 bg-white rounded",onClick:m[0]||(m[0]=p=>h("click"))},[s("section",mt,[s("div",ft,[(e.data.goods.status!=1||!+e.data.goods.stock)&&e.deliveryType!==3&&e.data.goods.goodsTypes!=2?(a(),y(Fe,{key:0,status:e.data.goods.status,stock:e.data.goods.stock},null,8,["status","stock"])):d("",!0),s("img",{src:e.data&&e.data.goods&&e.data.goods.icons&&e.data.goods.icons.split(",")[0]||_(Ae)("images/activity/boutique/squre_empty.png"),class:"rounded w-[90px] h-[90px] aspect-square object-cover"},null,8,pt)]),s("section",{class:z(["flex-1 min-h-[90px] ml-2 flex flex-col",{" justify-between":e.deliveryType==3}])},[s("div",ht,[e.data.goods.type?(a(),y(Pe,{key:0,type:e.data.goods.type,class:"flex-shrink-0 mr-1"},null,8,["type"])):d("",!0),s("div",gt,C(e.data.goods.goodsName),1)]),s("div",kt,[s("div",xt,[s("div",bt,C(e.data.goods.goodsDesc),1),e.deliveryType===2?(a(),l("div",Tt,[s("div",wt,[$t,xe(" "+C(n.$t("common.offline")),1)]),R(ee,{ratio:e.data.goods.discountRatio},null,8,["ratio"])])):d("",!0),e.deliveryType!==3?(a(),l("div",_t,[e.data.goods.payType!==2?(a(),y(te,{key:0,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),y(ae,{key:1,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0)])]),s("div",Ct,[s("div",null,[e.data.goods.payType!==2&&Number(e.data.goods.deliveryType)===_(Ve).online&&e.deliveryType!=3?(a(),y(ee,{key:0,class:"flex-shrink-0",tag:n.$t("common.rebate"),ratio:e.data.goods.discountRatio||0},null,8,["tag","ratio"])):d("",!0)]),e.deliveryType!=3?(a(),l("div",{key:0,onClick:be(r,["stop"]),class:"px-1.5 ml-auto"},[e.data.goods.deliveryType===1?(a(),l("img",Lt)):(a(),l("img",St))],8,It)):(a(),l("div",qt,[e.deliveryType===3?(a(),l("div",At,[e.data.goods.payType!==2?(a(),y(te,{key:0,price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),y(ae,{key:1,class:"ml-auto",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0),s("div",Dt,[+e.data.goods.status>=15?(a(),l("img",Nt)):(a(),l("img",Bt))])]))])],2)])])):d("",!0),Rt],64))}}),ne=e=>(Ie("data-v-74f88f90"),e=e(),Le(),e),Et={class:"z-50 overflow-y-auto parent-view mall-header-bg"},Gt={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},Mt={class:"flex relative justify-center items-center h-[44px] px-2.5"},Ot={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},jt={class:"font-semibold"},Pt=ne(()=>s("img",{class:"w-5 h-5",src:ke},null,-1)),Ft=[Pt],Vt={class:"px-2.5 sticky top-[44px]"},Ht={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},Kt=ne(()=>s("div",{class:"h-[16px]"},null,-1)),Ut={class:"overflow-hidden shadow-box"},Yt={class:"mall-header-bg mall-header-bg-box"},Qt=G({name:"CategoryShopDetail"});function Wt(e){const{t:h}=le(),i=Te(),T=we(),r=c(1);i.query.deliveryType&&(r.value=Number(i.query.deliveryType));const n=O(()=>i.query.shopId||null),m=c(null);m.value=i.query.shopId;const p=c(null),{y:P}=$e(p);Z(()=>n,async t=>{t.value&&t.value!==m.value&&(m.value=t.value,g.value&&(g.value=null),J(),L())},{deep:!0});const g=c(null),ie=t=>{g.value!==t&&(g.value=t,L())};Z(()=>i.query.deliveryType,()=>{i.query.deliveryType&&+i.query.deliveryType!=+r.value&&(r.value=Number(i.query.deliveryType),g.value=null,F(),L())},{deep:!0});const f=c(null),re=async()=>{if(!n.value)return;const t=await Be(n.value);!t.success||!t.data||(f.value=t.data,L())},de=t=>{r.value!==t&&($.value="",T.replace({path:"category",query:{deliveryType:t,shopId:n.value}}),r.value=t,g.value=null,A.value=[],A.value.unshift({name:"推薦",id:null}),F(),L())},A=c([]),F=async()=>{if(r.value===2){try{const{success:o,data:x}=await Re({shopId:n.value});if(!o)return;const u=(x||[]).filter(D=>D.goodsCount>0).map(D=>({name:D.goodsCategoryName,id:D.goodsCategoryId}));u.unshift({name:"推薦",id:null}),A.value=u}catch(o){console.error("获取线下服务类目数据失败:",o),A.value=[]}return}const t=await Ue({address:f.value.merchant});t.success&&(A.value=t.data||[],A.value.unshift({name:"推薦",id:null}))},V=c([]),ce=async()=>{const t=await ze(f.value.merchant);t.success&&(V.value=t.data||[],V.value.unshift({cnName:"推薦",jpName:"推薦する",enName:"recommend",id:null}))},k=c([]),N=c(!1),w=c(!1),I=c(0),H=c(10),B=c(0),ue=c,U=async()=>{!f.value&&n.value||(N.value=!0,I.value+=1,await ve(),setTimeout(()=>{N.value=!1},1500))},$=c(""),ve=async()=>{if(r.value===2){await ye();return}await me()},ye=async()=>{var u;let t=null,o=null;g.value===null?(o="desc|goods_sales_volume",t=null):(o=null,t=g.value||null);const x={page:I.value,size:H.value,goodsStatus:1,goodsNameLike:$.value,shopId:((u=f.value)==null?void 0:u.id)||"",goodsCategoryId1:t,sortBy:o},b=await Ee(x);if(N.value=!1,!b.success||!b.data||!b.data.total){w.value=!0,k.value=I.value===1?[]:k.value;return}B.value=b.data.total;const S=b.data.records||[];k.value=I.value===1?S:k.value.concat(S),k.value.length>=B.value&&(w.value=!0)},me=async()=>{var b,S;const t={page:I.value,size:H.value,status:1,subclassId:g.value,deliveryType:r.value,merchant:(b=f.value)==null?void 0:b.merchant,keyword:$.value};let o=null;if(r.value===3?o=await Ge({page:I.value,size:H.value,merchant:(S=f.value)==null?void 0:S.merchant,categoryId:g.value?g.value:null,title:$.value}):o=await Qe(t),N.value=!1,!o.success){w.value=!0;return}if(!o.data||!+o.total){w.value=!0,k.value=I.value===1?[]:k.value;return}B.value=o.total;const x=c([]);r.value===3?x.value=o.data.map(u=>({goods:{...u,goodsName:u.title,icons:u.mainImageUrls,deliveryType:u.shippingMethod}})):x.value=o.data.map(u=>({goods:u.goods,stores:u.stores||ue,card:u.card})),k.value=I.value===1?x.value:k.value.concat(x.value),k.value.length>=B.value&&(w.value=!0)},{loadingToggle:Y}=Ne(),fe=async t=>{if(t.stock===0&&t.goodsTypes!=2){K(h("order.Insufficient stock"));return}Y(!0);const o=await Ye(t.id);Y(!1),o.success&&K(h("cart.addTips"))},Q=t=>{T.push(t)},W=c(null),pe=t=>{t.code==="Enter"&&(L(),W.value.blur())},he=()=>{$.value="",L()},L=()=>{if(P.value=0,f.value&&+f.value.status!=1){w.value=!0;return}k.value=[],I.value=0,B.value=0,w.value=!1,U()},ge=t=>{T.push({path:"/offlineGoodsDetail",query:{goodsId:t.goodsId}})},J=async()=>{if(await re(),f.value&&+f.value.status!=1){w.value=!0;return}$.value="",F(),ce()};return _e(()=>{p.value&&p.value.scrollTo(0,P.value)}),Ce(()=>{J()}),(t,o)=>{var D,X;const x=M("van-icon"),b=M("van-field"),S=M("van-sticky"),u=M("VanList");return a(),l("div",Et,[s("section",Gt,[s("section",Mt,[s("div",Ot,[R(Ke,null,{default:E(()=>[s("span",null,C(t.$t("common.return")),1)]),_:1})]),s("div",jt,C(t.$t("shop.Classification")),1),(D=f.value)!=null&&D.merchant?(a(),l("div",{key:0,onClick:o[0]||(o[0]=v=>{var q;return Q(`/shopInfo?address=${(q=f.value)==null?void 0:q.merchant}`)}),class:"absolute right-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},Ft)):d("",!0)]),s("section",Vt,[R(b,{ref:(v,q)=>{q.searchRef=v,W.value=v},"model-value":$.value,"onUpdate:model-value":o[1]||(o[1]=v=>$.value=v),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:pe,placeholder:t.$t("mall.Enter search keywords"),onClear:he,enterkeyhint:"search"},{"left-icon":E(()=>[$.value?d("",!0):(a(),y(x,{key:0,name:"search",size:"18"}))]),"right-icon":E(()=>[s("div",{onClick:L},[$.value?(a(),y(x,{key:1,name:"search",size:"18"})):(a(),l("div",Ht,C(t.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),Kt]),s("div",Ut,[R(S,{"offset-top":90},{default:E(()=>[s("div",Yt,[R(lt,{deliveryType:r.value,onChange:de},null,8,["deliveryType"])])]),_:1}),s("div",{class:z(["relative flex bg-white h-[calc(100vh-84px)] overflow-hidden",{"safe-bottom-page":_(n)}])},[R(ct,{shopId:_(n),classId:g.value,list:A.value,flashSaleList:V.value,onChange:ie,deliveryType:r.value},null,8,["shopId","classId","list","flashSaleList","deliveryType"]),s("div",{class:"relative flex-1 h-full overflow-y-auto",ref:(v,q)=>{q.listPageRef=v,p.value=v}},[w.value&&B.value===0?(a(),y(We,{key:0,title:t.$t("common.No products")},null,8,["title"])):(a(),y(u,{key:1,loading:N.value,"onUpdate:loading":o[2]||(o[2]=v=>N.value=v),finished:w.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:U,class:"px-2.5 py-2.5"},{default:E(()=>[(a(!0),l(j,null,oe(k.value,v=>(a(),l(j,null,[r.value!==2?(a(),y(zt,{key:0,data:v,onClick:q=>Q(`${r.value==3?"/saleGoodDetail":"/goodsDetail"}?id=${v.goods.id}`),onHandleAddCart:fe,deliveryType:r.value},null,8,["data","onClick","deliveryType"])):(a(),y(Je,{key:1,goods:v,class:"mb-4 :last:mb-0 border-b border-gray-200 pb-4 home-goods-item",onClick:q=>ge(v)},null,8,["goods","onClick"]))],64))),256))]),_:1},8,["loading","finished","finished-text","loading-text"]))],512)],2)]),_(n)?(a(),y(He,{key:0,shopId:_(n),shopType:(X=f.value)==null?void 0:X.type},null,8,["shopId","shopType"])):d("",!0),r.value!==3?(a(),y(De,{key:1})):d("",!0)])}}const Jt=G({...Qt,setup:Wt}),ka=se(Jt,[["__scopeId","data-v-74f88f90"]]);export{ka as default};
