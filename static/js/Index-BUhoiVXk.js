import{_ as Z}from"./clear-post-Dw5zePxY.js";import{B as W}from"./BackIcon-CDrGaEPo.js";import{B as X}from"./BetweenTab-nGcUWfRT.js";import{l as D}from"./shop-CeqcS6K2.js";import{z as Y,r as ee,b as te}from"./index-BckdT6oc.js";import{_ as R,x as P,y as ae,G as x,H as r,I as a,U as N,Q as f,O as _,z as ne,q as se,o as oe,r as u,D as le,a2 as re,E as ie,F as w,P as k,Z as I,bx as ce,$ as y,J as ue,K as de,T as C}from"./vendor-Dr_RpJ_Y.js";import{r as me,q as fe,s as pe,g as ve}from"./notice-C9PsWTc3.js";/* empty css                                                               */const xe={class:"w-full bg-white rounded-xl p-3 overflow-x-hidden"},he={class:"title__wrap w-full flex justify-start items-center"},ye={key:0,class:"w-[8px] h-[8px] rounded-full mr-1.5 bg-[#FF8812] flex-shrink-0"},_e={class:"text-base text-b1 font-normal text-ellipsis line-clamp-1 flex-1 min-w-0"},ge={key:1,class:"text-xs font-normal border border-[#FF8812] rounded-[2px] px-1 text-[#FF8812] ml-1 flex-shrink-0"},be=["innerHTML"],we={class:"time__wrap w-full mt-2 no-wrap text-right"},ke={class:"text-sm text-b3 font-normal"},Ce={props:{item:{type:Object,default:()=>{}}},setup(n){const p=n,{t:s}=P(),{currentLocale:h}=Y(),g={1:s("notice.type.platform"),2:s("notice.type.site")},U=ae(()=>{const i=p.item[`content${D[h.value]}`]||p.item.contentCn||p.item.contentEn;return i?i.replace(/<[^>]*>/g,""):""});return(i,V)=>(r(),x("div",xe,[a("div",he,[n.item.readFlag?N("",!0):(r(),x("div",ye)),a("p",_e,f(n.item[`title${_(D)[_(h)]}`]||n.item.titleCn||n.item.titleEn),1),n.item.type?(r(),x("p",ge,f(g[n.item.type]),1)):N("",!0)]),a("div",{class:"content__wrap w-full text-sm text-b2 font-normal mt-2 line-clamp-2",innerHTML:_(U)},null,8,be),a("div",we,[a("p",ke,f(_(ee)(n.item.updateTime||n.item.createTime)),1)])]))}},Ue=R(Ce,[["__scopeId","data-v-4256b51e"]]),$e={class:"w-full h-full bg-[#f2f0ef]"},Le={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 bg-white"},Te={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Fe={class:"font-bold text-base text-b1"},Ie={key:1,class:"w-5 h-5",src:Z,alt:"一键清空已读"},Ne={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ve={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Be={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ee={class:"list__wrap w-full h-[calc(100vh-50px-34px)] z-10 overflow-y-auto scroll-smooth px-3"},qe=ne({name:"PostList"});function ze(n){const{checkLoginAuth:p}=te(),{t:s}=P(),h=se(),g=oe(),U=[{label:s("notice.type.all"),value:0},{label:s("notice.type.platform"),value:1},{label:s("notice.type.site"),value:2}],i=u(0),V=u(20),d=u(!1),v=u(!1),c=u([]),b=u({type:(()=>{const e=g.query.type;if(e!==void 0){const t=parseInt(e);return[0,1,2].includes(t)?t:0}return 0})()});le(()=>b.value.type,e=>{const t={...g.query};e===0?delete t.type:t.type=e.toString(),h.replace({query:t})},{immediate:!1});const[B,E]=re(!1),$=u(null),j=()=>{if(B.value)return;const e=Date.now();if($.value&&e-$.value<2e3){C(s("city.Please do not click frequently"));return}const t={type:null};E(!0),me(t).then(o=>{o.success&&(C(s("city.Unread messages have been cleared")),A(),L())}).catch(o=>{console.error("清空已读失败:",o)}).finally(()=>{E(!1)}),$.value=e},A=async()=>{c.value.forEach(e=>{e.readFlag=!0})},L=()=>{i.value=0,c.value=[],v.value=!1,q(),z()},q=()=>{p(!0)&&(v.value||(d.value=!0,i.value+=1,S()))},S=()=>{const e={...b.value,page:i.value,size:V.value};fe(e).then(t=>{if(t.success===!1){C(t.message||s("city.Data retrieval failed")),v.value=!0;return}const o=t.data||[],F=t.total||0;c.value=i.value===1?o:c.value.concat(o),(c.value.length>=F||o.length===0)&&(v.value=!0)}).catch(t=>{console.error("获取公告列表失败:",t),C(s("city.Network error please try again later")),v.value=!0}).finally(()=>{d.value=!1})},H=e=>{L()},M=e=>{const t=e.id;e.readFlag=!0,O(t),h.push("/postDetail?id="+t)},O=async e=>{await pe(e)},m=u({versionUnread:0,platformUnread:0,totalUnread:0}),z=async()=>{const e=await ve();if(e.success){m.value=e.data||{};return}},Q=async()=>{await z()},G=async()=>{await Q()};ie(()=>{p(!0)&&G()});const T=e=>e===0?0:e>99?"99+":e;return(e,t)=>{const o=w("van-loading"),F=w("Empty"),J=w("van-list"),K=w("van-pull-refresh");return r(),x("div",$e,[a("section",Le,[a("div",Te,[k(W)]),a("div",Fe,f(e.$t("home.Announcement List Public")),1),a("div",{class:"absolute right-4 flex items-center gap-1 -translate-y-1/2 top-1/2 w-5 h-5",onClick:j},[_(B)?(r(),I(o,{key:0,size:"20"})):(r(),x("img",Ie))])]),a("section",null,[k(X,{options:U,modelValue:b.value.type,"onUpdate:modelValue":t[0]||(t[0]=l=>b.value.type=l),onChange:H,"label-key":"label","value-key":"value"},ce({_:2},[m.value.totalUnread>0?{name:"badge0",fn:y(()=>[a("span",Ne,f(T(m.value.totalUnread)),1)])}:void 0,m.value.platformUnread>0?{name:"badge1",fn:y(()=>[a("span",Ve,f(T(m.value.platformUnread)),1)])}:void 0,m.value.versionUnread>0?{name:"badge2",fn:y(()=>[a("span",Be,f(T(m.value.versionUnread)),1)])}:void 0]),1032,["modelValue"])]),a("section",Ee,[k(K,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=l=>d.value=l),onRefresh:L,"animation-duration":"0"},{default:y(()=>[c.value.length===0&&!d.value?(r(),I(F,{key:0,name:e.$t("city.no message")},null,8,["name"])):N("",!0),k(J,{loading:d.value,"onUpdate:loading":t[1]||(t[1]=l=>d.value=l),finished:v.value,"finished-text":c.value.length===0?"":e.$t("common.no more"),onLoad:q},{default:y(()=>[(r(!0),x(ue,null,de(c.value,l=>(r(),I(Ue,{key:l.id,item:l,class:"mb-3 first:mt-3",onClick:Pe=>M(l)},null,8,["item","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])])}}const De=Object.assign(qe,{setup:ze}),Je=R(De,[["__scopeId","data-v-2bb038c4"]]);export{Je as default};
