import{_ as st,z as ot,x as nt,a2 as N,r as u,y,B as r,E as lt,G as S,H as _,I as o,Z as M,U as w,P as q,Q as l,a4 as it,O as t,$ as rt,X as ct,Y as ut}from"./vendor-Dr_RpJ_Y.js";import{N as dt,_ as mt}from"./NumberKeyBoardInput-BXn8ePlS.js";import{B as gt}from"./BackIcon-CDrGaEPo.js";import{e as m,a8 as pt,j as A,g as C,k,aP as L}from"./index-7OiUoGXy.js";import{_ as vt}from"./ApproveButton-BB8qyFWg.js";import{q as ft}from"./storeValue-BCpc_s9S.js";import{p as yt}from"./piggyBank-DCQqbblx.js";import"./close-BkqxFSX4.js";const _t=""+new URL("../images/wallet-arrow-forward-Jlou4VJw.svg",import.meta.url).href,ht=p=>(ct("data-v-530506bf"),p=p(),ut(),p),xt={class:"px-3 bg-[#f2f0ef] text-[#2E2008] font-normal"},bt={class:"gap-2 mt-2 flex-start"},wt={class:"flex-shrink-0 text-base opacity-80"},Ct={class:"ml-auto text-right"},kt={class:"text-right"},It={key:0},Bt={class:"text-xs opacity-60"},$t=ht(()=>o("img",{class:"w-4 h-4 ml-1.5 self-center",src:_t,alt:"",srcset:""},null,-1)),Et={class:"bg-white mt-2.5 p-4 rounded-xl text-[#2E2008]"},Ft={class:"text-xs opacity-60"},Nt={class:"bg-[#FFF8EC] rounded-xl px-0.5 pr-2.5 py-2 mt-4 flex justify-between items-center w-full relative"},St=["src"],Mt={class:"flex justify-between mt-5 text-sm opacity-60"},qt={class:"flex justify-between mt-5 text-sm opacity-60"},At={class:"text-[#2E2008] text-base"},Lt=ot({setup(p){const{t:T}=nt(),{deposit:V,tomorrow:O,earnings:D,nextFloatAwardAmount:j,total:P,DAY:R}=yt(),[Y,h]=N(!1),I=u(null),U=e=>{const a=new Date(e),n=a.getFullYear(),b=("0"+(a.getMonth()+1)).slice(-2),W=("0"+a.getDate()).slice(-2),tt=("0"+a.getHours()).slice(-2),et=("0"+a.getMinutes()).slice(-2),at=("0"+a.getSeconds()).slice(-2);return[n,b,W,tt,et,at]},g=y(()=>U(F.value)),H=async()=>{I.value=r(await A(C.MCOIN).balanceOf()).toString()},i=u(null),c=u([]),v=u(0),s=y(()=>c.value&&c.value.length>0?c.value.find(e=>Number(e.storedCardId)===v.value):{}),J=async()=>{const e=await ft();c.value=[];const a=[];for(let n=0;n<e.data.length;n++){if(!e.data[n].contract)continue;const b=r(await A(e.data[n].contract).balanceOf()).toString();a.push({...e.data[n],quota:b})}a.unshift({storedCardId:0,shopName:T("piggy.My_purse"),quota:I.value,symbol:"MCOIN",symbolLogo:k("images/ecology/wallet.png"),contract:C.MCOIN}),c.value=a},X=e=>{v.value=e,i.value=null,h(!1)},x=u(null),z=()=>{var e,a,n;i.value=(e=s.value)!=null&&e.quota?m((a=s.value)==null?void 0:a.quota)+"":"",x.value=(((n=s.value)==null?void 0:n.quota)||0)+""},[G,B]=N(!1),K=async()=>{var a;let e=i.value;x.value&&(e=r(i.value)>=r(m((a=s.value)==null?void 0:a.quota))?x.value:i.value),L.value=!0,B(!0);try{(await V(e,v.value.toString())).success&&(i.value=null),E()}finally{B(!1),L.value=!1}},$=y(()=>{const e=d.value[1],a=d.value[2];return+e==0||+a==0?f.value:r(e).div(r(a)).times(i.value||0).plus(f.value).toString()}),d=u([null,null,null]),f=y(()=>r(i.value||0).times(d.value[0])),E=async()=>{Q(),Z(),await H(),J()},F=u(0),Q=async()=>{let e=0;const a=+await R();e=+await O()||await pt()+(e+a)*1e3,F.value=(e+a)*1e3},Z=async()=>{d.value[0]=r(await D(0)).toString(),d.value[1]=r(await j()).toString(),d.value[2]=r(await P()).toString()};return lt(()=>{E()}),(e,a)=>(_(),S("div",xt,[o("div",bt,[q(gt),o("div",null,l(e.$t("piggy.Lightning Yu’E Bao")),1)]),o("div",{class:"mt-4 px-4 rounded-xl wallet-bg h-[4.5rem] flex items-center",onClick:a[0]||(a[0]=n=>t(h)(!0))},[o("div",wt,l(e.$t("piggy.payment_method")),1),o("div",Ct,[o("div",kt,[it(l(t(s)&&t(s).shopName)+" ",1),t(s)&&t(s).storedCardId!==0?(_(),S("span",It,l(e.$t("piggy.stored value card")),1)):w("",!0)]),o("div",Bt,l(e.$t("assets.balance"))+l(t(s)&&t(m)(t(s).quota,4))+" "+l(t(s)&&t(s).symbol),1)]),$t]),o("div",Et,[o("div",Ft,l(e.$t("piggy.Transfer_in_amount")),1),o("div",Nt,[o("img",{class:"rounded-full w-6 h-6 ml-2.5 mr-1",src:t(s).storedCardId?t(s).symbolLogo||t(k)("images/piggyBank/default-token.png"):t(k)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,St),q(dt,{class:"py-1.5 flex-1 bg-[#FFF8EC] text-lg font-bold text-[#2E2008]",modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=n=>i.value=n),placeholder:"0",reg:/^\d+(\.\d{0,2})?$/,max:t(s)&&t(m)(t(s).quota,4)},null,8,["modelValue","reg","max"]),o("div",{class:"px-1.5 py-0.5 border-[1px] border-[#FBA923] border-solid rounded text-xs text-[#FBA923] font-medium absolute right-2.5",onClick:z}," MAX ")]),o("div",Mt,[o("div",null,l(e.$t("piggy.Estimated_average_income")),1),o("div",null,l(+t(f)>0?t(m)(+t(f),4):0)+" MC ～"+l(+t($)>0?t(m)(+t($),4):0)+" MC ",1)]),o("div",qt,[o("div",null,l(e.$t("piggy.Estimated-time-fo-first-income-to-arrive")),1),o("div",null,l(t(g)[1]+e.$t("common.month")+t(g)[2]+e.$t("common.Day")+" "+t(g)[3]+":"+t(g)[4]+":"+t(g)[5]),1)]),t(s)&&t(s).contract?(_(),M(vt,{key:0,approveAmount:+i.value,contract:t(C).piggyBank,disabled:i.value<=0||+t(s).quota<+i.value,token:t(s).contract,fallBack:K,loading:t(G),class:"btn mt-5 mb-1.5 block font-normal bg-[#FED73A] h-[50px] w-full px-4 rounded-3xl text-base text-center leading-[50px]"},{default:rt(()=>[o("span",At,l(e.$t("piggy.Confirm_transfer")),1)]),_:1},8,["approveAmount","contract","disabled","token","loading"])):w("",!0)]),c.value.length>0?(_(),M(mt,{key:0,type:1,list:c.value,id:v.value,onClose:a[2]||(a[2]=n=>t(h)(!1)),onSelectCard:X,show:t(Y)},null,8,["list","id","show"])):w("",!0)]))}}),Ut=st(Lt,[["__scopeId","data-v-530506bf"]]);export{Ut as default};
