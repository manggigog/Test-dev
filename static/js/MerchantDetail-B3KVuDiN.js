import{G as i,H as a,I as e,Q as r,U as u,O as s,a4 as C,F as _e,P as v,$ as M,_ as pe,z as ee,x as be,q as ge,o as ye,r as g,a2 as p,y as X,E as Ce,Z as y,T as b}from"./vendor-Dr_RpJ_Y.js";import{_ as we}from"./OfflineGoods-DKMaiwr2.js";import{_ as Se}from"./OfflineStore-D-5bM32y.js";import{_ as ke,O as $e}from"./OrderCancelSelectorPop-n5_kLGqC.js";import{_ as V}from"./MCOIN-Bodfn-v1.js";import{_ as Te}from"./link-DvRTrysK.js";import{_ as q}from"./copy-w-F2Lv8QkV.js";import{e as R,g as Ee,f as I,h as j,r as B,V as Ae,i as Oe,b as De,a as Le,C as Ne,c4 as Pe,c5 as Re}from"./index-7OiUoGXy.js";import{a as m,o as Ie}from"./offlineGoods-DvT2Go6q.js";import{C as je}from"./CommonVanProvider-KZuKVOde.js";import{_ as Be}from"./ServiceByStore-_CULXKHe.js";import{_ as Me}from"./EmptyTipsPop-DFfFg0cQ.js";import"./ImgBoutiqueLable-B-2xCcw4.js";import"./shop-CeqcS6K2.js";import"./check-DoEtABZT.js";import"./BackIcon-CDrGaEPo.js";const Ve={class:"p-3 break-all bg-white rounded-xl"},qe={class:"title text-b1 text-sm font-semibold"},Fe={class:"content"},He={class:"flex justify-between items-center mt-[16px]"},Ue={class:"text-b3 text-sm font-normal"},Ye={class:"text-b1 text-sm font-normal text-right"},Ge={class:"flex justify-start items-center"},Ke=e("img",{class:"w-[17px] h-[17px] flex-shrink-0",src:V},null,-1),ze={class:"text-b1 text-sm font-normal ml-1"},Qe={key:0,class:"flex justify-between items-center mt-[16px]"},Ze={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Je={class:"text-b1 text-sm font-normal text-right"},We={class:"flex justify-start items-center"},Xe=e("span",{class:"text-b1 text-sm font-normal"}," - ",-1),et=e("img",{class:"w-[17px] h-[17px] ml-1",src:V},null,-1),tt={class:"text-b1 text-sm font-normal ml-1"},st={class:"flex justify-between items-center mt-[16px]"},ot={class:"text-b3 text-sm font-normal"},rt={class:"text-b1 text-sm font-normal text-right"},nt={class:"flex justify-start items-center"},at=e("img",{class:"w-[17px] h-[17px]",src:V},null,-1),lt={class:"text-b1 text-sm font-normal ml-1"},it={class:"flex justify-between items-center mt-[16px]"},ct={class:"text-b3 text-sm font-normal"},dt={class:"text-b1 text-sm font-normal text-right"},mt={class:"flex justify-between items-center mt-[16px]"},ut={class:"text-b3 text-sm font-normal"},ft=["href"],ht=e("img",{src:Te,class:"w-5 h-5 ml-1",alt:""},null,-1),xt={key:1},vt={class:"flex justify-between items-center mt-[16px]"},_t={class:"text-b3 text-sm font-normal"},pt=e("img",{src:q,class:"w-5 h-5 ml-1",alt:""},null,-1),bt={class:"flex justify-between items-center mt-[16px]"},gt={class:"text-b3 text-sm font-normal"},yt=e("img",{src:q,class:"w-5 h-5 ml-1",alt:""},null,-1),Ct={key:1,class:"flex justify-between items-center mt-[16px]"},wt={class:"text-b3 text-sm font-normal"},St={class:"text-b1 text-sm font-normal text-right"},kt={key:2,class:"flex justify-between items-center mt-[16px]"},$t={class:"text-b3 text-sm font-normal"},Tt={class:"text-b1 text-sm font-normal text-right"},Et={key:3,class:"flex justify-between items-center mt-[16px]"},At={class:"text-b3 text-sm font-normal"},Ot={key:0},Dt={key:1},Lt={class:"text-b1 text-sm font-normal text-right"},Nt={key:4,class:"flex justify-between items-center mt-[16px]"},Pt={class:"text-b3 text-sm font-normal"},Rt={class:"text-b1 text-sm font-normal text-right"},It={class:"flex justify-between items-center mt-[16px]"},jt={class:"text-b3 text-sm font-normal whitespace-nowrap"},Bt={class:"text-b1 text-sm font-normal text-right flex items-center"},Mt={class:"break-all flex-1"},Vt=e("img",{src:q,class:"w-5 h-5",alt:""},null,-1),qt=[Vt],Ft={props:{order:{type:Object,required:!0,default:()=>({})}},setup(t){return(o,d)=>{var h;return a(),i("div",Ve,[e("div",qe,r(o.$t("order.orderInfo")),1),e("div",Fe,[e("div",He,[e("div",Ue,r(o.$t("office.server price")),1),e("div",Ye,[e("p",Ge,[Ke,e("span",ze,r(s(R)(t.order.orderTotalAmount)),1)])])]),t.order.actAmount?(a(),i("div",Qe,[e("div",Ze,r(((h=t.order.fmGeneralActivity)==null?void 0:h.name)||"-"),1),e("div",Je,[e("p",We,[Xe,et,e("span",tt,r(s(R)(t.order.actAmount)),1)])])])):u("",!0),e("div",st,[e("div",ot,r(o.$t("order.total price actual")),1),e("div",rt,[e("p",nt,[at,e("span",lt,r(s(R)(t.order.orderRealAmount)),1)])])]),e("div",it,[e("div",ct,r(o.$t("common.ratio")),1),e("div",dt,r(t.order.orderDiscountRatio)+"% ",1)]),e("div",mt,[e("div",ut,r(o.$t("order.hash")),1),t.order.orderTransactionHash?(a(),i("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${s(Ee).chainConfig.blockExplorerUrls[0]}/tx/${t.order.orderTransactionHash}`},[C(r(s(I)(t.order.orderTransactionHash,"***",9,5)||"--")+" ",1),ht],8,ft)):(a(),i("span",xt," -- "))]),e("div",vt,[e("div",_t,r(o.$t("offline.create address")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:d[0]||(d[0]=x=>s(j)(t.order.orderCustomerAddress))},[C(r(s(I)(t.order.orderCustomerAddress,"...",5,5))+" ",1),pt])]),e("div",bt,[e("div",gt,r(o.$t("order.payAddress")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:d[1]||(d[1]=x=>s(j)(t.order.orderPayAddress))},[C(r(s(I)(t.order.orderPayAddress,"...",5,5))+" ",1),yt])]),t.order.createTime?(a(),i("div",Ct,[e("div",wt,r(o.$t("order.createTime")),1),e("div",St,r(s(B)(t.order.createTime)),1)])):u("",!0),t.order.payTime?(a(),i("div",kt,[e("div",$t,r(o.$t("order.chainFinishTime")),1),e("div",Tt,r(s(B)(t.order.payTime)),1)])):u("",!0),t.order.finishTime?(a(),i("div",Et,[e("div",At,[t.order.orderStatus===s(m).CANCELLED?(a(),i("span",Ot,r(o.$t("offline.cancel_time")),1)):(a(),i("span",Dt,r(o.$t("order.finishTime")),1))]),e("div",Lt,r(s(B)(t.order.finishTime)),1)])):u("",!0),t.order.orderStatus===s(m).CANCELLED?(a(),i("div",Nt,[e("div",Pt,r(o.$t("offline.cancel_reason")),1),e("div",Rt,r(t.order.cancelReason||"--"),1)])):u("",!0),e("div",It,[e("div",jt,r(o.$t("order.orderNumber")),1),e("div",Bt,[e("div",Mt,r(t.order.orderId||"--"),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:d[2]||(d[2]=x=>s(j)(t.order.orderId))},qt)])])])])}}},Ht={class:"flex justify-between items-center gap-3 fixed bottom-0 left-0 right-0 px-3 pb-4"},Ut={key:0,class:"relative w-full"},Yt={key:1,class:"relative w-full"},Gt={props:{order:{type:Object,default:()=>({})},cancelLoading:{type:Boolean,default:!1},deliverLoading:{type:Boolean,default:!1}},emits:["handleCancel","handleDeliver"],setup(t,{emit:o}){const d=()=>{o("handleCancel")},h=()=>{o("handleDeliver")};return(x,F)=>{const w=_e("VanButton");return a(),i("div",Ht,[t.order.orderStatus===s(m).PAYMENT_SUCCESS?(a(),i("div",Ut,[v(w,{round:"",class:"w-full gray-btn border-btn font-normal text-base h-[46px] rounded-full",onClick:d,loading:t.cancelLoading,disabled:t.deliverLoading},{default:M(()=>[C(r(x.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"])])):u("",!0),t.order.orderStatus===s(m).PAYMENT_SUCCESS?(a(),i("div",Yt,[v(w,{round:"",class:"w-full main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:h,loading:t.deliverLoading,disabled:t.cancelLoading},{default:M(()=>[C(r(x.$t("order.Ship")),1)]),_:1},8,["loading","disabled"])])):u("",!0)])}}},Kt={class:"px-3 pb-20 flex flex-col gap-3 safe-body overflow-y-auto"},zt={class:"w-full p-3 rounded-xl bg-white font-Puhui"},Qt=ee({name:"offlineMerchantDetail"});function Zt(t){var J;const{t:o}=be(),d=ge(),h=ye(),{getMerchantDhKey:x,decryptKey:F}=Ae(),{offlineMerchantCancel:w,offlineMerchantConfirm:te}=Oe(),{checkLoginAuth:se}=De(),oe={[m.PAYMENT_FAILED]:o("order.fail"),[m.PAYING]:o("order.paying"),[m.PAYMENT_SUCCESS]:o("order.wait"),[m.CANCELLED]:o("order.canceled"),[m.COMPLETED]:o("order.completed"),[m.CLOSED]:o("order.closed")},n=g({orderRemark:""}),[H,U]=p(!1),[re,S]=p(!1),[ne,Y]=p(!1),{accountStore:T,clerkStore:k}=Le(),[ae,E]=p(!1),A=g("发货成功"),O=g(!1),D=g(((J=h.query)==null?void 0:J.id)||""),G=async()=>new Promise(async c=>{var f,_,W;U(!0);const l=await Pe({id:D.value});if(U(!1),c(!0),b.clear(),!!l.success&&(n.value=l.data||{},(f=l.data)!=null&&f.orderCustomerAddress&&(_=l.data)!=null&&_.orderRemark&&(W=l.data)!=null&&W.orderSubmitCustomerPubKey))try{const $=await x(l.data.merchantAddress,l.data.orderSubmitCustomerPubKey);if($){const ve=F(l.data.orderRemark,$);n.value.orderRemark=ve.decrypt}}catch($){console.error("解密失败:",$)}}),K=async()=>{G()},z=X(()=>Ie(n.value.orderType)),le=X(()=>oe[n.value.orderStatus]||"--"),L=g(null),[ie,N]=p(!1),ce=()=>{if(T.isOnlyView)return b(o("order.Requires merchant account operation"));if(k.isClerk&&!k.clerkAuth)return b(o("order.Requires merchant account operation"));(n.value.orderStatus||null)===m.PAYMENT_SUCCESS?N(!0):b(o("offline.order status does not support cancel"))},de=c=>{L.value=c,console.log("cancelReason",L.value),N(!1),fe()},[me,P]=p(!1),ue=o("offline.cancel important msg"),fe=()=>{P(!0)},Q=()=>{P(!1)},he=async()=>{P(!1);const c={orderId:n.value.orderId,cancelReason:L.value.value||"其他",cancelSource:0};S(!0);const l=await Re(c);if(S(!1),!l.success)return;const f=[n.value.chainOrderId];S(!0);const _=await w(f);S(!1),_.success&&(K(),O.value=!1,A.value=o("offline.successful of cancel "),E(!0),sessionStorage.setItem("merchant_offline_refresh_chainOrderId",D.value.toString()),d.go(-1))},Z=async()=>{if(T.isOnlyView)return b(o("order.Requires merchant account operation"));if(k.isClerk&&!k.clerkAuth)return b(o("order.Requires merchant account operation"));const c=[n.value.chainOrderId];Y(!0);const l=await te(c);Y(!1),l.success&&(K(),O.value=!1,A.value="发货成功",E(!0),sessionStorage.setItem("merchant_offline_refresh_chainOrderId",D.value.toString()),setTimeout(()=>{d.go(-1)},1950))},xe=()=>{h.query.quick==="deliver"&&Z()};return Ce(async()=>{se(!0)&&(await G(),xe())}),(c,l)=>(a(),y(je,{title:c.$t("order.orderDetail"),class:"font-Puhui font-normal relative app-container main-bg","theme-vars":{"field-placeholder-text-color":"#A6A6A6",navBarBackgroundColor:"transparent"},ref:(f,_)=>{_.EvaluateDetailRef=f}},{default:M(()=>[e("section",Kt,[v(ke,{order:n.value,isBuyer:""},null,8,["order"]),e("div",zt,[v(Se,{status:s(le),"show-order-status":"",shop:{images:n.value.shopPics,name:n.value.shopName},loading:s(H)},null,8,["status","shop","loading"]),s(z).GOODS?(a(),y(we,{key:0,class:"mt-3",showNum:"",goods:{goodsName:n.value.relName||"-",goodsIcons:n.value.relIcons,goodsPrice:n.value.relPrice||0,goodsNumber:n.value.relNumber||0,areaExtName2:n.value.areaExtName2,storeName:n.value.storeName}},null,8,["goods"])):s(z).STORE?(a(),y(Be,{key:1,price:n.value.relPrice,loading:s(H)},null,8,["price","loading"])):u("",!0)]),v(Ft,{order:n.value},null,8,["order"]),s(T).isOnlyView?u("",!0):(a(),y(Gt,{key:0,order:n.value,cancelLoading:s(re),deliverLoading:s(ne),onHandleCancel:ce,onHandleDeliver:Z},null,8,["order","cancelLoading","deliverLoading"]))]),v($e,{show:s(ie),onClose:l[0]||(l[0]=f=>s(N)(!1)),onSelected:de},null,8,["show"]),v(Ne,{show:s(me),title:c.$t("common.tip"),content:s(ue),showConfirm:!0,showReject:!0,confirmText:c.$t("common.confirm"),noClose:"",onClose:Q,onConfirm:he,onReject:Q},null,8,["show","title","content","confirmText"]),s(ae)?(a(),y(Me,{key:0,onClose:l[1]||(l[1]=f=>s(E)(!1)),text:A.value,isError:O.value},null,8,["text","isError"])):u("",!0)]),_:1},8,["title"]))}const Jt=ee({...Qt,setup:Zt}),hs=pe(Jt,[["__scopeId","data-v-01d7b916"]]);export{hs as default};
