import{_ as V,y as D,w as Z,x as J,F as $,G as y,H as n,I as j,J as ce,X as pe,P as o,a2 as A,Q as v,a1 as me,r as S,O as x,be as L,D as Q,E as P,K as H,N as O,a0 as k,$ as Re,T as G,Y as ve,Z as he,l as Te,z as Oe,bf as Ee,bh as Fe,R as de}from"./vendor-BUT0HZ5j.js";import{U as d,M as Me,a as ke,b as Ae}from"./Merchant-BTR9oUXG.js";import{V as g,e as q,r as Be,S as W,Q as Le,b as ge,_ as xe,m as Pe}from"./index-k1FFr-1T.js";import{P as T}from"./profileEnum-CXsMKuND.js";import{q as De,o as Ue}from"./order-BoOTHyt5.js";import{g as He}from"./notice-iW2ykWIV.js";import{f as Ve}from"./mall-BnAUsXOy.js";import{_ as qe}from"./close-DLkDHnDK.js";import{L as ze,I as je}from"./LevelPop-CI2l8sgM.js";import{s as Ge,i as Je,b as Qe,c as fe,d as Xe,u as Ke,e as Ye}from"./user-B-N_oWpO.js";import{_ as Ze}from"./RecommendationFeed-Bbce_x7T.js";import{A as We}from"./AddParentIdPop-ZwFyzyE2.js";import"./level-BMr8jGFx.js";import"./offlineGoods-DvT2Go6q.js";import"./UpgradeStorePop-C5Yurcok.js";import"./BoutiqueLable-r45nG6V6.js";import"./shop-CeqcS6K2.js";import"./PopHeader-CfzTkyoF.js";import"./TokenBalance-CFr2KqO2.js";import"./level-L7avmjJN.js";import"./GoodsList-Lr4FQrJv.js";import"./buy-cart-3M2I0Qjc.js";import"./goods-BVwS8oFG.js";import"./ShopMaskTips-dKZ6_BUi.js";import"./GoodsPrice-Ai76_1qQ.js";import"./MCOIN-BcbOHmhy.js";import"./WaterFull-CDtRtt9C.js";import"./cart-D1U0eSk3.js";import"./useShowActiveInfo-DuFFXoYb.js";import"./festivalActivities-BFq1MXfj.js";import"./nft-CNg_D9x6.js";const et={class:"w-full h-fit py-[16px] px-[12px] bg-white rounded-[12px] flex flex-wrap font-Puhui"},tt=["onClick"],ot={class:"relative"},st=["src"],nt={key:0,class:"absolute top-[-5px] right-[1px] translate-x-1/2 min-w-[6px] w-fit h-[14px] px-1 bg-[#F44] rounded-[12px] text-white text-[10px] leading-[14px] font-normal text-center border-[1px] border-solid border-white box-content"},at={key:1,class:"absolute top-[-5px] right-[1px] translate-x-1/2 min-w-[6px] w-fit h-[14px] px-1 bg-[#F44] rounded-[12px] text-white text-[10px] leading-[14px] font-normal text-center border-[1px] border-solid border-white box-content"},rt={class:"mt-[4px] text-[14px] text-[#2E2008] font-normal font-Puhui leading-[20px] text-center"},lt={class:"mt-[16px] w-full h-fit py-[16px] px-[12px] bg-white rounded-[12px] flex flex-wrap font-Puhui"},it=["onClick"],ut={class:"relative"},ct=["src"],pt={class:"mt-[4px] text-[14px] text-[#2E2008] font-normal font-Puhui leading-[20px] text-center"},dt=D({props:{unreadCount:null,messageCount:null},emits:["handleMenu"],setup(a,{emit:f}){const{t:s}=Z(),w=m=>m===0?0:m>99?"99+":m,h=J(()=>[{text:s("user.payRecord"),img:g("profile2/consumerOption/PaymentHistory.svg"),type:d.INTERNL,url:"/buyerBill"},{text:s("user.pointsDetails"),img:g("profile2/consumerOption/PointsChangeDetails.svg"),type:d.INTERNL,url:"/integralDetail"},{text:s("user.balanceDetails"),img:g("profile2/consumerOption/BalanceChangeDetails.svg"),type:d.INTERNL,url:" /balanceDetail"},{text:s("profile.collect"),img:g("profile2/consumerOption/GoodsCollect.svg"),type:d.INTERNL,url:"/goodsCollect"},{text:s("profile.follow"),img:g("profile2/consumerOption/ShopAttention.svg"),type:d.INTERNL,url:"/shopsCollect"},{text:s("order.receive address"),img:g("profile2/consumerOption/DeliveryAddress.svg"),type:d.INTERNL,url:"/userAddress"},{text:s("voucher.voucher"),img:g("profile2/consumerOption/Vouchers.svg"),type:d.INTERNL,url:"/voucher"},{text:s("profile.announcement"),img:g("profile2/consumerOption/Announcement.svg"),type:d.INTERNL,url:"/postList"},{text:s("flashSale.flashSaleOrder"),img:g("profile2/consumerOption/LightningPurchaseOrders.svg"),type:d.INTERNL,url:"/buyerFlashSaleOrder?type=2"},{text:s("user.comminicate"),img:g("profile2/consumerOption/CommunityExchangeSection.svg"),type:d.OPTIONS,key:"concat"},{text:"我的笔记",img:g("profile2/consumerOption/MyNote.svg"),type:d.INTERNL,url:"/city/myNote"},{text:s("user.browsingHistory"),img:g("profile2/consumerOption/browsingHistory.svg"),type:d.INTERNL,url:"/browsingHistory"},{text:s("profile.notice"),img:g("profile2/consumerOption/Message.svg"),type:d.INTERNL,url:"/orderMessage?type=1"}]),C=J(()=>[{text:s("user.Improve Maker Level"),img:g("profile2/consumerOption/ImproveMakerLevel.svg"),type:d.OPTIONS,key:"level"},{text:s("ecology.otc"),img:g("profile2/consumerOption/OTC-Transactions.svg"),type:d.INTERNL,url:"/ecology-otcTransaction"},{text:s("common.inviteFriend"),img:g("profile2/consumerOption/InviteFriends.svg"),type:d.OPTIONS,key:"invite"},{text:s("common.myNft"),img:g("profile2/consumerOption/MyNFT.svg"),type:d.OPTIONS,key:"nft"},{text:s("ranking.Ecological help list"),img:g("profile2/consumerOption/ranking.svg"),type:d.INTERNL,url:"/talentRankingV1?type=2&cycleType=2"}]);return(m,N)=>(y(),$(j,null,[n("div",et,[(y(!0),$(j,null,ce(o(h),(t,r)=>(y(),$("div",{class:"w-[25%] flex flex-col items-center",style:pe(r<Math.floor((o(h).length-1)/4)*4?"margin-bottom: 16px":""),key:r,onClick:()=>f("handleMenu",t)},[n("div",ot,[n("img",{class:"shrink-0 w-[24px] h-[24px]",src:t.img,alt:""},null,8,st),t.url==="/postList"&&+a.unreadCount.totalUnread>0?(y(),$("div",nt,v(w(a.unreadCount.totalUnread)),1)):A("",!0),t.url==="/orderMessage?type=1"&&+a.messageCount.totalUnread>0?(y(),$("div",at,v(w(a.messageCount.totalUnread)),1)):A("",!0)]),n("div",rt,v(t.text),1)],12,tt))),128))]),n("div",lt,[(y(!0),$(j,null,ce(o(C),(t,r)=>(y(),$("div",{class:"w-[25%] flex flex-col items-center",style:pe(r<Math.floor((o(C).length-1)/4)*4?"margin-bottom: 16px":""),key:r,onClick:()=>f("handleMenu",t)},[n("div",ut,[n("img",{class:"shrink-0 w-[24px] h-[24px]",src:t.img,alt:""},null,8,ct)]),n("div",pt,v(t.text),1)],12,it))),128))])],64))}}),ft=V(dt,[["__scopeId","data-v-e8303342"]]),mt=D({emits:["handleTo","handleReplace","handleMenu"],setup(a,{expose:f,emit:s}){const w=me(),{accountStore:h}=q(),C=S({afterSales:0,completed:0,toBeDelivered:0,waitingForReceipt:0}),m=async()=>{const c=await De({type:2});c.success&&(C.value=c.data)},N=S({afterSales:0,completed:0,toBeDelivered:0,waitingForReceipt:0}),t=async()=>{var _;const c=await Ue({orderCustomerAddress:h.account||((_=h.sign)==null?void 0:_.address)});c.success&&(N.value=c.data)},r=S({versionUnread:0,platformUnread:0,totalUnread:0}),i=async()=>{const c=await He();c.success&&(r.value=c.data)},p=S({}),l=async()=>{const c=await Ve({type:1});c.success&&(p.value=c.data)},b=c=>{c==="online"?m():c==="offline"&&t()};return f({init:async()=>{var _;console.log("consumer init");const c=((_=w.query)==null?void 0:_.tab)||"online";b(c),i(),l()}}),(c,_)=>(y(),$(j,null,[x(Me,{activeTab:o(T).CONSUMER,orderCount:C.value,offlineOrderCount:N.value,onHandleTo:_[0]||(_[0]=R=>s("handleTo",R)),onHandleReplace:_[1]||(_[1]=(R,U)=>s("handleReplace",R,U)),onUpdateOrderData:b},null,8,["activeTab","orderCount","offlineOrderCount"]),x(ft,{unreadCount:r.value,messageCount:p.value,onHandleMenu:_[2]||(_[2]=R=>s("handleMenu",R))},null,8,["unreadCount","messageCount"])],64))}}),vt=a=>(ve("data-v-2c4ddcca"),a=a(),he(),a),ht={class:"w-[85vw] max-w-[375px] px-5 py-6 bg-popBg"},gt={class:"pb-5 flex-center-bw"},xt={class:"flex-start"},yt=vt(()=>n("img",{src:qe,class:"w-[10px] h-[10px]",alt:""},null,-1)),wt=[yt],Ct=k("%"),_t={class:"mt-5 flex-center"},It=D({props:{show:{type:Boolean}},emits:["close"],setup(a,{emit:f}){const{show:s}=a,{t:w}=Z(),{accountStore:h}=q(),{loadingToggle:C}=Be(),[m,N]=L(!1),t=S(0),r=async()=>{C(!0);const l=await W(h.account);l.success&&l.data&&(t.value=l.data.discountRatio),C(!1)},i=l=>l>80?80:l,p=async()=>{if(!Number(t.value)){G.fail(w("common.pleaseInput"));return}N(!0),(await Le({discountRatio:t.value})).success&&(N(!1),f("close"),setTimeout(()=>{r()},1e3))};return Q(()=>{r()}),(l,b)=>{const E=P("van-field"),c=P("VanButton"),_=P("VanPopup");return y(),H(_,{show:a.show,"onUpdate:show":b[2]||(b[2]=R=>Re(s)?s.value=R:null),round:""},{default:O(()=>[n("div",ht,[n("div",gt,[n("div",xt,[n("span",null,v(l.$t("common.ratiodEdit")),1)]),n("div",{onClick:b[0]||(b[0]=R=>f("close"))},wt)]),n("div",null,[x(E,{class:"bg-gray1 rounded-3xl","input-align":"center",modelValue:t.value,"onUpdate:modelValue":b[1]||(b[1]=R=>t.value=R),type:"digit",placeholder:l.$t("shop.pleaseInputPoint"),formatter:i,disabled:o(m)},{"right-icon":O(()=>[Ct]),_:1},8,["modelValue","placeholder","disabled"]),n("div",_t,[x(c,{class:"px-20 font-bold text-white h-9 btn-orange",onClick:p,loading:o(m)},{default:O(()=>[k(v(l.$t("common.edit")),1)]),_:1},8,["loading"])])])])]),_:1},8,["show"])}}}),St=V(It,[["__scopeId","data-v-2c4ddcca"]]),bt=a=>(ve("data-v-720e2866"),a=a(),he(),a),Nt={class:"flex flex-col items-center justify-center"},$t={class:"text-sm"},Rt={class:"text-primary"},Tt=k(" 嘗試遷移店舖信息至您的地址 "),Ot={class:"text-primary"},Et=k(" 是否同意遷移。 "),Ft={key:0,class:"border border-primary rounded-lg p-2.5 mt-4 bg-[#FFFAF4] flex items-start"},Mt=bt(()=>n("div",{class:"text-xs opacity-70 ml-1.5 leading-5"}," 監測到當前地址下有店舖信息，同意遷移將合併新舊店舖信息 ",-1)),kt={class:"flex items-center justify-center w-full gap-3 mt-4"},At={key:1,class:"mt-3 text-xs font-normal"},Bt=D({props:{show:{type:Boolean},info:null},emits:["close"],setup(a,{emit:f}){const s=a,{accountStore:w}=q(),h=s.info[0].shop,C=S(null),m=async()=>{var l;const{data:i,success:p}=await Je((h==null?void 0:h.id)||((l=s.info[0])==null?void 0:l.id));p&&(C.value=i)},N=S(-1),t=async i=>{var l;if(await m(),C.value&&i!==3){G("已經遷移過，請勿重複操作");return}(await Ge({id:(l=s.info[0])==null?void 0:l.id,status:i})).success&&(i===3?G("拒绝成功"):G("同意成功"),i===3?f("close",i):f("close"))},r=async()=>{var p;const i=await W(((p=w.store)==null?void 0:p.merchant)||w.account);i.success&&i.data&&(N.value=i.data.status)};return Q(()=>{r()}),(i,p)=>{const l=P("van-icon"),b=P("VanButton");return y(),H(xe,{show:a.show,noBorder:!0,noClose:!0,onClose:p[2]||(p[2]=()=>{f("close")})},{default:O(()=>{var E;return[n("div",Nt,[n("div",$t,[n("span",Rt,v((E=o(h))==null?void 0:E.storeName),1),Tt,n("span",Ot,v(o(ge)(o(w).account)),1),Et]),N.value===1?(y(),$("div",Ft,[x(l,{name:"warning",color:"#FEA021",size:"18"}),Mt])):A("",!0),n("div",kt,[x(b,{round:"",class:"border border-solid border-[#CDCDCD] h-[40px] w-full flex-1 font-medium text-sm",onClick:p[0]||(p[0]=c=>t(3))},{default:O(()=>[n("span",null,v(i.$t("common.reject")),1)]),_:1}),x(b,{round:"",class:"btn-yellow h-[40px] w-full flex-1 font-semibold text-sm",onClick:p[1]||(p[1]=c=>t(2))},{default:O(()=>[k(v(i.$t("common.agree")),1)]),_:1})]),a.info.length>0?(y(),$("div",At,v(i.$t("user.migrate length",{num:a.info.length})),1)):A("",!0)])]}),_:1},8,["show"])}}}),Lt=V(Bt,[["__scopeId","data-v-720e2866"]]),Pt={class:"flex flex-col items-center justify-center"},Dt={class:"text-sm"},Ut={class:"text-primary"},Ht={class:"text-primary"},Vt={key:0,class:"border border-primary rounded-lg p-2.5 mt-4 bg-[#FFFAF4] flex items-start"},qt={class:"text-xs opacity-70 ml-1.5 leading-5"},zt={class:"w-full flex items-center justify-center gap-3 mt-4"},jt={key:1,class:"text-xs font-normal mt-3"},Gt=D({props:{show:{type:Boolean},approveInfo:null,approveIndex:null},emits:["close"],setup(a,{emit:f}){const s=a,{accountStore:w}=q(),h=s.approveInfo[s.approveIndex].shop,C=S(-1),m=async t=>{(await Qe({id:s.approveInfo[s.approveIndex].id,status:t})).success&&(t===3?f("close",t):f("close"))},N=async()=>{var r;const t=await W(((r=w.store)==null?void 0:r.merchant)||w.account);t.success&&t.data&&(C.value=t.data.status)};return Q(()=>{N()}),(t,r)=>{const i=P("van-icon"),p=P("VanButton");return y(),H(xe,{show:a.show,noBorder:!0,noClose:!0,onClose:r[2]||(r[2]=()=>{f("close")})},{default:O(()=>[n("div",Pt,[n("div",Dt,[n("span",Ut,v(o(h).storeName),1),k(" "+v(t.$t("user.use tips"))+" ",1),n("span",Ht,v(o(ge)(o(w).account)),1),k(" "+v(t.$t("user.approveShop")),1)]),C.value===1?(y(),$("div",Vt,[x(i,{name:"warning",color:"#FEA021",size:"18"}),n("div",qt,v(t.$t("user.approve shop tips2")),1)])):A("",!0),n("div",zt,[x(p,{round:"",class:"border border-solid border-[#CDCDCD] h-[40px] w-full flex-1 font-medium text-sm",onClick:r[0]||(r[0]=l=>m(3))},{default:O(()=>[n("span",null,v(t.$t("common.reject")),1)]),_:1}),x(p,{round:"",class:"btn-yellow h-[40px] w-full flex-1 font-semibold text-sm",onClick:r[1]||(r[1]=l=>m(2))},{default:O(()=>[k(v(t.$t("common.agree")),1)]),_:1})]),a.approveInfo.length>0?(y(),$("div",jt,v(t.$t("user.approve length",{num:a.approveInfo.length})),1)):A("",!0)])]),_:1},8,["show"])}}}),Jt=V(Gt,[["__scopeId","data-v-57d700dc"]]),Qt={class:"linear-bg"},Xt={class:"mt-[16px] w-full z-[10] overflow-hidden px-[12px]"},Kt={class:"flex items-start gap-[24px]"},Yt=D({name:"Profile"});function Zt(a){const{t:f}=Z(),s=Te(),w=me(),{accountStore:h}=q(),[C,m]=L(!1),[N,t]=L(!1),[r,i]=L(!1),[p,l]=L(!1),[b,E]=L(!1),[c,_]=L(!1),{isUserExists:R}=Pe();Oe(()=>w.path,(e,u)=>{u==="/clerk/index"&&e==="/profile"&&K()});const U=S(null),z=S(null),ee=S(0),ye=()=>{t(!1),i(!0)},X=Ee({userInfo:{address:h.account}}),we=J(()=>[{id:T.CONSUMER,name:f("common.consumerSide")},{id:T.MERCHANT,name:f("common.merchantSide")}]),F=J(()=>{var e;return((e=w.query)==null?void 0:e.path)??T.CONSUMER}),te=S(!1),Ce=e=>{e.id!==F.value&&(e.id===T.MERCHANT&&fe(),localStorage.setItem("profile_query",JSON.stringify({path:e.id})),s.push(`/profile?path=${e.id}`),te.value=!0,setTimeout(()=>{te.value=!1,ue()},500))},B=e=>{s.push(e)},oe=(e,u)=>{localStorage.setItem("profile_query",JSON.stringify(u)),s.replace({path:e,query:u})},_e=()=>{m(!1),se()},Ie=()=>{E(!1),K()},se=async()=>{var u,I;const e=await Xe({type:2,page:1,size:99});U.value=(u=e.data)==null?void 0:u.filter(M=>M.status===1).reverse(),((I=U.value)==null?void 0:I.length)>0&&(m(!0),ee.value=0)},Se=async()=>{var u,I,M;const e=await Ye({type:2,page:1,size:99});if(((u=e.data)==null?void 0:u.findIndex(Y=>Y.status===2))>-1){z.value=[];return}z.value=(I=e.data)==null?void 0:I.filter(Y=>Y.status===1).reverse(),((M=z.value)==null?void 0:M.length)>0&&E(!0)},ne=async e=>{if(e.type===d.INTERNL&&e.url)return B(e.url);if(e.type===d.OPTIONS){if(e.key==="invite"&&i(!0),e.key==="level"&&t(!0),e.key==="ratio"&&l(!0),e.key==="concat"&&B("/concat"),e.key==="nft"){if(ae.value)return B("/matrixNFT");_(!0)}}else e.type===d.EXTERNAL&&e.url&&window.open(e.url,"_blank")},be=async()=>{const e=await Ke(h.account);!e.success||!e.data||(X.userInfo=e.data)},ae=S(!1),re=async()=>{const e=await R();ae.value=e},Ne=()=>{re(),B("/matrixNFT")},$e=S(!1),le=S(null),ie=S(null),ue=async()=>{var e,u;F.value===T.CONSUMER?(e=le.value)==null||e.init():(u=ie.value)==null||u.init()},K=async()=>{await h.changeStore({}),$e.value=!0,await be(),se(),Se(),re(),F.value===T.MERCHANT&&fe()};return Q(async()=>{}),Fe(()=>{console.log("onActivated"),K(),ue()}),(e,u)=>(y(),$("div",Qt,[x(ke,{info:o(X).userInfo,active:o(F),"tab-list":o(we),onChangeTab:Ce,onSetLevelShow:u[0]||(u[0]=I=>o(t)(!0))},null,8,["info","active","tab-list"]),n("div",Xt,[n("div",Kt,[n("div",{class:de(["shrink-0 w-full transition delay-0 duration-500 ease-in-out",{"consumer-in-merchant-out":o(F)===o(T).CONSUMER,"consumer-out-merchant-in":o(F)===o(T).MERCHANT}])},[x(mt,{ref:(I,M)=>{M.ConsumerRef=I,le.value=I},onHandleTo:B,onHandleMenu:ne,onHandleReplace:oe},null,512)],2),n("div",{class:de(["shrink-0 w-full transition delay-0 duration-500 ease-in-out",{"consumer-out-merchant-in":o(F)===o(T).MERCHANT,"consumer-in-merchant-out":o(F)===o(T).CONSUMER}])},[x(Ae,{ref:(I,M)=>{M.MerchantRef=I,ie.value=I},onHandleTo:B,onHandleMenu:ne,onHandleReplace:oe},null,512)],2)]),x(ze,{show:o(N),userInfo:o(X).userInfo,onClose:u[1]||(u[1]=I=>o(t)(!1)),onInvite:ye,onHandleTo:B},null,8,["show","userInfo"]),x(je,{show:o(r),onClose:u[2]||(u[2]=I=>o(i)(!1))},null,8,["show"]),x(St,{show:o(p),onClose:u[3]||(u[3]=I=>o(l)(!1))},null,8,["show"]),o(C)?(y(),H(Jt,{key:0,show:o(C),approveInfo:U.value,approveIndex:ee.value,onClose:_e},null,8,["show","approveInfo","approveIndex"])):A("",!0),o(b)?(y(),H(Lt,{key:1,show:o(b),info:z.value,onClose:Ie},null,8,["show","info"])):A("",!0),x(Ze,{"title-text":o(f)("common.recommend_for_you")},null,8,["title-text"]),x(We,{show:o(c),onClose:u[4]||(u[4]=I=>o(_)(!1)),onOnSuccess:Ne},null,8,["show"])])]))}const Wt=D({...Yt,setup:Zt}),Fo=V(Wt,[["__scopeId","data-v-05054e29"]]);export{Fo as default};
