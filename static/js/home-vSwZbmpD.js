import{a as st,_ as ot}from"./2year-CGzECoRg.js";import{_ as at}from"./adpng-DqTFHGH_.js";import{_ as R,G as h,H as u,I as o,Q as nt,X as W,Y as j,z as it,q as ct,o as lt,bB as C,r as A,y as rt,bm as dt,F as L,P as I,Z as $,U as Y,V as mt,$ as D,J as E,K as H,O as f,aL as ut,j as v,T as m}from"./vendor-Dr_RpJ_Y.js";import{u as pt,a as ft,h as B}from"./index-CU2nzZe6.js";import{G as _t}from"./goodsItem-Zy73jSwe.js";import{c as gt,a as vt,h as ht,i as yt}from"./festivalActivities-wtUPnacj.js";import{_ as M}from"./EmptyTipsPop-DC2OBzZY.js";import"./MCOIN-BOqZVkND.js";const wt="/static/images/cloud-Bm1cgOa4.png",xt="/static/images/more-E9N74XOk.svg",bt="/static/images/left-flash-COSh5QZ9.svg",kt="/static/images/right-flash-DBRaslZc.svg",q=r=>(W("data-v-67fd3e7e"),r=r(),j(),r),Ct={class:"tag__wrap"},At=q(()=>o("img",{src:bt,alt:""},null,-1)),It={class:"text-b6 text-base font-semibold leading-4"},$t=q(()=>o("img",{src:kt,alt:""},null,-1)),Gt={props:{name:{type:String,default:""}},setup(r){return(g,k)=>(u(),h("div",Ct,[At,o("span",It,nt(r.name),1),$t]))}},St=R(Gt,[["__scopeId","data-v-67fd3e7e"]]),_=r=>(W("data-v-5d6f14df"),r=r(),j(),r),Tt={class:"active-container"},Lt=_(()=>o("img",{class:"header-bottom",src:wt},null,-1)),Yt=_(()=>o("img",{class:"w-[22px] h-[22px]",src:st,alt:"返回"},null,-1)),Dt=[Yt],Et={class:"body__wrap"},Ht=_(()=>o("span",{class:"text-[20px] text-b6 font-Puhui"}," 我要报名 ",-1)),Bt={class:"goods-list-container"},Mt={class:"goods-grid"},Rt=["onClick"],Wt=_(()=>o("span",{class:"text-[#FF8812] text-sm font-normal"},"查看更多",-1)),jt=_(()=>o("img",{src:xt,class:"w-5 h-5"},null,-1)),qt=[Wt,jt],Ot=_(()=>o("div",{class:"px-[65px] w-full flex justify-center items-center pt-5"},[o("img",{class:"logo-2-year",src:ot,alt:"2周年"})],-1)),Pt=_(()=>o("img",{src:at,alt:"广告"},null,-1)),Ft=[Pt],Nt=it({name:"520Home"});function Vt(r){pt();const g=ct(),k=lt(),[O,G]=C(!1),[P,S]=C(!1),[F,T]=C(),d=A({fmGeneralActivity:{},fmGeneralActivityLabelList:[],fmGeneralActivityRule:{}}),{accountStore:N}=ft();rt(()=>N.store.id);const V=async()=>{const e={generalActivityId:1};try{const t=await vt(e);t.code==1?(d.value=t.data,J(),U(),z()):t.message&&m(t.message)}catch(t){console.error("获取活动信息失败:",t),m("获取活动信息失败")}},z=()=>{var a,s;const e=v(),t=v((s=(a=d.value)==null?void 0:a.fmGeneralActivity)==null?void 0:s.endTime);e.isAfter(t)&&S(!0)},J=()=>{var t,a;const e=(a=(t=d.value)==null?void 0:t.fmGeneralActivity)==null?void 0:a.name;e&&(document.title=e)},y=A({}),U=()=>{var t,a,s,n;const e=((a=(t=d.value)==null?void 0:t.fmGeneralActivity)==null?void 0:a.activityMallImgs)||((n=(s=d.value)==null?void 0:s.fmGeneralActivity)==null?void 0:n.activityMainImgs)||"";if(e){const c=e.split(",")[0];y.value={backgroundImage:`url(${c})`};const l=new Image;l.onload=()=>{const i=l.naturalWidth,p=l.naturalHeight;if(i>0&&p>0){const x=document.documentElement.clientWidth>=375?375:document.documentElement.clientWidth,b=p/i*x;y.value={...y.value,height:`${b}px`}}},l.onerror=()=>{console.log("活动主图图片加载失败")},l.src=c}},w=A([]),Z=async()=>{try{const e=await ht();if(e.code==1&&e.data){const t=e.data||[],a=await Promise.all(t.map(async s=>{var c,l;const n={generalActivityId:((l=(c=d.value)==null?void 0:c.fmGeneralActivity)==null?void 0:l.id)||1,generalActivityClassifyId:s.id,status:2};try{const i=await yt(n);if(i.code==1&&i.data){const p=i.data.slice(0,4)||[];return{...s,goodsList:p}}else return i.message&&i.code!==1&&console.warn(`获取分类 ${s.name} 商品列表提示: ${i.message}`),{...s,goodsList:[]}}catch(i){return console.error(`获取分类 ${s.name} 的商品列表失败:`,i),{...s,goodsList:[]}}}));w.value=a.filter(s=>s.goodsList&&s.goodsList.length>0)}else e.message&&m(e.message),w.value=[]}catch(e){console.error("获取分类或商品列表过程中发生错误:",e),m("加载数据失败"),w.value=[]}},Q=()=>{const e="https://metakey.pro/invite?code=cngkfc1i";B(e),ut.confirm({title:"群聊链接",message:"群聊链接已复制，请在手机浏览器打开",showCancelButton:!1}).then(()=>{B(e)})},X=e=>{const t={...e};Reflect.deleteProperty(t,"goodsList"),g.push({path:"520-classify",query:{id:t.id,name:t.name}})},K=()=>{var e,t;((t=(e=window.history)==null?void 0:e.state)==null?void 0:t.back)===null?g.replace({path:"/"}):g.back()},tt=async()=>{var s,n,c,l,i,p,x,b;const e={needlogin:"true",...k.query};g.replace({path:k.path,query:e});const t=new Date().getTime();if(console.log("当前时间",v(t).format("YYYY-MM-DD HH:mm:ss")),console.log("后台配置的报名开始时间",v((n=(s=d.value)==null?void 0:s.fmGeneralActivity)==null?void 0:n.applyStartTime).format("YYYY-MM-DD HH:mm:ss")),console.log("后台配置的报名结束时间",v((l=(c=d.value)==null?void 0:c.fmGeneralActivity)==null?void 0:l.applyEndTime).format("YYYY-MM-DD HH:mm:ss")),t<((p=(i=d.value)==null?void 0:i.fmGeneralActivity)==null?void 0:p.applyStartTime)){m("报名时间未开始");return}if(t>((b=(x=d.value)==null?void 0:x.fmGeneralActivity)==null?void 0:b.applyEndTime)){m("报名时间已结束");return}m.loading({message:"查询中..."});const a=await gt();if(a.code==1&&!a.data){m.clear(),T(!0);return}else a.code==1&&a.data&&setTimeout(()=>{m.clear(),g.push({path:"/520-index",query:{from:"fm"}})},500)},et=async()=>{await V()};return dt(()=>{Z()}),et(),(e,t)=>{const a=L("van-button"),s=L("van-overlay");return u(),h("div",Tt,[o("div",{class:"header__wrap",style:mt(y.value)},[o("div",{class:"join-im-btn",onClick:Q},"活动讨论"),Lt,o("div",{class:"back-arrow w-[22px] h-[22px] absolute top-[11px] left-[9px]",onClick:K},Dt)],4),o("div",Et,[o("div",{class:"btn__wrap w-full",onClick:tt},[I(a,{class:"submit-btn"},{default:D(()=>[Ht]),_:1})]),(u(!0),h(E,null,H(w.value,n=>(u(),h("div",{class:"classify-group pb-3 pt-9",key:n.id},[I(St,{name:n.name},null,8,["name"]),o("div",Bt,[o("div",Mt,[(u(!0),h(E,null,H(n.goodsList,c=>(u(),$(_t,{key:c.id,goods:c},null,8,["goods"]))),128))])]),o("div",{class:"view-more-btn flex justify-center items-center mt-2",onClick:c=>X(n)},qt,8,Rt)]))),128)),Ot]),I(s,{show:f(O),onClick:t[1]||(t[1]=n=>f(G)(!1)),"z-index":"9999"},{default:D(()=>[o("div",{class:"ad-img-container",onClick:t[0]||(t[0]=n=>f(G)(!1))},Ft)]),_:1},8,["show"]),f(P)?(u(),$(M,{key:0,isError:!0,onClose:t[2]||(t[2]=n=>f(S)(!1)),text:"很遗憾，活动已过期"})):Y("",!0),f(F)?(u(),$(M,{key:1,isError:!0,onClose:t[3]||(t[3]=n=>f(T)(!1)),text:"很遗憾根据您店铺以往数据综合评估暂不符合报名资质要求"})):Y("",!0)])}}const zt=Object.assign(Nt,{setup:Vt}),se=R(zt,[["__scopeId","data-v-5d6f14df"]]);export{se as default};
