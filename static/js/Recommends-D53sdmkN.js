import{z as D,x as Y,o as le,q as oe,D as de,r as c,F as H,Z as G,H as o,$ as E,G as r,U as V,bj as O,bk as K,P as I,I as a,J as z,K as U,T as J,O as P,Q as L,E as ne,bA as ve,a3 as he,_ as ie,X as ce,Y as re,y as X,N as Q,a4 as me,bC as Z,bl as fe,V as ge}from"./vendor-Dr_RpJ_Y.js";import{_ as pe,a as ye,b as xe}from"./GoodsItem-BZ7xTQ5M.js";import{b as we,c as ke,d as ee}from"./mall-B6FBC7ih.js";import{W as Te}from"./WaterFull-BoFTr9ol.js";import{ar as be,w as Se,as as _e,k as W,a as Pe}from"./index-LRhcxFAI.js";import{_ as $e}from"./MCOIN-Bodfn-v1.js";import{_ as Ie}from"./ImgBoutiqueLable-B-2xCcw4.js";import{R as Ce}from"./RatioBox-n6itzF1h.js";import{M as Le,_ as Re}from"./MetaKeyTag-CJO7WOLL.js";import{R as te}from"./rangking-soiwLY3n.js";const Ae={key:0},Fe=D({name:"mallGoodsList"});function Be(e,{expose:T,emit:u}){const t=e,{t:m}=Y(),y=be(),h=le(),x=oe();de(()=>t.viewFormat,n=>{n===1&&console.log(n)},{deep:!0});const s=c([]),k=c(!1),w=c(!1),d=c(0),R=c(10),A=c(0),b=c([]),_=c(0),N=c,f=async()=>{t.isSearchPage&&!t.searchParam.keyword&&!t.searchParam.classId||(k.value=!0,d.value+=1,await l(),setTimeout(()=>{k.value=!1},1e3))},l=async()=>{var S,B,j,i,$;let n={page:d.value,size:R.value,status:1,...t.searchParam,sortType:t.sortType,deleteFlag:!1},v;if(t.sortType==="Algorithm"?(delete n.sortType,v=await we(n)):v=await ke(n),!v.success){w.value=!0;return}if(!v.data||!v.total||!((S=v.data)!=null&&S.length)){w.value=!0;return}if(A.value=v.total,b.value=v.data.map(g=>({goods:g.goods,stores:g.stores||N,card:g.card})),d.value===1&&!t.isSearchPage){const g={activeType:1,activePath:"/boutique-goods",activeImg:W("images/activity/advertise/Boutique.png"),activeImgGrid:W("images/activity/advertise/Boutique-grid.png")};_.value+=1,b.value.unshift(g)}if(d.value===2&&((B=t.activeInfo)!=null&&B.id)){const g={activeType:1,activePath:(j=t.activeInfo)==null?void 0:j.url,activeImg:((i=t.activeInfo)==null?void 0:i.activityListImgs)||null,activeImgGrid:(($=t.activeInfo)==null?void 0:$.activityWaterfallImgs)||null,...t.activeInfo};b.value.unshift(g),_.value+=1}s.value=d.value===1?b.value:s.value.concat(b.value),s.value.length-_.value>=A.value&&(w.value=!0)},{loadingToggle:C}=Se(),F=async n=>{const v={needlogin:"true",...h.query};if(x.replace({path:h.path,query:v}),n.stock===0&&n.goodsTypes!=2){J(m("order.Insufficient stock"));return}C(!0);const S=await _e(n.id);C(!1),S.success&&(u("successAdd"),J(m("cart.addTips")),y.getCartCount())};return T({handleSearch:async()=>{s.value=[],d.value=0,A.value=0,_.value=0,w.value=!1,document.querySelector("#fm-page").scrollTo(0,0),await f()},list:s}),(n,v)=>{const S=H("VanList");return o(),G(S,{loading:k.value,"onUpdate:loading":v[2]||(v[2]=B=>k.value=B),finished:w.value,"finished-text":n.$t("common.noMore"),"loading-text":n.$t("common.loading"),onLoad:f},{default:E(()=>[s.value.length>0?(o(),r("div",Ae,[O(I(Te,{isSearchPage:e.isSearchPage,value:b.value,addTime:200,cardComponent:pe,onHandleTo:v[0]||(v[0]=B=>u("handleTo",B)),onHandleAddCart:F},null,8,["isSearchPage","value"]),[[K,e.viewFormat===0]]),O(a("div",null,[(o(!0),r(z,null,U(s.value,(B,j)=>(o(),G(ye,{key:j,data:B,onClick:()=>u("handleTo",`${e.goodsPath}?id=${B.goods.id}`),onHandleTo:v[1]||(v[1]=i=>u("handleTo",i)),onHandleAddCart:F},null,8,["data","onClick"]))),128))],512),[[K,e.viewFormat===1]])])):V("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}const qe=D({...Fe,props:{searchParam:{default:()=>({keyword:"",sortType:1,orderBy:1,classId:null})},sortType:null,goodsPath:{default:"/goodsDetail"},viewFormat:{default:0},isSearchPage:{type:Boolean,default:!1},activeInfo:null},emits:["handleTo","successAdd"],setup:Be}),Ve=""+new URL("../images/shop-more-CVTCr4GK.png",import.meta.url).href,Ne=""+new URL("../images/good-hot-DcLXI72v.png",import.meta.url).href,Ge=""+new URL("../images/card-DHSisX3c.png",import.meta.url).href,ze={key:0,class:"flex items-center justify-center"},De=["src"],Me={class:"bg-[#FFF1D6] rounded-2xl text-xxs font-bold py-0.5 px-2 pl-3.5"},He=D({props:{rankNum:null,type:{default:te.SR}},setup(e){return(T,u)=>(o(),r("div",null,[+e.rankNum>0?(o(),r("div",ze,[a("img",{src:P(W)(`images/shop/rank${e.rankNum>3?4:e.rankNum}.png`),class:"inline-block w-[14px] h-[16px] -mr-2 z-10"},null,8,De),a("div",Me,L(e.type===P(te).EBR?T.$t("ranking.ecology boost",{num:e.rankNum}):T.$t("ranking.recently hot sales",{num:e.rankNum})),1)])):V("",!0)]))}}),Ue={class:"relative"},je={class:"flex items-start w-full"},Ee={class:"relative w-[85px] h-[85px] flex-shrink-0 bg-black-100 overflow-hidden rounded-lg"},Oe={class:"object-cover w-full h-full aspect-square",fit:"cover"},We={class:"flex flex-col items-start justify-between w-[calc(100%-85px-1rem)] ml-4 text-sm"},Ke={class:"flex items-center w-full text-sm font-semibold text-black-900"},Xe={class:"mr-2 truncate"},Ye={class:"flex-shrink-0 ml-auto"},Qe={class:"flex w-full mt-1 text-xs text-primary"},Je={class:"self-start mr-3 flex-center text-black-400"},Ze={class:"ml-1"},et={class:"mt-2.5 min-h-[17px] flex items-center gap-2"},tt={key:0,class:"flex flex-col gap-2.5 mt-3 w-full"},at=["onClick"],st=a("img",{src:Ne,class:"flex-shrink-0 w-3 h-3"},null,-1),lt={class:"truncate text-xs text-[#999] mx-1"},ot={class:"flex-shrink-0 ml-auto"},nt={key:0,class:"text-xs font-bold text-black flex-center-bw min-w-fit"},it=a("div",{class:"gray-ball font-normal mr-0.5"},[a("img",{class:"w-4 h-4",src:Ge})],-1),ct={class:""},rt={key:1,class:"flex text-xs font-bold text-black min-w-fit"},ut=a("div",{class:"mr-1 gray-ball"},[a("img",{class:"w-4 h-4",src:$e})],-1),dt=a("div",{class:"flex items-center h-2.5"},null,-1),vt=D({props:{shop:null,goods:null},emits:["handleTo","click"],setup(e,{emit:T}){const u=e,t=c(0),m=async()=>{var y;t.value=((y=u.shop)==null?void 0:y.discountRatio)||0};return ne(()=>{m()}),(y,h)=>{var k,w;const x=H("van-rate"),s=ve("lazy");return o(),r(z,null,[a("div",{class:"rounded bg-white p-2.5",onClick:h[1]||(h[1]=d=>T("click"))},[a("section",Ue,[a("div",je,[a("div",Ee,[O(a("img",Oe,null,512),[[s,e.shop.logo||P(W)("images/goods/defaultImg.png")]]),e.shop.type?(o(),G(Ie,{key:0,type:e.shop.type},null,8,["type"])):V("",!0)]),a("div",We,[a("div",Ke,[a("div",Xe,L(e.shop.storeName),1),a("div",Ye,[I(Ce,{tag:y.$t("common.rebate"),ratio:e.shop.discountRatio||0},null,8,["tag","ratio"])])]),a("div",Qe,[a("span",Je,L(y.$t("mall.15th sale",{salesVolume:e.shop.volume15||0})),1),I(x,{class:"flex-shrink-0",readonly:"","allow-half":"",modelValue:e.shop.star,"onUpdate:modelValue":h[0]||(h[0]=d=>e.shop.star=d),size:16,gutter:"0",color:"#FEA021"},null,8,["modelValue"]),a("span",Ze,L(e.shop.star),1)]),a("div",et,[(k=e.shop)!=null&&k.ranking?(o(),G(He,{key:0,class:"shrink-0","rank-num":(w=e.shop)==null?void 0:w.ranking},null,8,["rank-num"])):V("",!0),e.shop.metakeyFlag?(o(),G(Le,{key:1})):V("",!0),I(Re,{type:e.shop.buyFlag?1:e.shop.watchFlag?2:e.shop.followFlag?3:0},null,8,["type"])]),e.goods&&e.goods.length>0?(o(),r("section",tt,[(o(!0),r(z,null,U(e.goods,d=>(o(),r("div",{class:"flex items-center",key:d.id,onClick:he(()=>T("handleTo",`/goodsDetail?id=${d.id}`),["stop","prevent"])},[st,a("span",lt,L(d.goodsName),1),a("div",ot,[d.payType===2||d.payType===3?(o(),r("div",nt,[it,a("div",ct,L(d.cardPrice)+L(d.symbol),1)])):(o(),r("div",rt,[ut,a("div",null,L(d.price)+"Mcoin",1)]))])],8,at))),128))])):V("",!0)])])])]),dt],64)}}}),ht=e=>(ce("data-v-56c7ba01"),e=e(),re(),e),mt={key:0,class:"relative lieanr-bg rounded-xl mb-2.5"},ft=ht(()=>a("img",{src:Ve,class:"w-full h-full"},null,-1)),gt=[ft],pt={class:"pt-[45px] px-4"},yt=["onClick"],xt=["src"],wt={class:"absolute bottom-0 left-0 z-10 w-full flex-center bg-black-linear"},kt={class:"text-white text-sm font-bold text-center h-[20px] line-clamp-1 mt-1"},Tt=D({props:{searchParam:{default:()=>({keyword:null,sortType:null,orderBy:null})},sortType:null,shopPath:{default:"/category"},isSearchPage:{type:Boolean,default:!1},activeInfo:null},emits:["handleTo"],setup(e,{expose:T,emit:u}){const t=e,m=c([]),y=c(!1),h=c(!1),x=c(0),s=c(10),k=c(0),w=c([]),d=c(0),R=async()=>{y.value=!0,x.value+=1,await A(),y.value=!1},A=async()=>{var l,C,F,M;const f=await ee({page:x.value,size:s.value,...t.searchParam,sortType:t.sortType});if(y.value=!1,!f.success){h.value=!0;return}if(!f.data||!f.total){h.value=!0;return}if(k.value=f.total,w.value=f.data||[],x.value===2&&((l=t.activeInfo)!=null&&l.id)){const n={activeType:1,activePath:(C=t.activeInfo)==null?void 0:C.url,activeImg:((F=t.activeInfo)==null?void 0:F.activityListImgs)||null,activeImgGrid:((M=t.activeInfo)==null?void 0:M.activityWaterfallImgs)||null,...t.activeInfo};d.value+=1,w.value.unshift(n)}m.value=x.value===1?w.value:m.value.concat(w.value),m.value.length-d.value>=k.value&&(h.value=!0)},b=c([]),_=async()=>{const{success:f,data:l}=await ee({page:1,size:12,sortType:null,orderBy:1,boutiqueFlag:!0});f&&(b.value=l||[])},N=async()=>{m.value=[],x.value=0,k.value=0,d.value=0,h.value=!1,await R()};return ne(()=>{_()}),T({handleSearch:N,list:m}),(f,l)=>{const C=H("van-swipe-item"),F=H("van-swipe"),M=H("VanList");return o(),r("div",null,[e.isSearchPage?V("",!0):(o(),r("div",mt,[a("div",{class:"w-[49px] h-[21px] absolute top-[15px] right-[9px]",onClick:l[0]||(l[0]=n=>u("handleTo","/boutique-shop"))},gt),a("div",pt,[I(F,{loop:!1,width:"95","show-indicators":!1},{default:E(()=>[(o(!0),r(z,null,U(b.value,n=>(o(),G(C,{key:n.id,class:""},{default:E(()=>[a("div",{onClick:v=>{var S;return u("handleTo",`/category?deliveryType=1&shopId=${(S=n.stores)==null?void 0:S.id}`)},class:"mr-[10px] rounded-xl border-[2px] w-[89px] h-[89px] border-white overflow-hidden relative"},[a("img",{class:"flex-shrink-0 object-cover w-full h-full aspect-square",src:n&&n.stores&&n.stores.logo||P(W)("images/activity/boutique/active_empty.png")},null,8,xt),a("div",wt,[a("span",kt,L(n.stores.storeName||f.$t("avtivity.check")),1)])],8,yt)]),_:2},1024))),128))]),_:1})])])),I(M,{loading:y.value,"onUpdate:loading":l[3]||(l[3]=n=>y.value=n),finished:h.value,"finished-text":f.$t("common.noMore"),"loading-text":f.$t("common.loading"),onLoad:R},{default:E(()=>[(o(!0),r(z,null,U(m.value,(n,v)=>(o(),r(z,{key:v},[n!=null&&n.activeType?(o(),G(xe,{key:0,info:n,onHandleTo:l[1]||(l[1]=S=>u("handleTo",S)),class:"mb-2.5"},null,8,["info"])):(o(),G(vt,{key:1,shop:n.stores,goods:n.goods,onClick:()=>u("handleTo",`${e.shopPath}?shopId=${n.stores.id}&deliveryType=1`),onHandleTo:l[2]||(l[2]=S=>u("handleTo",S))},null,8,["shop","goods","onClick"]))],64))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])])}}}),bt=ie(Tt,[["__scopeId","data-v-56c7ba01"]]),St={class:"flex items-center gap-[8px] font-normal overflow-x-scroll"},_t=["onClick"],ae=D({props:{sortType:null,listActive:null,isSearchPage:{type:Boolean}},emits:["change"],setup(e,{emit:T}){const u=e,{t}=Y(),m=X(()=>u.isSearchPage?u.listActive?[{text:t("mall.Comprehensive recommendation"),value:null},{text:t("mall.Recently popular"),value:3},{text:t("mall.star"),value:2},{text:t("mall.saleNum"),value:1},{text:t("evaluate.Good reviews"),value:4}]:[{text:t("mall.Comprehensive recommendation"),value:null},{text:t("mall.Recently popular"),value:3},{text:t("goods.Selected-Optimal Priority"),value:5},{text:t("mall.saleNum"),value:1}]:u.listActive?[{text:t("mall.Comprehensive recommendation"),value:null},{text:t("mall.Recently popular"),value:3},{text:t("mall.star"),value:2},{text:t("mall.saleNum"),value:1},{text:t("evaluate.Good reviews"),value:4}]:[{text:t("common.recommend_for_you"),value:"Algorithm"},{text:t("mall.Recently popular"),value:3},{text:t("goods.Selected-Optimal Priority"),value:5}]),y=X(()=>m.value.find(h=>h.value===u.sortType).value);return(h,x)=>(o(),r("div",St,[(o(!0),r(z,null,U(P(m),s=>(o(),r("div",{key:s.value,onClick:k=>T("change",s),class:Q(["px-2 py-1 text-black/80 bg-[#F3F3F3] rounded-md flex-shrink-0",{"font-bold text-black":s.value===P(y)}])},L(s.text),11,_t))),128))]))}}),Pt=""+new URL("../images/wave-BS6nzmaQ.png",import.meta.url).href,$t=""+new URL("../images/list-icon-3aw8mu4E.svg",import.meta.url).href,It=""+new URL("../images/grid-icon-Bf3eB47x.svg",import.meta.url).href,Ct={class:"flex flex-1 items-center pt-2 pb-3.5 pr-4 font-light text-black-600"},Lt={class:"flex items-center gap-6 text-base text-black/60"},Rt=["onClick"],At={key:0,src:Pt,class:"absolute bottom-0 w-6 h-auto -translate-x-1/2 left-1/2"},Ft={key:0,class:"w-6 h-6",src:$t},Bt={key:1,class:"w-5 h-5",src:It},se=D({props:{listActived:null,viewFormat:null,isSearchPage:{type:Boolean}},emits:["changeActive","changeView"],setup(e,{emit:T}){const u=e,{t}=Y(),m=X(()=>u.isSearchPage?[{id:0,name:t("mall.Good stuff")},{id:1,name:t("mall.Good shop")}]:[{id:1,name:t("mall.Good shop")},{id:0,name:t("mall.Good stuff")}]);return(y,h)=>(o(),r("div",Ct,[a("div",Lt,[(o(!0),r(z,null,U(P(m),x=>(o(),r("div",{class:Q([{"active-tab text-xl text-black font-bold relative":e.listActived==x.id},"flex items-center pb-1"]),onClick:s=>T("changeActive",x.id),key:x.id},[e.listActived==x.id?(o(),r("img",At)):V("",!0),me(" "+L(x.name),1)],10,Rt))),128))]),e.listActived==0?(o(),r("div",{key:0,class:"ml-auto",onClick:h[0]||(h[0]=x=>T("changeView"))},[e.viewFormat==0?(o(),r("img",Ft)):(o(),r("img",Bt))])):V("",!0)]))}}),ue=e=>(ce("data-v-6ce1a310"),e=e(),re(),e),qt={class:"text-white bg-[#f8f8f8] rounded-t-xl"},Vt=ue(()=>a("div",{class:"h-2.5"},null,-1)),Nt={class:"text-white bg-[#f8f8f8]"},Gt=ue(()=>a("div",{class:"h-2.5"},null,-1)),zt={class:"rounded-b-lg min-h-[60vh] list__container"},Dt=D({props:{isSearchPage:{type:Boolean,default:!1},mode:{default:"vant"},activeInfo:null},setup(e,{expose:T}){const u=e,{scrollStore:t}=Pe(),m=oe(),y=le(),h=Z(bt),x=Z(qe),s=c(y.query.recommendsAct?y.query.recommendsAct:u.isSearchPage?0:1),k=i=>{s.value=i,n(),s.value==0?l.sortType=f.value:s.value==1&&(l.sortType=N.value),(l.sortType===2||l.sortType===5||l.sortType===4)&&(s.value==0?(l.sortType=_.value,f.value=_.value):s.value==1&&(l.sortType=b.value,N.value=b.value),setTimeout(()=>{v()})),m.replace({path:m.currentRoute.value.path,query:{recommendsAct:i}})},w=c(0),d=()=>{w.value=1-w.value},R=c(null),A=c(null),b=c(null),_=c(u.isSearchPage?3:"Algorithm"),N=c(b.value),f=c(_.value),l=fe({keyword:"",sortType:b.value,orderBy:1,classId:null});u.isSearchPage&&(l.sortType=_.value);const C=c(null),F=async i=>{l.sortType!==i.value&&(l.sortType=i.value,s.value==0?f.value=i.value:s.value==1&&(N.value=i.value),setTimeout(()=>{M(),v()}))},M=()=>{const i=document.getElementById("fm-page"),$=i.scrollY||i.scrollTop;let g=C.value.offsetParent,p=0;if(g.nodeName.toLowerCase()==="body")p+=C.value.offsetTop;else for(;g;)p+=g.offsetTop,g=g.offsetParent;$>p&&(t.setMallScroll("goods",p),t.setMallScroll("shop",p),i.scrollTo({top:p,behavior:"smooth"}))},n=()=>{const i=document.getElementById("fm-page"),$=i.scrollY||i.scrollTop;let g=s.value===1?"goods":"shop",p=s.value===1?"shop":"goods";t.setMallScroll(g,$);const q=t.getScroll(p)||0;i.scrollTo({top:q})},v=async()=>{var i,$,g,p,q;if(await A.value.handleSearch(),l.sortType!==5&&await R.value.handleSearch(),u.isSearchPage&&((i=R.value.list)==null?void 0:i.length)<=0&&s.value===1){k(0);return}((($=A.value.list)==null?void 0:$.length)<=0&&((g=R.value.list)==null?void 0:g.length)>0&&s.value===0||((p=A.value.list)==null?void 0:p.length)>0&&((q=R.value.list)==null?void 0:q.length)<=0&&s.value===1)&&k(s.value)},S=i=>{m.push(i)};return T({setParam:({keyword:i,classId:$})=>{l.keyword=i||null,l.classId=$||null,v()},onRefresh:async()=>{l.keyword="",N.value=b.value,f.value=_.value,s.value==0?l.sortType=_.value:s.value==1&&(l.sortType=b.value),l.orderBy=1,l.classId=null,t.setMallScroll("goods",0),t.setMallScroll("shop",0),setTimeout(async()=>{await v()})}}),(i,$)=>{const g=H("van-sticky");return o(),r("div",{ref:(p,q)=>{q.listPageRef=p,C.value=p},class:"RecommendsPage"},[e.mode==="vant"?(o(),G(g,{key:0,"offset-top":e.isSearchPage?90:0},{default:E(()=>[a("div",qt,[I(se,{isSearchPage:e.isSearchPage,listActived:s.value,viewFormat:w.value,onChangeActive:k,onChangeView:d},null,8,["isSearchPage","listActived","viewFormat"]),I(ae,{sortType:P(l).sortType,listActive:s.value,isSearchPage:e.isSearchPage,onChange:F},null,8,["sortType","listActive","isSearchPage"]),Vt])]),_:1},8,["offset-top"])):e.mode==="div"?(o(),r("div",{key:1,class:"sticky__wrapper",style:ge(e.isSearchPage?"top: 90px":"top: 0")},[a("div",Nt,[I(se,{isSearchPage:e.isSearchPage,listActived:s.value,viewFormat:w.value,onChangeActive:k,onChangeView:d},null,8,["isSearchPage","listActived","viewFormat"]),I(ae,{sortType:P(l).sortType,listActive:s.value,isSearchPage:e.isSearchPage,onChange:F},null,8,["sortType","listActive","isSearchPage"]),Gt])],4)):V("",!0),a("div",{class:Q(["relative z-10 pb-2 bg-[#f8f8f8] hardware-accelerated",{"min-h-[calc(100vh-126px)] pb-8 overflow-y-hidden":e.isSearchPage}])},[a("div",zt,[O(I(P(x),{viewFormat:w.value,searchParam:P(l),sortType:f.value,onHandleTo:S,ref:(p,q)=>{q.goodListRef=p,A.value=p},isSearchPage:e.isSearchPage,"active-info":e.activeInfo},null,8,["viewFormat","searchParam","sortType","isSearchPage","active-info"]),[[K,s.value==0]]),O(I(P(h),{searchParam:P(l),sortType:N.value,onHandleTo:S,ref:(p,q)=>{q.shopListRef=p,R.value=p},isSearchPage:e.isSearchPage,"active-info":e.activeInfo},null,8,["searchParam","sortType","isSearchPage","active-info"]),[[K,s.value==1]])])],2)],512)}}}),Qt=ie(Dt,[["__scopeId","data-v-6ce1a310"]]);export{Qt as R};
