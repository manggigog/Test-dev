import{_ as At}from"./combustion-BLBF9ilA.js";import{O as kt,_ as Ot,a as St,b as Ft,c as Pt,d as Bt,e as dt,C as Et,f as Mt,g as It}from"./ContributionPop-B6JGkZlO.js";import{_ as at,y as lt,r as c,bd as Z,x as mt,B as _,z as pt,bc as nt,D as vt,E as L,F as T,G as w,H as t,O as d,a2 as j,Q as a,P as o,K as J,N as F,a0 as R,Y as ht,Z as xt,l as Lt,a9 as Tt}from"./vendor-D6JO6WHW.js";import{o as _t}from"./OTCContract-2N55OtQz.js";import{x as Y,ap as ft,B as bt,d as Vt,aq as yt,r as Ut}from"./index-CbIwihlz.js";import{C as Dt}from"./Combustion-C_DkcYWR.js";import{l as Nt}from"./otc-BGNmkId2.js";import{_ as jt}from"./BgBox-DvmHZv-0.js";import{E as Rt}from"./EcologyHeader-CgFKaxn9.js";import"./exchangeContract-ZoIqbVam.js";import"./bg-dot-bY5zV9J7.js";import"./UserLevel-6j6TSble.js";import"./avatarRing-DtI_kRg6.js";import"./UserAsset-BC0K8AMb.js";import"./TokenBalance-B07aj6yN.js";const q=i=>(ht("data-v-b4627100"),i=i(),xt(),i),qt={class:"relative"},zt={key:0},Ht=q(()=>t("img",{class:"w-[51.5%]",src:Ot,alt:""},null,-1)),Gt=q(()=>t("img",{class:"w-[51.5%] absolute top-0 right-0",src:St,alt:""},null,-1)),Kt={class:"flex items-center z-10 h-full absolute top-0 w-full text-xs font-medium text-[#2E2008]"},Qt={class:"flex-1 text-center text-white"},Yt={key:1},Zt=q(()=>t("img",{class:"w-[51.5%]",src:Ft,alt:""},null,-1)),Jt=q(()=>t("img",{class:"w-[51.5%] absolute top-0 right-0",src:Pt,alt:""},null,-1)),Wt={class:"flex items-center z-10 h-full absolute top-0 w-full text-xs font-medium text-[#2E2008]"},Xt={class:"flex-1 text-center text-white"},te={class:"flex items-center text-[0.65rem] text-[#2E2008] mt-2"},ee={class:"opacity-60 whitespace-nowrap"},se={class:"ml-auto"},oe=q(()=>t("img",{class:"w-3 h-3",src:Bt},null,-1)),ne=[oe],ae={class:"flex justify-between items-center bg-[#F6F2EB] mt-1.5 rounded-xl py-1 px-2 text-[#2E2008]"},le={class:"text-xs opacity-60 whitespace-nowrap"},ie={class:"text-xs opacity-60 whitespace-nowrap"},re={class:"flex justify-between items-center bg-[#F6F2EB] my-2 rounded-xl py-1 px-2 text-[#2E2008]"},ce={class:"text-xs opacity-60 whitespace-nowrap"},ue={class:"text-xs opacity-60 whitespace-nowrap"},de={class:"flex justify-between items-center bg-[#F6F2EB] mt-2 rounded-xl py-1 px-2 text-[#2E2008]"},me={class:"text-xs opacity-60 whitespace-nowrap"},pe={class:"text-xs opacity-60 whitespace-nowrap"},fe={class:"flex justify-between text-[0.65rem] text-[#2E2008] mt-2.5"},be={class:"opacity-60"},ye={class:"flex flex-col items-center justify-center mt-2.5 text-white"},ve={key:0,class:"opacity-60 text-[0.65rem] text-[#2E2008] mt-2.5"},he={class:"my-2 bg-[#F6F2EB] p-2 rounded-xl"},xe={class:"flex justify-between text-[0.65rem] text-[#2E2008]"},_e={class:"opacity-60 whitespace-nowrap"},we={class:"flex justify-between text-[0.65rem] text-[#2E2008]"},ge={class:"opacity-60 whitespace-nowrap"},$e=lt({props:{type:null,lastPrice:null},emits:["changeTab","success","handleTo"],setup(i,{expose:P,emit:B}){const f=i,{mai:g,MIN_AMOUNT:X,musd:E,buy:z,sell:tt,balances:H,estimateBuy:p,estimateSell:G}=_t(),b=c("MUSD"),V=s=>{b.value=s==="buy"?"MUSD":"MAI",ot(),B("changeTab",s),v()},K=()=>{e.price=Math.round(e.price/.05)*.05},e=Z({number:null,price:null,totalAmount:null}),Q=mt(()=>{if(e.price){if(f.type==="buy")return+_(h[b.value]).div(e.price);if(f.type==="sell")return+_(h[b.value]).times(e.price)}else return 0;return 0}),U=mt(()=>{const s={immediate:0,remain:0};return e.totalAmount&&(f.type==="buy"?(s.immediate=+_(e.number).minus(y.value.remain),s.remain=y.value.remain):f.type==="sell"&&(s.immediate=+_(e.number).minus(y.value.remain),s.remain=y.value.remain)),s}),k=c(!0),C=c(!0),M=c(!0),$=()=>{k.value=!1,C.value=!0,M.value=!0},D=()=>{k.value=!0,C.value=!1,M.value=!0},I=()=>{k.value=!0,C.value=!0,M.value=!1};pt(()=>e.price,s=>{if(k.value)return;O.value.resetValue();const u=new _(e.number),S=new _(s);e.totalAmount=+u.times(S),l()});const O=c(null),A=c(!1);pt(()=>e.number,s=>{if(C.value)return;n.value?(I(),A.value=!0,n.value=!1):O.value.resetValue();const u=new _(e.price),S=new _(s);e.totalAmount=+S.times(u),l()});const et=s=>{M.value||(!n.value&&!A.value?O.value.resetValue():(A.value=!1,n.value=!1),e.price||(e.price=f.lastPrice),e.number=s/e.price,l())},y=c({gain:null,remain:null}),l=async()=>{if(e.number&&e.price&&e.totalAmount){const s=f.type==="buy"?await p(e.price,e.number):await G(e.price,e.number);s.success&&(y.value.gain=bt(s.result.gain),y.value.remain=bt(s.result.remain))}else y.value.gain=null,y.value.remain=null},n=c(!1),m=s=>{e.price&&(n.value=!0,f.type==="buy"?(I(),e.totalAmount=+new _(s*h[b.value]*.01)):(D(),e.number=+new _(s*h[b.value]*.01)))},v=()=>{e.number=null,e.price=null,e.totalAmount=null},N=c(0),st=async()=>{const s=await X();N.value=+s},r=Z({MAI:"",MUSD:""}),h=Z({MAI:0,MUSD:0}),wt=async()=>{r.MUSD=await E(),r.MAI=await g()},gt=async()=>{const s=await H(r[b.value]);h[b.value]=Vt(+s)},[it,rt]=nt(!1),ct=async()=>{rt(!0);const s=f.type==="buy"?await z(e.price,e.number):await tt(e.price,e.number);rt(!1),s.success&&(ot(),B("success"))},$t=s=>{$(),e.price=s},ot=async()=>{v(),await gt()};return vt(async()=>{st(),await wt(),ot()}),P({setPrice:$t}),(s,u)=>{const S=L("VanField"),ut=L("VanButton");return w(),T("div",null,[t("div",qt,[i.type=="buy"?(w(),T("div",zt,[Ht,Gt,t("div",Kt,[t("span",Qt,a(s.$t("otc.buyIn")),1),t("span",{class:"flex-1 text-center opacity-60",onClick:u[0]||(u[0]=x=>V("sell"))},a(s.$t("otc.sellOut")),1)])])):j("",!0),i.type=="sell"?(w(),T("div",Yt,[Zt,Jt,t("div",Wt,[t("span",{class:"flex-1 text-center opacity-60",onClick:u[1]||(u[1]=x=>V("buy"))},a(s.$t("otc.buyIn")),1),t("span",Xt,a(s.$t("otc.sellOut")),1)])])):j("",!0)]),t("div",te,[t("span",ee,a(s.$t("otc.Available")),1),t("span",se,a(o(Y)(o(h)[b.value]))+" "+a(i.type==="buy"?"MUSD":"MAI"),1),t("div",{class:"ml-1.5",onClick:u[2]||(u[2]=()=>{B("handleTo",`/otc-recharge?type=${i.type}`)})},ne)]),t("div",ae,[t("span",le,a(s.$t("mall.price")),1),d(S,{"input-align":"right",class:"flex-1 bg-[#F6F2EB] text-base font-bold text-[#2E2008]",modelValue:o(e).price,"onUpdate:modelValue":u[3]||(u[3]=x=>o(e).price=x),onFocus:$,type:"number",placeholder:"0",formatter:o(ft),onBlur:K},null,8,["modelValue","formatter"]),t("span",ie,a((i.type==="buy","MUSD")),1)]),t("div",re,[t("span",ce,a(s.$t("ecology.quantity")),1),d(S,{"input-align":"right",class:"flex-1 bg-[#F6F2EB] text-base font-bold text-[#2E2008]",modelValue:o(e).number,"onUpdate:modelValue":u[4]||(u[4]=x=>o(e).number=x),onFocus:D,type:"number",placeholder:"0",formatter:o(ft)},null,8,["modelValue","formatter"]),t("span",ue,a((i.type==="buy","MAI")),1)]),d(kt,{ref:(x,Ct)=>{Ct.OtcSliderRef=x,O.value=x},onChange:m},null,512),t("div",de,[t("span",me,a(s.$t("otc.Turnover")),1),d(S,{"input-align":"right",class:"flex-1 bg-[#F6F2EB] text-base font-bold text-[#2E2008]",onFocus:I,modelValue:o(e).totalAmount,"onUpdate:modelValue":[u[5]||(u[5]=x=>o(e).totalAmount=x),et],type:"number",placeholder:"0"},null,8,["modelValue"]),t("span",pe,a((i.type==="buy","MUSD")),1)]),t("div",fe,[t("span",be,a(i.type==="buy"?s.$t("otc.Availabletobuy"):s.$t("otc.Availableforsale")),1),t("span",null,a(o(Y)(o(Q)))+" "+a(i.type==="buy"?"MAI":"MUSD"),1)]),t("div",ye,[i.type==="buy"?(w(),J(ut,{key:0,onClick:ct,disabled:!0,loading:o(it),class:"font-semibold h-[38px] w-full px-4 rounded-xl text-base",style:{"background-color":"#14d8a9"}},{default:F(()=>[R(a(s.$t("common.submit")),1)]),_:1},8,["disabled","loading"])):(w(),J(ut,{key:1,onClick:ct,disabled:!0,loading:o(it),class:"font-semibold h-[38px] w-full px-4 rounded-xl text-base",style:{"background-color":"#ff507a"}},{default:F(()=>[R(a(s.$t("common.submit")),1)]),_:1},8,["disabled","loading"]))]),f.type==="sell"?(w(),T("div",ve,a(s.$t("otc.otcTip",{num:"30%"})),1)):j("",!0),t("div",he,[t("div",xe,[t("span",_e,a(s.$t("flashSale.Expected-to-close-immediately")),1),t("span",null,a(o(Y)(o(U).immediate))+" "+a((i.type==="buy","MAI")),1)]),t("div",we,[t("span",ge,a(s.$t("flashSale.Estimated-order-quantity")),1),t("span",null,a(o(Y)(o(U).remain))+" "+a((i.type==="buy","MAI")),1)])])])}}}),Ce=at($e,[["__scopeId","data-v-b4627100"]]),W=i=>(ht("data-v-08456728"),i=i(),xt(),i),Ae={class:"bg-[#FFFDF8] rounded-xl p-4 pt-4 pb-3.5"},ke={class:"flex items-center justify-between"},Oe=W(()=>t("span",{class:"text-lg text-[rgb(46,32,8)]"},"MAI/MUSD",-1)),Se=W(()=>t("img",{class:"w-7 h-7",src:At},null,-1)),Fe=[Se],Pe=W(()=>t("img",{class:"w-7 h-7",src:Mt},null,-1)),Be=[Pe],Ee=W(()=>t("img",{class:"w-7 h-7",src:It},null,-1)),Me=[Ee],Ie={class:"flex mt-2"},Le={class:"w-5/12 mr-2"},Te={class:"my-1.5"},Ve={class:"text-2xl font-bold text-[#F36B07] text-center"},Ue={class:"text-xs text-[#2E2008] opacity-60 text-center"},De={class:"mb-2"},Ne={class:"opacity-40"},je={class:"pb-3 text-center"},Re={class:"w-7/12 ml-2"},qe={class:"border-t border-[#e5e4df] border-solid py-2.5 flex justify-between text-[#2E2008]"},ze=lt({props:{isOld:{type:Boolean}},setup(i){const{loadingToggle:P}=Ut(),B=Lt(),{priceList:f}=_t(),g=c(!1),X=c(["0.05","0.1"]),E=c(.05),z=()=>{I.value.scrollToBottom()},tt=async l=>{if(E.value=l,!$.value){g.value=!1;return}await O(),z(),g.value=!1},H=l=>{var n=[];if(Object.keys(l).length<=0)return[];for(const m in l){const v={amount:l[m],price:m};n.push(v)}return n},p=Z({token:"",musd:"",sellOrderList:[],buyOrderList:[],lastPrice:0,selectPrice:0,minAmount:0,maxAmount:0}),[G,b]=nt(!1),[V,K]=nt(!1),e=c("buy"),Q=l=>{e.value=l},U=c(null),k=l=>{U.value.setPrice(l.price)},C=async()=>{const l=await Nt();l.success&&(p.lastPrice=l.data&&+l.data.price||0)},M=c(50),$=c(null),D=async()=>{const l=await f(M.value);$.value=l.result,await O()},I=c(null),O=async()=>{const l=yt($.value.buyPriceList,$.value.buySumList,E.value);p.buyOrderList=H(l).sort((m,v)=>v.price-m.price).filter(m=>m.amount>=.01);const n=yt($.value.sellPriceList,$.value.sellSumList,E.value);p.sellOrderList=H(n).sort((m,v)=>m.price-v.price).filter(m=>m.amount>=.01)},A=l=>{B.push(l)},et=async()=>{P(!0),await D(),await Promise.all([C()]),P(!1),z()};vt(async()=>{await et()});const y=setInterval(()=>{D()},3e3);return Tt(()=>{clearInterval(y)}),(l,n)=>{const m=L("van-icon"),v=L("van-picker"),N=L("VanButton"),st=L("van-popup");return w(),T("div",Ae,[t("div",ke,[Oe,t("div",null,[t("div",{class:"w-7 h-7 inline-block mr-2.5",onClick:n[0]||(n[0]=r=>o(b)(!0))},Fe),t("div",{class:"w-7 h-7 inline-block mr-2.5",onClick:n[1]||(n[1]=r=>o(K)(!0))},Be),t("div",{class:"inline-block w-7 h-7",onClick:n[2]||(n[2]=r=>A(`/otc-recharge?type=${e.value}`))},Me)])]),t("div",Ie,[t("div",Le,[d(dt,{ref:(r,h)=>{h.OtcOrderListSell=r,I.value=r},type:"sell",list:o(p).sellOrderList,onOnClick:k},null,8,["list"]),t("div",Te,[t("div",Ve,a(o(p).lastPrice),1),t("div",Ue,a(l.$t("ecology.Latesttransactionprice")),1)]),d(dt,{type:"buy",list:o(p).buyOrderList,onOnClick:k},null,8,["list"]),t("div",De,[t("div",{class:"rounded bg-[#F6F2EB] py-1 px-2 flex-center-bw",onClick:n[3]||(n[3]=r=>g.value=!0)},[t("div",Ne,a(E.value),1),d(m,{name:"arrow-down"})]),d(st,{show:g.value,"onUpdate:show":n[6]||(n[6]=r=>g.value=r),round:"",position:"bottom"},{default:F(()=>[d(v,{columns:X.value,onCancel:n[4]||(n[4]=r=>g.value=!1),onConfirm:tt},null,8,["columns"]),t("div",je,[d(N,{class:"w-[150px] h-[40px] rounded-3xl bg-white text-[#FEA021] border-orange",onClick:n[5]||(n[5]=r=>g.value=!1)},{default:F(()=>[R(a(l.$t("common.cancel")),1)]),_:1})])]),_:1},8,["show"])])]),t("div",Re,[d(Ce,{lastPrice:o(p).lastPrice,ref:(r,h)=>{h.OtcOperateRef=r,U.value=r},type:e.value,onChangeTab:Q,onHandleTo:A,onSuccess:C},null,8,["lastPrice","type"])])]),t("div",qe,[d(N,{class:"btn1 h-auto py-1.5 flex-1 mr-1.5 rounded-md text-xs font-medium",onClick:n[7]||(n[7]=r=>A("/entrust"))},{default:F(()=>[R(a(l.$t("otc.Currentorder")),1)]),_:1}),d(N,{class:"btn1 h-auto py-1.5 flex-1 ml-1.5 rounded-md text-xs font-medium",onClick:n[8]||(n[8]=r=>A("/historyEntrust"))},{default:F(()=>[R(a(l.$t("otc.historyorder")),1)]),_:1})]),o(G)?(w(),J(Dt,{key:0,show:o(G),lastPrice:o(p).lastPrice,musd:o(p).musd,mai:o(p).token,onClose:n[9]||(n[9]=r=>o(b)(!1)),onSuccess:C},null,8,["show","lastPrice","musd","mai"])):j("",!0),o(V)?(w(),J(Et,{key:1,lastPrice:o(p).lastPrice,show:o(V),onClose:n[10]||(n[10]=r=>o(K)(!1)),onSetOtcType:Q},null,8,["lastPrice","show"])):j("",!0)])}}}),He=at(ze,[["__scopeId","data-v-08456728"]]),Ge={class:"h-full relative"},Ke=lt({setup(i){return(P,B)=>(w(),T("div",Ge,[d(Rt),d(jt,{icon:"svg/ecology/otc.svg",text:P.$t("ecology.otc")},{default:F(()=>[d(He)]),_:1},8,["text"])]))}}),cs=at(Ke,[["__scopeId","data-v-db814894"]]);export{cs as default};
