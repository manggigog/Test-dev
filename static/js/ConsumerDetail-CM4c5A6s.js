import{x as T,B as me,F as l,G as n,H as e,Q as o,a2 as f,P as t,a0 as j,I as Q,r as C,o as g,D as z,a9 as ue,E as fe,O as w,N as X,_ as he,w as xe,be as E,a1 as _e,K as P,T as V,l as ve}from"./vendor-BUT0HZ5j.js";import{_ as pe}from"./OfflineGoods-BjltvH3M.js";import{_ as be}from"./OfflineStore-CFe1JKHJ.js";import{O as ye,_ as ge,a as we}from"./OrderCancelSelectorPop-BTV3fDS0.js";import{_ as R}from"./MCOIN-BcbOHmhy.js";import{_ as Ce}from"./USDT-BFPkoPAz.js";import{_ as Z}from"./FMCP-CFalj3L2.js";import{_ as Te}from"./link-BVzz25qg.js";import{_ as ee}from"./copy-w-7FY5xbhR.js";import{d as S,q as Se,b as W,h as J,l as K,R as $e,o as ke,C as Ae,bI as Ee,bJ as De}from"./index-BvL8wS8a.js";import{P as Oe}from"./order-H59PKTFP.js";import{p as Pe}from"./useOrderStatus-BSCfQVBG.js";import{a as h,o as je}from"./offlineGoods-DvT2Go6q.js";import{C as Re}from"./CommonVanProvider-BpsZUrD3.js";import{_ as Ie}from"./EmptyTipsPop-_FH8A6A8.js";import"./ImgBoutiqueLable-BF5Xoxsv.js";import"./shop-CeqcS6K2.js";import"./BackIcon-biFt6cm7.js";const Ne={class:"p-3 py-4 break-all bg-white rounded-xl"},Le={class:"title text-b1 text-sm font-semibold"},Be={class:"content"},Me={class:"flex justify-between items-center mt-[16px]"},He={class:"text-b3 text-sm font-normal"},Ue={class:"text-b1 text-sm font-normal text-right"},Fe={class:"flex justify-between items-center mt-[16px]"},Ve={class:"text-b3 text-sm font-normal"},Ke={class:"text-b1 text-sm font-normal text-right"},Ye={class:"flex justify-start items-center"},Ge=e("img",{class:"w-[17px] h-[17px] flex-shrink-0",src:R},null,-1),qe={class:"text-b1 text-sm font-normal ml-1"},We={key:0,class:"flex justify-between items-center mt-[16px]"},Je={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Qe={class:"text-b1 text-sm font-normal text-right"},ze={class:"flex justify-start items-center"},Xe=e("span",{class:"text-b1 text-sm font-normal"}," - ",-1),Ze=e("img",{class:"w-[17px] h-[17px] ml-1",src:R},null,-1),et={class:"text-b1 text-sm font-normal ml-1"},tt={class:"flex justify-between items-center mt-[16px]"},st={class:"text-b3 text-sm font-normal"},ot={class:"text-b1 text-sm font-normal text-right"},nt={key:0,class:"flex justify-start items-center"},rt={class:"text-b1 text-sm font-normal ml-1 flex justify-end items-center"},at={class:"flex justify-start items-center"},lt=e("img",{class:"w-[17px] h-[17px] mx-1",src:Ce},null,-1),it={class:"flex justify-start items-center ml-1"},ct=e("span",{class:"text-b3"},"(",-1),dt=e("img",{class:"w-[17px] h-[17px] mx-1",src:R},null,-1),mt=e("span",{class:"text-b3"}," ) ",-1),ut={key:0,class:"flex justify-start items-center"},ft=e("span",{class:"text-b3 mx-1"},"+",-1),ht=e("img",{src:Z,class:"w-4 h-4 mr-1"},null,-1),xt={class:""},_t={key:1,class:"flex justify-start items-center"},vt=e("img",{class:"w-[17px] h-[17px] mx-1",src:R},null,-1),pt={class:"text-b1 text-sm font-normal flex items-center gap-1"},bt=e("span",{class:"text-b3 mx-1"},"+",-1),yt=e("img",{src:Z,class:"w-4 h-4"},null,-1),gt={class:""},wt={class:"flex justify-between items-center mt-[16px]"},Ct={class:"text-b3 text-sm font-normal"},Tt={class:"text-b1 text-sm font-normal text-right"},St={class:"flex justify-between items-center mt-[16px]"},$t={class:"text-b3 text-sm font-normal"},kt=["href"],At=e("img",{src:Te,class:"w-5 h-5 ml-1",alt:""},null,-1),Et={key:1},Dt={class:"flex justify-between items-center mt-[16px]"},Ot={class:"text-b3 text-sm font-normal"},Pt=e("img",{src:ee,class:"w-5 h-5 ml-1",alt:""},null,-1),jt={key:1,class:"flex justify-between items-center mt-[16px]"},Rt={class:"text-b3 text-sm font-normal"},It={class:"text-b1 text-sm font-normal text-right"},Nt={key:2,class:"flex justify-between items-center mt-[16px]"},Lt={class:"text-b3 text-sm font-normal"},Bt={class:"text-b1 text-sm font-normal text-right"},Mt={key:3,class:"flex justify-between items-center mt-[16px]"},Ht={class:"text-b3 text-sm font-normal"},Ut={key:0},Ft={key:1},Vt={class:"text-b1 text-sm font-normal text-right"},Kt={key:4,class:"flex justify-between items-center mt-[16px]"},Yt={class:"text-b3 text-sm font-normal"},Gt={class:"text-b1 text-sm font-normal text-right"},qt={class:"flex justify-between items-center mt-[16px]"},Wt={class:"text-b3 text-sm font-normal whitespace-nowrap"},Jt={class:"text-b1 text-sm font-normal text-right flex items-center"},Qt={class:"break-all flex-1"},zt=e("img",{src:ee,class:"w-5 h-5",alt:""},null,-1),Xt=[zt],Zt={props:{order:{type:Object,required:!0,default:()=>({})}},setup(s){const d=s,_=T(()=>{var c,v;const r=((c=d.order)==null?void 0:c.orderRealAmount)||0,u=((v=d.order)==null?void 0:v.voucherAmount)||0;return new me(r).minus(u).toNumber()});return(r,u)=>{var c;return n(),l("div",Ne,[e("div",Le,[e("span",null,o(r.$t("order.orderInfo")),1)]),e("div",Be,[e("div",Me,[e("div",He,o(r.$t("offline.pay type method")),1),e("div",Ue,o(s.order.orderPaySource?t(Pe)(+s.order.orderPaySource):"--"),1)]),e("div",Fe,[e("div",Ve,o(r.$t("offline.order_price")),1),e("div",Ke,[e("p",Ye,[Ge,e("span",qe,o(t(S)(s.order.orderTotalAmount)),1)])])]),s.order.actAmount?(n(),l("div",We,[e("div",Je,o(((c=s.order.fmGeneralActivity)==null?void 0:c.name)||"-"),1),e("div",Qe,[e("p",ze,[Xe,Ze,e("span",et,o(t(S)(s.order.actAmount)),1)])])])):f("",!0),e("div",tt,[e("div",st,o(r.$t("order.total price actual buyer")),1),e("div",ot,[+s.order.orderPaySource===t(Oe).USDT_WALLET?(n(),l("div",nt,[e("span",rt,[e("span",at,[lt,j(" "+o(t(S)(s.order.orderRealUsdt||0)),1)]),e("span",it,[ct,dt,e("span",null,o(t(S)(t(_))),1),mt]),s.order.voucherAmount?(n(),l("span",ut,[ft,ht,e("span",xt,o(t(S)(s.order.voucherAmount||0)),1)])):f("",!0)])])):(n(),l("div",_t,[vt,e("span",pt,[e("span",null,o(t(S)(t(_)||0)),1),s.order.voucherAmount?(n(),l(Q,{key:0},[bt,yt,e("span",gt,o(t(S)(s.order.voucherAmount||0)),1)],64)):f("",!0)])]))])]),e("div",wt,[e("div",Ct,o(r.$t("common.ratio")),1),e("div",Tt,o(s.order.orderDiscountRatio)+"% ",1)]),e("div",St,[e("div",$t,o(r.$t("order.hash")),1),s.order.orderTransactionHash?(n(),l("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${t(Se).chainConfig.blockExplorerUrls[0]}/tx/${s.order.orderTransactionHash}`},[j(o(t(W)(s.order.orderTransactionHash,"***",9,5)||"--")+" ",1),At],8,kt)):(n(),l("span",Et," -- "))]),e("div",Dt,[e("div",Ot,o(r.$t("offline.create address")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:u[0]||(u[0]=v=>t(J)(s.order.orderPayAddress))},[j(o(t(W)(s.order.orderPayAddress,"...",5,5))+" ",1),Pt])]),s.order.createTime?(n(),l("div",jt,[e("div",Rt,o(r.$t("order.createTime")),1),e("div",It,o(t(K)(s.order.createTime)),1)])):f("",!0),s.order.payTime?(n(),l("div",Nt,[e("div",Lt,o(r.$t("order.chainFinishTime")),1),e("div",Bt,o(t(K)(s.order.payTime)),1)])):f("",!0),s.order.finishTime?(n(),l("div",Mt,[e("div",Ht,[s.order.orderStatus===t(h).CANCELLED?(n(),l("span",Ut,o(r.$t("offline.cancel_time")),1)):(n(),l("span",Ft,o(r.$t("order.finishTime")),1))]),e("div",Vt,o(t(K)(s.order.finishTime)),1)])):f("",!0),s.order.orderStatus===t(h).CANCELLED?(n(),l("div",Kt,[e("div",Yt,o(r.$t("offline.cancel_reason")),1),e("div",Gt,o(s.order.cancelReason||"--"),1)])):f("",!0),e("div",qt,[e("div",Wt,o(r.$t("order.orderNumber")),1),e("div",Jt,[e("div",Qt,o(s.order.orderId||"--"),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:u[1]||(u[1]=v=>t(J)(s.order.orderId))},Xt)])])])])}}},es={class:"p-3 break-all bg-white rounded-xl"},ts={class:"font-semibold text-base text-b1"},ss={key:0},os={key:1},ns={key:2,class:"text-[#FF8812] mx-1"},rs={class:"mt-1 font-normal text-sm text-b2"},as={key:0},ls={key:1},is={props:{order:{type:Object,required:!0}},emits:["timeDone"],setup(s,{emit:d}){const _=s,r=C(!1),u=C(g());let c=null;const v=C(null),$=T(()=>g(_.order.payTime).add(24,"hours")),k=T(()=>{const m=$.value.diff(u.value);return Math.max(0,m)}),I=T(()=>{const m=g(),p=g(_.order.payTime);return m.diff(p,"hours")>=24}),D=T(()=>{const m=k.value;if(m<=0)return"";const p=g.duration(m),A=Math.floor(p.asHours()),N=p.minutes(),L=p.seconds(),a=A*3600+N*60+L;return g.utc(a*1e3).format("HH:mm:ss")}),O=()=>{u.value=g(),k.value<=0&&c&&v.value>0&&(clearInterval(c),c=null,r.value=!0,d("timeDone")),v.value=k.value};return z(()=>{u.value=g(),I.value?r.value=!0:(O(),c=setInterval(O,1e3))}),ue(()=>{c&&(clearInterval(c),c=null)}),(m,p)=>(n(),l("div",es,[e("div",ts,[r.value?(n(),l("span",os,o(m.$t("offline.long time not confirm by merchant")),1)):(n(),l("span",ss,o(m.$t("offline.wait merchant confirm")),1)),!r.value&&t(D)?(n(),l("span",ns,o(t(D)||""),1)):f("",!0)]),e("div",rs,[r.value?(n(),l("span",ls,o(m.$t("offline.can be cancel order and refund")),1)):(n(),l("span",as,o(m.$t("offline.countdown end can be cancel order and refund")),1))])]))}},cs={class:"flex justify-between items-center gap-3 fixed bottom-0 left-0 right-0 px-3 pb-4"},ds={key:0,class:"relative w-full"},ms={props:{order:{type:Object,default:()=>({})},cancelLoading:{type:Boolean,default:!1},cancelDisabled:{type:Boolean,default:!1}},emits:["handleCancel"],setup(s,{emit:d}){const _=()=>{d("handleCancel")};return(r,u)=>{const c=fe("VanButton");return n(),l("div",cs,[s.order.orderStatus===t(h).PAYMENT_SUCCESS?(n(),l("div",ds,[w(c,{round:"",class:"w-full main-btn font-normal text-base h-[46px] rounded-full",onClick:_,loading:s.cancelLoading,disabled:s.cancelDisabled},{default:X(()=>[j(o(r.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"])])):f("",!0)])}}},us={class:"px-3 pb-20 flex flex-col gap-3 safe-body overflow-y-auto"},fs={class:"w-full p-3 rounded-xl bg-white font-Puhui"},hs={setup(s){var q;const{t:d}=xe(),_=_e(),r=ve(),[u,c]=E(!1),[v,$]=E(!1),{getUserDhKey:k,decryptKey:I}=$e(),{offlineUserCancel:D}=ke(),[O,m]=E(!1),p=C("取消成功"),A=C(!1),N={[h.PAYMENT_FAILED]:d("order.fail"),[h.PAYING]:d("order.paying"),[h.PAYMENT_SUCCESS]:d("order.To be confirmed"),[h.CANCELLED]:d("order.canceled"),[h.COMPLETED]:d("order.completed"),[h.CLOSED]:d("order.closed")},L=24*60*60*1e3,a=C({}),B=C(((q=_.query)==null?void 0:q.id)||""),M=async()=>{var x,y;V.loading({message:d("common.loading"),forbidClick:!0}),c(!0);const i=await Ee({id:B.value});if(V.clear(),c(!1),i.success&&i.data&&(a.value=i.data||{},(x=i.data)!=null&&x.orderRemark&&((y=i.data)!=null&&y.orderSubmitShopPubKey)))try{const b=await k(i.data.shopId,i.data.orderSubmitShopPubKey);if(console.log("dhkey:",b),b){const de=I(i.data.orderRemark,b);a.value.orderRemark=de.decrypt}}catch(b){console.error("解密失败:",b)}},H=C(null),[te,U]=E(!1),se=()=>{(a.value.orderStatus||null)===h.PAYMENT_SUCCESS?U(!0):V(d("offline.order status does not support cancel"))},oe=i=>{H.value=i,console.log("cancelReason",H.value),U(!1),ae()},[ne,F]=E(!1),re=d("offline.cancel important msg buyer"),ae=()=>{F(!0)},Y=()=>{F(!1)},le=async()=>{F(!1);const i={orderId:a.value.orderId,cancelReason:H.value.value||"其他",cancelSource:1};$(!0);const x=await De(i);if($(!1),!x.success)return;const y=[a.value.chainOrderId];$(!0);const b=await D(y);$(!1),b.success&&(M(),A.value=!1,p.value=d("offline.successful of cancel "),m(!0),sessionStorage.setItem("consumer_offline_refresh_chainOrderId",B.value.toString()),setTimeout(()=>{r.go(-1)},1950))},G=T(()=>je(a.value.orderType)),ie=T(()=>N[a.value.orderStatus]||"--"),ce=T(()=>{if(!a.value.payTime)return!1;const i=a.value.payTime;return Date.now()-i<L});return z(()=>{M()}),(i,x)=>(n(),l(Q,null,[w(Re,{title:i.$t("order.orderDetail"),class:"font-Puhui font-normal relative app-container main-bg","theme-vars":{"field-placeholder-text-color":"#A6A6A6",navBarBackgroundColor:"transparent"},ref:(y,b)=>{b.EvaluateDetailRef=y}},{default:X(()=>[e("section",us,[a.value.orderStatus===t(h).PAYMENT_SUCCESS&&a.value.payTime?(n(),P(is,{key:0,order:a.value,onTimeDone:M},null,8,["order"])):f("",!0),e("div",fs,[w(be,{status:t(ie),"show-order-status":"",loading:t(u),store:{images:a.value.shopPics,name:a.value.shopName}},null,8,["status","loading","store"]),t(G).GOODS?(n(),P(pe,{key:0,class:"mt-3",showNum:"",goods:{goodsName:a.value.relName||"-",goodsIcons:a.value.relIcons,goodsPrice:a.value.relPrice||0,goodsNumber:a.value.relNumber||0}},null,8,["goods"])):t(G).STORE?(n(),P(ge,{key:1,price:a.value.orderRealAmount,loading:t(u)},null,8,["price","loading"])):f("",!0)]),w(Zt,{order:a.value},null,8,["order"]),w(we,{order:a.value,isBuyer:""},null,8,["order"]),w(ms,{order:a.value,cancelLoading:t(v),cancelDisabled:t(ce),onHandleCancel:se},null,8,["order","cancelLoading","cancelDisabled"])])]),_:1},8,["title"]),w(ye,{show:t(te),isBuyer:"",onClose:x[0]||(x[0]=y=>t(U)(!1)),onSelected:oe},null,8,["show"]),w(Ae,{show:t(ne),title:i.$t("common.tip"),content:t(re),showConfirm:!0,showReject:!0,confirmText:i.$t("common.confirm"),noClose:"",onClose:Y,onConfirm:le,onReject:Y},null,8,["show","title","content","confirmText"]),t(O)?(n(),P(Ie,{key:0,onClose:x[1]||(x[1]=y=>t(m)(!1)),text:p.value,isError:A.value},null,8,["text","isError"])):f("",!0)],64))}},js=he(hs,[["__scopeId","data-v-1fa27cf0"]]);export{js as default};
