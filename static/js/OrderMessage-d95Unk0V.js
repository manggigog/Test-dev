import{_ as ne}from"./clear-post-iaUxhveN.js";import{B as se}from"./BackIcon-biFt6cm7.js";import{_ as A,r as y,x as q,z as le,F as x,G as c,H as s,I as Y,J as Z,R as oe,a2 as I,a3 as re,Q as r,P as w,n as ie,w as ee,y as ce,l as de,a1 as ue,be as fe,D as me,E as B,O as E,K as z,bq as J,N as m,T as j}from"./vendor-BUT0HZ5j.js";import{l as P}from"./shop-CeqcS6K2.js";import{v as pe,l as xe}from"./index-hbwLMIYO.js";import{f as ve,r as be,q as he,a as ge}from"./mall-BLN1rOb_.js";const ye=["onClick","id"],_e={class:"text-sm text-b3 font-normal flex items-center"},ke={class:"label__wrap"},we={key:0,class:"fm-tab-underline"},De={props:{options:{type:[Array,Object],required:!0},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"value"},modelValue:[String,Number,Object],scrollToSelected:{type:Boolean,default:!0},scrollOffset:{type:Number,default:16}},emits:["update:modelValue","change"],setup(d,{emit:U}){const u=d,i=y(null),C=y(null),V=y([]),D=q(()=>Array.isArray(u.options)?u.options:Object.values(u.options));function v(o){return o[u.valueKey]===u.modelValue}function F(o){U("update:modelValue",o[u.valueKey]),U("change",o[u.valueKey])}le(()=>u.modelValue,async()=>{u.scrollToSelected&&(await ie(),L())},{immediate:!0});function L(){const o=D.value.findIndex(f=>v(f));if(o===-1)return;const T=document.getElementById(`fm-tab-item-${o}`),e=i.value;if(T&&e){const f=T.offsetLeft-(u.scrollOffset||0);e.scrollTo({left:f,behavior:"smooth"})}}let M=!1,_=0,k=0;function b(o){M=!0,_=o.touches?o.touches[0].pageX:o.pageX,k=i.value.scrollLeft}function O(o){if(!M)return;const T=o.touches?o.touches[0].pageX:o.pageX,e=_-T;i.value.scrollLeft=k+e}function $(){M=!1}return(o,T)=>(c(),x("div",{class:"fm-tab",ref:(e,f)=>{f.tabWrapper=e,i.value=e},onMousedown:b,onTouchstart:b,onMousemove:O,onTouchmove:O,onMouseup:$,onMouseleave:$,onTouchend:$},[s("div",{class:"flex flex-nowrap justify-start items-center gap-4",ref:(e,f)=>{f.tabList=e,C.value=e}},[(c(!0),x(Y,null,Z(w(D),(e,f)=>(c(),x("div",{key:e[d.valueKey]??f,class:oe([["fm-tab-item",{active:v(e)}],"relative last:pr-4"]),onClick:n=>F(e),ref:(n,S)=>{S.tabItems=n,V.value=n},id:`fm-tab-item-${f}`},[s("p",_e,[s("span",ke,r(e[d.labelKey]),1),re(o.$slots,"badge"+f,{},void 0,!0)]),v(e)?(c(),x("div",we)):I("",!0)],10,ye))),128))],512)],544))}},Q=A(De,[["__scopeId","data-v-524e1736"]]),Ue={class:"w-full bg-white rounded-xl p-3 overflow-x-hidden"},Te={class:"title__wrap w-full flex justify-start items-center"},Ce={key:0,class:"w-[8px] h-[8px] rounded-full mr-1.5 bg-[#FF8812] flex-shrink-0"},Le={class:"text-base text-b1 font-normal text-ellipsis line-clamp-1 flex-1 min-w-0"},Oe={key:1,class:"text-xs font-normal border border-[#FF8812] rounded-[2px] px-1 text-[#FF8812] ml-1 flex-shrink-0"},$e=["innerHTML"],Ie={class:"time__wrap w-full mt-2 no-wrap text-right"},Ve={class:"text-sm text-b3 font-normal"},Me={props:{item:{type:Object,default:()=>{}}},setup(d){const U=d,{t:u}=ee(),{currentLocale:i}=pe(),C={1:"支付结果",2:"物流",3:"售后",4:"线下服务",11:"物流",12:"售后",13:"补货",14:"审核",15:"线下服务"},V=q(()=>{const D=U.item[`content${P[i.value]}`]||U.item.contentCn||U.item.contentEn;return D?D.replace(/<[^>]*>/g,""):""});return(D,v)=>(c(),x("div",Ue,[s("div",Te,[d.item.readFlag?I("",!0):(c(),x("div",Ce)),s("p",Le,r(d.item[`title${w(P)[w(i)]}`]||d.item.titleCn||d.item.titleEn),1),d.item.category?(c(),x("p",Oe,r(C[d.item.category]),1)):I("",!0)]),s("div",{class:"content__wrap w-full text-sm text-b2 font-normal mt-2 line-clamp-2",innerHTML:w(V)},null,8,$e),s("div",Ie,[s("p",Ve,r(w(xe)(d.item.updateTime||d.item.createTime)),1)])]))}},Re=A(Me,[["__scopeId","data-v-1d9a008e"]]),Ee={class:"w-full h-full bg-[#f2f0ef]"},qe={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 bg-white"},Fe={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Se={class:"font-bold text-base text-b1"},Be={key:1,class:"w-5 h-5",src:ne,alt:"一键清空已读"},je={key:0},Ke={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ne={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},ze={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ae={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Xe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},He={key:1},Ge={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},We={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Je={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Pe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Qe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ye={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ze={class:"list__wrap w-full h-[calc(100vh-50px-34px)] z-10 overflow-y-auto scroll-smooth px-3"},et=ce({name:"OrderMessage"});function tt(d){var G,W;const{t:U}=ee(),u=de(),i=ue(),C=q(()=>{var t;return((t=i.query)==null?void 0:t.type)==1?"consumer":"merchant"}),V=q(()=>[{label:"全部",value:null},{label:"支付结果",value:1},{label:"物流",value:2},{label:"售后",value:3},{label:"线下服务",value:4}]),D=q(()=>[{label:"全部",value:null},{label:"物流",value:11},{label:"售后",value:12},{label:"补货",value:13},{label:"审核",value:14},{label:"线下服务",value:15}]),v=y((G=i.query)!=null&&G.category?+((W=i.query)==null?void 0:W.category):null),F=t=>{let l={...i.query,category:t};t||delete l.category,u.replace({path:"/orderMessage",query:l}),setTimeout(()=>{O()})},L=y(0),M=y(20),_=y(!1),k=y(!1),b=y([]),O=()=>{L.value=0,b.value=[],k.value=!1,$(),S()},$=()=>{k.value||(_.value=!0,L.value+=1,o())},o=()=>{var a;const t=v.value,l={page:L.value,size:M.value,type:(a=i.query)==null?void 0:a.type,category:t};he(l).then(p=>{if(p.success===!1){j(p.message||"获取数据失败"),k.value=!0;return}if(t!=v.value){k.value=!0;return}const R=p.data||[],N=p.total||0;b.value=L.value===1?R:b.value.concat(R),(b.value.length>=N||R.length===0)&&(k.value=!0)}).catch(p=>{console.error("获取订单消息列表失败:",p),j("网络错误，请稍后重试"),k.value=!0}).finally(()=>{_.value=!1})},T=t=>{const l=t.id;t.readFlag=!0,f(l),t.goodsId;const a=t.orderId;switch(t.remindType){case 101:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 102:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 103:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 104:e("/refundDetail?id="+a);break;case 105:e("/refundDetail?id="+a);break;case 107:e("/buyerOrderList/buyerOrderDetail?id="+a);break;case 108:e("/buyerOrderList?active=2");break;case 109:e("/evaluate-post?orderId="+a);break;case 110:e("/refundDetail?id="+a);break;case 111:e("/refundDetail?id="+a);break;case 112:e("/refundDetail?id="+a);break;case 201:e("/sellerOrderDetail?id="+a);break;case 205:e("/sellerOrderList?type=1&active=3");break;case 2010:e("/sellerOrderDetail?id="+a);break;case 202:e("/merchantRefundDetail?id="+a);break;case 203:e("/shopGoods");break;case 204:e("/profile?path=merchant");break;case 106:e("/editShopInfo");break;case 206:e("/sellerOrderDetail?id="+a);break;case 207:e("/merchantRefundDetail?id="+a);break;case 208:e("/merchantRefundDetail?id="+a);break;case 209:e("/merchantRefundDetail?id="+a);break;case 210:e("/merchantRefundDetail?id="+a);break;case 100102:e("/offlineConsumerDetail?id="+a);break;case 100103:e("/offlineConsumerDetail?id="+a);break;case 100104:e("/offlineEvaluateSubmit?id="+a);break;case 100202:e("/offlineMerchantDetail?id="+a);break;case 1002020:e("/offlineMerchantDetail?id="+a);break;case 100203:e("/offlineMerchantDetail?id="+a);break}},e=t=>{u.push(t)},f=async t=>{await ge({id:t})},n=y({}),S=async()=>{var l;const t=await ve({type:(l=i.query)==null?void 0:l.type});if(t.success){n.value=t.data||{};return}console.log(t.data)},h=t=>t===0?0:t>99?"99+":t,[X,H]=fe(!1),K=y(null),te=()=>{var a;if(X.value)return;const t=Date.now();if(K.value&&t-K.value<2e3){j("请勿频繁点击");return}const l={type:(a=i.query)==null?void 0:a.type};H(!0),be(l).then(p=>{p.success&&(j("已清除未读消息"),ae(),O())}).catch(p=>{console.error("清空已读失败:",p)}).finally(()=>{H(!1)}),K.value=t},ae=async()=>{b.value.forEach(t=>{t.readFlag=!0})};return me(()=>{S()}),(t,l)=>{const a=B("van-loading"),p=B("Empty"),R=B("van-list"),N=B("van-pull-refresh");return c(),x("div",Ee,[s("section",qe,[s("div",Fe,[E(se)]),s("div",Se,r(t.$t("home.Order Message")),1),s("div",{class:"absolute right-4 flex items-center gap-1 -translate-y-1/2 top-1/2 w-5 h-5",onClick:te},[w(X)?(c(),z(a,{key:0,size:"20"})):(c(),x("img",Be))])]),w(C)==="consumer"?(c(),x("section",je,[E(Q,{options:w(V),modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=g=>v.value=g),onChange:F,"label-key":"label","value-key":"value"},J({_:2},[n.value.totalUnread>0?{name:"badge0",fn:m(()=>[s("span",Ke,r(h(n.value.totalUnread)),1)])}:void 0,n.value.paymentUnread>0?{name:"badge1",fn:m(()=>[s("span",Ne,r(h(n.value.paymentUnread)),1)])}:void 0,n.value.logisticsUnread>0?{name:"badge2",fn:m(()=>[s("span",ze,r(h(n.value.logisticsUnread)),1)])}:void 0,n.value.aftersaleUnread>0?{name:"badge3",fn:m(()=>[s("span",Ae,r(h(n.value.aftersaleUnread)),1)])}:void 0,n.value.offlineUnread>0?{name:"badge4",fn:m(()=>[s("span",Xe,r(h(n.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):I("",!0),w(C)==="merchant"?(c(),x("section",He,[E(Q,{options:w(D),modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=g=>v.value=g),onChange:F,"label-key":"label","value-key":"value"},J({_:2},[n.value.totalUnread>0?{name:"badge0",fn:m(()=>[s("span",Ge,r(h(n.value.totalUnread)),1)])}:void 0,n.value.logisticsUnread>0?{name:"badge1",fn:m(()=>[s("span",We,r(h(n.value.logisticsUnread)),1)])}:void 0,n.value.aftersaleUnread>0?{name:"badge2",fn:m(()=>[s("span",Je,r(h(n.value.aftersaleUnread)),1)])}:void 0,n.value.restockUnread>0?{name:"badge3",fn:m(()=>[s("span",Pe,r(h(n.value.restockUnread)),1)])}:void 0,n.value.reviewUnread>0?{name:"badge4",fn:m(()=>[s("span",Qe,r(h(n.value.reviewUnread)),1)])}:void 0,n.value.offlineUnread>0?{name:"badge5",fn:m(()=>[s("span",Ye,r(h(n.value.offlineUnread)),1)])}:void 0]),1032,["options","modelValue"])])):I("",!0),s("section",Ze,[E(N,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=g=>_.value=g),onRefresh:O,"animation-duration":"0"},{default:m(()=>[b.value.length===0&&!_.value?(c(),z(p,{key:0,name:"暂无消息"})):I("",!0),E(R,{loading:_.value,"onUpdate:loading":l[2]||(l[2]=g=>_.value=g),finished:k.value,"finished-text":b.value.length===0?"":"没有更多了",onLoad:$},{default:m(()=>[(c(!0),x(Y,null,Z(b.value,g=>(c(),z(Re,{key:g.id,item:g,class:"mb-3 first:mt-3",onClick:nt=>T(g)},null,8,["item","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])])}}const at=Object.assign(et,{setup:tt}),dt=A(at,[["__scopeId","data-v-61c27cfe"]]);export{dt as default};
