import{_ as xe,w as He,r as f,F as X,G as z,H as k,Q as he,Y as ke,Z as Ie,y as Pt,E as Ue,a3 as bt,K as G,P as x,X as ve,R as St,l as Mt,bc as Oe,bd as _t,z as Ct,a9 as Rt,bh as zt,D as je,n as Fe,x as Ae,O as ye,a2 as Q,N as Tt,B as K}from"./vendor-CjApaIpB.js";import{U as Lt}from"./UserAsset-BgucuI6V.js";import{_ as Wt}from"./MAI-DI3UfkaQ.js";import{d as N,f as Et,o as Ft,u as At,e as Bt,k as Kt,i as $t,j as Ht,q as D,r as Ut,s as Be}from"./index-lKIcPnY0.js";import{e as Ot}from"./exchangeContract-GZ923Ihh.js";import"./arrow-CRN8rk-J.js";import"./TokenBalance-oKdVRHxX.js";const jt="/Test-dev/static/webp/loading-eouHFNRU.webp",Dt=p=>(ke("data-v-53fea2b3"),p=p(),Ie(),p),Gt={class:"loading-mask fixed top-0 left-0 w-full h-full"},Nt={class:"w-full fixed top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%]"},Vt=Dt(()=>k("img",{src:jt,class:"w-[180px] m-auto"},null,-1)),Zt={class:"w-[68%] mt-5 mx-auto text-[14px] text-center text-sm font-normal text-b1 -translate-y-12"},qt={emits:["complete"],setup(p,{emit:U}){const{t:I}=He(),T=[I("home.loading.t1"),I("home.loading.t2"),I("home.loading.t3"),I("home.loading.t4"),I("home.loading.t5")],M=f(T[Math.floor(Math.random()*T.length)]);return(V,B)=>(z(),X("div",Gt,[k("div",Nt,[Vt,k("p",Zt,he(M.value),1)])]))}},Yt=xe(qt,[["__scopeId","data-v-53fea2b3"]]),Qt=p=>(ke("data-v-6dce2d40"),p=p(),Ie(),p),Xt={class:"text-xs text-white font-semibold text-shadow"},Jt={class:"font-semibold text-sm text-[#B67829] display-text-shadow mt-[28px] flex justify-center items-center"},ea={key:1},ta=Qt(()=>k("img",{src:Wt,class:"w-[14px] h-[14px] ml-1"},null,-1)),aa=Pt({props:{type:null,text:null,amount:null,scale:{default:1},loading:{type:Boolean},bgClass:{default:"xfbt"}},emits:["handleRelease"],setup(p,{emit:U}){return(I,T)=>{const M=Ue("van-loading");return z(),X("div",{class:St(["bb w-[140px] max-w-[140px] aspect-square flex flex-col items-center justify-center",p.bgClass]),style:ve({width:`${90*p.scale}px`,height:`${90*p.scale}px`}),onClick:T[0]||(T[0]=()=>U("handleRelease",p.type))},[k("div",Xt,[k("span",null,he(p.text),1)]),k("div",Jt,[p.loading?(z(),G(M,{key:0,size:"28",color:"#F59C5A"})):(z(),X("span",ea," +"+he(p.amount<1?x(N)(p.amount||0,4):x(N)(p.amount||0,2)),1)),ta]),bt(I.$slots,"default",{},void 0,!0)],6)}}}),pe=xe(aa,[["__scopeId","data-v-6dce2d40"]]),i={idleLeft:{path:"lottie/plaza/cat_idle_left.json",loop:!0,key:"idleLeft",direction:"left"},idleRight:{path:"lottie/plaza/cat_idle_right.json",loop:!0,key:"idleRight",direction:"right"},walkLeft:{path:"lottie/plaza/cat_walk_left.json",loop:!0,key:"walkLeft",direction:"left"},walkRight:{path:"lottie/plaza/cat_walk_right.json",loop:!0,key:"walkRight",direction:"right"}},w=[{id:1,type:"walk",key:i.walkLeft.key,lottie:i.walkLeft,x:120,y:-10,isStart:!0,zIndex:.5,stop:3},{id:2,type:"walk",key:i.walkRight.key,lottie:i.walkRight,x:32,y:19,zIndex:1,stop:3},{id:3,type:"stop",stopKey:"jcxf_stop",key:i.walkRight.key,lottie:i.walkRight,x:50,y:26,zIndex:1,stop:3},{id:4,type:"walk",key:i.walkLeft.key,lottie:i.walkLeft,x:60,y:30,zIndex:1,stop:5},{id:5,type:"stop",stopKey:"xfbt_stop",key:i.walkLeft.key,lottie:i.walkLeft,x:32,y:44,zIndex:1,stop:5},{id:6,type:"walk",key:i.walkRight.key,lottie:i.walkRight,x:32,y:44,zIndex:1,stop:7},{id:7,type:"stop",stopKey:"skjc_stop",key:i.walkRight.key,lottie:i.walkRight,x:52,y:52,zIndex:1,stop:7},{id:8,type:"walk",key:i.walkLeft.key,lottie:i.walkLeft,x:62,y:56,zIndex:1,stop:9},{id:9,type:"stop",stopKey:"skbt_stop",key:i.walkLeft.key,lottie:i.walkLeft,x:30,y:68,zIndex:1,stop:9},{id:10,type:"walk",key:i.walkRight.key,lottie:i.walkRight,x:30,y:68,zIndex:1,stop:3},{id:11,type:"walk",key:i.walkLeft.key,lottie:i.walkLeft,x:120,y:100,isEnd:!0,zIndex:.5,stop:3}],H={speed:88,updateInterval:32},Ke="/Test-dev/static/images/plaza-build-BHm6pFl7.png",$e="/Test-dev/static/webp/plaza-bg-D8OyAHPS.webp",na=p=>(ke("data-v-e6167f98"),p=p(),Ie(),p),la={class:"plaza-map-bg relative font-Puhui"},oa={class:"fixed top-0 left-0 w-full px-3 pt-3 z-10"},sa=na(()=>k("canvas",{id:"plaza-map-canvas",name:"aura@20250801",role:"game"},null,-1)),ia={class:"text-base font-bold text-[#ff8812]"},ra={emits:["loadDone"],setup(p,{emit:U}){var Ee;const{Game:I,GameObject:T,resource:M,RESOURCE_TYPE:V,LOAD_EVENT:B}=EVA,{RendererSystem:J}=EVA.plugin.renderer,{Render:Z,RenderSystem:De}=EVA.plugin.renderer.render,{Img:da,ImgSystem:Ge}=EVA.plugin.renderer.img,{Lottie:ee,LottieSystem:Ne}=EVA.plugin.renderer.lottie,{Event:pa,EventSystem:Ve,HIT_AREA_TYPE:va}=EVA.plugin.renderer.event,Pe=Mt(),{pointRate:Ze}=Et(),{withdrawMaiPending:qe,userWithdrawMaiOfMint:Ye,userWithdrawMaiOfSwap:Qe,merchantWithdrawMaiOfSwap:be}=Ft(),{getCurrentAccount:Se}=At(),{contributesStore:fe}=Bt(),{balances:Xe,getOneBalance:Je}=Kt(),et=$t(),tt=Ht(),{lastPrice:at}=Ot(),{t:ha}=He(),{loadingToggle:me}=Ut(),[fa,Me]=Oe(!1),_e=f(["MCOIN","MUSD","MAI"]),c=_t({pointInfo:{freeRelease:0,gradeRelease:0,levelRelease:0,recommendRelease:0,releaseSecond:0,userMai:0,merchantMai:0,userSwap:0,merchantExtraMai:0,releaseSecondFlag:!1},mcoinBalance:Xe[(Ee=D)==null?void 0:Ee.MCOIN]||null,usdtBalance:null,allowance:0}),nt=(t,a)=>{let n;return function(...l){const s=()=>{clearTimeout(n),t(...l)};clearTimeout(n),n=setTimeout(s,a)}},h=f({usdtBalance:null,allowance:null,pointRate:null,lastPrice:null,cacheTime:0,cacheDuration:3e4}),Ce=()=>Date.now()-h.value.cacheTime<h.value.cacheDuration,lt=async()=>{if(h.value.usdtBalance!==null&&Ce()){c.usdtBalance=h.value.usdtBalance;return}try{const t=await(await tt).balanceOf(Se());c.usdtBalance=t,h.value.usdtBalance=t,h.value.cacheTime=Date.now()}catch{c.usdtBalance=0,h.value.usdtBalance=0}},ot=async()=>{if(h.value.allowance!==null&&Ce()){c.allowance=h.value.allowance;return}try{const t=await(await et).allowance(D.flashMall);c.allowance=t.result,h.value.allowance=t.result,h.value.cacheTime=Date.now()}catch{c.allowance=0,h.value.allowance=0}},st=async()=>{try{const[t,a,n,o,l]=await Promise.all([qe(Se()),Be(D.WMAI).balanceOf(D.LP),Be(D.MCOIN).balanceOf(D.LP),at(),Ze()]);h.value.lastPrice=o,h.value.pointRate=l||1,h.value.cacheTime=Date.now();const s=K(n).div(a).toString(),r=l||1,u=K(t.result.userMai),d=K(t.result.merchantMai),y=K(t.result.userSwap),C=K(t.result.merchantExtraMai),F=K(s),Y=K(o),ue=K(r);c.pointInfo.userMai=+u.div(ue).div(Y).div(10).times(.9),c.pointInfo.merchantMai=+d.div(F).div(2).times(.9),c.pointInfo.userSwap=+y.div(F).times(.9),c.pointInfo.merchantExtraMai=+C.div(F).div(2).times(.9)}catch(t){console.error("get mai error:",t),c.pointInfo.userMai=0,c.pointInfo.merchantMai=0,c.pointInfo.userSwap=0,c.pointInfo.merchantExtraMai=0}},Re=async(t=!0)=>{Me(!0);try{await Promise.all([fe.fetchContributes(t),fe.fetchUserRelase(),fe.getNaturalReleaseTimes(),lt(),ot(),st(),_e.value.forEach(a=>Je(a))])}catch(a){console.error("init error:",a)}finally{Me(!1)}},te=t=>{ut(t);const n={40:"jcxf_stop",50:"skjc_stop",60:"xfbt_stop",70:"skbt_stop"}[t];n&&(e.value.hasCompletedFirstWalk?rt(n):it(n))},it=t=>{if(g.value&&g.value.stopKey===t)return;const a=w[e.value.currentPointIndex];a&&a.stopKey===t||(e.value.targetStopKey=t,e.value.isWalking||(e.value.isWalking=!0,e.value.walkInterval=setInterval(()=>{se()},H.updateInterval)))},rt=t=>{if(g.value&&g.value.stopKey===t)return;const a=w[e.value.currentPointIndex];if(a&&a.stopKey===t)return;const n=le.value.get(t);if(!n)return;const o=j.value.get(n.id),l=e.value.currentPointIndex;if(l===1){e.value.pendingStopKey=t,e.value.isWaitingForUserAction=!1,e.value.needCompleteScript=!1,e.value.targetStopKey=t,e.value.isWalking=!0,W.value=i.walkRight.key,e.value.walkInterval=setInterval(()=>{se()},H.updateInterval);return}o>l,e.value.pendingStopKey=t,e.value.isWaitingForUserAction=!1,e.value.needCompleteScript=!1,e.value.targetStopKey=t,q(!1)},ut=async t=>{me(!0,2);try{const n={40:()=>Ye(),60:()=>Qe(),50:()=>be(),70:()=>be()}[t];if(!n)throw new Error(`未知的操作类型: ${t}`);(await n()).success&&(h.value.cacheTime=0,await Re(!0))}catch(a){console.error("point operation error:",a)}finally{me(!1)}},m=f(null),O=f(null),ae=f({width:0,height:0}),L=f(!1),ze=f(0),W=f("walkLeft"),P=f({idleLeft:null,idleRight:null,walkLeft:null,walkRight:null}),e=f({isWalking:!1,currentPointIndex:0,currentPosition:{x:0,y:0},targetPosition:{x:0,y:0},walkTimer:null,walkInterval:null,currentStopPoint:null,targetStopKey:null,hasCompletedFirstWalk:!1,isWaitingForUserAction:!1,pendingStopKey:null,needCompleteScript:!1}),g=f(null),ne=f([]),v=f({startWalkTimer:null,animationFrameId:null,resizeHandler:null}),b={width:375,height:667,minWidth:375,maxWidth:640,aspectRatio:375/667,backgroundColor:12508233},Te=f({width:60,height:77}),E=f({percentToPixels:new Map,distances:new Map,pointIndexMap:new Map,stopPointMap:new Map}),j=f(new Map),le=f(new Map),ct=()=>{w.forEach((t,a)=>{j.value.set(t.id,a),t.type==="stop"&&le.value.set(t.stopKey,t)})},S=(t,a)=>{const n=`${t}_${a}`;if(E.value.percentToPixels.has(n))return E.value.percentToPixels.get(n);const o={x:t/100*b.width-30,y:a/100*b.height-40};return E.value.percentToPixels.set(n,o),o},oe=(t,a)=>{const n=`${t.x}_${t.y}_${a.x}_${a.y}`;if(E.value.distances.has(n))return E.value.distances.get(n);const o=a.x-t.x,l=a.y-t.y,s=Math.sqrt(o*o+l*l);return E.value.distances.set(n,s),s},_=(t,a,n=0)=>{if(!P.value||!L.value||!m.value)return;const o={x:t,y:a};Object.values(P.value).forEach(l=>{if(l!=null&&l.transform){l.transform.position=o;const s=l.getComponent("Render");s&&(s.alpha=1,s.zIndex=n)}})},q=(t=!1)=>{if(!(!L.value||!m.value||e.value.isWalking)&&!(e.value.hasCompletedFirstWalk&&e.value.isWaitingForUserAction&&!e.value.pendingStopKey)&&!(!e.value.hasCompletedFirstWalk&&e.value.targetStopKey&&e.value.isWalking&&!t))if(t){if(g.value){const a=j.value.get(g.value.id);if(a!==void 0){e.value.currentPointIndex=a;const n=S(g.value.x,g.value.y);e.value.currentPosition=n}g.value=null,e.value.currentStopPoint=null,e.value.isWalking=!0,e.value.walkInterval=setInterval(()=>{se()},H.updateInterval);return}}else{if(e.value.isWalking=!0,e.value.currentStopPoint=null,!t&&!e.value.hasCompletedFirstWalk&&(e.value.targetStopKey=null),t){const a=e.value.currentPosition;let n=0,o=1/0;w.forEach((l,s)=>{const r=S(l.x,l.y),u=oe(a,r);u<o&&(o=u,n=s)}),e.value.currentPointIndex=n}else if(e.value.hasCompletedFirstWalk)e.value.currentPointIndex===1&&e.value.targetStopKey;else{e.value.currentPointIndex=0;const a=w[0],n=S(a.x,a.y);e.value.currentPosition={...n},e.value.targetPosition={...n};const o=a.zIndex,l=Math.max(0,100-Math.floor(n.y/10)),s=o!==void 0?o:l;_(n.x,n.y,s)}P.value[W.value]&&(P.value[W.value].visible=!0),ge(),e.value.walkInterval=setInterval(()=>{se()},H.updateInterval)}},dt=(t=null)=>{if(!t){e.value.isWalking=!1,e.value.walkInterval&&(clearInterval(e.value.walkInterval),e.value.walkInterval=null),v.value.animationFrameId&&(cancelAnimationFrame(v.value.animationFrameId),v.value.animationFrameId=null),e.value.targetStopKey=null,g.value=null,ne.value=[];return}!L.value||!m.value||!le.value.get(t)||(e.value.targetStopKey=t,e.value.isWalking||(g.value?q(!0):q(!1)))},se=()=>{if(!(!L.value||!m.value||!e.value.isWalking))if(g.value){const t=ne.value.shift();if(!t){g.value=null;return}const a=w[j.value.get(t)];if(!a)return;const n=S(a.x,a.y),o=oe(e.value.currentPosition,n),l=performance.now(),s=o/H.speed*1e3;v.value.animationFrameId=null;const r=u=>{const d=u-l,y=Math.min(d/s,1),C=e.value.currentPosition,F={x:C.x+(n.x-C.x)*y,y:C.y+(n.y-C.y)*y};_(F.x,F.y),y<1?v.value.animationFrameId=requestAnimationFrame(r):(e.value.currentPosition=F,e.value.currentPointIndex=j.value.get(t),a.isEnd?g.value=null:ne.value.push(a.stop),v.value.animationFrameId&&(cancelAnimationFrame(v.value.animationFrameId),v.value.animationFrameId=null))};v.value.animationFrameId=requestAnimationFrame(r)}else{const t=e.value.currentPointIndex,a=w[t],n=a.isEnd||!1,o=(t+1)%w.length,l=w[o],s=S(l.x,l.y),r=e.value.currentPosition,u=oe(r,s);let d=a.key;W.value!==d&&(W.value=d);const y=H.speed*H.updateInterval/1e3,C=Math.min(y/u,1),F=r.x+(s.x-r.x)*C,Y=r.y+(s.y-r.y)*C,ue=a.zIndex,xt=Math.max(0,100-Math.floor(Y/10)),kt=ue!==void 0?ue:xt;e.value.currentPosition={x:F,y:Y},_(F,Y,kt);const It=oe(e.value.currentPosition,s);if(n){if(!L.value||!m.value)return;if(!e.value.hasCompletedFirstWalk)if(e.value.targetStopKey){e.value.currentPointIndex=0,e.value.currentPosition=S(w[0].x,w[0].y);const $=Math.max(0,100-Math.floor(e.value.currentPosition.y/10));_(e.value.currentPosition.x,e.value.currentPosition.y,$);return}else{e.value.hasCompletedFirstWalk=!0,e.value.isWaitingForUserAction=!1,e.value.targetStopKey="second_node_stop",e.value.pendingStopKey="second_node_stop";return}if(e.value.needCompleteScript){e.value.needCompleteScript=!1,e.value.currentPointIndex=0,e.value.currentPosition=S(w[0].x,w[0].y);const $=Math.max(0,100-Math.floor(e.value.currentPosition.y/10));if(_(e.value.currentPosition.x,e.value.currentPosition.y,$),e.value.pendingStopKey){e.value.targetStopKey=e.value.pendingStopKey,e.value.pendingStopKey=null;return}return}if(e.value.hasCompletedFirstWalk&&!e.value.targetStopKey){e.value.targetStopKey="second_node_stop",e.value.pendingStopKey="second_node_stop",e.value.isWaitingForUserAction=!1;return}if(e.value.hasCompletedFirstWalk&&e.value.targetStopKey){if(e.value.currentPointIndex===1)return;{e.value.currentPointIndex=0,e.value.currentPosition=S(w[0].x,w[0].y);const $=Math.max(0,100-Math.floor(e.value.currentPosition.y/10));_(e.value.currentPosition.x,e.value.currentPosition.y,$);return}}e.value.currentPointIndex=0,e.value.currentPosition=S(w[0].x,w[0].y);const ce=Math.max(0,100-Math.floor(e.value.currentPosition.y/10));_(e.value.currentPosition.x,e.value.currentPosition.y,ce);return}if(It<5){e.value.currentPointIndex=o;const ce=l.zIndex,$=Math.max(0,100-Math.floor(s.y/10)),de=ce!==void 0?ce:$;if(_(s.x,s.y,de),o===1&&e.value.targetStopKey==="second_node_stop"){e.value.isWalking=!1,clearInterval(e.value.walkInterval);const R=S(l.x,l.y);e.value.currentPosition=R,_(R.x,R.y,de),W.value=i.idleRight.key,e.value.targetStopKey=null,e.value.pendingStopKey=null,e.value.isWaitingForUserAction=!0;return}if(l.type==="stop"&&e.value.targetStopKey===l.stopKey){e.value.isWalking=!1,clearInterval(e.value.walkInterval),g.value=l;const R=S(l.x,l.y);e.value.currentPosition=R,_(R.x,R.y,de);const we=l.lottie.direction==="left"?i.idleLeft:i.idleRight;W.value=we.key,e.value.targetStopKey=null,e.value.isWaitingForUserAction=!0;return}if(l.type==="stop"&&e.value.targetStopKey===l.stopKey){e.value.isWalking=!1,clearInterval(e.value.walkInterval),g.value=l;const R=S(l.x,l.y);e.value.currentPosition=R,_(R.x,R.y,de);const we=l.lottie.direction==="left"?i.idleLeft:i.idleRight;W.value=we.key,e.value.targetStopKey=null,e.value.hasCompletedFirstWalk||(e.value.hasCompletedFirstWalk=!0),e.value.isWaitingForUserAction=!0;return}}}},ge=()=>{if(!L.value||!P.value||!m.value)return;const t=W.value,a=m.value.scene,n=60/5,o=77/5,l=n/60,s=o/77;if(Object.values(P.value).forEach(r=>{r&&(r.size={width:n,height:o},r.transform&&(r.transform.scale={x:l,y:s}),r.visible=!1,r.parent&&r.parent.removeChild(r))}),P.value[t]){const r=P.value[t];a.addChild(r),r.visible=!0;const u=r.getComponent("Lottie");if(u){const d=i[t],y=d&&d.loop?{repeats:1/0}:{repeats:0};u.width=n,u.height=o,u.play([],y)}}};Ct(W,()=>{ge()});const A=f({loaded:!1,resources:new Map,preloadPromises:[]}),pt=async()=>{try{await vt();const t=new EVA.Game({systems:[new J({canvas:O.value,width:b.width,height:b.height,backgroundColor:b.backgroundColor,resolution:window.devicePixelRatio||1,enableScroll:!1,enableDirtyRectangle:!0}),new Ge,new Ne,new Ve,new De],autoStart:!0,frameRate:60});ht(t),gt(t),m.value=t,L.value=!0,ge(),P.value&&Object.values(P.value).forEach(a=>{a&&(a.visible=!1)}),M.preload()}catch(t){console.error("plaza load error:",t)}},vt=async()=>{if(A.value.loaded)return;const t=[Le($e,"plazaBg"),Le(Ke,"plazaBuild"),ie(i.idleLeft.path,"catIdleLeft"),ie(i.idleRight.path,"catIdleRight"),ie(i.walkLeft.path,"catWalkLeft"),ie(i.walkRight.path,"catWalkRight")];try{await Promise.all(t),A.value.loaded=!0}catch(a){console.error("resource load error:",a)}},Le=(t,a)=>new Promise((n,o)=>{if(A.value.resources.has(a)){n();return}const l=new Image;l.onload=()=>{A.value.resources.set(a,l),n()},l.onerror=o,l.src=t}),ie=(t,a)=>new Promise((n,o)=>{if(A.value.resources.has(a)){n();return}fetch(t).then(l=>l.json()).then(l=>{A.value.resources.set(a,l),n()}).catch(o)}),ht=t=>{const a=t.scene;a.addComponent(new Z({sortableChildren:!0}));const n=[{name:"plazaBg",type:V.IMAGE,src:{image:{type:"webp",url:$e}},preload:!0},{name:"plazaBuild",type:V.IMAGE,src:{image:{type:"png",url:Ke}},preload:!0},{name:"catIdleLeft",type:"LOTTIE",src:{json:{type:"json",url:i.idleLeft.path}},preload:!0},{name:"catIdleRight",type:"LOTTIE",src:{json:{type:"json",url:i.idleRight.path}},preload:!0},{name:"catWalkLeft",type:"LOTTIE",src:{json:{type:"json",url:i.walkLeft.path}},preload:!0},{name:"catWalkRight",type:"LOTTIE",src:{json:{type:"json",url:i.walkRight.path}},preload:!0}];M.addResource(n);const o=()=>{U("loadDone")};M.on(B.PROGRESS,y=>{}),M.on(B.COMPLETE,o),t._cleanupResource=()=>{M.off(B.COMPLETE,o)};const l=new EVA.GameObject("background",{size:{width:b.width,height:b.height}}),s=new EVA.GameObject("buildings",{size:{width:b.width,height:b.height}});s.addComponent(new Z({zIndex:1,sortableChildren:!0}));const r=l.addComponent(new EVA.plugin.renderer.img.Img({resource:"plazaBg",type:"sprite"})),u=s.addComponent(new EVA.plugin.renderer.img.Img({resource:"plazaBuild",type:"sprite"})),d={width:b.width,height:b.height};r.width=d.width,r.height=d.height,u.width=d.width,u.height=d.height,a.addChild(l),a.addChild(s),ft()},ft=t=>{const a={width:Te.value.width,height:Te.value.height},n={x:.2,y:.2},o={x:.5,y:.5},l={idleLeft:new ee({resource:"catIdleLeft",width:a.width,height:a.height}),idleRight:new ee({resource:"catIdleRight",width:a.width,height:a.height}),walkLeft:new ee({resource:"catWalkLeft",width:a.width,height:a.height}),walkRight:new ee({resource:"catWalkRight",width:a.width,height:a.height})},s={};["idleLeft","idleRight","walkLeft","walkRight"].forEach(u=>{const d=new T(`cat${u.charAt(0).toUpperCase()+u.slice(1)}`,{anchor:o,size:a,transform:{scale:n}});d.addComponent(l[u]);const y=u.includes("idle")?0:1,C=u==="idleLeft"||u==="walkLeft"?0:1;d.addComponent(new Z({zIndex:y,alpha:C,sortableChildren:!0})),s[u]=d}),P.value=s},mt=()=>{A.value.resources.clear(),A.value.loaded=!1,A.value.preloadPromises=[],E.value.percentToPixels.clear(),E.value.distances.clear(),E.value.pointIndexMap.clear(),E.value.stopPointMap.clear(),j.value.clear(),le.value.clear(),h.value.usdtBalance=null,h.value.allowance=null,h.value.pointRate=null,h.value.lastPrice=null,h.value.cacheTime=0};Rt(()=>{document.body.style.overflow="",document.documentElement.style.overflow="",mt(),v.value.startWalkTimer&&(clearTimeout(v.value.startWalkTimer),v.value.startWalkTimer=null),v.value.animationFrameId&&(cancelAnimationFrame(v.value.animationFrameId),v.value.animationFrameId=null),dt(),v.value.resizeHandler&&(window.removeEventListener("resize",v.value.resizeHandler),v.value.resizeHandler=null),m.value&&(m.value._cleanupResize&&m.value._cleanupResize(),m.value._cleanupResource&&m.value._cleanupResource(),m.value._cleanupTapEvent&&m.value._cleanupTapEvent(),m.value.destroy(),m.value=null,L.value=!1),P.value=null,g.value=null,ne.value=[],e.value&&(e.value.hasCompletedFirstWalk=!1,e.value.isWaitingForUserAction=!1,e.value.pendingStopKey=null,e.value.needCompleteScript=!1)}),zt(()=>{me(!1)});const gt=t=>{let a={width:0,height:0};const n=()=>{const s=O.value.parentElement,r=s.clientWidth,u=s.clientHeight;if(a.width===r&&a.height===u)return;a={width:r,height:u};let d=Math.min(r,500),y=d/b.aspectRatio;O.value.style.width=`${d}px`,O.value.style.height=`${y}px`,ae.value={width:d,height:y},t.renderer&&t.renderer.resize(d,y),o()},o=()=>{const s=window.innerHeight,r=ae.value.height,u=s-r,d=82;ze.value=Math.max(0,u+d)},l=nt(()=>{L.value&&n()},100);v.value.resizeHandler=l,window.addEventListener("resize",v.value.resizeHandler),Fe(()=>{n()}),t._cleanupResize=()=>{v.value.resizeHandler&&(window.removeEventListener("resize",v.value.resizeHandler),v.value.resizeHandler=null)}},wt=()=>{Pe.replace("/home")},yt=t=>{Pe.push(t)};je(async()=>{await Fe(),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",ct(),O.value=document.getElementById("plaza-map-canvas"),O.value&&(await pt(),v.value.startWalkTimer=setTimeout(()=>{L.value&&m.value&&q()},1e3)),Re(!1)});const re=Ae(()=>({userSwap:+N(c.pointInfo.userSwap)&&c.pointInfo.userSwap>1e-4,userMai:+N(c.pointInfo.userMai)&&c.pointInfo.userMai>1e-4,merchantExtraMai:+N(c.pointInfo.merchantExtraMai)&&c.pointInfo.merchantExtraMai>1e-4,merchantMai:+N(c.pointInfo.merchantMai)&&c.pointInfo.merchantMai>1e-4})),We=Ae(()=>ze.value/2);return(t,a)=>{const n=Ue("van-button");return z(),X("div",la,[k("div",oa,[ye(Lt,{tokens:_e.value,onHandleTo:yt,class:"w-full py-2 px-2 h-[36px]"},null,8,["tokens"])]),sa,k("div",{class:"plaza-bubble__wrap",style:ve({width:ae.value.width+"px",height:ae.value.height+"px"})},[x(re).userSwap?(z(),G(pe,{key:0,class:"absolute left-[24%] top-[38%]",type:1,text:t.$t("homev2.bubble xfbt"),scale:1,amount:x(c).pointInfo.userSwap,bgClass:"xfbt",onHandleRelease:a[0]||(a[0]=o=>te(60))},null,8,["text","amount"])):Q("",!0),x(re).userMai?(z(),G(pe,{key:1,class:"absolute right-[22%] top-[30%]",type:1,text:t.$t("homev2.bubble xfjc"),scale:1,amount:x(c).pointInfo.userMai,bgClass:"xfjc",onHandleRelease:a[1]||(a[1]=o=>te(40))},null,8,["text","amount"])):Q("",!0),x(re).merchantExtraMai?(z(),G(pe,{key:2,class:"absolute left-[28%] top-[66%]",type:1,text:t.$t("homev2.bubble skbt"),scale:1,amount:x(c).pointInfo.merchantExtraMai,bgClass:"skbt",onHandleRelease:a[2]||(a[2]=o=>te(70))},null,8,["text","amount"])):Q("",!0),x(re).merchantMai?(z(),G(pe,{key:3,class:"absolute right-[22%] top-[54%]",type:1,text:t.$t("homev2.bubble skjc"),scale:1,amount:x(c).pointInfo.merchantMai,bgClass:"skjc",onHandleRelease:a[3]||(a[3]=o=>te(50))},null,8,["text","amount"])):Q("",!0)],4),k("div",{class:"top-mark-ui flex flex-col justify-end pb-4 px-3",style:ve({height:x(We)+"px"})},null,4),k("div",{class:"button-mark-ui flex flex-col justify-end pb-4 px-3",style:ve({height:x(We)+"px"})},[ye(n,{class:"back-btn",onClick:wt},{default:Tt(()=>[k("span",ia,he(t.$t("common.return home")),1)]),_:1})],4)])}}},ua=xe(ra,[["__scopeId","data-v-e6167f98"]]),ca={class:"relative w-full overflow-hidden overflow-y-scroll font-Puhui"},Pa={setup(p){const[U,I]=Oe(!0),T=f(0),M=()=>{const B=Date.now()-T.value,J=1500;if(B>=J)I(!1);else{const Z=J-B;setTimeout(()=>{I(!1)},Z)}};return je(()=>{I(!0),T.value=Date.now()}),(V,B)=>(z(),X("div",ca,[x(U)?(z(),G(Yt,{key:0,class:"z-50"})):Q("",!0),ye(ua,{onLoadDone:M})]))}};export{Pa as default};
