import{_ as ke}from"./exchange2-DmU0qu5E.js";import{_ as te,F as m,G as r,H as t,Q as c,Y as se,Z as ne,y as P,w as xe,r as oe,bc as Q,bd as be,x as L,z as X,D as we,E as I,O as d,a2 as Y,K as N,P as s,a0 as S,I as R,J as V,N as B,R as ve,$ as Ae,B as Ie,T as O}from"./vendor-D6JO6WHW.js";import{y as Me,z as ye,A as C,B as $e,D as De,E as Se,F as Be,G as Ce,H as Ue,e as Ne,f as Te,q as w,g as Z,c as j,d as x,s as U,r as Le,I as ee}from"./index-CbIwihlz.js";import{b as Oe}from"./beiConstContract-9GKmIGuG.js";import{_ as Re}from"./TokenBalance-B07aj6yN.js";import{B as Ve}from"./BackIcon-CPUEW9je.js";const ae="/static/images/exchange-arrow-DUUUA3Bw.svg",Pe="/static/images/exchange-1-DWoUal-O.svg",We="/static/images/exchange-DEkJ89KM.svg",Fe={},Ee=l=>(se("data-v-ab66f6d2"),l=l(),ne(),l),ze={class:"flex-center"},Ge={class:"skew absolute w-[104px] inline-flex justify-center items-center h-[34px]"},He={class:"z-50 w-full h-full px-5 flex-center gap-2 rounded-full bg-[#ffd81f]"},Ke=Ee(()=>t("img",{src:We,class:"h-4",alt:""},null,-1)),qe={class:"text-base font-semibold"};function Je(l,p){return r(),m("div",ze,[t("div",Ge,[t("div",He,[Ke,t("span",qe,c(l.$t("assets.exchange")),1)])])])}const Qe=te(Fe,[["render",Je],["__scopeId","data-v-ab66f6d2"]]),Xe=()=>{const l=Me(),p=l==null?void 0:l.cns,h=l==null?void 0:l.address,v={MAI:"mai",MCOIN:"mcoin",MUSD:"musd",USDT:"usdt"},b={MAI:"Mai",MCOIN:"Mcoin",MUSD:"Musd",USDT:"Usdt",BNB:"BNB"};return{swapToken:async(_,f,k)=>{try{const u=await p.estimateGas[`${v[_]}To${b[f]}`](C(k)),A=await(await p[`${v[_]}To${b[f]}`](C(k),{gasLimit:Se(u,1e3),...De})).wait();return Be(A)}catch(u){return Ce(u),Ue(u,h,`${v[_]}To${b[f]}`,{amount:C(k)})}},getAmountsOut:async(_,f,k)=>{const u=await ye(await p.PANCAKE_ROUTER()),A=u==null?void 0:u.cns;u==null||u.address;try{const y=await A.getAmountsOut(C(_),[f,k]);return $e(y[1])}catch{return 0}}}},M=l=>(se("data-v-4e400854"),l=l(),ne(),l),Ye={class:"mx-4 mt-5 bg-white rounded-xl bg"},Ze={class:"px-3 pb-5 my-5"},je={class:"flex justify-between"},et={class:"flex-start"},tt=["src"],st={class:"mr-1 font-semibold"},nt=M(()=>t("img",{src:ae,class:"w-4 mr-1",alt:""},null,-1)),ot={class:"opacity-80 flex-center"},at={key:1},lt={class:"bg-[#fff9f0] mt-1 rounded-lg p-2"},ct={class:"flex items-center justify-end gap-2 mt-2"},it=["onClick"],rt=M(()=>t("img",{src:Pe,class:"w-10",alt:""},null,-1)),ut=[rt],dt={class:""},mt={class:"flex justify-between"},pt=["src"],ft={class:"font-semibold"},gt=M(()=>t("img",{src:ae,class:"w-4",alt:""},null,-1)),ht={class:"opacity-80 flex-center"},_t={key:1},kt={class:"bg-[#fff9f0] mt-3 rounded-lg py-1 px-2"},xt={class:"mt-2 text-center opacity-70"},bt={class:"gap-4 mt-5 font-semibold text-white flex-center"},wt={class:"gap-1 flex-center"},vt=M(()=>t("img",{src:ke,class:"w-4",alt:""},null,-1)),At={key:0,class:"gap-2 mt-5 flex-center"},It=M(()=>t("div",{class:"w-[13px] h-[13px] rounded-full bg-[#ffd489] text-white text-xs flex-center"}," 1 ",-1)),Mt={class:"gap-1 flex-center"},yt={class:"px-4 py-4 text-sm font-normal text-white"},$t={class:"mt-[30px]"},Dt=P({setup(l){const{loadingToggle:p}=Le(),{t:h}=xe(),{reloadStore:v}=Ne(),{mcoinRate:b}=Te(),{getAmountsOut:W,swapToken:F}=Xe(),_=oe(!1),[f,k]=Q(!1),[u,A]=Q(!1),{withdrawTo:y,depositFor:le}=Oe(),e=be({percents:[{name:"25%",value:.25},{name:"50%",value:.5},{name:"75%",value:.75},{name:"MAX",value:1}],resouceAmount:null,toAmount:null,tokenIndex:0,token0:"MCOIN",token1:"MUSD",balance0:0,balance1:0,originTokens:["MCOIN","USDT","MUSD","MAI","WMAI"],tokens0:["MCOIN","USDT","MUSD","MAI","WMAI"],tokens1:["MUSD","USDT","BNB"],pairs:[{token0:"MCOIN",token1:"BNB"},{token0:"MCOIN",token1:"USDT"},{token0:"MCOIN",token1:"MUSD"},{token0:"MUSD",token1:"BNB"},{token0:"MUSD",token1:"MCOIN"},{token0:"MUSD",token1:"USDT"},{token0:"USDT",token1:"MCOIN"},{token0:"USDT",token1:"MUSD"},{token0:"MAI",token1:"WMAI"},{token0:"WMAI",token1:"MAI"}],authLoading:!0,exchangeLoading:!0,exchangeValue:null,resouceDisabled:!1,toDisabled:!1,pointRate:0,bnbRate:0,firstAuth:!1,isAuth:!1,allowanceAmount:0}),g=L(()=>({name:e.token0,icon:Z(`images/tokens/${e.token0}.png`),token:w[`${e.token0}`]})),$=L(()=>({name:e.token1,icon:Z(`images/tokens/${e.token1}.png`),token:w[`${e.token1}`]})),D=L(()=>({MUSDUSDT:1,USDTMUSD:1,MUSDMCOIN:e.pointRate,MCOINMUSD:1/e.pointRate*.99,USDTMCOIN:e.pointRate,MCOINUSDT:1/e.pointRate*.99,USDTBNB:e.bnbRate,MUSDBNB:e.bnbRate,MCOINBNB:e.bnbRate/e.pointRate*.99,MAIWMAI:1,WMAIMAI:1})[e.token0+e.token1]),E=n=>{const o=n.toString().split(".");return o.length>1&&o[1].length>4?`${o[0]}.${o[1].substring(0,4)}`:n},ce=()=>{e.resouceDisabled=!1,e.toDisabled=!0},ie=()=>{e.resouceDisabled=!0,e.toDisabled=!1};X(()=>e.resouceAmount,n=>{e.resouceDisabled||(e.toAmount=x(n*D.value,4),e.isAuth=+e.allowanceAmount>=parseFloat(n||0)&&+e.allowanceAmount>0)},{immediate:!0,deep:!0}),X(()=>e.toAmount,n=>{e.toDisabled||(e.resouceAmount=x(n/D.value||0,4),e.isAuth=+e.allowanceAmount>=parseFloat(n||0)&&+e.allowanceAmount>0)});const re=n=>{e.resouceDisabled=!1,e.toDisabled=!0,e.resouceAmount=x(+Ie(e.balance0).times(n.value))},z=n=>{e.tokenIndex=n,k(!0)},ue=async n=>{if(e[`token${e.tokenIndex}`]===n){k(!1);return}e[`token${e.tokenIndex}`]=n;var o=(e.pairs||[]).filter(i=>i[`token${e.tokenIndex}`]===n);e.tokenIndex||(e[`tokens${1-e.tokenIndex}`]=(o||[]).map(i=>i[`token${1-e.tokenIndex}`]),o=e[`tokens${1-e.tokenIndex}`]||[],e[`token${1-e.tokenIndex}`]=o.length?o[0]:""),e.exchangeValue=null,k(!1),e.resouceAmount=null,e.toAmount=null,T()},de=()=>{if(e.token1==="BNB")return;const n=e.token0;e.token0=e.token1,e.tokens0=e.originTokens;const o=(e.pairs||[]).filter(i=>i.token0===e.token0);e.tokens1=(o||[]).map(i=>i.token1),e.tokens1.indexOf(n)!==-1?e.token1=n:e.token1="",e.resouceAmount=null,e.toAmount=null,e.firstAuth=!1,e.isAuth=!1,T()},G=async()=>{e.authLoading=!0;const{allowance:n}=U(g.value.token);e.authLoading=!1;const o=e.token0==="MAI"||e.token0==="WMAI"?w.bei:w.swapPool,i=await n(o);i.success&&(e.allowanceAmount=+i.result||0,e.isAuth=+i.result>0&&+i.result>=(+e.resouceAmount||0),e.firstAuth=e.firstAuth||+i.result<=0)},me=async()=>{A(!0),e.balance0=g.value.name==="BNB"?+await ee():+await U(g.value.token).balanceOf(),e.balance1=$.value.name==="BNB"?+await ee():+await U($.value.token).balanceOf(),A(!1)},pe=async()=>{e.pointRate=await b()},fe=async()=>{e.bnbRate=+await W(1,w.USDT,w.BNB)},ge=async()=>{e.authLoading=!0;try{const n=g.value.name==="WMAI"||g.value.name==="MAI"?w.bei:w.swapPool;if(!(await U(g.value.token).approve(n)).success)return;G()}finally{e.authLoading=!1}},he=async()=>{if(!e.resouceAmount)return O(h("assets.pleaseInput"));if(+e.resouceAmount>+e.balance0)return O(h("errorMsg.burn amount exceeds balance"));e.exchangeLoading=!0;try{if(!(e.token0==="MAI"?await le(x(e.resouceAmount,18)):e.token0==="WMAI"?await y(x(e.resouceAmount,18)):await F(e.token0,e.token1,x(e.resouceAmount,18))).success)return;O(h("assets.change")+h("common.success")),setTimeout(()=>{v.reload()},1500)}finally{e.exchangeLoading=!1}},T=async()=>{p(!0),await G(),await me(),pe(),fe(),p(!1),e.authLoading=!1,e.exchangeLoading=!1};return we(()=>{T()}),(n,o)=>{const i=I("van-icon"),H=I("van-loading"),K=I("VanField"),q=I("VanButton"),_e=I("VanPicker"),J=I("VanPopup");return r(),m("div",Ye,[d(Qe),t("div",Ze,[t("section",null,[t("div",je,[t("div",et,[t("div",{onClick:o[0]||(o[0]=a=>z(0)),class:"flex-start"},[t("img",{src:s(g).icon,alt:"",class:"w-6 h-6 mr-1"},null,8,tt),t("span",st,c(s(g).name),1),nt]),s(g).name=="MCOIN"?(r(),N(i,{key:0,name:"question-o",onClick:o[1]||(o[1]=()=>{_.value=!0})})):Y("",!0)]),t("div",ot,[S(c(n.$t("assets.balance"))+" ",1),s(u)?(r(),N(H,{key:0,size:"18px"})):(r(),m("span",at,c(s(j)(s(x)(s(e).balance0||0))),1))])]),t("div",lt,[d(K,{class:"bg-[#fff9f0] text-default opacity-50","input-align":"right",modelValue:s(e).resouceAmount,"onUpdate:modelValue":o[2]||(o[2]=a=>s(e).resouceAmount=a),onFocus:ce,type:"number",formatter:E,placeholder:"0"},null,8,["modelValue"]),t("div",ct,[(r(!0),m(R,null,V(s(e).percents,a=>(r(),m("div",{class:"text-xs text-[primary] border border-solid border-primary rounded-md px-1 py-[2px]",key:a.value,onClick:Pt=>re(a)},c(a.name),9,it))),128))])])]),t("div",{class:"mt-3 flex-center",onClick:de},ut),t("section",dt,[t("div",mt,[t("div",{class:"gap-1 flex-start",onClick:o[3]||(o[3]=a=>z(1))},[t("img",{src:s($).icon,alt:"",class:"w-6 h-6"},null,8,pt),t("span",ft,c(s($).name),1),gt]),t("div",ht,[S(c(n.$t("assets.balance"))+" ",1),s(u)?(r(),N(H,{key:0,size:"18px"})):(r(),m("span",_t,c(s(j)(s(x)(s(e).balance1||0))),1))])]),t("div",kt,[d(K,{class:"bg-[#fff9f0] text-default opacity-50","input-align":"right",modelValue:s(e).toAmount,"onUpdate:modelValue":o[4]||(o[4]=a=>s(e).toAmount=a),onFocus:ie,type:"number",formatter:E,placeholder:"0"},null,8,["modelValue"])])]),t("div",xt," 1 "+c(s(e).token0)+" = "+c(s(D)?s(x)(s(D),6).toString():"-")+" "+c(s(e).token1),1),t("div",bt,[d(q,{class:"btn h-[35px] min-w-[100px] px-4",disabled:s(e).isAuth,loading:s(e).authLoading,onClick:ge},{default:B(()=>[S(c(n.$t("assets.auth"))+c(s(g).name),1)]),_:1},8,["disabled","loading"]),d(q,{class:"btn h-[35px] min-w-[100px] px-4",loading:s(e).exchangeLoading,disabled:!s(e).isAuth||s(e).authLoading,onClick:he},{default:B(()=>[t("div",wt,[vt,S(" "+c(n.$t("assets.change")),1)])]),_:1},8,["loading","disabled"])]),s(e).firstAuth?(r(),m("div",At,[It,t("div",Mt,[(r(),m(R,null,V(3,a=>t("div",{key:a,class:"w-1 h-1 bg-[#ffd489] rounded-full"})),64))]),t("div",{class:ve(["w-[13px] h-[13px] rounded-full border-gray2 border-solid border text-gray2 text-xs flex-center",{"bg-[#ffd489] text-white":s(e).isAuth}])}," 2 ",2)])):Y("",!0)]),d(J,{show:s(f),"onUpdate:show":o[6]||(o[6]=a=>Ae(f)?f.value=a:null),round:"",position:"bottom"},{default:B(()=>[d(_e,{"show-toolbar":"",columns:s(e).tokenIndex?s(e).tokens1:s(e).tokens0,onCancel:o[5]||(o[5]=a=>f.value=!1),onConfirm:ue,"default-index":s(e).tokenIndex?s(e).tokens1.findIndex(a=>a===s(e).token1):s(e).tokens0.findIndex(a=>a===s(e).token0)},null,8,["columns","default-index"])]),_:1},8,["show"]),d(J,{closeable:"",show:_.value,"onUpdate:show":o[7]||(o[7]=a=>_.value=a),round:"",position:"center",style:{width:"90vw",background:"rgba(0, 0, 0, 0.8)"}},{default:B(()=>[t("div",yt,[t("span",$t,c(n.$t("exchange.exchange tips1")),1),t("span",null,c(n.$t("exchange.exchange tips2")),1),t("span",null,c(n.$t("exchange.exchange tips3")),1)])]),_:1},8,["show"])])}}}),St=te(Dt,[["__scopeId","data-v-4e400854"]]),Bt="/static/images/Union-HDW1eVf1.png",Ct="/static/images/avatar-GkmLP2IK.png",Ut={class:"relative p-5 overflow-hidden bg-gradient-to-b from-primary-004 to-yellow-002 rounded-b-xl"},Nt=t("img",{src:Bt,class:"absolute top-0 w-full h-auto left-0"},null,-1),Tt={class:"relative flex items-center justify-center"},Lt={class:"absolute left-0 -translate-y-1/2 top-1/2"},Ot=t("img",{src:Ct,class:"w-auto h-6 mr-2"},null,-1),Rt={class:"bg-white px-2.5 mt-2.5 rounded-xl relative"},Vt=P({setup(l){const p=oe(["MCOIN","MUSD","MAI","USDT","BNB","WMAI","LP"]);return(h,v)=>(r(),m("div",Ut,[Nt,t("header",Tt,[t("div",Lt,[d(Ve)]),Ot,t("div",null,c(h.$t("assets.myAssets")),1)]),t("div",Rt,[(r(!0),m(R,null,V(p.value,b=>(r(),N(Re,{key:b,token:b,icon:!0,"token-name":!0,addTokenIcon:!0,class:"w-full justify-between py-2.5 border-b border-solid border-gray1 last:border-0 font-semibold"},null,8,["token"]))),128))])]))}}),Kt=P({setup(l){return(p,h)=>(r(),m("div",null,[d(Vt),d(St)]))}});export{Kt as default};
