import{z as L,y as T,G as r,H as a,U as M,O as v,J as f,a4 as _,Q as i,F as D,P as S,I as o,a3 as F,r as l,E as R,Z as $,$ as w,q as j,K as z,T as A}from"./vendor-Dr_RpJ_Y.js";import{C as G}from"./CommonVanProvider-KZuKVOde.js";import{bx as H,B as P}from"./index-CU2nzZe6.js";import{c as U,a as q}from"./innerService-DvVH9K3P.js";import"./BackIcon-CDrGaEPo.js";const J="/static/images/clear-read-DbxnU2gD.svg",O={class:"line-clamp-1"},Y=_(i("[图片]")),K=_(i("[卡片消息]")),Q=_(i("[卡片消息]")),Z=_(i("[未知消息类型]")),W=L({props:{content:null},setup(n){const h=n,t=T(()=>{let s;try{s=JSON.parse(h.content)}catch{s={}}return s});return(s,c)=>(a(),r("span",O,[v(t).type==1?(a(),r(f,{key:0},[_(i(v(t).content||""),1)],64)):v(t).type==2?(a(),r(f,{key:1},[Y],64)):v(t).type==5001?(a(),r(f,{key:2},[K],64)):v(t).type==5002?(a(),r(f,{key:3},[Q],64)):v(t).type?(a(),r(f,{key:4},[Z],64)):M("",!0)]))}}),X={class:"w-full py-4 border-b-[0.5px] border-b4 border-solid"},ee={class:"flex justify-between items-start"},te={class:"text-base text-b1 font-semibold line-clamp-1"},se={class:"shrink-0 text-sm text-b3 font-normal"},ae={class:"mt-1 flex justify-between items-center"},ne={class:"text-xs leading-[18px] text-b3 font-normal line-clamp-1"},oe={key:0,class:"shrink-0 w-fit h-[18px] px-1.5 bg-[#222] rounded-full flex items-center justify-center"},le={class:"text-xs leading-[18px] text-b6 font-normal"},re=L({props:{message:null},emits:["toChat"],setup(n,{emit:h}){return(t,s)=>{var d,p;const c=D("VanImage");return a(),r("div",{class:"flex items-center gap-2",onClick:s[0]||(s[0]=F(x=>h("toChat"),["stop"]))},[S(c,{class:"shrink-0 w-[44px] h-[44px]",round:"",src:n.message.storeLogo,fit:"cover"},null,8,["src"]),o("div",X,[o("div",ee,[o("div",te,i(n.message.storeName||""),1),o("div",se,i(v(H)(((d=n.message.lastMessage)==null?void 0:d.createAt)||n.message.lastMsgTime,{year:"YY/MM/DD",month:"MM/DD",time:"HH:mm"},!1)),1)]),o("div",ae,[o("div",ne,[S(W,{content:(p=n.message.lastMessage)==null?void 0:p.content},null,8,["content"])]),n.message.unreadCount?(a(),r("div",oe,[o("span",le,i(n.message.unreadCount),1)])):M("",!0)])])])}}}),ce=o("img",{src:J,class:"w-5 h-5"},null,-1),ue=[ce],ie={class:"px-4 text-sm h-[calc(100vh-50px)] overflow-y-auto"},ge=L({setup(n){const h=j(),t=l([]),s=l(!1),c=l(!1),d=l(0),p=l(20),x=l(0),y=l(0),C=l(!1),V=async()=>{if(C.value)return;t.value.forEach(u=>{u.unreadCount=0}),C.value=!0;const e=await q();C.value=!1,e.msg=="SUCCESS"&&A(e.data)},B=async()=>{s.value||(s.value=!0,d.value+=1,await E(),s.value=!1)},b=l([]),E=async()=>{var u,m;const e=await U({page:d.value,size:p.value,sync:!0});if(e.msg!="SUCCESS"){c.value=!0;return}if(!e||!e.total){c.value=!0;return}x.value=e.total,y.value=((u=e.data)==null?void 0:u.totalUnread)||0,b.value=((m=e.data)==null?void 0:m.list)||[],t.value=d.value===1?b.value:t.value.concat(b.value),t.value.length>=x.value&&(c.value=!0)},N=async()=>{var m,g;const e=await U({page:1,size:p.value});if(e.msg!="SUCCESS"||!e||!e.total||t.value.length)return;x.value=e.total,y.value=((m=e.data)==null?void 0:m.totalUnread)||0;const u=((g=e.data)==null?void 0:g.list)||[];t.value=d.value===1?u:t.value.concat(u)},I=e=>{h.push({path:"/innerServiceChat",query:{groupId:e.id,shopId:e.shopId,storeName:e.storeName,storeLogo:encodeURIComponent(e.storeLogo)}})};return R(()=>{N()}),(e,u)=>{const m=D("VanList");return a(),$(G,{title:e.$t("service.message")+(y.value?`(${y.value})`:""),class:"bg-white font-Puhui font-normal relative","theme-vars":{}},{right:w(()=>[o("div",{class:"flex-shrink-0 w-5 ml-3",onClick:V},ue)]),default:w(()=>[o("div",ie,[S(m,{loading:s.value,finished:c.value,"finished-text":"","loading-text":e.$t("common.loading"),onLoad:B},{default:w(()=>{var g;return[(a(!0),r(f,null,z(t.value,k=>(a(),$(re,{key:k.id,message:k,onToChat:de=>I(k)},null,8,["message","onToChat"]))),128)),!s.value&&c.value&&((g=t.value)==null?void 0:g.length)<=0?(a(),$(P,{key:0,name:e.$t("common.noMore")},null,8,["name"])):M("",!0)]}),_:1},8,["loading","finished","loading-text"])])]),_:1},8,["title"])}}});export{ge as default};
