import{_ as X,z as Y,x as ht,r as _,y as at,bl as lt,F,G as i,H as o,U as d,I as t,P as $,$ as I,O as n,N as M,Q as c,X as ot,Y as nt,E as ft,V as it,a3 as tt,Z as q,a4 as vt,J as et,K as st,B as _t}from"./vendor-Dr_RpJ_Y.js";import{b as pt,Y as O,k as K,e as xt,bk as H,r as yt,a as gt,z as wt,bl as bt,bm as St}from"./index-BckdT6oc.js";import{P as Q}from"./flashSale-DDyqLyYN.js";import{R as $t}from"./RatioBox-BcgP5qRZ.js";import{l as kt}from"./luckyShopContract-PPMKyYJG.js";import{a as Tt}from"./shop-CeqcS6K2.js";const p=""+new URL("../images/Vector-gray-CScBV3Qn.svg",import.meta.url).href,L=""+new URL("../images/Vector-default-gSiyBMiV.svg",import.meta.url).href,f=e=>(ot("data-v-bdee5bce"),e=e(),nt(),e),At={class:"relative w-full px-4 py-4 flex-center-bw"},Bt={key:0},Ft={key:0,class:"flex flex-col justify-between gap-y-[2px]"},Ct=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),Pt=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),It=[Ct,Pt],Lt={key:1,class:"flex flex-col justify-between gap-y-[2px]"},jt=f(()=>t("img",{src:L,class:"w-[9px] rotate-180",alt:""},null,-1)),Nt=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),Rt=[jt,Nt],Vt={key:2,class:"flex flex-col justify-between gap-y-[2px]"},Ut=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),zt=f(()=>t("img",{src:L,class:"w-[9px]",alt:""},null,-1)),Dt=[Ut,zt],Gt={key:0,class:"flex flex-col justify-between gap-y-[2px]"},Mt=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),Et=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),qt=[Mt,Et],Ot={key:1,class:"flex flex-col justify-between gap-y-[2px]"},Kt=f(()=>t("img",{src:L,class:"w-[9px] rotate-180",alt:""},null,-1)),Ht=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),Qt=[Kt,Ht],Xt={key:2,class:"flex flex-col justify-between gap-y-[2px]"},Yt=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),Jt=f(()=>t("img",{src:L,class:"w-[9px]",alt:""},null,-1)),Zt=[Yt,Jt],Wt={key:0,class:"flex flex-col justify-between gap-y-[2px]"},te=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),ee=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),se=[te,ee],ae={key:1,class:"flex flex-col justify-between gap-y-[2px]"},le=f(()=>t("img",{src:L,class:"w-[9px] rotate-180",alt:""},null,-1)),oe=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),ne=[le,oe],ie={key:2,class:"flex flex-col justify-between gap-y-[2px]"},ce=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),re=f(()=>t("img",{src:L,class:"w-[9px]",alt:""},null,-1)),ue=[ce,re],de=Y({props:{filterShow:{type:Boolean,default:!1}},emits:["changeType","change"],setup(e,{emit:C}){const{filterShow:g}=e,{t:w}=ht(),v=_(null),k=at(()=>[{text:w("common.all"),value:null},{text:w("flashSale.progressing"),value:1},{text:w("flashSale.notStart"),value:2},{text:w("flashSale.over"),value:3}]),x=y=>{C("changeType",y)},s=lt({timeStatus:0,priceStatus:0,totalPrice:0}),b=()=>{s.priceStatus=0,s.totalPrice=0,s.timeStatus<2?s.timeStatus++:s.timeStatus=0},S=()=>{s.timeStatus=0,s.totalPrice=0,s.priceStatus<2?s.priceStatus++:s.priceStatus=0},j=()=>{s.priceStatus=0,s.timeStatus=0,s.totalPrice<2?s.totalPrice++:s.totalPrice=0};return(y,l)=>{const u=F("van-dropdown-item"),T=F("van-dropdown-menu");return o(),i("div",At,[g?(o(),i("div",Bt,[$(T,{class:"w-full",ref:(m,R)=>{R.menuRef=m},"active-color":"#FB1A18",overlay:!1},{default:I(()=>[$(u,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=m=>v.value=m),options:n(k),onChange:x},null,8,["modelValue","options"])]),_:1},512)])):d("",!0),t("div",{class:"gap-6 flex-center",onClick:l[1]||(l[1]=m=>C("change",n(s)))},[t("div",{class:"gap-1 text-sm flex-center",onClick:S},[t("span",{class:M({"font-bold":n(s).priceStatus!==0})},c(y.$t("flashSale.time")),3),n(s).priceStatus===0?(o(),i("div",Ft,It)):d("",!0),n(s).priceStatus===1?(o(),i("div",Lt,Rt)):d("",!0),n(s).priceStatus===2?(o(),i("div",Vt,Dt)):d("",!0)]),t("div",{class:"gap-1 text-sm flex-center",onClick:j},[t("span",{class:M({"font-bold":n(s).totalPrice!==0})},c(y.$t("common.total price")),3),n(s).totalPrice===0?(o(),i("div",Gt,qt)):d("",!0),n(s).totalPrice===1?(o(),i("div",Ot,Qt)):d("",!0),n(s).totalPrice===2?(o(),i("div",Xt,Zt)):d("",!0)]),t("div",{class:"gap-1 text-sm flex-center",onClick:b},[t("span",{class:M({"font-bold":n(s).timeStatus!==0})},c(y.$t("flashSale.progress-rate")),3),n(s).timeStatus===0?(o(),i("div",Wt,se)):d("",!0),n(s).timeStatus===1?(o(),i("div",ae,ne)):d("",!0),n(s).timeStatus===2?(o(),i("div",ie,ue)):d("",!0)])])])}}}),me=X(de,[["__scopeId","data-v-bdee5bce"]]),ct=e=>(ot("data-v-2d533599"),e=e(),nt(),e),he={class:"w-[6.5rem] h-[6.5rem] relative"},fe={key:0,class:"absolute bottom-0 flex items-center w-full h-6 text-white rounded-br-xl rounded-bl-xl justify-evenly flex-nowrap goods-mask"},ve={class:"text-[0.675rem]"},_e={class:"text-[0.75rem]"},pe={key:1,class:"absolute bottom-0 flex items-center w-full h-6 text-white rounded-br-xl rounded-bl-xl justify-evenly flex-nowrap goods-mask"},xe={class:"text-[0.675rem]"},ye={class:"text-[0.75rem]"},ge={key:2,class:"absolute bottom-0 flex items-center justify-center w-full h-full grabbed-mask rounded-xl"},we=["src"],be={class:"text-lg text-white"},Se=["src"],$e={class:"w-24 flex flex-col justify-between ml-2.5 flex-1"},ke={class:"flex justify-between sm-flex"},Te={class:"text-[#2E2008] text-base font-semibold text-overflow-2 mr-4"},Ae={key:0,class:"text-[#FB1A18] text-xs"},Be={key:1,class:"text-[#FB1A18] text-xs"},Fe={key:2,class:"flex items-center"},Ce={class:"w-36 h-1.5 rounded bg-[#F1F1F1]"},Pe={class:"ml-auto whitespace-nowrap text-[0.675rem] text-[#999999]"},Ie={class:"mt-0.5 text-[#999] font-normal text-xs"},Le={class:"relative flex items-end justify-between"},je={key:0},Ne={class:"mt-1 flex items-center text-xs text-[#666666]"},Re={class:"shrink-0"},Ve=["src"],Ue={class:"flex items-center"},ze={class:"shrink-0 text-xs text-[#2E2008]"},De=["src"],Ge={class:"text-lg text-[#FD4328]"},Me={key:1,class:"flex items-baseline"},Ee={class:"text-xs text-[#999]"},qe={class:"flex items-center text-sm text-primary"},Oe=ct(()=>t("span",{class:"text-default"},c("symbol"),-1)),Ke={key:2,class:"flex items-baseline whitespace-nowrap"},He={class:"text-xs text-[#999]"},Qe=ct(()=>t("span",{class:"flex items-center text-base text-primary"},[t("span",null,c(123)),t("span",{class:"text-default"},c("symbol"))],-1)),Xe={class:"absolute-btn"},Ye=["src"],Je={class:"text-sm text-white absolute top-1/2 left-4 translate-y-[-50%] pb-0.5"},Ze=["src"],We={class:"text-sm text-[#999999] absolute top-1/2 left-2 translate-y-[-50%] pb-0.5 whitespace-nowrap"},ts=Y({props:{data:null,systemTime:null},emits:["rushToBuy","handleTo"],setup(e,{emit:C}){const g=e,{checkLoginAuth:w}=pt(),v=_(null),k=_(""),x=_(null),s=()=>{const l=g.data;if(l.status===10){const u=H(l.endTime)*1e3,T=H(l.startTime)*1e3,m=H(g.systemTime)*1e3;v.value=u-m,x.value=m-T}else l.status===20&&(k.value=yt(l.nextActionTime))},b=()=>{x.value=1e3},S=()=>{v.value=null},j=at(()=>g.data.currentAmount/g.data.totalAmount*100+"%"),y=()=>{w(!0)&&C("handleTo",`/saleGoodDetail?id=${g.data.id}`)};return ft(()=>{s()}),(l,u)=>{var m;const T=F("van-count-down");return o(),i("div",{class:"flex border-b-8 border-solid border-b-[#F9F5F7] bg-white px-4 py-2.5",onClick:u[2]||(u[2]=R=>y())},[t("div",he,[e.data.status==10&&x.value>0&&v.value&&v.value>0?(o(),i("div",fe,[t("span",ve,c(l.$t("flashSale.comingEnd")),1),t("span",_e,[$(T,{class:"text-white",time:v.value,onFinish:S},null,8,["time"])])])):e.data.status==10&&x.value&&x.value<0?(o(),i("div",pe,[t("span",xe,c(l.$t("flashSale.comingStart")),1),t("span",ye,[$(T,{class:"text-white",time:Math.abs(x.value),onFinish:b},null,8,["time"])])])):d("",!0),e.data.status!=10?(o(),i("div",ge,[t("img",{class:"w-16 h-16 absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-50%]",src:n(O)("flashSale/circle.svg"),alt:"",srcset:""},null,8,we),t("span",be,c(l.$t("flashSale.Alreadygrabbed")),1)])):d("",!0),t("img",{class:"object-cover w-full h-full rounded-xl aspect-square",src:e.data.mainImageUrls||n(K)("images/goods/defaultImg.png"),alt:"",srcset:""},null,8,Se)]),t("div",$e,[t("div",null,[t("div",ke,[t("div",Te,c(e.data.title),1),$($t,{ratio:e.data.discountRate||20,class:"h-6"},null,8,["ratio"])]),e.data.status==15?(o(),i("div",Ae,c(l.$t("flashSale.Tobedrawn")),1)):d("",!0),e.data.status==20&&k.value?(o(),i("div",Be,c(l.$t("flashSale.Prizeredemptiondeadline"))+":"+c(k.value),1)):d("",!0),e.data.status==10?(o(),i("div",Fe,[t("div",Ce,[t("div",{class:"h-1.5 rounded bg-[#FB1A18]",style:it(`width: ${n(j)}`)},null,4)]),t("span",Pe,c(l.$t("flashSale.remainGood",{num:e.data.totalAmount-e.data.currentAmount})),1)])):d("",!0),t("div",Ie,c(l.$t("order.quantity",{number:e.data.totalAmount||0})),1)]),t("div",Le,[t("div",null,[((m=e.data)==null?void 0:m.payType)!==n(Q).STORE_CARD?(o(),i("div",je,[t("div",Ne,[t("span",Re,c(l.$t("flashSale.commonPrice")),1),t("img",{class:"ml-1.5 mr-1 w2.5 h-2.5",src:n(K)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,Ve),t("span",null,c(e.data.totalPrice||n(xt)(e.data.price*e.data.totalAmount)),1)]),t("div",Ue,[t("span",ze,c(l.$t("flashSale.flasePrice")),1),t("img",{class:"w-4 h-4 ml-1 mr-1",src:n(K)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,De),t("span",Ge,c(e.data.price),1)])])):d("",!0),e.data.payType===n(Q).MIX?(o(),i("div",Me,[t("span",Ee,c(l.$t("flashSale.storePrice"))+"：",1),t("span",qe,[t("span",null,c(e.data.cardPrice),1),Oe])])):d("",!0),e.data.payType===n(Q).STORE_CARD?(o(),i("div",Ke,[t("span",He,c(l.$t("flashSale.storePrice"))+"：",1),Qe])):d("",!0)]),t("div",Xe,[e.data.status==10&&x.value>0&&v.value>0?(o(),i("div",{key:0,class:"relative ml-auto mr-1",onClick:u[0]||(u[0]=tt(()=>{C("rushToBuy")},["stop"]))},[t("img",{class:"auto h-7",src:n(O)("flashSale/buy-btn.svg"),alt:"",srcset:""},null,8,Ye),t("div",Je,c(l.$t("flashSale.buyNow")),1)])):(o(),i("div",{key:1,class:"relative ml-auto mr-1",onClick:u[1]||(u[1]=tt(()=>{},["stop"]))},[t("img",{class:"auto h-7",src:n(O)("flashSale/end-btn.svg"),alt:"",srcset:""},null,8,Ze),t("div",We,c(e.data.status==10?v.value&&v.value>0?l.$t("flashSale.notStart"):l.$t("flashSale.gooderror"):l.$t("flashSale.Alreadygrabbed")),1)]))])])])])}}}),es=X(ts,[["__scopeId","data-v-2d533599"]]),ss={class:"w-full bg-white goods-border"},as={class:"pt-5"},ls=Y({props:{categoryList:null},emits:["rushToBuy","handleTo"],setup(e,{expose:C,emit:g}){const w=e,{commodityBatch:v}=kt(),k=_(""),{reloadStore:x}=gt(),s=_(!1),b=_(!1),S=_(0),j=_(10),y=_(0),{currentLocale:l}=wt(),u=lt({keyword:"",orderBy:null,categoryId:null,title:null}),T=a=>{a.priceStatus?u.orderBy=a.priceStatus===1?9:10:a.timeStatus?u.orderBy=a.timeStatus===1?8:7:a.totalPrice?u.orderBy=a.totalPrice===1?5:6:u.orderBy=null,S.value=0,V(u)},m=_([]),R=async a=>{var U,z,D,A,B;const r=await St({page:S.value,size:j.value,type:Z.value,...u,...a,deleteFlag:!1});if(!r.success){b.value=!0;return}if(!r.data||!r.total){b.value=!0;return}y.value=r.total;const E=r.data.map(h=>h.id),P=await v(E);for(let h=0;h<r.data.length;h++){r.data[h].currentAmount=(U=P[h])==null?void 0:U.currentAmount,r.data[h].totalAmount=(z=P[h])==null?void 0:z.totalAmount,r.data[h].status=(D=P[h])==null?void 0:D.status,r.data[h].discountRate=+_t(+((A=P[h])==null?void 0:A.discountRate)).div(1e4).toNumber(),r.data[h].nextActionTime=((B=P[h])==null?void 0:B.nextActionTime)*1e3;const N=r.data[h].mainImageUrls.split(",").filter(G=>G!==""&&G!==null&&G!==void 0&&!Number.isNaN(G));r.data[h].mainImageUrls=N&&N.length>0?N[0]:""}m.value=S.value===1?r.data:m.value.concat(r.data),m.value.length>=y.value&&(b.value=!0)},rt=a=>{u.categoryId=w.categoryList[a.name]&&w.categoryList[a.name].id||null,V(u)},V=a=>{m.value=[],S.value=0,y.value=0,b.value=!1,a.pageKey&&a.pageKey==="flashSale"&&(u.title=a==null?void 0:a.title),W(u)},J=_(null),ut=async()=>{const{data:a}=await bt();J.value=a||null},dt=(a,r)=>{a.currentAmount=a.currentAmount+r,a.currentAmount>=a.totalAmount&&(a.status=20)},Z=_(null),mt=a=>{Z.value=a,V(u)},W=async a=>{s.value=!0,S.value+=1,await ut(),await R(a),s.value=!1};return C({handleSearch:V,handleBuySuccess:dt}),(a,r)=>{const E=F("van-loading"),P=F("VanList"),U=F("van-tab"),z=F("van-tabs"),D=F("van-pull-refresh");return o(),i("div",ss,[$(D,{onRefresh:n(x).reload,class:"min-h-screen"},{default:I(()=>[$(me,{"filter-show":!0,onChange:T,onChangeType:mt}),e.categoryList.length==0?(o(),q(E,{key:0,class:"text-center",size:"12px"},{default:I(()=>[vt(c(a.$t("common.loading")),1)]),_:1})):d("",!0),$(z,{active:k.value,"onUpdate:active":r[2]||(r[2]=A=>k.value=A),type:"card",onClickTab:rt},{default:I(()=>[(o(!0),i(et,null,st(e.categoryList,A=>(o(),q(U,{title:A[`${n(Tt)[n(l)]}Name`]||A.name,key:A.id},{default:I(()=>[t("div",as,[$(P,{class:M({"bg-[#F9F5F7]":m.value.length>5}),loading:s.value,"onUpdate:loading":r[1]||(r[1]=B=>s.value=B),finished:b.value,"finished-text":a.$t("common.noMore"),"loading-text":a.$t("common.loading"),onLoad:W},{default:I(()=>[(o(!0),i(et,null,st(m.value,(B,h)=>(o(),q(es,{style:it(h==m.value.length-1?"border-bottom:0":""),key:B,data:B,onRushToBuy:()=>{g("rushToBuy",B)},onHandleTo:r[0]||(r[0]=N=>{g("handleTo",N)}),systemTime:J.value},null,8,["style","data","onRushToBuy","systemTime"]))),128))]),_:2},1032,["class","loading","finished","finished-text","loading-text"])])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1},8,["onRefresh"])])}}}),ds=X(ls,[["__scopeId","data-v-ec3657b6"]]);export{ds as F};
