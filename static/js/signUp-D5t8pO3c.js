import{_ as ee,r as $,x as X,E as F,K as J,G as p,N as R,H as e,F as b,I as re,J as $e,R as q,O as V,P as m,a2 as P,Q as S,ba as O,bm as Q,$ as z,Y as ue,Z as me,T as f,a0 as De,y as Ee,z as ye,bh as Re,a4 as be,bc as K,l as qe,aH as Me}from"./vendor-CjApaIpB.js";import{_ as ze}from"./upload-B7OBZe8E.js";import{_ as Se}from"./warring-l3BwjimF.js";import{g as Ie,ax as xe,u as Oe,a2 as Qe,q as He}from"./index-lKIcPnY0.js";import{u as Ke}from"./upload-g92hiEmD.js";import{u as Ce,c as we,a as Je,d as We,b as Ze,e as Xe,s as Ye,f as et}from"./festivalActivities-DbAdwSpI.js";import{B as tt}from"./BackIcon-D2Vm_lyR.js";import{_ as Y}from"./MCOIN-BcbOHmhy.js";const st="/Test-dev/static/images/store-icon-DZ762DiT.svg",te="/Test-dev/static/images/arrow-right-DMKQsykc.svg",ot="/Test-dev/static/images/success-Dqce5lP_.png",lt="/Test-dev/static/images/theme1-DseoXVh-.png",at="/Test-dev/static/images/theme2-BHqemVRM.png",nt="/Test-dev/static/images/theme3-BokhnQCr.png",M=c=>(ue("data-v-a43a04fa"),c=c(),me(),c),ct={class:"content"},it=M(()=>e("div",{class:"title text-base text-b1 font-semibold text-center"}," 选择活动商品 ",-1)),dt={key:1,class:"goods-list"},rt={class:"check-box"},ut=["onClick"],mt={class:"goods-item-content"},pt={class:"img-box"},vt={class:"right"},ft={class:"goods-title text-base leading-[22px] text-b1 font-semibold line-clamp-1 height-[22px]"},ht={class:"row mt-2.5 leading-[20px]"},_t=M(()=>e("span",{class:"label"},"当前库存",-1)),gt={class:"value"},yt={key:0,class:"row mt-2.5"},bt=M(()=>e("span",{class:"label act-label"},"活动库存",-1)),xt=["onUpdate:modelValue","onInput","onFocus"],wt=M(()=>e("span",{class:"unit"},"份",-1)),kt={class:"row mt-2.5 leading-[20px]"},$t=M(()=>e("span",{class:"label"},"当前价格",-1)),St={class:"value"},It={class:"coin"},Ct=["src"],At={key:1,class:"row mt-2.5"},Lt=M(()=>e("span",{class:"label act-label"},"活动价",-1)),Vt=["onUpdate:modelValue","onInput","onFocus"],Pt={class:"coin w-4 h-4"},Tt=["src"],Gt=M(()=>e("div",{class:"tip text-xs text-b2 font-normal text-center"}," 商品审核通过后无法更改，报名期间可继续提交新商品 ",-1)),Nt={class:"footer-bar"},Ut=M(()=>e("span",{class:"text-sm text-b1 font-normal ml-1"},"全选",-1)),Ft={class:"text-base text-b1 font-semibold"},jt={props:{show:{type:Boolean,default:!1},goodsList:{type:Array,default:()=>[]}},emits:["close","confirm"],setup(c,{emit:A}){const r=c,x=$(!1),w=X(()=>r.goodsList.filter(l=>!!l.selected).length),d=$(!1),L=()=>{r.goodsList.length!==0&&(d.value=!d.value,d.value?r.goodsList.forEach(l=>{l.stock>0&&(l.selected=!0)}):r.goodsList.forEach(l=>{l.selected=!1}))},k=l=>{r.goodsList[l].selected=!r.goodsList[l].selected;const o=r.goodsList.filter(n=>!!n.selected).length,s=r.goodsList.length;o===s?d.value=!0:d.value=!1},j=()=>{const l=r.goodsList.filter(s=>s.selected);for(const s of l){const n=s.goodsName?s.goodsName.slice(0,8)+"...":"";if(!s.activityStock){f(`[${n}]请输入活动库存`);return}if(!s.activityPrice){f(`[${n}]请输入活动价格`);return}if(Number(s.activityStock)>Number(s.stock)){f(`[${n}]活动库存不能大于当前库存`);return}if(Number(s.activityPrice)>Number(s.price)){f(`[${n}]活动价格不能高于当前价格`);return}}const o=l.map(s=>({goodsId:s.id,activityPrice:s.activityPrice,activityStock:s.activityStock}));A("confirm",o)},N=()=>{d.value=!1},U=()=>{N(),A("close")},B=()=>{N(),A("close")},D=(l,o)=>{const s=l.target.value.replace(/[^\d]/g,"");r.goodsList[o].activityStock=s},g=(l,o)=>{const s=l.target.value;if((s.match(/\./g)||[]).length>1){const n=s.split(".");r.goodsList[o].activityPrice=n[0]+"."+n.slice(1).join("");return}s.includes(".")&&s.split(".")[1].length>2&&(r.goodsList[o].activityPrice=Number(s).toFixed(2))},a=l=>{const s=document.querySelector(".goods-list").querySelectorAll(".goods-item");s[l]&&setTimeout(()=>{s[l].scrollIntoView({behavior:"smooth",block:"start"})},300)};return(l,o)=>{const s=F("van-empty"),n=F("van-image"),y=F("van-button"),I=F("VanPopup");return p(),J(I,{show:c.show,"onUpdate:show":o[0]||(o[0]=h=>z(show)?show.value=h:null),round:"",position:"bottom","close-on-click-overlay":"",onClose:B,closeable:"",onClickOverlay:U},{default:R(()=>[e("div",ct,[it,c.goodsList.length===0?(p(),J(s,{key:0,description:"没有可选商品"})):(p(),b("div",dt,[(p(!0),b(re,null,$e(c.goodsList,(h,E)=>(p(),b("div",{key:h.id,class:"goods-item"},[e("div",rt,[e("div",{class:q(["check-icon",{checked:h.selected}]),onClick:T=>k(E)},null,10,ut)]),e("div",mt,[e("div",pt,[V(n,{width:"80",height:"80",src:h.icons&&h.icons.split(",")[0]||m(Ie)("images/activity/boutique/squre_empty.png"),fit:"cover"},null,8,["src"])]),e("div",vt,[e("div",ft,S(h.goodsName),1),e("div",ht,[_t,e("span",gt,S(h.stock)+" 份",1)]),h.selected?(p(),b("div",yt,[bt,O(e("input",{"onUpdate:modelValue":T=>h.activityStock=T,type:"tel",placeholder:"请输入活动库存",class:"input act-input",onInput:T=>D(T,E),onFocus:T=>a(E)},null,40,xt),[[Q,h.activityStock]]),wt])):P("",!0),e("div",kt,[$t,e("span",St,S(h.price),1),e("span",It,[e("img",{src:m(Y),alt:"MC",class:"w-4 h-4"},null,8,Ct)])]),h.selected?(p(),b("div",At,[Lt,O(e("input",{"onUpdate:modelValue":T=>h.activityPrice=T,type:"number",pattern:"^\\d*\\.?\\d{0,2}$",step:"0.01",inputmode:"decimal",placeholder:"请输入活动价格",class:"input act-input",onInput:T=>g(T,E),onFocus:T=>a(E)},null,40,Vt),[[Q,h.activityPrice]]),e("span",Pt,[e("img",{src:m(Y),alt:"MC",class:"w-4 h-4"},null,8,Tt)])])):P("",!0)])])]))),128))])),Gt,e("div",Nt,[e("div",{class:q(["flex items-center mr-2",{"all-sel-disabled":c.goodsList.length===0}])},[e("div",{class:q(["check-icon",{checked:d.value}]),onClick:L},null,2),Ut],2),V(y,{type:"primary",block:"",class:"submit-btn",loading:x.value,disabled:!m(w),onClick:j},{default:R(()=>[e("span",Ft," 已选"+S(m(w))+"件，提交 ",1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["show"])}}},Bt=ee(jt,[["__scopeId","data-v-a43a04fa"]]),W=c=>(ue("data-v-0293a49c"),c=c(),me(),c),Dt={class:"content"},Et={class:"title text-base text-b1 font-semibold text-center"},Rt={key:0},qt={class:"goods-list"},Mt={class:"goods-item-content"},zt={class:"img-box"},Ot={class:"right"},Qt={class:"goods-title text-base text-b1 font-semibold"},Ht={class:"row leading-[20px] mt-2"},Kt=W(()=>e("span",{class:"label"},"当前库存",-1)),Jt={class:"value"},Wt={class:"row mt-2 leading-[20px]"},Zt=W(()=>e("span",{class:"label act-label"},"活动库存",-1)),Xt=["onUpdate:modelValue","placeholder","onInput","onFocus"],Yt=W(()=>e("span",{class:"unit"},"份",-1)),es={key:1,class:"value"},ts={class:"row mt-2 leading-[20px]"},ss=W(()=>e("span",{class:"label"},"原活动价",-1)),os={class:"value"},ls={class:"coin"},as=["src"],ns={class:"row mt-2 leading-[20px]"},cs=W(()=>e("span",{class:"label act-label"},"新活动价",-1)),is=["onUpdate:modelValue","placeholder","onInput","onFocus"],ds={key:1,class:"value"},rs={class:"coin w-4 h-4"},us=["src"],ms={props:{show:{type:Boolean,default:!1},info:{type:Object,default:()=>{}},status:{type:[Number,String],default:""},goodsList:{type:Array,default:()=>[]}},emits:["close","refresh"],setup(c,{emit:A}){const r=c,x={1:"审核中的商品",2:"审核通过的商品",3:"审核不通过的商品"},w={1:"underReviewCount",2:"passCount",3:"notPassedCount"},d=X(()=>r.info[w[r.status]]||0),L=()=>{if(r.status===3)return!0;for(const a of r.goodsList){if(r.status===1&&Number(a.actPrice)>Number(a.activityPrice))return f("新活动价必须低于原活动价"),!1;if(r.status===2&&Number(a.actPrice)>Number(a.activityPrice))return f("审核通过后活动价不能涨价"),!1}return!0},k=$(!1),j=()=>{if(k.value||(console.log("handleConfirm"),!L()))return;let a=[];for(const o of r.goodsList)a.push({id:o.id,goodsId:o.goodsId,activityStock:o.actStock,activityPrice:o.actPrice});const l={generalActivityId:1,goodsInfoList:a||[]};k.value=!0,Ce(l).then(o=>{o.code==1&&(f.success("保存成功"),A("refresh"))}).catch(o=>{}).finally(()=>{k.value=!1})},N=()=>{A("close")},U=()=>{A("close")},B=(a,l)=>{const o=a.target.value.replace(/[^\d]/g,"");r.goodsList[l].actStock=o},D=(a,l)=>{const o=a.target.value;o.includes(".")&&o.split(".")[1].length>2&&(r.goodsList[l].actPrice=Number(o).toFixed(2))},g=a=>{const o=document.querySelector(".goods-list").querySelectorAll(".goods-item");o[a]&&setTimeout(()=>{o[a].scrollIntoView({behavior:"smooth",block:"start"})},300)};return(a,l)=>{const o=F("van-image"),s=F("VanPopup");return p(),J(s,{show:c.show,"onUpdate:show":l[2]||(l[2]=n=>z(show)?show.value=n:null),round:"",position:"bottom","close-on-click-overlay":"",onClose:U,closeable:"",onClickOverlay:N},{default:R(()=>[e("div",Dt,[e("div",Et,[De(S(x[c.status]||"--")+" ",1),m(d)?(p(),b("span",Rt,"("+S(m(d)||0)+")",1)):P("",!0)]),e("div",qt,[(p(!0),b(re,null,$e(c.goodsList,(n,y)=>(p(),b("div",{key:n.id,class:"goods-item"},[e("div",Mt,[e("div",zt,[V(o,{width:"80",height:"80",src:n.goodsIcons&&n.goodsIcons.split(",")[0]||m(Ie)("images/activity/boutique/squre_empty.png"),fit:"cover"},null,8,["src"])]),e("div",Ot,[e("div",Qt,S(n.goodsName||"--"),1),e("div",Ht,[Kt,e("span",Jt,S(n.activityStock)+" 份",1)]),e("div",Wt,[Zt,c.status===1||c.status===2?(p(),b(re,{key:0},[O(e("input",{"onUpdate:modelValue":I=>n.actStock=I,type:"tel",placeholder:`目前活动库存${n.activityStock}`,class:"input act-input",onInput:I=>B(I,y),onFocus:I=>g(y),onBlur:l[0]||(l[0]=I=>j())},null,40,Xt),[[Q,n.actStock]]),Yt],64)):(p(),b("span",es,S(n.actStock)+" 份",1))]),e("div",ts,[ss,e("span",os,S(n.activityPrice),1),e("span",ls,[e("img",{src:m(Y),alt:"MC",class:"w-4 h-4"},null,8,as)])]),e("div",ns,[cs,c.status===1?O((p(),b("input",{key:0,"onUpdate:modelValue":I=>n.actPrice=I,type:"number",pattern:"^\\d*\\.?\\d{0,2}$",step:"0.01",inputmode:"decimal",placeholder:`目前活动价格${n.activityPrice}`,class:"input act-input",onInput:I=>D(I,y),onFocus:I=>g(y),onBlur:l[1]||(l[1]=I=>j())},null,40,is)),[[Q,n.actPrice]]):(p(),b("span",ds,S(n.activityPrice),1)),e("span",rs,[e("img",{src:m(Y),alt:"MC",class:"w-4 h-4"},null,8,us)])])])])]))),128))])])]),_:1},8,["show"])}}},ps=ee(ms,[["__scopeId","data-v-0293a49c"]]),vs={class:"keyboard-input"},fs=["placeholder"],hs=["onClick"],_s={key:2,class:"keyboard-preview"},gs=Ee({props:{modelValue:null,placeholder:null,max:null,maxTips:{type:Boolean,default:!1},reg:{default:/^\d+(\.\d{0,4})?$/},inputShow:{type:Boolean,default:!0},classStyle:null,extraKey:{default:"."},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","onConfirm","keyboardShow"],setup(c,{expose:A,emit:r}){const x=c,w=$(!1),d=$(""),L=$(x.modelValue?String(x.modelValue):""),k=$(x.modelValue?String(x.modelValue):""),j=g=>{if(x.max&&+`${d.value}${g}`>+x.max){x.maxTips&&f("无法超过最大值"+x.max),d.value=xe(Number(x.max)),L.value=xe(Number(x.max));return}(x.reg?x.reg.test(`${d.value}${g}`):!0)&&(d.value=`${d.value}${g}`)},N=()=>{d.value=d.value+"",d.value=d.value?d.value.slice(0,-1):""},U=()=>{k.value=d.value,r("update:modelValue",k.value),r("onConfirm"),w.value=!1};ye(()=>x.modelValue,g=>{try{const a=g!=null?String(g):"";if(a&&isNaN(Number(a))){k.value="",L.value="",d.value="";return}k.value=a,L.value=a,d.value=a}catch{k.value="",L.value="",d.value=""}}),ye(()=>w.value,g=>{g&&(d.value=k.value),r("keyboardShow",g)}),Re(()=>{});const B=()=>{w.value=!0},D=()=>{w.value=!1};return A({toShow:B,show:w}),(g,a)=>{const l=F("van-number-keyboard");return p(),b("div",vs,[c.inputShow?O((p(),b("input",{key:0,"onUpdate:modelValue":a[0]||(a[0]=o=>k.value=o),style:{width:"100%"},readonly:"",clickable:"",placeholder:c.placeholder,class:q(["text-right",c.classStyle]),onClick:a[1]||(a[1]=be(o=>c.disabled?null:w.value=!0,["stop"]))},null,10,fs)),[[Q,k.value]]):P("",!0),w.value?(p(),b("div",{key:1,class:"keyboard-mask",onClick:be(D,["stop","prevent"])},null,8,hs)):P("",!0),w.value?(p(),b("div",_s,[e("div",{class:q(["preview-value",{empty:!d.value}])},S(d.value||c.placeholder),3)])):P("",!0),V(l,{modelValue:L.value,"onUpdate:modelValue":a[2]||(a[2]=o=>L.value=o),class:"flash-keyboard",theme:"custom","extra-key":c.extraKey,"close-button-text":g.$t("common.confirm"),show:w.value,"safe-area-inset-bottom":"",transition:!1,onBlur:a[3]||(a[3]=o=>w.value=!1),onInput:j,onDelete:N,onClose:U,onHide:U},null,8,["modelValue","extra-key","close-button-text","show"])])}}}),ke=ee(gs,[["__scopeId","data-v-ad34de10"]]),v=c=>(ue("data-v-2218285a"),c=c(),me(),c),ys={class:"w-full h-full sign-up-container bg-flash-linear"},bs={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[44px] px-2.5 z-50"},xs={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},ws=v(()=>e("div",{class:"font-bold text-b1 text-lg"},"报名活动",-1)),ks={class:"w-full h-[calc(100vh-44px)] overflow-y-scroll py-3 px-3 pb-[120px]"},$s={class:"store-info-edit__wrap py-4 px-3"},Ss={class:"store-name flex justify-start items-center gap-1"},Is=v(()=>e("img",{class:"w-5 h-5",src:st,alt:"店铺logo"},null,-1)),Cs={class:"store-name-text text-b1 text-base font-semibold line-clamp-1"},As={class:"store-main-pic__wrap mt-4"},Ls=v(()=>e("p",{class:"text-b1 text-sm font-semibold"},"活动期间店铺主图",-1)),Vs={class:"mt-2"},Ps=v(()=>e("div",{class:"w-full"},[e("img",{src:ze,class:"w-[24px] h-[24px] m-auto object-cover"}),e("div",{class:"text-xxs opacity-30"},"添加图片")],-1)),Ts=v(()=>e("div",{class:"divider-line mt-4"},null,-1)),Gs={class:"store-slogan__wrap mt-4"},Ns=v(()=>e("p",{class:"text-b1 text-sm font-semibold"},"店铺自定义活动标语(选填)",-1)),Us={class:"mt-1 flex justify-start items-center"},Fs=["disabled"],js={class:"m-w-[23px] whitespace-nowrap text-b3 font-normal text-sm ml-1"},Bs=v(()=>e("div",{class:"divider-line mt-4"},null,-1)),Ds={class:"store-discount__wrap mt-4"},Es=v(()=>e("p",{class:"text-b1 text-sm font-semibold"},"请设置满减金额",-1)),Rs={class:"mt-2 flex justify-start items-center"},qs=v(()=>e("span",null,"全店满",-1)),Ms={class:"act-label"},zs=v(()=>e("span",null,"MC，减去",-1)),Os={class:"act-label"},Qs=v(()=>e("span",null,"MC",-1)),Hs={class:"store-theme-edit__wrap mt-3 py-4 px-3"},Ks=v(()=>e("p",{class:"text-b1 text-sm font-semibold line-clamp-1"},"活动主题标",-1)),Js={class:"theme-selector w-full flex justify-start items-center gap-2 mt-2"},Ws=["src"],Zs=["src"],Xs=["src"],Ys=v(()=>e("p",{class:"text-b1 text-sm font-semibold"},"活动商品",-1)),eo=v(()=>e("p",{class:"ml-auto text-b3 text-sm font-normal"}," 选择参与闪电猫2周年活动的商品 ",-1)),to=v(()=>e("img",{class:"h-4 w-4 ml-[2px]",src:te,alt:"more"},null,-1)),so=[Ys,eo,to],oo=v(()=>e("p",{class:"text-b1 text-sm font-semibold"},"审核中的商品",-1)),lo={class:"ml-auto text-b3 text-sm font-normal"},ao=v(()=>e("img",{class:"h-4 w-4 ml-[2px]",src:te,alt:"more"},null,-1)),no=v(()=>e("p",{class:"text-b1 text-sm font-semibold"},"审核通过的商品",-1)),co={class:"ml-auto text-b3 text-sm font-normal"},io=v(()=>e("img",{class:"h-4 w-4 ml-[2px]",src:te,alt:"more"},null,-1)),ro=v(()=>e("p",{class:"text-b1 text-sm font-semibold"},"审核不通过的商品",-1)),uo={class:"ml-auto text-b3 text-sm font-normal"},mo=v(()=>e("img",{class:"h-4 w-4 ml-[2px]",src:te,alt:"more"},null,-1)),po={class:"fixed bottom-0 left-0 right-0 py-4 px-3 bg-[#F2F0EF] flex flex-col gap-2"},vo=v(()=>e("div",{class:"text-center"},[e("p",{class:"text-b2 text-sm font-normal whitespace-pre-line"}," 商品审核通过后无法更改，报名期间可继续提交新商品 ")],-1)),fo={key:0,class:"flex justify-between gap-3"},ho=v(()=>e("span",{class:"text-b1 text-base font-normal"},"取消报名",-1)),_o=v(()=>e("span",{class:"text-b1 text-base font-normal"},"提交新商品",-1)),go=v(()=>e("div",{class:"flex flex-col justify-center items-center"},[e("img",{src:ot,class:"w-10 h-10",alt:"成功"}),e("p",{class:"text-b2 text-sm font-normal text-center mt-3"}," 恭喜你，报名成功 ")],-1)),yo={class:"flex flex-col justify-center items-center"},bo=v(()=>e("img",{src:Se,class:"w-10 h-10",alt:"警告"},null,-1)),xo={class:"text-b2 text-sm font-normal text-center mt-3"},wo=v(()=>e("div",{class:"flex flex-col justify-center items-center"},[e("img",{src:Se,class:"w-10 h-10",alt:"警告"}),e("p",{class:"text-b2 text-sm font-normal text-center mt-3"}," 很遗憾，暂不符合报名条件 ")],-1)),ko={setup(c){const A=qe(),{getCurrentStoreId:r}=Oe(),[x,w]=K(!1),[d,L]=K(!1),[k,j]=K(!1),N=$("很遗憾，已过活动报名时间"),[U,B]=K(!1),[D,g]=K(!1),a=()=>{j(!1),location.reload()},l=()=>{g(!1),A.back()},o=()=>{var t,_;return(_=(t=JSON.parse(localStorage.getItem("user")))==null?void 0:t.store)==null?void 0:_.storeName},s=$({mainImage:[],slogan:"",generalActivityLabelIds:3,fullAmount:"",reduceAmount:""}),n=X(()=>y.value=="1"||y.value=="2"||y.value=="3"),y=$(""),I=X(()=>y.value=="1"||y.value=="2"||y.value=="3"),h=$({underReviewCount:0,passCount:0,notPassedCount:0,fmGeneralActivityShop:{},fmGeneralActivityLabelList:{}}),E=$({fmGeneralActivity:{applyStartTime:"",applyEndTime:"",preStartTime:"",preEndTime:"",startTime:"",endTime:""},fmGeneralActivityLabelList:[],fmGeneralActivityRule:{}}),T=async()=>{Je({generalActivityId:1}).then(t=>{t.code==1?E.value=t.data:t.message&&f(t.message)})},se=async()=>{var _,G,C,u,fe,he,_e,ge;const i={generalActivityId:1};f.loading({duration:0});const t=await Ze(i);if(f.clear(),t.code===1){h.value=t.data||{},y.value=((G=(_=t.data)==null?void 0:_.fmGeneralActivityShop)==null?void 0:G.status)||"";const H=(C=t.data)==null?void 0:C.fmGeneralActivityShop;H&&(H.mainImage&&(s.value.mainImage=[{url:H.mainImage}]),s.value.slogan=H.slogan||"",(u=t.data)!=null&&u.fmGeneralActivityLabelList&&(console.log(H.fmGeneralActivityLabelList),s.value.generalActivityLabelIds=((fe=t.data)==null?void 0:fe.fmGeneralActivityLabelList[0].id)||null));const de=(he=t.data)==null?void 0:he.fmGeneralActivityRule;de&&(s.value.fullAmount=((_e=de.fullAmount)==null?void 0:_e.toString())||"",s.value.reduceAmount=((ge=de.reduceAmouint)==null?void 0:ge.toString())||"")}},Ae=async i=>{const t=await Qe(i,"shopScenery"),_=await Ke(t);if(!_.success)return s.value.mainImage.length-=1;s.value.mainImage[s.value.mainImage.length-1]={url:He.imgUrl+_.data},console.log(s.value.mainImage)},oe=i=>{n.value||(s.value.generalActivityLabelIds=i)},le=$(""),ae=$([]),pe=$([]),ne=$(!1),Le=async()=>{ne.value=!1,await ve(),w(!0)},Ve=async()=>{ne.value=!0,await ve(),w(!0)},Pe=async()=>{const i=le.value;await Z(i)},Z=async i=>{var G;le.value=i||"0";const t={generalActivityId:1,status:i,shopId:(G=await r())==null?void 0:G.id,page:1,size:9999};f.loading({duration:0});const _=await We(t);f.clear(),_.code===1&&_.data.length>0?(ae.value=_.data||[],ae.value.forEach(C=>{C.actStock=C.activityStock,C.actPrice=C.activityPrice}),L(!0)):f("该状态下暂无商品")},Te=async()=>{try{const i=await we();i.code===1&&!i.data?g(!0):i.data===!0&&se()}catch(i){console.error("检查白名单失败:",i),g(!0),A.back()}},ve=async()=>{var _;const i={exclude:!0,shopId:(_=await r())==null?void 0:_.id,page:1,size:9999};f.loading({duration:0,message:"获取商品中..."});const t=await Xe(i);f.clear(),t.code===1&&(pe.value=t.data||[])},ce=$(!1),ie=$(!1),Ge=()=>{Me.confirm({title:"取消报名",message:"确定取消报名吗？"}).then(()=>{Ne()}).catch(()=>{})},Ne=async()=>{try{ce.value=!0,(await et({generalActivityId:1})).code===1&&(f.success("取消报名成功"),setTimeout(()=>{A.replace("/520-index")},500))}catch(i){console.error("取消报名失败:",i),f("取消报名失败")}finally{ce.value=!1}},Ue=i=>{const t=new Date().getTime();if(t<E.value.fmGeneralActivity.preStartTime){N.value="还未到活动报名时间",B(!0);return}if(t>E.value.fmGeneralActivity.applyEndTime){N.value="很遗憾，已过活动报名时间",B(!0);return}ne.value?je(i):Fe(i)},Fe=async i=>{var G;const t={generalActivityId:1,...s.value,goodsList:i};if(t.mainImage.length==0){f.fail("请上传店铺活动主图");return}else t.mainImage=((G=t.mainImage[0])==null?void 0:G.url)||"";if(!t.mainImage){f.fail("请上传店铺活动主图");return}if(t.slogan&&t.slogan.length>9){f.fail("标语长度不能超过9个字符");return}if(!t.generalActivityLabelIds){f.fail("请选择活动主题标");return}const _=await we();if(_.code===1&&!_.data){g(!0);return}try{ie.value=!0,(await Ye(t)).code===1&&(f.success("提交成功"),w(!1),j(!0),se())}catch(C){console.error("提交失败:",C),f("提交失败")}finally{ie.value=!1}},je=async i=>{Ce({generalActivityId:1,goodsInfoList:i}).then(_=>{_.code==1&&(f.success("保存成功"),w(!1),se())}).catch(_=>{})},Be=i=>{const t=document.querySelector(i);t&&setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})},300)};return Te(),T(),(i,t)=>{const _=F("van-uploader"),G=F("van-button"),C=F("van-dialog");return p(),b("div",ys,[e("section",bs,[e("div",xs,[V(tt)]),ws]),e("section",ks,[e("div",$s,[e("div",Ss,[Is,e("div",Cs,S(o()),1)]),e("div",As,[Ls,e("div",Vs,[V(_,{class:"w-[80px] h-[80px] bg-[#F5F5F5] rounded-lg flex-center",modelValue:s.value.mainImage,"onUpdate:modelValue":t[0]||(t[0]=u=>s.value.mainImage=u),accept:"image/*","preview-size":[150,150],"max-count":1,afterRead:Ae,disabled:m(n),readonly:m(n),deletable:!m(n)},{default:R(()=>[Ps]),_:1},8,["modelValue","disabled","readonly","deletable"])])]),Ts,e("div",Gs,[Ns,e("div",Us,[O(e("input",{"onUpdate:modelValue":t[1]||(t[1]=u=>s.value.slogan=u),type:"text",maxlength:"9",disabled:m(n),class:"w-full font-normal text-b1 text-sm slogan-input",placeholder:"请输入自定义标语，如:满100减10",onFocus:t[2]||(t[2]=u=>Be(".store-slogan__wrap"))},null,40,Fs),[[Q,s.value.slogan]]),e("span",js,S(s.value.slogan.length)+"/9 ",1)])]),Bs,e("div",Ds,[Es,e("div",Rs,[qs,e("div",Ms,[V(ke,{modelValue:s.value.fullAmount,"onUpdate:modelValue":t[3]||(t[3]=u=>s.value.fullAmount=u),placeholder:"请输入","extra-key":"",disabled:m(n),class:"input act-input"},null,8,["modelValue","disabled"])]),zs,e("div",Os,[V(ke,{modelValue:s.value.reduceAmount,"onUpdate:modelValue":t[4]||(t[4]=u=>s.value.reduceAmount=u),placeholder:"请输入","extra-key":"",disabled:m(n),class:"input act-input"},null,8,["modelValue","disabled"])]),Qs])])]),e("div",Hs,[Ks,e("div",Js,[e("div",{class:"theme-selector__item rounded overflow-hidden w-[1/3] flex flex-col justify-center items-center",onClick:t[5]||(t[5]=u=>oe(3))},[e("img",{src:m(nt),alt:"两周年主题3"},null,8,Ws),e("div",{class:q(["check-icon mt-2",{checked:s.value.generalActivityLabelIds==3}])},null,2)]),e("div",{class:"theme-selector__item rounded overflow-hidden w-[1/3] flex flex-col justify-center items-center",onClick:t[6]||(t[6]=u=>oe(2))},[e("img",{src:m(at),alt:"两周年主题2"},null,8,Zs),e("div",{class:q(["check-icon mt-2",{checked:s.value.generalActivityLabelIds==2}])},null,2)]),e("div",{class:"theme-selector__item rounded overflow-hidden w-[1/3] flex flex-col justify-center items-center",onClick:t[7]||(t[7]=u=>oe(1))},[e("img",{src:m(lt),alt:"两周年主题1"},null,8,Xs),e("div",{class:q(["check-icon mt-2",{checked:s.value.generalActivityLabelIds==1}])},null,2)])])]),y.value!="1"&&y.value!="2"&&y.value!="3"?(p(),b("div",{key:0,class:"cell__wrap py-4 px-3 mt-3 flex justify-start items-center",onClick:Le},so)):P("",!0),h.value.underReviewCount?(p(),b("div",{key:1,class:"cell__wrap py-4 px-3 mt-3 flex justify-start items-center",onClick:t[8]||(t[8]=u=>Z(1))},[oo,e("p",lo," 共"+S(h.value.underReviewCount||0)+"件 ",1),ao])):P("",!0),h.value.passCount?(p(),b("div",{key:2,class:"cell__wrap py-4 px-3 mt-3 flex justify-start items-center",onClick:t[9]||(t[9]=u=>Z(2))},[no,e("p",co," 共"+S(h.value.passCount||0)+"件 ",1),io])):P("",!0),h.value.notPassedCount?(p(),b("div",{key:3,class:"cell__wrap py-4 px-3 mt-3 flex justify-start items-center",onClick:t[10]||(t[10]=u=>Z(3))},[ro,e("p",uo," 共"+S(h.value.notPassedCount||0)+"件 ",1),mo])):P("",!0)]),e("div",po,[vo,m(I)?(p(),b("div",fo,[y.value=="1"||y.value=="3"?(p(),J(G,{key:0,class:"btn cancel-btn w-full",type:"primary",size:"large",loading:ce.value,onClick:Ge},{default:R(()=>[ho]),_:1},8,["loading"])):P("",!0),y.value=="1"||y.value=="2"||y.value=="3"?(p(),J(G,{key:1,class:"btn main-btn w-full",type:"primary",size:"large",loading:ie.value,onClick:Ve},{default:R(()=>[_o]),_:1},8,["loading"])):P("",!0)])):P("",!0)]),V(Bt,{show:m(x),"onUpdate:show":t[11]||(t[11]=u=>z(x)?x.value=u:null),"goods-list":pe.value,onConfirm:Ue,onClose:t[12]||(t[12]=u=>m(w)(!1))},null,8,["show","goods-list"]),V(ps,{show:m(d),"onUpdate:show":t[13]||(t[13]=u=>z(d)?d.value=u:null),"goods-list":ae.value,info:h.value,status:le.value,onClose:t[14]||(t[14]=u=>m(L)(!1)),onRefresh:Pe},null,8,["show","goods-list","info","status"]),V(C,{"class-name":"notice-dialog",show:m(k),"onUpdate:show":t[15]||(t[15]=u=>z(k)?k.value=u:null),onClick:a,"show-confirm-button":!1,"close-on-click-overlay":""},{default:R(()=>[go]),_:1},8,["show"]),V(C,{"class-name":"notice-dialog",show:m(U),"onUpdate:show":t[16]||(t[16]=u=>z(U)?U.value=u:null),onClick:m(B),"show-confirm-button":!1,"close-on-click-overlay":""},{default:R(()=>[e("div",yo,[bo,e("p",xo,S(N.value),1)])]),_:1},8,["show","onClick"]),V(C,{"class-name":"notice-dialog",show:m(D),"onUpdate:show":t[17]||(t[17]=u=>z(D)?D.value=u:null),onClick:l,"show-confirm-button":!1,"close-on-click-overlay":""},{default:R(()=>[wo]),_:1},8,["show"])])}}},To=ee(ko,[["__scopeId","data-v-2218285a"]]);export{To as default};
