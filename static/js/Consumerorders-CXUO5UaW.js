import{_ as M}from"./USDT-BFPkoPAz.js";import{_ as A}from"./MCOIN-BcbOHmhy.js";import{_ as q,y as E,l as Y,a1 as z,w as F,r as x,x as H,bf as L,z as J,D as K,E as $,K as Q,G as f,N as p,O as m,H as n,P as t,F as y,J as W,I as O,Q as u,Y as Z,Z as j}from"./vendor-BUT0HZ5j.js";import{C as X}from"./CommonVanProvider-BpsZUrD3.js";import{_ as ss}from"./OfflineGoods-BjltvH3M.js";import{_ as es}from"./OfflineStore-CFe1JKHJ.js";import{B as os}from"./BetweenTab-Bn5ZVRk8.js";import{e as ts,d as P,V as as,bH as rs,bI as ns}from"./index-BvL8wS8a.js";import{a as b,O as ls}from"./offlineGoods-DvT2Go6q.js";import{u as ds}from"./usePaymentBalance-fsTpxNDW.js";import{P as is}from"./order-H59PKTFP.js";import"./BackIcon-biFt6cm7.js";import"./ImgBoutiqueLable-BF5Xoxsv.js";import"./shop-CeqcS6K2.js";/* empty css                                                               */import"./piggyBank-DmnJvorA.js";const _=h=>(Z("data-v-24b0afa6"),h=h(),j(),h),cs=["src"],us={class:"text-b3"},fs={class:"mx-3 py-3 safe-body overflow-y-auto"},ps=["onClick"],ms={class:"text-b3"},_s={class:"flex items-center font-semibold"},hs=_(()=>n("img",{src:M,class:"w-4 h-4 mr-1"},null,-1)),gs=_(()=>n("span",{class:"text-b3 ml-1"},"(",-1)),ys=_(()=>n("img",{src:A,class:"w-4 h-4 mr-1"},null,-1)),bs={class:"text-b1"},vs=_(()=>n("span",{class:"text-b3"},")",-1)),Is=_(()=>n("img",{src:A,class:"w-4 h-4 mr-1"},null,-1)),Cs={class:"text-b1"},Ss=E({name:"ConsumerOrders"});function ws(h){const{regionStore:v,accountStore:l}=ts(),T=Y(),I=z(),{t:g}=F(),B=x(null),k=H(()=>[{label:g("order.To be confirmed"),value:b.PAYMENT_SUCCESS},{label:g("order.canceled"),value:b.CANCELLED},{label:g("order.completed"),value:b.COMPLETED},{label:g("common.all"),value:-1}]),{getPaymentBySource:N}=ds(x(!0)),e=L({status:-1,shopInfo:null,list:[],total:0,loading:!1,finished:!1}),c=L({shopId:null,orderCustomerAddress:l==null?void 0:l.account,page:0,size:20,orderStatus:-1,sortBy:"desc|create_time"}),D=o=>{e.status=o,T.replace({path:"offlineConsumerorders",query:{status:o}}),V()},R=o=>{var a;return(a=k.value.find(r=>+r.value==+o))==null?void 0:a.label},C=o=>{T.push(o)},V=async()=>{e.finished=!1,e.total=0,e.list=[],c.page=0,S()},S=async()=>{if(!(l!=null&&l.sign.address))return e.finished=!0;e.loading=!0,c.orderCustomerAddress=l==null?void 0:l.sign.address,c.page+=1,await G(),e.loading=!1},G=async()=>{e.status<0?delete c.orderStatus:c.orderStatus=e.status;const{success:o,data:a}=await rs(c);if(e.loading=!1,!o){e.finished=!0;return}const{records:r,total:d,current:s,pages:i}=a;if(!d||!r||!(r!=null&&r.length)){e.finished=!0;return}e.total=d;const w=x([]);w.value=r.map(U=>({btnLoading:!1,...U})),e.list=c.page===1?w.value:e.list.concat(w.value),+s>=+i&&(e.finished=!0)};return J(()=>I.path,async o=>{if(o==="/offlineConsumerorders"){const a=sessionStorage.getItem("consumer_offline_refresh_chainOrderId");if(a){const r=e.list.findIndex(d=>d.orderId==a);if(r>-1&&e.status===b.PAYMENT_SUCCESS)e.list.splice(r,1);else if(r>-1&&e.status===-1){const d=await ns({id:a});d.success&&(e.list[r]=d.data||{})}sessionStorage.removeItem("consumer_offline_refresh_chainOrderId")}}},{deep:!0}),K(async()=>{var o,a;(o=I.query)!=null&&o.status&&(e.status=Number((a=I.query)==null?void 0:a.status)),S()}),(o,a)=>{const r=$("VanList"),d=$("router-view");return f(),Q(X,{title:o.$t("offline.main title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(s,i)=>{i.shopGoodsRef=s,B.value=s}},{right:p(()=>[n("img",{src:t(as)(`mall/${t(v).country}-flag.svg`),class:"w-5 h-auto mr-1"},null,8,cs),n("span",us,u(o.$t(`country.${t(v).country}`))+u(t(v).country),1)]),default:p(()=>[m(os,{options:t(k),"label-key":"label","value-key":"value",modelValue:t(e).status,"onUpdate:modelValue":a[0]||(a[0]=s=>t(e).status=s),onChange:D},null,8,["options","modelValue"]),n("div",fs,[m(r,{loading:t(e).loading,"onUpdate:loading":a[1]||(a[1]=s=>t(e).loading=s),finished:t(e).finished,"immediate-check":!1,"finished-text":o.$t("common.noMore"),"loading-text":o.$t("common.loading"),onLoad:S},{default:p(()=>[(f(!0),y(O,null,W(t(e).list,s=>(f(),y("div",{class:"offline-crad-box mb-3",key:s.orderId,onClick:i=>C(`/offlineConsumerDetail?id=${s.orderId}`)},[m(es,{store:{images:s.shopPics,name:s.shopName},showOrderStatus:"",status:R(s.orderStatus)},null,8,["store","status"]),m(ss,{"show-order-type":"",class:"mt-3",goods:{goodsName:s.relName,goodsIcons:s.relIcons,orderType:s.orderType},onImageClick:i=>s.orderType===t(ls).GOODS?C("/offlineConsumerorders/offlineGoodsDetail?goodsId="+s.relId):C("/shop?shopId="+s.relId)},{"bottom-left":p(()=>{var i;return[n("div",ms,u(o.$t((i=t(N)(s.orderPaySource))==null?void 0:i.name)),1)]}),"bottom-price":p(()=>[n("div",_s,[s.orderPaySource===t(is).USDT_WALLET?(f(),y(O,{key:0},[hs,n("span",null,u(t(P)(s==null?void 0:s.orderRealUsdt)),1),gs,ys,n("span",bs,u(t(P)(s==null?void 0:s.orderRealAmount)),1),vs],64)):(f(),y(O,{key:1},[Is,n("span",Cs,u(t(P)(s==null?void 0:s.orderRealAmount)),1)],64))])]),_:2},1032,["goods","onImageClick"])],8,ps))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),m(d,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const xs=E({...Ss,setup:ws}),qs=q(xs,[["__scopeId","data-v-24b0afa6"]]);export{qs as default};
