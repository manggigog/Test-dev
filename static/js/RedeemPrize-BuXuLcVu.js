import{_ as le,z as de,x as ue,bB as g,r as m,y as L,E as ce,G as me,U as O,O as i,H as G,I as s,P as u,Z as pe,Q as l,a4 as y,F as b,$,a0 as fe,T as C,q as ve,X as he,Y as ge,o as ye,B as be}from"./vendor-Dr_RpJ_Y.js";import{_ as we}from"./AddressInfo-2bPrVt2B.js";import{_ as _e}from"./EmptyTipsPop-DFfFg0cQ.js";import{O as xe}from"./OrderGoodsBox-5PjaZvBT.js";import{c as ke,q as $e}from"./address-iY9yI6tl.js";import{V as Ce,e as Ae,a5 as Re,bt as Se,w as De,bq as Be,c as Ve}from"./index-7OiUoGXy.js";import{u as Ie}from"./useSelectAddress-CgNt0r_o.js";import{l as Ne}from"./luckyShopContract-DfZqYfy3.js";import"./mall-DLd1UK-E.js";import"./MCOIN-Bodfn-v1.js";import"./OrderGoods-C5ohlmD4.js";import"./BoutiqueLable-DDlxeK08.js";import"./shop-CeqcS6K2.js";import"./flashSale-DDyqLyYN.js";import"./ShopMaskTips-ClYuWX9C.js";import"./enums-DlE-aiss.js";const Pe=f=>(he("data-v-5081c72a"),f=f(),ge(),f),qe={key:0,class:"p-2.5"},Le={class:"text-xl font-semibold"},Oe={class:"mt-2.5"},Ge={class:"bg-white mt-2.5 rounded-xl p-2.5 flex items-center justify-between gap-2"},Te={class:"flex-1"},Ee={class:"bg-white mt-2.5 rounded-xl p-2.5"},Ke={class:"flex items-baseline justify-between mt-1"},Fe={class:"opacity-60"},Me={class:"text-right"},Ue=Pe(()=>s("div",{class:"text-base font-semibold"},"0Mcoin",-1)),ze={class:"opacity-60"},je={class:"flex flex-col items-center my-[50px]"},He={class:"p-2.5 pb-[150px]"},Qe={class:"relative text-center mb-2.5"},Xe=de({setup(f){const{generateKey:A,decryptAddressKey:T,getUserDhKey:E,encryptAddressKey:R,formatAddressData:S}=Ce(),{luckyComfirmRandom:K,commodities:F}=Ne(),{t:w}=ue(),{loadingToggle:D}=De(),{getAddress:B,setAddress:M}=Ie(),{tradeContributeSelfRate:U}=Ve(),z=ye(),v=ve(),[j,H]=g(!1),[_,x]=g(!1),[Q,X]=g(!0),[Y,V]=g(!1),k=m([]),o=m(),c=m(),p=m(""),h=m(1),Z=L(()=>{var e;return((e=c.value)==null?void 0:e.price)*h.value}),J=L(()=>Ae(I.value/100*Z.value*N.value)),W=async()=>{if(B()){o.value=B(),M(null);return}const e=v.currentRoute.value.path,t=await $e();if(!t.success)return;k.value=t.data;const n=k.value.find(a=>a.isDefault===1)||k.value[0],d=await A("user",e);if(n!=null&&n.encryptFlag&&d){o.value=T(n,d);return}o.value=n},ee=async()=>{const e=await Be(+z.query.id);e.success,c.value=e.data},I=m(null),te=async()=>{const e=await F(c.value.id);I.value=+be(+e.discountRate).div(1e4).toNumber()||20},se=e=>{e<1?h.value=1:h.value=e},oe=async()=>{var r,q;if(!o.value)return C(w("order.setAddress"));if((r=o.value)!=null&&r.encryptFlag&&!((q=o.value)!=null&&q.success))return C(w("order.reconfirm the information"));if(!Re(o.value.telNumber))return C(w("address.number was identified"));const e=v.currentRoute.value.path;V(!0);const t=await E(c.value.shopId),n=await A("user",e);let d;n&&!o.value.encryptFlag&&(d=R(o.value,n),await ke({...d,isDefault:o.value.isDefault?1:0}));let a={};if(t?(a=S(a,{...o.value,postscript:p.value},1),a=R(a,t),a.submitHash=a.hash):a=S(a,{...o.value,postscript:p.value},0),(await Se({odGoodsId:c.value.id,...a})).success){const ie=await K(c.value.id);if(V(!1),!ie.success)return;v.replace({path:"/flashSale",query:{refresh:1}})}},N=m(0),ae=async()=>{N.value=await U()},ne=async()=>{D(!0),await W(),await ee(),await te(),ae(),D(!1),X(!1)},re=e=>{v.push(e)};return ce(()=>{ne()}),(e,t)=>{const n=b("van-icon"),d=b("VanButton"),a=b("van-field"),P=b("VanPopup");return i(Q)?O("",!0):(G(),me("div",qe,[s("header",Le,l(e.$t("order.submitOrder")),1),u(we,{class:"mt-2.5",defaultAddress:o.value,onClick:t[0]||(t[0]=r=>re("/userAddress"))},null,8,["defaultAddress"]),s("div",Oe,[u(xe,{needMask:!1,orderInfo:c.value,number:h.value,onChangeNumber:se,isDisabledEdit:!0,isDisabledEditCount:!0},null,8,["orderInfo","number"])]),s("div",Ge,[s("div",Te,l(e.$t("order.remark")),1),s("div",{class:"flex-1 text-right line-clamp-1 opacity-60 whitespace-nowrap",onClick:t[1]||(t[1]=r=>i(x)(!0))},[y(l(p.value?p.value:e.$t("order.noRemark"))+" ",1),u(n,{name:"arrow"})])]),s("div",Ee,[s("div",null,l(e.$t("order.priceDetail")),1),s("div",Ke,[s("div",Fe,l(e.$t("order.total")),1),s("div",Me,[Ue,s("div",ze,l(e.$t("order.getContribution",{num:i(J)})),1)])])]),s("div",je,[u(d,{class:"btn-orange btn-shadow w-[150px] h-[40px] text-white",loading:i(Y),onClick:oe},{default:$(()=>[y(l(e.$t("common.confirm")),1)]),_:1},8,["loading"])]),u(P,{show:i(_),"onUpdate:show":t[5]||(t[5]=r=>fe(_)?_.value=r:null),position:"bottom",round:"",style:{"text-align":"center"}},{default:$(()=>[s("div",He,[s("div",Qe,[y(l(e.$t("order.submitOrder"))+" ",1),s("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:t[2]||(t[2]=r=>i(x)(!1))},[u(n,{name:"cross"})])]),u(a,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=r=>p.value=r),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:e.$t("order.remarkDes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),u(d,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",onClick:t[4]||(t[4]=r=>i(x)(!1))},{default:$(()=>[y(l(e.$t("common.confirm")),1)]),_:1})]),_:1},8,["show"]),i(j)?(G(),pe(_e,{key:0,onClose:t[6]||(t[6]=r=>i(H)(!1)),text:e.$t("common.pay success")},null,8,["text"])):O("",!0)]))}}}),mt=le(Xe,[["__scopeId","data-v-5081c72a"]]);export{mt as default};
