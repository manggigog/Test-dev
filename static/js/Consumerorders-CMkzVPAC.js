import{_ as F}from"./USDT-Dlu99aCg.js";import{_ as D}from"./MCOIN-Bodfn-v1.js";import{_ as H,z as V,q as J,o as Q,x as X,r as C,y as Z,bl as B,D as j,E as ee,F as N,Z as se,H as p,$ as h,P as u,I as i,O as l,G as g,K as oe,J as E,Q as b,T as te,X as re,Y as ae}from"./vendor-Dr_RpJ_Y.js";import{C as ne}from"./CommonVanProvider-KZuKVOde.js";import{_ as de}from"./OfflineGoods-DKMaiwr2.js";import{_ as le}from"./OfflineStore-D-5bM32y.js";import{O as ie}from"./OfflineSearchBox-06LuvJRq.js";import{B as ce}from"./BetweenTab-nGcUWfRT.js";import{a as ue,b as fe,V as me,e as x,c2 as pe,c3 as he,c4 as _e}from"./index-BckdT6oc.js";import{a as k,O as ye}from"./offlineGoods-DvT2Go6q.js";import{u as ge}from"./usePaymentBalance-74wEXx-3.js";import{P as R}from"./order-H59PKTFP.js";import{_ as be}from"./RegionBox-Dwor092Q.js";import"./BackIcon-CDrGaEPo.js";import"./ImgBoutiqueLable-B-2xCcw4.js";import"./shop-CeqcS6K2.js";import"./search-C4fLtTfY.js";import"./filter-DRLh1k_O.js";import"./goods-BVwS8oFG.js";import"./order-BTAcEDew.js";import"./color-CLXjroBk.js";/* empty css                                                               */import"./piggyBank-u8s6wp9e.js";const _=y=>(re("data-v-563f8bd9"),y=y(),ae(),y),ke={class:"mx-3 safe-body overflow-y-auto"},ve=["onClick"],Ie={class:"text-b3"},Se={class:"flex items-center font-semibold"},we=_(()=>i("img",{src:F,class:"w-4 h-4 mr-1"},null,-1)),Ce=_(()=>i("span",{class:"text-b3 ml-1"},"(",-1)),Ee=_(()=>i("img",{src:D,class:"w-4 h-4 mr-1"},null,-1)),xe={class:"text-b1"},Le=_(()=>i("span",{class:"text-b3"},")",-1)),Te=_(()=>i("img",{src:D,class:"w-4 h-4 mr-1"},null,-1)),Oe={class:"text-b1"},Pe=V({name:"ConsumerOrders"});function Ae(y){const{accountStore:c}=ue(),{checkLoginAuth:L}=fe(),T=J(),v=Q(),{t:m}=X(),$=C(null),{cryptoAESWithBuyerSearch:O,decryptKey:U,getUserDhKey:q}=me(),P=Z(()=>[{label:m("common.all"),value:-1},{label:m("order.To be confirmed"),value:k.PAYMENT_SUCCESS},{label:m("order.canceled"),value:k.CANCELLED},{label:m("order.completed"),value:k.COMPLETED}]),{getPaymentBySource:G}=ge(C(!0)),s=B({status:-1,shopInfo:null,list:[],total:0,loading:!1,finished:!1}),n=B({shopId:null,orderCustomerAddress:c==null?void 0:c.account,page:0,size:20,orderStatus:-1,keywords:"",customerEnsLike:void 0,startTime:void 0,endTime:void 0,sortBy:"desc|create_time"}),K=t=>{s.status=t,T.replace({path:"offlineConsumerorders",query:{status:t}}),A()},M=t=>{var r;return(r=P.value.find(a=>+a.value==+t))==null?void 0:r.label},I=t=>{T.push(t)},W=()=>{if(n.keywords=n.keywords.trim(),n.keywords&&n.keywords.length<2)return te(m("common.Please enter at least two keywords"));A()},A=async t=>{s.finished=!1,s.total=0,s.list=[],n.page=0,S()},S=async()=>{if(L(!0)){if(!(c!=null&&c.sign.address))return s.finished=!0;s.loading=!0,n.orderCustomerAddress=c==null?void 0:c.sign.address,n.page+=1,await z(),s.loading=!1}},Y=async t=>{const r=[];for(let a=0;a<t.length;a++){const o=t[a];if(!o.customerEns||o.customerEns&&o.orderRemark&&+o.updateTime<176794314e4)try{let e=o.shopName;if(o!=null&&o.orderSubmitShopPubKey){const d=await q(o.shopId,o.orderSubmitShopPubKey);if(d&&o.orderRemark){const{decrypt:f}=U(o.orderRemark,d),w=(f||"").replace(/\s+/g,"");e+=w}}if(e){const d=await O(e);d&&r.push({orderId:o.orderId,customerEns:d})}}catch(e){console.error("Decryption failed:",e)}}(r||[]).length&&he(r)},z=async()=>{s.status<0?delete n.orderStatus:n.orderStatus=s.status,n.keywords?n.customerEnsLike=await O(n.keywords.replace(/\s+/g,"")):n.customerEnsLike=void 0;const{success:t,data:r}=await pe(n);if(s.loading=!1,!t){s.finished=!0;return}const{records:a,total:o,current:e,pages:d}=r;if(!o||!a||!(a!=null&&a.length)){s.finished=!0;return}s.total=o;const f=C([]);f.value=a.map(w=>({btnLoading:!1,...w})),Y(f.value),s.list=n.page===1?f.value:s.list.concat(f.value),+e>=+d&&(s.finished=!0)};return j(()=>v.path,async t=>{if(t==="/offlineConsumerorders"){const r=sessionStorage.getItem("consumer_offline_refresh_chainOrderId");if(r){const a=s.list.findIndex(o=>o.orderId===r);if(a>-1&&s.status===k.PAYMENT_SUCCESS)s.list.splice(a,1);else if(a>-1&&s.status===-1){const o=await _e({id:r});o.success&&(s.list[a]=o.data||{})}sessionStorage.removeItem("consumer_offline_refresh_chainOrderId")}}},{deep:!0}),ee(async()=>{var t,r;L(!0)&&((t=v.query)!=null&&t.status&&(s.status=Number((r=v.query)==null?void 0:r.status)),S())}),(t,r)=>{const a=N("VanList"),o=N("router-view");return p(),se(ne,{title:t.$t("offline.main title"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(e,d)=>{d.shopGoodsRef=e,$.value=e}},{right:h(()=>[u(be)]),default:h(()=>[u(ce,{options:l(P),"label-key":"label","value-key":"value",modelValue:l(s).status,"onUpdate:modelValue":r[0]||(r[0]=e=>l(s).status=e),onChange:K},null,8,["options","modelValue"]),u(ie,{ref:(e,d)=>{d.searchBox=e},modelValue:l(n).keywords,"onUpdate:modelValue":r[1]||(r[1]=e=>l(n).keywords=e),onOnSearch:W,userRole:"consumer"},null,8,["modelValue"]),i("div",ke,[u(a,{loading:l(s).loading,"onUpdate:loading":r[2]||(r[2]=e=>l(s).loading=e),finished:l(s).finished,"immediate-check":!1,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:S},{default:h(()=>[(p(!0),g(E,null,oe(l(s).list,e=>(p(),g("div",{class:"offline-crad-box mb-3",key:e.orderId,onClick:d=>I(`/offlineConsumerDetail?id=${e.orderId}`)},[u(le,{shop:{images:e.shopPics,name:e.shopName},showOrderStatus:"",status:M(e.orderStatus)},null,8,["shop","status"]),u(de,{"show-order-type":"",class:"mt-3",goods:{goodsName:e.relName,goodsIcons:e.relIcons,orderType:e.orderType,areaExtName2:e.areaExtName2,storeName:e.storeName},onImageClick:d=>e.orderType===l(ye).GOODS?I("/offlineConsumerorders/offlineGoodsDetail?goodsId="+e.relId+(e.storeId?`&storeId=${e.storeId}`:"")+"&child=1"):I("/shop?shopId="+e.relId)},{"bottom-left":h(()=>{var d;return[i("div",Ie,b(t.$t((d=l(G)(e.orderPaySource||l(R).WALLET))==null?void 0:d.name)),1)]}),"bottom-price":h(()=>[i("div",Se,[e.orderPaySource===l(R).USDT_WALLET?(p(),g(E,{key:0},[we,i("span",null,b(l(x)(e==null?void 0:e.orderRealUsdt)),1),Ce,Ee,i("span",xe,b(l(x)(e==null?void 0:e.orderRealAmount)),1),Le],64)):(p(),g(E,{key:1},[Te,i("span",Oe,b(l(x)(e==null?void 0:e.orderRealAmount)),1)],64))])]),_:2},1032,["goods","onImageClick"])],8,ve))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),u(o,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const Be=V({...Pe,setup:Ae}),ts=H(Be,[["__scopeId","data-v-563f8bd9"]]);export{ts as default};
