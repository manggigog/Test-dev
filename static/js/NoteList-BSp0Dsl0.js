import{W as $}from"./WaterFull-CDtRtt9C.js";import{_ as H,y as b,w as P,l as q,r as c,E as S,F as D,G as g,H as n,O as F,X as z,P as k,a2 as V,Q as w,a4 as L,aH as O,T as j,Y as J,Z as R,z as G,K as T,N as B}from"./vendor-BUT0HZ5j.js";import{g as A,b as K,V as I,J as W,ap as Q,aq as U,r as X,ar as Y,as as Z,at as ee}from"./index-k1FFr-1T.js";const te="/Test-dev/static/images/delete-Cya47K7m.svg",ae=e=>(J("data-v-472ed2de"),e=e(),R(),e),se={class:"w-full h-full bg-white rounded-[10px]"},oe={class:"p-2 font-Puhui"},ie={class:"text-base text-[#222] font-semibold text-left text-ellipsis line-clamp-2"},le={key:0,class:"mt-1.5 flex justify-between items-center"},ne=["onClick"],ce={class:"text-xs text-[#585654] font-normal leading-[18px] text-ellipsis line-clamp-1"},ue=["onClick"],de=["src"],re={class:"text-xs text-[#999] font-normal leading-[18px]"},me={key:1,class:"mt-1.5 flex justify-between items-center"},ve={class:"max-w-[80%] text-sm text-[#999] font-normal text-ellipsis line-clamp-1"},fe=["onClick"],ge=ae(()=>n("img",{src:te,alt:"",class:"shrink-0 w-4 h-4"},null,-1)),he=[ge],xe=b({props:{item:{default:{}},index:{default:0},position:{default:""},extData:{default:{}}},emits:["delete"],setup(e,{emit:_}){const s=e,{t:y}=P(),i=q(),{loadingToggle:u}=X(),o=c(!1),h=()=>{var r,v;let a=((r=s.extData)==null?void 0:r.toDetailLink)+"?noteId="+s.item.storeNoteId;((v=s.extData)==null?void 0:v.toDetailLink)==="/city/cityMap/noteDetail"&&(a=a+"&child=1"),i.push(a)},N=()=>{console.log("clickAvatar")},x=async()=>{if(o.value)return;let a=s.item.addLikeCountFlag;s.item.addLikeCountFlag=!s.item.addLikeCountFlag,o.value=!0,a?(s.item.likeCount++,await Q({id:s.item.storeNoteId})):(s.item.likeCount--,await U({id:s.item.storeNoteId})),o.value=!1},d=()=>{o.value||O.confirm({messageAlign:"center",message:"确认将这篇笔记删除？",confirmButtonText:y("shop.delete"),confirmButtonColor:"#FF507A",cancelButtonText:y("cart.thinkAgain"),cancelButtonColor:"#2E2008"}).then(async()=>{o.value=!0,u(!0);const a=await Y({id:s.item.storeNoteId});o.value=!1,u(!1),a.success&&(C("删除成功","toast-success.svg"),_("delete"))}).catch(()=>{})},C=(a="",r="toast-warn.svg")=>{j({message:a,icon:I(r),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})};return(a,r)=>{const v=S("VanImage");return g(),D("div",{class:"mb-2 text-center",onClick:h},[n("div",se,[F(v,{src:e.item&&e.item.storeNotePics&&e.item.storeNotePics.split(",")[0]||k(A)("images/activity/boutique/squre_empty.png"),alt:"",class:"object-cover w-full h-[120px] aspect-square rounded-t-lg overflow-hidden",style:z(e.position==="left"&&e.index%5===0?"height: 172px":""),fit:"cover"},null,8,["src","style"]),n("div",oe,[n("div",ie,w(e.item.storeNoteTopic||""),1),e.extData.draft?e.extData.draft?(g(),D("div",me,[n("div",ve,w(k(W)(new Date().getTime(),"MM-DD HH:mm")),1),n("div",{onClick:L(d,["stop"])},he,8,fe)])):V("",!0):(g(),D("div",le,[n("div",{class:"max-w-[70%] w-fit flex items-center",onClick:L(N,["stop"])},[F(v,{src:k(A)("images/avatarRing.png"),class:"mr-1 shrink-0 w-4 h-4 rounded-full overflow-hidden",alt:""},null,8,["src"]),n("div",ce,w(k(K)(e.item.userAddress||"","...",5,4)),1)],8,ne),n("div",{class:"shrink-0 flex items-center",onClick:L(x,["stop"])},[n("img",{src:e.item.addLikeCountFlag?k(I)("cityMap/like.svg"):k(I)("cityMap/like-full.svg"),alt:"",class:"mr-0.5 shrink-0 w-4 h-4"},null,8,de),n("div",re,w(e.item.likeCount||0),1)],8,ue)]))])])])}}}),pe=H(xe,[["__scopeId","data-v-472ed2de"]]),ke={key:0,class:"w-full"},ye={key:0},_e=b({props:{params:{default:{}},extData:{default:{}},toDetailLink:{default:"/city/noteDetail"}},emits:["handleTo"],setup(e,{expose:_,emit:s}){const y=e,i=c([]),u=c(!1),o=c(!1),h=c(0),N=c(10),x=c(0),d=c([]),C=c(null),a=t=>JSON.parse(JSON.stringify(t)),r=async()=>{u.value=!0,h.value+=1,await v(),setTimeout(()=>{u.value=!1},1e3)},v=async()=>{var m,f,l,p;const t=await ee({page:h.value,size:N.value,...y.params});if(!t.success){o.value=!0;return}if(!t.data||!((m=t.data)!=null&&m.total)||!((f=t.data)!=null&&f.records.length)){o.value=!0;return}x.value=((l=t.data)==null?void 0:l.total)||0,d.value=((p=t.data)==null?void 0:p.records)||[],i.value=h.value===1?a(d.value):i.value.concat(a(d.value)),i.value.length>=x.value&&(o.value=!0)},E=()=>{var t;i.value=[],u.value=!1,o.value=!1,h.value=0,x.value=0,d.value=[],(t=C.value)==null||t.clearData(),r()};G(()=>y.params,()=>{E()},{deep:!0,immediate:!0});const M=(t,m)=>{var l;const f=i.value.findIndex(p=>p.storeNoteId==t.storeNoteId);f>-1&&((l=C.value)==null||l.clearData(),i.value.splice(f,1),d.value=a(i.value))};return _({total:x}),(t,m)=>{const f=S("VanList");return g(),T(f,{loading:u.value,"onUpdate:loading":m[1]||(m[1]=l=>u.value=l),finished:o.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:r},{finished:B(()=>[i.value.length>0?(g(),D("span",ye,"没有更多了")):(g(),T(Z,{key:1,name:"暂无数据"}))]),default:B(()=>[i.value.length>0?(g(),D("div",ke,[F($,{ref:(l,p)=>{p.waterFull=l,C.value=l},value:d.value,addTime:0,cardComponent:pe,extData:{...e.extData,toDetailLink:e.toDetailLink},onHandleTo:m[0]||(m[0]=l=>s("handleTo")),onDelete:M},null,8,["value","extData"])])):V("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}});export{_e as _};
