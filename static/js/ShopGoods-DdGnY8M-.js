import{_ as Q,y as H,bn as ne,r,z as Te,E as I,K as D,G as d,N as k,H as s,Q as i,O as v,a2 as T,a0 as U,P as t,bc as $e,bo as ke,F as $,R as Se,a4 as R,Y as Ce,Z as Ie,bz as Ve,a8 as Ge,x as J,w as De,l as Fe,bd as Be,D as Ee,bf as Le,bh as ze,I as ee,J as oe}from"./vendor-CjApaIpB.js";import{_ as Pe,e as ae,u as Oe}from"./index-CduCwCyL.js";import{E as Re}from"./EmptyTipsPop-D289L5-e.js";import{_ as Ue}from"./MCOIN-BcbOHmhy.js";import{_ as qe}from"./ShopMaskTips-DfjY93ZI.js";import{S as te}from"./shop-CeqcS6K2.js";import{S as _e}from"./SearchBox-DLeN1qJs.js";import{B as Ae}from"./BackIcon-D2Vm_lyR.js";import{C as Ne}from"./ChangeRegion-Bkwu4vRr.js";import{a as He,b as se,q as Me}from"./goods-fwnxjOAR.js";import{q as je}from"./mall-DvHZUtXv.js";import{D as Ke}from"./goods-BVwS8oFG.js";import"./search-Dwmdj_3F.js";import"./filter-B5MATEpa.js";import"./category-C1RWK50_.js";import"./ChangeRegionPop-y40zTO9y.js";const Ze={class:"pt-8 pb-5 text-base text-center text-black"},Je={class:"px-8"},Qe={class:"py-1 border border-solid border-black-100"},Ye={class:"flex pt-8"},We=H({props:{show:{type:Boolean},text:null,inputTips:null,discountConfig:null,type:null},emits:["close","confirm","cancle"],setup(e,{emit:b}){const S=e,[V,G]=ne(!1),g=r(null),m=a=>a>30?"30":a||"";Te(()=>S.show,a=>{a&&(g.value=null)},{deep:!0});const u=()=>{if(g.value<S.discountConfig[0]||g.value>S.discountConfig[1]){G(!0);return}b("confirm",g,S.type),g.value=null};return(a,f)=>{const c=I("van-field"),l=I("van-button");return d(),D(Pe,{width:"90%",show:e.show,name:a.$t("common.tip"),onClose:f[3]||(f[3]=()=>{b("close")})},{default:k(()=>[s("div",Ze,[s("div",null,i(e.text),1)]),s("div",Je,[s("div",Qe,[v(c,{class:"bg-[#FEFFF9]",modelValue:g.value,"onUpdate:modelValue":f[0]||(f[0]=y=>g.value=y),"input-align":"center",type:"digit",autocomplete:"off",placeholder:e.inputTips,formatter:m},null,8,["modelValue","placeholder"])])]),s("div",Ye,[v(l,{class:"plain-btn w-1/2 mx-2.5 text-[#FEA021] font-semibold",onClick:f[1]||(f[1]=()=>{b("close")})},{default:k(()=>[U(i(a.$t("common.cancel")),1)]),_:1}),v(l,{class:"w-1/2 mx-2.5 btn-orange btn-shadow text-white font-semibold",onClick:u},{default:k(()=>[U(i(a.$t("common.confirm")),1)]),_:1}),t(V)?(d(),D(Re,{key:0,onClose:f[2]||(f[2]=y=>t(G)(!1)),text:e.inputTips},null,8,["text"])):T("",!0)])]),_:1},8,["show","name"])}}}),Xe=Q(We,[["__scopeId","data-v-9121d12e"]]),eo="/Test-dev/static/images/Subtract-DbxtK3SD.png",le=e=>(Ce("data-v-b450d290"),e=e(),Ie(),e),oo={class:"relative mb-3 text-sm bg-white rounded-xl text-default"},to={class:"flex gap-2 px-4 py-3 relative border-b border-solid border-[#F9F8F5]"},so={class:"relative w-[60px] h-[60px]"},no={key:0,class:"absolute top-0 left-0 z-10"},ao={class:"subtract-text"},lo=le(()=>s("img",{class:"w-[33px] h-[33px]",src:eo},null,-1)),io={class:"flex flex-col flex-1 h-[60px] justify-between"},ro={class:"flex items-start"},uo={class:"mr-1 line-clamp-2"},co={key:0,class:"ml-auto mr-2 text-xs opacity-60 min-w-fit"},po={class:"flex items-center"},fo=le(()=>s("img",{src:Ue,class:"w-4 h-4 mr-1.5"},null,-1)),mo={class:"flex items-baseline"},vo={class:"mr-1"},go={class:"relative flex justify-end gap-3 px-4 py-2 text-xs"},ho={class:"flex items-center justify-center gap-1"},yo={key:0,class:"absolute z-50 py-3 text-center right-0 transform-pop px-3.5 top-7 no-wrap"},xo=H({props:{goods:null,index:null,shopType:null},emits:["handleTo","handleDown","handleUp","handleDel","toFeatured"],setup(e,{emit:b}){const{accountStore:S}=ae(),[V,G]=$e(!1),g=r(null);return ke(g,()=>G(!1)),(m,u)=>{var l;const a=I("VanImage"),f=I("VanButton"),c=I("van-icon");return d(),$("div",oo,[s("div",to,[s("div",so,[e.goods.type!==t(te).SD?(d(),$("div",no,[s("div",ao,i(m.$t(`common.shop_type_${(l=e.goods)==null?void 0:l.type}`)),1),lo])):T("",!0),(e.goods.status!=1||!+e.goods.stock)&&+e.goods.goodsTypes!=2?(d(),D(qe,{key:1,status:e.goods.status,stock:e.goods.stock},null,8,["status","stock"])):T("",!0),v(a,{src:e.goods.icons&&e.goods.icons.split(",")[0],class:"w-[60px] h-[60px] rounded-md overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),s("div",io,[s("div",ro,[s("div",uo,i(e.goods.goodsName),1),e.goods.deliveryType===1?(d(),$("div",co,i(m.$t("shop.sellAmount"))+" "+i(e.goods.salesVolume||0),1)):T("",!0),+e.goods.goodsTypes!=2?(d(),$("div",{key:1,class:Se(["text-xs opacity-60 min-w-fit",{"ml-auto":e.goods.deliveryType!==1}])},i(m.$t("goods.stock"))+" "+i(e.goods.stock||0),3)):T("",!0)]),s("div",po,[fo,s("div",mo,[s("div",vo,i(e.goods.price)+"Mcoin",1)])])])]),s("div",go,[e.goods.status&&e.goods.status===1&&!t(S).isOnlyView?(d(),D(f,{key:0,round:"",hairline:"",type:"primary",class:"border border-solid border-default text-default h-[24px] px-5",loading:e.goods.loading,onClick:u[0]||(u[0]=R(()=>b("handleDown",e.goods,e.index),["stop"]))},{default:k(()=>[U(i(m.$t("shop.down")),1)]),_:1},8,["loading"])):T("",!0),e.goods.status&&e.goods.status===2&&!t(S).isOnlyView?(d(),D(f,{key:1,round:"",hairline:"",type:"primary",class:"border border-solid border-default text-default h-[24px] px-5",loading:e.goods.loading,onClick:u[1]||(u[1]=R(()=>b("handleUp",e.goods,e.index),["stop"]))},{default:k(()=>[U(i(m.$t("shop.up")),1)]),_:1},8,["loading"])):T("",!0),v(f,{round:"",hairline:"",type:"primary",class:"border border-solid border-default text-default h-[24px] px-5",loading:e.goods.loading,onClick:u[2]||(u[2]=()=>b("handleTo",`/shopGoods/editgoods?id=${e.goods.id}`))},{default:k(()=>[U(i(m.$t("shop.modify")),1)]),_:1},8,["loading"]),t(S).isOnlyView?T("",!0):(d(),$("div",{key:2,class:"relative",ref:(y,z)=>{z.target=y,g.value=y}},[v(f,{onClick:u[3]||(u[3]=R(y=>t(G)(!t(V)),["stop"])),round:"",hairline:"",class:"btn text-white bg-primary h-[24px] px-3",loading:e.goods.loading},{default:k(()=>[s("div",ho,[s("span",null,i(m.$t("shop.more")),1),v(c,{name:"play",class:"rotate-90"})])]),_:1},8,["loading"]),t(V)?(d(),$("div",yo,[s("div",{class:"no-wrap",onClick:u[4]||(u[4]=R(()=>b("handleTo",`/editFlashSaleGoods?id=${e.goods.id}`),["stop"]))},i(m.$t("shop.transform")),1),e.shopType!==t(te).SD&&e.goods.type!==e.shopType?(d(),$("div",{key:0,class:"pt-3 no-wrap",onClick:u[5]||(u[5]=R(()=>b("toFeatured",e.goods),["stop"]))},i(m.$t("goods.One-click transfer",{type:m.$t(`common.shop_type_${e.shopType}`)})),1)):T("",!0)])):T("",!0)],512))])])}}}),bo=Q(xo,[["__scopeId","data-v-b450d290"]]),wo={class:"relative"},To={class:"sticky top-0 z-50 gap-2 px-3 pt-2 text-base flex-start bg1"},$o={class:"py-3 px-2.5 bg-[#f8f7f4]"},ko=H({name:"ShopGoods"});function So(e){Ve(o=>({"4a63dbc4":t(u)}));const{accountStore:b,clerkStore:S}=ae(),{getCurrentStoreId:V,getCurrentAccount:G}=Oe(),g=r(null),{y:m}=Ge(g),u=J(()=>m.value>20?"#F9F7F4":"transparent"),{t:a}=De(),f=Fe(),c=r(0),l=Be({active:0,shopInfo:null,keyword:""}),y=J(()=>[{id:1,name:`${a("shop.selling")}(${c.value})`},{id:2,name:a("shop.watiShelf")},{id:0,name:a("shop.manuscript")}]),z=o=>{f.push(o)},h=r([]),P=r(!1),F=r(!1),B=r(0),ie=r(10),q=r(0),M=async()=>{F.value=!1,B.value=0,q.value=0,h.value=[],j()},_=r({}),de=async o=>{console.log(o),_.value=o,o.goodsType&&o.goodsType!=="all"&&(_.value.type=o.goodsType),delete _.value.goodsType,F.value=!1,B.value=0,q.value=0,h.value=[],j()},j=async()=>{P.value=!0,B.value+=1,await re(),P.value=!1},re=async(o,n)=>{var E;const p=await je({merchant:((E=await V())==null?void 0:E.merchant)||G(),status:y.value[l.active].id,page:B.value,size:ie.value,keyword:l.keyword,..._.value});if(P.value=!1,!p.success){F.value=!0;return}if(!p.data||!p.total){F.value=!0,h.value=B.value===1?[]:h.value,c.value=l.active?c.value:0;return}q.value=p.total,c.value=l.active?c.value:p.total,y.value[0].name=`${a("shop.selling")}(${c.value})`;const x=r([]);x.value=p.data.map(L=>({btnLoading:!1,...L})),h.value=B.value===1?x.value:h.value.concat(x.value),h.value.length>=q.value&&(F.value=!0)},ue=()=>{M()},ce=async(o,n)=>{o.loading=!0;const p={id:o.id,status:2},x=await se(p);o.loading=!1,x.success&&(h.value.splice(n,1),c.value=c.value-1,y.value[0].name=`${a("shop.selling")}(${c.value})`)},pe=async(o,n)=>{o.loading=!0;const p={id:o.id,status:1},x=await se(p);o.loading=!1,x.success&&(h.value.splice(n,1),c.value=c.value+1,y.value[0].name=`${a("shop.selling")}(${c.value})`)},fe=async(o,n)=>{o.loading=!0;const p=await He(o.id);o.loading=!1,p.success&&h.value.splice(n,1)},me=J(()=>[3,30]),[ve,Y]=ne(!1),ge=r(""),he=r(""),ye=r(1),W=r(null),K=async o=>{z(`/shopGoods/editgoods?id=${o.id}&boutique=1`)},xe=(o,n)=>{Y(!1),n===1&&(W.value.discountRatio=o,K()),n===2&&(W.value.balanceDiscountRatio=o,K())},be=async()=>{l.shopInfo=await V()};let O=null;const we=async()=>{const o=localStorage.getItem("shopGoods_scrollTop");+o?O.scrollTo({top:+o,left:0,behavior:"instant"}):localStorage.removeItem("shopGoods_scrollTop")},Z=r(!1),X=()=>{Z.value||(Z.value=!0,setTimeout(()=>{localStorage.setItem("shopGoods_scrollTop",O.scrollTop+""),Z.value=!1},500))};return Ee(()=>{be(),O=document.querySelector(".shopGoodsPage"),O.addEventListener("scroll",X)}),Le(async()=>{var n;S.isClerk&&M();const o=sessionStorage.getItem("shop_refresh_id");if(o){we();const p=await Me(o),x=h.value.findIndex(E=>{var L;return((L=E.goods)==null?void 0:L.id)==o});x>-1&&(h.value[x].goods=(n=p.data)==null?void 0:n.goods),sessionStorage.removeItem("shop_refresh_id")}}),ze(()=>{O.removeEventListener("scroll",X)}),(o,n)=>{const p=I("VanList"),x=I("VanTab"),E=I("VanTabs"),L=I("router-view");return d(),$("div",wo,[s("div",{class:"shopGoodsPage relative z-0 h-full pb-20 overflow-auto text-sm text-default bg",ref:(w,C)=>{C.shopGoodsRef=w,g.value=w}},[s("div",To,[v(Ae),s("div",null,i(o.$t("shop.sellingGoods")),1),v(Ne,{showIcon:!0,showDownIcon:!1,class:"ml-auto bg-gray1 px-2 rounded-[20px] border-2 border-solid border-white",style:{"box-shadow":"0px 0px 15px 0px rgba(51, 47, 42, 0.3) inset"}})]),v(E,{active:t(l).active,"onUpdate:active":n[3]||(n[3]=w=>t(l).active=w),onChange:ue,sticky:"","offset-top":44},{"nav-bottom":k(()=>{var w,C,A;return[s("div",$o,[v(_e,{modelValue:t(l).keyword,"onUpdate:modelValue":n[0]||(n[0]=N=>t(l).keyword=N),shopType:(C=(w=t(l))==null?void 0:w.shopInfo)==null?void 0:C.type,"delivery-type":t(Ke).online,onOnSubmit:M,onOnFilter:de,shopInfo:(A=t(l))==null?void 0:A.shopInfo},null,8,["modelValue","shopType","delivery-type","shopInfo"])])]}),default:k(()=>[(d(!0),$(ee,null,oe(t(y),w=>(d(),D(x,{title:w.name,key:w.id,class:"relative px-3"},{default:k(()=>[v(p,{loading:P.value,"onUpdate:loading":n[1]||(n[1]=C=>P.value=C),finished:F.value,"finished-text":o.$t("common.noMore"),"loading-text":o.$t("common.loading"),onLoad:j},{default:k(()=>[(d(!0),$(ee,null,oe(h.value,(C,A)=>{var N;return d(),D(bo,{key:C.goods.id,index:A,goods:C.goods,shopType:(N=t(l).shopInfo)==null?void 0:N.type,onHandleDown:ce,onHandleUp:pe,onHandleDel:fe,onHandleTo:z,onToFeatured:K},null,8,["index","goods","shopType"])}),128))]),_:1},8,["loading","finished","finished-text","loading-text"]),t(b).isOnlyView?T("",!0):(d(),$("button",{key:0,class:"btn-orange w-[180px] h-10 flex-center text-white font-semibold fixed x-center sm:bottom-[11%] bottom-9 z-10",onClick:n[2]||(n[2]=C=>z("/shopGoods/editgoods"))},i(o.$t("shop.releaseGoods")),1))]),_:2},1032,["title"]))),128))]),_:1},8,["active"])],512),v(Xe,{show:t(ve),onClose:n[4]||(n[4]=w=>t(Y)(!1)),text:ge.value,inputTips:he.value,discountConfig:t(me),onConfirm:xe,type:ye.value},null,8,["show","text","inputTips","discountConfig","type"]),v(L,{class:"child-view"})])}}const Co=H({...ko,setup:So}),No=Q(Co,[["__scopeId","data-v-5ff7b105"]]);export{No as default};
