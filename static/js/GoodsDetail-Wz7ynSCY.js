import{c as ve,G as ge,_ as he,a as fe}from"./GivePointsLable-BLbSGB94.js";import{_ as ye,a as Te,G as we,S as _e,b as $e,c as be,d as xe}from"./ShareGoodPopup-Bq-d8njJ.js";import{z as q,bl as ke,y as C,D as Ie,G as p,H as i,O as a,J,I as o,Q as l,a4 as Q,K as Ce,Z as f,by as Re,_ as z,U as m,X,Y as W,a2 as j,r,x as Se,o as Ge,q as Fe,ad as De,bE as Le,E as Be,F as Ee,P as k,N as Ae,$ as K,T as N}from"./vendor-Dr_RpJ_Y.js";import{l as Pe}from"./order-CCndJpZE.js";import{F as G}from"./enums-DlE-aiss.js";import{e as Oe,b as je,ar as Ne,w as qe,y as ze,C as He,c as Ve,as as Ue,Y as Me}from"./index-LRhcxFAI.js";import{P as Ye}from"./flashSale-DDyqLyYN.js";import{D as Ze}from"./goods-BVwS8oFG.js";import{R as Je}from"./RemovedShelves-BUe_2pOD.js";import{q as Ke}from"./goods-BRNynB6s.js";import"./shop-CeqcS6K2.js";import"./avatarRing-CLGxkH-F.js";import"./shop-arrow-right-BMae5SG7.js";import"./BoutiqueLabelInLogo-6zoXLJ5H.js";import"./RatioBox-n6itzF1h.js";import"./ServiceIcon-CKD37cB-.js";import"./convertToImage-CeT_XVfz.js";import"./upload-AP7UGkIr.js";import"./active_empty-OYjsVrLW.js";import"./HelpPop-DuBkMJWg.js";import"./MCOIN-Bodfn-v1.js";import"./logo-D1FnEJzd.js";import"./BackIcon-CDrGaEPo.js";const Qe={class:"relative mb-3 w-full flex justify-between items-center"},Xe={class:"text-base font-semibold text-b1 text-left"},We={class:"text-xs text-b3 font-normal flex justify-center items-center"},et=o("img",{src:Te,class:"w-3 h-3",alt:""},null,-1),tt={key:1,class:"text-base font-semibold text-b1 text-left"},st=q({props:{goodsId:null},emits:["handleTo"],setup(e,{emit:v}){const w=e,n=ke({commentList:[],total:0}),_=C(()=>Number(n.total)>100?100:n.total),y=async()=>{const c=await Pe({goodsId:w.goodsId,page:1,size:1});c.success&&(n.commentList=c.data,n.total=c.total)},$=C(()=>{if(n.commentList&&n.commentList.length>0){const c=[];for(let d=0;d<n.commentList.length;d++)n.commentList[d].commentImages&&n.commentList[d].commentImages.length>0&&c.push(...n.commentList[d].commentImages.split(","));return c}return[]}),D=c=>{const d=$.value.findIndex(g=>g===c);Re({images:$.value,closeable:!0,showIndex:!0,startPosition:d})};return Ie(()=>w.goodsId,c=>{y()},{immediate:!0}),(c,d)=>(i(),p("div",{class:"px-4 py-3 mt-2 bg-white text-base",onClick:d[0]||(d[0]=g=>v("handleTo",`/evaluate-good?goodsId=${e.goodsId}`))},[a(n).commentList.length>0?(i(),p(J,{key:0},[o("div",Qe,[o("div",Xe,l(c.$t("evaluate.Buyer Reviews"))+"（"+l(a(_))+"） ",1),o("div",We,[Q(l(c.$t("common.all"))+" ",1),et])]),(i(!0),p(J,null,Ce(a(n).commentList,(g,H)=>(i(),f(ye,{onImgPre:D,key:g.id,data:g},null,8,["data"]))),128))],64)):(i(),p("div",tt,l(c.$t("evaluate.Buyer Reviews none")),1))]))}}),ot=""+new URL("../images/wyhlg-lNCG0Riy.svg",import.meta.url).href,at=""+new URL("../images/g-d-flash-bg-D1sma3Dd.svg",import.meta.url).href,it=""+new URL("../images/g-d-flash-f-C4Zpe-zO.svg",import.meta.url).href,nt={class:"tag text-xs flex justify-start items-center text-[#F25C11]"},lt={key:0},ct={key:1},ut={key:2},dt={key:3},rt={props:{shippingTemplate:{type:Object,default:()=>{}}},setup(e){return(v,w)=>(i(),p("div",nt,[o("span",null,[e.shippingTemplate.type===a(G).FREE&&e.shippingTemplate.threshold?(i(),p("span",lt,l(v.$t("shop.shippingTemplate.actualPayment"))+l(a(Oe)(e.shippingTemplate.threshold))+"MC"+l(v.$t("shop.shippingTemplate.freeShipping")),1)):m("",!0),e.shippingTemplate.type===a(G).FREE&&e.shippingTemplate.threshold===0?(i(),p("span",ct,l(v.$t("shop.shippingTemplate.freeShipping")),1)):m("",!0),e.shippingTemplate.type===a(G).NO_SHIPPING?(i(),p("span",ut,l(v.$t("shop.shippingTemplate.noShipping")),1)):m("",!0),e.shippingTemplate.type===a(G).CASH_ON_DELIVERY?(i(),p("span",dt,l(v.$t("shop.shippingTemplate.cashOnDelivery")),1)):m("",!0)])]))}},mt=z(rt,[["__scopeId","data-v-c8264250"]]),F=e=>(X("data-v-807a4676"),e=e(),W(),e),pt={class:"act__wrap flex items-center justify-between p-3 pr-2.5"},vt={class:"left-box z-10"},gt={class:"act-price font-sans text-b6 text-[26px] font-normal"},ht={class:"leading-[26px] font-BebasNeue"},ft=F(()=>o("span",{class:"text-[12px] ml-1"},"MC",-1)),yt={class:"mt-1 flex flex-row justify-start items-center gap-1"},Tt={key:1,class:"tag"},wt={key:2},_t={class:"right-box z-10"},$t=F(()=>o("div",{class:"happy-buying"},[o("img",{src:ot,alt:"五一欢乐购"})],-1)),bt={class:"text-right mt-[2px] text-[#B27936] text-xs font-normal"},xt=F(()=>o("img",{class:"flash-item-2",src:at},null,-1)),kt=F(()=>o("img",{class:"flash-item-1",src:it,alt:""},null,-1)),It={props:{goods:{type:Object,default:()=>{}},activity:{type:Object,default:()=>{}},activityGoods:{type:Object,default:()=>{}},activityRule:{type:Object,default:()=>{}},shippingTemplate:{type:Object,default:()=>{}}},setup(e){const v=e,w=C(()=>{var $;if(!(($=v.activity)!=null&&$.endTime))return 0;const n=new Date(v.activity.endTime).getTime(),_=new Date().getTime(),y=(n-_)/(1e3*60*60*24);return y<=0?0:y<1?1:Math.ceil(y)});return(n,_)=>(i(),p("div",pt,[o("div",vt,[o("div",gt,[o("span",ht,l(e.activityGoods.activityPrice),1),ft]),o("div",yt,[e.shippingTemplate.id?(i(),f(mt,{key:0,shippingTemplate:e.shippingTemplate},null,8,["shippingTemplate"])):m("",!0),e.activityRule&&e.activityRule.fullAmount?(i(),p("div",Tt,l(n.$t("active.man")+e.activityRule.fullAmount||0)+"-"+l(e.activityRule.reduceAmouint||e.activityRule.reduceAmount||0),1)):m("",!0),e.goods.deliveryType===a(Ze).online?(i(),p("div",wt,[e.goods.payType!==a(Ye).STORE_CARD?(i(),f(ve,{key:0,class:"points-tag",showType:"balance",goods:e.goods,activityGoods:e.activityGoods},null,8,["goods","activityGoods"])):m("",!0)])):m("",!0)])]),o("div",_t,[$t,o("div",bt,[o("span",null,l(n.$t("active.last")),1),o("span",null,l(a(w)+n.$t("common.day")),1)])]),xt,kt]))}},Ct=z(It,[["__scopeId","data-v-807a4676"]]),ee=e=>(X("data-v-94b6a48e"),e=e(),W(),e),Rt={class:"relative w-full h-full !bg-[#F6F6F5] !bg-none font-Puhui detail__wrap"},St={key:0},Gt=ee(()=>o("img",{class:"w-8 h-8",src:fe},null,-1)),Ft=[Gt],Dt=ee(()=>o("img",{class:"w-8 h-8",src:xe},null,-1)),Lt=[Dt],Bt={class:"pb-[calc(76px+8px-12px)] -translate-y-3 bg-[#F6F6F5]"},Et={class:"text-center text-black/80"},At={class:"p-3 text-base"},Pt=q({name:"GoodsDetail"});function Ot(e){const{checkLoginAuth:v,checkRegisterAuth:w}=je(),{mcoinRate:n}=Ve(),[_,y]=j(!1),[$,D]=j(!1),c=r(!1),{loadingToggle:d}=qe(),{t:g}=Se(),H=Ne(),L=Ge(),b=Fe(),x=C(()=>document.getElementById("child")?document.getElementById("child"):document.getElementById("fm-page")),t=r(null),h=r(null),B=r(null),E=r(null),V=r(null),te=r([]),A=r({}),se=r(),U=r(null),oe=r(L.query.id),ae=async()=>{const u=oe.value;if(u==null||u==="")return;const s=await Ke(u);if(!s.success||s.data.deleteFlag){D(!0);return}se.value=s.data.categoryName,t.value=s.data.goods,c.value=s.data.isFollow,h.value=s.data.stores,te.value=s.data.goodsList,U.value=s.data.fmStoredCard,A.value=s.data.fmShippingTemplate||{},B.value=s.data.fmGeneralActivity||null,E.value=s.data.fmGeneralActivityGoods||null,V.value=s.data.fmGeneralActivityRule||null},M=r(null),ie=async()=>{M.value=await n()},ne=C(()=>1/M.value),I=r(null),le=async u=>{if(!v(!0)||!await w(!0))return;const s=u===void 0?`/submitOrder?id=${t.value.id}`:`/submitOrder?id=${t.value.id}&${u}`;b.push(s)},[ce,Y]=j(!1),ue=async()=>{if(t.value.stock===0&&t.value.goodsTypes!==2){N(g("order.Insufficient stock"));return}const u={needlogin:"true",...L.query};b.replace({path:L.path,query:u}),d(!0);const s=await Ue(t.value.id);d(!1),!(!s||!s.success)&&(N(g("cart.addTips")),H.getCartCount())},P=u=>{b.push(u)},de=()=>{N({message:g("common.Saved successfully"),icon:Me("toast-success.svg"),duration:3e3})},re=()=>{try{window.history.state.back?b.back():window.history.length>2?window.history.back():b.replace({path:"/mall"})}catch{b.push("/")}},Z=r(0);let R=r(!0);const O=Le(()=>{Z.value=x.value.scrollY||x.value.scrollTop,Z.value<100?(R.value=!1,I.value&&I.value.resumeSwiper()):(R.value=!0,I.value&&I.value.pauseSwiper())},100),me=()=>{x.value&&x.value.addEventListener("scroll",O),O()};return De(()=>{x.value&&x.value.removeEventListener("scroll",O)}),Be(async()=>{me(),d(!0),await ie(),await ae(),d(!1)}),(u,s)=>{const pe=Ee("VanButton");return i(),p("div",Rt,[t.value&&t.value.status===1&&h.value.status!==3&&h.value.status!==4&&h.value.status!==0?(i(),p("div",St,[o("header",{class:Ae(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-3 py-[9px] fixed transition-all duration-200",{"bg-white":a(R)," bg-black/0":!a(R)}])},[o("div",{class:"flex flex-wrap items-center",onClick:re},Ft),o("div",{onClick:s[0]||(s[0]=T=>a(y)(!0))},Lt)],2),k(ge,{ref:(T,S)=>{S.goodsImgRef=T,I.value=T},imgs:(t.value.icons||"").split(","),stock:t.value.stock,goodsTypes:t.value.goodsTypes},null,8,["imgs","stock","goodsTypes"]),B.value&&E.value.activityStock>0?(i(),f(Ct,{key:0,goods:t.value,activityRule:V.value,activity:B.value,activityGoods:E.value,shippingTemplate:A.value,class:"mt-[-6px] z-10"},null,8,["goods","activityRule","activity","activityGoods","shippingTemplate"])):m("",!0),k(we,{tokenRate:a(ne),shop:h.value,goods:t.value,discountRatio:t.value.discountRatio,card:U.value,shippingTemplate:A.value,class:"relative z-10"},null,8,["tokenRate","shop","goods","discountRatio","card","shippingTemplate"]),o("div",Bt,[k(st,{onHandleTo:P,goodsId:t.value.id},null,8,["goodsId"]),h.value.id?(i(),f(_e,{key:0,shop:h.value,onHandleTo:P},null,8,["shop"])):m("",!0),t.value.goodsDesc||t.value.goodsPic?(i(),f(he,{key:1,text:t.value.goodsDesc,imgs:t.value.goodsPic?t.value.goodsPic.split(","):[]},null,8,["text","imgs"])):m("",!0)]),t.value.id?(i(),f($e,{key:1,goods:t.value,goodsId:t.value.id,payType:t.value.payType||1,boutiqueFlag:t.value.boutiqueFlag||!1,isFollow:c.value,deliveryType:t.value.deliveryType,shop:h.value,stock:t.value.stock,goodsTypes:t.value.goodsTypes,onHandleBuy:le,onHandleConnect:s[1]||(s[1]=T=>{var S;return P(`/shopInfo?address=${(S=h.value)==null?void 0:S.merchant}`)}),onHandleAddCart:ue},null,8,["goods","goodsId","payType","boutiqueFlag","isFollow","deliveryType","shop","stock","goodsTypes"])):m("",!0)])):t.value?(i(),f(Je,{key:1,type:"good"})):m("",!0),a(_)?(i(),f(be,{key:2,show:a(_),onOnSuceess:de,onClose:s[2]||(s[2]=T=>a(y)(!1)),goods:t.value},null,8,["show","goods"])):m("",!0),k(ze,{show:a(ce),name:u.$t("common.tip"),onClose:s[4]||(s[4]=T=>a(Y)(!1))},{default:K(()=>[o("div",Et,[o("div",At,l(u.$t("goods.addcartip")),1),k(pe,{class:"btn-orange text-white min-w-[120px] h-[40px]",onClick:s[3]||(s[3]=T=>a(Y)(!1))},{default:K(()=>[Q(l(u.$t("common.I_see")),1)]),_:1})])]),_:1},8,["show","name"]),k(He,{show:a($),title:"商品不存在",content:"商品不存在，无法购买",showConfirm:!0,showReject:!1,noClose:"",confirmText:"返回",onConfirm:s[5]||(s[5]=T=>a(b).back())},null,8,["show"])])}}const jt=q({...Pt,setup:Ot}),us=z(jt,[["__scopeId","data-v-94b6a48e"]]);export{us as default};
