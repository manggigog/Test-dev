import{_ as U,z as F,x as z,o as D,q as R,r as c,D as T,E as P,F as m,G as x,U as A,H as b,P as l,I as t,J as G,K as N,Q as p,$ as C,V as q,O,T as r}from"./vendor-Dr_RpJ_Y.js";import{_ as H}from"./GoodInfo-BuhpwFAC.js";import{b as M,k as Y,ax as j,ay as J,a7 as K,g as Q,Y as V}from"./index-BckdT6oc.js";import{_ as W}from"./EvalHeader-BnKRlnel.js";import{u as X}from"./upload-DmJ1cHIQ.js";import{s as Z,h as ee}from"./order-BTAcEDew.js";import"./GoodsPrice-Dz5PcG19.js";import"./MCOIN-Bodfn-v1.js";import"./CardPrice-DihLnH8_.js";import"./order-H59PKTFP.js";import"./BackIcon-CDrGaEPo.js";const te={key:0,class:"px-2.5 font-normal text-black"},ae={class:"mt-4 text-base font-normal bg-white rounded-xl"},oe={class:"flex items-center px-2.5 pt-2.5"},se={class:"mr-1"},ne={class:"flex items-center p-2.5 border-b border-solid border-[#F6F6F5]"},le={class:"mr-1"},re={class:"p-2.5"},ie={class:"rounded-xl bg-[#F6F6F5]"},de={class:"mt-4 text-base font-normal bg-white px-2.5 pt-[14px] rounded-xl"},ue={class:""},ce={class:"mr-[8px] mb-[8px] w-full h-full"},me=["src"],pe={class:"mt-1 text-xs font-light text-center text-default"},fe={class:"flex justify-center pb-10 mt-10"},ve={class:"text-base"},_e=F({name:"EvaluatePost"});function he(xe){const{t:S}=z(),f=D(),v=R(),{checkLoginAuth:L}=M(),w=c(null),_=c(!1),i=c(null),y=async()=>{_.value=!0;const e=await ee({orderId:w.value});e.success&&(_.value=!1,e.data.dataList=e.data.dataList.map(a=>a.commentStatus===1?{...a,commentStar:5,commentShopStar:5,imgList:[]}:{...a,imgList:[]}),i.value=e.data,i.value.dataList[0].commentStatus===2&&setTimeout(()=>{I("您已对该订单完成评价，无需重复操作"),setTimeout(()=>{v.back()},2e3)},50))},I=(e="",a="toast-warn.svg")=>{r({message:e,icon:V(a),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},k=async(e,a)=>{const s=j(e.file);if(!s.valid)return a.imgList.length-=1,r(s.tips);const d=J(e.file);if(!d.valid)return a.imgList.length-=1,r(d.tips);const g=await K(e,"goodsImg"),u=await X(g);if(!u.success)return r(S("comomn.Image upload failed")),a.imgList.length-=1;a.imgList[a.imgList.length-1]={url:Q.imgUrl+u.data}},h=c(!1),E=async()=>{const e=i.value.dataList.map(s=>({orderGoodsId:s.id,commentContent:s.commentContent,commentStar:s.commentStar,commentShopStar:s.commentShopStar,commentImages:s.imgList.map(d=>d.url).join(",")}));h.value=!0;const a=await Z({dataList:e});h.value=!1,a.success&&(r.setDefaultOptions({forbidClick:!0}),r({message:S("evaluate.Evaluation success"),icon:V("toast-success.svg"),duration:2e3}),setTimeout(()=>{f.params.refresh="1",v.back()},2e3))},$=e=>{v.push(e)};return T(()=>f.query.orderId,e=>{if(f.path==="/evaluate-post"&&e){if(!L(!0))return;w.value=e,y(),r.setDefaultOptions({forbidClick:!0})}},{deep:!0,immediate:!0}),P(()=>{L(!0)}),(e,a)=>{const s=m("van-rate"),d=m("van-field"),g=m("van-uploader"),u=m("VanButton");return i.value?(b(),x("div",te,[l(W,{title:e.$t("evaluate.Post a review")},null,8,["title"]),(b(!0),x(G,null,N(i.value.dataList,(o,B)=>(b(),x("div",{class:"mb-8",key:B},[l(H,{orderGoodInfo:o,order:i.value.order,onHandleTo:$},null,8,["orderGoodInfo","order"]),t("div",ae,[t("div",oe,[t("span",se,p(e.$t("evaluate.Product Rating")),1),l(s,{modelValue:o.commentStar,"onUpdate:modelValue":n=>o.commentStar=n,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ne,[t("span",le,p(e.$t("evaluate.Store Rating")),1),l(s,{modelValue:o.commentShopStar,"onUpdate:modelValue":n=>o.commentShopStar=n,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",re,[t("div",ie,[l(d,{maxlength:"200",modelValue:o.commentContent,"onUpdate:modelValue":n=>o.commentContent=n,rows:"8",autosize:"",label:"",type:"textarea","show-word-limit":"",placeholder:o.commentStar<3&&o.commentStar>0?e.$t("evaluate.help merchants improve"):e.$t("evaluate.praise")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),t("div",de,[t("div",ue,[l(g,{modelValue:o.imgList,"onUpdate:modelValue":n=>o.imgList=n,accept:"image/*","max-count":3,"preview-size":"100%",afterRead:n=>{k(n,o)}},{default:C(()=>[t("div",ce,[t("div",{style:q(o.imgList.length==0?"height: 100px;width: 100px":""),class:"flex flex-col items-center justify-center w-full h-full text-center text-black border border-dashed border-black-400"},[t("img",{src:O(Y)("images/addPic.png"),class:"w-[50px] h-[50px]"},null,8,me),t("div",pe,p(o.imgList.length==2?e.$t("evaluate.You can also add one"):e.$t("common.add img")),1)],4)])]),_:2},1032,["modelValue","onUpdate:modelValue","afterRead"])])])]))),128)),t("div",fe,[l(u,{loading:h.value,onClick:E,disabled:_.value,round:"",class:"h-10 min-w-[180px] px-5 font-semibold text-white btn-linear-primary"},{default:C(()=>[t("span",ve,p(e.$t("evaluate.Post a review")),1)]),_:1},8,["loading","disabled"])])])):A("",!0)}}const ge=F({..._e,setup:he}),$e=U(ge,[["__scopeId","data-v-61bb578e"]]);export{$e as default};
