import{_ as ne,y as J,w as ie,a1 as ce,l as de,x as C,r as E,z as me,D as pe,bj as fe,E as k,K as I,G as c,N as w,H as a,F as m,a2 as y,O as x,P as r,bF as xe,bG as ve,a4 as _e,Q as b,bc as M,bo as q,R as O,a0 as K,Y as ge,Z as he,br as Fe,T as D,aH as we}from"./vendor-BUT0HZ5j.js";import{u as ye}from"./upload-B40Myr0u.js";import{e as be,V as T,au as Be,a2 as Ne,q as Ce,r as Ee,aM as $}from"./index-k1FFr-1T.js";import{i as ke,b as H}from"./offlineGoods-DvT2Go6q.js";import{C as De}from"./CommonVanProvider-BpsZUrD3.js";import{_ as Se,a as Ie}from"./GoodItem-BPXGswPC.js";import"./BackIcon-biFt6cm7.js";import"./collect-CqBtZyCF.js";import"./useCityMap-Bg4gSYAn.js";import"./MCOIN-BcbOHmhy.js";import"./ImgBoutiqueLable-BF5Xoxsv.js";import"./shop-CeqcS6K2.js";const Q="/Test-dev/static/images/arrow-down-fill2-BCS2ivEO.svg",W="/Test-dev/static/images/arrow-down-fill-LyJdP7Ry.svg",S=B=>(ge("data-v-500a8948"),B=B(),he(),B),Te={class:"bg-white rounded-xl overflow-hidden mx-3 px-3 py-3 title"},Ve={class:"van-uploader__wrapper flex flex-wrap gap-3"},Pe=["onClick"],Ae={class:"van-image van-uploader__preview-image",style:{width:"72.5px",height:"72.5px"}},Ge={class:"w-[72.5px] h-[72.5px] border border-dashed border-b4 rounded-md text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Re=S(()=>a("div",{class:"text-xxs font-light text-center text-b1 opacity-30"}," 添加图片 ",-1)),je={class:"text-xxs font-light text-center text-b1 opacity-30"},Ue={class:"border-b4 border-b border-solid py-3 flex items-center justify-between"},Le={class:"text-b3 text-sm font-normal shrink-0"},ze={class:"pt-3"},Me={class:"text-b3 text-sm font-normal w-full text-right"},qe={class:"bg-white rounded-xl m-3 px-3 py-4"},Oe={class:"flex items-center justify-between"},$e=S(()=>a("div",{class:"text-b1 text-sm font-semibold min-w-fit"},"门店信息",-1)),He={key:0,class:"ml-auto max-w-[70%] line-clamp-1 text-right"},Je={key:1,class:"w-full text-right"},Ke={key:2,src:Q,class:"w-4 h-4 ml-[2px]"},Qe={key:3,src:W,class:"w-4 h-4 ml-[2px]"},We={key:0,class:"bg-[#F5F5F5] rounded-lg p-3 mt-3"},Ye={key:0,class:"bg-white rounded-[10px] m-3 px-3 py-4"},Ze={class:"flex items-center justify-between"},Xe=S(()=>a("div",{class:"text-b1 text-sm font-semibold min-w-fit"},"服务信息",-1)),et={key:0,class:"ml-auto max-w-[70%] line-clamp-1 text-right"},tt={key:1,class:"w-full text-right"},ot={key:2,src:Q,class:"w-4 h-4 ml-[2px]"},st={key:3,src:W,class:"w-4 h-4 ml-[2px]"},at={key:0,class:"bg-[#F5F5F5] rounded-xl p-3 mt-3"},rt=S(()=>a("div",{class:"h-[74px]"},null,-1)),lt={class:"fixed bottom-0 left-0 w-full flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},ut=K(" 存草稿 "),nt=K(" 发布笔记 "),it=J({name:"CreateNote"});function ct(B){const{t:V}=ie(),{loadingToggle:N}=Ee(),P=ce(),v=de(),{cityMapStore:o}=be(),A=C(()=>{var e;return((e=P.query)==null?void 0:e.noteId)||""}),u=E({storeNoteTopic:"",storeNoteContent:"",releaseFlag:null}),g=E(!1),d=E([]),G=E(6),Y=C(()=>{var e;return((e=P.query)==null?void 0:e.storeId)||""}),n=C(()=>o==null?void 0:o.selectedStore),f=C(()=>o==null?void 0:o.selectedGoods);me(()=>n.value,(e,t)=>{e&&t&&o.setSelectedGoods(null)},{immediate:!0,deep:!0});const Z=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,s=e==="x"?t:t&3|8;return s.toString(16)}),X=e=>{if(H.find(s=>{var l;return s===((l=e.type)==null?void 0:l.toLowerCase())}))return!0;D.fail("仅支持上传以下格式："+H.map(s=>{var l;return(l=s.replaceAll("image/",""))==null?void 0:l.toLocaleUpperCase()}).join("/"))},ee=async e=>{if(d.value.length>=G.value)return;D.loading({message:"上传中...",forbidClick:!0,duration:0});const t=await Ne(e,"noteImg"),s=await ye(t);D.clear(),s.success&&d.value.push({id:Z(),url:Ce.imgUrl+s.data})},te=e=>{Fe({images:d.value.map(t=>t.url),startPosition:e})},oe=()=>{o.setNoteForm({storeNoteTopic:u.value.storeNoteTopic,storeNoteContent:u.value.storeNoteContent,storeNotePics:d.value.join(","),store:o.selectedStore,goods:o.selectedGoods}),v.push("/city/noteCreate/selectStore")},se=()=>{v.push({path:"/city/noteCreate/selectGoods",query:{storeName:encodeURIComponent(n.value.storeName||"选择服务"),storeId:n.value.storeId}})},ae=async()=>{if(g.value||!j())return;g.value=!0,N(!0);const e=R(),t=await $({...e,releaseFlag:!1});g.value=!1,N(!1),t.success&&(h("保存成功","toast-success.svg"),setTimeout(()=>{v.replace("/city/draftNote")},1500))},re=async()=>{g.value||j()&&we.confirm({messageAlign:"center",message:"发布后不可编辑，已发布笔记可通过“存草稿”再次发布",confirmButtonText:V("common.confirm"),confirmButtonColor:"#FF507A",cancelButtonText:V("common.cancel"),cancelButtonColor:"#2E2008"}).then(async()=>{g.value=!0,N(!0);const e=R(),t=await $({...e,releaseFlag:!0});g.value=!1,N(!1),t.success&&(h("发布成功","toast-success.svg"),setTimeout(()=>{var s,l,i;((i=(l=(s=v.options)==null?void 0:s.history)==null?void 0:l.state)==null?void 0:i.back.indexOf("/city/myNote"))>-1?(v.back(),setTimeout(()=>{v.replace("/city/myNote")},50)):v.replace("/city/myNote")},1500))}).catch(()=>{})},h=(e="",t="toast-warn.svg")=>{D({message:e,icon:T(t),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},R=()=>{var l,i;const e=d.value.map(p=>p.url).join(","),t=(l=n.value)==null?void 0:l.storeId,s=(i=f.value)==null?void 0:i.goodsId;return{...u.value,storeNotePics:e,storeId:t,goodsId:s}},j=()=>d.value.length?u.value.storeNoteTopic?u.value.storeNoteContent?n.value?!0:(h("请选择门店"),!1):(h("请输入笔记内容"),!1):(h("请输入笔记标题"),!1):(h("请上传笔记图片"),!1),le=async()=>{var t,s,l,i,p,F;const e=await Be({id:A.value});e.success&&(u.value=e.data||{},d.value=(t=e.data)!=null&&t.storeNotePics?(s=e.data)==null?void 0:s.storeNotePics.split(","):[],(l=e.data)!=null&&l.store&&o.setSelectedStore((i=e.data)==null?void 0:i.store),(p=e.data)!=null&&p.goods&&o.setSelectedGoods((F=e.data)==null?void 0:F.goods))};return pe(()=>{var e,t,s,l,i,p;Y.value||o.setSelectedStore(null),o.setSelectedGoods(null),u.value.storeNoteTopic=((e=o.noteForm)==null?void 0:e.storeNoteTopic)||"",u.value.storeNoteContent=((t=o.noteForm)==null?void 0:t.storeNoteContent)||"",d.value=(s=o.noteForm)!=null&&s.storeNotePics?(l=o.noteForm)==null?void 0:l.storeNotePics.split(","):[],o.setSelectedStore(((i=o.noteForm)==null?void 0:i.store)||null),o.setSelectedGoods(((p=o.noteForm)==null?void 0:p.goods)||null),o.setNoteForm(null),A.value&&le()}),fe(()=>{o.setSelectedStore(null)}),(e,t)=>{const s=k("VanImage"),l=k("van-uploader"),i=k("VanButton"),p=k("router-view");return c(),I(De,{title:"发布笔记",class:"font-Puhui font-normal relative bg-gray1 min-h-full",themeVars:{navBarBackgroundColor:"#F2F0EF"}},{default:w(()=>{var F,U,L,z;return[a("div",Te,[a("div",Ve,[d.value.length?(c(),I(r(xe),ve({key:0,class:"flex flex-wrap gap-3",modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=_=>d.value=_),"item-key":"id"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}),{item:w(({element:_,index:ue})=>[a("div",{class:"van-uploader__preview",onClick:_e(mt=>te(ue),["stop"])},[a("div",Ae,[x(s,{src:_.url,class:"van-image__img rounded-md overflow-hidden",alt:"",fit:"cover"},null,8,["src"])]),x(s,{src:r(T)("imgDel.svg"),class:"absolute top-2 right-2 w-[15px] h-[15px] bg- rounded-full",alt:"删除",fit:"cover"},null,8,["src"])],8,Pe)]),_:1},16,["modelValue"])):y("",!0),d.value.length<G.value?(c(),I(l,{key:1,accept:r(ke),"max-count":6,"preview-size":"72.5",beforeRead:X,afterRead:ee},{default:w(()=>[a("div",Ge,[x(s,{src:r(T)("image-default.svg"),class:"w-6 mx-auto overflow-hidden",alt:""},null,8,["src"]),Re,a("div",je,b(d.value.length)+"/6 ",1)])]),_:1},8,["accept"])):y("",!0)]),a("div",Ue,[M(a("input",{type:"text",class:"w-full","onUpdate:modelValue":t[1]||(t[1]=_=>u.value.storeNoteTopic=_),maxlength:15,placeholder:"输入笔记标题"},null,512),[[q,u.value.storeNoteTopic,void 0,{trim:!0}]]),a("span",Le,b(u.value.storeNoteTopic.length)+"/15",1)]),a("div",ze,[M(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=_=>u.value.storeNoteContent=_),maxlength:200,placeholder:"输入笔记正文",class:"min-h-[100px] w-full resize-y"},null,512),[[q,u.value.storeNoteContent,void 0,{trim:!0}]]),a("p",Me,b(u.value.storeNoteContent.length)+"/200 ",1)])]),a("div",qe,[a("div",Oe,[$e,a("div",{class:O(["w-full flex items-center",r(n)?"text-[#585654]":"text-[#999]"]),onClick:oe},[r(n)&&((F=r(n))!=null&&F.storeName)?(c(),m("span",He,b(((U=r(n))==null?void 0:U.storeName)||"--"),1)):(c(),m("span",Je,"去选择")),r(n)?(c(),m("img",Ke)):(c(),m("img",Qe))],2)]),r(n)?(c(),m("div",We,[x(Se,{store:r(n)},null,8,["store"])])):y("",!0)]),r(n)?(c(),m("div",Ye,[a("div",Ze,[Xe,a("div",{class:O(["w-full flex items-center",r(f)?"text-[#585654]":"text-[#999]"]),onClick:se},[r(f)&&((L=r(f))!=null&&L.goodsName)?(c(),m("span",et,b(((z=r(f))==null?void 0:z.goodsName)||"--"),1)):(c(),m("span",tt,"去选择(非必选)")),r(f)?(c(),m("img",ot)):(c(),m("img",st))],2)]),r(f)?(c(),m("div",at,[x(Ie,{goods:r(f),store:r(n)},null,8,["goods","store"])])):y("",!0)])):y("",!0),rt,a("div",lt,[x(i,{round:"",type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-full border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:ae},{default:w(()=>[ut]),_:1}),x(i,{round:"",class:"flex-1 min-w-[130px] h-[46px] text-base font-semibold bg-yellow text-b1",onClick:re},{default:w(()=>[nt]),_:1})]),x(p,{class:"child-view"})]}),_:1})}}const dt=J({...it,setup:ct}),Nt=ne(dt,[["__scopeId","data-v-500a8948"]]);export{Nt as default};
