import{_ as Q}from"./MCOIN-BcbOHmhy.js";import{_ as X,y as R,w as Y,l as Z,a1 as W,r as C,bd as F,x as ee,D as oe,bf as te,bh as se,E as k,K as _,G as p,N as r,O as g,H as c,a2 as O,P as t,F as E,J as ne,Q as u,a0 as S,I as le,R as ie,Y as ae,Z as de}from"./vendor-D6JO6WHW.js";import{C as re}from"./CommonVanProvider-CI5dtYow.js";import{_ as fe}from"./OfflineGoods-B2XKWwbl.js";import{S as ce}from"./SearchBox-CvI3QpRF.js";import{B as ue}from"./BetweenTab-BjlQ6F6h.js";import{e as N,u as pe,V as ge,b9 as he,aR as me,X as ye}from"./index-koYZVdtr.js";import{D as ve}from"./goods-BVwS8oFG.js";import{b as f}from"./offlineGoods-Biq4pIIG.js";import{S as _e}from"./shop-CeqcS6K2.js";import"./BackIcon-CPUEW9je.js";import"./ImgBoutiqueLable-Dod52ZXF.js";import"./search-Dwmdj_3F.js";import"./filter-B5MATEpa.js";import"./category-Dm8ZK1uH.js";const Se=y=>(ae("data-v-0980fd5c"),y=y(),de(),y),be=["src"],Ie={class:"text-b3"},xe={class:"px-3 mt-3"},Te={class:"flex items-center"},we=Se(()=>c("img",{src:Q,class:"w-4 h-4 mr-1.5"},null,-1)),Ce={class:"text-newOrigin"},ke={class:"relative flex justify-end text-xs mt-3"},Oe=R({name:"GoodsManage"});function Ve(y){var P;const{t:b}=Y(),{regionStore:I}=N(),V=Z(),G=W(),{getCurrentStoreId:A}=pe(),D=C(null),{accountStore:v,clerkStore:q}=N(),M=[{label:b("offline.onSale"),value:f.Published},{label:b("shop.watiShelf"),value:f.OffShelf},{label:b("offline.drafts"),value:f.DRAFT}],o=F({shopInfo:null,list:[],total:0,loading:!1,finished:!1}),l=F({shopId:(P=o.shopInfo)==null?void 0:P.id,page:0,size:10,goodsNameLike:"",goodsCategoryId1:"",goodsStatus:f.Published,goodsType:null,sortBy:"desc|create_time"}),U=ee(()=>{var e;return(e=o==null?void 0:o.shopInfo)==null?void 0:e.type}),$=e=>{V.push(e)},z=async e=>{l.goodsType=(e==null?void 0:e.type)>=_e.SD?e.type:void 0,l.startTime=(e==null?void 0:e.upStartTime)||void 0,l.endTime=(e==null?void 0:e.upEndTime)||void 0,l.goodsCategoryId1=(e==null?void 0:e.subclassId)||void 0,h()},j=e=>{l.goodsStatus=e,V.replace({path:"offlineGoods",query:{status:e}}),h()},L=async(e,s)=>{e.loading=!0;const{success:i}=await he({goodsId:e.goodsId,shopId:e.shopId,goodsStatus:s});e.loading=!1,i&&(o.list=o.list.filter(a=>a.goodsId!==e.goodsId))},h=async()=>{o.finished=!1,o.total=0,o.list=[],l.page=0,x()},x=async()=>{var e,s;if(!((e=o.shopInfo)!=null&&e.id))return o.finished=!0;o.loading=!0,l.shopId=(s=o.shopInfo)==null?void 0:s.id,l.page+=1,await H(),o.loading=!1},H=async()=>{const{success:e,data:s}=await me(l);if(o.loading=!1,!e){o.finished=!0;return}const{records:i,total:a,current:w,pages:n}=s;if(!a||!i||!(i!=null&&i.length)){o.finished=!0;return}o.total=a;const d=C([]);d.value=i.map(K=>({btnLoading:!1,...K})),o.list=l.page===1?d.value:o.list.concat(d.value),+w>=+n&&(o.finished=!0)};let m=null;const J=async()=>{const e=localStorage.getItem("shopOffline_scrollTop");+e?m.scrollTo({top:+e,left:0,behavior:"instant"}):localStorage.removeItem("shopOffline_scrollTop")},T=C(!1),B=()=>{T.value||(T.value=!0,setTimeout(()=>{localStorage.setItem("shopOffline_scrollTop",m.scrollTop+""),T.value=!1},500))};return oe(async()=>{var e,s;m=document.querySelector(".shopGoodsPage"),m.addEventListener("scroll",B),(e=G.query)!=null&&e.status&&(l.goodsStatus=Number((s=G.query)==null?void 0:s.status)),o.shopInfo=await A(),x()}),te(async()=>{q.isClerk&&h();try{J();const e=sessionStorage.getItem("shop_offline_refresh_id");if(e){const s=await ye(e),i=o.list.findIndex(a=>a.goodsId===e);i>-1?s.data.goodsStatus!==o.list[i].goodsStatus?o.list.splice(i,1):o.list[i]=s.data:h()}}finally{sessionStorage.removeItem("shop_offline_refresh_id")}}),se(()=>{m.removeEventListener("scroll",B)}),(e,s)=>{const i=k("VanButton"),a=k("VanList"),w=k("router-view");return p(),_(re,{title:e.$t("offline.sale_services"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(n,d)=>{d.shopGoodsRef=n,D.value=n}},{right:r(()=>[c("img",{src:t(ge)(`mall/${t(I).country}-flag.svg`),class:"w-5 h-auto mr-1"},null,8,be),c("span",Ie,u(e.$t(`country.${t(I).country}`))+u(t(I).country),1)]),default:r(()=>[g(ue,{options:M,"label-key":"label","value-key":"value",modelValue:t(l).goodsStatus,"onUpdate:modelValue":s[0]||(s[0]=n=>t(l).goodsStatus=n),onChange:j},null,8,["modelValue"]),c("div",xe,[g(ce,{modelValue:t(l).goodsNameLike,"onUpdate:modelValue":s[1]||(s[1]=n=>t(l).goodsNameLike=n),deliveryType:t(ve).offeline,shopType:t(U),onOnSubmit:h,onOnFilter:z},null,8,["modelValue","deliveryType","shopType"])]),c("div",{class:ie(["m-3 overflow-y-auto shopGoodsPage",{"safe-body":!t(v).isOnlyView}])},[g(a,{loading:t(o).loading,"onUpdate:loading":s[2]||(s[2]=n=>t(o).loading=n),finished:t(o).finished,"immediate-check":!1,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:x},{default:r(()=>[(p(!0),E(le,null,ne(t(o).list,n=>(p(),E("div",{class:"offline-crad-box mb-3",key:n.goodsId},[g(fe,{showSale:"",showGoodsType:"",goods:n},{"bottom-price":r(()=>[c("div",Te,[we,c("div",Ce,u(n.goodsPrice),1)])]),_:2},1032,["goods"]),c("section",ke,[t(l).goodsStatus===t(f).Published&&!t(v).isOnlyView?(p(),_(i,{key:0,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:n.loading,onClick:d=>L(n,t(f).OffShelf)},{default:r(()=>[S(u(e.$t("shop.down")),1)]),_:2},1032,["loading","onClick"])):O("",!0),t(l).goodsStatus===t(f).OffShelf&&!t(v).isOnlyView?(p(),_(i,{key:1,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:n.loading,onClick:d=>L(n,t(f).Published)},{default:r(()=>[S(u(e.$t("shop.up")),1)]),_:2},1032,["loading","onClick"])):O("",!0),g(i,{color:"#FED73A",round:"",class:"!text-b1 font-semibold h-[32px] rounded-md px-3",onClick:d=>$(`/offlineGoodsEditGoods?goodsId=${n.goodsId.toString()}`)},{default:r(()=>[S(u(e.$t("shop.modify")),1)]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])],2),t(v).isOnlyView?O("",!0):(p(),_(i,{key:0,onClick:s[3]||(s[3]=n=>$("/offlineGoodsEditGoods")),class:"bg-btnOrBg w-[calc(100%-32px)] max-w-[343px] mx-auto h-[46px] flex-center text-b1 text-base font-semibold z-50 rounded-3xl"},{default:r(()=>[S(u(e.$t("offline.published_goods")),1)]),_:1})),g(w,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const Ge=R({...Oe,setup:Ve}),He=X(Ge,[["__scopeId","data-v-0980fd5c"]]);export{He as default};
