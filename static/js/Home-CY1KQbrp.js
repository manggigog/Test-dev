var q=Object.defineProperty;var z=(r,t,l)=>t in r?q(r,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[t]=l;var x=(r,t,l)=>z(r,typeof t!="symbol"?t+"":t,l);import{bf as N,bP as F,n as K,_ as $,y as O,l as P,r as i,D as V,E,F as g,G as u,H as o,Q as S,ba as M,a2 as U,bn as A,bI as J,I as T,J as L,R as Q,K as w,N as W,Y,Z}from"./vendor-D6JO6WHW.js";import{_ as X}from"./search-B34EARrH.js";import{bg as ee,aR as oe,aP as se}from"./index-CybuWkSo.js";import{H as te}from"./HomeGoodsItem-BO_PyWEc.js";import"./MCOIN-BOqZVkND.js";import"./RatioBox-C9aLwz0w.js";import"./ImgBoutiqueLable-Dod52ZXF.js";import"./shop-CeqcS6K2.js";const le="/static/images/delete-Dt-cIuki.svg";class ae{constructor(t,l){x(this,"scrollTop");x(this,"selector");x(this,"key");this.scrollTop=0,this.selector=t,this.key=l,N(()=>{if(sessionStorage.getItem(this.key)=="1"){sessionStorage.removeItem(this.key),this.clearScrollTop();return}K(()=>{const c=document.querySelector(this.selector);c&&(c.scrollTop=this.scrollTop)})}),F(()=>{const n=document.querySelector(this.selector);this.scrollTop=n?n.scrollTop:0})}clearScrollTop(){this.scrollTop=0}getScrollTop(){return this.scrollTop}setScrollTop(t){this.scrollTop=t}}const p=r=>(Y("data-v-7b6454dd"),r=r(),Z(),r),re={class:"app-container"},ne={class:"header__wrap w-full h-[50px]"},ce={class:"header__title h-full"},ie={class:"h-full flex items-center justify-center"},de={class:"text-b1 text-base font-bold"},ue={class:"search__wrap w-full h-[48px] px-3 pb-3"},_e={class:"search__input w-full h-full bg-white rounded-3xl flex items-center justify-center px-3 py-2.5"},fe=p(()=>o("div",{class:"search__icon flex-shrink-0"},[o("img",{src:X,class:"w-4 h-4"})],-1)),he=["onKeyup"],ge=p(()=>o("img",{src:le,class:"w-4 h-4",alt:""},null,-1)),pe=[ge],me=p(()=>o("span",{class:"text-[#FF8812] text-sm font-semibold whitespace-nowrap"}," 搜索 ",-1)),ve=[me],ye={class:"list__wrap"},xe=p(()=>o("div",{class:"category__shadow fixed left-0 bottom-0 w-[80px] h-14 safe-bottom sm:bottom-[0%] lg:bottom-[0%] z-[10] box-content"},null,-1)),be={class:"category__wrap overflow-y-scroll"},we=["onClick"],Ce={class:"text-sm category-name"},ke=p(()=>o("div",{class:"bg-[#f5f5f5] h-[88px]"},null,-1)),Ie={class:"goods__wrap overflow-y-scroll"},Se=O({name:"OfflineHome"});function Te(r){const t=P(),l=i(""),n=i("-1"),c=i(!1),h=i(0),B=i(20),f=i(!1),_=i([]),m=i([]),D=s=>{n.value=s,k()},G=async()=>{try{const{success:s,data:d}=await se();if(!s)return;let e=(d||[]).filter(a=>+a.goodsCount>0);e=e.map(a=>({...a,goodsCategoryName:a.goodsCategoryName.slice(0,4)})),e.unshift({goodsCategoryId:"-1",goodsCategoryName:"推荐"}),m.value=e}catch(s){console.error("获取类目数据失败:",s),m.value=[]}},R=()=>{l.value="",b()},C=i(null),b=()=>{c.value||(h.value=0,f.value=!1,_.value=[],v(),C.value.blur())},k=()=>{h.value=0,f.value=!1,_.value=[],v()},v=async()=>{c.value=!0,h.value+=1,f.value=!1,await j(),c.value=!1},j=async()=>{let s={};n.value==="-1"?s={sortBy:"desc|goods_sales_volume,desc|goods_id",goodsCategoryId1:null}:s={sortBy:null,goodsCategoryId1:n.value||null};const d={page:h.value,size:B.value,goodsStatus:1,goodsNameLike:l.value,...s},{success:y,data:e}=await oe(d);if(!y||!e||!e.total){f.value=!0;return}const a=e.records||[];_.value=h.value===1?a:[..._.value,...a],_.value.length>=e.total&&(f.value=!0)},H=s=>{t.push({path:"/offlineGoodsDetail",query:{goodsId:s.goodsId}})};return V(()=>{new ae(".goods__wrap","offline_home_scroll"),v()}),N(()=>{sessionStorage.getItem("reset_offline_home_scroll")=="1"&&(sessionStorage.removeItem("reset_offline_home_scroll"),k()),G()}),(s,d)=>{const y=E("van-list");return u(),g("div",re,[o("div",ne,[o("div",ce,[o("div",ie,[o("div",de,S(s.$t("offline.main title")),1)])])]),o("div",ue,[o("div",_e,[fe,M(o("input",{ref:(e,a)=>{a.searchRef=e,C.value=e},type:"text","onUpdate:modelValue":d[0]||(d[0]=e=>l.value=e),class:"w-full h-full bg-transparent ml-1 font-normal",placeholder:"请输入搜寻关键字",onKeyup:J(b,["enter"]),enterkeyhint:"search"},null,40,he),[[A,l.value]]),l.value?(u(),g("div",{key:0,class:"flex-shrink-0 flex items-center justify-center",onClick:R},pe)):U("",!0),o("div",{class:"search__btn ml-2 flex-shrink-0",onClick:b},ve)])]),o("div",ye,[xe,o("div",be,[(u(!0),g(T,null,L(m.value,(e,a)=>{var I;return u(),g("div",{key:e.goodsCategoryId,class:Q(["category__item h-[44px] min-h-[44px] w-full flex items-center justify-center font-normal text-b2",{"bg-white !text-b1 font-semibold selected-category":n.value===e.goodsCategoryId,"selected-category-prev":n.value===((I=m.value[a+1])==null?void 0:I.goodsCategoryId)}]),onClick:Ne=>D(e.goodsCategoryId)},[o("span",Ce,S(e.goodsCategoryName||"/"),1)],10,we)}),128)),ke]),o("div",Ie,[_.value.length===0&&!c.value?(u(),w(ee,{key:0,name:"暂无搜索结果"})):(u(),w(y,{key:1,loading:c.value,"onUpdate:loading":d[1]||(d[1]=e=>c.value=e),finished:f.value,"finished-text":"没有更多了",onLoad:v},{default:W(()=>[(u(!0),g(T,null,L(_.value,e=>(u(),w(te,{key:e.goodsId,goods:e,class:"mb-4 :last:mb-0",onClick:a=>H(e),"show-store-name":""},null,8,["goods","onClick"]))),128))]),_:1},8,["loading","finished"]))])])])}}const Le=Object.assign(Se,{setup:Te}),Ke=$(Le,[["__scopeId","data-v-7b6454dd"]]);export{Ke as default};
