import{_ as O,y as z,r as c,bc as L,D as oe,E as I,F as y,G as i,H as a,O as _,N as A,K as D,P as n,I as se,a4 as M,Q as T,w as Le,$ as Me,o as U,Y as fe,Z as me,J as ge,R as H,a2 as q,l as Ne,x as ee,bI as Ee,bq as qe,a0 as Ye}from"./vendor-D6JO6WHW.js";import{N as ze}from"./NoRanking-OFQKlrBf.js";import{R as we,_ as je,a as Qe}from"./RankingShopItem-I5f5es1c.js";import{u as Ue,S as He,g as ve,b as Oe,aS as he,V as Ke,C as Ge}from"./index-CbIwihlz.js";import{q as te,a as Ze,b as Je}from"./beiRanking-DOY3XZdF.js";import{q as We}from"./user-C1bf1t60.js";import{b as _e}from"./beiExtRewardContract-B5hYiata.js";import{_ as Xe}from"./calendar-yellow-DuCGlPYa.js";import{S as et}from"./ShopVotePop-VrH7dDlv.js";import{V as tt}from"./VoteRewardPop-7nuJK8wV.js";import{C as ot}from"./CommonVanProvider-CI5dtYow.js";import{B as st}from"./BackIcon-CPUEW9je.js";import"./Lottie_v2-BS7gF7u9.js";import"./member-CkdtKF8y.js";import"./SkewCard-CreFztFl.js";import"./shop-CeqcS6K2.js";import"./beiConstContract-9GKmIGuG.js";const nt="/static/images/cat-ip-B1otGVvA.png",at="/static/images/store_title-BHZZnPgm.png",lt="/static/images/search-line-DiUN1tEO.svg",rt=["onClick"],ut={class:"box-bg"},it=["onClick"],ct=z({props:{month:null},emits:["toApply","toApplyShop","toQuit"],setup(h,{expose:k,emit:f}){const{voteMonthTimestampView:$}=_e(),P=Ue().getCurrentAccount(),e=c(null),d=c(null),v=()=>{var g,r;(g=e.value)!=null&&g.id&&((r=e.value)==null?void 0:r.status)===1?f("toApply"):f("toApplyShop")},[x,V]=L(!0),m=async()=>{V(!0);const{success:g,data:r}=await He();if(!g||(r==null?void 0:r.status)!==1){if(e.value={...r,status:0,shopAddress:P},!e.value.storeName){const{success:C,data:p}=await We();C&&(p!=null&&p.nickName)&&(e.value.storeName=p==null?void 0:p.nickName)}V(!1);return}e.value=r,e.value.shopAddress=r==null?void 0:r.merchant,e.value.shopId=r==null?void 0:r.id,u()},u=async()=>{var p,w,l;if(!((p=e.value)!=null&&p.shopId))return;V(!0);const{result:g}=await $(),{success:r,data:C}=await te({shopId:(w=e.value)==null?void 0:w.shopId,month:+g.thisMonthTime});V(!1),!(!r||!C)&&(d.value=C,((l=d.value)==null?void 0:l.status)!==1&&(d.value.sort=null))};return oe(()=>{m()}),k({getRankingInfo:u}),(g,r)=>{var p;const C=I("VanLoading");return i(),y("div",{class:"fixed bottom-0 w-full sm:w-[375px] mx-auto",onClick:M(v,["stop"])},[a("div",ut,[_(we,{rankItem:d.value||e.value,hideScore:((p=d.value)==null?void 0:p.status)!==1,showPower:!0,class:"pl-4 pr-5"},{right:A(()=>{var w,l,E,N;return[n(x)?(i(),D(C,{key:0,size:"20"})):(i(),y(se,{key:1},[((w=e.value)==null?void 0:w.status)===1&&((l=d.value)==null?void 0:l.status)===1?(i(),y("div",{key:0,class:"bg-[#FFF8EC] text-[#7D3619] font-semibold rounded-md px-3 py-1.5 min-w-[52px]",onClick:r[0]||(r[0]=M(b=>f("toQuit"),["stop"]))},T(g.$t("ranking.Exit list")),1)):(i(),y("div",{key:1,class:"btn-linear text-b6 font-semibold px-3 py-1.5 min-w-[52px]",onClick:M(v,["stop"])},T((E=e.value)!=null&&E.id&&((N=e.value)==null?void 0:N.status)===1?g.$t("ranking.Go and apply"):g.$t("shop.applyShop")),9,it))],64))]}),_:1},8,["rankItem","hideScore"])])],8,rt)}}}),pt=O(ct,[["__scopeId","data-v-481becc4"]]),dt=h=>(fe("data-v-5e4382be"),h=h(),me(),h),vt=dt(()=>a("img",{class:"w-5 h-5",src:Xe,alt:""},null,-1)),ht={key:0},ft={key:1},mt={class:"flex items-end px-5 py-4 text-sm"},gt=z({props:{pageType:null},emits:["changeTime"],setup(h,{emit:k}){const f=h,{t:$}=Le(),[P,e]=L(!1),{voteMonthTimestampView:d}=_e(),v=c(),x=c(new Date),V=c(new Date),m=c(""),u=c(""),g=()=>{v.value=x.value,u.value=U(v.value).format("MM"),m.value=U(v.value).format("YYYY"),e(!1),k("changeTime",{years:m.value,cycle:u.value})},r=async()=>{const{result:w}=await d();x.value=new Date(+w.thisMonthTime*1e3),u.value=U(x.value).format("MM"),m.value=U(x.value).format("YYYY")},C=()=>{v.value=null,x.value=V.value,u.value="",m.value="",e(!1),k("changeTime",{years:1e4})},p=(w,l)=>w==="month"?`${l}${$("common.month")}`:l;return oe(async()=>{f.pageType!=="record"&&await r(),m.value&&k("changeTime",{years:m.value,cycle:u.value})}),(w,l)=>{const E=I("van-datetime-picker"),N=I("van-popup");return i(),y("div",{class:"text-[#663D15] font-semibold flex flex-shrink-0 px-2 pr-3 items-center gap-1 h-8 bg-white rounded-3xl",onClick:l[3]||(l[3]=b=>n(e)(!0))},[vt,m.value&&u.value?(i(),y("span",ht,T(m.value+"-"+u.value),1)):(i(),y("span",ft,T(w.$t("ranking.overall_ranking")),1)),_(N,{round:"",teleport:"body",show:n(P),"onUpdate:show":l[2]||(l[2]=b=>Me(P)?P.value=b:null),position:"bottom",style:{height:"40%"}},{default:A(()=>[a("div",mt,[a("div",{class:"opacity-50",onClick:C},T(w.$t("ranking.overall_ranking")),1),a("div",{class:"ml-auto text-[#FEA021] text-sm",onClick:l[0]||(l[0]=b=>g())},T(w.$t("common.confirm")),1)]),_(E,{"swipe-duration":"200",modelValue:x.value,"onUpdate:modelValue":l[1]||(l[1]=b=>x.value=b),type:"year-month",title:"","max-date":V.value,"show-toolbar":!1,formatter:p},null,8,["modelValue","max-date"])]),_:1},8,["show"])])}}}),wt=O(gt,[["__scopeId","data-v-5e4382be"]]),_t={class:"flex items-end justify-center mx-[7px] mt-12"},kt=["onClick"],xt=["onClick"],yt={class:"relative w-[50px] h-[50px] rounded-full avatar-img mx-auto"},$t=["src"],Ct=["src"],bt=["onClick"],St={class:"max-w-[90%] line-clamp-1 text-center text-[#7D3100]"},It={key:0,class:"flex flex-col items-center"},Tt={class:"text-xs text-b2 leading-[18px]"},Vt=["onClick"],Rt={class:"relative text-[#4D2E0F] text-right text-[22px] font-BebasNeue"},Bt={key:0,class:"absolute right-[-22px] bottom-0 text-xs flex gap-x-1 min-w-fit"},Ft=z({props:{rankingTopList:null,showPower:{type:Boolean}},emits:["voteShop","toDetail"],setup(h,{emit:k}){const{rankingTopList:f}=h;return($,P)=>(i(),y("div",_t,[(i(!0),y(se,null,ge(h.rankingTopList,(e,d)=>(i(),y("div",{key:d,class:H(["min-h-[120px] text-center relative px-1",`bg-linear__${d==1?"one":d==0?"two":"three"}`]),onClick:M(v=>k("voteShop",e),["stop"])},[a("div",{class:"-mt-[15px] relative",onClick:M(v=>k("toDetail",e),["stop"])},[a("div",yt,[a("img",{src:((e==null?void 0:e.logo)||"").split()[0]||n(ve)("images/ranking/noPosition.png"),class:"object-cover w-full h-full rounded-full"},null,8,$t),a("img",{src:n(ve)(`images/ranking/top_${d}.png`),class:"w-8 h-auto absolute -top-4 -left-4"},null,8,Ct)])],8,xt),a("div",{class:"mt-2 flex justify-center items-center",onClick:M(v=>k("toDetail",e),["stop"])},[a("div",St,T((e==null?void 0:e.storeName)||$.$t("ranking.Waiting for a vacant position")),1)],8,bt),e?(i(),y("div",It,[a("div",Tt,T(n(Oe)(e==null?void 0:e.shopAddress,"**",0,4)),1),a("div",{class:"flex items-center justify-center gap-x-1 mt-2",onClick:M(v=>k("voteShop",e),["stop"])},[a("div",Rt,[_(je,{score:e==null?void 0:e.score},null,8,["score"]),h.showPower?(i(),y("div",Bt,[_(Qe,{direction:e==null?void 0:e.direction,onCompletePlay:()=>{e.direction=null}},null,8,["direction","onCompletePlay"])])):q("",!0)])],8,Vt),a("div",{class:H(["-mt-6 w-8 h-4 font-bold text-base text-center text-[#995C1F] index-number",{up:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)<+(e==null?void 0:e.preHeat),down:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)>+(e==null?void 0:e.preHeat)}])},null,2)])):q("",!0)],10,kt))),128))]))}}),At=O(Ft,[["__scopeId","data-v-5aa8ab90"]]),K=h=>(fe("data-v-81af7ab6"),h=h(),me(),h),Pt={class:"parent-view",id:"ranking"},Dt={class:"flex flex-col w-full h-auto bg-mask parent-view"},Lt=K(()=>a("img",{src:nt,class:"w-auto h-[160px] absolute right-3 top-8 -z-0"},null,-1)),Mt={class:"h-[50px] text-b2 flex items-center justify-between px-3"},Nt={class:"px-4 pt-5 pb-3 relative"},Et=K(()=>a("div",{class:"min-h-[44px] relative -z-10"},[a("img",{src:at,class:"min-w-[200px] h-auto w-[53%]"})],-1)),qt={class:"mt-[25px] flex items-center gap-x-3 relative"},Yt=K(()=>a("img",{src:lt,class:"w-5 h-5"},null,-1)),zt=Ye("奖励弹窗展示"),jt=["onClick"],Qt=K(()=>a("span",{class:"text-sm text-[#663D15]"},"奖励记录",-1)),Ut=z({name:"TalentRanking"});function Ht(h){const k=Ne(),f=c(null),$=c(null),P=o=>{+o.years>=1e4?f.value=1e4:f.value=he(`${o.years}-${o.cycle}`),Ve()},e=c(!1),d=c(!1),v=c(!1),x=c(0),V=c(20),m=c(0),u=c([]),g=c(null),[r,C]=L(!1),[p,w]=L(!1),l=c(null),[E,N]=L(!0),b=ee(()=>+he()==+f.value),ke=async()=>{const{success:o,data:t,params:B}=await Je({page:x.value,size:V.value,month:f.value,shopNameLike:l.value});if(!o||!t||!(t!=null&&t.total)||B.month&&+B.month!=+f.value){m.value=t==null?void 0:t.total,v.value=!0;return}const S=(t==null?void 0:t.records)||[];m.value=t.total,u.value=x.value===1?S:u.value.concat(S),u.value&&u.value.length>=m.value&&(v.value=!0)},ne=ee(()=>u.value?p.value?u.value:u.value.slice(3):[]),xe=ee(()=>p.value?[]:[u.value[1],u.value[0],u.value[2]]),R=c({shopId:null,score:null}),[ae,le]=L(!1),re=o=>{!(o!=null&&o.shopId)||!b.value||(R.value=o,le(!0))},ue=o=>{o!=null&&o.shopId&&(R.value=o,Y(`/talentRanking/rankingShop?shopId=${o.shopId}`))},[ye,j]=L(!1),[$e,ie]=L(!1),Ce=async()=>{var t;ie(!0);const{success:o}=await Ze();j(!1),o&&(Q(),(t=$.value)==null||t.getRankingInfo(),ie(!1))},ce=async()=>{d.value=!0,x.value+=1,await ke(),d.value=!1},G=c(null),be=()=>{G.value&&G.value.handleShowReward()},Se=async(o,t,B=!1)=>{var S;o!=null&&o.shopId&&(t.direct===200?o.score+=t==null?void 0:t.differ:o.score-=t==null?void 0:t.differ,o.direction=t.direct,$.value&&((S=$.value)==null||S.getRankingInfo()),setTimeout(()=>{o.direction=null,N(B)},2e3),setTimeout(async()=>{const{success:W,data:X}=await te({shopId:o==null?void 0:o.shopId,month:f.value});W&&(o.score=X.score)},5e3))},Ie=async()=>{var B,S;if(!(R!=null&&R.value.shopId))return;const{success:o,data:t}=await te({shopId:(B=R.value)==null?void 0:B.shopId,month:f.value});o&&(R.value.score=t.score,$.value&&((S=$.value)==null||S.getRankingInfo()))},Q=()=>{x.value=0,v.value=!1,u.value=[],ce()},Z=()=>{var o;w(!!(l!=null&&l.value)),(o=g.value)==null||o.blur(),Q()},Te=()=>{e.value=!1,Q()},Ve=()=>{J&&(Be.value=J.scrollTop),Q()},Y=o=>{k.push(o)},Re=()=>{k.options.history.state.back.toString().includes("talentRanking")?k.replace("/rankingReward"):Y("/rankingReward")};let J=null;const Be=c(0);return oe(()=>{J=document.querySelector(".list__wrap")}),(o,t)=>{const B=I("VanField"),S=I("VanButton"),W=I("VanConfigProvider"),X=I("VanImage"),Fe=I("VanList"),Ae=I("van-pull-refresh"),Pe=I("router-view");return i(),D(ot,{class:"h-full font-Puhui font-normal relative",style:{background:"linear-gradient(180deg, #fed820 4%, #fea020 30%, #fed820 85%)"},themeVars:{navBarBackgroundColor:"transparent",navBarIconColor:"#000"}},{default:A(()=>{var pe;return[a("div",Pt,[a("div",Dt,[Lt,a("div",Mt,[_(st),a("div",{class:"pl-2",onClick:t[0]||(t[0]=s=>Y("/talentRanking/rankingRule"))},T("规则"))]),a("div",Nt,[Et,a("div",qt,[_(wt,{pageType:"list",onChangeTime:P}),_(W,{"theme-vars":{"field-placeholder-text-color":"#663D15","field-input-text-color":"#663D15"}},{default:A(()=>[_(B,{ref:(s,F)=>{F.searchRef=s,g.value=s},class:H(["bg-b6 rounded-full h-8 flex items-center font-normal pl-2 pr-3 transition-all duration-300 relative z-10",n(r)||l.value?"flex-1":"w-[72px]"]),onFocus:t[1]||(t[1]=s=>n(C)(!0)),onBlur:t[2]||(t[2]=s=>n(C)(!1)),modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value=s),clearable:"",placeholder:n(r)?"":o.$t("common.search"),onClear:Z,onKeyup:Ee(Z,["enter"]),enterkeyhint:"search"},qe({"left-icon":A(()=>[Yt]),_:2},[n(r)||l.value?{name:"right-icon",fn:A(()=>[a("div",{class:"text-newOrigin font-semibold",onClick:Z},T(o.$t("common.search")),1)])}:void 0]),1032,["class","modelValue","placeholder","onKeyup"]),_(S,{onClick:be},{default:A(()=>[zt]),_:1})]),_:1})])]),_(Ae,{modelValue:e.value,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value=s),onRefresh:Te,class:"list__wrap relative flex-1 overflow-auto rounded-t-xl mx-2"},{default:A(()=>[n(p)?q("",!0):(i(),y("div",{key:0,class:"absolute z-10 -right-1 top-4 w-fit h-fit py-[5px] px-2 bg-[#FFE4AD] border border-solid border-[rgba(255,255,255,0.64)] rounded-s-full flex items-center",onClick:M(Re,["stop"])},[Qt,_(X,{class:"ml-[2px] w-4 h-4",src:n(Ke)("ranking/record_arrow.svg")},null,8,["src"])],8,jt)),!n(p)&&u.value.length>0?(i(),D(At,{key:1,rankingTopList:n(xe),showPower:n(b),onVoteShop:t[4]||(t[4]=s=>re(s)),onToDetail:t[5]||(t[5]=s=>ue(s))},null,8,["rankingTopList","showPower"])):q("",!0),!d.value&&v.value&&m.value==0?(i(),D(ze,{key:2})):(i(),D(Fe,{key:3,loading:d.value,finished:v.value,"finished-text":o.$t("common.noMore"),"immediate-check":!1,class:"min-h-[40vh] pb-[100px] relative z-10",onLoad:ce},{default:A(()=>[(i(!0),y(se,null,ge(n(ne),(s,F)=>{var de;return i(),D(we,{key:s.id,rankItem:s,showPower:n(b),onVoteShop:De=>re(s),onToDetail:De=>ue(s),class:H(["relative",{"active-bottom":F+1!==((de=n(ne))==null?void 0:de.length)}])},null,8,["rankItem","showPower","onVoteShop","onToDetail","class"])}),128))]),_:1},8,["loading","finished","finished-text"]))]),_:1},8,["modelValue"])]),n(b)&&!n(p)?(i(),D(pt,{key:0,ref:(s,F)=>{F.userOwnerRef=s,$.value=s},month:f.value,onToApply:t[7]||(t[7]=s=>Y("/joinRanking")),onToApplyShop:t[8]||(t[8]=s=>Y("/editShopInfo")),onToQuit:t[9]||(t[9]=s=>n(j)(!0))},null,8,["month"])):q("",!0)]),n(ae)?(i(),D(et,{key:0,show:n(ae),shopId:(pe=R.value)==null?void 0:pe.shopId,teleport:"#ranking",onClose:t[10]||(t[10]=s=>n(le)(!1)),onVoteSuccess:t[11]||(t[11]=(s,F)=>Se(R.value,s,F))},null,8,["show","shopId"])):q("",!0),_(tt,{show:n(E),onClose:t[12]||(t[12]=s=>n(N)(!1)),ref:(s,F)=>{F.voteRewardRef=s,G.value=s}},null,8,["show"]),_(Ge,{show:n(ye),content:"您的店铺本月已存在被投票充电记录，本次退出榜单操作将在下月生效",showConfirm:!0,showReject:!0,loading:n($e),confirmText:"确认退榜",noClose:"","content-class":"text-b1 font-semibold",onClose:t[13]||(t[13]=s=>n(j)(!1)),onConfirm:Ce,onReject:t[14]||(t[14]=s=>n(j)(!1))},null,8,["show","loading"]),_(Pe,{class:"child-view",onVoteSuccess:Ie})]}),_:1})}}const Ot=z({...Ut,setup:Ht}),po=O(Ot,[["__scopeId","data-v-81af7ab6"]]);export{po as default};
