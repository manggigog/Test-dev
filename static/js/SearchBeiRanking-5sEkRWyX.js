import{_ as U,y as q,a1 as Y,l as Z,x as T,bd as A,r as n,bc as W,E as w,F as x,G as c,H as s,K as p,a2 as D,O as S,N as v,Q as I,P as a,I as X,J as ee,R as oe,Y as te,Z as se}from"./vendor-D6JO6WHW.js";import{R as ne}from"./RankingShopItem-I5f5es1c.js";import{S as ae}from"./ShopVotePop-VrH7dDlv.js";import{B as le}from"./BackIcon-CPUEW9je.js";import{q as re,b as ce}from"./beiRanking-DOY3XZdF.js";import{aS as ie}from"./index-CbIwihlz.js";import"./Lottie_v2-BS7gF7u9.js";import"./member-CkdtKF8y.js";import"./SkewCard-CreFztFl.js";import"./shop-CeqcS6K2.js";import"./beiExtRewardContract-B5hYiata.js";import"./beiConstContract-9GKmIGuG.js";const de=d=>(te("data-v-a3e15d46"),d=d(),se(),d),ue={style:{"background-color":"white"},class:"relative z-50 h-full min-h-screen overflow-y-hidden parent-view mall-header-bg"},he={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},pe={class:"flex relative justify-center items-center h-[44px] px-2.5"},ve={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},me={class:"font-semibold"},fe={class:"px-2.5"},ke={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},_e=de(()=>s("div",{class:"h-[16px]"},null,-1)),ge={class:"bg-white rounded-t-2xl"},ye=q({name:"SearchBeiRanking"});function we(d){const b=Y(),N=Z(),R=T(()=>{var e;return((e=b.query)==null?void 0:e.month)||1e4}),i=A({keyword:""}),V=n(null),E=T(()=>{var e;return+ie()==+((e=b.query)==null?void 0:e.month)}),F=e=>{e.code==="Enter"&&($(),V.value.blur())},K=()=>{$()},L=async()=>{m.value=!0,h.value+=1,await J(),m.value=!1},$=()=>{h.value=0,u.value=!1,l.value=[],L()},m=n(!1),u=n(!1),h=n(0),M=n(10),f=n(0),l=n([]),j=e=>{N.push(e)},k=n({shopId:null}),[z,B]=W(!1),G=e=>{k.value=e,B(!0)},H=e=>{j(`/talentRanking/rankingShop?shopId=${e.shopId}`)},J=async()=>{const{success:e,data:o}=await ce({page:h.value,size:M.value,month:R.value,shopNameLike:i.keyword});if(!e||!o||!(o!=null&&o.total)){f.value=(o==null?void 0:o.total)||0,u.value=!0;return}f.value=o.total;const r=o==null?void 0:o.records;l.value=h.value===1?r:l.value.concat(r),l.value&&l.value.length>=f.value&&(u.value=!0)},O=async(e,o)=>{e!=null&&e.shopId&&(o.direct===200?e.score+=o==null?void 0:o.differ:e.score-=o==null?void 0:o.differ,setTimeout(async()=>{const{success:r,data:_}=await re({shopId:e==null?void 0:e.shopId,month:R.value});r&&(e=_)},5e3))};return(e,o)=>{var P;const r=w("van-icon"),_=w("van-field"),Q=w("VanList");return c(),x("div",ue,[s("section",he,[s("section",pe,[s("div",ve,[S(le,null,{default:v(()=>[s("span",null,I(e.$t("common.return")),1)]),_:1})]),s("div",me,I(e.$t("common.search")),1)]),s("section",fe,[S(_,{ref:(t,g)=>{g.searchRef=t,V.value=t},"model-value":a(i).keyword,"onUpdate:model-value":o[0]||(o[0]=t=>a(i).keyword=t),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:F,placeholder:e.$t("mall.Enter search keywords"),enterkeyhint:"search"},{"left-icon":v(()=>[a(i).keyword?D("",!0):(c(),p(r,{key:0,name:"search",size:"18"}))]),"right-icon":v(()=>[s("div",{onClick:K},[a(i).keyword?(c(),p(r,{key:1,name:"search",size:"18"})):(c(),x("div",ke,I(e.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),_e]),s("div",ge,[S(Q,{loading:m.value,finished:u.value,onLoad:L,"finished-text":e.$t("common.noMore"),class:"min-h-[40vh] pt-2 pb-0.5 bg-white rounded-t-2xl relative shadow-box z-10"},{default:v(()=>[(c(!0),x(X,null,ee(l.value,(t,g)=>{var C;return c(),p(ne,{key:t.id,rankItem:t,showPower:a(E),onVoteShop:y=>G(t),onToDetail:y=>H(t),onVoteSuccess:o[1]||(o[1]=y=>O(k.value,y)),class:oe(["relative",{"active-bottom":g+1!==((C=l.value)==null?void 0:C.length)}])},null,8,["rankItem","showPower","onVoteShop","onToDetail","class"])}),128))]),_:1},8,["loading","finished","finished-text"])]),a(z)?(c(),p(ae,{key:0,show:a(z),shopId:(P=k.value)==null?void 0:P.shopId,onClose:o[2]||(o[2]=t=>a(B)(!1))},null,8,["show","shopId"])):D("",!0)])}}const xe=q({...ye,setup:we}),De=U(xe,[["__scopeId","data-v-a3e15d46"]]);export{De as default};
