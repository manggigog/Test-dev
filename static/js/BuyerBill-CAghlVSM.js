import{_ as Pe,z as Ve,x as Ee,bl as De,a2 as te,j as I,y as de,r as m,F as T,G as y,H as c,P as f,Z as M,U as he,$ as h,J as L,K as A,O as n,I as o,Q as p,N as S,a3 as Te,a0 as ne,o as Be,E as je,q as Ue,X as Ae,Y as Ke}from"./vendor-Dr_RpJ_Y.js";import{_ as Fe}from"./filter-MXpgl_BE.js";import{_ as ze,o as He,a as qe}from"./BillItemOnline-D-TNoODb.js";import{b as We,a as Ge}from"./bill-WdqwAY2M.js";import{V as Oe,aA as D,u as Je}from"./index-CU2nzZe6.js";import{a as ve,B as Qe,P as ee,O as ye}from"./bill-DDCezy34.js";import{C as Xe}from"./CommonVanProvider-KZuKVOde.js";import{B as Ze}from"./BetweenTab-nGcUWfRT.js";import"./copy-w-Dr8nkqKW.js";import"./MCOIN-BOqZVkND.js";import"./link-CItP-_Ep.js";import"./useOrderStatus-CfUN23nj.js";import"./BackIcon-CDrGaEPo.js";/* empty css                                                               */const et={class:"flex flex-col justify-between"},tt={class:"font-semibold text-base text-center px-4 pt-[18px] pb-4"},nt={class:"overflow-y-auto flex-1 px-4 pb-4"},ot={class:"text-sm font-semibold"},lt={class:"flex items-center gap-2 mt-3 overflow-x-auto"},st=["onClick"],at={class:"mt-3 flex-start"},it={class:"mx-2"},rt={class:"mt-4"},dt={class:"text-sm font-semibold"},ut={class:"flex items-center justify-start gap-3 mt-3 flex-wrap"},ct=["onClick"],mt={class:"flex-center-bw flex justify-between gap-3 bg-white px-3 py-4"},pt={class:"text-base font-normal"},ft={class:"text-base font-semibold"},vt=Ve({props:{storeId:null},setup(K,{expose:we}){const ue=K,{t:P}=Ee(),{getUserDhKey:be,decryptKey:k}=Oe(),u=De({list:[],page:0,size:20,loading:!1,finished:!1}),[F,w]=te(!1),V=I().format("YYYY-MM-DD"),_=I().subtract("days",7).format("YYYY-MM-DD"),C=I().subtract("month",1).format("YYYY-MM-DD"),oe=I().subtract("month",3).format("YYYY-MM-DD"),ce=de(()=>[{id:1,label:P("shop.Last 7 days")},{id:2,label:P("shop.last month")},{id:3,label:P("shop.last 3 months")}]),[le,E]=te(!1),[z,O]=te(!1),v=m(new Date),R=m(new Date),_e=m(new Date(new Date("2020/1/1").getTime())),N=m(new Date(new Date("2020/1/1").getTime())),H=de(()=>[{key:ve.OWNER,label:P("payhelp.online_owner_pay")},{key:ve.OTHERPAY,label:P("payhelp.online_other_pay")},{key:ve.PAYOTHER,label:P("payhelp.online_help_other")}]),s=De({startTime:null,endTime:null,type:null}),me=i=>{s.type=s.type===i?null:i},se=()=>{s.startTime=null,s.endTime=null,s.type=null,x.value=null,v.value=null,R.value=null,W()},q=()=>{E(!1),O(!1),(!s.startTime||!s.endTime)&&(s.endTime=null,s.startTime=null)},ae=i=>{v.value=new Date(D(i)),N.value=new Date(new Date(i).getTime()),s.startTime=D(v.value.toString()),x.value=null,E(!1),O(!0)},ge=i=>{R.value=new Date(D(i)),s.startTime=D(v.value.toString()),s.endTime=D(i),x.value=null,O(!1)},x=m(null),ie=i=>{if(x.value!==i){switch(R.value=new Date(V),s.endTime=V,i){case 1:s.startTime=_,v.value=new Date(_),N.value=new Date(new Date(_).getTime()+60*1e3);break;case 2:s.startTime=C,v.value=new Date(C),N.value=new Date(new Date(C).getTime()+60*1e3);break;case 3:s.startTime=oe,v.value=new Date(oe),N.value=new Date(new Date(oe).getTime()+60*1e3);break}x.value=i}},W=()=>{G(),w(!1)},G=()=>{u.list=[],u.page=0,u.finished=!1,b()},b=async()=>{u.loading||(u.loading=!0,u.page+=1,await B(),u.loading=!1)},B=async()=>{var J;const{success:i,data:a,total:j}=await We({page:u.page,size:u.size,startTime:s.startTime?s.startTime+" 00:00:00":void 0,endTime:s.endTime?s.endTime+" 23:59:59":void 0,type:s.type?s.type:void 0});if(!i||!a||!j||+j<=0){u.finished=!0;return}for(let t=0;t<a.length;t++){const g=a[t];if(g.remark&&g.type!==ve.PAYOTHER&&ue.storeId&&g.submitMerchantPubKey){const Q=await be(ue.storeId,g.submitMerchantPubKey);if(Q){const{decrypt:U}=k(g.remark,Q);U&&(g.remark=U)}}}u.list=u.page===1?a:u.list.concat(a),+j<=+((J=u.list)==null?void 0:J.length)&&(u.finished=!0)};return we({setPopShow:w}),(i,a)=>{const j=T("Empty"),J=T("VanList"),t=T("van-datetime-picker"),g=T("van-popup"),Q=T("van-icon"),U=T("VanButton"),pe=T("VanPopup");return c(),y(L,null,[f(J,{loading:n(u).loading,finished:n(u).finished,"finished-text":"","loading-text":i.$t("common.loading"),onLoad:b},{default:h(()=>{var r;return[(c(!0),y(L,null,A(n(u).list,X=>(c(),M(ze,{key:X.id,bill:X,type:n(Qe).PAYMENT},null,8,["bill","type"]))),128)),!n(u).loading&&n(u).finished&&((r=n(u).list)==null?void 0:r.length)<=0?(c(),M(j,{key:0,name:i.$t("common.noMore")},null,8,["name"])):he("",!0)]}),_:1},8,["loading","finished","loading-text"]),n(F)?(c(),M(pe,{key:0,show:n(F),"onUpdate:show":a[6]||(a[6]=r=>ne(F)?F.value=r:null),round:"",position:"bottom",closeable:"",class:"sm:w-[375px]",style:{"max-height":"75vh","min-width":"280px",left:"50%",transform:"translate3d(-50%, 0, 0)"},"close-on-click-overlay":"",onClickOverlay:a[7]||(a[7]=r=>n(w)(!1)),onClickCloseIcon:a[8]||(a[8]=r=>n(w)(!1))},{default:h(()=>[o("div",et,[o("div",tt,p(i.$t("common.filter")),1),o("div",nt,[o("div",ot,p(i.$t("common.time")),1),o("div",lt,[(c(!0),y(L,null,A(n(ce),r=>(c(),y("div",{class:S(["type-cell flex-1",{"cell-active":x.value==r.id}]),key:r.id,onClick:X=>ie(r.id)},p(r.label),11,st))),128))]),o("div",at,[o("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:a[0]||(a[0]=Te(r=>n(E)(!0),["stop"]))},[o("div",{class:S({"opacity-30":!n(s).startTime})},p(n(s).startTime||i.$t("goods.selectStartTime")),3)]),f(g,{show:n(le),"onUpdate:show":a[2]||(a[2]=r=>ne(le)?le.value=r:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:h(()=>[f(t,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=r=>v.value=r),"min-date":_e.value,type:"date",title:i.$t("goods.selectStartTime"),onCancel:q,onConfirm:ae},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),o("div",it,[f(Q,{name:"minus"})]),o("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:a[3]||(a[3]=Te(r=>n(O)(!0),["stop"]))},[o("div",{class:S({"opacity-30":!n(s).endTime})},p(n(s).endTime||i.$t("goods.selectEndTime")),3)]),f(g,{show:n(z),"onUpdate:show":a[5]||(a[5]=r=>ne(z)?z.value=r:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:h(()=>[f(t,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=r=>R.value=r),onConfirm:ge,"min-date":N.value,onCancel:q,type:"date",title:i.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),o("div",rt,[o("div",dt,p(i.$t("bill.pay type")),1),o("div",ut,[(c(!0),y(L,null,A(n(H),r=>(c(),y("div",{class:S(["type-cell min-w-min whitespace-nowrap border-none px-2.5",{"cell-active":r.key===n(s).type}]),key:r.key,onClick:X=>me(r.key)},p(r.label),11,ct))),128))])])]),o("div",mt,[f(U,{round:"",class:"!border !border-solid !border-b4 text-b1 flex-1 h-[46px]",onClick:se},{default:h(()=>[o("span",pt,p(i.$t("common.reset")),1)]),_:1}),f(U,{round:"",class:"btn-yellow flex-1 h-[46px] border-0",onClick:W},{default:h(()=>[o("span",ft,p(i.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"])):he("",!0)],64)}}}),yt=Pe(vt,[["__scopeId","data-v-02d42f74"]]),ht=K=>(Ae("data-v-2051004a"),K=K(),Ke(),K),Tt=ht(()=>o("img",{src:Fe,class:"w-5 h-5"},null,-1)),wt=[Tt],bt={class:"px-3 text-sm h-[calc(100vh-95px)] overflow-y-auto mt-3"},_t={key:1},gt={class:"flex flex-col justify-between"},kt={class:"font-semibold text-base text-center px-4 pt-[18px] pb-4"},xt={class:"overflow-y-auto flex-1 px-4 pb-4"},Dt={class:"text-sm font-semibold"},Ct={class:"flex items-center gap-2 mt-3 overflow-x-auto"},$t=["onClick"],Yt={class:"mt-3 flex-start"},St={class:"mx-2"},Pt={class:"mt-4"},Vt={class:"text-sm font-semibold"},Et={class:"flex items-center justify-start gap-3 mt-3 flex-wrap"},Ot=["onClick"],Mt={class:"mt-4"},It={class:"text-sm font-semibold"},Lt={class:"flex items-center justify-start gap-3 mt-3 flex-wrap"},Rt=["onClick"],Nt={class:"flex-center-bw flex justify-between gap-3 bg-white px-3 py-4"},Bt={class:"text-base font-normal"},jt={class:"text-base font-semibold"},Ut=Ve({setup(K){var $e;const{getUserDhKey:we,decryptKey:ue}=Oe(),{getCurrentAccount:P,getCurrentStoreId:be}=Je(),{t:k}=Ee(),u=Be(),F=Ue(),w=m([]),V=m(!1),_=m(!1),C=m(0),oe=m(20),ce=m(0),le=1,E=m(null),z=m(!0),O=m(null),v=m(Number((($e=u.query)==null?void 0:$e.payChannel)||ee.ONLINE)),R=[{label:k("shop.on-line"),value:ee.ONLINE},{label:k("shop.off-line"),value:ee.OFFLINE}],_e=e=>{v.value=e,C.value=0,w.value=[],F.replace({query:{payChannel:e}}),v.value===ee.OFFLINE&&(_.value=!1,ke())},N=()=>{var e;v.value===ee.ONLINE?O.value&&((e=O.value)==null||e.setPopShow(!0)):s(!0)},[H,s]=te(!1),me=I().format("YYYY-MM-DD"),se=I().subtract("days",7).format("YYYY-MM-DD"),q=I().subtract("month",1).format("YYYY-MM-DD"),ae=I().subtract("month",3).format("YYYY-MM-DD"),ge=de(()=>[{id:1,label:k("shop.Last 7 days")},{id:2,label:k("shop.last month")},{id:3,label:k("shop.last 3 months")}]),[x,ie]=te(!1),[W,G]=te(!1),b=m(new Date),B=m(new Date),i=m(new Date(new Date("2020/1/1").getTime())),a=m(new Date(new Date("2020/1/1").getTime())),j=de(()=>[{key:ye.OWNER,label:k("payhelp.offline_owner_pay")},{key:ye.OTHERPAY,label:k("payhelp.offline_other_pay")},{key:ye.PAYOTHER,label:k("payhelp.offline_help_other")}]),J=de(()=>He()),t=De({startTime:null,endTime:null,type:null,orderTypes:[]}),g=e=>{t.type=t.type===e?null:e},Q=e=>{if(e===""){t.orderTypes=[];return}const d=t.orderTypes.findIndex($=>$===+e);d>-1?t.orderTypes.splice(d,1):t.orderTypes.push(+e)},U=()=>{t.startTime=null,t.endTime=null,t.type=null,t.orderTypes=[],Z.value=null,b.value=null,B.value=null,Ce()},pe=()=>{ie(!1),G(!1),(!t.startTime||!t.endTime)&&(t.endTime=null,t.startTime=null)},r=e=>{b.value=new Date(D(e)),a.value=new Date(new Date(e).getTime()),t.startTime=D(b.value.toString()),Z.value=null,ie(!1),G(!0)},X=e=>{B.value=new Date(D(e)),t.startTime=D(b.value.toString()),t.endTime=D(e),Z.value=null,G(!1)},Z=m(null),Me=e=>{if(Z.value!==e){switch(B.value=new Date(me),t.endTime=me,e){case 1:t.startTime=se,b.value=new Date(se),a.value=new Date(new Date(se).getTime()+60*1e3);break;case 2:t.startTime=q,b.value=new Date(q),a.value=new Date(new Date(q).getTime()+60*1e3);break;case 3:t.startTime=ae,b.value=new Date(ae),a.value=new Date(new Date(ae).getTime()+60*1e3);break}Z.value=e}},Ce=()=>{Ie(),s(!1)},Ie=()=>{w.value=[],C.value=0,_.value=!1,ke()},ke=async()=>{V.value||(V.value=!0,C.value+=1,await Le(),V.value=!1)},xe=m([]),Le=async()=>{const e=await Ge({page:C.value,size:oe.value,orderPayAddress:P(),startTime:t.startTime?t.startTime+" 00:00:00":void 0,endTime:t.endTime?t.endTime+" 23:59:59":void 0,orderPayType:t.type,orderTypes:t.orderTypes});if(!e.success){_.value=!0;return}if(!e.data||!e.data.total){_.value=!0;return}ce.value=e.data.total;for(let d=0;d<e.data.records.length;d++){const $=e.data.records[d];if(E.value&&$.orderSubmitShopPubKey&&$.orderPayType!==ye.PAYOTHER){const fe=await we(E.value,$.orderSubmitShopPubKey);if(fe){const{decrypt:re}=ue($.orderRemark,fe);re&&($.orderRemark=re)}}}xe.value=e.data.records,w.value=C.value===1?xe.value:w.value.concat(xe.value),w.value.length>=ce.value&&(_.value=!0)};return je(async()=>{z.value=!0,E.value=await be(),z.value=!1}),(e,d)=>{const $=T("Empty"),fe=T("VanList"),re=T("van-datetime-picker"),Ye=T("van-popup"),Re=T("van-icon"),Se=T("VanButton"),Ne=T("VanPopup");return c(),M(Xe,{title:e.$t("user.payRecord"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{}},{right:h(()=>[o("div",{class:"flex-shrink-0 w-5 ml-3",onClick:N},wt)]),default:h(()=>[f(Ze,{options:R,"label-key":"label","value-key":"value",modelValue:v.value,"onUpdate:modelValue":d[0]||(d[0]=l=>v.value=l),onChange:_e},null,8,["modelValue"]),o("div",bt,[v.value===n(ee).ONLINE?(c(),M(yt,{key:0,"store-id":E.value,ref:(l,Y)=>{Y.onlineRef=l,O.value=l}},null,8,["store-id"])):(c(),y("div",_t,[f(fe,{loading:V.value,finished:_.value,"finished-text":"","loading-text":e.$t("common.loading"),onLoad:ke},{default:h(()=>{var l;return[(c(!0),y(L,null,A(w.value,Y=>(c(),M(qe,{key:Y.id,type:le,bill:Y},null,8,["bill"]))),128)),!V.value&&_.value&&((l=w.value)==null?void 0:l.length)<=0?(c(),M($,{key:0,name:e.$t("common.noMore")},null,8,["name"])):he("",!0)]}),_:1},8,["loading","finished","loading-text"]),n(H)?(c(),M(Ne,{key:0,show:n(H),"onUpdate:show":d[7]||(d[7]=l=>ne(H)?H.value=l:null),round:"",position:"bottom",closeable:"",class:"sm:w-[375px]",style:{"max-height":"75vh","min-width":"280px",left:"50%",transform:"translate3d(-50%, 0, 0)"},"close-on-click-overlay":"",onClickOverlay:d[8]||(d[8]=l=>n(s)(!1)),onClickCloseIcon:d[9]||(d[9]=l=>n(s)(!1))},{default:h(()=>[o("div",gt,[o("div",kt,p(e.$t("common.filter")),1),o("div",xt,[o("div",Dt,p(e.$t("common.time")),1),o("div",Ct,[(c(!0),y(L,null,A(n(ge),l=>(c(),y("div",{class:S(["type-cell flex-1",{"cell-active":Z.value==l.id}]),key:l.id,onClick:Y=>Me(l.id)},p(l.label),11,$t))),128))]),o("div",Yt,[o("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:d[1]||(d[1]=Te(l=>n(ie)(!0),["stop"]))},[o("div",{class:S({"opacity-30":!n(t).startTime})},p(n(t).startTime||e.$t("goods.selectStartTime")),3)]),f(Ye,{show:n(x),"onUpdate:show":d[3]||(d[3]=l=>ne(x)?x.value=l:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:h(()=>[f(re,{modelValue:b.value,"onUpdate:modelValue":d[2]||(d[2]=l=>b.value=l),"min-date":i.value,type:"date",title:e.$t("goods.selectStartTime"),onCancel:pe,onConfirm:r},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),o("div",St,[f(Re,{name:"minus"})]),o("div",{class:"van-cell p-0 flex justify-center type-cell",onClick:d[4]||(d[4]=Te(l=>n(G)(!0),["stop"]))},[o("div",{class:S({"opacity-30":!n(t).endTime})},p(n(t).endTime||e.$t("goods.selectEndTime")),3)]),f(Ye,{show:n(W),"onUpdate:show":d[6]||(d[6]=l=>ne(W)?W.value=l:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:h(()=>[f(re,{modelValue:B.value,"onUpdate:modelValue":d[5]||(d[5]=l=>B.value=l),onConfirm:X,"min-date":a.value,onCancel:pe,type:"date",title:e.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),o("div",Pt,[o("div",Vt,p(e.$t("common.orderType")),1),o("div",Et,[(c(!0),y(L,null,A(n(J),l=>(c(),y("div",{class:S(["type-cell min-w-min whitespace-nowrap border-none px-2.5",{"cell-active":l.key===""&&!n(t).orderTypes.length||l.key!==""&&n(t).orderTypes.findIndex(Y=>Y==l.key)>-1}]),key:l.key,onClick:Y=>Q(l.key)},p(l.label),11,Ot))),128))])]),o("div",Mt,[o("div",It,p(e.$t("bill.pay type")),1),o("div",Lt,[(c(!0),y(L,null,A(n(j),l=>(c(),y("div",{class:S(["type-cell min-w-min whitespace-nowrap border-none px-2.5",{"cell-active":l.key===n(t).type}]),key:l.key,onClick:Y=>g(l.key)},p(l.label),11,Rt))),128))])])]),o("div",Nt,[f(Se,{round:"",class:"!border !border-solid !border-b4 text-b1 flex-1 h-[46px]",onClick:U},{default:h(()=>[o("span",Bt,p(e.$t("common.reset")),1)]),_:1}),f(Se,{round:"",class:"btn-yellow flex-1 h-[46px] border-0",onClick:Ce},{default:h(()=>[o("span",jt,p(e.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"])):he("",!0)]))])]),_:1},8,["title"])}}}),nn=Pe(Ut,[["__scopeId","data-v-2051004a"]]);export{nn as default};
