import{_ as D,z as E,r as c,E as V,F as T,G as O,H as l,I as d,P as I,a4 as u,Q as r,$ as S,X as z,Y as Q,a2 as X,y as x,B as N,Z as _,O as n,U as R}from"./vendor-Dr_RpJ_Y.js";import{l as M}from"./luckyShopContract-DfZqYfy3.js";import{O as q}from"./OrderGoodsBox-5PjaZvBT.js";import{_ as J}from"./OrderPopBorder-DFisj2bb.js";import{b as K,e as W,g as ee,c as te}from"./index-7OiUoGXy.js";import{_ as se}from"./ApproveButton-BB8qyFWg.js";const oe=""+new URL("../images/success-DvZwai7Y.png",import.meta.url).href,ae=o=>(z("data-v-3c4bb187"),o=o(),Q(),o),ne={class:"pt-6 pb-10"},ce={class:"text-base text-[#2E2008]"},le={class:"mr-1 font-semibold"},re=ae(()=>d("img",{src:oe,class:"w-[178px] h-[144px] object-cover my-10 mx-auto"},null,-1)),ie=E({props:{id:null},emits:["close"],setup(o,{emit:m}){const{id:t}=o,{commodities:h}=M(),p=c(0),g=async()=>{const a=await h(t);p.value=a.endTime*1e3-new Date().getTime()};return V(()=>{g()}),(a,f)=>{const i=T("van-count-down"),v=T("VanButton");return l(),O("div",ne,[d("div",ce,[d("span",le,[I(i,{millisecond:"",time:p.value,format:"HH:mm:ss:SS"},null,8,["time"])]),u(r(a.$t("order.no group tips")),1)]),re,I(v,{class:"btn-detail w-[200px] h-[40px] rounded-3xl text-[#FB1A18] font-semibold",onClick:f[0]||(f[0]=()=>{m("close")})},{default:S(()=>[u(r(a.$t("common.return")),1)]),_:1})])}}}),ue=D(ie,[["__scopeId","data-v-3c4bb187"]]),de={key:0},me={class:"pt-4 text-left"},pe={class:"text-[#FB1A18] text-lg"},fe=E({props:{show:{type:Boolean,default:!1},goods:null,remaining:null,limitEach:null},emits:["close","success"],setup(o,{emit:m}){const t=o,{checkLoginAuth:h}=K(),{payToken:p,buy:g,commodities:a}=M(),{tradeContributeSelfRate:f}=te(),i=c(!1),[v,k]=X(!1),w=c(null),s=c(1),B=c(0),$=x(()=>{var e;return+N((e=t.goods)==null?void 0:e.price).times(s.value)}),F=x(()=>W(C.value/100*$.value*B.value)),b=x(()=>Math.min(+t.remaining,+t.limitEach)),H=e=>{if(e<1)s.value=1;else{if(+b.value<+e){s.value=+b.value;return}s.value=+e}},C=c(null),P=async()=>{var y;const e=await a((y=t.goods)==null?void 0:y.id);C.value=+N(+e.discountRate).div(1e4).toNumber()||20},G=async()=>{B.value=await f()},A=()=>{k(!1),s.value=1,m("close")},L=async()=>{G(),P(),await j(),await U()},U=async()=>{},Y=async()=>{if(!h(!0))return;i.value=!0;const e=await g(t.goods.id,s.value);i.value=!1,e.success&&Z()},Z=()=>{m("success",s.value),k(!0)},j=async()=>{w.value=await p()};return V(()=>{L()}),(e,y)=>(l(),_(J,{show:t.show,onClose:A,title:n(v)?e.$t("order.purchase success"):e.$t("order.submitOrder")},{default:S(()=>[n(v)?(l(),_(ue,{key:1,id:t.goods.id,onClose:A},null,8,["id"])):(l(),O("div",de,[t.goods?(l(),_(q,{key:0,isDisabledEdit:!0,orderInfo:t.goods,number:s.value,"max-number":+n(b),onChangeNumber:H,needMask:!1},null,8,["orderInfo","number","max-number"])):R("",!0),d("div",me,[u(r(e.$t("order.group intergral")),1),d("span",pe,r(n(F)),1),u(" "+r(e.$t("common.credit")),1)]),w.value?(l(),_(se,{key:1,contract:n(ee).luckyShop,token:w.value,approveAmount:n($),loading:i.value,fallBack:Y,class:"text-sm my-8 h-[40px] min-w-[150px] rounded-3xl text-white btn-pink"},{default:S(()=>[u(r(e.$t("flashSale.buyNow")),1)]),_:1},8,["contract","token","approveAmount","loading"])):R("",!0)]))]),_:1},8,["show","title"]))}}),ye=D(fe,[["__scopeId","data-v-2528318e"]]);export{ye as S};
