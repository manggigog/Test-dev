import{_ as W,y as O,l as R,x as X,E as w,F as r,G as n,H as s,O as b,P as a,Q as g,a2 as k,K as v,a4 as j,Y as ee,Z as te,a1 as oe,w as se,be as P,bf as le,r as F,z as ae,D as ne,bh as ie,N as x,J as ce,I as de,a0 as ue,T as re}from"./vendor-BUT0HZ5j.js";import{_ as fe}from"./MCOIN-BcbOHmhy.js";import{_ as me}from"./store-CPx32ymB.js";import{_ as ge}from"./shop-arrow-right-Br6r0Qcd.js";import{R as pe}from"./RatioBox-CG9RFZMG.js";import{_ as he}from"./ImgBoutiqueLable-BF5Xoxsv.js";import{d as ve,e as _e,as as ye,V as xe,r as be,bw as ke,bx as Ce}from"./index-BvL8wS8a.js";import{C as we}from"./CommonVanProvider-BpsZUrD3.js";import{_ as $e}from"./EmptyTipsPop-_FH8A6A8.js";import{B as Ie}from"./BetweenTab-Bn5ZVRk8.js";import{c as Se,e as Te}from"./goods-Dg5QKtLi.js";import"./shop-CeqcS6K2.js";import"./BackIcon-biFt6cm7.js";/* empty css                                                               */const A=l=>(ee("data-v-2a7764a8"),l=l(),te(),l),Fe=["data-store-name"],Le={class:"shrink-0 offline-goods-img__wrap w-[80px] h-[80px] overflow-hidden relative"},Ve={class:"offline-goods-info__wrap ml-2 flex-1 flex flex-col justify-between min-h-[80px]",style:{width:"calc(100% - 80px - 8px)"}},Be={class:"w-full flex flex-col items-start"},Ne={class:"w-full"},Ee={class:"font-semibold text-sm line-clamp-1 text-b1"},Oe={class:"flex items-center justify-start font-Puhui mt-1"},Ae={class:"flex items-center"},De=A(()=>s("img",{src:fe,class:"w-4 h-4 mr-1"},null,-1)),Pe={class:"text-b1 font-semibold text-sm"},Re={key:0,class:"mx-2"},je={class:"text-b3 text-sm font-normal"},ze={class:"w-full"},Ge=A(()=>s("img",{src:me,class:"w-4 h-4 line-clamp-1"},null,-1)),qe={key:0,class:"line-clamp-1"},Me={key:1},Ue=A(()=>s("img",{src:ge,class:"w-4 h-4"},null,-1)),He=O({props:{goods:{type:Object,default:()=>({})},isOffline:{type:Boolean,default:!1}},emits:["select"],setup(l,{emit:L}){const d=l;R();const V=X(()=>{var f,C;return(d.isOffline||!1?(f=d.goods.goodsIcons)==null?void 0:f.split(","):((C=d.goods.icons)==null?void 0:C.split(","))||[""])[0]}),$=_=>{L("select",_)};return(_,u)=>{const f=w("VanImage");return n(),r("section",{class:"flex items-start","data-store-name":l.goods.shopName},[s("div",Le,[b(f,{src:a(V),class:"offline-goods-img w-[80px] h-[80px] rounded-lg overflow-hidden",alt:"商品主图",fit:"cover"},null,8,["src"]),b(he,{type:l.isOffline?+l.goods.goodsType:+l.goods.type},null,8,["type"])]),s("div",Ve,[s("div",null,[s("div",Be,[s("div",Ne,[s("div",Ee,g(l.goods.goodsName||""),1)])]),s("div",Oe,[s("div",Ae,[De,s("div",Pe,g(a(ve)(l.goods.price||l.goods.goodsPrice)),1)]),l.goods.changedAmount?(n(),r("div",Re,[s("p",je,[s("span",null,"收藏后"+g(+l.goods.changedAmount>0?"涨":"降")+g(Math.abs(l.goods.changedAmount)),1)])])):k("",!0),l.goods.discountRatio||l.goods.goodsDiscountRatio?(n(),v(pe,{key:1,class:"ratio-box ml-1 !px-1",tag:_.$t("common.rebate"),ratio:l.goods.discountRatio||l.goods.goodsDiscountRatio},null,8,["tag","ratio"])):k("",!0)])]),s("div",ze,[s("div",{class:"font-normal text-b3 text-sm flex items-center justify-start",onClick:u[0]||(u[0]=j(C=>$(l.goods.shopId),["stop"]))},[Ge,l.isOffline?(n(),r("span",qe,g(l.goods.shopName||"--"),1)):(n(),r("span",Me,g(l.goods.storeName||"--"),1)),Ue])])])],8,Fe)}}}),Je=W(He,[["__scopeId","data-v-2a7764a8"]]),Ke={class:"flex items-center justify-start gap-1"},Qe=["src"],Ye=s("span",{class:"text-b2 text-sm font-normal"},"取消",-1),Ze=[Ye],We=s("span",{class:"text-b2 text-sm font-normal"},"编辑",-1),Xe=[We],et={class:"scrollPage p-3 h-[calc(100vh-83px)] overflow-y-auto"},tt={class:"flex items-center justify-start"},ot={key:0,class:"flex-shrink-0 mr-3"},st={class:"w-full"},lt={class:"bg-white rounded-xl p-2.5 mb-2.5"},at={key:0,class:"fixed bottom-0 left-0 right-0 bg-[#F5F5F5] p-3 flex items-center justify-between"},nt={class:"flex-shrink-0 flex items-center justify-start gap-2 mr-3"},it=s("span",{class:"text-b3 text-sm font-normal"},"全选",-1),ct={key:0},dt=O({name:"GoodsCollect"});function ut(l){const{regionStore:L}=_e(),d=R(),V=oe(),{t:$}=se(),{loadingToggle:_}=be(),[u,f]=P(!1),[C,B]=P(!1),z=[{label:$("shop.on-line"),value:1},{label:$("shop.off-line"),value:2}],G=t=>{c.value=[],p.value=[],m.value=!1,f(!1),e.type=t||1,d.replace({query:{type:t}}),N()},e=le({type:Number(V.query.type)||1,page:0,size:10,loading:!1,finished:!1,flattenedList:[],total:0}),c=F([]),p=F([]),m=F(!1),q=(t,o)=>{e.type===1?u.value?p.value[o].toggle():d.push(`/goodsDetail?id=${t.goodsId}&activated=1`):u.value?p.value[o].toggle():d.push(`/offlineGoodsDetail?goodsId=${t.goodsId}&activated=1`)},M=(t,o)=>{u.value?p.value[o].toggle():d.push(`/category?deliveryType=1&shopId=${t}&activated=1`)},U=()=>{m.value?c.value=e.flattenedList.map(o=>e.type===2?o.collectId:o.goodsId):c.value=[]};ae(c,t=>{t.length&&t.length>=e.flattenedList.length?m.value=!0:m.value=!1});const H=async()=>{if(c.value.length===0){re("请选择要删除的商品");return}_(!0);let t=null;e.type===1?t=await Se({goodsIds:c.value,type:2}):t=await ke({ids:c.value}),_(!1),t.success&&(B(!0),N(),c.value=[],p.value=[],m.value=!1),setTimeout(()=>{B(!1)},3e3)},D=async()=>{e.loading=!0,e.page+=1,await J(),e.loading=!1},J=async()=>{let t=null;if(e.type===1)t=await Te({page:e.page,size:e.size});else if(e.type===2){const o=await Ce({page:e.page,size:e.size,sortBy:"desc|create_time"});t={success:o.success,data:o.data.records||[],total:o.data.total||0}}if(!t.success){e.finished=!0;return}if(!t.data||!t.total){e.finished=!0;return}e.total=t.total,e.flattenedList=e.page===1?t.data:e.flattenedList.concat(t.data),m.value&&(c.value=e.flattenedList.map(o=>e.type===2?o.collectId:o.goodsId)),e.flattenedList.length>=e.total&&(e.finished=!0)},N=()=>{e.page=0,e.total=0,e.finished=!1,e.flattenedList=[],D()};let I=null;const K=async()=>{const t=localStorage.getItem("goodsCollect_scrollTop");+t?(console.log("setCacheScrollTop",+t),I.scrollTo({top:+t,left:0,behavior:"instant"})):localStorage.removeItem("goodsCollect_scrollTop")},E=F(!1),Q=()=>{E.value||(E.value=!0,setTimeout(()=>{localStorage.setItem("goodsCollect_scrollTop",I.scrollTop+""),E.value=!1},500))};return ne(()=>{I=document.querySelector(".scrollPage"),I.addEventListener("scroll",Q)}),ie(()=>{var t,o,y,S;K(),!(e.finished&&((S=(y=(o=(t=d==null?void 0:d.options)==null?void 0:t.history)==null?void 0:o.state)==null?void 0:y.forward)==null?void 0:S.indexOf("activated=1"))>-1)&&(c.value=[],p.value=[],m.value=!1,f(!1),N())}),(t,o)=>{const y=w("van-checkbox"),S=w("van-checkbox-group"),Y=w("van-list"),Z=w("VanButton");return n(),v(we,{class:"bg-[#F5F5F5] font-Puhui font-normal relative shopGoodsPage",title:"商品收藏","theme-vars":{"field-placeholder-text-color":"#F5F5F5"}},{title:x(()=>[s("div",Ke,[s("div",null,[s("img",{src:a(xe)(`mall/${a(L).country}-flag.svg`),class:"w-4 h-auto"},null,8,Qe)]),s("span",null,g(t.$t("collect.goodsCollect")),1)])]),right:x(()=>[s("div",null,[a(u)===!0?(n(),r("div",{key:0,onClick:o[0]||(o[0]=i=>a(f)(!1))},Ze)):(n(),r("div",{key:1,onClick:o[1]||(o[1]=i=>a(f)(!0))},Xe))])]),default:x(()=>[s("div",null,[b(Ie,{class:"between-tab__wrap",options:z,"label-key":"label","value-key":"value",modelValue:a(e).type,"onUpdate:modelValue":o[2]||(o[2]=i=>a(e).type=i),onChange:G},null,8,["modelValue"]),s("div",et,[a(e).flattenedList.length===0&&!a(e).loading?(n(),v(ye,{key:0,name:t.$t("common.No products")},null,8,["name"])):(n(),v(Y,{key:1,loading:a(e).loading,"onUpdate:loading":o[4]||(o[4]=i=>a(e).loading=i),"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),finished:a(e).finished,onLoad:D,"immediate-check":!0},{default:x(()=>[(n(!0),r(de,null,ce(a(e).flattenedList,(i,T)=>(n(),v(S,{key:i.goodsId||i.collectId,modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=h=>c.value=h),"checked-color":"#FEA021","icon-size":"16"},{default:x(()=>[s("div",tt,[a(u)?(n(),r("div",ot,[a(e).type===2?(n(),v(y,{key:0,name:i.collectId,ref:h=>p.value[T]=h},null,8,["name"])):(n(),v(y,{key:1,name:i.goodsId,ref:h=>p.value[T]=h},null,8,["name"]))])):k("",!0),s("div",st,[s("div",lt,[b(Je,{"is-offline":a(e).type==2,goods:i,showStoreName:!0,onClick:j(h=>q(i,T),["stop"]),onSelect:h=>M(h,T)},null,8,["is-offline","goods","onClick","onSelect"])])])])]),_:2},1032,["modelValue"]))),128))]),_:1},8,["loading","finished-text","loading-text","finished"]))])]),a(u)?(n(),r("div",at,[s("div",nt,[b(y,{modelValue:m.value,"onUpdate:modelValue":o[5]||(o[5]=i=>m.value=i),"checked-color":"#FEA021","icon-size":"16",onClick:U},null,8,["modelValue"]),it]),b(Z,{class:"main-btn flex-center text-white font-semibold rounded-full !bg-[#f44] text-base w-full h-[46px]",onClick:H},{default:x(()=>[ue(g(t.$t("common.delete"))+" ",1),c.value.length>0?(n(),r("span",ct," ("+g(c.value.length)+") ",1)):k("",!0)]),_:1})])):k("",!0),a(C)?(n(),v($e,{key:1,isError:!1,onClose:o[6]||(o[6]=i=>a(B)(!1)),text:"删除成功"})):k("",!0)]),_:1})}}const $t=O({...dt,setup:ut});export{$t as default};
