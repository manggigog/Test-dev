import{z as k,x as j,D,r as s,F as R,Z as b,H as f,$ as z,G as _,U as N,bj as $,bk as B,P as G,I as g,J as O,K as W,T as F,bC as E,q as U,bl as J,Q as K,O as S}from"./vendor-Dr_RpJ_Y.js";import{_ as M,a as Q}from"./GoodsItem-BWjh4rbS.js";import{b as Z}from"./mall-COk3vM6s.js";import{W as X}from"./WaterFull-BoFTr9ol.js";import{ar as Y,w as ee,as as ae,k as q}from"./index-CU2nzZe6.js";import{u as te}from"./useShowActiveInfo-Bt4VVJoh.js";const se={key:0},oe=k({name:"mallGoodsList"});function ne(r,{expose:P,emit:d}){const a=r,{t:h}=j(),C=Y();D(()=>a.viewFormat,e=>{e===1&&console.log(e)},{deep:!0});const o=s([]),v=s(!1),l=s(!1),i=s(0),p=s(10),m=s(0),c=s([]),y=s(0),H=s,x=async()=>{a.isSearchPage&&!a.searchParam.keyword&&!a.searchParam.classId||(v.value=!0,i.value+=1,await V(),setTimeout(()=>{v.value=!1},1e3))},V=async()=>{var t,w,n,T,I;const e=await Z({page:i.value,size:p.value,status:1,...a.searchParam,sortType:a.sortType,deleteFlag:!1});if(!e.success){l.value=!0;return}if(!e.data||!e.total||!((t=e.data)!=null&&t.length)){l.value=!0;return}if(m.value=e.total,c.value=e.data.map(u=>({goods:u.goods,stores:u.stores||H,card:u.card})),i.value===1&&!a.isSearchPage){const u={activeType:1,activePath:"/boutique-goods",activeImg:q("images/activity/advertise/Boutique.png"),activeImgGrid:q("images/activity/advertise/Boutique-grid.png")};y.value+=1,c.value.unshift(u)}if(i.value===2&&((w=a.activeInfo)!=null&&w.id)){const u={activeType:1,activePath:(n=a.activeInfo)==null?void 0:n.url,activeImg:((T=a.activeInfo)==null?void 0:T.activityListImgs)||null,activeImgGrid:((I=a.activeInfo)==null?void 0:I.activityWaterfallImgs)||null,...a.activeInfo};c.value.unshift(u),y.value+=1}o.value=i.value===1?c.value:o.value.concat(c.value),o.value.length-y.value>=m.value&&(l.value=!0)},{loadingToggle:A}=ee(),L=async e=>{if(e.stock===0&&e.goodsTypes!=2){F(h("order.Insufficient stock"));return}A(!0);const t=await ae(e.id);A(!1),t.success&&(d("successAdd"),F(h("cart.addTips")),C.getCartCount())};return P({handleSearch:async()=>{o.value=[],i.value=0,m.value=0,y.value=0,l.value=!1,document.querySelector("#fm-page").scrollTo(0,0),await x()},list:o}),(e,t)=>{const w=R("VanList");return f(),b(w,{loading:v.value,"onUpdate:loading":t[2]||(t[2]=n=>v.value=n),finished:l.value,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:x},{default:z(()=>[o.value.length>0?(f(),_("div",se,[$(G(X,{isSearchPage:r.isSearchPage,value:c.value,addTime:200,cardComponent:M,onHandleTo:t[0]||(t[0]=n=>d("handleTo",n)),onHandleAddCart:L},null,8,["isSearchPage","value"]),[[B,r.viewFormat===0]]),$(g("div",null,[(f(!0),_(O,null,W(o.value,(n,T)=>(f(),b(Q,{key:T,data:n,onClick:()=>d("handleTo",`${r.goodsPath}?id=${n.goods.id}`),onHandleTo:t[1]||(t[1]=I=>d("handleTo",I)),onHandleAddCart:L},null,8,["data","onClick"]))),128))],512),[[B,r.viewFormat===1]])])):N("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}const ie=k({...oe,props:{searchParam:{default:()=>({keyword:"",sortType:1,orderBy:1,classId:null})},sortType:null,goodsPath:{default:"/goodsDetail"},viewFormat:{default:0},isSearchPage:{type:Boolean,default:!1},activeInfo:null},emits:["handleTo","successAdd"],setup:ne}),re={class:"w-full"},le={class:"flex items-center justify-center py-4"},ce=g("div",{class:"w-[4.5rem] h-[1px] bg-gray-200"},null,-1),ue={class:"px-4 text-sm text-gray-500"},de=g("div",{class:"w-[4.5rem] h-[1px] bg-gray-200"},null,-1),we=k({props:{titleText:{default:"为您推荐"}},emits:["successAdd"],setup(r,{emit:P}){const d=r,a=E(ie),h=U(),C=s(0),{showActiveInfo:o,getShowActiveInfo:v}=te(),l=J({keyword:"",sortType:3,orderBy:1,classId:null}),i=p=>{h.push(p)};return v(),(p,m)=>(f(),_("div",re,[g("div",le,[ce,g("div",ue,K(d.titleText),1),de]),G(S(a),{"view-format":C.value,searchParam:S(l),"active-info":S(o),onHandleTo:i,onSuccessAdd:m[0]||(m[0]=c=>P("successAdd"))},null,8,["view-format","searchParam","active-info"])]))}});export{we as _};
