import{_ as N,a2 as m,r as S,y as T,E as U,Z as f,H as l,$ as q,o as j,T as c,q as z,F as I,G as O,U as p,O as s,I as t,Q as V,P as Y,a4 as $,N as G,X as M,Y as Q}from"./vendor-Dr_RpJ_Y.js";import{u as B,ae as L,f as k}from"./index-CU2nzZe6.js";import{a as W}from"./activityContract-BYX-PliU.js";import{_ as X}from"./EmptyTipsPop-DC2OBzZY.js";import{C as Z}from"./CommonVanProvider-D__Wy38-.js";import"./BackIcon-CDrGaEPo.js";const J="/static/images/shield-icon-BIfmVtYR.svg",_=d=>(M("data-v-0d3a485a"),d=d(),Q(),d),K={key:0,class:"relative"},ee={class:"px-3 pt-4 pb-24 font-Puhui"},se=_(()=>t("div",{class:"tips-card rounded-[6px] p-2 mb-3"},[t("p",{class:"text-sm text-[#7D3619] font-normal"}," 此操作涉及资金安全,请核对地址 ")],-1)),te={class:"bg-white rounded-xl px-3 py-4"},oe=_(()=>t("div",{class:"flex items-center justify-center"},[t("img",{src:J,alt:"盾牌",class:"w-[60px] h-[60px]"})],-1)),ae={class:"flex items-center justify-center mt-6"},re={class:"text-base text-[#FF8812] font-bold"},ne=_(()=>t("div",{class:"flex items-center justify-center my-2"},[t("p",{class:"text-sm text-b3 font-normal"},"正在添加")],-1)),ce={class:"mb-2 flex items-center justify-center"},ie={class:"text-base text-[#FF8812] font-bold"},le=_(()=>t("div",{class:"flex items-center justify-center"},[t("p",{class:"text-sm text-b3 font-normal"},"为多重验证地址")],-1)),de={class:"fixed bottom-0 left-0 right-0 p-3 bg-gray1 safe-bottom"},ue=$(" 确认授权 "),me={setup(d){const o=j(),b=z(),{updateSecondConfirmAddr:D}=W(),[r,C]=m(!1),[g,w]=m(!1),[R,v]=m(!1),[h,F]=m(!1),e=S({owner:"",address:"",messageHash:"",signature:"",time:""}),y=T(()=>e.value.owner&&e.value.address&&e.value.messageHash&&e.value.signature),P=async()=>{try{C(!0);const a=o.query.myad?decodeURIComponent(atob(o.query.myad)):"",n=o.query.newad?decodeURIComponent(atob(o.query.newad)):"",i=o.query.h?decodeURIComponent(atob(o.query.h)):"",u=o.query.s?decodeURIComponent(atob(o.query.s)):"",H=o.query.t?decodeURIComponent(atob(o.query.t)):"";if(e.value.owner=a,e.value.address=n,e.value.messageHash=i,e.value.signature=u,e.value.time=H,!a||!n||!i||!u){v(!0);return}const x=B().getCurrentAccount();x||(c.fail("请先连接钱包"),x||await L()),e.value.address.toLowerCase()!=x.toLowerCase()&&(c.fail("不属于你的链接,无法操作"),F(!0)),C(!1)}catch(a){console.error("解析参数失败:",a),v(!0)}},A=()=>{v(!1),b.replace("/home")},E=async()=>{if(!y.value){c.fail("参数不完整");return}const a=B().getCurrentAccount();if(a||(c.fail("请先连接钱包"),a||await L()),console.log("地址对比",e.value.address.toLowerCase(),a.toLowerCase()),e.value.address.toLowerCase()!=a.toLowerCase()){c.fail("不属于你的链接，无法操作");return}try{w(!0),(await D(e.value.messageHash,e.value.signature)).success&&(c.success("授权成功"),setTimeout(()=>{b.replace("/home")},1500))}catch(n){console.error("授权失败:",n)}finally{w(!1)}};return U(async()=>{setTimeout(async()=>{await P()},200)}),(a,n)=>{const i=I("van-loading"),u=I("VanButton");return l(),f(Z,{title:"",class:"font-Puhui font-normal relative bg-gray1 min-h-screen",themeVars:{navBarBackgroundColor:"#ffffff"}},{default:q(()=>[!s(r)&&!s(h)?(l(),O("div",K,[t("div",ee,[se,t("div",te,[oe,t("div",ae,[t("p",re,[s(r)&&!e.value.owner?(l(),f(i,{key:0,size:"14"})):p("",!0),t("span",null,V(e.value.owner?s(k)(e.value.owner,"...",4,4):"--"),1)])]),ne,t("div",ce,[t("p",ie,[s(r)&&!e.value.address?(l(),f(i,{key:0,size:"14"})):p("",!0),t("span",null,V(e.value.address?s(k)(e.value.address,"...",4,4):"--"),1)])]),le])]),t("div",de,[Y(u,{onClick:E,loading:s(g)||s(r),disabled:s(g)||s(r)||!s(y)||s(h),class:G(["bg-btnOrBg w-full h-[46px] flex-center text-b1 text-base font-semibold z-50 rounded-full",{"!bg-[#D9D9D9] !opacity-100":s(g)||s(r)||!s(y)||s(h)}])},{default:q(()=>[ue]),_:1},8,["loading","disabled","class"])])])):p("",!0),s(R)?(l(),f(X,{key:1,onClose:A,text:"错误的链接",isError:!0})):p("",!0)]),_:1})}}},ye=N(me,[["__scopeId","data-v-0d3a485a"]]);export{ye as default};
