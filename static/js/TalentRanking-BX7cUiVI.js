import{_ as O,y as z,r as c,bc as E,D as oe,E as P,F as y,G as i,H as a,O as x,N as L,K as D,P as n,I as se,a4 as M,Q as I,w as Fe,$ as Pe,o as U,Y as he,Z as fe,J as me,R as H,a2 as q,l as Ae,x as ee,bI as De,bp as Le}from"./vendor-CjApaIpB.js";import{N as Me}from"./NoRanking-DGMOKvLl.js";import{R as ge,_ as Ee,a as Ne}from"./RankingShopItem-BYvgONE0.js";import{u as qe,S as Ye,g as de,b as ze,aS as ve,V as je,C as Qe}from"./index-DBW_ANsl.js";import{q as te,a as Ue,b as He}from"./beiRanking-D56Fqs4f.js";import{q as Oe}from"./user-BcdrRX1B.js";import{b as we}from"./beiExtRewardContract--suEYQb8.js";import{_ as Ke}from"./calendar-yellow-CXVdbyCS.js";import{S as Ge}from"./ShopVotePop-COh8Vvkv.js";import{V as Ze}from"./VoteRewardPop-CRpe9ZHX.js";import{C as Je}from"./CommonVanProvider-B8cLU3Mi.js";import{B as We}from"./BackIcon-D2Vm_lyR.js";import"./Lottie_v2-DtzXb0bK.js";import"./member-BMygrgIC.js";import"./SkewCard-BD-urNEn.js";import"./shop-CeqcS6K2.js";import"./beiConstContract-D62m2y14.js";const Xe="/Test-dev/static/images/cat-ip-B1otGVvA.png",et="/Test-dev/static/images/store_title-BHZZnPgm.png",tt="/Test-dev/static/images/search-line-DiUN1tEO.svg",ot=["onClick"],st={class:"box-bg"},nt=["onClick"],at=z({props:{month:null},emits:["toApply","toApplyShop","toQuit"],setup(h,{expose:_,emit:f}){const{voteMonthTimestampView:$}=we(),A=qe().getCurrentAccount(),e=c(null),d=c(null),v=()=>{var g,r;(g=e.value)!=null&&g.id&&((r=e.value)==null?void 0:r.status)===1?f("toApply"):f("toApplyShop")},[k,S]=E(!0),m=async()=>{S(!0);const{success:g,data:r}=await Ye();if(!g||(r==null?void 0:r.status)!==1){if(e.value={...r,status:0,shopAddress:A},!e.value.storeName){const{success:b,data:p}=await Oe();b&&(p!=null&&p.nickName)&&(e.value.storeName=p==null?void 0:p.nickName)}S(!1);return}e.value=r,e.value.shopAddress=r==null?void 0:r.merchant,e.value.shopId=r==null?void 0:r.id,u()},u=async()=>{var p,w,l;if(!((p=e.value)!=null&&p.shopId))return;S(!0);const{result:g}=await $(),{success:r,data:b}=await te({shopId:(w=e.value)==null?void 0:w.shopId,month:+g.thisMonthTime});S(!1),!(!r||!b)&&(d.value=b,((l=d.value)==null?void 0:l.status)!==1&&(d.value.sort=null))};return oe(()=>{m()}),_({getRankingInfo:u}),(g,r)=>{var p;const b=P("VanLoading");return i(),y("div",{class:"fixed bottom-0 w-full sm:w-[375px] mx-auto",onClick:M(v,["stop"])},[a("div",st,[x(ge,{rankItem:d.value||e.value,hideScore:((p=d.value)==null?void 0:p.status)!==1,showPower:!0,class:"pl-4 pr-5"},{right:L(()=>{var w,l,T,N;return[n(k)?(i(),D(b,{key:0,size:"20"})):(i(),y(se,{key:1},[((w=e.value)==null?void 0:w.status)===1&&((l=d.value)==null?void 0:l.status)===1?(i(),y("div",{key:0,class:"bg-[#FFF8EC] text-[#7D3619] font-semibold rounded-md px-3 py-1.5 min-w-[52px]",onClick:r[0]||(r[0]=M(R=>f("toQuit"),["stop"]))},I(g.$t("ranking.Exit list")),1)):(i(),y("div",{key:1,class:"btn-linear text-b6 font-semibold px-3 py-1.5 min-w-[52px]",onClick:M(v,["stop"])},I((T=e.value)!=null&&T.id&&((N=e.value)==null?void 0:N.status)===1?g.$t("ranking.Go and apply"):g.$t("shop.applyShop")),9,nt))],64))]}),_:1},8,["rankItem","hideScore"])])],8,ot)}}}),lt=O(at,[["__scopeId","data-v-481becc4"]]),rt=h=>(he("data-v-5e4382be"),h=h(),fe(),h),ut=rt(()=>a("img",{class:"w-5 h-5",src:Ke,alt:""},null,-1)),it={key:0},ct={key:1},pt={class:"flex items-end px-5 py-4 text-sm"},dt=z({props:{pageType:null},emits:["changeTime"],setup(h,{emit:_}){const f=h,{t:$}=Fe(),[A,e]=E(!1),{voteMonthTimestampView:d}=we(),v=c(),k=c(new Date),S=c(new Date),m=c(""),u=c(""),g=()=>{v.value=k.value,u.value=U(v.value).format("MM"),m.value=U(v.value).format("YYYY"),e(!1),_("changeTime",{years:m.value,cycle:u.value})},r=async()=>{const{result:w}=await d();k.value=new Date(+w.thisMonthTime*1e3),u.value=U(k.value).format("MM"),m.value=U(k.value).format("YYYY")},b=()=>{v.value=null,k.value=S.value,u.value="",m.value="",e(!1),_("changeTime",{years:1e4})},p=(w,l)=>w==="month"?`${l}${$("common.month")}`:l;return oe(async()=>{f.pageType!=="record"&&await r(),m.value&&_("changeTime",{years:m.value,cycle:u.value})}),(w,l)=>{const T=P("van-datetime-picker"),N=P("van-popup");return i(),y("div",{class:"text-[#663D15] font-semibold flex flex-shrink-0 px-2 pr-3 items-center gap-1 h-8 bg-white rounded-3xl",onClick:l[3]||(l[3]=R=>n(e)(!0))},[ut,m.value&&u.value?(i(),y("span",it,I(m.value+"-"+u.value),1)):(i(),y("span",ct,I(w.$t("ranking.overall_ranking")),1)),x(N,{round:"",teleport:"body",show:n(A),"onUpdate:show":l[2]||(l[2]=R=>Pe(A)?A.value=R:null),position:"bottom",style:{height:"40%"}},{default:L(()=>[a("div",pt,[a("div",{class:"opacity-50",onClick:b},I(w.$t("ranking.overall_ranking")),1),a("div",{class:"ml-auto text-[#FEA021] text-sm",onClick:l[0]||(l[0]=R=>g())},I(w.$t("common.confirm")),1)]),x(T,{"swipe-duration":"200",modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=R=>k.value=R),type:"year-month",title:"","max-date":S.value,"show-toolbar":!1,formatter:p},null,8,["modelValue","max-date"])]),_:1},8,["show"])])}}}),vt=O(dt,[["__scopeId","data-v-5e4382be"]]),ht={class:"flex items-end justify-center mx-[7px] mt-12"},ft=["onClick"],mt=["onClick"],gt={class:"relative w-[50px] h-[50px] rounded-full avatar-img mx-auto"},wt=["src"],_t=["src"],kt=["onClick"],xt={class:"max-w-[90%] line-clamp-1 text-center text-[#7D3100]"},yt={key:0,class:"flex flex-col items-center"},$t={class:"text-xs text-b2 leading-[18px]"},bt=["onClick"],Ct={class:"relative text-[#4D2E0F] text-right text-[22px] font-BebasNeue"},It={key:0,class:"absolute right-[-22px] bottom-0 text-xs flex gap-x-1 min-w-fit"},St=z({props:{rankingTopList:null,showPower:{type:Boolean}},emits:["voteShop","toDetail"],setup(h,{emit:_}){const{rankingTopList:f}=h;return($,A)=>(i(),y("div",ht,[(i(!0),y(se,null,me(h.rankingTopList,(e,d)=>(i(),y("div",{key:d,class:H(["min-h-[120px] text-center relative px-1",`bg-linear__${d==1?"one":d==0?"two":"three"}`]),onClick:M(v=>_("voteShop",e),["stop"])},[a("div",{class:"-mt-[15px] relative",onClick:M(v=>_("toDetail",e),["stop"])},[a("div",gt,[a("img",{src:((e==null?void 0:e.logo)||"").split()[0]||n(de)("images/ranking/noPosition.png"),class:"object-cover w-full h-full rounded-full"},null,8,wt),a("img",{src:n(de)(`images/ranking/top_${d}.png`),class:"w-8 h-auto absolute -top-4 -left-4"},null,8,_t)])],8,mt),a("div",{class:"mt-2 flex justify-center items-center",onClick:M(v=>_("toDetail",e),["stop"])},[a("div",xt,I((e==null?void 0:e.storeName)||$.$t("ranking.Waiting for a vacant position")),1)],8,kt),e?(i(),y("div",yt,[a("div",$t,I(n(ze)(e==null?void 0:e.shopAddress,"**",0,4)),1),a("div",{class:"flex items-center justify-center gap-x-1 mt-2",onClick:M(v=>_("voteShop",e),["stop"])},[a("div",Ct,[x(Ee,{score:e==null?void 0:e.score},null,8,["score"]),h.showPower?(i(),y("div",It,[x(Ne,{direction:e==null?void 0:e.direction,onCompletePlay:()=>{e.direction=null}},null,8,["direction","onCompletePlay"])])):q("",!0)])],8,bt),a("div",{class:H(["-mt-6 w-8 h-4 font-bold text-base text-center text-[#995C1F] index-number",{up:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)<+(e==null?void 0:e.preHeat),down:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)>+(e==null?void 0:e.preHeat)}])},null,2)])):q("",!0)],10,ft))),128))]))}}),Tt=O(St,[["__scopeId","data-v-5aa8ab90"]]),K=h=>(he("data-v-2d6c5152"),h=h(),fe(),h),Rt={class:"parent-view",id:"ranking"},Vt={class:"flex flex-col w-full h-auto bg-mask parent-view"},Bt=K(()=>a("img",{src:Xe,class:"w-auto h-[160px] absolute right-3 top-8 -z-0"},null,-1)),Ft={class:"h-[50px] text-b2 flex items-center justify-between px-3"},Pt={class:"px-4 pt-5 pb-3 relative"},At=K(()=>a("div",{class:"min-h-[44px] relative -z-10"},[a("img",{src:et,class:"min-w-[200px] h-auto w-[53%]"})],-1)),Dt={class:"mt-[25px] flex items-center gap-x-3 relative"},Lt=K(()=>a("img",{src:tt,class:"w-5 h-5"},null,-1)),Mt=["onClick"],Et=K(()=>a("span",{class:"text-sm text-[#663D15]"},"奖励记录",-1)),Nt=z({name:"TalentRanking"});function qt(h){const _=Ae(),f=c(null),$=c(null),A=o=>{+o.years>=1e4?f.value=1e4:f.value=ve(`${o.years}-${o.cycle}`),Ie()},e=c(!1),d=c(!1),v=c(!1),k=c(0),S=c(20),m=c(0),u=c([]),g=c(null),[r,b]=E(!1),[p,w]=E(!1),l=c(null),T=ee(()=>+ve()==+f.value),N=async()=>{const{success:o,data:t,params:B}=await He({page:k.value,size:S.value,month:f.value,shopNameLike:l.value});if(!o||!t||!(t!=null&&t.total)||B.month&&+B.month!=+f.value){m.value=t==null?void 0:t.total,v.value=!0;return}const C=(t==null?void 0:t.records)||[];m.value=t.total,u.value=k.value===1?C:u.value.concat(C),u.value&&u.value.length>=m.value&&(v.value=!0)},R=ee(()=>u.value?p.value?u.value:u.value.slice(3):[]),_e=ee(()=>p.value?[]:[u.value[1],u.value[0],u.value[2]]),V=c({shopId:null,score:null}),[ne,ae]=E(!1),le=o=>{!(o!=null&&o.shopId)||!T.value||(V.value=o,ae(!0))},re=o=>{o!=null&&o.shopId&&(V.value=o,Y(`/talentRanking/rankingShop?shopId=${o.shopId}`))},[ke,j]=E(!1),[xe,ue]=E(!1),ye=async()=>{var t;ue(!0);const{success:o}=await Ue();j(!1),o&&(Q(),(t=$.value)==null||t.getRankingInfo(),ue(!1))},ie=async()=>{d.value=!0,k.value+=1,await N(),d.value=!1},G=c(null),$e=async(o,t,B=!1)=>{var C;o!=null&&o.shopId&&(t.direct===200?o.score+=t==null?void 0:t.differ:o.score-=t==null?void 0:t.differ,o.direction=t.direct,$.value&&((C=$.value)==null||C.getRankingInfo()),setTimeout(()=>{o.direction=null,B&&G.value&&G.value.handleShowReward()},2e3),setTimeout(async()=>{const{success:W,data:X}=await te({shopId:o==null?void 0:o.shopId,month:f.value});W&&(o.score=X.score)},5e3))},be=async()=>{var B,C;if(!(V!=null&&V.value.shopId))return;const{success:o,data:t}=await te({shopId:(B=V.value)==null?void 0:B.shopId,month:f.value});o&&(V.value.score=t.score,$.value&&((C=$.value)==null||C.getRankingInfo()))},Q=()=>{k.value=0,v.value=!1,u.value=[],ie()},Z=()=>{var o;w(!!(l!=null&&l.value)),(o=g.value)==null||o.blur(),Q()},Ce=()=>{e.value=!1,Q()},Ie=()=>{J&&(Te.value=J.scrollTop),Q()},Y=o=>{_.push(o)},Se=()=>{_.options.history.state.back.toString().includes("talentRanking")?_.replace("/rankingReward"):Y("/rankingReward")};let J=null;const Te=c(0);return oe(()=>{J=document.querySelector(".list__wrap")}),(o,t)=>{const B=P("VanField"),C=P("VanConfigProvider"),W=P("VanImage"),X=P("VanList"),Re=P("van-pull-refresh"),Ve=P("router-view");return i(),D(Je,{class:"h-full font-Puhui font-normal relative",style:{background:"linear-gradient(180deg, #fed820 4%, #fea020 30%, #fed820 85%)"},themeVars:{navBarBackgroundColor:"transparent",navBarIconColor:"#000"}},{default:L(()=>{var ce;return[a("div",Rt,[a("div",Vt,[Bt,a("div",Ft,[x(We),a("div",{class:"pl-2",onClick:t[0]||(t[0]=s=>Y("/talentRanking/rankingRule"))},I("规则"))]),a("div",Pt,[At,a("div",Dt,[x(vt,{pageType:"list",onChangeTime:A}),x(C,{"theme-vars":{"field-placeholder-text-color":"#663D15","field-input-text-color":"#663D15"}},{default:L(()=>[x(B,{ref:(s,F)=>{F.searchRef=s,g.value=s},class:H(["bg-b6 rounded-full h-8 flex items-center font-normal pl-2 pr-3 transition-all duration-300 relative z-10",n(r)||l.value?"flex-1":"w-[72px]"]),onFocus:t[1]||(t[1]=s=>n(b)(!0)),onBlur:t[2]||(t[2]=s=>n(b)(!1)),modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value=s),clearable:"",placeholder:n(r)?"":o.$t("common.search"),onClear:Z,onKeyup:De(Z,["enter"]),enterkeyhint:"search"},Le({"left-icon":L(()=>[Lt]),_:2},[n(r)||l.value?{name:"right-icon",fn:L(()=>[a("div",{class:"text-newOrigin font-semibold",onClick:Z},I(o.$t("common.search")),1)])}:void 0]),1032,["class","modelValue","placeholder","onKeyup"])]),_:1})])]),x(Re,{modelValue:e.value,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value=s),onRefresh:Ce,class:"list__wrap relative flex-1 overflow-auto rounded-t-xl mx-2"},{default:L(()=>[n(p)?q("",!0):(i(),y("div",{key:0,class:"absolute z-10 -right-1 top-4 w-fit h-fit py-[5px] px-2 bg-[#FFE4AD] border border-solid border-[rgba(255,255,255,0.64)] rounded-s-full flex items-center",onClick:M(Se,["stop"])},[Et,x(W,{class:"ml-[2px] w-4 h-4",src:n(je)("ranking/record_arrow.svg")},null,8,["src"])],8,Mt)),!n(p)&&u.value.length>0?(i(),D(Tt,{key:1,rankingTopList:n(_e),showPower:n(T),onVoteShop:t[4]||(t[4]=s=>le(s)),onToDetail:t[5]||(t[5]=s=>re(s))},null,8,["rankingTopList","showPower"])):q("",!0),!d.value&&v.value&&m.value==0?(i(),D(Me,{key:2})):(i(),D(X,{key:3,loading:d.value,finished:v.value,"finished-text":o.$t("common.noMore"),"immediate-check":!1,class:"min-h-[40vh] pb-[100px] relative z-10",onLoad:ie},{default:L(()=>[(i(!0),y(se,null,me(n(R),(s,F)=>{var pe;return i(),D(ge,{key:s.id,rankItem:s,showPower:n(T),onVoteShop:Be=>le(s),onToDetail:Be=>re(s),class:H(["relative",{"active-bottom":F+1!==((pe=n(R))==null?void 0:pe.length)}])},null,8,["rankItem","showPower","onVoteShop","onToDetail","class"])}),128))]),_:1},8,["loading","finished","finished-text"]))]),_:1},8,["modelValue"])]),n(T)&&!n(p)?(i(),D(lt,{key:0,ref:(s,F)=>{F.userOwnerRef=s,$.value=s},month:f.value,onToApply:t[7]||(t[7]=s=>Y("/joinRanking")),onToApplyShop:t[8]||(t[8]=s=>Y("/editShopInfo")),onToQuit:t[9]||(t[9]=s=>n(j)(!0))},null,8,["month"])):q("",!0)]),n(ne)?(i(),D(Ge,{key:0,show:n(ne),shopId:(ce=V.value)==null?void 0:ce.shopId,teleport:"#ranking",onClose:t[10]||(t[10]=s=>n(ae)(!1)),onVoteSuccess:t[11]||(t[11]=(s,F)=>$e(V.value,s,F))},null,8,["show","shopId"])):q("",!0),x(Ze,{ref:(s,F)=>{F.voteRewardRef=s,G.value=s}},null,512),x(Qe,{show:n(ke),content:"您的店铺本月已存在被投票充电记录，本次退出榜单操作将在下月生效",showConfirm:!0,showReject:!0,loading:n(xe),confirmText:"确认退榜",noClose:"","content-class":"text-b1 font-semibold",onClose:t[12]||(t[12]=s=>n(j)(!1)),onConfirm:ye,onReject:t[13]||(t[13]=s=>n(j)(!1))},null,8,["show","loading"]),x(Ve,{class:"child-view",onVoteSuccess:be})]}),_:1})}}const Yt=z({...Nt,setup:qt}),ao=O(Yt,[["__scopeId","data-v-2d6c5152"]]);export{ao as default};
