import{_ as Y,y as Z,w as W,bc as E,x as X,bd as ee,r as k,z as A,D as se,F as r,G as a,H as l,a2 as g,O as b,Q as n,N as m,E as C,P as d,K as f,Y as te,Z as oe,I as ae,J as le,a0 as y,T as ne}from"./vendor-CjApaIpB.js";import{B as de}from"./BackIcon-D2Vm_lyR.js";import{e as ce,u as re,r as ie}from"./index-CduCwCyL.js";import{b as ue,a as pe,d as he,e as ge}from"./category-C1RWK50_.js";import{C as be}from"./ChangeRegion-Bkwu4vRr.js";import"./ChangeRegionPop-y40zTO9y.js";const me="/Test-dev/static/images/delete-Czpqz061.svg",j=x=>(te("data-v-1ff70bab"),x=x(),oe(),x),fe={class:"px-3 text-sm text-default bg-gray1"},ye={class:"gap-2 mt-2 flex-start"},xe={class:"mt-4 px-2 py-4 bg-white rounded-xl"},ve={class:"flex gap-1 opacity-60 text-center mb-[10px]"},_e=j(()=>l("div",{class:"w-[10%]"},null,-1)),we={class:"w-[30%]"},ke={class:"w-[20%]"},Ce={class:"w-[25%]"},Ve=j(()=>l("div",{class:"w-[15%]"},null,-1)),Oe={class:"w-[10%] flex-center"},Ee={key:0,class:"w-[30%]"},je={class:"text-black text-center whitespace-nowrap bg-[#EBEBEB] px-2 py-1 rounded-3xl"},Se={class:"relative flex justify-center w-[20%]"},Ie={key:1,class:"inline-flex border border-black border-solid rounded-[20px] h-[1.75rem] px-2 justify-center items-center w-10"},Te={key:2,class:"relative w-[25%]"},Be=["onClick"],$e=j(()=>l("img",{src:me,class:"w-4 h-4",alt:""},null,-1)),De=["onClick"],Fe={key:0,class:"px-2 py-4 mt-4 bg-white rounded-xl flex-center-bw"},Le={key:1},Ae=Z({setup(x){const{accountStore:v}=ce(),{getCurrentStoreId:S}=re(),{t:I}=W(),{loadingToggle:T}=ie(),[B,_]=E(!1),[$,h]=E(!1),[N,D]=E(!1),q=X(()=>[{id:1,name:I("shop.goods")}]),s=ee({active:0,goodsClass:[],goodsTypeClass:[],classObj:{id:null,name:null,sortOrder:0,type:1,isEdit:!0}}),p=k([]),U=k(null),V=k(!1),G=k(null),R=e=>{p.value=e?s.goodsTypeClass.map(o=>o.id):[]},z=e=>{const o=e.length;V.value=o===s.goodsTypeClass.length&&s.goodsTypeClass.length>0},H=async()=>{D(!0);const e=await ue(p.value);D(!1),e.success&&(p.value=[],w())},w=async()=>{var e;T(!0);try{const o=await pe({address:(e=await S())==null?void 0:e.merchant,type:q.value[s.active].id});s.goodsClass=(o.data||[]).map(i=>({...i,isEdit:!1}))}finally{T(!1)}};A(()=>s.goodsClass,e=>{s.goodsTypeClass=e.filter(o=>o.type===s.active+1)},{deep:!0}),A(()=>s.active,e=>{s.goodsTypeClass=s.goodsClass.filter(o=>o.type===e+1)});const J=()=>{_(!0),s.classObj.id=null,s.classObj.name=null,s.classObj.sortOrder=null,s.classObj.type=s.active+1,s.classObj.isEdit=!0,s.goodsClass.push(s.classObj)},K=e=>{B.value||(_(!0),s.classObj=e,e.isEdit=!0)},F=(e,o)=>{const i=e.target.value.replace(/[^\d]/g,"");s.goodsTypeClass[o].sortOrder=i},M=async()=>{var o;if(!s.classObj.name)return ne(I("shop.emptySubClass"));h(!0);const e=await he({...s.classObj,shopId:(o=await S())==null?void 0:o.id});h(!1),e.success&&(_(!1),w())},P=async(e,o)=>{if(h(!0),!e.id){s.goodsClass.splice(o+1,1),_(!1),h(!1);return}const i=await ge(e.id);h(!1),i.success&&w()};return se(async()=>{w()}),(e,o)=>{const i=C("van-checkbox"),L=C("VanField"),Q=C("van-checkbox-group"),O=C("VanButton");return a(),r("div",fe,[l("div",ye,[b(de),l("div",null,n(e.$t("profile.category")),1),b(be,{showIcon:!0,showDownIcon:!1,class:"ml-auto bg-gray1 px-2 rounded-[20px] border-2 border-solid border-white",style:{"box-shadow":"0px 0px 15px 0px rgba(51, 47, 42, 0.3) inset"}})]),l("div",xe,[l("div",ve,[_e,l("div",we,n(e.$t("shop.categoryName")),1),l("div",ke,n(e.$t("shop.position")),1),l("div",Ce,n(e.$t("shop.operation")),1),Ve]),b(Q,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=t=>p.value=t),ref:(t,u)=>{u.checkboxGroup=t,U.value=t},onChange:z},{default:m(()=>[(a(!0),r(ae,null,le(d(s).goodsTypeClass,(t,u)=>(a(),r("div",{class:"w-full py-[10px] bg-[#F9F9F9] rounded flex gap-1 mb-2.5 px-1 text-center",key:u},[l("div",Oe,[t.isEdit?g("",!0):(a(),f(i,{key:0,name:t.id,class:""},null,8,["name"]))]),t.isEdit?(a(),f(L,{key:1,class:"w-[30%] text-black whitespace-nowrap text-center items-center justify-center h-[1.75rem] px-[5px] mx-auto border border-black border-solid rounded-[20px]",modelValue:t.name,"onUpdate:modelValue":c=>t.name=c,placeholder:e.$t("shop.emptySubClass"),maxlength:"5"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(a(),r("div",Ee,[l("div",je,n(t.name),1)])),l("div",Se,[t.isEdit?(a(),f(L,{key:0,modelValue:t.sortOrder,"onUpdate:modelValue":c=>t.sortOrder=c,"input-align":"center",class:"absolute text-center items-center justify-center h-[1.75rem] border border-black border-solid rounded-[20px]",onInput:c=>F(c,u),onBlur:c=>F(c,u)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])):(a(),r("div",Ie,n(t.sortOrder),1))]),d(v).isOnlyView?g("",!0):(a(),r("div",Te,[l("div",{class:"absolute right-0 inline-flex items-center justify-center h-[1.75rem] px-3 mx-auto border border-black border-solid rounded-[20px]",onClick:c=>P(t,u)},[$e,y(" "+n(e.$t("shop.delete")),1)],8,Be)])),!t.isEdit&&!d(v).isOnlyView?(a(),r("div",{key:3,class:"w-[15%] inline-flex items-center justify-center text-primary",onClick:c=>K(t)},n(e.$t("shop.edit")),9,De)):g("",!0)]))),128))]),_:1},8,["modelValue"])]),d(s).goodsTypeClass.length>0&&!d(v).isOnlyView?(a(),r("div",Fe,[b(i,{modelValue:V.value,"onUpdate:modelValue":o[1]||(o[1]=t=>V.value=t),onChange:R,ref:(t,u)=>{u.checkAll=t,G.value=t}},{default:m(()=>[y(n(e.$t("common.check all")),1)]),_:1},8,["modelValue"]),b(O,{round:"",hairline:"",class:"btn text-[#EF1D10] py-3 px-[35px]",disabled:p.value.length===0,onClick:H,loading:d(N)},{default:m(()=>[y(n(e.$t("common.batch delete")),1)]),_:1},8,["disabled","loading"])])):g("",!0),d(v).isOnlyView?g("",!0):(a(),r("div",Le,[d(B)?(a(),f(O,{key:1,class:"btn-orange w-[180px] h-10 flex-center text-white font-semibold fixed x-center bottom-9",loading:d($),onClick:M},{default:m(()=>[y(n(e.$t("common.finish")),1)]),_:1},8,["loading"])):(a(),f(O,{key:0,class:"btn-orange w-[180px] h-10 flex-center text-white font-semibold fixed x-center bottom-9",loading:d($),onClick:J},{default:m(()=>[y(n(e.$t("shop.addClass")),1)]),_:1},8,["loading"]))]))])}}}),He=Y(Ae,[["__scopeId","data-v-1ff70bab"]]);export{He as default};
