import{S as j,G as N,a as U,_ as Y,b as J}from"./ShareGoodPopup-CEec45uo.js";import{y as D,bf as K,x as B,z as M,F as S,G as d,H as u,Q as F,P as i,I as Q,J as W,K as p,X,br as Z,_ as A,be as ee,r as m,w as oe,a1 as se,l as te,bj as ae,by as le,D as ne,a2 as h,O as L,R as ie,Y as re,Z as de,T as ue}from"./vendor-BUT0HZ5j.js";import{_ as ce}from"./GoodsEvaluateItem-B-WcUeON.js";import{aB as me,e as pe,r as ge,aC as fe,aD as ve,W as ye,V as he}from"./index-k1FFr-1T.js";import{G as Ie,a as we,_ as _e}from"./GoodsInfo-DtQoQgyg.js";import{R as Se}from"./RemovedShelves-B9PBZPPN.js";import{S as be}from"./shop-CeqcS6K2.js";import{O as Te}from"./offlineGoods-DvT2Go6q.js";import{D as P}from"./goods-BVwS8oFG.js";import"./shop-arrow-right-Br6r0Qcd.js";import"./BoutiqueLabelInLogo-8rzV321c.js";import"./RatioBox-ys008e7W.js";import"./kefu-BZ7ykajd.js";import"./goods-Dr4TCxnz.js";import"./convertToImage-DIjasxRw.js";import"./browser-DFlSdkZC.js";import"./upload-B40Myr0u.js";import"./active_empty-CBz3QrKQ.js";import"./HelpPop-2HtEDPpf.js";import"./MCOIN-BcbOHmhy.js";import"./logo-CT48NEDW.js";import"./BoutiqueLable-r45nG6V6.js";import"./flashSale-DDyqLyYN.js";import"./GoodsPrice-Ai76_1qQ.js";import"./enums-DlE-aiss.js";import"./BackIcon-biFt6cm7.js";const xe={class:"relative mb-2 w-full flex justify-center items-center"},$e={class:"text-sm font-semibold text-center"},ke={class:"absolute right-0 top-0 text-[12px] text-[#999999] leading-[20px]"},Fe=D({props:{goodsId:null},emits:["handleTo"],setup(c,{emit:b}){const g=c,a=K({commentList:[],total:0}),T=async()=>{const l=await me({goodsId:g.goodsId,page:1,size:1,commentStatus:1,sortBy:"desc|comment_time"});l.success&&(a.commentList=l.data.records||[],a.total=l.data.total)},f=B(()=>{if(a.commentList&&a.commentList.length>0){const l=[];for(let t=0;t<a.commentList.length;t++)a.commentList[t].commentPics&&a.commentList[t].commentPics.length>0&&l.push(...a.commentList[t].commentPics.split(","));return l}return[]}),x=l=>{const t=f.value.findIndex(e=>e===l);Z({images:f.value,closeable:!0,showIndex:!0,startPosition:t})};return M(()=>g.goodsId,()=>{T()},{immediate:!0}),(l,t)=>(d(),S("div",{class:"p-2.5 mb-2.5 bg-white rounded-xl text-base",onClick:t[0]||(t[0]=e=>b("handleTo",`/offline-evaluate-home?goodsId=${c.goodsId}`))},[u("div",xe,[u("div",$e,F(l.$t("evaluate.Buyer Reviews"))+"（"+F(i(a).total)+"） ",1),u("div",ke,F(l.$t("common.all"))+" > ",1)]),(d(!0),S(Q,null,W(i(a).commentList,(e,n)=>(d(),p(ce,{onImgPre:x,key:e.id,data:e,class:"border-none",style:X(n===i(a).commentList.length-1?"margin-bottom:0":"")},null,8,["data","style"]))),128))]))}}),C=c=>(re("data-v-625a73af"),c=c(),de(),c),Le={class:"relative w-full h-full !bg-[#F8F8F8]"},Pe={key:0},Be=C(()=>u("img",{class:"w-[1.375rem] h-[1.375rem]",src:Y},null,-1)),De=[Be],Ge=C(()=>u("img",{class:"w-[1.375rem] h-[1.375rem]",src:J},null,-1)),Ce=[Ge],Oe={class:"safe-bottom-page pt-4 px-2.5 bg-[#F8F8F8]"},Re=D({name:"GoodsDetail"});function He(c){const{orderGoodsStore:b}=pe(),[g,a]=ee(!1),T=m(!1),{loadingToggle:f}=ge(),{t:x}=oe(),l=se(),t=te(),e=m(null),n=m(null),$=m(l.query.goodsId),I=B(()=>l.query.storeId),O=B(()=>window.location.origin+"/#/offlineGoodsDetail?goodsId="+$.value),R=async()=>{const o=$.value;if(o==null||o==="")return;let s={id:o};I.value&&(s.storeId=I.value),console.log(s);const r=await ve(s);e.value=r.data,e.value.icons=e.value.goodsIcons,e.value.type=e.value.goodsType,e.value.deliveryType=P.offeline,e.value.price=e.value.goodsPrice},H=async()=>{var r;if(!((r=e.value)!=null&&r.shopId))return;const{success:o,data:s}=await ye(e.value.shopId);o&&(n.value=s)},v=m(null),y=o=>{t.push(o)},q=()=>{ue({message:x("common.Saved successfully"),icon:he("toast-success.svg"),duration:3e3})},z=()=>{try{window.history.state.back?t.back():window.history.length>2?window.history.back():t.replace({path:"/mall"})}catch{t.push("/")}},E=()=>{b.changeOfflineInfo({goods:e.value,store:n.value});let o=`/offlineSubmit?key=${$.value}&orderType=${Te.GOODS}`;I.value&&(o+=`&storeId=${I.value}`),y(o)},G=m(0);let w=m(!0);const k=le(()=>{const o=document.getElementById("fm-page");G.value=o.scrollY||o.scrollTop,G.value<100?(w.value=!1,v.value&&v.value.resumeSwiper()):(w.value=!0,v.value&&v.value.pauseSwiper())},100),V=()=>{document.getElementById("fm-page").addEventListener("scroll",k),k()};return ae(()=>{const o=document.getElementById("fm-page");o&&o.removeEventListener("scroll",k)}),ne(async()=>{V(),f(!0),await R(),await H(),f(!1)}),(o,s)=>(d(),S("div",Le,[e.value&&n.value&&+e.value.goodsStatus==1&&+n.value.status!=3&&+n.value.status!=4&&+n.value.status!=0?(d(),S("div",Pe,[u("header",{class:ie(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[44px] px-2.5 fixed",{"bg-white":i(w)," bg-black/0":!i(w)}])},[u("div",{class:"flex flex-wrap items-center",onClick:z},De),u("div",{onClick:s[0]||(s[0]=r=>i(a)(!0))},Ce)],2),L(Ie,{ref:(r,_)=>{_.goodsImgRef=r,v.value=r},imgs:(e.value.goodsIcons||"").split(","),goodsTypes:i(P).offeline},null,8,["imgs","goodsTypes"]),L(we,{stores:n.value,goods:e.value,class:"relative z-10"},null,8,["stores","goods"]),u("div",Oe,[L(Fe,{onHandleTo:y,goodsId:e.value.goodsId},null,8,["goodsId"]),n.value.id?(d(),p(j,{key:0,store:n.value,onHandleTo:y},null,8,["store"])):h("",!0),e.value.goodsDesc||e.value.goodsPics?(d(),p(_e,{key:1,text:e.value.goodsDesc,imgs:(e.value.goodsPics||"").split(",")},null,8,["text","imgs"])):h("",!0)]),e.value.goodsId?(d(),p(N,{key:0,goods:e.value,goodsId:e.value.goodsId,boutiqueFlag:e.value.goodsType>=i(be).SD,isFollow:T.value,deliveryType:i(P).offeline,storeInfo:n.value,onHandeToShop:s[1]||(s[1]=r=>y(`/category?deliveryType=1&shopId=${n.value.id}`)),onHandleConnect:s[2]||(s[2]=r=>{var _;return y(`/shopInfo?address=${(_=n.value)==null?void 0:_.merchant}`)}),onHandleOffine:s[3]||(s[3]=r=>E())},null,8,["goods","goodsId","boutiqueFlag","isFollow","deliveryType","storeInfo"])):h("",!0)])):e.value&&!i(fe)?(d(),p(Se,{key:1,type:"good"})):h("",!0),i(g)?(d(),p(U,{key:2,show:i(g),onOnSuceess:q,onClose:s[4]||(s[4]=r=>i(a)(!1)),goods:e.value,"code-url":i(O)},null,8,["show","goods","code-url"])):h("",!0)]))}const qe=D({...Re,setup:He}),mo=A(qe,[["__scopeId","data-v-625a73af"]]);export{mo as default};
