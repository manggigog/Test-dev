import{_ as Me}from"./avatarRing2-Ckr5tuam.js";import{_ as He}from"./information-BXOyO4i9.js";import{_ as Se}from"./MCOIN-Bodfn-v1.js";import{_ as Ve,z as qe,r as V,o as Ue,a2 as P,y as h,x as We,B as ve,E as Ye,Z as _,H as i,$ as S,V as ze,O as t,F as ye,G as T,U as p,P as m,I as s,J as q,a4 as G,Q as l,T as he,X as je,Y as Ge}from"./vendor-Dr_RpJ_Y.js";import{H as Xe}from"./HelpEmpty-v2Y_WLCz.js";import{C as Je}from"./CommonVanProvider-KZuKVOde.js";import{_ as Qe}from"./OfflineGoods-DKMaiwr2.js";import{_ as Ze}from"./OfflineTotalPriceDetail-C6dVbe43.js";import{P as Ke}from"./PaySwitchPop-jRKJee4g.js";import{_ as eo}from"./ServiceByStore-_CULXKHe.js";import{_ as oo}from"./OfflineStore-D-5bM32y.js";import{P as to}from"./PaymentMethodSelector-Bpf0rZb7.js";import{u as ao}from"./usePaymentBalance-f4pIUpTg.js";import{_ as X}from"./SubmitApprove-B3ByTMk_.js";import{a as so,b as ro,i as lo,an as k,k as J,w as no,c4 as uo,a8 as io,f as co,e as ge,g as x,y as we,C as mo,cf as po,cg as fo,X as vo,c5 as yo}from"./index-7OiUoGXy.js";import{P as U}from"./order-H59PKTFP.js";import{a as _e}from"./payHelp-BuwJxNdC.js";import{o as ho,a as u}from"./offlineGoods-DvT2Go6q.js";import{S as go}from"./shop-CeqcS6K2.js";import"./BackIcon-CDrGaEPo.js";import"./ImgBoutiqueLable-B-2xCcw4.js";import"./USDT-Dlu99aCg.js";import"./FMCP-f3k58DsE.js";import"./point-arrow-C6HCTn4p.js";import"./usePointRelase-CczR7Un0.js";import"./piggyBank-DCQqbblx.js";const W=I=>(je("data-v-cee45de4"),I=I(),Ge(),I),wo={key:1},_o={class:"page-body overflow-y-auto"},So={class:"bg-b6 rounded-xl p-3"},bo={class:"flex items-center gap-x-1"},Ao=W(()=>s("div",{class:"w-[30px] h-[30px] bg-b5 rounded-full"},[s("img",{src:Me})],-1)),Co={class:"text-b2"},Po=W(()=>s("img",{src:He,class:"w-4 h-4"},null,-1)),To=[Po],ko={class:"flex items-center justify-center gap-x-1 mt-2.5 h-10"},xo=W(()=>s("img",{src:Se,class:"w-[17px] h-[17px]"},null,-1)),$o={class:"text-b1 text-[28px] font-bold"},Io={class:"w-full p-3 rounded-xl bg-white mt-3"},No={class:"text-b3"},Eo={class:"flex items-center"},Do=W(()=>s("img",{src:Se,class:"w-4 h-4 mr-1.5"},null,-1)),Lo={class:"text-b1 font-normal"},Oo={class:"gap-x-3 py-4 flex items-center justify-between"},Ro={key:0,class:"relative flex-1"},Bo={class:"relative flex-1"},Fo={class:"flex items-center justify-center gap-x-0.5"},Mo={class:"font-Puhui"},Ho={class:"text-b1 font-semibold text-center"},Vo={class:"font-Puhui"},qo={class:"text-b1 text-base font-semibold text-center"},Uo={class:"text-b2 text-sm font-normal flex flex-col gap-y-2 mt-5"},Wo=qe({setup(I){const{loadingToggle:Q}=no(),be=Ue(),N=V(be.query.payId),[Ae,Z]=P(!0),K=h(()=>{var e;return((e=o.value)==null?void 0:e.relType)>go.SD}),{accountStore:n}=so(),{checkLoginAuth:Ce,checkRegisterAuth:Pe}=ro(),E=V(null),{balanceState:b,paymentOptions:Te,getPaymentBySource:ke,fetchAllBalances:ee,autoSelectPaymentMethod:xe,checkSufficientBalance:$e}=ao(K),c=V(U.WITHDRAW_POINTS),Ie=h(()=>ke(c.value)),{submitOffline:Ne}=lo(),{t:A}=We(),[C,D]=P(!1),[Ee,oe]=P(!1),[De,Y]=P(!1),[Le,L]=P(!1),[Oe,z]=P(!1),te=h(()=>{var e;return ho((e=o.value)==null?void 0:e.orderType)}),ae=e=>{c.value=e},o=V({orderId:null,merchantAddress:null,orderCustomerAddress:null,orderStatus:null,orderType:null,orderRealAmount:null,createTime:null,countdownTime:null,orderPayAddress:null,cancelSource:null,relNumber:1,relName:null,relIcons:null,shopPics:null,shopName:null,orderDiscountRatio:1,relType:0}),O=h(()=>{var e;return k((e=o.value)==null?void 0:e.orderCustomerAddress)===k(n==null?void 0:n.account)}),Re=()=>{var d,g,f,v;let e=null,a=null;switch((d=o.value)==null?void 0:d.orderStatus){case u.PAYMENT_FAILED:case u.CLOSED:case u.CANCELLED:if(+((g=o.value)==null?void 0:g.cancelSource)==3)e=J("images/payHelp/timeout.png"),a=A("payhelp.order_timeout");else{e=J("images/payHelp/orderClose.png"),a=A("order.status5");break}break;case u.PAYMENT_SUCCESS:case u.COMPLETED:e=J("images/payHelp/paySuccess.png");const y=((f=o.value)==null?void 0:f.orderPayAddress)&&k(n==null?void 0:n.account)===k((v=o.value)==null?void 0:v.orderPayAddress);a=O.value&&y?A("payhelp.pay_success_owner"):A(y?"common.pay success":"payhelp.pay_success_other");break}return{img:e,text:a}},se=h(()=>Re()),re=async()=>{var e,a;if(o.value.orderStatus===u.PAYMENT_FAILED&&((e=o.value)==null?void 0:e.orderStatus)===u.PAYMENT_FAILED){const d=await io();o.value.countdownTime=+((a=o.value)==null?void 0:a.createTime)+15*60*1e3-d*1e3,o.value.countdownTime<=0&&(o.value.orderStatus=u.CANCELLED,o.value.cancelSource=3)}},le=h(()=>{var e,a;return new ve((e=o.value)==null?void 0:e.orderDiscountRatio).times(((a=o.value)==null?void 0:a.orderRealAmount)||0).times(b.pointSelfRate).div(100).toString()}),ne=h(()=>Math.min(b.voucherBalance,new ve(le.value).div(b.pointSelfRate).times(.5).toNumber())),j=h(()=>c.value===U.WITHDRAW_POINTS?ne.value:0),Be=async()=>{var e,a,d,g,f,v,y;if(Ce(!0)&&await Pe(!0)){if(!$e((e=Ie.value)==null?void 0:e.source,(a=E.value)==null?void 0:a.realTotalAmountShow))return oe(!0);D(!0),o.value.orderPayAddress=n==null?void 0:n.account;try{const w={orderId:o==null?void 0:o.value.orderId,orderPayAddress:n==null?void 0:n.account,orderPaySource:c.value},{success:R,code:B,data:$}=await po(w);if(!R){B===511&&Y(!0);return}const{success:F}=await Ne((d=o.value)==null?void 0:d.merchantAddress,(g=o.value)==null?void 0:g.orderRealAmount,(f=o.value)==null?void 0:f.orderDiscountRatio,w.orderPaySource,$.isScanFlag,$.allId,(v=o.value)==null?void 0:v.orderCustomerAddress);if(!F){k(n==null?void 0:n.account)===k((y=o.value)==null?void 0:y.orderCustomerAddress)&&(o.value.orderPayAddress=null,fo(N.value)),re();return}he.loading({message:A("order.wait block chain"),forbidClick:!0,duration:0});const M=N.value;await vo({id:M,currentOrderStatus:u.PAYING}),setTimeout(()=>{he.clear(),ue()},1500)}catch(w){console.log(w,"erro")}finally{D(!1)}}},Fe=async()=>{D(!0);try{const{success:e}=await yo({orderId:N.value,cancelReason:"用户取消",cancelSource:2});if(!e)return;o.value.orderStatus=u.CANCELLED,o.value.cancelSource=2,L(!1)}finally{D(!1)}},ue=async()=>{Q(!0),Z(!0);const e=N.value;if(!(e==null||e==="")){try{const{success:a,data:d}=await uo({id:e});if(o.value=d,Q(!1),Z(!1),!a){o.value.orderStatus=u.CLOSED;return}}catch{o.value={orderStatus:u.CLOSED}}await re()}};return Ye(async()=>{await Promise.all([ue(),ee()]);const e=xe(o.value.orderRealAmount,ne.value);ae(e)}),(e,a)=>{var f;const d=ye("VanButton"),g=ye("van-count-down");return i(),_(Je,{title:t(O)?e.$t("order.waitBlockOrder"):e.$t("payhelp.payHelp"),class:"bg-gray1 font-Puhui px-3 relative",style:ze({background:((f=o.value)==null?void 0:f.orderStatus)===t(u).PAYMENT_FAILED?"linear-gradient(180deg, #fed73a 0%, #f2f0ef 50%)":"#F2F0EF"}),themeVars:{navBarBackgroundColor:"transparent","count-down-font-size":"16px"}},{default:S(()=>{var v,y,w,R,B,$,F,M,ie,de,ce,me,pe,fe;return[t(Ae)?p("",!0):(i(),T(q,{key:0},[(v=o.value)!=null&&v.orderStatus&&((y=o.value)==null?void 0:y.orderStatus)!==t(_e).WAIT?(i(),_(Xe,{key:0,name:(w=t(se))==null?void 0:w.text,imgUrl:(R=t(se))==null?void 0:R.img},null,8,["name","imgUrl"])):p("",!0),((B=o.value)==null?void 0:B.orderStatus)===t(_e).WAIT?(i(),T("div",wo,[s("div",_o,[s("div",So,[s("div",bo,[Ao,s("div",Co,[t(O)?(i(),T(q,{key:0},[G(l(e.$t("payhelp.owner_wait_tip")),1)],64)):(i(),T(q,{key:1},[G(l(t(co)(o.value.orderCustomerAddress,"...",5,5))+" "+l(e.$t("payhelp.other_wait_tip")),1)],64))]),s("div",{onClick:a[0]||(a[0]=r=>t(z)(!0))},To)]),s("div",ko,[xo,s("span",$o,l(t(ge)(($=o.value)==null?void 0:$.orderRealAmount)),1)])]),s("div",Io,[t(te).GOODS?(i(),_(Qe,{key:0,class:"h-[80px]","show-goods-type":"",goods:{goodsName:((F=o.value)==null?void 0:F.relName)||"-",goodsIcons:(M=o.value)==null?void 0:M.relIcons,goodsType:(ie=o.value)==null?void 0:ie.relType,...o.value}},{"bottom-left":S(()=>{var r;return[s("div",No,l(e.$t("order.quantity",{number:(r=o.value)==null?void 0:r.relNumber}))+"，"+l(e.$t("order.sumtotal"))+": ",1)]}),"bottom-price":S(()=>{var r;return[s("div",Eo,[Do,s("div",Lo,l(t(ge)(((r=o.value)==null?void 0:r.orderRealAmount)||0)),1)])]}),_:1},8,["goods"])):t(te).STORE?(i(),T(q,{key:1},[m(oo,{status:(de=o.value)!=null&&de.orderPayAddress?e.$t("order.paying"):e.$t("order.waitPay"),"show-order-status":"",shop:{images:(ce=o.value)==null?void 0:ce.shopPics,name:(me=o.value)==null?void 0:me.shopName}},null,8,["status","shop"]),m(eo,{price:o.value.orderRealAmount,loading:t(C)},null,8,["price","loading"])],64)):p("",!0)]),m(to,{class:"mt-3",modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=r=>c.value=r),"payment-options":t(Te),loading:t(b).loading,boutique:t(K),onChange:ae,onGetPointBalance:t(ee)},null,8,["modelValue","payment-options","loading","boutique","onGetPointBalance"]),m(Ze,{ref:(r,H)=>{H.priceDetailRedf=r,E.value=r},totalAmount:o.value.orderRealAmount,"usdt-rate":t(b).usdtRate,"voucher-price":t(b).voucherBalance,integral:t(le),voucherAmount:t(j),paySource:c.value,class:"mb-2.5"},null,8,["totalAmount","usdt-rate","voucher-price","integral","voucherAmount","paySource"])]),s("div",Oo,[t(O)?(i(),T("div",Ro,[m(d,{round:"",class:"bg-b6 text-b1 text-base !border !border-solid !border-b4 w-full h-[46px]",loading:t(C),onClick:a[2]||(a[2]=r=>t(L)(!0))},{default:S(()=>[G(l(e.$t("order.cancelOrder")),1)]),_:1},8,["loading"])])):p("",!0),s("div",Bo,[[t(U).WALLET].includes(c.value)?(i(),_(X,{key:0,class:"btn-yellow w-full h-[46px] rounded-full z-10 absolute",contract:t(x).order,token:t(x).MCOIN,symbol:"MCOIN",loading:t(C),approveAmount:Number(((pe=E.value)==null?void 0:pe.realTotalAmountShow)||0)},null,8,["contract","token","loading","approveAmount"])):p("",!0),[t(U).USDT_WALLET].includes(c.value)?(i(),_(X,{key:1,class:"btn-yellow w-full h-[46px] rounded-full z-10 absolute",contract:t(x).order,token:t(x).USDT,symbol:"USDT",loading:t(C),approveAmount:Number(((fe=E.value)==null?void 0:fe.realTotalAmountShow)||0)},null,8,["contract","token","loading","approveAmount"])):p("",!0),t(j)>0?(i(),_(X,{key:2,class:"btn-yellow w-full h-[46px] rounded-full z-10 absolute",contract:t(x).order,token:t(x).FMCP,symbol:e.$t("voucher.voucher"),loading:t(C),approveAmount:Number(t(j))},null,8,["contract","token","symbol","loading","approveAmount"])):p("",!0),m(d,{round:"",class:"pay-btn btn-yellow w-full h-[46px] text-base font-semibold",loading:t(C),onClick:Be},{default:S(()=>{var r,H;return[s("div",Fo,[s("span",null,l(e.$t("common.pay")),1),((r=o.value)==null?void 0:r.countdownTime)>0?(i(),_(g,{key:0,time:(H=o.value)==null?void 0:H.countdownTime,format:"mm:ss",onFinish:a[3]||(a[3]=()=>{o.value.cancelSource=3,o.value.orderStatus=t(u).CANCELLED})},null,8,["time"])):p("",!0)])]}),_:1},8,["loading"])])])])):p("",!0),m(Ke,{paySource:c.value,show:t(Ee),onClose:a[4]||(a[4]=r=>t(oe)(!1))},null,8,["paySource","show"]),m(we,{noClose:"",show:t(De),onClose:a[6]||(a[6]=r=>t(Y)(!1))},{default:S(()=>[s("div",Mo,[s("div",Ho,l(e.$t("payhelp.lockTips")),1),s("div",{class:"mt-6 flex-1 h-[46px] leading-[46px] rounded-full text-center bg-yellow",onClick:a[5]||(a[5]=r=>t(Y)(!1))},l(e.$t("common.I_see")),1)])]),_:1},8,["show"]),m(we,{noClose:"",show:t(Oe),onClose:a[8]||(a[8]=r=>t(z)(!1))},{default:S(()=>[s("div",Vo,[s("div",qo,l(e.$t("payhelp.instructions")),1),s("ul",Uo,[s("li",null,l(e.$t("payhelp.instructions_1")),1),s("li",null,l(e.$t("payhelp.instructions_2")),1),s("li",null,l(e.$t("payhelp.instructions_3")),1)]),s("div",{class:"mt-6 flex-1 h-[46px] leading-[46px] rounded-full text-center bg-yellow",onClick:a[7]||(a[7]=r=>t(z)(!1))},l(e.$t("common.I_see")),1)])]),_:1},8,["show"]),m(mo,{show:t(Le),title:e.$t("order.cancelOrder"),content:e.$t("order.cancelOrderTips"),showConfirm:!0,showReject:!0,confirmText:e.$t("common.confirm"),noClose:"",onClose:a[9]||(a[9]=r=>t(L)(!1)),onConfirm:a[10]||(a[10]=r=>Fe()),onReject:a[11]||(a[11]=r=>t(L)(!1))},null,8,["show","title","content","confirmText"])],64))]}),_:1},8,["title","style"])}}}),ht=Ve(Wo,[["__scopeId","data-v-cee45de4"]]);export{ht as default};
