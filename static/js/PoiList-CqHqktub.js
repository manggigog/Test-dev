import{_ as G,l as Q,x as N,F as b,G as c,H as t,Q as E,a2 as U,P as F,I as D,Y as se,Z as le,r as d,E as P,O as M,N as R,J as K,K as j,R as ne,z as ve,D as W,a9 as fe,T as H,y as X,X as q,a1 as re,bp as pe,bc as he,a4 as J,bd as me}from"./vendor-BUT0HZ5j.js";import{C as ge}from"./CommonVanProvider-BpsZUrD3.js";import{e as Z,al as _e,aK as ye,aL as xe,az as Ie,as as be}from"./index-hbwLMIYO.js";import{L as we}from"./localMark-BgS5G0xz.js";import{O as Ce}from"./OfflineMerchantLabel-DTcnjuGQ.js";import{u as Le}from"./useCityMap-fPla5ZMg.js";import{_ as ke}from"./SearchBar-DUv-Q4mh.js";import"./BackIcon-biFt6cm7.js";import"./search-Dwmdj_3F.js";import"./delete-C3qvlPYO.js";const Ae=s=>(se("data-v-4e2aafeb"),s=s(),le(),s),Fe={class:"shop-name flex items-center justify-between"},$e={class:"text-base text-b1 font-semibold line-clamp-1"},Se=Ae(()=>t("div",{class:"border border-[#FF8812] rounded-full px-2 py-[2px] text-[#FF8812] text-xs"}," 到这去 ",-1)),Ee={class:"shop-desc mt-1"},Me={class:"text-b3 text-sm line-clamp-1"},Be={class:"shop-imgs h-[80px] flex gap-1 mt-2"},ze={key:0,class:"min-w-[1/2] w-[50%] h-[80px] rounded-lg overflow-hidden"},De=["src"],Oe={class:"w-1/2 h-[80px] rounded-l-lg overflow-hidden"},Te=["src"],je={class:"w-1/2 h-[80px] rounded-r-lg overflow-hidden"},Pe=["src"],Ve={class:"w-1/3 h-[80px] rounded-l-lg overflow-hidden"},Ne=["src"],Re={class:"w-1/3 h-[80px] overflow-hidden"},qe=["src"],Ue={class:"w-1/3 h-[80px] rounded-r-lg overflow-hidden"},Ke=["src"],Ge={props:{storeInfo:{type:Object,default:()=>({})}},setup(s){const _=s,k=Q(),a=N(()=>{var y,f;return(y=_.storeInfo)!=null&&y.storeIcons?(f=_.storeInfo)==null?void 0:f.storeIcons.split(","):[]}),l=()=>{k.push(`/city/poi/storefront?storeId=${_.storeInfo.storeId}`)};return(y,f)=>{var e,u;return c(),b("div",{class:"w-full h-[158px] bg-white rounded-xl p-3 shadow-[0_0.5px_16px_0_rgba(0,0,0,0.16)]",onClick:l},[t("div",Fe,[t("div",$e,E(((e=s.storeInfo)==null?void 0:e.storeName)||""),1),Se]),t("div",Ee,[t("p",Me,E(((u=s.storeInfo)==null?void 0:u.storeAddress)||""),1)]),t("div",Be,[F(a).length===1?(c(),b("div",ze,[t("img",{src:F(a)[0],alt:"shop",class:"w-full h-full object-cover"},null,8,De)])):F(a).length===2?(c(),b(D,{key:1},[t("div",Oe,[t("img",{src:F(a)[0],alt:"shop",class:"w-full h-full object-cover"},null,8,Te)]),t("div",je,[t("img",{src:F(a)[1],alt:"shop",class:"w-full h-full object-cover"},null,8,Pe)])],64)):F(a).length===3?(c(),b(D,{key:2},[t("div",Ve,[t("img",{src:F(a)[0],alt:"shop",class:"w-full h-full object-cover"},null,8,Ne)]),t("div",Re,[t("img",{src:F(a)[1],alt:"shop",class:"w-full h-full object-cover"},null,8,qe)]),t("div",Ue,[t("img",{src:F(a)[2],alt:"shop",class:"w-full h-full object-cover"},null,8,Ke)])],64)):U("",!0)])])}}},Ze=G(Ge,[["__scopeId","data-v-4e2aafeb"]]),He={class:"swiper-card-container"},Je={class:"card-wrapper"},Qe={props:{cardData:{type:Array,default:()=>[]}},emits:["changeIndex"],setup(s,{expose:_,emit:k}){const a=d(null),l=d(0),y=e=>{l.value=e,k("changeIndex",e)};return _({activeIndex:l,updateActiveIndex:e=>{l.value=e,a.value&&a.value.swipeTo(e)}}),(e,u)=>{const p=P("van-swipe-item"),C=P("van-swipe");return c(),b("div",He,[M(C,{ref:(x,h)=>{h.swiperRef=x,a.value=x},active:l.value,"onUpdate:active":u[0]||(u[0]=x=>l.value=x),loop:!1,"show-indicators":!1,touchable:!0,class:"custom-swiper",onChange:y},{default:R(()=>[(c(!0),b(D,null,K(s.cardData,(x,h)=>(c(),j(p,{key:x.id,class:ne(["swipe-item",{right:l.value+1===h,left:l.value-1===h}])},{default:R(()=>[t("div",Je,[M(Ze,{"store-info":x},null,8,["store-info"])])]),_:2},1032,["class"]))),128))]),_:1},8,["active"])])}}},We=G(Qe,[["__scopeId","data-v-9448212a"]]),Xe="/Test-dev/static/images/poiMark-Bfylh7y_.png",Ye="/Test-dev/static/images/selectPoi-fT-hO_OO.png",et=new L.Icon({iconUrl:we,iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]}),ae=new L.Icon({iconUrl:Xe,iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]}),oe=new L.Icon({iconUrl:Ye,iconSize:[36,45],iconAnchor:[18,22.5],popupAnchor:[0,-22.5]}),tt=s=>(se("data-v-7f4f011b"),s=s(),le(),s),at={class:"w-full h-full relative"},ot=tt(()=>t("div",{id:"map",class:"w-full h-full relative z-0"},null,-1)),st={class:"absolute bottom-[12px] left-0 right-0 h-[158px] z-10"},lt={props:{storeList:{type:Array,default:()=>[]}},emits:["changeIndex"],setup(s,{expose:_,emit:k}){const a=s,{cityMapStore:l}=Z(),y=d(0),f=d(null);let e=null,u=[],p=null;const C=N(()=>l.locationCoords.lng&&l.locationCoords.lat?{lng:l.locationCoords.lng,lat:l.locationCoords.lat}:{lng:l.currentActiveCity.areaLongitude,lat:l.currentActiveCity.areaLatitude});ve(()=>a.storeList,()=>{a.storeList.length>0&&setTimeout(()=>{O(),I(),h(),x()},300)},{immediate:!0,deep:!0});const x=()=>{H.loading({message:"地图初始化...",duration:0});try{const o=C.value;e=L.map("map",{center:[o.lat,o.lng],zoom:12,trackResize:!0,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"",subdomains:"abcd",maxZoom:17,minZoom:7}).addTo(e)}catch{H.fail("地图初始化失败")}finally{H.clear()}},h=()=>{const o=a.storeList[y.value];o&&o.storeLatitude&&o.storeLongitude&&e.flyTo([o.storeLatitude,o.storeLongitude],15,{duration:.8,easeLinearity:1})},O=()=>{w(),a.storeList.forEach((o,i)=>{if(o.storeLatitude&&o.storeLongitude){const g=i===y.value?oe:ae,B=L.marker([o.storeLatitude,o.storeLongitude],{icon:g}).addTo(e);B.on("click",()=>{v(i,!0)}),u.push(B)}})},w=()=>{u.forEach(o=>{e&&e.removeLayer(o)}),u=[]},I=()=>{p&&e&&e.removeLayer(p);const o=C.value;if(o&&o.length>0){const i=o[0];i.lng&&i.lat&&(p=L.marker([i.lat,i.lng],{icon:et}).addTo(e))}},m=()=>{u.forEach((o,i)=>{const g=i===y.value?oe:ae;o.setIcon(g)})},v=(o,i=!1)=>{y.value=o,i&&f.value&&f.value.updateActiveIndex(o),k("changeIndex",o),h(),i?m():setTimeout(()=>{m()},600)},$=()=>{w(),p&&e&&(e.removeLayer(p),p=null),e&&(e.remove(),e=null)};return W(()=>{x()}),fe(()=>{$()}),_({initMap:x}),(o,i)=>(c(),b("div",at,[ot,U("",!0),t("div",st,[M(We,{ref:(g,B)=>{B.draggableCardListRef=g,f.value=g},"card-data":s.storeList,onChangeIndex:v},null,8,["card-data"])])]))}},nt=G(lt,[["__scopeId","data-v-7f4f011b"]]),rt={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},ct={class:"shop-content h-full ml-2 w-full"},ut={class:"w-full text-base text-b1 font-semibold flex items-center justify-between line-clamp-1"},it={class:"line-clamp-1"},dt={class:"text-sm text-b3 font-normal"},vt={class:"text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},ft={class:"engagement"},pt={class:"distance"},ht=X({props:{storeInfo:{default:{}},backgroundColor:{default:"#fff"}},setup(s){const _=s,k=Q();Z();const{distanceFormat:a}=Le(),l=N(()=>{var e;return((e=_.storeInfo)==null?void 0:e.goodsCategoryName1)||""}),y=N(()=>{var e,u;return(e=_.storeInfo)!=null&&e.areaName3?((u=_.storeInfo)==null?void 0:u.areaName3)+"区":""}),f=()=>{k.push(`/city/poi/storefront?storeId=${_.storeInfo.storeId}`)};return(e,u)=>{var C,x,h;const p=P("van-image");return c(),b("div",{class:"w-full h-[104px] rounded-xl p-3 mb-3 flex items-center justify-start",style:q({backgroundColor:s.backgroundColor}),onClick:f},[t("div",rt,[M(p,{width:"80",height:"80",fit:"cover",src:s.storeInfo.storeIcons?s.storeInfo.storeIcons.split(",")[0]:""},null,8,["src"]),M(Ce)]),t("div",ct,[t("div",ut,[t("span",it,E(((C=s.storeInfo)==null?void 0:C.storeName)||""),1)]),t("div",dt,E(F(l))+" "+E(F(y)),1),t("div",vt,[t("span",ft,E(((x=s.storeInfo)==null?void 0:x.addWantCountFlag)||0)+"人想要",1),t("span",pt,E(F(a)((h=s.storeInfo)==null?void 0:h.distance)),1)])])],4)}}}),mt={class:"w-full h-full bg-[#F2F0EF] px-3 pt-3 overflow-y-scroll"},gt={props:{storeList:{type:Array,default:()=>[]}},setup(s){return(_,k)=>{const a=P("van-list");return c(),b("div",mt,[M(a,{"finished-text":"没有更多了"},{default:R(()=>[(c(!0),b(D,null,K(s.storeList,l=>(c(),j(ht,{key:l.id,"store-info":l,"background-color":"#fff"},null,8,["store-info"]))),128))]),_:1})])}}},_t=["onClick"],yt={class:"mt-[-1px] pt-[1px] w-full h-fit max-h-[calc(100vh-50px-48px-32px)] overflow-y-scroll bg-white px-3"},xt=["onClick"],It=X({props:{modelValue:null},emits:["update:modelValue","change"],setup(s,{expose:_,emit:k}){var Y,ee,te;const a=re(),{cityMapStore:l}=Z(),y=N(()=>[{key:"goodsCategoryId1",label:p.value?f(u.value,p.value):"全部类型",isAct:e("goodsCategoryId1",p.value),loading:C.value},{key:"distance",label:w.value?f(O.value,w.value):"全部距离",isAct:e("distance",w.value)},{key:"areaId3",label:m.value?f(I.value,m.value):"全部区域",isAct:e("areaId3",m.value),loading:v.value}]),f=(r,S)=>{var T;return(T=r.find(n=>S==n.value))==null?void 0:T.label},e=(r,S)=>!!(i.value&&g.value===r)||S,u=d([]),p=d(((Y=a.query)==null?void 0:Y.categoryId)||null),C=d(!1),x=r=>{p.value=r},h=async()=>{var n;C.value=!0;const r={areaIdPreviousLastLeaf:(n=l.currentActiveCity)==null?void 0:n.areaId,overseasFlag:l.selectedCountry!=="cn"},{success:S,data:T}=await _e(r);C.value=!1,S&&(u.value=T?T.map(A=>({value:A.goodsCategoryId,label:A.goodsCategoryName,...A})):[],u.value.unshift({value:null,label:"全部类型"}))},O=d([{value:null,label:"全部距离"},{value:500,label:"500m"},{value:1e3,label:"1km"},{value:2e3,label:"2km"},{value:5e3,label:"5km"}]),w=d(((ee=a.query)==null?void 0:ee.distance)||null),I=d([]),m=d(((te=a.query)==null?void 0:te.area)||null),v=d(!1),$=async()=>{v.value=!0;const{success:r,data:S}=await ye();if(v.value=!1,!r)return;let n=xe(S,{idKey:"areaId",parentKey:"areaParentId",childrenKey:"children",rootId:"0"}).find(z=>{var V;return((V=l.currentActiveCity)==null?void 0:V.areaParentId)==z.areaId}),A=n==null?void 0:n.children.find(z=>{var V;return((V=l.currentActiveCity)==null?void 0:V.areaId)==z.areaId});I.value=A!=null&&A.children?A==null?void 0:A.children.map(z=>({value:z.areaId,label:z.areaExtName,...z})):[],I.value.unshift({value:null,label:"全部区域"})},o=d(null),i=d(!1),g=d(""),B=d([]),ce=r=>{if(g.value=="goodsCategoryId1")return p.value==r.value;if(g.value=="distance")return w.value==r.value;if(g.value=="areaId3")return m.value==r.value},ue=r=>{if(g.value===r&&i.value){i.value=!1;return}g.value=r,i.value=!0,i.value&&(g.value=="goodsCategoryId1"?B.value=u.value:g.value=="distance"?B.value=O.value:g.value=="areaId3"&&(B.value=I.value))};pe(o,()=>i.value=!1);const ie=r=>{g.value=="goodsCategoryId1"?p.value=r.value:g.value=="distance"?w.value=r.value:g.value=="areaId3"&&(m.value=r.value),i.value=!1,de(),k("change",g.value,r.value)},de=()=>{const r={goodsCategoryId1:p.value,distance:w.value,areaId3:m.value};k("update:modelValue",r)};return W(()=>{h(),$()}),_({setCategory1Act:x}),(r,S)=>{const T=P("van-loading");return c(),b("div",{class:"relative flex items-center gap-[3px]",ref:(n,A)=>{A.selectBox=n,o.value=n}},[(c(!0),b(D,null,K(F(y),(n,A)=>(c(),b("div",{class:ne(["shrink-0 flex justify-center items-center",`w-1/${F(y).length}`]),onClick:J(z=>n.loading?"":ue(n.key),["stop"]),key:n.key},[n.loading?(c(),j(T,{key:0,size:"20px"})):(c(),b(D,{key:1},[t("div",{class:"text-sm text-[#585654] font-normal",style:q(n.isAct?"color: #ff8812":"")},E(n.label),5),t("div",{class:"trapezoid shrink-0 ml-1.5",style:q(n.isAct?"border-top: 4px solid #ff8812":"")},null,4)],64))],10,_t))),128)),he(t("div",{class:"absolute top-[32px] z-[49] w-full h-[calc(100vh-50px-48px-32px)] bg-[rgba(0,0,0,0.5)]",onClick:S[0]||(S[0]=J(n=>i.value=!1,["stop"]))},[t("div",yt,[(c(!0),b(D,null,K(B.value,(n,A)=>(c(),b("div",{class:"mb-3 w-full text-sm text-[#585654]",style:q(ce(n)?"color:#FF8812;font-weight:600":""),key:n.value,onClick:J(z=>ie(n),["stop"])},E(n.label),13,xt))),128))])],512),[[me,i.value]])],512)}}}),bt=G(It,[["__scopeId","data-v-b7185d6c"]]),wt={class:"h-[calc(100vh-50px)] w-full overflow-hidden"},Ct={class:"px-3 pb-3"},Lt={class:"pb-3"},kt={class:"h-[calc(100%-48px-32px)] bg-[#F2F0EF]"},Tt=X({setup(s){const _=re(),k=Q(),{cityMapStore:a}=Z(),l=d(null),y=d(!1),f=d(_.query.mode||"map"),e=()=>{f.value=f.value==="map"?"list":"map",k.replace({query:{..._.query,mode:f.value}})},u=d({keyword:""}),p=()=>{O()},C=d({goodsCategoryId1:null,distance:null,areaId3:null}),x=(w,I)=>{let m={..._.query};w==="goodsCategoryId1"&&(m.categoryId=I),w==="distance"&&(m.distance=I),w==="areaId3"&&(m.area=I),m=Object.fromEntries(Object.entries(m).filter(([v,$])=>$)),k.replace({query:m}),O()},h=d([]),O=()=>{var w,I;y.value=!0,Ie({size:9999,storeNameLike:((w=u.value)==null?void 0:w.keyword)||null,overseasFlag:a.selectedCountry!=="cn",areaIdPreviousLastLeaf:((I=a.currentActiveCity)==null?void 0:I.areaId)||"3501",longitude:a.locationCoords.lng||null,latitude:a.locationCoords.lat||null,sortBy:a.locationCoords.lat&&a.locationCoords.lng?"asc|distance":null,...C.value}).then(m=>{var v;h.value=((v=m.data)==null?void 0:v.records)||[]}).finally(()=>{y.value=!1})};return W(()=>{O()}),(w,I)=>{const m=P("router-view");return c(),b(D,null,[M(m,{class:"z-10 relative"}),M(ge,{title:"城市地图",class:"bg-white font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(v,$)=>{$.searchRef=v}},{right:R(()=>[t("div",{class:"text-sm font-normal text-b2",onClick:e},E(f.value==="map"?"列表模式":"地图模式"),1)]),default:R(()=>[t("div",wt,[t("div",Ct,[M(ke,{modelValue:u.value.keyword,"onUpdate:modelValue":I[0]||(I[0]=v=>u.value.keyword=v),placeholder:"请输入店铺名称","search-button-text":"搜索",onSearch:p},null,8,["modelValue"])]),t("div",Lt,[M(bt,{modelValue:C.value,"onUpdate:modelValue":I[1]||(I[1]=v=>C.value=v),onChange:x,ref:(v,$)=>{$.storeFilterRef=v,l.value=v}},null,8,["modelValue"])]),t("section",kt,[h.value&&h.value.length===0&&!y.value?(c(),j(be,{key:0,class:"!bg-transparent",name:"暂无门店"})):U("",!0),f.value==="map"?(c(),b(D,{key:1},[h.value&&h.value.length>0?(c(),j(nt,{key:0,storeList:h.value,ref:(v,$)=>{$.mapRef=v}},null,8,["storeList"])):U("",!0)],64)):(c(),j(gt,{key:2,storeList:h.value},null,8,["storeList"]))])])]),_:1},512)],64)}}});export{Tt as default};
