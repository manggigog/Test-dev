import{y as N,E as G,F as c,G as n,I as R,J as j,R as W,K as h,a2 as F,H as D,Q as k,w as Z,a1 as ee,l as te,r as v,x as y,z as ae,D as le,O as b,P as r,N as oe,X as ue,bq as ne}from"./vendor-CjApaIpB.js";import{_ as se}from"./GoodsEvaluateItem-ClgsLkZq.js";import{_ as I}from"./DefaultPage-Hj08n-wV.js";import{_ as ie}from"./EvalHeader-C_PCVdjb.js";import{a5 as V,g as L,bj as ve,bk as re,aU as de}from"./index-CduCwCyL.js";import"./BackIcon-D2Vm_lyR.js";const ce={class:"flex items-center gap-2 overflow-x-auto"},me=["onClick"],fe={key:1},ge=N({props:{list:null,value:null},emits:["change"],setup(x,{emit:g}){return(C,A)=>{const d=G("van-icon");return n(),c("div",ce,[(n(!0),c(R,null,j(x.list,u=>(n(),c("div",{class:W(["flex items-center flex-shrink-0 px-2 text-sm leading-6 rounded",{" bg-primary text-white":x.value===u.id,"bg-yellow-004":x.value!==u.id}]),key:u.id,onClick:a=>g("change",u.id)},[u.id===1?(n(),h(d,{key:0,class:"mr-1.5",name:"photo-o",size:"16"})):F("",!0),D("span",null,k(u.name),1),u.id?(n(),c("span",fe,"("+k(u.count)+")",1)):F("",!0)],10,me))),128))])}}}),pe={class:"px-2.5 font-normal"},he={class:"bg-white rounded-xl p-2.5 min-h-[calc(100%-44px)]"},Ce=N({name:"EvaluateGood"});function ye(x){const{t:g}=Z(),C=ee(),A=te(),d=v(null),u=v(null),a=v({}),q=async()=>{const e={goodsId:u.value},t=await ve(e);t.success&&(a.value=t.data)},l=v(null),z=y(()=>{var t,o,f;let e=0;switch(l.value){case 1:e=0;break;case 2:e=(t=a.value)==null?void 0:t.goodNoPicAndTextCount;break;case 3:e=(o=a.value)==null?void 0:o.badNoPicAndTextCount;break;default:e=(f=a.value)==null?void 0:f.noPicAndTextCount;break}return e}),S=y(()=>{const e={goodsId:u.value,shopId:d.value,commentLevel:l.value};return"?"+Object.keys(e).map(t=>e[t]?`${t}=${e[t]}`:"").filter(t=>t).join("&")}),U=y(()=>{var e,t,o;return[{id:null,name:g("common.all"),count:H.value},{id:1,name:g("evaluate.picture"),count:((e=a.value)==null?void 0:e.havePicsCount)||0},{id:2,name:g("evaluate.Good reviews"),count:((t=a.value)==null?void 0:t.goodCount)||0},{id:3,name:g("evaluate.Bad review"),count:((o=a.value)==null?void 0:o.badCount)||0}]}),M=e=>{l.value!==e&&(l.value=e,O())},p=v(!1),m=v(!1),s=v([]),w=v(0),Y=v(20),_=v(0),H=y(()=>{var e,t,o,f,i,$,T;if(l.value===null)return(((e=a.value)==null?void 0:e.goodCount)||0)+(((t=a.value)==null?void 0:t.badCount)||0);switch(l.value){case 1:return((o=a.value)==null?void 0:o.havePicsCount)||0;case 2:return((f=a.value)==null?void 0:f.goodCount)||0;case 3:return((i=a.value)==null?void 0:i.badCount)||0;default:return((($=a.value)==null?void 0:$.goodCount)||0)+(((T=a.value)==null?void 0:T.badCount)||0)}}),J=async()=>{p.value=!0;const e=l.value,t={page:w.value,size:Y.value,goodsId:u.value||null,shopId:d.value||null,commentStatus:1,commentType:null,sortBy:"desc|comment_time",havePicsFlag:null,haveContentFlag:null,havePicOrTextFlag:null};l.value==null&&(t.havePicOrTextFlag=!0),l.value==1&&(t.havePicsFlag=!0),l.value==2&&(t.commentType=2,t.havePicOrTextFlag=!0),l.value==3&&(t.commentType=1,t.havePicOrTextFlag=!0),Reflect.deleteProperty(t,"commentLevel");const o=await de(t);if(p.value=!1,!o.success){m.value=!0;return}if(!o.data||!o.data.total){m.value=!0;return}if(e!==l.value){m.value=!0;return}s.value=w.value===1?o.data.records:s.value.concat(o.data.records),_.value=o.data.total,s.value.length>=_.value&&(m.value=!0)},B=y(()=>{if(s.value&&s.value.length>0){const e=[];for(let t=0;t<s.value.length;t++)s.value[t].commentPics&&s.value[t].commentPics.length>0&&e.push(...s.value[t].commentPics.split(","));return e}return[]}),K=e=>{const t=B.value.findIndex(o=>o===e);ne({images:B.value,closeable:!0,showIndex:!0,startPosition:t})},E=async()=>{w.value+=1,await J()},O=()=>{s.value=[],w.value=0,_.value=0,m.value=!1,p.value=!1,E()},Q=async()=>{l.value=null,await q(),O()},P=e=>{A.push(e)};ae(()=>C.query.goodsId,e=>{C.path.includes("/offline-evaluate-home?goodsId=")&&u.value!==e&&u.value&&(u.value=e,Q())},{deep:!0,immediate:!0});const X=async()=>{const e={shopId:d.value},t=await re(e);t.success&&(a.value=t.data)};return le(()=>{u.value=C.query.goodsId,d.value=C.query.shopId,u.value&&q(),d.value&&X()}),(e,t)=>{const o=G("VanList"),f=G("router-view");return n(),c("div",pe,[b(ie,{title:d.value?e.$t("evaluate.shop review"):e.$t("evaluate.service review")},null,8,["title"]),D("div",he,[b(ge,{list:r(U),value:l.value,onChange:M},null,8,["list","value"]),l.value===2&&a.value.defaultGoodCount>0&&a.value.defaultGoodCount===a.value.goodCount?(n(),h(I,{key:0,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:r(L)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:r(V)(a.value.defaultGoodLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):l.value===null&&a.value.defaultGoodCount>0&&a.value.defaultGoodCount===a.value.totalCount?(n(),h(I,{key:1,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:r(L)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:r(V)(a.value.defaultGoodLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):!s.value.length&&r(z)>0?(n(),c("div",{key:2,class:"py-8 text-sm text-center",onClick:t[0]||(t[0]=i=>P("/offline-evaluate-default"+r(S)))},k(e.$t("evaluate.without content",{num:r(z)})),1)):m.value&&_.value===0?(n(),h(I,{key:3,needTextTop:!0,titleColor:"#A45E00",url:r(L)("images/evaluate_empty.png"),title:e.$t("evaluate.No reviews yet"),top:"9rem",iconSize:"16rem"},null,8,["url","title"])):(n(),h(o,{key:4,class:"mt-4",loading:p.value,"onUpdate:loading":t[2]||(t[2]=i=>p.value=i),finished:m.value,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:E},{default:oe(()=>[(n(!0),c(R,null,j(s.value,(i,$)=>(n(),h(se,{onImgPre:K,style:ue($===s.value.length-1?"margin-bottom: 1rem":""),onClick:T=>P(`/offlineEvaluateView?id=${i.orderId}`),data:i,key:i.id},null,8,["style","onClick","data"]))),128)),!p.value&&(l.value===null&&a.value.noPicAndTextCount>0||l.value===2&&a.value.goodNoPicAndTextCount>0||l.value===3&&a.value.badNoPicAndTextCount>0)?(n(),c("div",{key:0,class:"text-sm text-center",onClick:t[1]||(t[1]=i=>P("/offline-evaluate-default"+r(S)))},k(e.$t("evaluate.without content",{num:l.value===null?a.value.noPicAndTextCount:a.value.goodNoPicAndTextCount})),1)):F("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"]))]),b(f,{class:"child-view bg-[#f2f0ef]"})])}}const Te=N({...Ce,setup:ye});export{Te as default};
