import{_ as _e,y as we,F as c,G as a,a2 as F,P as t,I as w,a0 as f,Q as i,X as Fe,R as b,w as Me,x as P,r as S,bf as Ee,be as D,bj as Ne,D as ze,E as _,K as k,N as y,H as n,O as g,J as ge,a4 as Ae,$ as Oe,B as ve,Y as Ue,Z as Pe}from"./vendor-BUT0HZ5j.js";import{_ as Re}from"./member-BMygrgIC.js";import{S as je}from"./SkewCard-E8FQjhIJ.js";import{S as qe}from"./shop-CeqcS6K2.js";import{e as Ke,g as ke,b as Xe,d as Ge,V as be,r as He,bl as Je}from"./index-hbwLMIYO.js";import{b as Qe}from"./beiExtRewardContract-fse9Uuj3.js";import{q as Ye,c as Ze}from"./beiRanking-Box3y7-H.js";import{b as We}from"./beiConstContract-FoR-pg6c.js";const et={key:0},tt=f("普通店铺"),st=we({props:{type:null,width:{default:125}},setup(d){return(v,M)=>(a(),c("div",{class:b(["tag-box text-right text-white font-semibold pr-5 pt-1 h-[75px] min-w-[120px]",`bg-${d.type||0}`]),style:Fe({width:`${d.width}px`})},[d.type!==void 0?(a(),c("span",et,[d.type===t(qe).SD?(a(),c(w,{key:0},[tt],64)):(a(),c(w,{key:1},[f(i(v.$t(`common.shop_type_${d.type}`))+"店铺",1)],64))])):F("",!0)],6))}}),ot=_e(st,[["__scopeId","data-v-ea5a823e"]]),I=d=>(Ue("data-v-d0967bf6"),d=d(),Pe(),d),nt={class:"relative m-auto text-sm font-normal font-Puhui"},it={class:"relative z-0 p-3"},at={class:"flex items-center gap-x-2"},lt={class:"relative"},ct={class:"-mt-5 w-[40px] border-[1px] border-solid border-white flex-center bg-yellow rounded-3xl mx-auto relative z-10"},rt=I(()=>n("img",{src:Re,class:"w-4 h-4"},null,-1)),dt={class:"text-sm"},ut={class:"flex flex-col gap-1 flex-1"},ft={class:"text-base font-semibold line-clamp-1 name-width"},mt={class:"text-b3 flex items-center"},pt=["src"],ht=I(()=>n("span",{class:"mx-1"},"|",-1)),gt={class:"w-full h-[40px] bg-b5 rounded-full p-0.5 mt-4"},vt={class:"w-full h-full relative"},kt={class:"absolute w-full h-full flex items-center justify-center left-0 top-0"},bt=["onClick"],_t={class:"mt-4 flex items-center bg-b5 p-3 rounded-[10px]"},wt={class:"flex items-center gap-x-3"},xt=["onClick"],yt={class:"text-b3 mt-1 flex items-center"},It={key:0,class:"text-left text-b3 font-normal"},Ct={class:"flex items-center"},Bt=I(()=>n("span",{class:"text-success"},"充电：",-1)),$t=f("预计系数"),Lt={key:1},Tt=f("/电量+"),Vt={key:3},St={class:"flex items-center"},Dt=I(()=>n("span",{class:"text-error"},"放电：",-1)),Ft=f("预计系数"),Mt={key:1},Et=f("/电量-"),Nt={key:3},zt={key:1,class:"flex items-center"},At=I(()=>n("span",null,"测算结果",-1)),Ot=[At],Ut={class:"flex-center-bw mt-4 gap-x-3"},Pt=f("放电"),Rt=we({props:{show:{type:Boolean},shopId:null,teleport:null},emits:["close","voteSuccess","handleTo"],setup(d,{emit:v}){const{show:M,shopId:R,teleport:jt}=d,{t:j}=Me(),{contributesStore:E}=Ke(),{userVoteDetailView:xe,voteMonthTimestampView:ye}=Qe(),{userTotalLp:Ie}=We(),{loadingToggle:N}=He(),C=P(()=>[{id:1,text:j("ranking.points_ticket")},{id:2,text:j("ranking.lp_ticket")}]),r=S(null),Ce=[.25,.5,.75],s=Ee({tab:1,votesInfo:{1:{total:0,sumUsed:0},2:{total:0,sumUsed:0}},estimateInfo:{coefficient:1,coefficientLikeBudget:1,coefficientNotLikeBudget:1,score:0,scoreLikeBudget:0,scoreNotLikeBudget:0,likeDiffer:0,notlikeDiffer:0,tickets:0},totalTimes:5,rewardTimes:5}),B=P(()=>s==null?void 0:s.votesInfo[s.tab]),q=P(()=>{var o;return Math.max(((o=B.value)==null?void 0:o.total)-(B==null?void 0:B.value.sumUsed),0)}),p=S(null),K=S(null),X=S(null),[h,z]=D(!0),[$,qt]=D(!1),[G,H]=D(!1),[L,J]=D(!1),Q=o=>{h.value||$.value||(p.value=Math.floor(new ve(q.value).times(o).toNumber()))},A=()=>{N(!1),v("close")},Be=o=>{+s.tab!=+o&&(p.value=null,s.estimateInfo.tickets=0,s.tab=o)},Y=(o,e,u)=>{const m=Math.abs(Number(new ve(o).minus(e)));return m<1e-4?"<0.0001":`${u}${m.toFixed(4)}`},$e=async()=>{const{result:o}=await ye();X.value=+o.thisMonthTime},Le=async()=>{N(!0);const{success:o,data:e}=await Ye({shopId:R,month:Je()});o&&(N(!1),r.value=e)},Te=async()=>{var u,m;if(s.tab===1)return;if(p.value<=0){s.estimateInfo.tickets=0;return}J(!0);const{success:o,data:e}=await Ze(R,p.value);o&&(s.estimateInfo=e,s.estimateInfo.tickets=p.value,s.estimateInfo.likeDiffer=Math.abs((e==null?void 0:e.scoreLikeBudget)-((u=r.value)==null?void 0:u.score)),s.estimateInfo.notlikeDiffer=Math.abs((e==null?void 0:e.scoreNotLikeBudget)-((m=r.value)==null?void 0:m.score)),J(!1))},Ve=async()=>{var o;console.log(+s.rewardTimes,+s.totalTimes),v("close"),v("voteSuccess",{direct:200,differ:p.value*((o=r.value)==null?void 0:o.coefficient)},+s.rewardTimes<+s.totalTimes)},Z=async o=>{var e,u,m,T;v("close"),v("voteSuccess",{direct:o,differ:o===200?(e=s.estimateInfo)==null?void 0:e.likeDiffer:(u=s.estimateInfo)==null?void 0:u.notlikeDiffer,score:o===200?(m=s.estimateInfo)==null?void 0:m.scoreLikeBudget:(T=s.estimateInfo)==null?void 0:T.scoreNotLikeBudget})},Se=async()=>{z(!0),await $e();const{success:o,result:e}=await xe(X.value);s.rewardTimes=+(e==null?void 0:e.times),s.votesInfo[1]={total:Math.min(Math.floor(E.contributes/1e3),500),sumUsed:+(e==null?void 0:e.sumTickets)},console.log("rewardTimes :",+(e==null?void 0:e.times)),console.log("contributes :",E.contributes),console.log("sumTickets :",+(e==null?void 0:e.sumTickets)),console.log("votesInfo:",s.votesInfo[1]),o&&z(!1);const u=Math.floor(+await Ie());z(!1),s.votesInfo[2]={total:+u,sumUsed:+(e==null?void 0:e.sumLp)}},W=o=>{(o.key==="Enter"||o.key==="Escape")&&K.value.blur()};return Ne(()=>{window.removeEventListener("keydown",W)}),ze(async()=>{window.addEventListener("keydown",W),Le(),await E.fetchContributes(),Se()}),(o,e)=>{const u=_("van-icon"),m=_("VanImage"),T=_("VanField"),x=_("VanLoading"),O=_("VanButton"),De=_("VanPopup");return a(),k(De,{show:d.show,"onUpdate:show":e[6]||(e[6]=V=>Oe(M)?M.value=V:null),teleport:d.teleport,onClickOverlay:Ae(A,["stop"]),onClose:A,round:"",class:"bg-transparent position-center",style:{"min-width":"280px","max-width":"350px",width:"85%"}},{default:y(()=>[n("div",nt,[n("div",{class:"text-right text-b6 ml-auto text-lg font-bold h-6 flex items-start justify-end",onClick:A},[g(u,{name:"cross"})]),g(je,{width:"210",right:"26"},{default:y(()=>{var V,ee,te,se,oe,ne,ie,ae,le,ce,re,de,ue,fe,me,pe,he;return[g(ot,{class:"absolute right-1.5 top-1.5 -z-20",type:(V=r.value)==null?void 0:V.type},null,8,["type"]),n("div",it,[n("div",at,[n("div",lt,[g(m,{round:"",src:(((ee=r.value)==null?void 0:ee.logo)||"").split(",")[0],errorIcon:t(ke)("images/ranking/noPosition.png"),fit:"cover",width:"46px",height:"46px"},null,8,["src","errorIcon"]),n("div",ct,[rt,n("span",dt,"V"+i((te=r.value)==null?void 0:te.memberLevel),1)])]),n("div",ut,[n("div",ft,i((se=r.value)==null?void 0:se.storeName),1),n("div",mt,[n("span",null,i(t(Xe)((oe=r.value)==null?void 0:oe.shopAddress,"**",0,4)),1),(ne=r.value)!=null&&ne.authorizeAddress?(a(),c("img",{key:0,src:t(ke)("images/ranking/auth.svg"),class:"w-4 h-4"},null,8,pt)):F("",!0),ht,n("span",null,i(o.$t("ranking.battery"))+i(((ie=r.value)==null?void 0:ie.score)||0),1),n("div",{class:"text-newOrigin pl-1",onClick:e[0]||(e[0]=l=>t(H)(!t(G)))},i(o.$t("user.feedbackDetail")),1)])])]),n("div",{class:b(["bg-[#FF88121F] text-newOrigin rounded px-2 flex items-center justify-between overflow-hidden transition-all duration-300",t(G)?"h-[36px] border border-newOrigin mt-1":"h-0 mt-0"]),onClick:e[1]||(e[1]=l=>t(H)(!1))},[n("div",null,i(+((ae=r.value)==null?void 0:ae.pointTicket))+i(o.$t("ranking.points_ticket"))+" x "+i(t(Ge)((le=r.value)==null?void 0:le.coefficient))+i(o.$t("ranking.coefficient"))+" = "+i((ce=r.value)==null?void 0:ce.score)+i(o.$t("ranking.battery")),1),n("div",null,[g(u,{name:"cross"})])],2),n("div",gt,[n("div",vt,[n("div",{class:b(["absolute w-[50%] h-full bg-b1 rounded-full left-0 transition-all duration-300",`w-[${100/t(C).length}%] left-${t(C).findIndex(l=>l.id===t(s).tab)||0}/${t(C).length}`])},null,2),n("div",kt,[(a(!0),c(w,null,ge(t(C),l=>(a(),c("div",{class:"w-[50%] h-full flex items-center justify-center overflow-hidden",onClick:U=>Be(l.id),key:l.id},[n("span",{class:b(["text-sm text-center line-clamp-1 transition-all duration-300",[t(s).tab===l.id?"text-b6 font-semibold":"text-b3 font-normal"]])},i(l.text),3)],8,bt))),128))])])]),n("div",_t,[g(T,{type:"digit",modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l),placeholder:"0",ref:(l,U)=>{U.amountInputRef=l,K.value=l}},null,8,["modelValue"]),n("div",wt,[t(s).tab===1?(a(),c(w,{key:0},ge(Ce,l=>n("div",{class:"shrink-0 w-fit text-newOrigin px-0.5",key:l,onClick:U=>Q(l)},i(l*100)+"% ",9,xt)),64)):F("",!0),n("div",{class:"shrink-0 w-fit text-newOrigin",onClick:e[3]||(e[3]=l=>Q(1))}," MAX ")])]),n("div",yt,[+t(s).tab==2&&((re=t(s).estimateInfo)==null?void 0:re.tickets)>0?(a(),c("div",It,[n("div",Ct,[Bt,$t,t(L)?(a(),k(x,{key:0,size:"12"})):(a(),c("span",Lt,i(Y((de=t(s).estimateInfo)==null?void 0:de.coefficientLikeBudget,(ue=t(s).estimateInfo)==null?void 0:ue.coefficient,"+")),1)),Tt,t(L)?(a(),k(x,{key:2,size:"12"})):(a(),c("span",Vt,i((fe=t(s).estimateInfo)==null?void 0:fe.likeDiffer),1))]),n("div",St,[Dt,Ft,t(L)?(a(),k(x,{key:0,size:"12"})):(a(),c("span",Mt,i(Y((me=t(s).estimateInfo)==null?void 0:me.coefficientNotLikeBudget,(pe=t(s).estimateInfo)==null?void 0:pe.coefficient,"-")),1)),Et,t(L)?(a(),k(x,{key:2,size:"12"})):(a(),c("span",Nt,i((he=t(s).estimateInfo)==null?void 0:he.notlikeDiffer),1))])])):(a(),c("div",zt,[f(i(o.$t("ranking.remain_ticket")),1),t(h)?(a(),k(x,{key:0,size:"10"})):(a(),c(w,{key:1},[f(i(t(q)),1)],64)),f(i(t(s).tab===1?o.$t("ranking.points_ticket"):o.$t("ranking.lp_ticket")),1)])),t(s).tab===2&&p.value>0?(a(),c("div",{key:2,class:"pl-1.5 ml-auto text-newOrigin",onClick:Te},Ot)):F("",!0)]),n("div",Ut,[t(s).tab===1?(a(),k(O,{key:0,class:b(["btn-yellow w-full h-[46px] rounded-full border-none text-base font-semibold",{"opacity-60":t(h)}]),onClick:Ve,disabled:t(h),loading:t($)},{default:y(()=>[f(i(o.$t("ranking.power")),1)]),_:1},8,["class","disabled","loading"])):(a(),c(w,{key:1},[g(O,{class:b(["bg-error text-b6 w-full h-[46px] rounded-full border-none text-base font-semibold",{"opacity-60":t(h)}]),icon:t(be)("discharge.svg"),disabled:t(h),loading:t($),onClick:e[4]||(e[4]=l=>Z(400))},{default:y(()=>[Pt]),_:1},8,["class","icon","disabled","loading"]),g(O,{class:b(["bg-success text-b6 w-full h-[46px] rounded-full border-none text-base font-semibold",{"opacity-60":t(h)}]),icon:t(be)("charge.svg"),disabled:t(h),loading:t($),onClick:e[5]||(e[5]=l=>Z(200))},{default:y(()=>[f(i(o.$t("ranking.power")),1)]),_:1},8,["class","icon","disabled","loading"])],64))])])]}),_:1})])]),_:1},8,["show","teleport","onClickOverlay"])}}}),Wt=_e(Rt,[["__scopeId","data-v-d0967bf6"]]);export{Wt as S,ot as a};
