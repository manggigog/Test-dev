import{_ as U,z as L,q as z,x as H,r as F,bl as G,y as M,o as E,F as c,G as v,H as d,I as g,P as l,$ as p,Q as S,J as T,K as I,Z as _,O as r,U as J,a3 as Q,a4 as Z,T as j}from"./vendor-Dr_RpJ_Y.js";import{D as W}from"./DeliveredItem-DOOh3Z4f.js";import{B as X}from"./BackIcon-CDrGaEPo.js";import{C as Y}from"./ChangeRegion-CWmxWHoW.js";import{l as ee}from"./luckyShopContract-DfZqYfy3.js";import{u as te,a as ae,V as se,a8 as oe,bo as ie}from"./index-7OiUoGXy.js";import"./avatarRing-CLGxkH-F.js";import"./address-AoifhxGN.js";import"./GoodsItem-D3IDBieu.js";import"./useOrderStatus-CUBDjZMz.js";import"./ChangeRegionPop-BFcmEqdg.js";const ne={class:"relative"},re={class:"px-3 bg-[#f2f0ef] pb-1 parent-view"},ce={class:"gap-2 pt-2 flex-start bg-[#f2f0ef]"},de={class:"ml-2 text"},le={class:"text-right"},pe=L({name:"SellerOneSaleOrder"});function ue(fe){const{getCurrentStoreId:B}=te(),N=z(),{accountStore:w}=ae(),{merchantForceReceived:O,commodityBatch:K}=ee(),{getMerchantDhKey:x,decryptAddressKey:R,decryptKey:b}=se(),{t:h}=H(),A=F(""),e=G({active:1,page:0,size:10,finished:!1,list:[],loading:!1,total:0,tempList:[],nowTime:null}),C=M(()=>[{id:1,name:h("order.wait")},{id:-1,name:h("order.all")}]),D=a=>{N.replace({path:"sellerOneSaleOrder",query:{type:3,active:a}}),e.active=a,$()},$=()=>{e.page=0,e.finished=!1,e.list=[],V()},V=async()=>{e.loading=!0,e.page+=1,e.nowTime=await oe(),await q(),e.loading=!1},q=async()=>{var m,f;const a={page:e.page,size:e.size,status:(m=C.value[e.active])==null?void 0:m.id,type:2,keyword:A.value,shopId:(f=await B())==null?void 0:f.id};e.active===1&&(a==null||delete a.status);const o=await ie(a);if(!o.success||!o.data||!o.total){e.finished=!0;return}e.total=o.total;const y=["receiverCity","receiverCounty","receiverDetailInfo","receiverProvince","receiverPhone","receiver","postscript"];for(let n=0;n<o.data.length;n++){const s=o.data[n];if(s.submitHash){const i=await x(s.address,s.submitUserPubKey);i&&(o.data[n]=R(s,i,y))}if(s.shippingHash){const i=await x(s.address,s.shippingUserPubKey);if(i){const t=b(s.expressNo,i);t.hash===s.shippingHash&&(s.expressNo=t.decrypt,s.expressCompany=b(s.expressCompany,i).decrypt)}}}const u=await K(o.data.map(n=>n.odGoodsId));e.tempList=(o.data||[]).map((n,s)=>{var i,t;return{nextActionTime:(i=u[s])==null?void 0:i.nextActionTime,commitStatus:(t=u[s])==null?void 0:t.status,...n,loading:!1}}),e.list=e.page===1?e.tempList:e.list.concat(e.tempList),e.list.length>=e.total&&(e.finished=!0)},k=E();k.query.active&&(e.active=Number(k.query.active));const P=async a=>{if(w.isOnlyView)return j(h("order.Requires merchant account operation"));a.loading=!0;const o=await O(a.odGoodsId);a.loading=!1,o.success&&(a.commitStatus=200)};return(a,o)=>{const y=c("VanSticky"),u=c("VanButton"),m=c("VanList"),f=c("VanTab"),n=c("VanTabs"),s=c("router-view");return d(),v("div",ne,[g("div",re,[l(y,null,{default:p(()=>[g("div",ce,[l(X),g("div",de,S(a.$t("order.onesale order")),1),l(Y,{showIcon:!0,showDownIcon:!1,class:"ml-auto bg-gray1 px-2 rounded-[20px] border-2 border-solid border-white",style:{"box-shadow":"0px 0px 15px 0px rgba(51, 47, 42, 0.3) inset"}})])]),_:1}),l(n,{active:r(e).active,"onUpdate:active":o[1]||(o[1]=i=>r(e).active=i),onChange:D,background:"#f2f0ef",sticky:"","offset-top":"44"},{default:p(()=>[(d(!0),v(T,null,I(r(C),i=>(d(),_(f,{title:i.name,key:i.id},{default:p(()=>[l(m,{class:"mt-2.5",loading:r(e).loading,"onUpdate:loading":o[0]||(o[0]=t=>r(e).loading=t),finished:r(e).finished,"finished-text":a.$t("common.noMore"),"loading-text":a.$t("common.loading"),onLoad:V},{default:p(()=>[(d(!0),v(T,null,I(r(e).list,t=>(d(),_(W,{key:t.id,order:t},{default:p(()=>[g("div",le,[!r(w).isOnlyView&&r(e).nowTime>(t==null?void 0:t.nextActionTime)&&(t==null?void 0:t.commitStatus)===40?(d(),_(u,{key:0,round:"",class:"btn-orange h-[37px] px-9 text-white text-sm font-semibold",onClick:Q(ge=>P(t),["stop"]),loading:t.loading},{default:p(()=>[Z(S(a.$t("order.forced receipt")),1)]),_:2},1032,["onClick","loading"])):J("",!0)])]),_:2},1032,["order"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),l(s,{class:"child-view"})])}}const me=L({...pe,setup:ue}),Te=U(me,[["__scopeId","data-v-6497016d"]]);export{Te as default};
