import{z as G,G as m,H as n,J as D,K as H,a3 as ue,N as de,Q as C,F as M,I as a,P as N,Z as $,U as V,a4 as ve,O as k,V as fe,_ as te,r as f,bn as he,$ as se,q as me,o as pe,x as _e,y as z,D as ge,E as ye,bj as be,bt as Ce,bv as we,X as xe,Y as ke}from"./vendor-Dr_RpJ_Y.js";import{_ as Le}from"./search-B34EARrH.js";import{_ as Se}from"./delete-Dyula9w6.js";import{B as $e}from"./BackIcon-CDrGaEPo.js";import{B as Ie}from"./BetweenTab-nGcUWfRT.js";import{H as ae}from"./HomeGoodsItem-zctDMTO8.js";import{O as Ae}from"./OfflineMerchantLabel-Cz248kz6.js";import{u as oe}from"./useCityMap-gT1oK5g9.js";import{a as K,aU as le,B as Fe,aE as Ee}from"./index-CU2nzZe6.js";/* empty css                                                               */import"./MCOIN-BOqZVkND.js";import"./store-CbLb3G6E.js";import"./RatioBox-BwMA7vB_.js";import"./ImgBoutiqueLable-B-2xCcw4.js";import"./shop-CeqcS6K2.js";const Ne={class:"flex flex-wrap items-center gap-3"},Ve=["onClick"],Oe=G({props:{modelValue:null,options:null},emits:["update:modelValue","change"],setup(r,{emit:y}){function h(e){y("update:modelValue",e.value),y("change",e.value)}return(e,w)=>(n(),m("div",Ne,[(n(!0),m(D,null,H(r.options,(c,v)=>(n(),m("div",{class:de(["w-fit h-[32px] px-3 py-1.5 rounded-md text-sm flex justify-center items-center",r.modelValue===c.value?"bg-[#FFF8EC] text-[#FF8812] border-solid border border-[#FF8812]":"bg-[#F5F5F5]  text-[#585654]"]),key:c.value??v,onClick:ue(l=>h(c),["stop"])},C(c.label),11,Ve))),128))]))}}),Be={class:"shop-img w-[80px] h-[80px] rounded-lg overflow-hidden flex-shrink-0 relative"},Re={class:"shop-content h-full ml-2 w-full"},Te={class:"w-full text-base text-b1 font-semibold flex items-center justify-between"},De={class:"line-clamp-1"},Pe={class:"text-sm text-b3 font-normal"},je={class:"h-[20px] text-sm text-b3 font-normal mt-[18px] flex items-center justify-between"},qe={class:"engagement"},Me={key:0,class:"distance"},Ue={props:{backgroundColor:{type:String,default:""},store:{type:Object,default:()=>({})}},setup(r){const{distanceFormat:y}=oe(),{cityMapStore:h}=K();return(e,w)=>{var v,l,u,b,I,d,i;const c=M("van-image");return n(),m("div",{class:"w-full rounded-xl flex items-center justify-start",style:fe({backgroundColor:r.backgroundColor})},[a("div",Be,[N(c,{width:"80",height:"80",fit:"cover",src:(((v=r.store)==null?void 0:v.storeIcons)||"").split(",")[0]},null,8,["src"]),+((l=r.store)==null?void 0:l.storeGoodsCount)>0?(n(),$(Ae,{key:0})):V("",!0)]),a("div",Re,[a("div",Te,[a("span",De,C(((u=r.store)==null?void 0:u.storeName)||""),1)]),a("div",Pe,C(((b=r.store)==null?void 0:b.goodsCategoryName3)||"")+" "+C(r.store.areaExtName3||""),1),a("div",je,[a("span",qe,[+((I=r.store)==null?void 0:I.wantCount)?(n(),m(D,{key:0},[ve(C(e.$t("city.xx people want",{val:r.store.wantCount})),1)],64)):V("",!0)]),(d=k(h).locationCoords)!=null&&d.lng&&((i=k(h).locationCoords)!=null&&i.lat)?(n(),m("span",Me,C(k(y)(r.store.distance,e.$t("city.Distance from you"))),1)):V("",!0)])])],4)}}},ze="/static/images/search-recommend-DZW-4urq.svg",Ge={class:"font-Puhui"},He={key:0,class:"mb-4 flex justify-center items-center gap-3"},Ke=he('<div class="line-left" data-v-39ee5196></div><div class="flex items-center gap-0.5" data-v-39ee5196><img src="'+ze+'" class="w-4 h-4" data-v-39ee5196><div class="text-sm text-b3 font-normal" data-v-39ee5196>大家都在搜</div></div><div class="line-right" data-v-39ee5196></div>',3),Ze=[Ke],Je=G({props:{keyword:null,sortAct:null},emits:["onDetail"],setup(r,{emit:y}){const h=r,{cityMapStore:e}=K(),w=f(!1),c=f(0),v=f(20),l=f(!1),u=f([]),b=async()=>{w.value=!0,c.value+=1,l.value=!1,await I(),w.value=!1},I=async()=>{var P,R,F,E;let d={goodsStatus:1,goodsNameLike:null,notBelongAreaIdPreviousLastLeaf:((P=e.currentActiveCity)==null?void 0:P.areaId)||"",overseasFlag:((R=e.currentActiveCity)==null?void 0:R.overseasFlag)||!1};h.keyword&&(d.goodsNameLike=h.keyword);let i=[h.sortAct];h.sortAct!=="asc|distance"&&i.push("asc|distance"),i.push("asc|goods_id");let O=i.length?i.join(","):null;const _={deleteFlag:!1,page:c.value,size:v.value,...d,longitude:e.locationCoords.lng||((F=e.currentActiveCity)==null?void 0:F.areaLongitude)||null,latitude:e.locationCoords.lat||((E=e.currentActiveCity)==null?void 0:E.areaLatitude)||null,sortBy:O},{success:g,data:A}=await le(_);if(!g||!A||!A.total){l.value=!0;return}const B=A.records||[];B.forEach(L=>{L.shopName=L.storeName||L.shopName}),u.value=c.value===1?B:[...u.value,...B],u.value.length>=A.total&&(l.value=!0)};return(d,i)=>{const O=M("van-list");return n(),m("div",Ge,[u.value.length?(n(),m("div",He,Ze)):V("",!0),N(O,{loading:w.value,"onUpdate:loading":i[0]||(i[0]=_=>w.value=_),finished:l.value,"finished-text":"","loading-text":u.value.length?d.$t("common.loading"):"",onLoad:b},{default:se(()=>[(n(!0),m(D,null,H(u.value,_=>(n(),$(ae,{key:_.goodsId,goods:_,class:"mb-4 :last:mb-0",onClick:g=>y("onDetail",_),"show-store-name":"","show-distance":""},null,8,["goods","onClick"]))),128))]),_:1},8,["loading","finished","loading-text"])])}}}),Qe=te(Je,[["__scopeId","data-v-39ee5196"]]),ne=r=>(xe("data-v-4f55f69f"),r=r(),ke(),r),We={class:"font-Puhui font-normal relative pb-20 app-container"},Xe={class:"header__wrap w-full h-[50px]"},Ye={class:"header__title h-full van-nav-bar__content"},et={class:"van-nav-bar__left van-haptics-feedback"},tt={class:"van-nav-bar__title van-ellipsis text-b1 text-lg font-bold"},st={class:"van-nav-bar__right van-haptics-feedback text-b3"},at={class:"search__wrap w-full h-[48px] px-3 pb-3"},ot={class:"search__input w-full h-full bg-white rounded-3xl flex items-center justify-center px-3 py-2.5"},lt=ne(()=>a("div",{class:"search__icon flex-shrink-0"},[a("img",{src:Le,class:"w-4 h-4"})],-1)),nt=["placeholder","onKeyup"],rt=ne(()=>a("img",{src:Se,class:"w-4 h-4",alt:""},null,-1)),it=[rt],ct={class:"text-[#FF8812] text-sm font-semibold whitespace-nowrap"},ut={class:"list__wrap safe-bottom"},dt={class:"p-3"},vt={class:"goods__wrap overflow-y-scroll"},ft=G({name:"OfflineHome"});function ht(r){var J,Q;const y=me(),h=pe(),{cityMapStore:e}=K(),{getUserLocation:w}=oe(),{t:c}=_e(),v=f(""),l=f(((J=h.query)==null?void 0:J.tab)||"STORE"),u=f(!1),b=f(0),I=f(20),d=f(!1),i=f([]),O=z(()=>[{label:c("city.offline store"),value:"STORE"},{label:c("shop.offline server"),value:"SERVE"}]),_=z(()=>{var s,p;let t=[];return(s=e.locationCoords)!=null&&s.lat&&((p=e.locationCoords)!=null&&p.lng)&&t.push({label:c("city.Distance priority"),value:"asc|distance"}),t.push({label:c("city.Sales Priority"),value:"desc|store_sales_volume_order"}),l.value==="SERVE"&&t.push({label:c("goods.Selected-Optimal Priority"),value:"asc|goods_sort"}),t}),g=f((Q=_.value[0])==null?void 0:Q.value),A=()=>{v.value="",F()},B=t=>{var s;l.value=t,t==="STORE"&&g.value==="asc|goods_sort"&&(g.value=(s=_.value[0])==null?void 0:s.value),y.replace({path:"/city/search",query:{tab:t}}),E()},P=t=>{g.value=t,E()},R=f(null),F=()=>{u.value||(b.value=0,d.value=!1,i.value=[],L(),R.value.blur())},E=()=>{b.value=0,d.value=!1,i.value=[],L()},L=async()=>{u.value=!0,b.value+=1,d.value=!1,await re(),u.value=!1},re=async()=>{var T,q,W,X,Y,ee;let t={};l.value==="STORE"?t={storeNameLike:v.value,areaIdPreviousLastLeaf:((T=e.currentActiveCity)==null?void 0:T.areaId)||"3501",overseasFlag:((q=e.currentActiveCity)==null?void 0:q.overseasFlag)||!1}:t={goodsStatus:1,goodsNameLike:v.value,belongAreaIdPreviousLastLeaf:((W=e.currentActiveCity)==null?void 0:W.areaId)||"",overseasFlag:((X=e.currentActiveCity)==null?void 0:X.overseasFlag)||!1};let s=[g.value];g.value!=="asc|distance"&&s.push("asc|distance"),l.value==="STORE"?s.push("asc|store_id"):s.push("asc|goods_id");let p=s.length?s.join(","):null;const S={page:b.value,size:I.value,deleteFlag:!1,...t,longitude:e.locationCoords.lng||((Y=e.currentActiveCity)==null?void 0:Y.areaLongitude)||null,latitude:e.locationCoords.lat||((ee=e.currentActiveCity)==null?void 0:ee.areaLatitude)||null,sortBy:p},{success:j,data:o}=l.value==="STORE"?await Ee(S):await le(S);if(!j||!o||!o.total){d.value=!0;return}const x=o.records||[];x.forEach(U=>{U.shopName=U.storeName||U.shopName}),i.value=b.value===1?x:[...i.value,...x],i.value.length>=o.total&&(d.value=!0)},Z=t=>{y.push({path:"/city/search/offlineGoodsDetail",query:{goodsId:t.goodsId,storeId:t.storeId,child:"1"}})},ie=t=>{console.log(t),y.push({path:"/city/search/storefront",query:{storeId:t.storeId,child:1}})},ce=z(()=>{var t,s,p;return{longitude:e.locationCoords.lng||((t=e.currentActiveCity)==null?void 0:t.areaLongitude)||null,latitude:e.locationCoords.lat||((s=e.currentActiveCity)==null?void 0:s.areaLatitude)||null,areaIdPreviousLastLeaf:((p=e.currentActiveCity)==null?void 0:p.areaId)||""}});return ge(()=>ce.value,(t,s)=>{t!=null&&t.areaIdPreviousLastLeaf&&E()},{immediate:!0,deep:!0}),ye(async()=>{var t,s,p,S;e.currentActiveCity?(t=e.locationCoords)!=null&&t.lat&&((s=e.locationCoords)!=null&&s.lng)||e.setNoAuthError():await w(),(p=h.query)!=null&&p.tab&&(l.value=(S=h.query)==null?void 0:S.tab)}),(t,s)=>{var j;const p=M("van-list"),S=M("router-view");return n(),m("div",We,[a("div",Xe,[a("div",Ye,[a("div",et,[N($e)]),a("div",tt,C(t.$t("common.search")),1),a("div",st,C((j=k(e).currentActiveCity)==null?void 0:j.areaName),1)])]),a("div",at,[a("div",ot,[lt,be(a("input",{ref:(o,x)=>{x.searchRef=o,R.value=o},type:"text","onUpdate:modelValue":s[0]||(s[0]=o=>v.value=o),class:"w-full h-full bg-transparent ml-1 font-normal",placeholder:t.$t("mall.Enter search keywords"),onKeyup:we(F,["enter"]),enterkeyhint:"search"},null,40,nt),[[Ce,v.value]]),v.value?(n(),m("div",{key:0,class:"flex-shrink-0 flex items-center justify-center",onClick:A},it)):V("",!0),a("div",{class:"search__btn ml-2 flex-shrink-0",onClick:F},[a("span",ct,C(t.$t("common.search")),1)])])]),a("div",ut,[N(Ie,{options:k(O),"label-key":"label","value-key":"value",class:"!pt-3",modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=o=>l.value=o),onChange:B},null,8,["options","modelValue"]),a("div",dt,[N(Oe,{options:k(_),modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=o=>g.value=o),onChange:P},null,8,["options","modelValue"])]),a("div",vt,[i.value.length===0&&!u.value?(n(),$(Fe,{key:0,name:t.$t("common.No data yet")},null,8,["name"])):(n(),$(p,{key:1,loading:u.value,"onUpdate:loading":s[3]||(s[3]=o=>u.value=o),finished:d.value,"finished-text":l.value==="STORE"?t.$t("common.noMore"):"",onLoad:L},{default:se(()=>[(n(!0),m(D,null,H(i.value,o=>{var x,T;return n(),m(D,{key:o.goodsId+o.storeId},[l.value==="STORE"?(n(),$(Ue,{key:0,store:o,class:"mb-4 :last:mb-0",onClick:q=>ie(o)},null,8,["store","onClick"])):(n(),$(ae,{key:1,goods:o,class:"mb-4 :last:mb-0",onClick:q=>Z(o),"show-store-name":"","show-distance":!!((x=k(e).locationCoords)!=null&&x.lat&&((T=k(e).locationCoords)!=null&&T.lng))},null,8,["goods","onClick","show-distance"]))],64)}),128))]),_:1},8,["loading","finished","finished-text"])),l.value==="SERVE"&&d.value?(n(),$(Qe,{key:2,keyword:v.value,sortAct:g.value,onOnDetail:Z},null,8,["keyword","sortAct"])):V("",!0)])]),N(S,{class:"child-view bg-gray1"})])}}const mt=Object.assign(ft,{setup:ht}),Et=te(mt,[["__scopeId","data-v-4f55f69f"]]);export{Et as default};
