import{_ as Be,y as Ce,F as u,G as i,a2 as A,P as t,I as y,a0 as m,Q as a,X as ze,R as _,w as Oe,x as K,r as S,bd as Pe,bc as M,bh as Ue,D as Re,E as x,K as b,N as I,H as n,O as g,J as we,a4 as je,$ as qe,B as xe,Y as Ke,Z as Xe,T as N}from"./vendor-D6JO6WHW.js";import{_ as Ge}from"./member-CkdtKF8y.js";import{S as He}from"./SkewCard-CreFztFl.js";import{S as Je}from"./shop-CeqcS6K2.js";import{e as Qe,g as ye,b as Ye,d as Ze,V as Ie,r as We,aS as et}from"./index-CbIwihlz.js";import{b as tt}from"./beiExtRewardContract-B5hYiata.js";import{q as st,c as ot,d as nt}from"./beiRanking-DOY3XZdF.js";import{b as at}from"./beiConstContract-9GKmIGuG.js";const it={key:0},lt=m("普通店铺"),ct=Ce({props:{type:null,width:{default:125}},setup(f){return(k,z)=>(i(),u("div",{class:_(["tag-box text-right text-white font-semibold pr-5 pt-1 h-[75px] min-w-[120px]",`bg-${f.type||0}`]),style:ze({width:`${f.width}px`})},[f.type!==void 0?(i(),u("span",it,[f.type===t(Je).SD?(i(),u(y,{key:0},[lt],64)):(i(),u(y,{key:1},[m(a(k.$t(`common.shop_type_${f.type}`))+"店铺",1)],64))])):A("",!0)],6))}}),rt=Be(ct,[["__scopeId","data-v-ea5a823e"]]),B=f=>(Ke("data-v-41cab26c"),f=f(),Xe(),f),ut={class:"relative m-auto text-sm font-normal font-Puhui"},dt={class:"relative z-0 p-3"},ft={class:"flex items-center gap-x-2"},mt={class:"relative"},pt={class:"-mt-5 w-[40px] border-[1px] border-solid border-white flex-center bg-yellow rounded-3xl mx-auto relative z-10"},ht=B(()=>n("img",{src:Ge,class:"w-4 h-4"},null,-1)),vt={class:"text-sm"},gt={class:"flex flex-col gap-1 flex-1"},kt={class:"text-base font-semibold line-clamp-1 name-width"},bt={class:"text-b3 flex items-center"},_t=["src"],wt=B(()=>n("span",{class:"mx-1"},"|",-1)),xt={class:"w-full h-[40px] bg-b5 rounded-full p-0.5 mt-4"},yt={class:"w-full h-full relative"},It={class:"absolute w-full h-full flex items-center justify-center left-0 top-0"},Bt=["onClick"],Ct={class:"mt-4 flex items-center bg-b5 p-3 rounded-[10px]"},Ft={class:"flex items-center gap-x-3"},Tt=["onClick"],$t={class:"text-b3 mt-1 flex items-center"},Vt={key:0,class:"text-left text-b3 font-normal"},Lt={class:"flex items-center"},Dt=B(()=>n("span",{class:"text-success"},"充电：",-1)),Et=m("预计系数"),St={key:1},Mt=m("/电量+"),Nt={key:3},At={class:"flex items-center"},zt=B(()=>n("span",{class:"text-error"},"放电：",-1)),Ot=m("预计系数"),Pt={key:1},Ut=m("/电量-"),Rt={key:3},jt={key:1,class:"flex items-center"},qt=B(()=>n("span",null,"测算结果",-1)),Kt=[qt],Xt={class:"flex-center-bw mt-4 gap-x-3"},Gt=m("放电"),Ht=Ce({props:{show:{type:Boolean},shopId:null,teleport:null},emits:["close","voteSuccess","handleTo"],setup(f,{emit:k}){const{show:z,shopId:X,teleport:Jt}=f,{t:G}=Oe(),{contributesStore:O}=Qe(),{voteByPoint:Fe,voteByLp:Te,userVoteDetailView:$e,voteMonthTimestampView:Ve}=tt(),{userTotalLp:Le}=at(),{loadingToggle:P}=We(),C=K(()=>[{id:1,text:G("ranking.points_ticket")},{id:2,text:G("ranking.lp_ticket")}]),r=S(null),De=[.25,.5,.75],s=Pe({tab:1,votesInfo:{1:{total:0,sumUsed:0},2:{total:0,sumUsed:0}},estimateInfo:{coefficient:1,coefficientLikeBudget:1,coefficientNotLikeBudget:1,score:0,scoreLikeBudget:0,scoreNotLikeBudget:0,likeDiffer:0,notlikeDiffer:0,tickets:0},totalTimes:5,rewardTimes:5}),F=K(()=>s==null?void 0:s.votesInfo[s.tab]),U=K(()=>{var o;return Math.max(((o=F.value)==null?void 0:o.total)-(F==null?void 0:F.value.sumUsed),0)}),d=S(null),H=S(null),J=S(null),[h,R]=M(!0),[T,$]=M(!1),[Q,Y]=M(!1),[V,Z]=M(!1),W=o=>{h.value||T.value||(d.value=Math.floor(new xe(U.value).times(o).toNumber()))},j=()=>{P(!1),k("close")},Ee=o=>{+s.tab!=+o&&(d.value=null,s.estimateInfo.tickets=0,s.tab=o)},ee=(o,e,c)=>{const p=Math.abs(Number(new xe(o).minus(e)));return p<1e-4?"<0.0001":`${c}${p.toFixed(4)}`},Se=async()=>{const{result:o}=await Ve();J.value=+o.thisMonthTime},Me=async()=>{P(!0);const{success:o,data:e}=await st({shopId:X,month:et()});o&&(P(!1),r.value=e)},te=async()=>{var c,p;if(s.tab===1)return;if(d.value<=0){s.estimateInfo.tickets=0;return}Z(!0);const{success:o,data:e}=await nt(X,d.value);o&&(s.estimateInfo=e,s.estimateInfo.tickets=d.value,s.estimateInfo.likeDiffer=Math.abs((e==null?void 0:e.scoreLikeBudget)-((c=r.value)==null?void 0:c.score)),s.estimateInfo.notlikeDiffer=Math.abs((e==null?void 0:e.scoreNotLikeBudget)-((p=r.value)==null?void 0:p.score)),Z(!1))},se=async()=>{var c;if(!Number(d.value)||+d.value<=0)return N({message:"请输入投票数",duration:2e3}),!1;if(+d.value>+U.value)return N({message:"超过可投数量",duration:2e3}),!1;const{success:o,data:e}=await ot((c=r.value)==null?void 0:c.shopId);return o||N({message:"网络异常～",duration:2e3}),o&&!e&&N({message:"当前店铺无法投票请联系店家确认",duration:2e3}),e},Ne=async()=>{var e,c;if(!await se())return;$(!0);const{success:o}=await Fe((e=r.value)==null?void 0:e.shopId,d.value);$(!1),o&&(console.log(+s.rewardTimes,+s.totalTimes),k("close"),k("voteSuccess",{direct:200,differ:d.value*((c=r.value)==null?void 0:c.coefficient)},+s.rewardTimes<+s.totalTimes))},oe=async o=>{var c,p,L,v,w,D;if(!await se())return;$(!0),((c=s.estimateInfo)==null?void 0:c.tickets)!==d.value&&await te();const{success:e}=await Te((p=r.value)==null?void 0:p.shopId,d.value,o);$(!1),e&&(k("close"),k("voteSuccess",{direct:o,differ:o===200?(L=s.estimateInfo)==null?void 0:L.likeDiffer:(v=s.estimateInfo)==null?void 0:v.notlikeDiffer,score:o===200?(w=s.estimateInfo)==null?void 0:w.scoreLikeBudget:(D=s.estimateInfo)==null?void 0:D.scoreNotLikeBudget},+s.rewardTimes<+s.totalTimes))},Ae=async()=>{R(!0),await Se();const{success:o,result:e}=await $e(J.value);s.rewardTimes=+(e==null?void 0:e.times),s.votesInfo[1]={total:Math.min(Math.floor(O.contributes/1e3),500),sumUsed:+(e==null?void 0:e.sumTickets)},console.log("rewardTimes :",+(e==null?void 0:e.times)),console.log("contributes :",O.contributes),console.log("sumTickets :",+(e==null?void 0:e.sumTickets)),console.log("votesInfo:",s.votesInfo[1]),o&&R(!1);const c=Math.floor(+await Le());R(!1),s.votesInfo[2]={total:+c,sumUsed:+(e==null?void 0:e.sumLp)}},ne=o=>{(o.key==="Enter"||o.key==="Escape")&&H.value.blur()};return Ue(()=>{window.removeEventListener("keydown",ne)}),Re(async()=>{window.addEventListener("keydown",ne),Me(),await O.fetchContributes(),Ae()}),(o,e)=>{const c=x("van-icon"),p=x("VanImage"),L=x("VanField"),v=x("VanLoading"),w=x("VanButton"),D=x("VanPopup");return i(),b(D,{show:f.show,"onUpdate:show":e[6]||(e[6]=E=>qe(z)?z.value=E:null),teleport:f.teleport,onClickOverlay:je(j,["stop"]),onClose:j,round:"",class:"bg-transparent position-center",style:{"min-width":"280px","max-width":"350px",width:"85%"}},{default:I(()=>[n("div",ut,[n("div",{class:"text-right text-b6 ml-auto text-lg font-bold h-6 flex items-start justify-end",onClick:j},[g(c,{name:"cross"})]),g(He,{width:"210",right:"26"},{default:I(()=>{var E,ae,ie,le,ce,re,ue,de,fe,me,pe,he,ve,ge,ke,be,_e;return[g(rt,{class:"absolute right-1.5 top-1.5 -z-20",type:(E=r.value)==null?void 0:E.type},null,8,["type"]),n("div",dt,[n("div",ft,[n("div",mt,[g(p,{round:"",src:(((ae=r.value)==null?void 0:ae.logo)||"").split(",")[0],errorIcon:t(ye)("images/ranking/noPosition.png"),fit:"cover",width:"46px",height:"46px"},null,8,["src","errorIcon"]),n("div",pt,[ht,n("span",vt,"V"+a((ie=r.value)==null?void 0:ie.memberLevel),1)])]),n("div",gt,[n("div",kt,a((le=r.value)==null?void 0:le.storeName),1),n("div",bt,[n("span",null,a(t(Ye)((ce=r.value)==null?void 0:ce.shopAddress,"**",0,4)),1),(re=r.value)!=null&&re.authorizeAddress?(i(),u("img",{key:0,src:t(ye)("images/ranking/auth.svg"),class:"w-4 h-4"},null,8,_t)):A("",!0),wt,n("span",null,a(o.$t("ranking.battery"))+a(((ue=r.value)==null?void 0:ue.score)||0),1),n("div",{class:"text-newOrigin pl-1",onClick:e[0]||(e[0]=l=>t(Y)(!t(Q)))},a(o.$t("user.feedbackDetail")),1)])])]),n("div",{class:_(["bg-[#FF88121F] text-newOrigin rounded px-2 flex items-center justify-between overflow-hidden transition-all duration-300",t(Q)?"h-[36px] border border-newOrigin mt-1":"h-0 mt-0"]),onClick:e[1]||(e[1]=l=>t(Y)(!1))},[n("div",null,a(+((de=r.value)==null?void 0:de.pointTicket))+a(o.$t("ranking.points_ticket"))+" x "+a(t(Ze)((fe=r.value)==null?void 0:fe.coefficient))+a(o.$t("ranking.coefficient"))+" = "+a((me=r.value)==null?void 0:me.score)+a(o.$t("ranking.battery")),1),n("div",null,[g(c,{name:"cross"})])],2),n("div",xt,[n("div",yt,[n("div",{class:_(["absolute w-[50%] h-full bg-b1 rounded-full left-0 transition-all duration-300",`w-[${100/t(C).length}%] left-${t(C).findIndex(l=>l.id===t(s).tab)||0}/${t(C).length}`])},null,2),n("div",It,[(i(!0),u(y,null,we(t(C),l=>(i(),u("div",{class:"w-[50%] h-full flex items-center justify-center overflow-hidden",onClick:q=>Ee(l.id),key:l.id},[n("span",{class:_(["text-sm text-center line-clamp-1 transition-all duration-300",[t(s).tab===l.id?"text-b6 font-semibold":"text-b3 font-normal"]])},a(l.text),3)],8,Bt))),128))])])]),n("div",Ct,[g(L,{type:"digit",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value=l),placeholder:"0",ref:(l,q)=>{q.amountInputRef=l,H.value=l}},null,8,["modelValue"]),n("div",Ft,[t(s).tab===1?(i(),u(y,{key:0},we(De,l=>n("div",{class:"shrink-0 w-fit text-newOrigin px-0.5",key:l,onClick:q=>W(l)},a(l*100)+"% ",9,Tt)),64)):A("",!0),n("div",{class:"shrink-0 w-fit text-newOrigin",onClick:e[3]||(e[3]=l=>W(1))}," MAX ")])]),n("div",$t,[+t(s).tab==2&&((pe=t(s).estimateInfo)==null?void 0:pe.tickets)>0?(i(),u("div",Vt,[n("div",Lt,[Dt,Et,t(V)?(i(),b(v,{key:0,size:"12"})):(i(),u("span",St,a(ee((he=t(s).estimateInfo)==null?void 0:he.coefficientLikeBudget,(ve=t(s).estimateInfo)==null?void 0:ve.coefficient,"+")),1)),Mt,t(V)?(i(),b(v,{key:2,size:"12"})):(i(),u("span",Nt,a((ge=t(s).estimateInfo)==null?void 0:ge.likeDiffer),1))]),n("div",At,[zt,Ot,t(V)?(i(),b(v,{key:0,size:"12"})):(i(),u("span",Pt,a(ee((ke=t(s).estimateInfo)==null?void 0:ke.coefficientNotLikeBudget,(be=t(s).estimateInfo)==null?void 0:be.coefficient,"-")),1)),Ut,t(V)?(i(),b(v,{key:2,size:"12"})):(i(),u("span",Rt,a((_e=t(s).estimateInfo)==null?void 0:_e.notlikeDiffer),1))])])):(i(),u("div",jt,[m(a(o.$t("ranking.remain_ticket")),1),t(h)?(i(),b(v,{key:0,size:"10"})):(i(),u(y,{key:1},[m(a(t(U)),1)],64)),m(a(t(s).tab===1?o.$t("ranking.points_ticket"):o.$t("ranking.lp_ticket")),1)])),t(s).tab===2&&d.value>0?(i(),u("div",{key:2,class:"pl-1.5 ml-auto text-newOrigin",onClick:te},Kt)):A("",!0)]),n("div",Xt,[t(s).tab===1?(i(),b(w,{key:0,class:_(["btn-yellow w-full h-[46px] rounded-full border-none text-base font-semibold",{"opacity-60":t(h)}]),onClick:Ne,disabled:t(h),loading:t(T)},{default:I(()=>[m(a(o.$t("ranking.power")),1)]),_:1},8,["class","disabled","loading"])):(i(),u(y,{key:1},[g(w,{class:_(["bg-error text-b6 w-full h-[46px] rounded-full border-none text-base font-semibold",{"opacity-60":t(h)}]),icon:t(Ie)("discharge.svg"),disabled:t(h),loading:t(T),onClick:e[4]||(e[4]=l=>oe(400))},{default:I(()=>[Gt]),_:1},8,["class","icon","disabled","loading"]),g(w,{class:_(["bg-success text-b6 w-full h-[46px] rounded-full border-none text-base font-semibold",{"opacity-60":t(h)}]),icon:t(Ie)("charge.svg"),disabled:t(h),loading:t(T),onClick:e[5]||(e[5]=l=>oe(200))},{default:I(()=>[m(a(o.$t("ranking.power")),1)]),_:1},8,["class","icon","disabled","loading"])],64))])])]}),_:1})])]),_:1},8,["show","teleport","onClickOverlay"])}}}),ns=Be(Ht,[["__scopeId","data-v-41cab26c"]]);export{ns as S,rt as a};
