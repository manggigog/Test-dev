import{B as q}from"./BackIcon-D2Vm_lyR.js";import{y as N,r as f,o as S,x as j,E as R,F as n,G as l,H as t,O as k,Q as o,N as L,P as m,T as Z,_ as U,l as J,D as V,a3 as Q,I as H,J as z,a2 as B,B as F,a0 as P,w as W,a1 as K,Y as X,Z as tt}from"./vendor-CjApaIpB.js";import{u as et,p as st}from"./useOrderStatus-DMn11Py2.js";import{P as ot}from"./order-B5BGKYED.js";import{b as G,d as E,f as at,u as nt,c as lt}from"./index-lKIcPnY0.js";import{u as rt}from"./useRefundStatus-BOTs0ra-.js";import{P as O}from"./flashSale-DDyqLyYN.js";import{A as ut,l as it}from"./order-C6QNLrKu.js";const ct="/Test-dev/static/images/calendar--RsEN3cI.svg",dt={class:"mt-4"},mt={class:"text-sm text-default flex justify-start items-center font-semibold"},ft={key:0},vt={key:1},_t=t("img",{class:"w-4 h-4 ml-1",src:ct},null,-1),ht=N({props:{allowReverse:{type:Boolean,default:!1},completeTime:{type:Boolean,default:!0}},emits:["change"],setup(e,{emit:C}){const T=e,h=f(!1),p=f(!0),i=f([]),s=f(""),A={values:Array.from({length:S().year()-2019},(a,c)=>2020+c),defaultIndex:S().year()-2020,formatter:a=>`${a}年`},x={values:Array.from({length:12},(a,c)=>c+1),defaultIndex:S().month(),formatter:a=>`${a.toString().padStart(2,"0")}月`},r=()=>{p.value=!0,h.value=!0},y=()=>{h.value=!1,p.value=!0,s.value="",i.value=[],C("change",[])},w=a=>{const c=a[0],g=a[1].toString().padStart(2,"0"),v=`${c}-${g}`;if(p.value)s.value=v,p.value=!1,h.value=!1,setTimeout(()=>{h.value=!0},300);else{if(!T.allowReverse&&S(v).isBefore(s.value)){Z("结束时间不能早于开始时间");return}T.allowReverse&&S(v).isBefore(s.value)?i.value=[v,s.value]:i.value=[s.value,v];const $=S(i.value[0],"YYYY-MM"),I=S(i.value[1],"YYYY-MM");let d=[...i.value];if(T.completeTime){const u=$.startOf("month").format("YYYY-MM-DD 00:00:00"),b=I.endOf("month").format("YYYY-MM-DD 23:59:59");d=[u,b]}C("change",d),h.value=!1,p.value=!0,s.value=""}},M=j(()=>{if(!s.value)return A;const[a]=s.value.split("-");return{values:Array.from({length:S().year()-+a+1},(c,g)=>+a+g),defaultIndex:0,formatter:c=>`${c}年`}}),Y=j(()=>{if(!s.value)return x;const[a,c]=s.value.split("-");S().year();const g=M.value.values[0];let v=0;return g===+a&&(v=+c-1),{values:Array.from({length:12-v},($,I)=>v+I+1),defaultIndex:0,formatter:$=>`${$.toString().padStart(2,"0")}月`}});return(a,c)=>{const g=R("van-picker"),v=R("van-popup");return l(),n("div",dt,[t("div",{class:"time-selector",onClick:r},[t("span",mt,[i.value[0]&&i.value[1]?(l(),n("span",ft,o(`${i.value[0]} / ${i.value[1]}`),1)):(l(),n("span",vt,o(a.$t("order.All time")),1)),_t])]),k(v,{show:h.value,"onUpdate:show":c[0]||(c[0]=$=>h.value=$),position:"bottom",round:""},{default:L(()=>[k(g,{"cancel-button-text":a.$t("common.cancel"),title:p.value?a.$t("goods.selectStartTime"):a.$t("goods.selectEndTime"),columns:p.value||e.allowReverse?[A,x]:[m(M),m(Y)],onConfirm:w,onCancel:y},null,8,["cancel-button-text","title","columns"])]),_:1},8,["show"])])}}}),pt={class:"pb-0 bg-white rounded-xl"},xt={class:"flex justify-between"},yt={class:"flex-start"},wt={class:"ml-1 font-semibold text-base leading-[22px] text-[#2e2008]"},gt={class:"font-semibold text-sm leading-[20px] text-primary whitespace-nowrap"},$t={class:"flex w-full gap-2"},bt={class:"flex-1 flex flex-col min-h-[5rem] justify-between"},St={class:"flex items-baseline justify-between w-full font-semibold"},Tt={class:"w-full text-base line-clamp-2 leading-[22px] font-semibold flex flex-row justify-between items-center"},At={class:"max-w-[140px] text-ellipsis overflow-hidden line-clamp-1"},kt={class:"flex justify-end text-sm font-normal text-[#a6a6a6]"},Ct={key:0},Mt={key:0},Yt={key:1},It={key:1},Et={key:0},Rt={key:1},Dt=P(" ) "),Ft={class:"mt-1 text-sm min-w-fit font-normal text-[#a6a6a6]"},jt={key:0,class:"flex justify-end opacity-60 text-[#FD5520] text-sm"},Bt={key:1,class:"flex justify-end opacity-60 text-[#FD5520] text-sm"},Nt={key:2,class:"flex justify-end opacity-60 text-[#FD5520] text-sm"},Pt=N({props:["order"],setup(e){const C=e,T=f(null);j(()=>1/T.value);const h=async()=>{const{mcoinRate:s}=at();T.value=await s()};J();const p=et(C.order.refundStatus,C.order.payType),i=s=>{const A=new F(s.price).times(s.number).minus(s.goodsActivityReduceAmount||0).plus(s.goodsAdjustChangeAmount||0).toNumber();return E(A||0)};return V(async()=>{await h()}),(s,A)=>{const x=R("VanImage");return l(),n("div",pt,[t("div",xt,[t("div",yt,[k(x,{src:e.order.stores&&e.order.stores.logo,class:"store-logo w-[30px] h-[30px] overflow-hidden rounded-[50%]",alt:"",round:"",fit:"cover"},null,8,["src"]),t("div",wt,o(m(G)(e.order.userAddress.address,"...",5,5)),1)]),t("div",gt,o(m(p)[e.order.status+""]),1)]),(l(!0),n(H,null,z(e.order.orderGoods,r=>{var y,w;return l(),n("div",{class:"mt-2",key:r.goodsName},[t("div",$t,[k(x,{src:(r.icons||"").split(",")[0],class:"min-w-20 w-20 h-20 overflow-hidden rounded-lg",alt:r.goodsName,title:r.goodsName,fit:"cover"},null,8,["src","alt","title"]),t("div",bt,[t("div",null,[t("div",St,[t("div",Tt,[t("div",At,o(r.goodsName),1),t("div",null,[t("div",kt,[+e.order.paySource!==m(ot).USDT_WALLET?(l(),n("div",Ct,[e.order.payType===m(O).STORE_CARD?(l(),n("span",Mt,o(m(E)(+new m(F)(r.cardPrice).times(r.number??1)||0))+o((y=e.order.fmStoredCard)==null?void 0:y.symbol),1)):(l(),n("span",Yt,o(i(r))+" Mcoin",1))])):(l(),n("div",It,[P(o(m(E)(e.order.totalUsdt))+"USDT(",1),e.order.payType===m(O).STORE_CARD?(l(),n("span",Et,o(m(E)(+new m(F)(r.cardPrice).times(r.number??1)||0))+o((w=e.order.fmStoredCard)==null?void 0:w.symbol),1)):(l(),n("span",Rt,"("+o(i(r))+" Mcoin)",1)),Dt]))])])])]),t("div",Ft,o(s.$t("order.quantity",{number:r.number||0})),1)]),(e.order.status===5||e.order.refundStatus===3)&&e.order.refundStatus<10?(l(),n("div",jt,o(s.$t("refund.refund success tips")),1)):e.order.refundStatus!=null&&e.order.status===1&&e.order.refundStatus===4?(l(),n("div",Bt,o(s.$t("refund.refund reject")),1)):B("",!0),e.order.refundStatus!=null?(l(),n("div",Nt,o(m(rt)(e.order.refundStatus)),1)):B("",!0)])])])}),128)),Q(s.$slots,"default",{},void 0,!0)])}}}),Ot=U(Pt,[["__scopeId","data-v-1cb2b6bf"]]),Lt=e=>(X("data-v-7931f4d3"),e=e(),tt(),e),Ut={class:"w-full bg-[#F2F0EF]",style:{"background-image":"none"}},Vt={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[44px] px-2.5 z-50"},Ht={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},zt={class:"font-semibold"},Gt={class:"list-content pt-2 px-4"},qt={class:"total__wrap w-full flex flex-row justify-between gap-2"},Zt={class:"total__item w-[50%] h-[74px] bg-white rounded-xl p-3"},Jt={class:"text-xs font-normal text-default"},Qt={class:"text-left mt-1"},Wt={class:"num-value text-2xl font-semibold text-left"},Kt={class:"num-symbol text-xs font-normal text-[#a6a6a6] ml-1"},Xt={class:"total__item w-[50%] h-[74px] bg-white rounded-xl"},te={class:"total__item w-[50%] h-[74px] bg-white rounded-xl p-3"},ee={class:"text-xs font-normal text-default"},se={class:"text-left mt-1"},oe={class:"num-value text-2xl font-semibold text-left"},ae=Lt(()=>t("span",{class:"num-symbol text-xs font-normal text-[#a6a6a6] ml-1"},"Mcoin",-1)),ne={class:"list__wrap mt-3 w-full h-[calc(100vh-174px)] z-50 overflow-y-auto scroll-smooth"},le={class:"bottom__wrap mt-2 w-full flex flex-row justify-between items-center"},re={class:"text-sm font-normal text-[#a6a6a6]"},ue={class:"text-newOrigin text-sm font-normal"},ie={key:0},ce={key:0},de={key:1},me=P(" Mcoin "),fe=N({setup(e){const{t:C}=W(),T=K(),{getCurrentStoreId:h}=nt(),p=20,i=C("order.history_order_title"),s=f(T.query.address),A=f(`${G(s.value,"...",5,5)||""}${i}`);document.title=A.value;const x=f({orderAmount:0,orderCount:0}),r=f([]),y=f(!1),w=f(!1),M=f(0),Y=f(null),a=f(null),c=()=>{M.value=0,r.value=[],w.value=!1},g=async()=>{var b,_,D;const d={status:4,type:1,historyAddress:s.value,storeId:(b=await h())==null?void 0:b.id},u=await ut(d);u.success&&(x.value={orderAmount:((_=u==null?void 0:u.data)==null?void 0:_.orderAmount)||0,orderCount:((D=u==null?void 0:u.data)==null?void 0:D.orderCount)||0})},v=async()=>{var b;const d={page:M.value,size:p,type:1,status:4,historyAddress:s.value,storeId:(b=await h())==null?void 0:b.id,createStartTime:Y.value,createEndTime:a.value},u=await it(d);if(y.value=!1,!u.success||!u.data||!u.total){w.value=!0;return}r.value=M.value===1?u.data:[...r.value,...u.data],w.value=r.value.length>=u.total},$=async()=>{y.value=!0,M.value+=1,await v(),y.value=!1},I=d=>{d&&d[0]&&d[1]?[Y.value,a.value]=d:(Y.value=null,a.value=null),c(),$()};return V(()=>{g()}),(d,u)=>{const b=R("van-list");return l(),n("div",Ut,[t("section",Vt,[t("div",Ht,[k(q)]),t("div",zt,o(A.value),1)]),t("section",Gt,[t("div",qt,[t("div",Zt,[t("p",Jt,o(d.$t("order.history_order_count")),1),t("p",Qt,[t("span",Wt,o(x.value.orderCount),1),t("span",Kt,o(d.$t("common.order_count_suffix")),1)])]),t("div",Xt,[t("div",te,[t("p",ee,o(d.$t("order.history_transaction_count")),1),t("p",se,[t("span",oe,o(m(lt)(x.value.orderAmount)),1),ae])])])]),k(ht,{"allow-reverse":"",onChange:I}),t("div",ne,[k(b,{loading:y.value,"onUpdate:loading":u[0]||(u[0]=_=>y.value=_),finished:w.value,"finished-text":"没有更多了",onLoad:$},{default:L(()=>[(l(!0),n(H,null,z(r.value,(_,D)=>(l(),n("div",{key:_.id,class:"list__item w-full min-h-[132px] rounded-xl bg-white p-3"},[k(Ot,{order:_},null,8,["order"]),t("div",le,[t("p",re,o(m(st)(+_.paySource)),1),t("p",ue,[_.totalUsdt?(l(),n("span",ie,[t("span",null,o(_.totalUsdt)+"USDT",1),_.totalAmount?(l(),n("span",ce,"("+o(_.totalAmount)+" Mcoin)",1)):B("",!0)])):(l(),n("span",de,[t("span",null,o(_.totalAmount),1),me]))])])]))),128))]),_:1},8,["loading","finished"])])])])}}}),$e=U(fe,[["__scopeId","data-v-7931f4d3"]]);export{$e as default};
