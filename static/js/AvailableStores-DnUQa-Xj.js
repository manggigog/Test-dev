import{_ as X,z as Z,o as Y,q as W,y as B,G as I,H as u,I as r,O as p,U as A,Q as M,N as J,r as F,D as te,E as ne,ab as ie,F as K,P as U,$ as Q,Z as D,J as le,K as ce,a0 as de,a4 as ue,n as fe,X as he,Y as me,x as ve}from"./vendor-Dr_RpJ_Y.js";import{C as pe}from"./CommonVanProvider-KZuKVOde.js";import{_ as ge}from"./SearchBar-C8hJeDlC.js";import{a as G,B as re,w as ye,aT as oe,aE as xe}from"./index-7OiUoGXy.js";import{M as be}from"./Map-Bx9jCOWw.js";import{u as ee}from"./useCityMap-CJiyuUmB.js";import{S as se,P as ae,L as Ie}from"./iconAssets-DyRcdBzl.js";import"./BackIcon-CDrGaEPo.js";import"./search-C4fLtTfY.js";import"./delete-BlDblrKv.js";import"./localMark-D3Prsc6Q.js";const _e={class:"w-full flex gap-2"},Le={class:"shrink-0 w-[80px] h-[80px] rounded-lg overflow-hidden"},we=["src"],ke={class:"w-full flex flex-col justify-between"},Ce={class:"shrink-0"},$e={class:"flex items-center justify-between"},Se={class:"text-base text-b1 font-semibold line-clamp-1"},Fe={key:0,class:"shrink-0 h-[18px] px-1 border-[0.5px] border-[#FF8812] rounded-sm flex justify-center items-center"},Be={class:"text-xs text-[#FF8812] font-normal"},Me={class:"mt-1 text-b3 text-sm font-normal line-clamp-1"},Te={key:0,class:"w-full text-right text-b3 text-sm font-normal line-clamp-1"},Ae=Z({props:{storeInfo:null,idx:null},setup(s){const C=s,_=Y(),d=W(),{distanceFormat:n}=ee(),{cityMapStore:T}=G(),m=B(()=>{var a,y;return(a=C.storeInfo)!=null&&a.storeIcons?(y=C.storeInfo)==null?void 0:y.storeIcons.split(","):[]}),g=()=>{const a=_.path.replace("availableStores","storefront");d.push(`${a}?storeId=${C.storeInfo.storeId}&child=1`)};return(a,y)=>{var $,f,w,x,E,v;return u(),I("div",{class:"w-full h-fit bg-white rounded-xl p-3 shadow-[0_0.5px_16px_0_rgba(0,0,0,0.16)]",onClick:g},[r("div",_e,[r("div",Le,[r("img",{src:p(m)[0],alt:"shop",class:"w-full h-full object-cover"},null,8,we)]),r("div",ke,[r("div",Ce,[r("div",$e,[r("div",Se,M((($=s.storeInfo)==null?void 0:$.storeName)||""),1),s.idx===0?(u(),I("div",Fe,[r("span",Be,M(a.$t("city.Closest")),1)])):A("",!0)]),r("div",Me,M((f=s.storeInfo)==null?void 0:f.storeAddress),1)]),(w=s.storeInfo)!=null&&w.distance&&((x=p(T).locationCoords)!=null&&x.lat)&&((E=p(T).locationCoords)!=null&&E.lng)?(u(),I("div",Te,M(p(n)((v=s.storeInfo)==null?void 0:v.distance,a.$t("city.Distance from you"))),1)):A("",!0)])])])}}}),Ee=X(Ae,[["__scopeId","data-v-3d4f9890"]]),Ve=""+new URL("../images/check-HLHTc74I.svg",import.meta.url).href,Pe={class:"flex items-center gap-0.5"},ze={key:0,class:"shrink-0 h-[18px] px-1 border-[0.5px] border-newOrigin rounded-sm flex justify-center items-center"},Ne={class:"text-xs text-newOrigin font-normal"},Re={class:"flex items-center"},je={key:0,class:"shrink-0 text-b3 text-sm font-normal"},Ue={class:"text-b3 text-sm font-normal line-clamp-1"},qe={key:0,class:"shrink-0 flex items-center justify-center"},He=r("img",{class:"shrink-0 w-5 h-5",src:Ve,alt:""},null,-1),Oe=[He],De=Z({props:{storeInfo:null,selected:{type:Boolean},recentFlag:{type:Boolean}},emits:["select"],setup(s,{emit:C}){const _=s,{distanceFormat:d}=ee(),{cityMapStore:n}=G();B(()=>{var m,g;return(m=_.storeInfo)!=null&&m.storeIcons?(g=_.storeInfo)==null?void 0:g.storeIcons.split(","):[]});const T=()=>{C("select")};return(m,g)=>{var a,y,$,f,w,x;return u(),I("div",{class:"w-full flex justify-between gap-2",onClick:T},[r("div",null,[r("div",Pe,[r("div",{class:J(["text-sm line-clamp-1",s.selected?"text-newOrigin font-semibold":"text-b1 font-normal"])},M(((a=s.storeInfo)==null?void 0:a.storeName)||""),3),s.recentFlag?(u(),I("div",ze,[r("span",Ne,M(m.$t("city.Closest")),1)])):A("",!0)]),r("div",Re,[(y=s.storeInfo)!=null&&y.distance&&(($=p(n).locationCoords)!=null&&$.lat)&&((f=p(n).locationCoords)!=null&&f.lng)?(u(),I("div",je,M(p(d)((w=s.storeInfo)==null?void 0:w.distance,m.$t("city.Distance from you")))+"ï½œ ",1)):A("",!0),r("div",Ue,M((x=s.storeInfo)==null?void 0:x.storeAddress),1)])]),s.selected?(u(),I("div",qe,Oe)):A("",!0)])}}}),Ze=s=>(he("data-v-2b92e95a"),s=s(),me(),s),Ge={class:"w-full h-full relative flex flex-col"},Je=Ze(()=>r("div",{id:"map",class:"w-full h-full relative z-0"},null,-1)),Ke={class:"shrink-0 -mt-4 h-fit bg-white rounded-t-2xl relative pb-[78px]"},Qe=["id"],Xe={key:0,class:"absolute bottom-0 w-full sm:w-[375px] flex items-center py-4 px-3 bg-white"},Ye=Z({props:{storeList:null,searchList:null,searchFlag:{type:Boolean},loading:{type:Boolean},finished:{type:Boolean}},emits:["changeIndex","handleTo","onLoad"],setup(s,{expose:C,emit:_}){const d=s,{cityMapStore:n}=G(),T=Y(),m=W(),g=B(()=>d.searchList.length?d.searchList:d.storeList),a=F({}),y=e=>{var o;return((o=a.value)==null?void 0:o.storeId)===e.storeId},$=e=>!!e.recentFlag,f=B(()=>d.searchFlag&&!d.searchList.length?!0:!g.value.length),w=(e,o)=>{a.value={...e},x(e),q(o)},x=async e=>{await fe();const o=document.getElementById("item"+e.storeId);document.getElementById("list").scrollTo({top:o.offsetTop,behavior:"smooth"})},E=()=>{n.setSelectedAvailableStore(a.value),m.back()};te(()=>d.storeList,e=>{e.length>0&&setTimeout(()=>{i&&(S(),c(),t(),R(),a.value=d.storeList.find(o=>{var b;return o.storeId==((b=T.query)==null?void 0:b.storeId)}))},300)},{immediate:!0,deep:!0}),te(()=>d.searchList,e=>{e.length===0&&a.value.storeId&&!f.value&&x(a.value)},{immediate:!0,deep:!0});const v=F(0);let i=null,V=[],l=null;const H=B(()=>{var e,o;return n.locationCoords.lng&&n.locationCoords.lat?{lng:n.locationCoords.lng,lat:n.locationCoords.lat}:{lng:(e=n.currentActiveCity)==null?void 0:e.areaLongitude,lat:(o=n.currentActiveCity)==null?void 0:o.areaLatitude}}),R=()=>{try{const e=H.value;i=L.map("map",{center:[e.lat,e.lng],zoom:12,trackResize:!0,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"",subdomains:"abcd",maxZoom:17,minZoom:7}).addTo(i)}catch{}finally{}},t=()=>{const e=d.storeList[v.value];e&&e.storeLatitude&&e.storeLongitude&&i.flyTo([e.storeLatitude,e.storeLongitude],15,{duration:.8,easeLinearity:1})},S=()=>{P(),d.storeList.forEach((e,o)=>{if(e.storeLatitude&&e.storeLongitude){const b=o===v.value?se:ae,z=L.marker([e.storeLatitude,e.storeLongitude],{icon:b}).addTo(i);z.on("click",()=>{q(o,!0);const h=d.storeList[o];a.value={...h},x(h)}),V.push(z)}})},P=()=>{V.forEach(e=>{i&&i.removeLayer(e)}),V=[]},c=()=>{l&&i&&i.removeLayer(l);const e=H.value;e.lat&&e.lng&&(l=L.marker([e.lat,e.lng],{icon:Ie}).addTo(i))},k=()=>{V.forEach((e,o)=>{const b=o===v.value?se:ae;e.setIcon(b)})},q=(e,o=!1)=>{v.value=e,_("changeIndex",e),t(),o?k():setTimeout(()=>{k()},600)},O=()=>{P(),l&&i&&(i.removeLayer(l),l=null),i&&(i.remove(),i=null)};return ne(()=>{R()}),ie(()=>{O()}),C({initMap:R}),(e,o)=>{const b=K("VanList"),z=K("VanButton");return u(),I("div",Ge,[Je,r("div",Ke,[U(b,{loading:s.loading,"onUpdate:loading":o[0]||(o[0]=h=>de(loading)?loading.value=h:null),finished:s.finished,"immediate-check":!1,"loading-text":e.$t("common.loading"),onLoad:o[1]||(o[1]=h=>_("onLoad")),class:J(["overflow-y-auto h-fit px-4",p(f)?"min-h-[calc(30vh)] max-h-[calc(50vh)]":"min-h-[calc(30vh-78px)] max-h-[calc(50vh-78px)]"]),id:"list"},{default:Q(()=>[p(f)?(u(),D(re,{key:0,class:"!bg-transparent",name:e.$t("common.No stores yet")},null,8,["name"])):(u(!0),I(le,{key:1},ce(p(g),(h,N)=>(u(),I("div",{class:J(["w-full h-fit bg-white border-b-[0.5px] border-b-b4 border-solid py-4",{"!border-b-0":N===p(g).length-1}]),key:h.storeId,id:"item"+h.storeId},[U(De,{"store-info":h,selected:y(h),recentFlag:$(h),onSelect:j=>w(h,N)},null,8,["store-info","selected","recentFlag","onSelect"])],10,Qe))),128))]),_:1},8,["loading","finished","loading-text","class"]),p(f)?A("",!0):(u(),I("div",Xe,[U(z,{class:"submit-btn flex-1 bg-yellow text-b1 text-base font-semibold border-none h-[46px]",round:"",disabled:!a.value.storeId,onClick:E},{default:Q(()=>[ue(M(e.$t("common.select")),1)]),_:1},8,["disabled"])]))])])}}}),We=X(Ye,[["__scopeId","data-v-2b92e95a"]]),et={class:"w-full h-[calc(100vh-50px)] overflow-hidden"},tt={class:"h-[calc(100vh-50px)] bg-[#F2F0EF] relative"},ot={class:"px-3 pb-3 bg-white"},st={class:"h-[calc(100vh-50px-48px)]"},at=Z({setup(s){const{t:C}=ve(),_=Y(),d=W(),{cityMapStore:n}=G(),{getUserLocation:T}=ee(),{loadingToggle:m}=ye(),g=B(()=>{var t;return(t=_.query)==null?void 0:t.brandId}),a=B(()=>{var t;return(t=_.query)==null?void 0:t.storeId}),y=B(()=>{var t;return(t=_.query)==null?void 0:t.goodsId}),$=B(()=>{let t=g.value?C("city.Related branches"):C("city.Store List");return l.value.length&&(t+=`(${l.value.length})`),t}),f=F({keyword:""}),w=F(!1),x=F([]),E=async()=>{var t;if(f.value.keyword){v.value=!0,m(!0);const S=await oe({size:1,goodsId:y.value,keywords:f.value.keyword});if(v.value=!1,m(!1),!S.success)return;w.value=!0,x.value=((t=S.data)==null?void 0:t.records)||[]}else w.value=!1,x.value=[]},v=F(!1),i=F(!1),V=F(0),l=F([]),H=async()=>{var k,q,O,e,o,b,z,h;v.value=!0,m(!0);let t=[];(n.locationCoords.lat&&n.locationCoords.lng||(k=n.currentActiveCity)!=null&&k.areaLatitude&&((q=n.currentActiveCity)!=null&&q.areaLongitude))&&t.push("asc|distance");let S=t.length?t.join(","):null;const P={size:999,longitude:n.locationCoords.lng||((O=n.currentActiveCity)==null?void 0:O.areaLongitude)||null,latitude:n.locationCoords.lat||((e=n.currentActiveCity)==null?void 0:e.areaLatitude)||null,sortBy:S};let c;if(y.value?c=await oe({...P,goodsId:y.value}):c=await xe({...P,storeBrandId:g.value,neStoreId:a.value}),v.value=!1,m(!1),!c.success){i.value=!0;return}if(!c.data||!((o=c.data)!=null&&o.records)||!+((b=c.data)==null?void 0:b.total)){i.value=!0;return}if(l.value=((z=c.data)==null?void 0:z.records)||[],V.value=(h=c.data)==null?void 0:h.total,l.value=l.value.map((N,j)=>j===0?{...N,recentFlag:!0}:{...N,recentFlag:!1}),y.value&&a.value){const N=l.value.find(j=>j.storeId==a.value);l.value=l.value.filter(j=>j.storeId!=a.value),l.value.unshift(N)}l.value.length>=V.value&&(i.value=!0)},R=t=>{d.push(t)};return ne(async()=>{n.currentActiveCity||await T(),H()}),(t,S)=>{const P=K("router-view");return u(),D(pe,{title:p($),class:"bg-white font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(c,k)=>{k.searchRef=c}},{default:Q(()=>[r("div",et,[r("section",tt,[!l.value.length&&!v.value?(u(),D(re,{key:0,class:"!bg-transparent",name:t.$t("common.No stores yet")},null,8,["name"])):A("",!0),p(g)&&l.value.length?(u(),D(be,{key:1,ref:(c,k)=>{k.mapRef=c},storeList:l.value,storeComponent:Ee,"available-store":"",onHandleTo:R},null,8,["storeList"])):l.value.length?(u(),I(le,{key:2},[r("div",ot,[U(ge,{modelValue:f.value.keyword,"onUpdate:modelValue":S[0]||(S[0]=c=>f.value.keyword=c),placeholder:t.$t("city.Please enter the store name/address"),"search-button-text":t.$t("common.search"),onSearch:E,onClear:E},null,8,["modelValue","placeholder","search-button-text"])]),r("div",st,[U(We,{ref:(c,k)=>{k.mapRef=c},storeList:l.value,searchList:x.value,searchFlag:w.value,loading:v.value,finished:i.value,onHandleTo:R},null,8,["storeList","searchList","searchFlag","loading","finished"])])],64)):A("",!0)])]),U(P,{class:"child-view"})]),_:1},8,["title"])}}}),pt=X(at,[["__scopeId","data-v-60f42ac2"]]);export{pt as default};
