import{z as A,F as N,G as c,H as s,J as D,K as R,N as W,Z as h,U as b,I as U,Q as I,x as X,o as ee,q as te,r,y,D as ae,E as le,P as T,O as i,$ as oe,V as ue,by as ne}from"./vendor-Dr_RpJ_Y.js";import{_ as se}from"./GoodsEvaluateItem-aGarH2zl.js";import{_ as k}from"./DefaultPage-BhlLBoz9.js";import{_ as ie}from"./EvalHeader-BnKRlnel.js";import{az as V,k as P,cc as ve,cd as re,aO as de}from"./index-CU2nzZe6.js";import"./BackIcon-CDrGaEPo.js";const ce={class:"flex items-center gap-2 overflow-x-auto"},me=["onClick"],fe={key:1},ge=A({props:{list:null,value:null},emits:["change"],setup(x,{emit:p}){return(C,F)=>{const d=N("van-icon");return s(),c("div",ce,[(s(!0),c(D,null,R(x.list,u=>(s(),c("div",{class:W(["flex items-center flex-shrink-0 px-2 text-sm leading-6 rounded",{" bg-primary text-white":x.value===u.id,"bg-yellow-004":x.value!==u.id}]),key:u.id,onClick:a=>p("change",u.id)},[u.id===1?(s(),h(d,{key:0,class:"mr-1.5",name:"photo-o",size:"16"})):b("",!0),U("span",null,I(u.name),1),u.id?(s(),c("span",fe,"("+I(u.count)+")",1)):b("",!0)],10,me))),128))])}}}),pe={class:"px-2.5 font-normal"},he={class:"bg-white rounded-xl p-2.5 min-h-[calc(100%-44px)]"},Ce=A({name:"EvaluateGood"});function ye(x){const{t:p}=X(),C=ee(),F=te(),d=r(null),u=r(null),a=r({}),z=async()=>{const e={goodsId:u.value},t=await ve(e);t.success&&(a.value=t.data)},l=r(null),S=y(()=>{var t,o,g;let e=0;switch(l.value){case 1:e=0;break;case 2:e=(t=a.value)==null?void 0:t.goodNoPicAndTextCount;break;case 3:e=(o=a.value)==null?void 0:o.badNoPicAndTextCount;break;default:e=(g=a.value)==null?void 0:g.noPicAndTextCount;break}return e}),q=y(()=>{const e={goodsId:u.value,shopId:d.value,commentLevel:l.value};return"?"+Object.keys(e).map(t=>e[t]?`${t}=${e[t]}`:"").filter(t=>t).join("&")}),j=y(()=>{var e,t,o;return[{id:null,name:p("common.all"),count:H.value},{id:1,name:p("evaluate.picture"),count:((e=a.value)==null?void 0:e.havePicsCount)||0},{id:2,name:p("evaluate.Good reviews"),count:((t=a.value)==null?void 0:t.goodCount)||0},{id:3,name:p("evaluate.Bad review"),count:((o=a.value)==null?void 0:o.badCount)||0}]}),M=e=>{l.value!==e&&(l.value=e,B())},m=r(!1),f=r(!1),n=r([]),w=r(0),Y=r(20),$=r(0),H=y(()=>{var e,t,o,g,v,_,G;if(l.value===null)return(((e=a.value)==null?void 0:e.goodCount)||0)+(((t=a.value)==null?void 0:t.badCount)||0);switch(l.value){case 1:return((o=a.value)==null?void 0:o.havePicsCount)||0;case 2:return((g=a.value)==null?void 0:g.goodCount)||0;case 3:return((v=a.value)==null?void 0:v.badCount)||0;default:return(((_=a.value)==null?void 0:_.goodCount)||0)+(((G=a.value)==null?void 0:G.badCount)||0)}}),J=async()=>{m.value=!0;const e=l.value,t={page:w.value,size:Y.value,goodsId:u.value||null,shopId:d.value||null,commentStatus:1,commentType:null,sortBy:"desc|comment_time",havePicsFlag:null,haveContentFlag:null,havePicOrTextFlag:null};l.value==null&&(t.havePicOrTextFlag=!0),l.value==1&&(t.havePicsFlag=!0),l.value==2&&(t.commentType=2,t.havePicOrTextFlag=!0),l.value==3&&(t.commentType=1,t.havePicOrTextFlag=!0),Reflect.deleteProperty(t,"commentLevel");const o=await de(t);if(m.value=!1,!o.success){f.value=!0;return}if(!o.data||!o.data.total){f.value=!0;return}if(e!==l.value){f.value=!0;return}n.value=w.value===1?o.data.records:n.value.concat(o.data.records),$.value=o.data.total,n.value.length>=$.value&&(f.value=!0)},E=y(()=>{if(n.value&&n.value.length>0){const e=[];for(let t=0;t<n.value.length;t++)n.value[t].commentPics&&n.value[t].commentPics.length>0&&e.push(...n.value[t].commentPics.split(","));return e}return[]}),K=e=>{const t=E.value.findIndex(o=>o===e);ne({images:E.value,closeable:!0,showIndex:!0,startPosition:t})},O=async()=>{w.value+=1,await J()},B=()=>{n.value=[],w.value=0,$.value=0,f.value=!1,m.value=!1,O()},Q=async()=>{l.value=null,await z(),B()},L=e=>{F.push(e)};ae(()=>C.query.goodsId,e=>{C.path.includes("/offline-evaluate-home?goodsId=")&&u.value!==e&&u.value&&(u.value=e,Q())},{deep:!0,immediate:!0});const Z=async()=>{const e={shopId:d.value},t=await re(e);t.success&&(a.value=t.data)};return le(()=>{u.value=C.query.goodsId,d.value=C.query.shopId,u.value&&z(),d.value&&Z()}),(e,t)=>{const o=N("VanList"),g=N("router-view");return s(),c("div",pe,[T(ie,{title:d.value?e.$t("evaluate.shop review"):e.$t("evaluate.service review")},null,8,["title"]),U("div",he,[T(ge,{list:i(j),value:l.value,onChange:M},null,8,["list","value"]),l.value===2&&a.value.defaultGoodCount>0&&a.value.defaultGoodCount===a.value.goodCount?(s(),h(k,{key:0,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:i(P)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:i(V)(a.value.defaultGoodLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):l.value===null&&a.value.defaultGoodCount>0&&a.value.defaultGoodCount===a.value.totalCount?(s(),h(k,{key:1,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:i(P)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:i(V)(a.value.defaultGoodLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):!n.value.length&&i(S)>0?(s(),c("div",{key:2,class:"py-8 text-sm text-center",onClick:t[0]||(t[0]=v=>L("/offline-evaluate-default"+i(q)))},I(e.$t("evaluate.without content",{num:i(S)})),1)):f.value&&$.value===0?(s(),h(k,{key:3,needTextTop:!0,titleColor:"#A45E00",url:i(P)("images/evaluate_empty.png"),title:e.$t("evaluate.No reviews yet"),top:"9rem",iconSize:"16rem"},null,8,["url","title"])):!n.value.length&&!m.value?(s(),h(k,{key:4,needTextTop:!0,titleColor:"#A45E00",url:i(P)("images/evaluate_empty.png"),title:e.$t("evaluate.No reviews yet"),top:"9rem",iconSize:"16rem"},null,8,["url","title"])):b("",!0),T(o,{class:"mt-4",loading:m.value,"onUpdate:loading":t[2]||(t[2]=v=>m.value=v),finished:f.value,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:O},{default:oe(()=>[(s(!0),c(D,null,R(n.value,(v,_)=>(s(),h(se,{onImgPre:K,style:ue(_===n.value.length-1?"margin-bottom: 1rem":""),onClick:G=>L(`/offlineEvaluateView?id=${v.orderId}`),data:v,key:v.id},null,8,["style","onClick","data"]))),128)),!m.value&&(l.value===null&&a.value.noPicAndTextCount>0||l.value===2&&a.value.goodNoPicAndTextCount>0||l.value===3&&a.value.badNoPicAndTextCount>0)?(s(),c("div",{key:0,class:"text-sm text-center",onClick:t[1]||(t[1]=v=>L("/offline-evaluate-default"+i(q)))},I(e.$t("evaluate.without content",{num:l.value===null?a.value.noPicAndTextCount:a.value.goodNoPicAndTextCount})),1)):b("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])]),T(g,{class:"child-view bg-[#f2f0ef]"})])}}const Pe=A({...Ce,setup:ye});export{Pe as default};
