import{_ as se,z as O,q as U,y as le,F as I,G as f,H as n,I as s,P as k,O as a,Q as p,U as C,Z as _,a3 as M,X as ae,Y as ne,o as ie,x as ce,a2 as G,D,bl as de,r as w,E as ue,bm as re,$ as b,K as fe,J as me,a4 as ge,T as pe}from"./vendor-Dr_RpJ_Y.js";import{_ as he}from"./MCOIN-BOqZVkND.js";import{_ as ve}from"./store-CbLb3G6E.js";import{_ as ye}from"./shop-arrow-right-BueA_z4m.js";import{R as _e}from"./RatioBox-BwMA7vB_.js";import{_ as xe}from"./ImgBoutiqueLable-B-2xCcw4.js";import{e as be,a as q,B as ke,Y as Ce,w as $e,bS as we,bT as Ie}from"./index-CU2nzZe6.js";import{C as Se}from"./CommonVanProvider-KZuKVOde.js";import{_ as Te}from"./EmptyTipsPop-DC2OBzZY.js";import{B as Fe}from"./BetweenTab-nGcUWfRT.js";import{c as Le,e as Ve}from"./goods-CMFNhadQ.js";import"./shop-CeqcS6K2.js";import"./BackIcon-CDrGaEPo.js";/* empty css                                                               */const E=l=>(ae("data-v-06bfb6c0"),l=l(),ne(),l),Ae=["data-store-name"],Be={class:"shrink-0 offline-goods-img__wrap w-[80px] h-[80px] overflow-hidden relative"},Ne={class:"offline-goods-info__wrap ml-2 flex-1 flex flex-col justify-between min-h-[80px]",style:{width:"calc(100% - 80px - 8px)"}},De={class:"w-full flex flex-col items-start"},Oe={class:"w-full"},Ee={class:"font-semibold text-sm line-clamp-1 text-b1"},Pe={class:"flex items-center justify-start font-Puhui mt-1"},Re={class:"flex items-center"},je=E(()=>s("img",{src:he,class:"w-4 h-4 mr-1"},null,-1)),ze={class:"text-b1 font-semibold text-sm"},Ge={key:0,class:"mx-2"},qe={class:"text-b3 text-sm font-normal"},Ue={class:"w-full"},Me=E(()=>s("img",{src:ve,class:"shrink-0 w-4 h-4 line-clamp-1"},null,-1)),Ye={key:0,class:"line-clamp-1"},He={key:1,class:"line-clamp-1"},Je=E(()=>s("img",{src:ye,class:"w-4 h-4"},null,-1)),Ke=O({props:{goods:{type:Object,default:()=>({})},isOffline:{type:Boolean,default:!1}},emits:["select"],setup(l,{emit:L}){const u=l;U();const V=le(()=>{var m,$;return(u.isOffline||!1?(m=u.goods.goodsIcons)==null?void 0:m.split(","):(($=u.goods.icons)==null?void 0:$.split(","))||[""])[0]}),S=h=>{L("select",h)};return(h,r)=>{const m=I("VanImage");return n(),f("section",{class:"flex items-start","data-store-name":l.goods.shopName},[s("div",Be,[k(m,{src:a(V),class:"offline-goods-img w-[80px] h-[80px] rounded-lg overflow-hidden",alt:h.$t("goods.goodsImage"),fit:"cover"},null,8,["src","alt"]),k(xe,{type:l.isOffline?+l.goods.goodsType:+l.goods.type},null,8,["type"])]),s("div",Ne,[s("div",null,[s("div",De,[s("div",Oe,[s("div",Ee,p(l.goods.goodsName||""),1)])]),s("div",Pe,[s("div",Re,[je,s("div",ze,p(a(be)(l.goods.price||l.goods.goodsPrice)),1)]),l.goods.changedAmount?(n(),f("div",Ge,[s("p",qe,[s("span",null,"收藏后"+p(+l.goods.changedAmount>0?"涨":"降")+p(Math.abs(l.goods.changedAmount)),1)])])):C("",!0),l.goods.discountRatio||l.goods.goodsDiscountRatio?(n(),_(_e,{key:1,class:"ratio-box ml-1 !px-1",tag:h.$t("common.rebate"),ratio:l.goods.discountRatio||l.goods.goodsDiscountRatio},null,8,["tag","ratio"])):C("",!0)])]),s("div",Ue,[s("div",{class:"font-normal text-b3 text-sm flex items-center justify-start",onClick:r[0]||(r[0]=M($=>S(l.goods.shopId),["stop"]))},[Me,l.isOffline?(n(),f("span",Ye,p(!l.goods.shopName&&!l.goods.storeName?"--":l.goods.shopName+(l.goods.storeName?"·"+l.goods.storeName:"")),1)):(n(),f("span",He,p(l.goods.storeName||"--"),1)),Je])])])],8,Ae)}}}),Qe=se(Ke,[["__scopeId","data-v-06bfb6c0"]]),Xe={class:"flex items-center justify-start gap-1"},Ze=["src"],We=s("span",{class:"text-b2 text-sm font-normal"},"取消",-1),et=[We],tt=s("span",{class:"text-b2 text-sm font-normal"},"编辑",-1),ot=[tt],st={class:"scrollPage p-3 h-[calc(100vh-83px)] overflow-y-auto"},lt={class:"flex items-center justify-start"},at={key:0,class:"flex-shrink-0 mr-3"},nt={class:"w-full"},it={class:"bg-white rounded-xl p-2.5 mb-2.5"},ct={key:0,class:"fixed bottom-0 left-0 right-0 bg-[#F5F5F5] p-3 pb-[calc(12px+env(safe-area-inset-bottom))] flex items-center justify-between"},dt={class:"flex-shrink-0 flex items-center justify-start gap-2 mr-3"},ut={key:0},rt=O({name:"GoodsCollect"});function ft(l){const{regionStore:L}=q(),u=U(),V=ie(),{t:S}=ce(),{loadingToggle:h}=$e(),[r,m]=G(!1),[$,A]=G(!1),{accountStore:P}=q(),Y=[{label:S("shop.on-line"),value:1},{label:S("shop.off-line"),value:2}];D(()=>P.account,(e,o)=>{e&&e!==o&&(console.log("账号切换，清空列表"),setTimeout(()=>{location.reload()},50))}),D(()=>P.isLogin,(e,o)=>{e&&setTimeout(()=>{location.reload()},50)});const H=e=>{c.value=[],v.value=[],g.value=!1,m(!1),t.type=e||1,u.replace({query:{type:e}}),B()},t=de({type:Number(V.query.type)||1,page:0,size:10,loading:!1,finished:!1,flattenedList:[],total:0}),c=w([]),v=w([]),R=w(null),g=w(!1),J=(e,o)=>{var d,x;t.type===1?r.value?(d=v.value[o])==null||d.toggle():u.push(`/goodsDetail?id=${e.goodsId}&activated=1`):r.value?(x=v.value[o])==null||x.toggle():u.push(`/offlineGoodsDetail?goodsId=${e.goodsId}${e.storeId?`&storeId=${e.storeId}`:""}&activated=1`)},K=(e,o)=>{var d;r.value?(d=v.value[o])==null||d.toggle():u.push(`/category?deliveryType=1&shopId=${e}&activated=1`)},j=()=>{g.value?c.value=t.flattenedList.map(o=>t.type===2?o.collectId:o.goodsId):c.value=[]},Q=()=>{var e;(e=R.value)==null||e.toggle(),j()};D(c,e=>{e.length&&e.length>=t.flattenedList.length?g.value=!0:g.value=!1});const X=async()=>{if(c.value.length===0){pe("请选择要删除的商品");return}h(!0);let e=null;t.type===1?e=await Le({goodsIds:c.value,type:2}):e=await we({ids:c.value}),h(!1),e.success&&(A(!0),B(),c.value=[],v.value=[],g.value=!1),setTimeout(()=>{A(!1)},1e3)},z=async()=>{t.loading=!0,t.page+=1,await Z(),t.loading=!1},Z=async()=>{let e=null;if(t.type===1)e=await Ve({page:t.page,size:t.size});else if(t.type===2){const o=await Ie({page:t.page,size:t.size,sortBy:"desc|create_time"});e={success:o.success,data:o.data.records||[],total:o.data.total||0}}if(!e.success){t.finished=!0;return}if(!e.data||!e.total){t.finished=!0;return}t.total=e.total,t.flattenedList=t.page===1?e.data:t.flattenedList.concat(e.data),g.value&&(c.value=t.flattenedList.map(o=>t.type===2?o.collectId:o.goodsId)),t.flattenedList.length>=t.total&&(t.finished=!0)},B=()=>{t.page=0,t.total=0,t.finished=!1,t.flattenedList=[],z()};let T=null;const W=async()=>{const e=localStorage.getItem("goodsCollect_scrollTop");+e?(console.log("setCacheScrollTop",+e),T.scrollTo({top:+e,left:0,behavior:"instant"})):localStorage.removeItem("goodsCollect_scrollTop")},N=w(!1),ee=()=>{N.value||(N.value=!0,setTimeout(()=>{localStorage.setItem("goodsCollect_scrollTop",T.scrollTop+""),N.value=!1},500))};return ue(()=>{T=document.querySelector(".scrollPage"),T.addEventListener("scroll",ee)}),re(()=>{var e,o,d,x;console.log("onActivated"),W(),!(((x=(d=(o=(e=u==null?void 0:u.options)==null?void 0:e.history)==null?void 0:o.state)==null?void 0:d.forward)==null?void 0:x.indexOf("activated=1"))>-1&&t.flattenedList.length)&&(c.value=[],v.value=[],g.value=!1,m(!1),B())}),(e,o)=>{const d=I("van-checkbox"),x=I("van-checkbox-group"),te=I("van-list"),oe=I("VanButton");return n(),_(Se,{class:"bg-[#F5F5F5] font-Puhui font-normal relative shopGoodsPage",title:"商品收藏","theme-vars":{"field-placeholder-text-color":"#F5F5F5"}},{title:b(()=>[s("div",Xe,[s("div",null,[s("img",{src:a(Ce)(`mall/${a(L).country}-flag.svg`),class:"w-4 h-auto"},null,8,Ze)]),s("span",null,p(e.$t("collect.goodsCollect")),1)])]),right:b(()=>[s("div",null,[a(r)===!0?(n(),f("div",{key:0,onClick:o[0]||(o[0]=i=>a(m)(!1))},et)):(n(),f("div",{key:1,onClick:o[1]||(o[1]=i=>a(m)(!0))},ot))])]),default:b(()=>[s("div",null,[k(Fe,{class:"between-tab__wrap",options:Y,"label-key":"label","value-key":"value",modelValue:a(t).type,"onUpdate:modelValue":o[2]||(o[2]=i=>a(t).type=i),onChange:H},null,8,["modelValue"]),s("div",st,[a(t).flattenedList.length===0&&!a(t).loading?(n(),_(ke,{key:0,name:e.$t("common.No products")},null,8,["name"])):(n(),_(te,{key:1,loading:a(t).loading,"onUpdate:loading":o[4]||(o[4]=i=>a(t).loading=i),"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),finished:a(t).finished,onLoad:z,"immediate-check":!0},{default:b(()=>[(n(!0),f(me,null,fe(a(t).flattenedList,(i,F)=>(n(),_(x,{key:i.goodsId||i.collectId,modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=y=>c.value=y),"checked-color":"#FEA021","icon-size":"16"},{default:b(()=>[s("div",lt,[a(r)?(n(),f("div",at,[a(t).type===2?(n(),_(d,{key:0,name:i.collectId,ref:y=>v.value[F]=y},null,8,["name"])):(n(),_(d,{key:1,name:i.goodsId,ref:y=>v.value[F]=y},null,8,["name"]))])):C("",!0),s("div",nt,[s("div",it,[k(Qe,{"is-offline":a(t).type==2,goods:i,showStoreName:!0,onClick:M(y=>J(i,F),["stop"]),onSelect:y=>K(y,F)},null,8,["is-offline","goods","onClick","onSelect"])])])])]),_:2},1032,["modelValue"]))),128))]),_:1},8,["loading","finished-text","loading-text","finished"]))])]),a(r)?(n(),f("div",ct,[s("div",dt,[k(d,{modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=i=>g.value=i),"checked-color":"#FEA021","icon-size":"16",ref:i=>R.value=i,onClick:j},null,8,["modelValue"]),s("span",{class:"text-b3 text-sm font-normal",onClick:Q},"全选")]),k(oe,{class:"main-btn flex-center text-white font-semibold rounded-full !bg-[#f44] text-base w-full h-[46px]",onClick:X},{default:b(()=>[ge(p(e.$t("common.delete"))+" ",1),c.value.length>0?(n(),f("span",ut," ("+p(c.value.length)+") ",1)):C("",!0)]),_:1})])):C("",!0),a($)?(n(),_(Te,{key:1,isError:!1,onClose:o[6]||(o[6]=i=>a(A)(!1)),text:"删除成功"})):C("",!0)]),_:1})}}const St=O({...rt,setup:ft});export{St as default};
