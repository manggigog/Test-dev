import{_ as F,y as b,w as $,a1 as U,l as R,r as f,z as E,E as i,F as _,a2 as P,G as v,O as l,H as t,I as z,J as B,Q as m,N as x,X as G,P as T,T as h}from"./vendor-BUT0HZ5j.js";import{_ as N}from"./GoodInfo-lZ6wAGwS.js";import{g as O,a2 as j,q,V as D}from"./index-DDhEkd_5.js";import{_ as A}from"./EvalHeader-CWDe7Hp8.js";import{u as H}from"./upload-SVPQ0wFR.js";import{s as J,g as M}from"./order-Cwtc0PLp.js";import"./GoodsPrice-Ai76_1qQ.js";import"./MCOIN-BcbOHmhy.js";import"./CardPrice-peztQwSc.js";import"./order-H59PKTFP.js";import"./BackIcon-biFt6cm7.js";const Q={key:0,class:"px-2.5 font-normal text-black"},X={class:"mt-4 text-base font-normal bg-white rounded-xl"},Y={class:"flex items-center px-2.5 pt-2.5"},K={class:"mr-1"},W={class:"flex items-center p-2.5 border-b border-solid border-[#F6F6F5]"},Z={class:"mr-1"},ee={class:"p-2.5"},te={class:"rounded-xl bg-[#F6F6F5]"},ae={class:"mt-4 text-base font-normal bg-white px-2.5 pt-[14px] rounded-xl"},oe={class:""},se={class:"mr-[8px] mb-[8px] w-full h-full"},ne=["src"],le={class:"mt-1 text-xs font-light text-center text-default"},re={class:"flex justify-center pb-10 mt-10"},de={class:"text-base"},ce=b({name:"EvaluatePost"});function ie(ue){const{t:S}=$(),u=U(),g=R(),c=f(null),d=f(null),V=async()=>{const e=await M({orderId:c.value});e.success&&(e.data.dataList=e.data.dataList.map(n=>({...n,commentStar:5,commentShopStar:5,imgList:[]})),d.value=e.data)},w=async(e,n)=>{const o=await j(e,"goodsImg"),r=await H(o);if(!r.success)return n.imgList.length-=1;n.imgList[n.imgList.length-1]={url:q.imgUrl+r.data}},p=f(!1),L=async()=>{const e=d.value.dataList.map(o=>({orderGoodsId:o.id,commentContent:o.commentContent,commentStar:o.commentStar,commentShopStar:o.commentShopStar,commentImages:o.imgList.map(r=>r.url).join(",")}));p.value=!0;const n=await J({dataList:e});p.value=!1,n.success&&(h.setDefaultOptions({forbidClick:!0}),h({message:S("evaluate.Evaluation success"),icon:D("toast-success.svg"),duration:2e3}),setTimeout(()=>{u.params.refresh="1",g.back()},2e3))},y=e=>{g.push(e)};return E(()=>u.query.orderId,e=>{u.path==="/evaluate-post"&&(c.value!==e||c.value===null)&&(c.value=e,V(),h.setDefaultOptions({forbidClick:!0}))},{deep:!0,immediate:!0}),(e,n)=>{const o=i("van-rate"),r=i("van-field"),I=i("van-uploader"),C=i("VanButton");return d.value?(v(),_("div",Q,[l(A,{title:e.$t("evaluate.Post a review")},null,8,["title"]),(v(!0),_(z,null,B(d.value.dataList,(a,k)=>(v(),_("div",{class:"mb-8",key:k},[l(N,{orderGoodInfo:a,order:d.value.order,onHandleTo:y},null,8,["orderGoodInfo","order"]),t("div",X,[t("div",Y,[t("span",K,m(e.$t("evaluate.Product Rating")),1),l(o,{modelValue:a.commentStar,"onUpdate:modelValue":s=>a.commentStar=s,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",W,[t("span",Z,m(e.$t("evaluate.Store Rating")),1),l(o,{modelValue:a.commentShopStar,"onUpdate:modelValue":s=>a.commentShopStar=s,size:20,color:"#FEA021"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",ee,[t("div",te,[l(r,{maxlength:"200",modelValue:a.commentContent,"onUpdate:modelValue":s=>a.commentContent=s,rows:"8",autosize:"",label:"",type:"textarea","show-word-limit":"",placeholder:a.commentStar<3&&a.commentStar>0?e.$t("evaluate.help merchants improve"):e.$t("evaluate.praise")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])])]),t("div",ae,[t("div",oe,[l(I,{modelValue:a.imgList,"onUpdate:modelValue":s=>a.imgList=s,accept:"image/*","max-count":3,"preview-size":"100%",afterRead:s=>{w(s,a)}},{default:x(()=>[t("div",se,[t("div",{style:G(a.imgList.length==0?"height: 100px;width: 100px":""),class:"flex flex-col items-center justify-center w-full h-full text-center text-black border border-dashed border-black-400"},[t("img",{src:T(O)("images/addPic.png"),class:"w-[50px] h-[50px]"},null,8,ne),t("div",le,m(a.imgList.length==2?e.$t("evaluate.You can also add one"):e.$t("common.add img")),1)],4)])]),_:2},1032,["modelValue","onUpdate:modelValue","afterRead"])])])]))),128)),t("div",re,[l(C,{loading:p.value,onClick:L,round:"",class:"h-10 min-w-[180px] px-5 font-semibold text-white btn-linear-primary"},{default:x(()=>[t("span",de,m(e.$t("evaluate.Post a review")),1)]),_:1},8,["loading"])])])):P("",!0)}}const me=b({...ce,setup:ie}),Le=F(me,[["__scopeId","data-v-0bbce882"]]);export{Le as default};
