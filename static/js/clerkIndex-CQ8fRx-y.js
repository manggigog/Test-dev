import{y as b,x as H,bt as Y,F as B,G as g,H as l,a2 as I,bc as Z,K as R,P as r,Q as x,_ as U,E as ee,N as T,O as w,a0 as A,w as te,a1 as se,l as oe,be as E,bf as ae,r as v,z as ne,D as le,bh as re,T as ie}from"./vendor-BUT0HZ5j.js";import{a as ce,_ as ue}from"./SelectShopPop-DMV_p9NH.js";import{e as O,_ as de,b$ as fe,c0 as pe,O as me}from"./index-DDhEkd_5.js";import{a as he,b as ve}from"./Merchant-B6rRV8oM.js";import{g as we,u as ge}from"./user-C4TFdpwb.js";import"./close-DLkDHnDK.js";import"./shop-CeqcS6K2.js";import"./level-BMr8jGFx.js";import"./offlineGoods-DvT2Go6q.js";import"./profileEnum-CXsMKuND.js";import"./UpgradeStorePop-DqZDeSGY.js";import"./BoutiqueLable-r45nG6V6.js";import"./order-Cwtc0PLp.js";import"./notice-Ddr2l1wk.js";import"./mall-N84L-sAF.js";const xe={class:"mb-4 bg-[#FFF] rounded-[12px] p-[12px] text-sm font-normal"},_e={class:"flex items-center w-full justify-between"},ke={class:"shrink-1 flex items-center w-full"},ye={class:"shrink-0 relative"},be={class:"w-[40px] h-[40px] aspect-square object-cover bg-black-100 rounded-[4px]",fit:"cover"},Ce={class:"flex flex-col items-start justify-between w-full ml-2 text-sm"},Se={class:"flex items-center w-full text-sm font-semibold text-[#2E2008]"},$e={class:"truncate"},Ne={class:"text-xs text-[#999] mt-[2px]"},Le={key:0,class:"shrink-0 w-fit h-[22px] px-[8px] text-[12px] leading-[20px] border border-solid rounded-2xl text-[#FF8812] border-[#FF8812]"},Pe=b({props:{shopList:{default:()=>[]}},emits:["click"],setup(c,{emit:f}){const{accountStore:s}=O(),n=H(()=>s.store||{});return(p,u)=>{const h=Y("lazy");return g(),B("div",xe,[l("section",{class:"relative",onClick:u[0]||(u[0]=_=>c.shopList&&c.shopList.length>0?f("click"):"")},[l("div",_e,[l("div",ke,[l("div",ye,[Z(l("img",be,null,512),[[h,r(n).logo]]),r(n).type?(g(),R(ce,{key:0,class:"absolute right-0 top-0 z-2 mr-0",type:r(n).type},null,8,["type"])):I("",!0)]),l("div",Ce,[l("div",Se,[l("div",$e,x(r(n).storeName),1)]),l("div",Ne,x(p.$t("storeClerk.Store Management")),1)])]),c.shopList&&c.shopList.length>0?(g(),B("div",Le,x(p.$t("storeClerk.Switch store")),1)):I("",!0)])])])}}}),Fe={class:"py-8 text-base text-center text-black"},Te={class:"flex"},Be=b({props:{show:{type:Boolean},data:null,loading:{type:Boolean}},emits:["close","confirm"],setup(c,{emit:f}){return(s,n)=>{const p=ee("van-button");return g(),R(de,{noClose:!0,width:"90%",show:c.show,name:s.$t("common.tip"),teleport:"body",onClose:n[2]||(n[2]=()=>{f("close")})},{default:T(()=>{var u,h;return[l("div",Fe,x(s.$t("storeClerk.noticeTip",{shop:(h=(u=c.data)==null?void 0:u.shop)==null?void 0:h.storeName})),1),l("div",Te,[w(p,{loading:c.loading,class:"plain-btn w-1/2 mx-2.5 text-[#FEA021] font-semibold",onClick:n[0]||(n[0]=()=>{f("confirm",2)})},{default:T(()=>[A(x(s.$t("common.reject")),1)]),_:1},8,["loading"]),w(p,{loading:c.loading,class:"w-1/2 mx-2.5 btn-orange btn-shadow text-white font-semibold",onClick:n[1]||(n[1]=()=>{f("confirm",1)})},{default:T(()=>[A(x(s.$t("common.agree")),1)]),_:1},8,["loading"])])]}),_:1},8,["show","name"])}}}),Ie=U(Be,[["__scopeId","data-v-4279a62e"]]),y={"|-1|":["allOrder","offlineOrder","cashierCollect","fund","goods","service","shop","category","shippingTemplate","clerk"],"|1|":["allOrder"],"|4|":["offlineOrder","cashierCollect","fund"],"|2|":["goods","service","shop","category","shippingTemplate"],"|3|":["cashierCollect","fund"]},Oe={class:"linear-bg"},Re={class:"w-full z-[10] overflow-hidden p-[12px] pt-[16px]"},De=b({name:"ClerkIndex"});function ze(c){const{t:f}=te(),{accountStore:s,clerkStore:n}=O();O();const p=se(),u=oe(),[h,_]=E(!1),[q,C]=E(!1),D=ae({userInfo:{address:s.account}}),z=async()=>{const e=await ge(s.account);!e.success||!e.data||(D.userInfo=e.data)},S=v(!1),k=v(null),d=v([]),M=async()=>{var t,o,a,m;const e=await me();if(e.success){if(d.value=e.data||[],(t=s.store)!=null&&t.merchant){const i=d.value.find(X=>{var j;return X.merchant===((j=s.store)==null?void 0:j.merchant)});if(i){k.value=i==null?void 0:i.pers,N(i==null?void 0:i.id),await s.changeStore(i),await F(i==null?void 0:i.id),S.value=!0;return}}N((o=d.value[0])==null?void 0:o.id),await s.changeStore(d.value[0]||{}),await F((a=d.value[0])==null?void 0:a.id),k.value=(m=d.value[0])==null?void 0:m.pers,S.value=!0}},$=v(null),N=async e=>{if(!e)return;const{success:t,data:o}=await pe(e);t&&o&&(C(!0),$.value=o)},L=v(!1),G=async e=>{var o;L.value=!0;const{success:t}=await fe({id:(o=$.value)==null?void 0:o.id,agreeFlag:e});L.value=!1,t&&(ie(f("admin.Successful-operation")),C(!1))},V=v(null),P=async()=>{var e;(e=V.value)==null||e.init()},K=async e=>{k.value=e==null?void 0:e.pers,N(e==null?void 0:e.id),await s.changeStore(e),await F(e==null?void 0:e.id),_(!1),P()},F=async e=>{e&&await we(e)},Q=e=>{e==="/collect"?u.push({path:e,query:{from:"clerk"}}):u.push(e)},J=(e,t)=>{u.replace({path:e,query:t})},W=H(()=>{var o;if(s.isOnlyView)return y["|-1|"].filter(a=>a!=="clerk");if(!n.isClerk)return y["|-1|"];const e=(o=k.value)==null?void 0:o.split(",");if(!e||e.length<1)return[];let t=[];for(let a=0;a<e.length;a++){const m=e[a];y[m]&&(t=[...y[m],...t])}return t});return ne(()=>p.path,async e=>{console.log("route val",e),e==="/clerk/index"&&(await z(),await M(),P())},{immediate:!0,deep:!0}),le(async()=>{const e=new Date().getTime();sessionStorage.setItem("browser_clerk",e.toString())}),re(async()=>{await z(),await M(),P()}),(e,t)=>{var o;return g(),B("div",Oe,[w(he,{info:r(D).userInfo},null,8,["info"]),l("div",Re,[w(Pe,{onClick:t[0]||(t[0]=a=>r(_)(!0)),shopList:d.value},null,8,["shopList"]),S.value?(g(),R(ve,{key:0,isClerk:!0,Permissions:r(W),ref:(a,m)=>{m.MerchantRef=a,V.value=a},onHandleTo:Q,onHandleReplace:J},null,8,["Permissions"])):I("",!0)]),w(ue,{list:d.value,show:r(h),shopId:(o=r(s).store)==null?void 0:o.id,onClose:t[1]||(t[1]=a=>r(_)(!1)),onOnSelect:K},null,8,["list","show","shopId"]),w(Ie,{show:r(q),onClose:t[2]||(t[2]=a=>r(C)(!1)),onConfirm:G,data:$.value,loading:L.value},null,8,["show","data","loading"])])}}const Me=b({...De,setup:ze}),et=U(Me,[["__scopeId","data-v-3e3aed7e"]]);export{et as default};
