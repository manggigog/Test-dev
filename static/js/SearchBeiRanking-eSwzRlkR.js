import{_ as Q,z as D,o as X,q as Y,y as T,bl as Z,r as n,a2 as A,F as w,G as x,H as c,I as s,Z as p,U as q,P as S,$ as v,Q as I,O as a,J as W,K as ee,N as oe,X as te,Y as se}from"./vendor-Dr_RpJ_Y.js";import{R as ne}from"./RankingShopItem-BHW7aZsr.js";import{S as ae}from"./ShopVotePop-PbpHxtVT.js";import{B as le}from"./BackIcon-CDrGaEPo.js";import{q as re,b as ce}from"./beiRanking-CgdREoPr.js";import{bB as ie}from"./index-BckdT6oc.js";import"./Lottie_v2-DIiMHpUu.js";import"./member-BZWba7V1.js";import"./SkewCard-DgRGn20p.js";import"./shop-CeqcS6K2.js";import"./beiExtRewardContract-C7XtXvNV.js";import"./beiConstContract-CxYXBNkI.js";import"./useKeyboard-DcWqtm11.js";const de=d=>(te("data-v-a3e15d46"),d=d(),se(),d),ue={style:{"background-color":"white"},class:"relative z-50 h-full min-h-screen overflow-y-hidden parent-view mall-header-bg"},he={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},pe={class:"flex relative justify-center items-center h-[44px] px-2.5"},ve={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},me={class:"font-semibold"},fe={class:"px-2.5"},ke={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},_e=de(()=>s("div",{class:"h-[16px]"},null,-1)),ge={class:"bg-white rounded-t-2xl"},ye=D({name:"SearchBeiRanking"});function we(d){const b=X(),N=Y(),R=T(()=>{var e;return((e=b.query)==null?void 0:e.month)||1e4}),i=Z({keyword:""}),V=n(null),E=T(()=>{var e;return+ie()==+((e=b.query)==null?void 0:e.month)}),F=e=>{e.code==="Enter"&&(z(),V.value.blur())},K=()=>{z()},$=async()=>{m.value=!0,h.value+=1,await H(),m.value=!1},z=()=>{h.value=0,u.value=!1,l.value=[],$()},m=n(!1),u=n(!1),h=n(0),M=n(10),f=n(0),l=n([]),U=e=>{N.push(e)},k=n({shopId:null}),[B,L]=A(!1),j=e=>{k.value=e,L(!0)},G=e=>{U(`/talentRanking/rankingShop?shopId=${e.shopId}`)},H=async()=>{const{success:e,data:o}=await ce({page:h.value,size:M.value,month:R.value,shopNameLike:i.keyword});if(!e||!o||!(o!=null&&o.total)){f.value=(o==null?void 0:o.total)||0,u.value=!0;return}f.value=o.total;const r=o==null?void 0:o.records;l.value=h.value===1?r:l.value.concat(r),l.value&&l.value.length>=f.value&&(u.value=!0)},J=async(e,o)=>{e!=null&&e.shopId&&(o.direct===200?e.score+=o==null?void 0:o.differ:e.score-=o==null?void 0:o.differ,setTimeout(async()=>{const{success:r,data:_}=await re({shopId:e==null?void 0:e.shopId,month:R.value});r&&(e=_)},5e3))};return(e,o)=>{var P;const r=w("van-icon"),_=w("van-field"),O=w("VanList");return c(),x("div",ue,[s("section",he,[s("section",pe,[s("div",ve,[S(le,null,{default:v(()=>[s("span",null,I(e.$t("common.return")),1)]),_:1})]),s("div",me,I(e.$t("common.search")),1)]),s("section",fe,[S(_,{ref:(t,g)=>{g.searchRef=t,V.value=t},"model-value":a(i).keyword,"onUpdate:model-value":o[0]||(o[0]=t=>a(i).keyword=t),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:F,placeholder:e.$t("mall.Enter search keywords"),enterkeyhint:"search"},{"left-icon":v(()=>[a(i).keyword?q("",!0):(c(),p(r,{key:0,name:"search",size:"18"}))]),"right-icon":v(()=>[s("div",{onClick:K},[a(i).keyword?(c(),p(r,{key:1,name:"search",size:"18"})):(c(),x("div",ke,I(e.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),_e]),s("div",ge,[S(O,{loading:m.value,finished:u.value,onLoad:$,"finished-text":e.$t("common.noMore"),class:"min-h-[40vh] pt-2 pb-0.5 bg-white rounded-t-2xl relative shadow-box z-10"},{default:v(()=>[(c(!0),x(W,null,ee(l.value,(t,g)=>{var C;return c(),p(ne,{key:t.id,rankItem:t,showPower:a(E),onVoteShop:y=>j(t),onToDetail:y=>G(t),onVoteSuccess:o[1]||(o[1]=y=>J(k.value,y)),class:oe(["relative",{"active-bottom":g+1!==((C=l.value)==null?void 0:C.length)}])},null,8,["rankItem","showPower","onVoteShop","onToDetail","class"])}),128))]),_:1},8,["loading","finished","finished-text"])]),a(B)?(c(),p(ae,{key:0,show:a(B),shopId:(P=k.value)==null?void 0:P.shopId,onClose:o[2]||(o[2]=t=>a(L)(!1))},null,8,["show","shopId"])):q("",!0)])}}const xe=D({...ye,setup:we}),De=Q(xe,[["__scopeId","data-v-a3e15d46"]]);export{De as default};
