import{y as C,F as r,G as s,H as t,a4 as A,P as L,a2 as f,Q as $,_ as J,a0 as te,w as V,l as se,E as M,K as k,O as K,T as F,I as N,r as x,x as ae,z as W,D as oe,J as O,ab as R,N as le,ba as z,bb as E}from"./vendor-CjApaIpB.js";import{_ as Q}from"./buy-cart-3M2I0Qjc.js";import{al as ne,d as ie,g as G,r as de}from"./index-DBW_ANsl.js";import{D as U}from"./goods-BVwS8oFG.js";import{_ as X}from"./ShopMaskTips-DfjY93ZI.js";import{S as j}from"./shop-CeqcS6K2.js";import{_ as Y}from"./GoodsPrice-6cXbNaVi.js";import{q as ce}from"./mall-D_OmOdlH.js";import{q as ue}from"./cart-D7GC_lNI.js";const re=["src"],me=C({name:"ActivePlaceholder"});function ge(e){return(g,m)=>{var n,h;return s(),r("div",{onClick:m[0]||(m[0]=A(i=>{var o;return L(ne)((o=e.info)==null?void 0:o.activePath)},["stop"])),class:"rounded-lg overflow-hidden min-h-[20px]"},[t("img",{src:e.type?(n=e.info)==null?void 0:n.activeImgGrid:(h=e.info)==null?void 0:h.activeImg,alt:""},null,8,re)])}}const Z=C({...me,props:{info:null,type:null},setup:ge}),ve={key:0,class:"text-xs bg-[#FBA923] rounded-sm px-1 leading-normal mr-2.5 whitespace-nowrap text-white"},_=C({props:{type:{default:0}},setup(e){return(g,m)=>e.type!==L(j).SD?(s(),r("div",ve,$(e.type===L(j).SL?"精":e.type===L(j).PR?"优":"星"),1)):f("",!0)}}),fe={class:"absolute top-0 right-0 items-center gap-1 px-1.5 py-1 text-xs font-normal bg-ratio text-black-800 no-wrap rounded-tr-lg rounded-bl-lg"},he={class:"font-semibold"},ye=te("%"),xe=C({props:{ratio:null,tag:null},setup(e){const{ratio:g,tag:m}=e;return(n,h)=>(s(),r("div",fe,[t("span",null,$(e.tag||n.$t("common.ratio")),1),t("span",null,[t("span",he,$(L(ie)(e.ratio||0)),1),ye])]))}}),ee=J(xe,[["__scopeId","data-v-6a6fc0c6"]]),ke={key:1,class:"relative w-full h-full text-right bg-white rounded-lg"},pe={class:"w-full max-h-[250px] relative overflow-hidden"},$e=["src"],Te={class:"px-1.5 pb-2.5"},we={key:0,class:"mb-0.5 text-black-900 text-sm mt-1 text-left leading-normal flex items-center"},be={class:"font-semibold line-clamp-1 h-[22px] leading-[22px]"},Ce={key:1,class:"w-full mb-1"},Ie={key:2,class:"text-xs leading-tight tracking-tight text-left line-clamp-2 text-black-400"},Ae={class:"flex items-center mt-1 text-sm font-bold"},Le={class:"flex-1 pr-1.5"},Se={class:"mr-1.5 max-w-[60px] line-clamp-1 opacity-60 text-xxs"},Pe={class:"text-black mr-2.5 flex items-center"},Be={class:"mr-1 underline text-xxs underline-offset-2 whitespace-nowrap"},De=t("span",null," > ",-1),He=t("div",{class:"w-5 h-5 rounded-full flex justify-center items-center bg-[#FBA923] text-white text-sm"}," + ",-1),qe=[He],Fe=t("img",{class:"w-6 h-6",src:Q},null,-1),Ne=[Fe],Ge=C({name:"GoodsGridItem"});function je(e,{emit:g}){const{t:m}=V(),n=se(),h=a=>{n.push(a)},i=a=>{a.goods.id&&n.push(`goodsDetail?id=${a.goods.id}`)},o=async a=>{if(a.goods.stock===0&&a.goods.goodsTypes!=2){F(m("order.Insufficient stock"));return}g("handleAddCart",a.goods)};return(a,l)=>{var b;const T=M("van-skeleton");return s(),r("div",{class:"mb-2 text-center",onClick:l[5]||(l[5]=c=>i(e.item))},[(b=e.item)!=null&&b.activeType?(s(),k(Z,{key:0,info:e.item,type:"grid",onHandleTo:l[0]||(l[0]=c=>h(c))},null,8,["info"])):e.item.goods?(s(),r("div",ke,[t("div",pe,[(e.item.goods.status!=1||!+e.item.goods.stock)&&e.item.goods.goodsTypes!=2?(s(),k(X,{key:0,status:e.item.goods.status,stock:e.item.goods.stock},null,8,["status","stock"])):f("",!0),t("img",{src:e.item&&e.item.goods&&e.item.goods.icons&&e.item.goods.icons.split(",")[0]||L(G)("images/activity/boutique/squre_empty.png"),alt:"",class:"object-cover w-full h-auto aspect-square rounded-t-lg bg-black-100"},null,8,$e),e.item.goods.payType!==2&&e.item.goods.deliveryType===L(U).online?(s(),k(ee,{key:1,tag:a.$t("common.rebate"),ratio:e.item.goods.discountRatio||0},null,8,["tag","ratio"])):f("",!0)]),t("div",Te,[e.item.goods.goodsName?(s(),r("div",we,[e.item.goods.type?(s(),k(_,{key:0,type:e.item.goods.type,class:"inline-block mr-1 align-text-top"},null,8,["type"])):f("",!0),t("span",be,$(e.item.goods.goodsName||"-"),1)])):f("",!0),e.item.goods.id?f("",!0):(s(),r("div",Ce,[K(T,{row:e.index%2==0?1:2,class:"mx-2","row-width":["100%"]},null,8,["row"])])),e.item.goods.goodsDesc?(s(),r("div",Ie,$(e.item.goods.goodsDesc),1)):f("",!0),t("div",Ae,[t("div",Le,[e.item.goods.payType!==2?(s(),k(Y,{key:0,color:"#000000",class:"text-base",price:e.item.goods.price},null,8,["price"])):f("",!0)])]),t("section",{class:"mt-1.5 flex-center-bw",onClick:l[4]||(l[4]=A(()=>{},["stop"]))},[t("div",{class:"items-center text-xs flex-center text-default",onClick:l[1]||(l[1]=A(c=>h(`/category?deliveryType=1&shopId=${e.item.stores.id}`),["stop"]))},[t("span",Se,$(e.item.stores.storeName),1),t("div",Pe,[t("div",Be,$(a.$t("collect.intoShop")),1),De])]),e.item.goods.deliveryType===1?(s(),r("div",{key:0,onClick:l[2]||(l[2]=A(c=>o(e.item),["stop"])),class:""},qe)):(s(),r("div",{key:1,onClick:l[3]||(l[3]=A(c=>i(e.item),["stop"]))},Ne))])])])):f("",!0)])}}const Oe=C({...Ge,props:{item:null,index:null},emits:["handleAddCart"],setup:je}),Ve={class:"w-[110px] h-[110px] relative"},Re=["src"],ze={class:"ml-2 flex-1 w-[0px]"},Ee={class:"text-sm flex items-center mb-1.5 relative"},Je={class:"text-sm font-semibold leading-[0.875rem] truncate text-default"},Me={class:"flex items-center"},Ke={class:"flex-1"},We={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},Qe={class:"flex text-sm font-bold items-center mt-1.5"},Ue={class:"items-center text-xs flex-center text-default"},Xe={class:"mr-1 underline text-xxs"},Ye=t("span",null," > ",-1),Ze={key:0,class:"text-xxs text-black-400"},_e=["onClick"],et={key:0,class:"w-5 h-5 rounded-full flex justify-center items-center bg-[#FBA923] text-white text-sm"},tt={key:1,class:"w-6 h-6",src:Q},st=t("div",{class:"flex items-center h-2.5"},[t("div",{class:"h-[1px] w-full bg-black-100"})],-1),at=C({props:{data:null},emits:["handleTo","handleAddCart","click"],setup(e,{emit:g}){const m=e,{t:n}=V(),h=async()=>{if(m.data.goods.stock===0&&m.data.goods.goodsTypes!=2){F(n("order.Insufficient stock"));return}m.data.goods.deliveryType===1?g("handleAddCart",m.data.goods):g("click")};return(i,o)=>{var a,l;return s(),r(N,null,[(a=e.data)!=null&&a.activeType?(s(),k(Z,{key:0,info:e.data,onHandleTo:o[0]||(o[0]=T=>g("handleTo",T))},null,8,["info"])):(l=e.data)!=null&&l.goods?(s(),r("section",{key:1,class:"flex items-start justify-between rounded-lg bg-white p-2.5 w-full",onClick:o[4]||(o[4]=T=>g("click"))},[t("div",Ve,[(e.data.goods.status!=1||!+e.data.goods.stock)&&e.data.goods.goodsTypes!=2?(s(),k(X,{key:0,status:e.data.goods.status,stock:e.data.goods.stock},null,8,["status","stock"])):f("",!0),t("img",{src:e.data&&e.data.goods&&e.data.goods.icons&&e.data.goods.icons.split(",")[0]||L(G)("images/activity/boutique/squre_empty.png"),alt:"",class:"rounded-lg w-[110px] h-[110px] aspect-square object-cover"},null,8,Re),e.data.goods.payType!==2&&+e.data.goods.deliveryType===L(U).online?(s(),k(ee,{key:1,class:"flex-shrink-0 ml-auto",tag:i.$t("common.rebate"),ratio:e.data.goods.discountRatio||0},null,8,["tag","ratio"])):f("",!0)]),t("section",ze,[t("div",Ee,[e.data.goods.type?(s(),k(_,{key:0,type:e.data.goods.type,class:"mr-1",style:{flex:"0 0 auto"}},null,8,["type"])):f("",!0),t("div",Je,$(e.data.goods.goodsName),1)]),t("div",Me,[t("div",Ke,[t("div",We,$(e.data.goods.goodsDesc),1),t("div",Qe,[e.data.goods.payType!==2?(s(),k(Y,{key:0,price:e.data.goods.price,class:"text-base",color:"#000000"},null,8,["price"])):f("",!0)])])]),t("section",{class:"mt-5 flex-center-bw",onClick:o[3]||(o[3]=A(()=>{},["stop"]))},[t("div",Ue,[t("span",{class:"mr-1.5 max-w-[100px] line-clamp-1 text-xxs text-[#999999]",onClick:o[1]||(o[1]=A(T=>g("handleTo",`/category?deliveryType=1&shopId=${e.data.stores.id}`),["stop"]))},$(e.data.stores.storeName),1),t("div",{class:"text-black mr-2.5 flex items-center",onClick:o[2]||(o[2]=A(T=>g("handleTo",`/category?deliveryType=1&shopId=${e.data.stores.id}`),["stop"]))},[t("div",Xe,$(i.$t("collect.intoShop")),1),Ye]),e.data.goods.volume15>=100?(s(),r("div",Ze,$(i.$t("mall.15th sale",{salesVolume:e.data.goods.volume15||0})),1)):f("",!0)]),t("div",{onClick:A(h,["stop"]),class:"px-2"},[e.data.goods.deliveryType===1?(s(),r("div",et," + ")):(s(),r("img",tt))],8,_e)])])])):f("",!0),st],64)}}}),ot={class:"gap-2 u-waterfall"},lt=C({props:{value:null,addTime:null,idKey:null,isSearchPage:{type:Boolean},cardComponent:null},emits:["handleTo","handleAddCart"],setup(e,{emit:g}){const m=e,n=x(null),h=x(null),i=x([]),o=x([]),a=x([]),l=c=>JSON.parse(JSON.stringify(c)),T=ae(()=>l(m.value)),b=async()=>{if(!a.value.length)return;let c=await h.value,u=await n.value,d=a.value[0];if(!d)return;let y=(c==null?void 0:c.clientHeight)||0,p=(u==null?void 0:u.clientHeight)||0;if(i.value.length===0||y<p)i.value.push(d);else if(y>p)o.value.push(d);else if(y===p){let P=i.value.length;o.value.length<=P?o.value.push(d):i.value.push(d)}else{let P=i.value.length,B=o.value.length;P<=B?i.value.push(d):o.value.push(d)}a.value.splice(0,1),a.value.length&&setTimeout(()=>{b()},m.addTime)};return W(()=>T,(c,u)=>{let d=Array.isArray(u)&&u.length>0?u.length:0;a.value=a.value.concat(l(c.value.slice(d))),b()},{deep:!0,immediate:!0}),oe(()=>{a.value=l(T.value),b()}),(c,u)=>(s(),r("div",ot,[t("div",{ref:(d,y)=>{y.leftColumn=d,h.value=d},class:"u-column"},[(s(!0),r(N,null,O(i.value,(d,y)=>(s(),k(R(e.cardComponent),{key:d.id,item:d,index:y,onHandleTo:u[0]||(u[0]=p=>g("handleTo",p)),onHandleAddCart:u[1]||(u[1]=p=>g("handleAddCart",p))},null,8,["item","index"]))),128))],512),t("div",{ref:(d,y)=>{y.rightColumn=d,n.value=d},class:"u-column"},[(s(!0),r(N,null,O(o.value,(d,y)=>(s(),k(R(e.cardComponent),{key:d.id,item:d,index:y,onHandleTo:u[2]||(u[2]=p=>g("handleTo",p)),onHandleAddCart:u[3]||(u[3]=p=>g("handleAddCart",p))},null,8,["item","index"]))),128))],512)]))}}),nt=J(lt,[["__scopeId","data-v-daf141ca"]]),it={key:0},dt=C({name:"mallGoodsList"});function ct(e,{expose:g,emit:m}){const n=e,{t:h}=V();W(()=>n.viewFormat,v=>{v===1&&console.log(v)},{deep:!0});const i=x([]),o=x(!1),a=x(!1),l=x(0),T=x(10),b=x(0),c=x([]),u=x(0),d=x,y=async()=>{n.isSearchPage&&!n.searchParam.keyword&&!n.searchParam.classId||(o.value=!0,l.value+=1,await p(),setTimeout(()=>{o.value=!1},1e3))},p=async()=>{var w,D,I,H,q;const v=await ce({page:l.value,size:T.value,status:1,...n.searchParam,sortType:n.sortType});if(!v.success){a.value=!0;return}if(!v.data||!v.total||!((w=v.data)!=null&&w.length)){a.value=!0;return}if(b.value=v.total,c.value=v.data.map(S=>({goods:S.goods,stores:S.stores||d,card:S.card})),l.value===1&&!n.isSearchPage){const S={activeType:1,activePath:"/boutique-goods",activeImg:G("images/activity/advertise/Boutique.png"),activeImgGrid:G("images/activity/advertise/Boutique-grid.png")};u.value+=1,c.value.unshift(S)}if(l.value===2&&((D=n.activeInfo)!=null&&D.id)){const S={activeType:1,activePath:(I=n.activeInfo)==null?void 0:I.url,activeImg:((H=n.activeInfo)==null?void 0:H.activityListImgs)||null,activeImgGrid:((q=n.activeInfo)==null?void 0:q.activityWaterfallImgs)||null,...n.activeInfo};c.value.unshift(S),u.value+=1}i.value=l.value===1?c.value:i.value.concat(c.value),i.value.length-u.value>=b.value&&(a.value=!0)},{loadingToggle:P}=de(),B=async v=>{if(v.stock===0&&v.goodsTypes!=2){F(h("order.Insufficient stock"));return}P(!0);const w=await ue(v.id);P(!1),w.success&&(m("successAdd"),F(h("cart.addTips")))};return g({handleSearch:async()=>{i.value=[],l.value=0,b.value=0,u.value=0,a.value=!1,document.querySelector("#fm-page").scrollTo(0,0),await y()},list:i}),(v,w)=>{const D=M("VanList");return s(),k(D,{loading:o.value,"onUpdate:loading":w[2]||(w[2]=I=>o.value=I),finished:a.value,"finished-text":v.$t("common.noMore"),"loading-text":v.$t("common.loading"),onLoad:y},{default:le(()=>[i.value.length>0?(s(),r("div",it,[z(K(nt,{isSearchPage:e.isSearchPage,value:c.value,addTime:200,cardComponent:Oe,onHandleTo:w[0]||(w[0]=I=>m("handleTo",I)),onHandleAddCart:B},null,8,["isSearchPage","value"]),[[E,e.viewFormat===0]]),z(t("div",null,[(s(!0),r(N,null,O(i.value,(I,H)=>(s(),k(at,{key:H,data:I,onClick:()=>m("handleTo",`${e.goodsPath}?id=${I.goods.id}`),onHandleTo:w[1]||(w[1]=q=>m("handleTo",q)),onHandleAddCart:B},null,8,["data","onClick"]))),128))],512),[[E,e.viewFormat===1]])])):f("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"])}}const pt=C({...dt,props:{searchParam:{default:()=>({keyword:"",sortType:1,orderBy:1,classId:null})},sortType:null,goodsPath:{default:"/goodsDetail"},viewFormat:{default:0},isSearchPage:{type:Boolean,default:!1},activeInfo:null},emits:["handleTo","successAdd"],setup:ct});export{pt as _,Z as a};
