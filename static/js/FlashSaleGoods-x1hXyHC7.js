import{_ as X,z as Y,x as ht,r as _,y as at,bl as lt,F,G as i,H as o,U as u,I as t,P as $,$ as I,O as n,N as E,Q as c,X as ot,Y as nt,E as ft,V as it,a3 as tt,Z as q,a4 as vt,J as et,K as st,B as _t}from"./vendor-Dr_RpJ_Y.js";import{b as xt,Y as O,k as K,e as pt,bk as H,r as yt,a as gt,z as bt,bl as wt,bm as St}from"./index-CU2nzZe6.js";import{P as Q}from"./flashSale-DDyqLyYN.js";import{R as $t}from"./RatioBox-BwMA7vB_.js";import{l as kt}from"./luckyShopContract-DunEf0Vg.js";import{a as Tt}from"./shop-CeqcS6K2.js";const x="/static/images/Vector-gray-CScBV3Qn.svg",L="/static/images/Vector-default-gSiyBMiV.svg",f=e=>(ot("data-v-bdee5bce"),e=e(),nt(),e),At={class:"relative w-full px-4 py-4 flex-center-bw"},Bt={key:0},Ft={key:0,class:"flex flex-col justify-between gap-y-[2px]"},Ct=f(()=>t("img",{src:x,class:"w-[9px] rotate-180",alt:""},null,-1)),Pt=f(()=>t("img",{src:x,class:"w-[9px]",alt:""},null,-1)),It=[Ct,Pt],Lt={key:1,class:"flex flex-col justify-between gap-y-[2px]"},jt=f(()=>t("img",{src:L,class:"w-[9px] rotate-180",alt:""},null,-1)),Nt=f(()=>t("img",{src:x,class:"w-[9px]",alt:""},null,-1)),Rt=[jt,Nt],Vt={key:2,class:"flex flex-col justify-between gap-y-[2px]"},zt=f(()=>t("img",{src:x,class:"w-[9px] rotate-180",alt:""},null,-1)),Dt=f(()=>t("img",{src:L,class:"w-[9px]",alt:""},null,-1)),Gt=[zt,Dt],Mt={key:0,class:"flex flex-col justify-between gap-y-[2px]"},Et=f(()=>t("img",{src:x,class:"w-[9px] rotate-180",alt:""},null,-1)),Ut=f(()=>t("img",{src:x,class:"w-[9px]",alt:""},null,-1)),qt=[Et,Ut],Ot={key:1,class:"flex flex-col justify-between gap-y-[2px]"},Kt=f(()=>t("img",{src:L,class:"w-[9px] rotate-180",alt:""},null,-1)),Ht=f(()=>t("img",{src:x,class:"w-[9px]",alt:""},null,-1)),Qt=[Kt,Ht],Xt={key:2,class:"flex flex-col justify-between gap-y-[2px]"},Yt=f(()=>t("img",{src:x,class:"w-[9px] rotate-180",alt:""},null,-1)),Jt=f(()=>t("img",{src:L,class:"w-[9px]",alt:""},null,-1)),Zt=[Yt,Jt],Wt={key:0,class:"flex flex-col justify-between gap-y-[2px]"},te=f(()=>t("img",{src:x,class:"w-[9px] rotate-180",alt:""},null,-1)),ee=f(()=>t("img",{src:x,class:"w-[9px]",alt:""},null,-1)),se=[te,ee],ae={key:1,class:"flex flex-col justify-between gap-y-[2px]"},le=f(()=>t("img",{src:L,class:"w-[9px] rotate-180",alt:""},null,-1)),oe=f(()=>t("img",{src:x,class:"w-[9px]",alt:""},null,-1)),ne=[le,oe],ie={key:2,class:"flex flex-col justify-between gap-y-[2px]"},ce=f(()=>t("img",{src:x,class:"w-[9px] rotate-180",alt:""},null,-1)),re=f(()=>t("img",{src:L,class:"w-[9px]",alt:""},null,-1)),de=[ce,re],ue=Y({props:{filterShow:{type:Boolean,default:!1}},emits:["changeType","change"],setup(e,{emit:C}){const{filterShow:g}=e,{t:b}=ht(),v=_(null),k=at(()=>[{text:b("common.all"),value:null},{text:b("flashSale.progressing"),value:1},{text:b("flashSale.notStart"),value:2},{text:b("flashSale.over"),value:3}]),p=y=>{C("changeType",y)},s=lt({timeStatus:0,priceStatus:0,totalPrice:0}),w=()=>{s.priceStatus=0,s.totalPrice=0,s.timeStatus<2?s.timeStatus++:s.timeStatus=0},S=()=>{s.timeStatus=0,s.totalPrice=0,s.priceStatus<2?s.priceStatus++:s.priceStatus=0},j=()=>{s.priceStatus=0,s.timeStatus=0,s.totalPrice<2?s.totalPrice++:s.totalPrice=0};return(y,l)=>{const d=F("van-dropdown-item"),T=F("van-dropdown-menu");return o(),i("div",At,[g?(o(),i("div",Bt,[$(T,{class:"w-full",ref:(m,R)=>{R.menuRef=m},"active-color":"#FB1A18",overlay:!1},{default:I(()=>[$(d,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=m=>v.value=m),options:n(k),onChange:p},null,8,["modelValue","options"])]),_:1},512)])):u("",!0),t("div",{class:"gap-6 flex-center",onClick:l[1]||(l[1]=m=>C("change",n(s)))},[t("div",{class:"gap-1 text-sm flex-center",onClick:S},[t("span",{class:E({"font-bold":n(s).priceStatus!==0})},c(y.$t("flashSale.time")),3),n(s).priceStatus===0?(o(),i("div",Ft,It)):u("",!0),n(s).priceStatus===1?(o(),i("div",Lt,Rt)):u("",!0),n(s).priceStatus===2?(o(),i("div",Vt,Gt)):u("",!0)]),t("div",{class:"gap-1 text-sm flex-center",onClick:j},[t("span",{class:E({"font-bold":n(s).totalPrice!==0})},c(y.$t("common.total price")),3),n(s).totalPrice===0?(o(),i("div",Mt,qt)):u("",!0),n(s).totalPrice===1?(o(),i("div",Ot,Qt)):u("",!0),n(s).totalPrice===2?(o(),i("div",Xt,Zt)):u("",!0)]),t("div",{class:"gap-1 text-sm flex-center",onClick:w},[t("span",{class:E({"font-bold":n(s).timeStatus!==0})},c(y.$t("flashSale.progress-rate")),3),n(s).timeStatus===0?(o(),i("div",Wt,se)):u("",!0),n(s).timeStatus===1?(o(),i("div",ae,ne)):u("",!0),n(s).timeStatus===2?(o(),i("div",ie,de)):u("",!0)])])])}}}),me=X(ue,[["__scopeId","data-v-bdee5bce"]]),ct=e=>(ot("data-v-2d533599"),e=e(),nt(),e),he={class:"w-[6.5rem] h-[6.5rem] relative"},fe={key:0,class:"absolute bottom-0 flex items-center w-full h-6 text-white rounded-br-xl rounded-bl-xl justify-evenly flex-nowrap goods-mask"},ve={class:"text-[0.675rem]"},_e={class:"text-[0.75rem]"},xe={key:1,class:"absolute bottom-0 flex items-center w-full h-6 text-white rounded-br-xl rounded-bl-xl justify-evenly flex-nowrap goods-mask"},pe={class:"text-[0.675rem]"},ye={class:"text-[0.75rem]"},ge={key:2,class:"absolute bottom-0 flex items-center justify-center w-full h-full grabbed-mask rounded-xl"},be=["src"],we={class:"text-lg text-white"},Se=["src"],$e={class:"w-24 flex flex-col justify-between ml-2.5 flex-1"},ke={class:"flex justify-between sm-flex"},Te={class:"text-[#2E2008] text-base font-semibold text-overflow-2 mr-4"},Ae={key:0,class:"text-[#FB1A18] text-xs"},Be={key:1,class:"text-[#FB1A18] text-xs"},Fe={key:2,class:"flex items-center"},Ce={class:"w-36 h-1.5 rounded bg-[#F1F1F1]"},Pe={class:"ml-auto whitespace-nowrap text-[0.675rem] text-[#999999]"},Ie={class:"mt-0.5 text-[#999] font-normal text-xs"},Le={class:"relative flex items-end justify-between"},je={key:0},Ne={class:"mt-1 flex items-center text-xs text-[#666666]"},Re={class:"shrink-0"},Ve=["src"],ze={class:"flex items-center"},De={class:"shrink-0 text-xs text-[#2E2008]"},Ge=["src"],Me={class:"text-lg text-[#FD4328]"},Ee={key:1,class:"flex items-baseline"},Ue={class:"text-xs text-[#999]"},qe={class:"flex items-center text-sm text-primary"},Oe=ct(()=>t("span",{class:"text-default"},c("symbol"),-1)),Ke={key:2,class:"flex items-baseline whitespace-nowrap"},He={class:"text-xs text-[#999]"},Qe=ct(()=>t("span",{class:"flex items-center text-base text-primary"},[t("span",null,c(123)),t("span",{class:"text-default"},c("symbol"))],-1)),Xe={class:"absolute-btn"},Ye=["src"],Je={class:"text-sm text-white absolute top-1/2 left-4 translate-y-[-50%] pb-0.5"},Ze=["src"],We={class:"text-sm text-[#999999] absolute top-1/2 left-2 translate-y-[-50%] pb-0.5 whitespace-nowrap"},ts=Y({props:{data:null,systemTime:null},emits:["rushToBuy","handleTo"],setup(e,{emit:C}){const g=e,{checkLoginAuth:b}=xt(),v=_(null),k=_(""),p=_(null),s=()=>{const l=g.data;if(l.status===10){const d=H(l.endTime)*1e3,T=H(l.startTime)*1e3,m=H(g.systemTime)*1e3;v.value=d-m,p.value=m-T}else l.status===20&&(k.value=yt(l.nextActionTime))},w=()=>{p.value=1e3},S=()=>{v.value=null},j=at(()=>g.data.currentAmount/g.data.totalAmount*100+"%"),y=()=>{b(!0)&&C("handleTo",`/saleGoodDetail?id=${g.data.id}`)};return ft(()=>{s()}),(l,d)=>{var m;const T=F("van-count-down");return o(),i("div",{class:"flex border-b-8 border-solid border-b-[#F9F5F7] bg-white px-4 py-2.5",onClick:d[2]||(d[2]=R=>y())},[t("div",he,[e.data.status==10&&p.value>0&&v.value&&v.value>0?(o(),i("div",fe,[t("span",ve,c(l.$t("flashSale.comingEnd")),1),t("span",_e,[$(T,{class:"text-white",time:v.value,onFinish:S},null,8,["time"])])])):e.data.status==10&&p.value&&p.value<0?(o(),i("div",xe,[t("span",pe,c(l.$t("flashSale.comingStart")),1),t("span",ye,[$(T,{class:"text-white",time:Math.abs(p.value),onFinish:w},null,8,["time"])])])):u("",!0),e.data.status!=10?(o(),i("div",ge,[t("img",{class:"w-16 h-16 absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-50%]",src:n(O)("flashSale/circle.svg"),alt:"",srcset:""},null,8,be),t("span",we,c(l.$t("flashSale.Alreadygrabbed")),1)])):u("",!0),t("img",{class:"object-cover w-full h-full rounded-xl aspect-square",src:e.data.mainImageUrls||n(K)("images/goods/defaultImg.png"),alt:"",srcset:""},null,8,Se)]),t("div",$e,[t("div",null,[t("div",ke,[t("div",Te,c(e.data.title),1),$($t,{ratio:e.data.discountRate||20,class:"h-6"},null,8,["ratio"])]),e.data.status==15?(o(),i("div",Ae,c(l.$t("flashSale.Tobedrawn")),1)):u("",!0),e.data.status==20&&k.value?(o(),i("div",Be,c(l.$t("flashSale.Prizeredemptiondeadline"))+":"+c(k.value),1)):u("",!0),e.data.status==10?(o(),i("div",Fe,[t("div",Ce,[t("div",{class:"h-1.5 rounded bg-[#FB1A18]",style:it(`width: ${n(j)}`)},null,4)]),t("span",Pe,c(l.$t("flashSale.remainGood",{num:e.data.totalAmount-e.data.currentAmount})),1)])):u("",!0),t("div",Ie,c(l.$t("order.quantity",{number:e.data.totalAmount||0})),1)]),t("div",Le,[t("div",null,[((m=e.data)==null?void 0:m.payType)!==n(Q).STORE_CARD?(o(),i("div",je,[t("div",Ne,[t("span",Re,c(l.$t("flashSale.commonPrice")),1),t("img",{class:"ml-1.5 mr-1 w2.5 h-2.5",src:n(K)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,Ve),t("span",null,c(e.data.totalPrice||n(pt)(e.data.price*e.data.totalAmount)),1)]),t("div",ze,[t("span",De,c(l.$t("flashSale.flasePrice")),1),t("img",{class:"w-4 h-4 ml-1 mr-1",src:n(K)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,Ge),t("span",Me,c(e.data.price),1)])])):u("",!0),e.data.payType===n(Q).MIX?(o(),i("div",Ee,[t("span",Ue,c(l.$t("flashSale.storePrice"))+"：",1),t("span",qe,[t("span",null,c(e.data.cardPrice),1),Oe])])):u("",!0),e.data.payType===n(Q).STORE_CARD?(o(),i("div",Ke,[t("span",He,c(l.$t("flashSale.storePrice"))+"：",1),Qe])):u("",!0)]),t("div",Xe,[e.data.status==10&&p.value>0&&v.value>0?(o(),i("div",{key:0,class:"relative ml-auto mr-1",onClick:d[0]||(d[0]=tt(()=>{C("rushToBuy")},["stop"]))},[t("img",{class:"auto h-7",src:n(O)("flashSale/buy-btn.svg"),alt:"",srcset:""},null,8,Ye),t("div",Je,c(l.$t("flashSale.buyNow")),1)])):(o(),i("div",{key:1,class:"relative ml-auto mr-1",onClick:d[1]||(d[1]=tt(()=>{},["stop"]))},[t("img",{class:"auto h-7",src:n(O)("flashSale/end-btn.svg"),alt:"",srcset:""},null,8,Ze),t("div",We,c(e.data.status==10?v.value&&v.value>0?l.$t("flashSale.notStart"):l.$t("flashSale.gooderror"):l.$t("flashSale.Alreadygrabbed")),1)]))])])])])}}}),es=X(ts,[["__scopeId","data-v-2d533599"]]),ss={class:"w-full bg-white goods-border"},as={class:"pt-5"},ls=Y({props:{categoryList:null},emits:["rushToBuy","handleTo"],setup(e,{expose:C,emit:g}){const b=e,{commodityBatch:v}=kt(),k=_(""),{reloadStore:p}=gt(),s=_(!1),w=_(!1),S=_(0),j=_(10),y=_(0),{currentLocale:l}=bt(),d=lt({keyword:"",orderBy:null,categoryId:null,title:null}),T=a=>{a.priceStatus?d.orderBy=a.priceStatus===1?9:10:a.timeStatus?d.orderBy=a.timeStatus===1?8:7:a.totalPrice?d.orderBy=a.totalPrice===1?5:6:d.orderBy=null,S.value=0,V(d)},m=_([]),R=async a=>{var z,D,G,A,B;const r=await St({page:S.value,size:j.value,type:Z.value,...d,...a,deleteFlag:!1});if(!r.success){w.value=!0;return}if(!r.data||!r.total){w.value=!0;return}y.value=r.total;const U=r.data.map(h=>h.id),P=await v(U);for(let h=0;h<r.data.length;h++){r.data[h].currentAmount=(z=P[h])==null?void 0:z.currentAmount,r.data[h].totalAmount=(D=P[h])==null?void 0:D.totalAmount,r.data[h].status=(G=P[h])==null?void 0:G.status,r.data[h].discountRate=+_t(+((A=P[h])==null?void 0:A.discountRate)).div(1e4).toNumber(),r.data[h].nextActionTime=((B=P[h])==null?void 0:B.nextActionTime)*1e3;const N=r.data[h].mainImageUrls.split(",").filter(M=>M!==""&&M!==null&&M!==void 0&&!Number.isNaN(M));r.data[h].mainImageUrls=N&&N.length>0?N[0]:""}m.value=S.value===1?r.data:m.value.concat(r.data),m.value.length>=y.value&&(w.value=!0)},rt=a=>{d.categoryId=b.categoryList[a.name]&&b.categoryList[a.name].id||null,V(d)},V=a=>{m.value=[],S.value=0,y.value=0,w.value=!1,a.pageKey&&a.pageKey==="flashSale"&&(d.title=a==null?void 0:a.title),W(d)},J=_(null),dt=async()=>{const{data:a}=await wt();J.value=a||null},ut=(a,r)=>{a.currentAmount=a.currentAmount+r,a.currentAmount>=a.totalAmount&&(a.status=20)},Z=_(null),mt=a=>{Z.value=a,V(d)},W=async a=>{s.value=!0,S.value+=1,await dt(),await R(a),s.value=!1};return C({handleSearch:V,handleBuySuccess:ut}),(a,r)=>{const U=F("van-loading"),P=F("VanList"),z=F("van-tab"),D=F("van-tabs"),G=F("van-pull-refresh");return o(),i("div",ss,[$(G,{onRefresh:n(p).reload,class:"min-h-screen"},{default:I(()=>[$(me,{"filter-show":!0,onChange:T,onChangeType:mt}),e.categoryList.length==0?(o(),q(U,{key:0,class:"text-center",size:"12px"},{default:I(()=>[vt(c(a.$t("common.loading")),1)]),_:1})):u("",!0),$(D,{active:k.value,"onUpdate:active":r[2]||(r[2]=A=>k.value=A),type:"card",onClickTab:rt},{default:I(()=>[(o(!0),i(et,null,st(e.categoryList,A=>(o(),q(z,{title:A[`${n(Tt)[n(l)]}Name`]||A.name,key:A.id},{default:I(()=>[t("div",as,[$(P,{class:E({"bg-[#F9F5F7]":m.value.length>5}),loading:s.value,"onUpdate:loading":r[1]||(r[1]=B=>s.value=B),finished:w.value,"finished-text":a.$t("common.noMore"),"loading-text":a.$t("common.loading"),onLoad:W},{default:I(()=>[(o(!0),i(et,null,st(m.value,(B,h)=>(o(),q(es,{style:it(h==m.value.length-1?"border-bottom:0":""),key:B,data:B,onRushToBuy:()=>{g("rushToBuy",B)},onHandleTo:r[0]||(r[0]=N=>{g("handleTo",N)}),systemTime:J.value},null,8,["style","data","onRushToBuy","systemTime"]))),128))]),_:2},1032,["class","loading","finished","finished-text","loading-text"])])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1},8,["onRefresh"])])}}}),us=X(ls,[["__scopeId","data-v-ec3657b6"]]);export{us as F};
