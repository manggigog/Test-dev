import{_ as X,y as J,w as ht,r as _,x as at,bd as lt,E as A,F as i,G as l,a2 as u,H as t,O as $,N as P,P as o,R as M,Q as c,Y as ot,Z as nt,D as ft,X as it,a4 as tt,K as U,a0 as vt,I as et,J as st,B as _t}from"./vendor-CjApaIpB.js";import{V as O,g as K,d as xt,aB as H,l as yt,e as pt,v as gt,aC as wt,aD as bt}from"./index-B3VH42pz.js";import{P as Q}from"./flashSale-DDyqLyYN.js";import{R as St}from"./RatioBox-D6EP5ck6.js";import{l as $t}from"./luckyShopContract-CxfmjUqE.js";import{a as Tt}from"./shop-CeqcS6K2.js";const p="/Test-dev/static/images/Vector-gray-CScBV3Qn.svg",I="/Test-dev/static/images/Vector-default-gSiyBMiV.svg",f=e=>(ot("data-v-bdee5bce"),e=e(),nt(),e),kt={class:"relative w-full px-4 py-4 flex-center-bw"},Bt={key:0},At={key:0,class:"flex flex-col justify-between gap-y-[2px]"},Ft=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),Ct=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),Pt=[Ft,Ct],It={key:1,class:"flex flex-col justify-between gap-y-[2px]"},jt=f(()=>t("img",{src:I,class:"w-[9px] rotate-180",alt:""},null,-1)),Lt=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),Nt=[jt,Lt],Rt={key:2,class:"flex flex-col justify-between gap-y-[2px]"},Vt=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),Dt=f(()=>t("img",{src:I,class:"w-[9px]",alt:""},null,-1)),Gt=[Vt,Dt],Mt={key:0,class:"flex flex-col justify-between gap-y-[2px]"},Et=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),qt=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),zt=[Et,qt],Ut={key:1,class:"flex flex-col justify-between gap-y-[2px]"},Ot=f(()=>t("img",{src:I,class:"w-[9px] rotate-180",alt:""},null,-1)),Kt=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),Ht=[Ot,Kt],Qt={key:2,class:"flex flex-col justify-between gap-y-[2px]"},Xt=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),Jt=f(()=>t("img",{src:I,class:"w-[9px]",alt:""},null,-1)),Yt=[Xt,Jt],Zt={key:0,class:"flex flex-col justify-between gap-y-[2px]"},Wt=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),te=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),ee=[Wt,te],se={key:1,class:"flex flex-col justify-between gap-y-[2px]"},ae=f(()=>t("img",{src:I,class:"w-[9px] rotate-180",alt:""},null,-1)),le=f(()=>t("img",{src:p,class:"w-[9px]",alt:""},null,-1)),oe=[ae,le],ne={key:2,class:"flex flex-col justify-between gap-y-[2px]"},ie=f(()=>t("img",{src:p,class:"w-[9px] rotate-180",alt:""},null,-1)),ce=f(()=>t("img",{src:I,class:"w-[9px]",alt:""},null,-1)),re=[ie,ce],de=J({props:{filterShow:{type:Boolean,default:!1}},emits:["changeType","change"],setup(e,{emit:F}){const{filterShow:w}=e,{t:v}=ht(),T=_(null),x=at(()=>[{text:v("common.all"),value:null},{text:v("flashSale.progressing"),value:1},{text:v("flashSale.notStart"),value:2},{text:v("flashSale.over"),value:3}]),j=m=>{F("changeType",m)},s=lt({timeStatus:0,priceStatus:0,totalPrice:0}),b=()=>{s.priceStatus=0,s.totalPrice=0,s.timeStatus<2?s.timeStatus++:s.timeStatus=0},S=()=>{s.timeStatus=0,s.totalPrice=0,s.priceStatus<2?s.priceStatus++:s.priceStatus=0},n=()=>{s.priceStatus=0,s.timeStatus=0,s.totalPrice<2?s.totalPrice++:s.totalPrice=0};return(m,g)=>{const d=A("van-dropdown-item"),E=A("van-dropdown-menu");return l(),i("div",kt,[w?(l(),i("div",Bt,[$(E,{class:"w-full",ref:(y,q)=>{q.menuRef=y},"active-color":"#FB1A18",overlay:!1},{default:P(()=>[$(d,{modelValue:T.value,"onUpdate:modelValue":g[0]||(g[0]=y=>T.value=y),options:o(x),onChange:j},null,8,["modelValue","options"])]),_:1},512)])):u("",!0),t("div",{class:"gap-6 flex-center",onClick:g[1]||(g[1]=y=>F("change",o(s)))},[t("div",{class:"gap-1 text-sm flex-center",onClick:S},[t("span",{class:M({"font-bold":o(s).priceStatus!==0})},c(m.$t("flashSale.time")),3),o(s).priceStatus===0?(l(),i("div",At,Pt)):u("",!0),o(s).priceStatus===1?(l(),i("div",It,Nt)):u("",!0),o(s).priceStatus===2?(l(),i("div",Rt,Gt)):u("",!0)]),t("div",{class:"gap-1 text-sm flex-center",onClick:n},[t("span",{class:M({"font-bold":o(s).totalPrice!==0})},c(m.$t("common.total price")),3),o(s).totalPrice===0?(l(),i("div",Mt,zt)):u("",!0),o(s).totalPrice===1?(l(),i("div",Ut,Ht)):u("",!0),o(s).totalPrice===2?(l(),i("div",Qt,Yt)):u("",!0)]),t("div",{class:"gap-1 text-sm flex-center",onClick:b},[t("span",{class:M({"font-bold":o(s).timeStatus!==0})},c(m.$t("flashSale.progress-rate")),3),o(s).timeStatus===0?(l(),i("div",Zt,ee)):u("",!0),o(s).timeStatus===1?(l(),i("div",se,oe)):u("",!0),o(s).timeStatus===2?(l(),i("div",ne,re)):u("",!0)])])])}}}),ue=X(de,[["__scopeId","data-v-bdee5bce"]]),ct=e=>(ot("data-v-48f618d4"),e=e(),nt(),e),me={class:"w-[6.5rem] h-[6.5rem] relative"},he={key:0,class:"absolute bottom-0 flex items-center w-full h-6 text-white rounded-br-xl rounded-bl-xl justify-evenly flex-nowrap goods-mask"},fe={class:"text-[0.675rem]"},ve={class:"text-[0.75rem]"},_e={key:1,class:"absolute bottom-0 flex items-center w-full h-6 text-white rounded-br-xl rounded-bl-xl justify-evenly flex-nowrap goods-mask"},xe={class:"text-[0.675rem]"},ye={class:"text-[0.75rem]"},pe={key:2,class:"absolute bottom-0 flex items-center justify-center w-full h-full grabbed-mask rounded-xl"},ge=["src"],we={class:"text-lg text-white"},be=["src"],Se={class:"w-24 flex flex-col justify-between ml-2.5 flex-1"},$e={class:"flex justify-between sm-flex"},Te={class:"text-[#2E2008] text-base font-semibold text-overflow-2 mr-4"},ke={key:0,class:"text-[#FB1A18] text-xs"},Be={key:1,class:"text-[#FB1A18] text-xs"},Ae={key:2,class:"flex items-center"},Fe={class:"w-36 h-1.5 rounded bg-[#F1F1F1]"},Ce={class:"ml-auto whitespace-nowrap text-[0.675rem] text-[#999999]"},Pe={class:"mt-0.5 text-[#999] font-normal text-xs"},Ie={class:"relative flex items-end justify-between"},je={key:0},Le={class:"mt-1 flex items-center text-xs text-[#666666]"},Ne={class:"shrink-0"},Re=["src"],Ve={class:"flex items-center"},De={class:"shrink-0 text-xs text-[#2E2008]"},Ge=["src"],Me={class:"text-lg text-[#FD4328]"},Ee={key:1,class:"flex items-baseline"},qe={class:"text-xs text-[#999]"},ze={class:"flex items-center text-sm text-primary"},Ue=ct(()=>t("span",{class:"text-default"},c("symbol"),-1)),Oe={key:2,class:"flex items-baseline whitespace-nowrap"},Ke={class:"text-xs text-[#999]"},He=ct(()=>t("span",{class:"flex items-center text-base text-primary"},[t("span",null,c(123)),t("span",{class:"text-default"},c("symbol"))],-1)),Qe={class:"absolute-btn"},Xe=["src"],Je={class:"text-sm text-white absolute top-1/2 left-4 translate-y-[-50%] pb-0.5"},Ye=["src"],Ze={class:"text-sm text-[#999999] absolute top-1/2 left-2 translate-y-[-50%] pb-0.5 whitespace-nowrap"},We=J({props:{data:null,systemTime:null},emits:["rushToBuy","handleTo"],setup(e,{emit:F}){const w=e,v=_(null),T=_(""),x=_(null),j=()=>{const n=w.data;if(n.status===10){const m=H(n.endTime)*1e3,g=H(n.startTime)*1e3,d=H(w.systemTime)*1e3;v.value=m-d,x.value=d-g}else n.status===20&&(T.value=yt(n.nextActionTime))},s=()=>{x.value=1e3},b=()=>{v.value=null},S=at(()=>w.data.currentAmount/w.data.totalAmount*100+"%");return ft(()=>{j()}),(n,m)=>{var d;const g=A("van-count-down");return l(),i("div",{class:"flex border-b-8 border-solid border-b-[#F9F5F7] bg-white px-4 py-2.5",onClick:m[2]||(m[2]=()=>{F("handleTo",`/saleGoodDetail?id=${e.data.id}`)})},[t("div",me,[e.data.status==10&&x.value>0&&v.value&&v.value>0?(l(),i("div",he,[t("span",fe,c(n.$t("flashSale.comingEnd")),1),t("span",ve,[$(g,{class:"text-white",time:v.value,onFinish:b},null,8,["time"])])])):e.data.status==10&&x.value&&x.value<0?(l(),i("div",_e,[t("span",xe,c(n.$t("flashSale.comingStart")),1),t("span",ye,[$(g,{class:"text-white",time:Math.abs(x.value),onFinish:s},null,8,["time"])])])):u("",!0),e.data.status!=10?(l(),i("div",pe,[t("img",{class:"w-16 h-16 absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-50%]",src:o(O)("flashSale/circle.svg"),alt:"",srcset:""},null,8,ge),t("span",we,c(n.$t("flashSale.Alreadygrabbed")),1)])):u("",!0),t("img",{class:"object-cover w-full h-full rounded-xl aspect-square",src:e.data.mainImageUrls||o(K)("images/goods/defaultImg.png"),alt:"",srcset:""},null,8,be)]),t("div",Se,[t("div",null,[t("div",$e,[t("div",Te,c(e.data.title),1),$(St,{ratio:e.data.discountRate||20,class:"h-6"},null,8,["ratio"])]),e.data.status==15?(l(),i("div",ke,c(n.$t("flashSale.Tobedrawn")),1)):u("",!0),e.data.status==20&&T.value?(l(),i("div",Be,c(n.$t("flashSale.Prizeredemptiondeadline"))+":"+c(T.value),1)):u("",!0),e.data.status==10?(l(),i("div",Ae,[t("div",Fe,[t("div",{class:"h-1.5 rounded bg-[#FB1A18]",style:it(`width: ${o(S)}`)},null,4)]),t("span",Ce,c(n.$t("flashSale.remainGood",{num:e.data.totalAmount-e.data.currentAmount})),1)])):u("",!0),t("div",Pe,c(n.$t("order.quantity",{number:e.data.totalAmount||0})),1)]),t("div",Ie,[t("div",null,[((d=e.data)==null?void 0:d.payType)!==o(Q).STORE_CARD?(l(),i("div",je,[t("div",Le,[t("span",Ne,c(n.$t("flashSale.commonPrice")),1),t("img",{class:"ml-1.5 mr-1 w2.5 h-2.5",src:o(K)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,Re),t("span",null,c(e.data.totalPrice||o(xt)(e.data.price*e.data.totalAmount)),1)]),t("div",Ve,[t("span",De,c(n.$t("flashSale.flasePrice")),1),t("img",{class:"w-4 h-4 ml-1 mr-1",src:o(K)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,Ge),t("span",Me,c(e.data.price),1)])])):u("",!0),e.data.payType===o(Q).MIX?(l(),i("div",Ee,[t("span",qe,c(n.$t("flashSale.storePrice"))+"：",1),t("span",ze,[t("span",null,c(e.data.cardPrice),1),Ue])])):u("",!0),e.data.payType===o(Q).STORE_CARD?(l(),i("div",Oe,[t("span",Ke,c(n.$t("flashSale.storePrice"))+"：",1),He])):u("",!0)]),t("div",Qe,[e.data.status==10&&x.value>0&&v.value>0?(l(),i("div",{key:0,class:"relative ml-auto mr-1",onClick:m[0]||(m[0]=tt(()=>{F("rushToBuy")},["stop"]))},[t("img",{class:"auto h-7",src:o(O)("flashSale/buy-btn.svg"),alt:"",srcset:""},null,8,Xe),t("div",Je,c(n.$t("flashSale.buyNow")),1)])):(l(),i("div",{key:1,class:"relative ml-auto mr-1",onClick:m[1]||(m[1]=tt(()=>{},["stop"]))},[t("img",{class:"auto h-7",src:o(O)("flashSale/end-btn.svg"),alt:"",srcset:""},null,8,Ye),t("div",Ze,c(e.data.status==10?v.value&&v.value>0?n.$t("flashSale.notStart"):n.$t("flashSale.gooderror"):n.$t("flashSale.Alreadygrabbed")),1)]))])])])])}}}),ts=X(We,[["__scopeId","data-v-48f618d4"]]),es={class:"w-full bg-white goods-border"},ss={class:"pt-5"},as=J({props:{categoryList:null},emits:["rushToBuy","handleTo"],setup(e,{expose:F,emit:w}){const v=e,{commodityBatch:T}=$t(),x=_(""),{reloadStore:j}=pt(),s=_(!1),b=_(!1),S=_(0),n=_(10),m=_(0),{currentLocale:g}=gt(),d=lt({keyword:"",orderBy:null,categoryId:null,title:null}),E=a=>{a.priceStatus?d.orderBy=a.priceStatus===1?9:10:a.timeStatus?d.orderBy=a.timeStatus===1?8:7:a.totalPrice?d.orderBy=a.totalPrice===1?5:6:d.orderBy=null,S.value=0,N(d)},y=_([]),q=async a=>{var R,V,D,k,B;const r=await bt({page:S.value,size:n.value,type:Z.value,...d,...a});if(!r.success){b.value=!0;return}if(!r.data||!r.total){b.value=!0;return}m.value=r.total;const z=r.data.map(h=>h.id),C=await T(z);for(let h=0;h<r.data.length;h++){r.data[h].currentAmount=(R=C[h])==null?void 0:R.currentAmount,r.data[h].totalAmount=(V=C[h])==null?void 0:V.totalAmount,r.data[h].status=(D=C[h])==null?void 0:D.status,r.data[h].discountRate=+_t(+((k=C[h])==null?void 0:k.discountRate)).div(1e4).toNumber(),r.data[h].nextActionTime=((B=C[h])==null?void 0:B.nextActionTime)*1e3;const L=r.data[h].mainImageUrls.split(",").filter(G=>G!==""&&G!==null&&G!==void 0&&!Number.isNaN(G));r.data[h].mainImageUrls=L&&L.length>0?L[0]:""}y.value=S.value===1?r.data:y.value.concat(r.data),y.value.length>=m.value&&(b.value=!0)},rt=a=>{d.categoryId=v.categoryList[a.name]&&v.categoryList[a.name].id||null,N(d)},N=a=>{y.value=[],S.value=0,m.value=0,b.value=!1,a.pageKey&&a.pageKey==="flashSale"&&(d.title=a==null?void 0:a.title),W(d)},Y=_(null),dt=async()=>{const{data:a}=await wt();Y.value=a||null},ut=(a,r)=>{a.currentAmount=a.currentAmount+r,a.currentAmount>=a.totalAmount&&(a.status=20)},Z=_(null),mt=a=>{Z.value=a,N(d)},W=async a=>{s.value=!0,S.value+=1,await dt(),await q(a),s.value=!1};return F({handleSearch:N,handleBuySuccess:ut}),(a,r)=>{const z=A("van-loading"),C=A("VanList"),R=A("van-tab"),V=A("van-tabs"),D=A("van-pull-refresh");return l(),i("div",es,[$(D,{onRefresh:o(j).reload,class:"min-h-screen"},{default:P(()=>[$(ue,{"filter-show":!0,onChange:E,onChangeType:mt}),e.categoryList.length==0?(l(),U(z,{key:0,class:"text-center",size:"12px"},{default:P(()=>[vt(c(a.$t("common.loading")),1)]),_:1})):u("",!0),$(V,{active:x.value,"onUpdate:active":r[2]||(r[2]=k=>x.value=k),type:"card",onClickTab:rt},{default:P(()=>[(l(!0),i(et,null,st(e.categoryList,k=>(l(),U(R,{title:k[`${o(Tt)[o(g)]}Name`]||k.name,key:k.id},{default:P(()=>[t("div",ss,[$(C,{class:M({"bg-[#F9F5F7]":y.value.length>5}),loading:s.value,"onUpdate:loading":r[1]||(r[1]=B=>s.value=B),finished:b.value,"finished-text":a.$t("common.noMore"),"loading-text":a.$t("common.loading"),onLoad:W},{default:P(()=>[(l(!0),i(et,null,st(y.value,(B,h)=>(l(),U(ts,{style:it(h==y.value.length-1?"border-bottom:0":""),key:B,data:B,onRushToBuy:()=>{w("rushToBuy",B)},onHandleTo:r[0]||(r[0]=L=>{w("handleTo",L)}),systemTime:Y.value},null,8,["style","data","onRushToBuy","systemTime"]))),128))]),_:2},1032,["class","loading","finished","finished-text","loading-text"])])]),_:2},1032,["title"]))),128))]),_:1},8,["active"])]),_:1},8,["onRefresh"])])}}}),ds=X(as,[["__scopeId","data-v-aee71e36"]]);export{ds as F};
