import{_ as re,y as K,w as ce,a1 as pe,l as ge,r as b,x as me,be as E,D as ve,E as I,K as $,G as x,N as i,H as s,F as S,a2 as y,O as c,Q as n,R as h,P as r,a4 as B,bG as fe,bF as be,a0 as xe,br as he,Y as ye,Z as _e,T as k}from"./vendor-BUT0HZ5j.js";import{_ as Ce,C as we,a as Fe}from"./CategoryPop-w2COQ4fO.js";import{_ as Q}from"./right-arrow-D3mVT5UK.js";import{u as Ee}from"./upload-GisNQoOq.js";import{e as Ie,u as $e,r as Se,V as O,_ as Be,S as ke,X as Ve,aL as Ne,aQ as Ae,a2 as De,q as Pe}from"./index-hbwLMIYO.js";import{i as M}from"./offlineGoods-DvT2Go6q.js";import"./BackIcon-biFt6cm7.js";import"./search-Dwmdj_3F.js";import"./checked-C0ib8aDP.js";const V=_=>(ye("data-v-10e57ef4"),_=_(),_e(),_),qe={class:"bg-white rounded-xl overflow-hidden mx-3 px-3 pb-4 title"},Te={class:"border-b4 border-b border-solid"},Le={class:"text-sm text-[#2E2008] font-semibold"},Ue={class:"border-b4 border-b border-solid"},ze={class:"text-sm text-[#2E2008] font-semibold"},je={key:0,class:"border-b4 border-b border-solid"},Re={class:"text-sm text-[#2E2008] font-semibold"},Ge={key:1,class:"border-b4 border-b border-solid"},Oe={class:"text-sm text-[#2E2008] font-semibold"},Me={class:"flex justify-between items-center pt-4"},Ke={class:"text-sm text-[#2E2008] font-semibold"},Qe={class:"van-uploader__wrapper gap-3"},He=["onClick"],Xe={class:"van-image van-uploader__preview-image",style:{width:"60px",height:"60px","border-radius":"6px"}},Ye=["src"],Ze=["onClick"],Je=V(()=>s("img",{class:"w-[15px] h-[15px]",src:Fe,alt:""},null,-1)),We=[Je],et={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},tt=["src"],ot={class:"text-xs font-light text-center text-b1 opacity-30"},st={class:"bg-white rounded-xl overflow-hidden m-3 px-3 pb-4 title"},at={class:"border-b4 border-b border-solid"},lt={class:"text-sm text-[#2E2008] font-semibold"},ut=V(()=>s("img",{class:"shrink-0 ml-[2px] w-4 h-4",src:Q,alt:""},null,-1)),dt={class:"border-b4 border-b border-solid"},nt={class:"text-sm text-[#2E2008] font-semibold"},it=V(()=>s("img",{class:"shrink-0 ml-[2px] w-4 h-4",src:Q,alt:""},null,-1)),rt={class:"text-sm text-[#2E2008] font-semibold pt-4"},ct={class:"bg-white rounded-xl overflow-hidden m-3 px-3 py-4 title"},pt={class:"text-sm text-[#2E2008] font-semibold"},gt={key:0,class:"fixed bottom-0 left-0 w-full flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},mt={class:"p-1"},vt={class:"text-sm text-center text-[#2E2008] font-semibold"},ft={class:"flex items-center justify-between mt-6"},bt=K({name:"UserCreate"});function xt(_){const{t:g}=ce(),{accountStore:H,serviceCategoriesStore:N}=Ie(),{getCurrentStoreId:A}=$e(),{loadingToggle:D}=Se(),X=pe(),Y=ge(),o=b({shopName:null,goodsCategoryId1:null,goodsCategoryName1:null,goodsCategoryId2:null,goodsCategoryName2:null,goodsCategoryId3:null,goodsCategoryName3:null,goodsCategoryId:null,shopPics:"",dituxuandian:null,suozaidiqu:null,address:null,remark:null}),P=me(()=>!1),m=b([]),q=b([]),v=b(1),T=b(null),[Z,L]=E(!1),[C,U]=E(!1),[J,w]=E(!1),z=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e==="x"?t:t&3|8;return a.toString(16)}),W=e=>{let t=!1;const a=M.split(",");for(let p=0;p<a.length;p++)if(console.log(e==null?void 0:e.type,a[p]),(e==null?void 0:e.type)===a[p]){t=!0;break}return t||f(g("common.uploadImgTypeTips",{format:a.map(p=>p.slice(6).toLocaleUpperCase()).join("/")})),t},j=b(3),ee=async e=>{if(m.value.length>=j.value||!W(e.file))return;k.loading({message:g("common.uploading"),forbidClick:!0,duration:0});const t=await De(e,"goodsDesc"),a=await Ee(t);k.clear(),a.success&&m.value.push({id:z(),url:Pe.imgUrl+a.data})},te=e=>{m.value.splice(e,1)},oe=e=>{he({images:m.value.map(t=>t.url),startPosition:e})},F=(e,t,a)=>{q.value=Ne(N.fullCategories,{idKey:"goodsCategoryId",parentKey:"goodsCategoryParentId",rootId:t}),T.value=e,v.value=a,U(!0)},se=(e,t)=>{if(o.value[`goodsCategoryId${v.value}`]=e,o.value[`goodsCategoryName${v.value}`]=t,v.value<3)for(let a=v.value;a<3;a++)o.value[`goodsCategoryId${a+1}`]=null,o.value[`goodsCategoryName${a+1}`]=null},f=(e="",t="toast-warn.svg")=>{k({message:e,icon:O(t),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},ae=()=>o.value.shopName?!0:(f(g("offline.offline_name_placeholder")),!1),le=async()=>{var t;const e=m.value.map(a=>a.url);o.value.shopPics=e.join(","),o.value.shopId=(t=await A())==null?void 0:t.id},ue=async()=>{if(!ae())return;if(!o.value.goodsCategoryId1)return f(g("shop.pleaseSelect")+g("offline.one_category"));if(!o.value.goodsCategoryId2)return f(g("shop.pleaseSelect")+g("offline.two_category"));if(!o.value.goodsCategoryId3)return f(g("shop.pleaseSelect")+g("offline.three_category"));L(!0),await le();const{success:e,data:t}=await Ae(o.value);L(!1),e&&(o.value.goodsId=t,f("添加成功","toast-success.svg"),setTimeout(()=>{var a;Y.replace({path:"/offlineGoodsDetail",query:{goodsId:(a=o.value)==null?void 0:a.goodsId}})},2e3))},de=async()=>{var a;const e=(a=X.query)==null?void 0:a.goodsId;if(!e)return;const t=await Ve(e.toString(),!0);t.success&&(o.value=t.data,o.value.goodsId=e.toString(),o.value.shopPics&&(m.value=o.value.shopPics.split(",").map(p=>({id:z(),url:p}))))},ne=async()=>{var a;const{success:e,data:t}=await ke((a=await A())==null?void 0:a.merchant)};return ve(async()=>{D(!0),N.init(),await ne(),de(),D(!1)}),(e,t)=>{const a=I("van-field"),p=I("van-uploader"),ie=I("VanButton");return x(),$(we,{title:e.$t("添加新店"),class:"font-Puhui font-normal relative pb-20 bg-gray1",themeVars:{navBarBackgroundColor:"#F2F0EF"}},{default:i(()=>{var R,G;return[s("div",qe,[s("div",Te,[c(a,{"input-align":"right",maxlength:12,modelValue:o.value.shopName,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.shopName=l),placeholder:e.$t("shop.emptyName"),class:"no-bt"},{label:i(()=>[s("div",Le,n(e.$t("shop.shopName")),1)]),_:1},8,["modelValue","placeholder"])]),s("div",Ue,[c(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[1]||(t[1]=l=>{var u;return F((u=o.value)==null?void 0:u.goodsCategoryId1,0,1)})},{label:i(()=>[s("div",ze,n(e.$t("offline.one_category")),1)]),input:i(()=>{var l,u,d;return[s("div",{class:h(["dropdown text-b3",{"!text-b2":(l=o.value)==null?void 0:l.goodsCategoryId1,"down-active":v.value===1&&r(C)}])},n((u=o.value)!=null&&u.goodsCategoryId1?(d=o.value)==null?void 0:d.goodsCategoryName1:e.$t("shop.emptyClass")),3)]}),_:1})]),(R=o.value)!=null&&R.goodsCategoryId1?(x(),S("div",je,[c(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[2]||(t[2]=l=>{var u,d;return F((u=o.value)==null?void 0:u.goodsCategoryId2,(d=o.value)==null?void 0:d.goodsCategoryId1,2)})},{label:i(()=>[s("div",Re,n(e.$t("offline.two_category")),1)]),input:i(()=>{var l,u,d;return[s("div",{class:h(["dropdown text-b3",{"!text-b2":(l=o.value)==null?void 0:l.goodsCategoryId2,"down-active":v.value===2&&r(C)}])},n((u=o.value)!=null&&u.goodsCategoryId2?(d=o.value)==null?void 0:d.goodsCategoryName2:e.$t("shop.emptyClass")),3)]}),_:1})])):y("",!0),(G=o.value)!=null&&G.goodsCategoryId2?(x(),S("div",Ge,[c(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[3]||(t[3]=l=>{var u,d;return F((u=o.value)==null?void 0:u.goodsCategoryId3,(d=o.value)==null?void 0:d.goodsCategoryId2,3)})},{label:i(()=>[s("div",Oe,n(e.$t("offline.three_category")),1)]),input:i(()=>{var l,u,d;return[s("div",{class:h(["dropdown text-b3",{"!text-b2":(l=o.value)==null?void 0:l.goodsCategoryId3,"down-active":v.value===3&&r(C)}])},n((u=o.value)!=null&&u.goodsCategoryId3?(d=o.value)==null?void 0:d.goodsCategoryName3:e.$t("shop.emptyClass")),3)]}),_:1})])):y("",!0),s("div",Me,[s("div",Ke,n(e.$t("店铺照片")),1),s("div",Qe,[c(r(be),fe({class:"flex flex-wrap gap-3",modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=l=>m.value=l),"item-key":"id"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}),{item:i(({element:l,index:u})=>[s("div",{class:"van-uploader__preview",onClick:B(d=>oe(u),["stop"])},[s("div",Xe,[s("img",{src:l.url,class:"van-image__img rounded-md",style:{"object-fit":"cover"}},null,8,Ye)]),s("div",{class:"absolute top-[4.25px] right-[4px] z-[99]",onClick:B(d=>te(u),["stop"]),tabindex:"0"},We,8,Ze)],8,He)]),_:1},16,["modelValue"]),m.value.length<j.value?(x(),$(p,{key:0,accept:r(M),afterRead:ee},{default:i(()=>[s("div",et,[s("img",{src:r(O)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,tt),s("div",ot,n(e.$t("common.add img")),1)])]),_:1},8,["accept"])):y("",!0)])])]),s("div",st,[s("div",at,[c(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[5]||(t[5]=l=>r(w)(!0))},{label:i(()=>[s("div",lt,n(e.$t("地图选点")),1)]),input:i(()=>{var l,u,d;return[s("div",{class:h(["text-b3",{"!text-b2":(l=o.value)==null?void 0:l.dituxuandian}])},n((u=o.value)!=null&&u.dituxuandian?(d=o.value)==null?void 0:d.dituxuandian:e.$t("请选择店铺位置")),3),ut]}),_:1})]),s("div",dt,[c(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[6]||(t[6]=()=>{})},{label:i(()=>[s("div",nt,n(e.$t("所在地区")),1)]),input:i(()=>{var l,u,d;return[s("div",{class:h(["text-b3",{"!text-b2":(l=o.value)==null?void 0:l.suozaidiqu}])},n((u=o.value)!=null&&u.suozaidiqu?(d=o.value)==null?void 0:d.suozaidiqu:e.$t("请选择店铺所在地区")),3),it]}),_:1})]),s("div",rt,n(e.$t("详细地址")),1),c(a,{modelValue:o.value.address,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.address=l),rows:"1",autosize:"",type:"textarea",placeholder:e.$t("请输入店铺详细地址"),class:"no-bt",style:{"padding-top":"8px !important","padding-bottom":"0 !important"}},null,8,["modelValue","placeholder"])]),s("div",ct,[s("div",pt,n(e.$t("备注信息(仅审核人员可见)")),1),c(a,{modelValue:o.value.remark,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.remark=l),rows:"2",autosize:"",type:"textarea",placeholder:e.$t("请输入备注信息"),class:"no-bt",style:{"padding-top":"8px !important","padding-bottom":"0 !important"},maxlength:"200","show-word-limit":""},null,8,["modelValue","placeholder"])]),r(H).isOnlyView?y("",!0):(x(),S("div",gt,[c(ie,{round:"",class:h(["flex-1 min-w-[130px] h-[46px] text-base font-semibold",r(P)?"bg-b4 text-b2":"bg-btnOrBg text-b1"]),disabled:r(P),onClick:t[9]||(t[9]=l=>ue()),loading:r(Z)},{default:i(()=>[xe(n(e.$t("确认添加")),1)]),_:1},8,["disabled","class","loading"])])),r(C)?(x(),$(Ce,{key:1,list:q.value,level:v.value,id:T.value,onSelect:se,onClose:t[10]||(t[10]=l=>r(U)(!1))},null,8,["list","level","id"])):y("",!0),c(Be,{noClose:"",show:r(J),onClose:t[12]||(t[12]=l=>r(w)(!1))},{default:i(()=>[s("div",mt,[s("div",vt,n(e.$t("检测到您的地图选点位置信息与所输入店铺地址存在出入，请重新核对")),1),s("div",ft,[s("div",{class:"flex-1 h-[46px] leading-[46px] rounded-full text-base text-center text-[#2E2008] font-semibold bg-yellow",onClick:t[11]||(t[11]=B(l=>r(w)(!1),["stop"]))},n(e.$t("common.confirm")),1)])])]),_:1},8,["show"])]}),_:1},8,["title"])}}const ht=K({...bt,setup:xt}),Bt=re(ht,[["__scopeId","data-v-10e57ef4"]]);export{Bt as default};
