import{_ as Q,z as G,y as F,G as l,H as a,U as d,O as _,N as z,Q as x,I as s,J as P,K as Y,x as ie,Z as y,P as L,a4 as $e,a3 as we,T as X,F as M,X as ce,Y as de,o as Te,q as Ie,r as u,aa as Ce,D as oe,bm as Se,E as Le,$ as E}from"./vendor-Dr_RpJ_Y.js";import{a as Ae,z as qe,k as De,e as Ne,b as Be,ar as Re,by as ze,w as Ge,as as je,a0 as Ee,bz as Me,bA as Fe,aU as Oe,bm as Pe}from"./index-CU2nzZe6.js";import{a as Ve}from"./shop-CeqcS6K2.js";import{_ as Ue}from"./buy-cart-DX6aL7m1.js";import{_ as He}from"./BoutiqueLable-DDlxeK08.js";import{R as J}from"./RatioBox-BwMA7vB_.js";import{_ as Ke}from"./ShopMaskTips-ClYuWX9C.js";import{_ as le}from"./GoodsPrice-BO5T8eoh.js";import{_ as ne}from"./CardPrice-DihLnH8_.js";import{D as Ye}from"./goods-BVwS8oFG.js";import{M as Xe}from"./MallTabBar-DzVMF8TV.js";import{B as Je}from"./BackIcon-CDrGaEPo.js";import{a as Qe}from"./category-CPc0zbBB.js";import{c as We}from"./mall-COk3vM6s.js";import{_ as Ze}from"./DefaultPage-BhlLBoz9.js";import{_ as et}from"./ServiceIcon-Ce2ytRnc.js";import{_ as tt}from"./MCOIN-BOqZVkND.js";import{_ as st}from"./ImgBoutiqueLable-B-2xCcw4.js";import"./convertToImage-Cfv7lGZo.js";import"./upload-GBdaxjFw.js";import"./active_empty-ofPcrP74.js";import"./HelpPop-DStj4MIe.js";const at="/static/images/flashSale-DOaFK4_-.png",ot="/static/images/unflashSale-CjYqec_P.png",lt={class:"relative z-20 whitespace-nowrap flex justify-center gap-16 px-12 py-2.5 overflow-hidden bg-white rounded-t-lg sort-shadow text-black-400 text-sm font-normal"},nt={class:"flex items-center gap-1"},it={key:0,class:"w-4 h-4",src:at},ct={key:1,class:"w-4 h-4",src:ot},dt=G({props:{deliveryType:null},emits:["change"],setup(e,{emit:f}){const{useShopStore:r}=Ae(),g=F(()=>r.shopMenus&&r.shopMenus.includes(4)),c=F(()=>r.shopMenus&&r.shopMenus.includes(3));return(i,k)=>(a(),l("div",lt,[_(g)?(a(),l("div",{key:0,class:z({active:e.deliveryType===1}),onClick:k[0]||(k[0]=n=>f("change",1))},x(i.$t("common.send")),3)):d("",!0),_(g)?(a(),l("div",{key:1,class:z({active:e.deliveryType===2}),onClick:k[1]||(k[1]=n=>f("change",2))},x(i.$t("shop.offline server")),3)):d("",!0),_(c)?(a(),l("div",{key:2,class:z({active:e.deliveryType===3}),onClick:k[2]||(k[2]=n=>f("change",3))},[s("div",nt,[e.deliveryType===3?(a(),l("img",it)):(a(),l("img",ct)),s("span",null,x(i.$t("order.onesale order")),1)])],2)):d("",!0)]))}}),rt=Q(dt,[["__scopeId","data-v-3069830c"]]),ut={class:"relative w-[100px] h-full overflow-hidden border-solid border-r-2 border-primary-008"},vt={class:"w-[98px] h-full overflow-y-auto flex flex-col gap-2 py-4"},mt=["onClick"],yt={class:"font-normal leading-6 text-center"},ft=G({props:{list:{default:()=>[]},flashSaleList:{default:()=>[]},classId:{default:null},shopId:null,deliveryType:null},emits:["change"],setup(e,{emit:f}){const r=e,{currentLocale:g}=qe(),c=F(()=>r.deliveryType===3?r.flashSaleList.map(i=>({...i,name:i[`${Ve[g.value]}Name`]})):r.list.filter(i=>+i.type==+r.deliveryType||!i.type));return(i,k)=>(a(),l("div",ut,[s("div",vt,[(a(!0),l(P,null,Y(_(c),n=>(a(),l("div",{class:z(["relative py-1.5 pl-4 pr-2 text-sm text-black-400",{"text-black-800 bg-primary-008":e.classId===n.id}]),key:n.id,onClick:$=>f("change",n.id)},[s("span",yt,x(n.name),1)],10,mt))),128))])]))}}),gt="/static/images/offline-black-OiwvbEll.svg",ht="/static/images/cart-icon-ibBU6cSG.svg",pt="/static/images/Rob-CY-NIaX_.png",xt="/static/images/Robed-BOyO2jaS.png",kt={class:"flex items-start justify-between"},bt={class:"w-[90px] h-[90px] relative"},_t=["src"],$t={class:"text-sm flex items-center mb-1.5 relative"},wt={class:"text-sm flex-1 w-0 font-semibold leading-[0.875rem] truncate text-default mr-1"},Tt={class:"flex items-center"},It={class:"flex-1"},Ct={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},St={key:0,class:"flex items-center gap-1"},Lt={class:"inline-flex bg-[#FED73A] items-center gap-1 px-1.5 py-1 text-xs font-bold rounded bg-ratio text-black no-wrap"},At=s("img",{class:"w-[1rem] h-[1rem]",src:gt},null,-1),qt={key:1,class:"text-sm font-bold"},Dt={class:"flex items-end mt-1"},Nt=["onClick"],Bt={key:0,class:"w-6 h-6",src:ht},Rt={key:1,class:"w-6 h-6",src:Ue},zt={key:1,class:"flex w-full"},Gt={key:0,class:"text-sm font-bold"},jt={class:"ml-auto"},Et={key:0,class:"w-5 h-5 mr-2",src:pt},Mt={key:1,class:"w-5 h-5 mr-2",src:xt},Ft=s("div",{class:"flex items-center h-2.5"},[s("div",{class:"h-[1px] w-full bg-black-100"})],-1),Ot=G({props:{data:null,deliveryType:null},emits:["handleAddCart","click"],setup(e,{emit:f}){const r=e,{t:g}=ie(),c=async()=>{if(r.data.goods.stock===0&&r.data.goods.goodsTypes!=2){X(g("order.Insufficient stock"));return}r.data.goods.deliveryType===1?f("handleAddCart",r.data.goods):f("click")};return(i,k)=>(a(),l(P,null,[e.data.goods?(a(),l("div",{key:0,class:"w-full py-3 bg-white rounded",onClick:k[0]||(k[0]=n=>f("click"))},[s("section",kt,[s("div",bt,[(e.data.goods.status!=1||!+e.data.goods.stock)&&e.deliveryType!==3&&e.data.goods.goodsTypes!=2?(a(),y(Ke,{key:0,status:e.data.goods.status,stock:e.data.goods.stock},null,8,["status","stock"])):d("",!0),s("img",{src:e.data&&e.data.goods&&e.data.goods.icons&&e.data.goods.icons.split(",")[0]||_(De)("images/activity/boutique/squre_empty.png"),class:"rounded w-[90px] h-[90px] aspect-square object-cover"},null,8,_t)]),s("section",{class:z(["flex-1 min-h-[90px] ml-2 flex flex-col",{" justify-between":e.deliveryType==3}])},[s("div",$t,[e.data.goods.type?(a(),y(He,{key:0,type:e.data.goods.type,class:"flex-shrink-0 mr-1"},null,8,["type"])):d("",!0),s("div",wt,x(e.data.goods.goodsName),1)]),s("div",Tt,[s("div",It,[s("div",Ct,x(e.data.goods.goodsDesc),1),e.deliveryType===2?(a(),l("div",St,[s("div",Lt,[At,$e(" "+x(i.$t("common.offline")),1)]),L(J,{ratio:e.data.goods.discountRatio},null,8,["ratio"])])):d("",!0),e.deliveryType!==3?(a(),l("div",qt,[e.data.goods.payType!==2?(a(),y(le,{key:0,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),y(ne,{key:1,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0)])]),s("div",Dt,[s("div",null,[e.data.goods.payType!==2&&Number(e.data.goods.deliveryType)===_(Ye).online&&e.deliveryType!=3?(a(),y(J,{key:0,class:"flex-shrink-0",tag:i.$t("common.rebate"),ratio:e.data.goods.discountRatio||0},null,8,["tag","ratio"])):d("",!0)]),e.deliveryType!=3?(a(),l("div",{key:0,onClick:we(c,["stop"]),class:"px-1.5 ml-auto"},[e.data.goods.deliveryType===1?(a(),l("img",Bt)):(a(),l("img",Rt))],8,Nt)):(a(),l("div",zt,[e.deliveryType===3?(a(),l("div",Gt,[e.data.goods.payType!==2?(a(),y(le,{key:0,price:e.data.goods.price},null,8,["price"])):d("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),y(ne,{key:1,class:"ml-auto",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):d("",!0)])):d("",!0),s("div",jt,[+e.data.goods.status>=15?(a(),l("img",Et)):(a(),l("img",Mt))])]))])],2)])])):d("",!0),Ft],64))}}),Pt=e=>(ce("data-v-332bed3a"),e=e(),de(),e),Vt=["data-store-name"],Ut={class:"shrink-0 w-[80px] h-[80px] overflow-hidden relative"},Ht={class:"ml-2 flex-1 flex flex-col justify-between min-h-[80px]",style:{width:"calc(100% - 80px - 8px)"}},Kt={class:"w-full"},Yt={class:"w-full"},Xt={class:"font-semibold text-sm text-b1 line-clamp-1"},Jt={class:"w-full"},Qt={class:"font-normal text-sm text-b3 line-clamp-1"},Wt={class:"flex items-center justify-start"},Zt={class:"flex items-center"},es=Pt(()=>s("img",{src:tt,class:"w-4 h-4 mr-1"},null,-1)),ts={class:"text-b1 font-semibold text-sm"},ss=G({props:{goods:{type:Object,default:()=>({})}},setup(e){const f=e,r=F(()=>{var c;return(((c=f.goods.goodsIcons)==null?void 0:c.split(","))||[""])[0]});return(g,c)=>{const i=M("VanImage");return a(),l("section",{class:"flex items-start font-Puhui","data-store-name":e.goods.shopName},[s("div",Ut,[L(i,{src:_(r),class:"w-[80px] h-[80px] rounded-lg overflow-hidden",alt:g.$t("goods.goodsImage"),fit:"cover"},null,8,["src","alt"]),L(st,{type:e.goods.goodsType||null},null,8,["type"])]),s("div",Ht,[s("div",Kt,[s("div",Yt,[s("div",Xt,x(e.goods.goodsName||""),1)]),s("div",Jt,[s("div",Qt,x(e.goods.goodsDesc||""),1)])]),s("div",Wt,[s("div",Zt,[es,s("div",ts,x(_(Ne)(e.goods.goodsPrice)),1)]),e.goods.goodsDiscountRatio?(a(),y(J,{key:0,class:"ratio-box ml-1 !px-1",tag:g.$t("common.rebate"),ratio:e.goods.goodsDiscountRatio},null,8,["tag","ratio"])):d("",!0)])])],8,Vt)}}}),as=Q(ss,[["__scopeId","data-v-332bed3a"]]),os=e=>(ce("data-v-2635e96a"),e=e(),de(),e),ls={class:"z-50 overflow-y-auto parent-view mall-header-bg"},ns={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},is={class:"flex relative justify-center items-center h-[44px] px-2.5"},cs={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},ds={class:"font-semibold"},rs={class:"absolute right-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},us={class:"px-2.5 sticky top-[44px]"},vs={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},ms=os(()=>s("div",{class:"h-[16px]"},null,-1)),ys={class:"overflow-hidden shadow-box"},fs={class:"mall-header-bg mall-header-bg-box"},gs={key:0,class:"px-2.5 py-2.5"},hs={key:1,class:"p-3"},ps=G({name:"CategoryShopDetail"});function xs(e){const{checkLoginAuth:f,checkRegisterAuth:r}=Be(),{t:g}=ie(),c=Te(),i=Ie(),k=Re(),n=u(1);c.query.deliveryType&&(n.value=Number(c.query.deliveryType));const $=F(()=>c.query.shopId||null),V=u(null);V.value=c.query.shopId;const O=u(null),{y:W}=Ce(O);oe(()=>$,async t=>{t.value&&t.value!==V.value&&(V.value=t.value,b.value&&(b.value=null),ae(),A())},{deep:!0});const b=u(null),re=t=>{b.value!==t&&(b.value=t,A())};oe(()=>c.query.deliveryType,()=>{c.query.deliveryType&&+c.query.deliveryType!=+n.value&&(n.value=Number(c.query.deliveryType),b.value=null,U(),A())},{deep:!0});const h=u(null),ue=async()=>{if(!$.value)return;const t=await Ee($.value);!t.success||!t.data||(h.value=t.data,A())},ve=t=>{n.value!==t&&(C.value="",i.replace({path:"category",query:{deliveryType:t,shopId:$.value}}),n.value=t,b.value=null,D.value=[],D.value.unshift({name:"推薦",id:null}),U(),A())},D=u([]),U=async()=>{if(n.value===2){try{const{success:o,data:w}=await Me({shopId:$.value});if(!o)return;const v=(w||[]).filter(N=>N.goodsCount>0).map(N=>({name:N.goodsCategoryName,id:N.goodsCategoryId}));v.unshift({name:"推薦",id:null}),D.value=v}catch(o){console.error("获取线下服务类目数据失败:",o),D.value=[]}return}const t=await Qe({address:h.value.merchant});t.success&&(D.value=t.data||[],D.value.unshift({name:"推薦",id:null}))},H=u([]),me=async()=>{const t=await Fe(h.value.merchant);t.success&&(H.value=t.data||[],H.value.unshift({cnName:"推薦",jpName:"推薦する",enName:"recommend",id:null}))},p=u([]),B=u(!1),I=u(!1),S=u(0),K=u(10),R=u(0),ye=u,Z=async()=>{!h.value&&$.value||(B.value=!0,S.value+=1,await fe(),setTimeout(()=>{B.value=!1},1500))},C=u(""),fe=async()=>{if(n.value===2){await ge();return}await he()},ge=async()=>{var v;let t=null,o=null;b.value===null?(o="desc|goods_sales_volume,asc|goods_id",t=null):(o="asc|goods_id",t=b.value||null);const w={page:S.value,size:K.value,goodsStatus:1,goodsNameLike:C.value,shopId:((v=h.value)==null?void 0:v.id)||"",goodsCategoryId1:t,sortBy:o,distinctFlag:!0,deleteFlag:!1},T=await Oe(w);if(B.value=!1,!T.success||!T.data||!T.data.total){I.value=!0,p.value=S.value===1?[]:p.value;return}R.value=T.data.total;const q=T.data.records||[];p.value=S.value===1?q:p.value.concat(q),p.value.length>=R.value&&(I.value=!0)},he=async()=>{var T,q;const t={page:S.value,size:K.value,status:1,subclassId:b.value,deliveryType:n.value,merchant:(T=h.value)==null?void 0:T.merchant,keyword:C.value,deleteFlag:!1};let o=null;if(n.value===3?o=await Pe({page:S.value,size:K.value,merchant:(q=h.value)==null?void 0:q.merchant,categoryId:b.value?b.value:null,title:C.value}):o=await We(t),B.value=!1,!o.success){I.value=!0;return}if(!o.data||!+o.total){I.value=!0,p.value=S.value===1?[]:p.value;return}R.value=o.total;const w=u([]);n.value===3?w.value=o.data.map(v=>({goods:{...v,goodsName:v.title,icons:v.mainImageUrls,deliveryType:v.shippingMethod}})):w.value=o.data.map(v=>({goods:v.goods,stores:v.stores||ye,card:v.card})),p.value=S.value===1?w.value:p.value.concat(w.value),p.value.length>=R.value&&(I.value=!0)},{loadingToggle:ee}=Ge(),pe=async t=>{if(t.stock===0&&t.goodsTypes!=2){X(g("order.Insufficient stock"));return}ee(!0);const o=await je(t.id);ee(!1),o.success&&(X(g("cart.addTips")),k.getCartCount())},xe=t=>{f(!0)&&i.push(t)},te=t=>{i.push(t)},se=u(null),ke=t=>{t.code==="Enter"&&(A(),se.value.blur())},be=()=>{C.value="",A()},A=()=>{if(W.value=0,h.value&&+h.value.status!=1){I.value=!0;return}p.value=[],S.value=0,R.value=0,I.value=!1,Z()},_e=t=>{let o={};t.goodsId&&(o.goodsId=t.goodsId),t.storeId&&(o.storeId=t.storeId),i.push({path:"/offlineGoodsDetail",query:o})},ae=async()=>{if(await ue(),h.value&&+h.value.status!=1){I.value=!0;return}C.value="",U(),me()};return Se(()=>{O.value&&O.value.scrollTo(0,W.value)}),Le(()=>{ae()}),(t,o)=>{var N;const w=M("van-icon"),T=M("van-field"),q=M("van-sticky"),v=M("VanList");return a(),l("div",ls,[s("section",ns,[s("section",is,[s("div",cs,[L(Je,null,{default:E(()=>[s("span",null,x(t.$t("common.return")),1)]),_:1})]),s("div",ds,x(t.$t("shop.Classification")),1),s("div",rs,[L(et,{shop:h.value,showInfo:"",onHandleTo:te},null,8,["shop"])])]),s("section",us,[L(T,{ref:(m,j)=>{j.searchRef=m,se.value=m},"model-value":C.value,"onUpdate:model-value":o[0]||(o[0]=m=>C.value=m),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:ke,placeholder:t.$t("mall.Enter search keywords"),onClear:be,enterkeyhint:"search"},{"left-icon":E(()=>[C.value?d("",!0):(a(),y(w,{key:0,name:"search",size:"18"}))]),"right-icon":E(()=>[s("div",{onClick:A},[C.value?(a(),y(w,{key:1,name:"search",size:"18"})):(a(),l("div",vs,x(t.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),ms]),s("div",ys,[L(q,{"offset-top":90},{default:E(()=>[s("div",fs,[L(rt,{deliveryType:n.value,onChange:ve},null,8,["deliveryType"])])]),_:1}),s("div",{class:z(["relative flex bg-white h-[calc(100vh-84px)] overflow-hidden",{"safe-bottom-page":_($)}])},[L(ft,{shopId:_($),classId:b.value,list:D.value,flashSaleList:H.value,onChange:re,deliveryType:n.value},null,8,["shopId","classId","list","flashSaleList","deliveryType"]),s("div",{class:"relative flex-1 h-full overflow-y-auto",ref:(m,j)=>{j.listPageRef=m,O.value=m}},[I.value&&R.value===0?(a(),y(Ze,{key:0,title:t.$t("common.No products")},null,8,["title"])):(a(),y(v,{key:1,loading:B.value,"onUpdate:loading":o[1]||(o[1]=m=>B.value=m),finished:I.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:Z},{default:E(()=>[n.value!==2?(a(),l("div",gs,[(a(!0),l(P,null,Y(p.value,m=>(a(),y(Ot,{data:m,onClick:j=>n.value==3?xe(`/saleGoodDetail?id=${m.goods.id}`):te(`/goodsDetail?id=${m.goods.id}`),onHandleAddCart:pe,deliveryType:n.value},null,8,["data","onClick","deliveryType"]))),256))])):(a(),l("div",hs,[(a(!0),l(P,null,Y(p.value,m=>(a(),y(as,{goods:m,class:"mb-4 :last:mb-0",onClick:j=>_e(m),"show-store-name":""},null,8,["goods","onClick"]))),256))]))]),_:1},8,["loading","finished","finished-text","loading-text"]))],512)],2)]),_($)?(a(),y(Xe,{key:0,shopId:_($),shopType:(N=h.value)==null?void 0:N.type},null,8,["shopId","shopType"])):d("",!0),n.value!==3?(a(),y(ze,{key:1})):d("",!0)])}}const ks=G({...ps,setup:xs}),Ps=Q(ks,[["__scopeId","data-v-2635e96a"]]);export{Ps as default};
