import{_ as me,y as ve,w as ge,be as U,r as i,bf as fe,x as he,D as be,F as k,G as v,H as s,a2 as h,K as B,O as I,Q as c,R as X,a0 as xe,P as t,N as Q,E as j,Y as ye,Z as _e,B as p,bU as we,T as Ce}from"./vendor-BUT0HZ5j.js";import{N as Z,_ as ke}from"./NumberKeyBoardInput-rTF2yoM9.js";import{B as Be}from"./BackIcon-biFt6cm7.js";import{d as b,B as S,s as J,q as W,g as A,bS as Ie,G as Ae}from"./index-k1FFr-1T.js";import{a as Fe}from"./storeValue-CNzIAHRo.js";import{p as $e}from"./piggyBank-9mCv12Ur.js";import{_ as Ee}from"./EmptyTipsPop-_FH8A6A8.js";import"./close-DLkDHnDK.js";const Me=F=>(ye("data-v-9de7ecda"),F=F(),_e(),F),Se={class:"px-3 bg-[#f2f0ef]"},Ve={class:"gap-2 mt-2 flex-start"},Ne={class:"mt-2.5 flex"},Te={class:"absolute top-1/2 left-1/2 translate-x-[-56%] translate-y-[-50%] text-black z-50"},Le={class:"absolute top-1/2 left-1/2 translate-x-[-46%] translate-y-[-50%] text-black z-50"},Oe={key:0,class:"bg-white mt-2.5 p-4 rounded-xl text-[#2E2008]"},ze={class:"flex justify-between text-xs opacity-60"},Ue={class:"flex items-center"},je={key:1},qe={class:"bg-[#FFF8EC] rounded-xl px-0.5 pr-2.5 py-2 mt-4 flex justify-between items-center w-full relative"},De=["src"],Pe={class:"text-[#2E2008] text-base"},Ye={key:1,class:"mt-2.5 rounded-2xl wallet-bg p-4 text-[#2E2008"},Ge={class:"text-base opacity-60"},He={class:"bg-[#FFF8EC] rounded-xl p-2.5 mt-4"},Ke={class:"text-sm opacity-40"},Re={class:"mt-1.5"},Xe={key:2,class:"bg-white mt-2.5 p-4 rounded-xl text-[#2E2008]"},Qe={class:"flex justify-between text-xs opacity-60"},Ze={class:"bg-[#FFF8EC] rounded-xl px-0.5 pr-2.5 py-2 mt-4 flex justify-between items-center w-full relative"},Je={class:"flex-center"},We=["src"],et=Me(()=>s("div",{class:"w-[1px] h-[15px] bg-[#EBEBEB] mx-2"},null,-1)),tt={class:"bg-[#F9F9F9] rounded-xl py-2 px-2.5 mt-4"},at={class:"text-[#2E2008] text-base"},st=ve({setup(F){const{t:q}=ge(),{userIds:D,userMerchantCashs:ee,withdraw:te,pending:ae,transfer:se}=$e(),[P,Y]=U(!1),f=i(0),G=e=>{e!==f.value&&(f.value=e,u.value=null,g.value=null)},m=fe({address:"",remark:""}),[le,V]=U(!1),oe=async()=>{var a;let e=u.value;g.value&&(e=u.value>=b((a=l.value)==null?void 0:a.accountAmount)?g.value:u.value),E(!0);try{if(m.address=m.address.replace(/ +/g,"").replace(/[\r\n]/g,""),!we(m.address))return Ce(q("errorMsg.invalid address"));let d={success:!1};try{d=await se(Ie(m.address),e,y.value,m.remark)}catch(r){Ae(r)}if(!d.success)return;u.value=null,g.value=null,T.value=null,w.value=null,C.value=null,L.value=null,m.address="",m.remark="",V(!0),z()}finally{E(!1),setTimeout(()=>{V(!1)},2e3)}},H=i(null),ne=async()=>{H.value=p(await J(W.MCOIN).balanceOf()).toString()},u=i(null),x=i([]),y=i(0),l=he(()=>x.value&&x.value.length>0?x.value.find(e=>e.storedCardId===y.value):{}),re=e=>{y.value=e,u.value=null,g.value=null,Y(!1)},g=i(null),$=()=>{var e,a,d;g.value=(((e=l.value)==null?void 0:e.accountAmount)||0)+"",u.value=(a=l.value)!=null&&a.accountAmount?b((d=l.value)==null?void 0:d.accountAmount)+"":""},[K,E]=U(!1),ue=async()=>{var a;let e=u.value;g.value&&(e=u.value>=b((a=l.value)==null?void 0:a.accountAmount)?g.value:u.value),E(!0);try{if(!(await te(_.value+"",e,y.value+"")).success)return;u.value=null,g.value=null,T.value=null,w.value=null,C.value=null,L.value=null,z()}finally{E(!1)}},_=i(0),de=async()=>{const e=await D();_.value=+e,_.value&&await ce()},N=i({}),M=i([]),ce=async()=>{C.value="0";const{success:e,result:a}=await ee(_.value+"");if(e){const d=a.amounts.map(o=>S(o)),r=a.cashIds.map(o=>+o);r.forEach((o,n)=>{N.value[o]=d[n],o===0?w.value=p(w.value||0).plus(d[n]||0).toString():(M.value.push(r[n]),C.value=p(C.value||0).plus(p(d[n]||0)).toString())})}},T=i("0"),w=i("0"),C=i("0"),L=i("0"),ie=async()=>{const e=await D();_.value=e;const a=await ae(e.toString());let d="0";a.fixs.forEach(n=>{d=p(d).plus(p(S(n)||0)).toString()});let r="0";a.floats.forEach(n=>{r=p(r).plus(S(n)||0).toString()});let o="0";a.records.forEach(n=>{o=p(n.amount).plus(S(n.amount)||0).toString()}),T.value=new p(r).plus(new p(d)).plus(new p(o)).toString()},pe=async()=>{var a,d;x.value=[];const e=[];if(M.value&&M.value.length>0){const r=await Fe(M.value.join(","));for(let o=0;o<((a=r.data)==null?void 0:a.length);o++){if(!r.data[o].contract)continue;const n=p(await J(r.data[o].contract).balanceOf()).toString();let R=0;N.value[r.data[o].storedCardId||r.data[o].id]&&(R=N.value[r.data[o].storedCardId||r.data[o].id]),e.push({...r.data[o],storedCardId:r.data[o].storedCardId||r.data[o].id,walletShowName:r.data[o].shopName,quota:n,accountAmount:R})}}e.unshift({storedCardId:0,shopName:q("piggy.My_purse"),walletShowName:"Mcoin",quota:H.value,symbol:"MCOIN",symbolLogo:A("images/ecology/wallet.png"),contract:W.MCOIN,accountAmount:(d=p(w.value||0).plus(p(L.value||0)))==null?void 0:d.toString()}),x.value=e},O=i(!1),z=async()=>{O.value=!0,await ie(),await ne(),await de(),O.value=!1,pe()};return be(()=>{z()}),(e,a)=>{const d=j("VanLoading"),r=j("VanButton"),o=j("van-field");return v(),k("div",Se,[s("div",Ve,[I(Be),s("div",null,c(e.$t("piggy.Lightning Yuâ€™E Bao")),1)]),s("div",Ne,[s("div",{class:"relative w-1/2 overflow-hidden rounded-md",onClick:a[0]||(a[0]=n=>G(0))},[s("div",{class:X(["text-center trapezoid-t",{"trapezoid-t-active":f.value===0}])},null,2),s("div",Te,c(e.$t("piggy.TransferTYourself")),1)]),s("div",{class:"relative w-1/2 overflow-hidden rounded-md",onClick:a[1]||(a[1]=n=>G(1))},[s("div",{class:X(["text-center trapezoid-b",{"trapezoid-b-active":f.value===1}])},null,2),s("div",Le,c(e.$t("piggy.transferToOthers")),1)])]),f.value===0?(v(),k("div",Oe,[s("div",ze,[s("span",null,c(e.$t("piggy.Transfer_amount")),1),s("span",Ue,[xe(c(e.$t("piggy.Account_Balance"))+" ",1),O.value?(v(),B(d,{key:0,size:"18"})):(v(),k("span",je,c(t(l)&&t(b)(t(l).accountAmount||0,4))+" "+c(t(l)&&t(l).symbol),1))])]),s("div",qe,[s("img",{class:"w-6 h-6 ml-2.5 mr-1",src:t(l).storedCardId?t(l).symbolLogo||t(A)("images/piggyBank/default-token.png"):t(A)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,De),I(Z,{class:"py-1.5 flex-1 bg-[#FFF8EC] text-lg font-bold text-[#2E2008]",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=n=>u.value=n),placeholder:"0",reg:/^\d+(\.\d{0,2})?$/,max:t(l)&&t(b)(t(l).accountAmount),onMaxInput:$,customMax:!0},null,8,["modelValue","reg","max"]),s("div",{class:"px-1.5 py-0.5 border-[1px] border-[#FBA923] border-solid rounded text-xs text-[#FBA923] font-medium absolute right-2.5",onClick:$}," MAX ")]),t(l)&&t(l).contract?(v(),B(r,{key:0,onClick:ue,loading:t(K),disabled:u.value<=0||+t(l).accountAmount<u.value,class:"btn mt-5 mb-1.5 block font-semibold bg-[#FED73A] h-[50px] w-full px-4 rounded-3xl text-base text-center leading-[50px]"},{default:Q(()=>[s("span",Pe,c(e.$t("piggy.Confirm_transfer_out")),1)]),_:1},8,["loading","disabled"])):h("",!0)])):h("",!0),f.value===1?(v(),k("div",Ye,[s("div",Ge,c(e.$t("piggy.TransferOtherBao")),1),s("div",He,[s("div",Ke,c(e.$t("home.receiveAddress")),1),s("div",Re,[I(o,{rows:"1",autosize:{maxHeight:48},size:"large",class:"value","input-align":"left",modelValue:t(m).address,"onUpdate:modelValue":a[3]||(a[3]=n=>t(m).address=n),type:"textarea",placeholder:e.$t("shop.pleaseInput")+e.$t("home.receiveAddress")},null,8,["modelValue","placeholder"])])])])):h("",!0),f.value===1?(v(),k("div",Xe,[s("div",Qe,[s("span",null,c(e.$t("piggy.Transfer_amount")),1),s("span",null,c(e.$t("piggy.Account_Balance"))+c(t(l)&&t(b)(t(l).accountAmount||0,4))+" "+c(t(l)&&t(l).symbol),1)]),s("div",Ze,[s("div",Je,[s("img",{class:"w-6 h-6 ml-2.5 rounded-full",src:t(l).storedCardId?t(l).symbolLogo||t(A)("images/piggyBank/default-token.png"):t(A)("images/tokens/MCOIN.png"),alt:"",srcset:""},null,8,We),et]),I(Z,{class:"py-1.5 flex-1 bg-[#FFF8EC] text-lg font-bold text-[#2E2008]",modelValue:u.value,"onUpdate:modelValue":a[4]||(a[4]=n=>u.value=n),placeholder:"0",reg:/^\d+(\.\d{0,2})?$/,max:t(l)&&t(b)(t(l).accountAmount),onMaxInput:$,customMax:!0},null,8,["modelValue","reg","max"]),s("div",{class:"px-1.5 py-0.5 border-[1px] border-[#FBA923] border-solid rounded text-xs text-[#FBA923] font-medium absolute right-2.5",onClick:$}," MAX ")]),s("div",tt,[I(o,{maxlength:"20",rows:"1",autosize:"",type:"textarea",modelValue:t(m).remark,"onUpdate:modelValue":a[5]||(a[5]=n=>t(m).remark=n),colon:"",label:e.$t("order.remark"),placeholder:e.$t("shop.pleaseInput")+e.$t("order.remark"),"input-align":"right"},null,8,["modelValue","label","placeholder"])]),t(l)&&t(l).contract?(v(),B(r,{key:0,onClick:oe,loading:t(K),disabled:u.value<=0||+t(l).accountAmount<u.value||!t(m).address,class:"btn mt-5 mb-1.5 block font-semibold bg-[#FED73A] h-[50px] w-full px-4 rounded-3xl text-base text-center leading-[50px]"},{default:Q(()=>[s("span",at,c(e.$t("piggy.Confirm_transfer_out")),1)]),_:1},8,["loading","disabled"])):h("",!0)])):h("",!0),t(P)?(v(),B(ke,{key:3,field:"accountAmount",currentTag:f.value,list:x.value,id:y.value,onClose:a[6]||(a[6]=n=>t(Y)(!1)),onSelectCard:re,show:t(P)},null,8,["currentTag","list","id","show"])):h("",!0),t(le)?(v(),B(Ee,{key:4,onClose:a[7]||(a[7]=n=>t(V)(!1)),text:e.$t("common.Transfer_successful")},null,8,["text"])):h("",!0)])}}}),pt=me(st,[["__scopeId","data-v-9de7ecda"]]);export{pt as default};
