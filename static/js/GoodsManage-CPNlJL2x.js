import{_ as Q}from"./MCOIN-BcbOHmhy.js";import{_ as X,y as A,w as Y,l as Z,a1 as W,r as C,bf as P,x as ee,D as oe,bh as te,bj as se,E as k,K as _,G as g,N as r,O as h,H as f,a2 as O,P as t,F as E,J as ne,Q as u,a0 as S,I as le,R as ie,Y as ae,Z as de}from"./vendor-BUT0HZ5j.js";import{C as re}from"./CommonVanProvider-BpsZUrD3.js";import{_ as ce}from"./OfflineGoods-BjltvH3M.js";import{S as fe}from"./SearchBox-UBMJTZli.js";import{B as ue}from"./BetweenTab-Bn5ZVRk8.js";import{e as N,u as pe,V as ge,bF as he,aA as me,X as ye}from"./index-hbwLMIYO.js";import{D as ve}from"./goods-BVwS8oFG.js";import{c}from"./offlineGoods-DvT2Go6q.js";import{S as _e}from"./shop-CeqcS6K2.js";import"./BackIcon-biFt6cm7.js";import"./ImgBoutiqueLable-BF5Xoxsv.js";import"./search-Dwmdj_3F.js";import"./filter-B5MATEpa.js";import"./category-gHFe9XPA.js";/* empty css                                                               */const Se=y=>(ae("data-v-35d02770"),y=y(),de(),y),be=["src"],Ie={class:"text-b3"},xe={class:"px-3 mt-3"},Te={class:"flex items-center"},we=Se(()=>f("img",{src:Q,class:"w-4 h-4 mr-1.5"},null,-1)),Ce={class:"text-newOrigin"},ke={class:"relative flex justify-end text-xs mt-3"},Oe=A({name:"GoodsManage"});function Ve(y){var B;const{t:b}=Y(),{regionStore:I}=N(),V=Z(),G=W(),{getCurrentStoreId:R}=pe(),D=C(null),{accountStore:v,clerkStore:q}=N(),M=[{label:b("offline.onSale"),value:c.Published},{label:b("shop.watiShelf"),value:c.OffShelf},{label:b("offline.drafts"),value:c.DRAFT}],o=P({shopInfo:null,list:[],total:0,loading:!1,finished:!1}),l=P({shopId:(B=o.shopInfo)==null?void 0:B.id,page:0,size:10,goodsNameLike:"",goodsCategoryId1:"",goodsStatus:c.Published,goodsType:null,sortBy:"desc|create_time",distinctFlag:!0}),U=ee(()=>{var e;return(e=o==null?void 0:o.shopInfo)==null?void 0:e.type}),$=e=>{V.push(e)},z=async e=>{l.goodsType=(e==null?void 0:e.type)>=_e.SD?e.type:void 0,l.startTime=(e==null?void 0:e.upStartTime)||void 0,l.endTime=(e==null?void 0:e.upEndTime)||void 0,l.goodsCategoryId1=(e==null?void 0:e.subclassId)||void 0,p()},j=e=>{l.goodsStatus=e,V.replace({path:"offlineGoods",query:{status:e}}),p()},F=async(e,s)=>{e.loading=!0;const{success:i}=await he({goodsId:e.goodsId,shopId:e.shopId,goodsStatus:s});e.loading=!1,i&&(o.list=o.list.filter(a=>a.goodsId!==e.goodsId))},p=async()=>{o.finished=!1,o.total=0,o.list=[],l.page=0,x()},x=async()=>{var e,s;if(!((e=o.shopInfo)!=null&&e.id))return o.finished=!0;o.loading=!0,l.shopId=(s=o.shopInfo)==null?void 0:s.id,l.page+=1,await H(),o.loading=!1},H=async()=>{const{success:e,data:s}=await me(l);if(o.loading=!1,!e){o.finished=!0;return}const{records:i,total:a,current:w,pages:n}=s;if(!a||!i||!(i!=null&&i.length)){o.finished=!0;return}o.total=a;const d=C([]);d.value=i.map(K=>({btnLoading:!1,...K})),o.list=l.page===1?d.value:o.list.concat(d.value),+w>=+n&&(o.finished=!0)};let m=null;const J=async()=>{const e=localStorage.getItem("shopOffline_scrollTop");+e?m.scrollTo({top:+e,left:0,behavior:"instant"}):localStorage.removeItem("shopOffline_scrollTop")},T=C(!1),L=()=>{T.value||(T.value=!0,setTimeout(()=>{localStorage.setItem("shopOffline_scrollTop",m.scrollTop+""),T.value=!1},500))};return oe(async()=>{var e,s;m=document.querySelector(".shopGoodsPage"),m.addEventListener("scroll",L),(e=G.query)!=null&&e.status&&(l.goodsStatus=Number((s=G.query)==null?void 0:s.status)),o.shopInfo=await R(),x()}),te(async()=>{q.isClerk&&p();try{J();const e=sessionStorage.getItem("shop_offline_refresh_id");if(e==="add")p();else if(e){const s=await ye(e),i=o.list.findIndex(a=>a.goodsId===e);i>-1?s.data.goodsStatus!==o.list[i].goodsStatus?o.list.splice(i,1):o.list[i]=s.data:p()}}finally{sessionStorage.removeItem("shop_offline_refresh_id")}}),se(()=>{m.removeEventListener("scroll",L)}),(e,s)=>{const i=k("VanButton"),a=k("VanList"),w=k("router-view");return g(),_(re,{title:e.$t("offline.sale_services"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(n,d)=>{d.shopGoodsRef=n,D.value=n}},{right:r(()=>[f("img",{src:t(ge)(`mall/${t(I).country}-flag.svg`),class:"w-5 h-auto mr-1"},null,8,be),f("span",Ie,u(e.$t(`country.${t(I).country}`))+u(t(I).country),1)]),default:r(()=>[h(ue,{options:M,"label-key":"label","value-key":"value",modelValue:t(l).goodsStatus,"onUpdate:modelValue":s[0]||(s[0]=n=>t(l).goodsStatus=n),onChange:j},null,8,["modelValue"]),f("div",xe,[h(fe,{modelValue:t(l).goodsNameLike,"onUpdate:modelValue":s[1]||(s[1]=n=>t(l).goodsNameLike=n),deliveryType:t(ve).offeline,shopType:t(U),onOnSubmit:p,onOnFilter:z},null,8,["modelValue","deliveryType","shopType"])]),f("div",{class:ie(["m-3 overflow-y-auto shopGoodsPage",{"safe-body":!t(v).isOnlyView}])},[h(a,{loading:t(o).loading,"onUpdate:loading":s[2]||(s[2]=n=>t(o).loading=n),finished:t(o).finished,"immediate-check":!1,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:x},{default:r(()=>[(g(!0),E(le,null,ne(t(o).list,n=>(g(),E("div",{class:"offline-crad-box mb-3",key:n.goodsId},[h(ce,{showSale:"",showGoodsType:"",goods:n},{"bottom-price":r(()=>[f("div",Te,[we,f("div",Ce,u(n.goodsPrice),1)])]),_:2},1032,["goods"]),f("section",ke,[t(l).goodsStatus===t(c).Published&&!t(v).isOnlyView?(g(),_(i,{key:0,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:n.loading,onClick:d=>F(n,t(c).OffShelf)},{default:r(()=>[S(u(e.$t("shop.down")),1)]),_:2},1032,["loading","onClick"])):O("",!0),t(l).goodsStatus===t(c).OffShelf&&!t(v).isOnlyView?(g(),_(i,{key:1,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:n.loading,onClick:d=>F(n,t(c).Published)},{default:r(()=>[S(u(e.$t("shop.up")),1)]),_:2},1032,["loading","onClick"])):O("",!0),h(i,{color:"#FED73A",round:"",class:"!text-b1 font-semibold h-[32px] rounded-md px-3",onClick:d=>$(`/offlineGoodsEditGoods?goodsId=${n.goodsId.toString()}`)},{default:r(()=>[S(u(e.$t("shop.modify")),1)]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])],2),t(v).isOnlyView?O("",!0):(g(),_(i,{key:0,onClick:s[3]||(s[3]=n=>$("/offlineGoodsEditGoods")),class:"bg-btnOrBg w-[calc(100%-32px)] max-w-[343px] mx-auto h-[46px] flex-center text-b1 text-base font-semibold z-50 rounded-3xl"},{default:r(()=>[S(u(e.$t("offline.published_goods")),1)]),_:1})),h(w,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const Ge=A({...Oe,setup:Ve}),Je=X(Ge,[["__scopeId","data-v-35d02770"]]);export{Je as default};
