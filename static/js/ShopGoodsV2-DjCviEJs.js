import{z as le,y as te,F as W,G as v,H as c,I as n,Z as V,U as g,P as k,a1 as N,a3 as ae,O as l,Q as i,_ as He,x as We,o as Ze,q as Qe,a2 as se,r as p,bl as Xe,E as eo,bm as oo,ad as so,$ as b,J as to,K as ao,a4 as P,N as lo,X as no,Y as ro,n as uo,bu as io,T as co}from"./vendor-Dr_RpJ_Y.js";import{_ as Ce}from"./MCOIN-Bodfn-v1.js";import{C as fo}from"./CommonVanProvider-KZuKVOde.js";import{_ as po}from"./ImgBoutiqueLable-B-2xCcw4.js";import{_ as ho}from"./ShopMaskTips-ClYuWX9C.js";import{S as mo}from"./SearchBox-Db4E3c20.js";import{B as go}from"./BetweenTab-nGcUWfRT.js";import{b as vo,a as yo,u as wo,C as Se,Y as So}from"./index-7OiUoGXy.js";import{D as ko}from"./goods-BVwS8oFG.js";import{S as bo}from"./shop-CeqcS6K2.js";import{a as ke,d as Co,q as $o}from"./goods-BMcs_teV.js";import{c as be}from"./mall-BRPa8DWq.js";import"./BackIcon-CDrGaEPo.js";import"./search-C4fLtTfY.js";import"./filter-DRLh1k_O.js";import"./category-gSvk10eY.js";/* empty css                                                               */const xo={class:"flex items-start"},To={class:"relative h-[80px]"},_o={class:"ml-2 flex-1 flex flex-col justify-between min-h-[80px]"},Fo={class:"w-full flex flex-col items-start"},Do={class:"flex-center-bw w-full"},Io={class:"flex items-center"},Go={key:1,class:"font-semibold line-clamp-1"},Eo={key:0,class:"text-b3 line-clamp-1"},Vo={class:"flex items-center gap-2 font-normal"},Bo={key:0,class:"text-b3 min-w-fit"},Ro={key:1,class:"text-b3 line-clamp-1"},Ao={class:"flex items-center justify-between"},Oo={key:1,class:"flex items-center"},Lo=n("img",{src:Ce,class:"w-4 h-4 mr-1.5"},null,-1),qo={class:"text-b1 font-normal"},jo=le({props:{showSale:{type:Boolean},showStock:{type:Boolean},goods:null,showGoodsType:{type:Boolean},showDesc:{type:Boolean}},emits:["imageClick"],setup(s){const B=s,C=te(()=>{var d;return(((d=B.goods)==null?void 0:d.icons)||"").split(",")[0]});return(d,T)=>{var $,y,z,_,F,A;const R=W("VanImage");return c(),v("section",xo,[n("div",To,[!+s.goods.stock&&+s.goods.goodsTypes!=2||s.goods.shopStatus==3||s.goods.shopStatus==4||s.goods.shopStatus==0||s.goods.status!=1?(c(),V(ho,{key:0,status:s.goods.status,stock:s.goods.stock,shopStatus:s.goods.shopStatus,class:"!rounded-[8px]"},null,8,["status","stock","shopStatus"])):g("",!0),k(R,{src:l(C),class:"w-[80px] h-[80px] rounded-lg overflow-hidden",alt:"",fit:"cover",onClick:T[0]||(T[0]=ae(ne=>d.$emit("imageClick"),["stop"]))},null,8,["src"]),s.showGoodsType&&(($=s.goods)!=null&&$.type)?(c(),V(po,{key:1,type:((y=s.goods)==null?void 0:y.type)||null},null,8,["type"])):g("",!0),N(d.$slots,"img-icon")]),n("div",_o,[n("div",Fo,[n("div",Do,[n("div",null,[n("div",Io,[d.$slots["goods-name"]?N(d.$slots,"goods-name",{key:0}):(c(),v("div",Go,i(((z=s.goods)==null?void 0:z.goodsName)||""),1))]),s.showDesc?(c(),v("div",Eo,i((_=s.goods)==null?void 0:_.goodsDesc),1)):g("",!0)])]),n("div",Vo,[s.showSale?(c(),v("div",Bo,i(d.$t("mall.saleNum"))+" "+i(s.goods.salesVolume||0),1)):g("",!0),s.showStock?(c(),v("div",Ro,i(d.$t("goods.stock"))+" "+i(((F=s.goods)==null?void 0:F.stock)||0),1)):g("",!0)])]),n("div",Ao,[N(d.$slots,"bottom-left"),d.$slots["bottom-price"]?N(d.$slots,"bottom-price",{key:0}):(c(),v("div",Oo,[Lo,n("div",qo,i(((A=s.goods)==null?void 0:A.price)||0),1)])),N(d.$slots,"bottom-right")])])])}}}),Mo=s=>(no("data-v-13672f44"),s=s(),ro(),s),No=["src"],Po={class:"text-b3"},zo={class:"px-3 mt-3"},Uo={class:"flex items-center"},Ko=Mo(()=>n("img",{src:Ce,class:"w-4 h-4 mr-1.5"},null,-1)),Jo={class:"text-newOrigin"},Yo={class:"relative flex justify-start items-center text-sm mt-3"},Ho=["onClick"],Wo={key:0,class:"absolute z-50 py-3 left-0 transform-pop px-3.5 top-[26px] no-wrap text-left text-b2 text-sm font-normal"},Zo=["onClick"],Qo=["onClick"],Xo={class:"flex justify-end ml-auto"},es={class:"w-[calc(100%-32px)] max-w-[343px] mx-auto safe-bottom"},os=le({beforeRouteEnter(s,B,C){s.path==="/shopGoods"&&B.path!=="/shopGoods/editGoods"&&C(d=>{d.initEditGoodsStorage()}),C()}});function ss(s,{expose:B}){const{checkLoginAuth:C,checkRegisterAuth:d}=vo(),{t:T}=We(),R=Ze(),$=Qe(),{accountStore:y,clerkStore:z,regionStore:_}=yo(),{getCurrentStoreId:F,getCurrentAccount:A}=wo(),[ne,Z]=se(!1),$e=p(null),w=Xe({shopInfo:null,keyword:""}),xe=te(()=>[{label:T("offline.onSale")+`(${U.value})`,value:1},{label:T("shop.watiShelf"),value:2},{label:T("shop.manuscript"),value:0}]),h=p(Number(R.query.status)||1),Q=e=>{$.push(e)},r=p([]),O=p(!1),D=p(!1),I=p(0),Te=p(10),L=p(0),U=p(0),q=p({}),_e=e=>{h.value=e,$.replace({path:"/shopGoods",query:{status:e}}),K()},Fe=async e=>{q.value=e,e.goodsType&&e.goodsType!=="all"&&(q.value.type=e.goodsType),delete q.value.goodsType,D.value=!1,I.value=0,L.value=0,r.value=[],J()},K=async()=>{D.value=!1,I.value=0,L.value=0,r.value=[],J()},J=async()=>{O.value=!0,I.value+=1,await De(),O.value=!1},De=async(e,o)=>{var m;const t=h.value,u=await be({merchant:((m=await F())==null?void 0:m.merchant)||A(),status:t,page:I.value,size:Te.value,keyword:w.keyword,...q.value,deleteFlag:!1,sortType:4});if(O.value=!1,!u.success){D.value=!0;return}if(t!=h.value)return;if(!u.data||!u.total){D.value=!0,r.value=I.value===1?[]:r.value,t==1&&(U.value=0);return}L.value=u.total,t==1&&(U.value=u.total||0);const S=p([]);S.value=u.data.map(f=>({btnLoading:!1,showMore:!1,...f})),r.value=I.value===1?S.value:r.value.concat(S.value),r.value.length>=L.value&&(D.value=!0)},Ie=async()=>{var o;const e=await be({merchant:((o=await F())==null?void 0:o.merchant)||A(),status:1,page:1,size:1,keyword:w.keyword,...q.value,deleteFlag:!1});e.success&&e.total&&(U.value=e.total)},Ge=async(e,o)=>{e.loading=!0;const t={id:e.id,status:2},u=await ke(t);e.loading=!1,u.success&&r.value.splice(o,1)},Ee=async(e,o)=>{e.loading=!0;const t={id:e.id,status:1},u=await ke(t);e.loading=!1,u.success&&r.value.splice(o,1)},[Ve,X]=se(!1),[re,ee]=se(!1),j=p(null),ue=p(-1),Be=async(e,o)=>{j.value=e,ue.value=o,X(!0)},ie=()=>{X(!1),j.value=null,ue.value=-1},Re=async()=>{var o;if(re.value)return;ee(!0);const{success:e}=await Co({id:(o=j.value)==null?void 0:o.id});if(!e){ee(!1);return}co("删除成功"),Ae(j.value),j.value=null,X(!1),setTimeout(()=>{ee(!1)},1e3)},Ae=e=>{if(!r.value||!e)return;const o=e.id,t=r.value.findIndex(u=>u.goods.id==o);t>-1&&(r.value.splice(t,1),L.value-=1)},Oe=p({}),Le=(e,o)=>{o&&(Oe.value[e]=o,uo(()=>{io(o,()=>{const t=r.value[e];t&&(t.showMore=!1)})}))},qe=e=>{const o=r.value[e];o&&(o.showMore=!o.showMore)},je=async e=>{Q(`/shopGoods/editGoods?id=${e.id}&boutique=1`)},Me=async()=>{w.shopInfo=await F()};let x=null;const Ne=async()=>{const e=localStorage.getItem("shopGoods_scrollTop");+e?x.scrollTo({top:+e,left:0,behavior:"instant"}):localStorage.removeItem("shopGoods_scrollTop")},oe=p(!1),ce=()=>{oe.value||(oe.value=!0,setTimeout(()=>{localStorage.setItem("shopGoods_scrollTop",x.scrollTop+""),oe.value=!1},500))},Y="goods_draft_data",G=te(()=>{var e;return((e=y.store)==null?void 0:e.id)+"_"+y.account}),Pe=()=>{const e=fe();e&&!e.isManualSave&&Z(!0)},de=()=>{try{const e=localStorage.getItem(Y);return e?JSON.parse(e):null}catch(e){return console.error("获取缓存数据失败:",e),null}},fe=()=>{var e;try{const o=de();return!o||!o[G.value]||!((e=o[G.value])!=null&&e.goods)?null:o[G.value]}catch(o){return console.error("恢复表单数据失败:",o),null}},ze=()=>{var o,t;const e=fe();if(e){let u={};(o=e.goods)!=null&&o.id&&(u.id=(t=e.goods)==null?void 0:t.id),$.push({name:"EditGoods",query:u,params:{restoreWithoutInquire:1}})}Z(!1)},pe=()=>{Ue(),Z(!1)},Ue=()=>{try{let e=de();e&&e[G.value]&&e[G.value].goods?(delete e[G.value],Object.keys(e).length===0?localStorage.removeItem(Y):localStorage.setItem(Y,JSON.stringify(e))):localStorage.removeItem(Y)}catch(e){console.error("清空表单数据失败:",e)}},Ke=async()=>{C(!0)&&$.push("/shopGoods/editGoods")},Je=async()=>{var e;C(!0)&&(h.value=(e=R.query)!=null&&e.status?Number(R.query.status):1,await Me(),J(),Ie(),x=document.querySelector(".shopGoodsPage"),x&&x.addEventListener("scroll",ce))},Ye=async()=>{Je()};return eo(async()=>{Ye()}),oo(async()=>{var e,o,t,u;z.isClerk&&K();try{Ne();const S=sessionStorage.getItem("shop_refresh_id");if(S==="add")K();else if(S){const m=await $o(S),f=r.value.findIndex(H=>{var a;return((a=H.goods)==null?void 0:a.id)==S});h.value===1?f>-1&&(r.value[f].goods=(e=m.data)==null?void 0:e.goods):h.value===2?f>-1&&r.value.splice(f,1):h.value===0&&f>-1&&(((o=m.data)==null?void 0:o.goods.status)===((t=r.value[f])==null?void 0:t.goods.status)?r.value[f].goods=(u=m.data)==null?void 0:u.goods:r.value.splice(f,1))}}finally{sessionStorage.removeItem("shop_refresh_id")}}),so(()=>{x&&x.removeEventListener("scroll",ce)}),B({initEditGoodsStorage:Pe}),(e,o)=>{const t=W("VanButton"),u=W("VanList"),S=W("router-view");return c(),v("div",null,[k(fo,{title:e.$t("shop.sellingGoods"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(m,f)=>{f.shopGoodsRef=m,$e.value=m}},{right:b(()=>[n("img",{src:l(So)(`mall/${l(_).country}-flag.svg`),class:"w-5 h-auto mr-1"},null,8,No),n("span",Po,i(e.$t(`country.${l(_).country}`))+i(l(_).country),1)]),default:b(()=>{var m,f,H;return[k(go,{options:l(xe),"label-key":"label","value-key":"value",modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=a=>h.value=a),onChange:_e},null,8,["options","modelValue"]),n("div",zo,[k(mo,{modelValue:l(w).keyword,"onUpdate:modelValue":o[1]||(o[1]=a=>l(w).keyword=a),deliveryType:l(ko).online,shopType:(f=(m=l(w))==null?void 0:m.shopInfo)==null?void 0:f.type,shopInfo:(H=l(w))==null?void 0:H.shopInfo,onOnSubmit:K,onOnFilter:Fe},null,8,["modelValue","deliveryType","shopType","shopInfo"])]),n("div",{class:lo(["m-3 overflow-y-auto shopGoodsPage",{"safe-body":!l(y).isOnlyView}])},[k(u,{loading:O.value,"onUpdate:loading":o[2]||(o[2]=a=>O.value=a),finished:D.value,"immediate-check":!1,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:J},{default:b(()=>[(c(!0),v(to,null,ao(r.value,(a,M)=>{var he,me,ge,ve,ye,we;return c(),v("div",{class:"bg-white rounded-xl p-3 mb-3",key:a.goods.id},[k(jo,{showSale:"",showGoodsType:"",showStock:"",goods:a.goods},{"bottom-price":b(()=>[n("div",Uo,[Ko,n("div",Jo,i(a.goods.price),1)])]),_:2},1032,["goods"]),n("section",Yo,[l(y).isOnlyView?g("",!0):(c(),v("div",{key:0,class:"relative",ref:E=>Le(M,E)},[n("span",{class:"text-b2",onClick:E=>qe(M)},i(e.$t("shop.more")),9,Ho),a.showMore?(c(),v("div",Wo,[n("div",{class:"no-wrap",onClick:ae(()=>Q(`/editFlashSaleGoods?id=${a.goods.id}`),["stop"])},i(e.$t("shop.transform")),9,Zo),((me=(he=l(w))==null?void 0:he.shopInfo)==null?void 0:me.type)!==l(bo).SD&&a.goods.type!==((ve=(ge=l(w))==null?void 0:ge.shopInfo)==null?void 0:ve.type)?(c(),v("div",{key:0,class:"pt-3 no-wrap",onClick:ae(()=>je(a.goods),["stop"])},i(e.$t("goods.One-click transfer",{type:e.$t(`common.shop_type_${(we=(ye=l(w))==null?void 0:ye.shopInfo)==null?void 0:we.type}`)})),9,Qo)):g("",!0)])):g("",!0)],512)),n("div",Xo,[h.value===1&&!l(y).isOnlyView?(c(),V(t,{key:0,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:a.goods.loading,onClick:E=>Ge(a.goods,M)},{default:b(()=>[P(i(e.$t("shop.down")),1)]),_:2},1032,["loading","onClick"])):g("",!0),h.value===2&&!l(y).isOnlyView?(c(),V(t,{key:1,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:a.goods.loading,onClick:E=>Ee(a.goods,M)},{default:b(()=>[P(i(e.$t("shop.up")),1)]),_:2},1032,["loading","onClick"])):g("",!0),(h.value===2||h.value===0)&&!l(y).isOnlyView?(c(),V(t,{key:2,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:a.goods.loading,onClick:E=>Be(a.goods,M)},{default:b(()=>[P(i(e.$t("shop.delete")),1)]),_:2},1032,["loading","onClick"])):g("",!0),k(t,{color:"#FED73A",round:"",loading:a.goods.loading,class:"!text-b1 font-semibold h-[32px] rounded-md px-3",onClick:E=>Q(`/shopGoods/editGoods?id=${a.goods.id.toString()}`)},{default:b(()=>[P(i(e.$t("shop.modify")),1)]),_:2},1032,["loading","onClick"])])])])}),128))]),_:1},8,["loading","finished","finished-text","loading-text"])],2),n("div",es,[l(y).isOnlyView?g("",!0):(c(),V(t,{key:0,onClick:Ke,class:"bg-btnOrBg w-full h-[46px] flex-center text-b1 text-base font-semibold z-50 rounded-3xl"},{default:b(()=>[P(i(e.$t("shop.releaseGoods")),1)]),_:1}))]),k(Se,{show:l(Ve),title:"重要操作",content:"确认删除？删除后将无法恢复。",showConfirm:!0,showReject:!0,confirmText:"确认",rejectText:"取消",loading:l(re),onClose:ie,onReject:ie,onConfirm:Re,confirmStyle:{background:"#07C160",color:"white"},rejectStyle:{background:"#F44",color:"white",borderColor:"#F44",borderWidth:"0 !important"}},null,8,["show","loading"])]}),_:1},8,["title"]),k(Se,{show:l(ne),noHeader:"",content:"你有未编辑完成的商品，是否继续？",showConfirm:!0,showReject:!0,confirmText:"编辑",rejectText:"放弃",onClose:pe,onConfirm:ze,onReject:pe},null,8,["show"]),k(S,{class:"child-view bg-gray1"})])}}const ts=le({...os,setup:ss}),ks=He(ts,[["__scopeId","data-v-13672f44"]]);export{ks as default};
