import{am as d,an as m,ao as y}from"./index-hbwLMIYO.js";const E=()=>{const t=d(),r=()=>{sessionStorage.removeItem("location_permission_denied_shown"),t.clearLocationErrorFlag()},g=e=>{e==="reset"&&r(),navigator.geolocation?(console.log("原生能力开始获取位置"),navigator.geolocation.getCurrentPosition(o=>c(o),o=>L(o),{timeout:1e4,maximumAge:3e5})):(console.log("原生能力不支持定位"),t.setLocationCity(null),t.setLocationError("浏览器不支持定位功能"),t.setDefaultLocation())},c=async e=>{var i;console.log("原生能力获取位置成功",e);const{latitude:o,longitude:n}=e.coords;t.setLngLat(n,o),r();try{const l={areaLongitude:n,areaLatitude:o},u=await Promise.all([m(),y(l)]),s=u[0].data,a=u[1].data;console.log("saveCity",s),console.log("通过经纬度获取的位置",a),a?(t.locationCity&&((i=t.locationCity)==null?void 0:i.areaId)!==a.areaId&&t.clearLocationErrorFlag(),t.setLocationCity(a),s&&(s==null?void 0:s.areaId)!==a.areaId?t.setCityChangeTips(s,a):t.locationMatchMode!=="manual"&&(t.setCurrentCity(a,"auto"),t.setLngLat(n,o))):(t.setLocationCity(null),t.setNavigatorState(!0),t.setLocationError("无法匹配到对应城市"),await t.setDefaultLocation())}catch{t.setLocationCity(null),t.setNavigatorState(!0),t.setLocationError("网络请求失败"),await t.setDefaultLocation()}},L=e=>{console.log("原生能力获取位置失败",e);let o="获取位置失败";switch(e.code){case e.PERMISSION_DENIED:o="用户拒绝了定位权限";break;case e.POSITION_UNAVAILABLE:o="位置信息不可用";break;case e.TIMEOUT:o="定位请求超时";break;default:o="定位失败，请检查定位权限"}t.setLocationError(o),t.setLocationCity(null),t.setNavigatorState(!0),t.setDefaultLocation()};return{getUserLocation:g,showPosition:c,distanceFormat:(e,o=2,n=999)=>{const i=Number((e?e/1e3:0).toFixed(o));return i>999?">999km":`距离${i}km`},clearPermissionDeniedFlag:r}};export{E as u};
