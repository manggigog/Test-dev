import{S as le,G as ce,a as de,_ as re,b as ue}from"./ShareGoodPopup-DVmjG7qs.js";import{y as B,bf as me,x as P,z as pe,F as v,G as n,H as o,Q as d,P as i,I as ge,J as ve,K as h,X as fe,br as ye,_ as A,a2 as m,Y as M,Z as Y,be as z,r,w as he,a1 as Te,l as _e,bj as we,by as $e,D as be,E as Ie,O as b,R as xe,N as H,a0 as ke,T as L}from"./vendor-BUT0HZ5j.js";import{e as Se,G as Ge,a as Re,_ as Ce}from"./GoodsInfo-ibI3erkV.js";import{_ as Fe}from"./GoodsEvaluateItem-CTiv7l76.js";import{k as V}from"./order-5h45IqlB.js";import{F as S}from"./enums-DlE-aiss.js";import{d as De,f as Le,r as Be,_ as Pe,V as Ae}from"./index-BvL8wS8a.js";import{P as Oe}from"./flashSale-DDyqLyYN.js";import{D as Ee}from"./goods-BVwS8oFG.js";import{R as je}from"./RemovedShelves-B9PBZPPN.js";import{q as qe}from"./goods-Dg5QKtLi.js";import{q as Ne}from"./cart-9He7F13A.js";import"./shop-arrow-right-Br6r0Qcd.js";import"./BoutiqueLabelInLogo-8rzV321c.js";import"./shop-CeqcS6K2.js";import"./RatioBox-CG9RFZMG.js";import"./kefu-BZ7ykajd.js";import"./convertToImage-Bx9HwqU4.js";import"./browser-DFlSdkZC.js";import"./upload-CFisGMJ4.js";import"./active_empty-CBz3QrKQ.js";import"./HelpPop-2HtEDPpf.js";import"./MCOIN-BcbOHmhy.js";import"./logo-CT48NEDW.js";import"./BoutiqueLable-r45nG6V6.js";import"./GoodsPrice-Ai76_1qQ.js";import"./BackIcon-biFt6cm7.js";const ze={class:"relative mb-2 w-full flex justify-center items-center"},He={class:"text-sm font-semibold text-center"},Ve={class:"absolute right-0 top-0 text-[12px] text-[#999999] leading-[20px]"},Me=B({props:{goodsId:null},emits:["handleTo"],setup(t,{emit:p}){const y=t,l=me({commentList:[],total:0}),w=async()=>{const u=await V({goodsId:y.goodsId,page:1,size:1,commentDefaultGoodFlag:0});u.success&&(l.commentList=u.data);const c=await V({goodsId:y.goodsId,page:1,size:1});c.success&&(l.total=c.total)},f=P(()=>{if(l.commentList&&l.commentList.length>0){const u=[];for(let c=0;c<l.commentList.length;c++)l.commentList[c].commentImages&&l.commentList[c].commentImages.length>0&&u.push(...l.commentList[c].commentImages.split(","));return u}return[]}),T=u=>{const c=f.value.findIndex(e=>e===u);ye({images:f.value,closeable:!0,showIndex:!0,startPosition:c})};return pe(()=>y.goodsId,()=>{w()},{immediate:!0}),(u,c)=>(n(),v("div",{class:"p-2.5 mb-2.5 bg-white rounded-xl text-base",onClick:c[0]||(c[0]=e=>p("handleTo",`/evaluate-good?goodsId=${t.goodsId}`))},[o("div",ze,[o("div",He,d(u.$t("evaluate.Buyer Reviews"))+"（"+d(i(l).total)+"） ",1),o("div",Ve,d(u.$t("common.all"))+" > ",1)]),(n(!0),v(ge,null,ve(i(l).commentList,(e,g)=>(n(),h(Fe,{onImgPre:T,key:e.id,data:e,class:"border-none",style:fe(g===i(l).commentList.length-1?"margin-bottom:0":"")},null,8,["data","style"]))),128))]))}}),Ye="/Test-dev/static/images/wyhlg-lNCG0Riy.svg",Ue="/Test-dev/static/images/g-d-flash-bg-D1sma3Dd.svg",Ze="/Test-dev/static/images/g-d-flash-f-C4Zpe-zO.svg",Je={class:"tag text-xs flex justify-start items-center text-[#F25C11]"},Ke={key:0},Qe={key:1},Xe={key:2},We={key:3},et={props:{shippingTemplate:{type:Object,default:()=>{}}},setup(t){return(p,y)=>(n(),v("div",Je,[o("span",null,[t.shippingTemplate.type===i(S).FREE&&t.shippingTemplate.threshold?(n(),v("span",Ke,d(p.$t("shop.shippingTemplate.actualPayment"))+d(i(De)(t.shippingTemplate.threshold))+"MC"+d(p.$t("shop.shippingTemplate.freeShipping")),1)):m("",!0),t.shippingTemplate.type===i(S).FREE&&t.shippingTemplate.threshold===0?(n(),v("span",Qe,d(p.$t("shop.shippingTemplate.freeShipping")),1)):m("",!0),t.shippingTemplate.type===i(S).NO_SHIPPING?(n(),v("span",Xe,d(p.$t("shop.shippingTemplate.noShipping")),1)):m("",!0),t.shippingTemplate.type===i(S).CASH_ON_DELIVERY?(n(),v("span",We,d(p.$t("shop.shippingTemplate.cashOnDelivery")),1)):m("",!0)])]))}},tt=A(et,[["__scopeId","data-v-c8264250"]]),G=t=>(M("data-v-807a4676"),t=t(),Y(),t),st={class:"act__wrap flex items-center justify-between p-3 pr-2.5"},ot={class:"left-box z-10"},at={class:"act-price font-sans text-b6 text-[26px] font-normal"},it={class:"leading-[26px] font-BebasNeue"},nt=G(()=>o("span",{class:"text-[12px] ml-1"},"MC",-1)),lt={class:"mt-1 flex flex-row justify-start items-center gap-1"},ct={key:1,class:"tag"},dt={key:2},rt={class:"right-box z-10"},ut=G(()=>o("div",{class:"happy-buying"},[o("img",{src:Ye,alt:"五一欢乐购"})],-1)),mt={class:"text-right mt-[2px] text-[#B27936] text-xs font-normal"},pt=G(()=>o("img",{class:"flash-item-2",src:Ue},null,-1)),gt=G(()=>o("img",{class:"flash-item-1",src:Ze,alt:""},null,-1)),vt={props:{goods:{type:Object,default:()=>{}},activity:{type:Object,default:()=>{}},activityGoods:{type:Object,default:()=>{}},activityRule:{type:Object,default:()=>{}},shippingTemplate:{type:Object,default:()=>{}}},setup(t){const p=t,y=P(()=>{var T;if(!((T=p.activity)!=null&&T.endTime))return 0;const l=new Date(p.activity.endTime).getTime(),w=new Date().getTime(),f=(l-w)/(1e3*60*60*24);return f<=0?0:f<1?1:Math.ceil(f)});return(l,w)=>(n(),v("div",st,[o("div",ot,[o("div",at,[o("span",it,d(t.activityGoods.activityPrice),1),nt]),o("div",lt,[t.shippingTemplate.id?(n(),h(tt,{key:0,shippingTemplate:t.shippingTemplate},null,8,["shippingTemplate"])):m("",!0),t.activityRule&&t.activityRule.fullAmount?(n(),v("div",ct,d(l.$t("active.man")+t.activityRule.fullAmount||0)+"-"+d(t.activityRule.reduceAmouint||t.activityRule.reduceAmount||0),1)):m("",!0),t.goods.deliveryType===i(Ee).online?(n(),v("div",dt,[t.goods.payType!==i(Oe).STORE_CARD?(n(),h(Se,{key:0,class:"points-tag",showType:"balance",goods:t.goods,activityGoods:t.activityGoods},null,8,["goods","activityGoods"])):m("",!0)])):m("",!0)])]),o("div",rt,[ut,o("div",mt,[o("span",null,d(l.$t("active.last")),1),o("span",null,d(i(y)+l.$t("common.day")),1)])]),pt,gt]))}},ft=A(vt,[["__scopeId","data-v-807a4676"]]),U=t=>(M("data-v-6ffbe22d"),t=t(),Y(),t),yt={class:"relative w-full h-full bg-white"},ht={key:0},Tt=U(()=>o("img",{class:"w-[1.375rem] h-[1.375rem]",src:re},null,-1)),_t=[Tt],wt=U(()=>o("img",{class:"w-[1.375rem] h-[1.375rem]",src:ue},null,-1)),$t=[wt],bt={class:"safe-bottom-page pt-4 px-2.5 bg-[#F6F6F5]"},It={class:"text-center text-black/80"},xt={class:"p-3 text-base"},kt=B({name:"GoodsDetail"});function St(t){const{mcoinRate:p}=Le(),[y,l]=z(!1),w=r(!1),{loadingToggle:f}=Be(),{t:T}=he(),u=Te(),c=_e(),e=r(null),g=r(null),R=r(null),C=r(null),O=r(null),Z=r([]),F=r({}),J=r(),E=r(null),K=r(u.query.id),Q=async()=>{const a=K.value;if(a==null||a==="")return;const s=await qe(a);J.value=s.data.categoryName,e.value=s.data.goods,w.value=s.data.isFollow,g.value=s.data.stores,Z.value=s.data.goodsList,E.value=s.data.fmStoredCard,F.value=s.data.fmShippingTemplate||{},R.value=s.data.fmGeneralActivity||null,C.value=s.data.fmGeneralActivityGoods||null,O.value=s.data.fmGeneralActivityRule||null},j=r(null),X=async()=>{j.value=await p()},W=P(()=>1/j.value),$=r(null),ee=a=>{const s=a===void 0?`/submitOrder?id=${e.value.id}`:`/submitOrder?id=${e.value.id}&${a}`;c.push(s)},[te,q]=z(!1),se=async()=>{if(e.value.stock===0&&e.value.goodsTypes!==2){L(T("order.Insufficient stock"));return}const a={needlogin:"true",...u.query};c.replace({path:u.path,query:a}),f(!0);const s=await Ne(e.value.id);f(!1),s.success&&L(T("cart.addTips"))},I=a=>{c.push(a)},oe=()=>{L({message:T("common.Saved successfully"),icon:Ae("toast-success.svg"),duration:3e3})},ae=()=>{try{window.history.state.back?c.back():window.history.length>2?window.history.back():c.replace({path:"/mall"})}catch{c.push("/")}},N=r(0);let x=r(!0);const D=$e(()=>{const a=document.getElementById("fm-page");N.value=a.scrollY||a.scrollTop,N.value<100?(x.value=!1,$.value&&$.value.resumeSwiper()):(x.value=!0,$.value&&$.value.pauseSwiper())},100),ie=()=>{document.getElementById("fm-page").addEventListener("scroll",D),D()};return we(()=>{const a=document.getElementById("fm-page");a&&a.removeEventListener("scroll",D)}),be(async()=>{ie(),f(!0),await X(),await Q(),f(!1)}),(a,s)=>{const ne=Ie("VanButton");return n(),v("div",yt,[e.value&&e.value.status===1&&g.value.status!==3&&g.value.status!==4&&g.value.status!==0?(n(),v("div",ht,[o("header",{class:xe(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[44px] px-2.5 fixed",{"bg-white":i(x)," bg-black/0":!i(x)}])},[o("div",{class:"flex flex-wrap items-center",onClick:ae},_t),o("div",{onClick:s[0]||(s[0]=_=>i(l)(!0))},$t)],2),b(Ge,{ref:(_,k)=>{k.goodsImgRef=_,$.value=_},imgs:(e.value.icons||"").split(","),stock:e.value.stock,goodsTypes:e.value.goodsTypes},null,8,["imgs","stock","goodsTypes"]),R.value&&C.value.activityStock>0?(n(),h(ft,{key:0,goods:e.value,activityRule:O.value,activity:R.value,activityGoods:C.value,shippingTemplate:F.value,class:"mt-[-6px] z-10"},null,8,["goods","activityRule","activity","activityGoods","shippingTemplate"])):m("",!0),b(Re,{tokenRate:i(W),stores:g.value,goods:e.value,card:E.value,shippingTemplate:F.value,class:"relative z-10"},null,8,["tokenRate","stores","goods","card","shippingTemplate"]),o("div",bt,[b(Me,{onHandleTo:I,goodsId:e.value.id},null,8,["goodsId"]),g.value.id?(n(),h(le,{key:0,store:g.value,onHandleTo:I},null,8,["store"])):m("",!0),e.value.goodsDesc||e.value.goodsPic?(n(),h(Ce,{key:1,text:e.value.goodsDesc,imgs:(e.value.goodsPic||"").split(",")},null,8,["text","imgs"])):m("",!0)]),e.value.id?(n(),h(ce,{key:1,goods:e.value,goodsId:e.value.id,payType:e.value.payType||1,boutiqueFlag:e.value.boutiqueFlag||!1,isFollow:w.value,deliveryType:e.value.deliveryType,storeInfo:g.value,stock:e.value.stock,goodsTypes:e.value.goodsTypes,onHandleBuy:ee,onHandeToShop:s[1]||(s[1]=_=>I(`/category?deliveryType=1&shopId=${g.value.id}`)),onHandleConnect:s[2]||(s[2]=_=>{var k;return I(`/shopInfo?address=${(k=g.value)==null?void 0:k.merchant}`)}),onHandleAddCart:se},null,8,["goods","goodsId","payType","boutiqueFlag","isFollow","deliveryType","storeInfo","stock","goodsTypes"])):m("",!0)])):e.value?(n(),h(je,{key:1,type:"good"})):m("",!0),i(y)?(n(),h(de,{key:2,show:i(y),onOnSuceess:oe,onClose:s[3]||(s[3]=_=>i(l)(!1)),goods:e.value},null,8,["show","goods"])):m("",!0),b(Pe,{show:i(te),name:a.$t("common.tip"),onClose:s[5]||(s[5]=_=>i(q)(!1))},{default:H(()=>[o("div",It,[o("div",xt,d(a.$t("goods.addcartip")),1),b(ne,{class:"btn-orange text-white min-w-[120px] h-[40px]",onClick:s[4]||(s[4]=_=>i(q)(!1))},{default:H(()=>[ke(d(a.$t("common.I_see")),1)]),_:1})])]),_:1},8,["show","name"])])}}const Gt=B({...kt,setup:St}),ss=A(Gt,[["__scopeId","data-v-6ffbe22d"]]);export{ss as default};
