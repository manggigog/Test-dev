import{_ as K,y as W,x as B,B as S,r as H,bc as Y,z as k,D as F,E as P,F as g,G as v,O as h,N as c,K as N,a2 as y,P as a,H as t,Q as o,a4 as Q,a0 as x,Y as J,Z,I as X,a7 as ee,bh as U}from"./vendor-CjApaIpB.js";import{_ as te}from"./point-arrow-BVnEJLj4.js";import{_ as j}from"./USDT-BFPkoPAz.js";import{e as se,d as u,_ as oe}from"./index-CduCwCyL.js";import{P as I}from"./flashSale-DDyqLyYN.js";import{u as ne}from"./usePointRelase-D8q4LHIG.js";import{P as b}from"./order-B5BGKYED.js";import{_ as E}from"./MCOIN-BcbOHmhy.js";import{_ as ie}from"./FMCP-CFalj3L2.js";const ae="/Test-dev/static/images/pay_points-DuQgheHY.png",le="/Test-dev/static/images/pay_wallet-CtEhTDcc.png",ce="/Test-dev/static/images/pay_piggy-1jarwiJl.png",$=s=>(J("data-v-3da12dec"),s=s(),Z(),s),re={class:"pay-switch rounded-xl overflow-hidden"},ue=$(()=>t("img",{src:ae,class:"w-6 h-6 mx-3"},null,-1)),de={class:"custom-title flex items-center justify-start gap-2"},me=["onClick"],he=$(()=>t("img",{src:te,class:"w-4 h-4 mx-3"},null,-1)),fe={class:"text-xs text-b3"},pe=$(()=>t("img",{src:le,class:"w-6 h-6 mx-3"},null,-1)),ve={class:"custom-title"},ge={class:"text-xs text-b3"},ye=$(()=>t("img",{src:ce,class:"w-6 h-6 mx-3"},null,-1)),we={class:"custom-title"},_e={class:"text-xs text-b3"},be=$(()=>t("img",{src:j,class:"w-6 h-6 mx-3"},null,-1)),Pe={class:"custom-title"},xe={class:"text-xs text-b3"},$e={class:"text-sm text-b2 my-4 leading-5"},Ae={class:"flex justify-center gap-x-2"},Te=W({props:{checked:{default:"3"},clickable:{type:Boolean,default:!0},payType:{default:1},paySymbol:{default:"MCOIN"},walletBalance:null,pointBalance:null,piggyBalance:null,usdtBalance:null,boutique:{type:Boolean,default:!1},payAmount:{default:0},usdtRate:null,voucherAmount:null},emits:["onChange","getPointBalance"],setup(s,{expose:r,emit:d}){const i=s,{contributesStore:l}=se(),A=B(()=>+S(i.pointBalance).times(.9)),R=B(()=>[{source:b.WITHDRAW_POINTS,amount:A.value},{source:b.WALLET,amount:i.walletBalance},{source:b.PIGGY_BANK,amount:i.piggyBalance},{source:b.USDT_WALLET,amount:i.usdtBalance*i.usdtRate}]),{handleNaturePointsToast:f}=ne(),p=H(i.checked),[w,T]=Y(!1),G=e=>{p.value=e},D=()=>{let e=[...R.value];!i.boutique&&e[0].source===b.WITHDRAW_POINTS&&e.shift();const n=e.find(m=>m.source===b.WITHDRAW_POINTS?+m.amount>=+i.payAmount-(+i.voucherAmount||0):+m.amount>=+i.payAmount);n&&n.source!==+p.value?d("onChange",n.source):!n&&+e[0].source&&d("onChange",e[0].source)},M=()=>{var e,n,m,_;(e=l.releaseData)!=null&&e.remainTotal&&+((n=l.releaseData)==null?void 0:n.remainTotal)>0&&(!((m=l.releaseData)!=null&&m.nextSubmitDate)||new Date().getTime()>=+((_=l.releaseData)==null?void 0:_.nextSubmitDate))?f(V):T(!0)},V=()=>{let e=0;const n=async()=>{d("getPointBalance"),l.fetchContributes(),await Promise.all([l.fetchUserRelase(),l.getNaturalReleaseTimes()]),e++,e<3&&setTimeout(n,3e3)};n()},O=()=>{T(!1),f(V)};return k(()=>i.checked,e=>{p.value=e},{immediate:!0,deep:!0}),k(()=>i.boutique,e=>{e&&(l.fetchContributes(),l.fetchUserRelase(),l.getNaturalReleaseTimes())},{immediate:!0,deep:!0}),k(()=>i.voucherAmount,e=>{e&&D()},{immediate:!0,deep:!0}),F(()=>{D()}),r({setpayValue:G}),(e,n)=>{const m=P("van-radio"),_=P("van-cell"),q=P("van-cell-group"),z=P("van-radio-group"),L=P("VanButton");return v(),g("div",re,[h(z,{modelValue:p.value,"onUpdate:modelValue":n[4]||(n[4]=C=>p.value=C)},{default:c(()=>[h(q,null,{default:c(()=>[s.payType===a(I).MC&&s.boutique?(v(),N(_,{key:0,center:"",title:e.$t("order.payPoints"),clickable:"",onClick:n[0]||(n[0]=()=>d("onChange",4))},{icon:c(()=>[ue]),title:c(()=>[t("div",de,[t("span",null,o(e.$t("order.payPoints")),1),a(u)(a(l).freeRelease)>0?(v(),g("div",{key:0,class:"text-xs font-normal text-newOrigin flex-center",onClick:Q(M,["stop"])},[x(o(e.$t("integral.keshifang",{num:a(u)(a(l).freeRelease)})),1),he],8,me)):y("",!0)]),t("div",fe,o(e.$t("huabei.nowCanUse"))+" "+o(a(u)(s.pointBalance))+"/"+o(e.$t("integral.order_can_use"))+o(a(u)(a(A))),1)]),"right-icon":c(()=>[h(m,{name:"4","checked-color":"#FEA021"})]),_:1},8,["title"])):y("",!0),h(_,{center:"",title:e.$t("order.payWallet"),clickable:"",onClick:n[1]||(n[1]=()=>d("onChange",1))},{icon:c(()=>[pe]),title:c(()=>[t("div",ve,o(e.$t("order.payWallet")),1),t("div",ge,o(e.$t("huabei.nowCanUse"))+" "+o(a(u)(s.walletBalance)),1)]),"right-icon":c(()=>[h(m,{name:"1","checked-color":"#FEA021"})]),_:1},8,["title"]),h(_,{center:"",title:e.$t("order.payPiggy"),clickable:"",onClick:n[2]||(n[2]=()=>d("onChange",2))},{icon:c(()=>[ye]),title:c(()=>[t("div",we,o(e.$t("order.payPiggy")),1),t("div",_e,o(e.$t("huabei.nowCanUse"))+o(a(u)(s.piggyBalance)),1)]),"right-icon":c(()=>[h(m,{name:"2","checked-color":"#FEA021"})]),_:1},8,["title"]),s.payType!==a(I).STORE_CARD?(v(),N(_,{key:1,center:"",title:e.$t("order.USDT payment"),clickable:"",onClick:n[3]||(n[3]=()=>d("onChange",5))},{icon:c(()=>[be]),title:c(()=>[t("div",Pe,o(e.$t("order.USDT payment")),1),t("div",xe,o(e.$t("huabei.nowCanUse",{symbol:"(USDT)"}))+o(a(u)(s.usdtBalance)),1)]),"right-icon":c(()=>[h(m,{name:"5","checked-color":"#FEA021"})]),_:1},8,["title"])):y("",!0)]),_:1})]),_:1},8,["modelValue"]),h(oe,{show:a(w),name:e.$t("common.tip"),onClose:n[6]||(n[6]=C=>a(T)(!1))},{default:c(()=>[t("div",$e,o(e.$t("integral.relaseTip")),1),t("div",Ae,[h(L,{type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-full border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:n[5]||(n[5]=C=>a(T)(!1))},{default:c(()=>[x(o(e.$t("common.cancel")),1)]),_:1}),h(L,{class:"bg-btnOrBg rounded-full w-full text-b1 font-semibold",onClick:O},{default:c(()=>[x(o(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["show","name"])])}}}),ot=K(Te,[["__scopeId","data-v-3da12dec"]]),Ce={class:"bg-white mt-3 p-3 rounded-xl"},ke={class:"text-base font-semibold"},Be={class:"flex items-start justify-between mt-3"},Se={class:"text-b3"},Ee={class:"text-right"},Re={key:0,class:"flex items-center justify-end gap-1 font-semibold"},De=t("img",{src:E,class:"w-4 h-4"},null,-1),Ve={key:1,class:"flex items-center justify-end gap-1 font-semibold"},Le=t("img",{src:j,class:"w-4 h-4"},null,-1),Ne={key:0,class:"actPrice flex items-baseline justify-between mt-3"},Ue={class:"text-b3 max-w-[100px] line-clamp-1"},Ie={class:"text-right flex items-center justify-end gap-1"},We=t("img",{src:E,class:"w-4 h-4"},null,-1),He=t("div",{class:"w-full h-[1px] bg-[#F6F6F5] my-3"},null,-1),Fe={class:"flex items-center justify-between"},je={class:"text-b3"},Ge={class:"gap-1 text-right flex-center"},Me=t("img",{src:E,class:"w-4 h-4"},null,-1),Oe=x("+ "),qe=t("img",{src:ie,class:"w-4 h-4"},null,-1),ze={key:1,class:"text-xs text-b3 text-right"},nt=W({props:{totalPrice:null,usdtPrice:null,originalUsdtPrice:null,showTotalPrice:null,voucherPrice:null,useVoucherAmount:null,symbol:null,activityReduceAmount:null,fmGeneralActivity:null},setup(s){const r=s,d=B(()=>{if(r.usdtPrice<=0)return"";const i=new S(r.usdtPrice),l=new S(r.showTotalPrice||0).minus(r.totalPrice).minus(r.activityReduceAmount||0).minus(r.useVoucherAmount||0).toNumber();return console.log("props.showTotalPrice",r.showTotalPrice,"props.totalPrice",r.totalPrice,"props.voucherPrice",r.voucherPrice,"props.activityReduceAmount",r.activityReduceAmount,"props.fmGeneralActivity",r.fmGeneralActivity),`(${u(i)} USDT将自动闪兑为${u(l)} Mcoin)`});return(i,l)=>(v(),g("div",Ce,[t("div",ke,o(i.$t("order.totalPriceDetail")),1),t("div",Be,[t("div",Se,o(i.$t("order.goodsPrice")),1),t("div",Ee,[s.totalPrice>0?(v(),g("div",Re,[De,t("span",null,o(a(u)(s.totalPrice)),1)])):y("",!0),s.originalUsdtPrice>0?(v(),g("div",Ve,[Le,t("span",null,o(a(u)(s.originalUsdtPrice)),1)])):y("",!0)])]),s.activityReduceAmount&&s.fmGeneralActivity?(v(),g("div",Ne,[t("div",Ue,o(s.fmGeneralActivity.name),1),t("div",Ie,[We,t("span",null,"-"+o(a(u)(s.activityReduceAmount)),1)])])):y("",!0),He,t("div",Fe,[t("div",je,o(i.$t("common.actual_payment")),1),t("div",Ge,[Me,t("span",null,o(a(u)(s.showTotalPrice-s.voucherPrice-(s.activityReduceAmount||0))),1),s.voucherPrice?(v(),g(X,{key:0},[Oe,qe,x(o(a(u)(s.voucherPrice)),1)],64)):y("",!0)])]),s.usdtPrice>0?(v(),g("div",ze,o(a(d)),1)):y("",!0)]))}});function it(){const s=H(!1);let r=window.innerHeight;const d=ee.debounce(()=>{const f=window.innerHeight;s.value=f<r},100),i=()=>{const f=window.visualViewport;if(!f)return;const p=f.offsetTop;s.value=p>0},l=()=>{r=window.innerHeight,window.visualViewport&&window.visualViewport.addEventListener("resize",i),window.addEventListener("resize",d)},A=()=>{window.visualViewport&&window.visualViewport.removeEventListener("resize",i),window.removeEventListener("resize",d)};if(/MicroMessenger/i.test(navigator.userAgent)){const f=()=>{s.value=!0},p=()=>{s.value=!1};document.querySelectorAll("input, textarea").forEach(w=>{w.addEventListener("focus",f),w.addEventListener("blur",p)}),U(()=>{document.querySelectorAll("input, textarea").forEach(w=>{w.removeEventListener("focus",f),w.removeEventListener("blur",p)})})}return F(()=>{l()}),U(()=>{A()}),{isKeyboardVisible:s}}export{ot as P,nt as _,it as u};
