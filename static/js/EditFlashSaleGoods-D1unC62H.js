import{_ as te,y as oe,E as w,F as g,G as v,H as a,O as i,Q as l,Y as Be,Z as Fe,bd as Le,x as N,B as q,D as ve,K as X,N as d,a2 as E,a0 as P,P as u,w as Me,r as m,bn as B,z as Y,bE as Ge,$ as re,R as Ne,T as qe,l as je,a1 as ze}from"./vendor-CjApaIpB.js";import{E as Oe}from"./EmptyTipsPop-D289L5-e.js";import{_ as fe}from"./MCOIN-BcbOHmhy.js";import{_ as Ze}from"./OrderPopBorder-9e_uuhMd.js";import{_ as He}from"./ApproveButton-MHGqDW5h.js";import{l as he}from"./luckyShopContract-CxfmjUqE.js";import{q as ee,u as Je,v as Ke,a2 as ce,aJ as Qe,aB as me,V as G,l as W}from"./index-B3VH42pz.js";import{B as Ye}from"./BackIcon-D2Vm_lyR.js";import{G as We,P as T}from"./flashSale-DDyqLyYN.js";import{u as pe}from"./upload-BLqJoIae.js";import{q as Xe}from"./goods-d53Efm28.js";import{q as et}from"./category-C-nfHCqi.js";import{a as tt}from"./shop-CeqcS6K2.js";const ge=c=>(Be("data-v-3a25bc12"),c=c(),Fe(),c),ot={class:"bg-white p-2.5 rounded-lg font-normal"},at={class:"flex-center-bw"},lt={class:"w-[80px] h-[80px] rounded-xl overflow-hidden mr-2"},st={class:"flex-1 flex justify-between flex-col min-h-[80px] text-left"},nt={class:"font-semibold line-clamp-1"},it={class:"opacity-60 line-clamp-2"},dt={class:"flex items-center"},ut=ge(()=>a("img",{src:fe,class:"w-3.5 h-3.5 mr-1"},null,-1)),rt={class:"font-medium"},ct={class:"mt-5 flex-center-bw"},mt=ge(()=>a("img",{src:fe,class:"w-3.5 h-3.5 mr-1 ml-auto"},null,-1)),pt={class:"font-medium"},vt={class:"mt-5 flex-center-bw"},ft={class:"font-medium"},ht={class:"mt-5 flex-center-bw"},gt={class:"font-medium"},yt={class:"mt-5 text-left"},_t={class:"font-medium font-Sans"},bt=oe({props:{goods:null},setup(c){return(_,r)=>{const k=w("VanImage");return v(),g("div",ot,[a("div",at,[a("div",lt,[i(k,{src:(c.goods.mainImageUrls||"").split(",")[0],fit:"cover",class:"object-cover w-full h-full overflow-hidden"},null,8,["src"])]),a("div",st,[a("section",null,[a("div",nt,l(c.goods.title),1),a("div",it,l(c.goods.describe),1)]),a("section",dt,[a("span",null,l(_.$t("flashSale.unitPrice"))+"ï¼š",1),ut,a("span",rt,l(c.goods.price)+"Mcoin",1)])])]),a("div",ct,[a("span",null,l(_.$t("flashSale.totalPrice")),1),mt,a("span",pt,l(c.goods.totalPrice)+"Mcoin",1)]),a("div",vt,[a("span",null,l(_.$t("flashSale.numberPurchases")),1),a("span",ft,l(c.goods.purchaseLimit||1),1)]),a("div",ht,[a("span",null,l(_.$t("common.ratio")),1),a("span",gt,l(c.goods.discountRate||20)+"%",1)]),a("div",yt,[a("div",null,l(_.$t("flashSale.activityTime")),1),a("div",_t,l(c.goods.startTime)+" - "+l(c.goods.endTime),1)])])}}}),$t=te(bt,[["__scopeId","data-v-3a25bc12"]]),wt={class:"pt-2.5 text-left font-normal text-base text-default"},Tt={class:"text-[#FB1A18] text-2xl"},xt=P(" Mc "),St={class:"text-left text-[#FB1A18] text-xs"},Vt=oe({props:{show:{type:Boolean,default:!1},goods:null,loading:{type:Boolean}},emits:["close","onConfirm"],setup(c,{emit:_}){const r=c,{payToken:k,rates:j}=he(),x=Le({rate:.1,payTokenAddress:null}),F=N(()=>+q(r.goods.totalPrice).times(x.rate));async function f(){x.rate=await j(0)}async function z(){x.payTokenAddress=await k()}function L(){_("onConfirm")}function p(){f(),z()}return ve(()=>{p()}),(b,A)=>{const R=w("van-icon");return v(),X(Ze,{show:c.show,title:b.$t("flashSale.confirmGoodsInfo"),onClose:A[0]||(A[0]=M=>b.$emit("close"))},{default:d(()=>[i($t,{goods:c.goods},null,8,["goods"]),a("div",wt,[P(l(b.$t("flashSale.estimatePayment"))+" ",1),a("span",Tt,l(u(F)||0),1),xt]),a("div",St,[i(R,{name:"warning",color:"#FB1A18"}),P(" "+l(b.$t("flashSale.addGoodsTip")),1)]),u(x).payTokenAddress?(v(),X(He,{key:0,contract:u(ee).luckyShop,token:u(x).payTokenAddress,approveAmount:u(F),loading:c.loading,fallBack:L,class:"text-sm my-[30px] h-[40px] min-w-[150px] rounded-3xl text-white btn-pink"},{default:d(()=>[P(l(b.$t("common.confrim")),1)]),_:1},8,["contract","token","approveAmount","loading"])):E("",!0)]),_:1},8,["show","title"])}}}),It=te(Vt,[["__scopeId","data-v-4c039170"]]),Et={class:"w-full h-ful p-2.5 bg"},At={class:"flex items-center"},Ct={class:"text-base font-medium"},Pt={class:"bg-white rounded-xl overflow-hidden mt-2.5 px-2.5 py-5 title"},kt={class:"font-normal text-default"},Rt={class:"border-[#EAEAEA] border-b border-solid pb-3"},Ut={class:"w-[60px] h-[60px] bg-[#F4F6F8] rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Dt=["src"],Bt={class:"text-xs font-light text-center text-default opacity-30"},Ft={class:"border-[#EAEAEA] border-b border-solid"},Lt={class:"font-normal text-default"},Mt={class:"pt-5 font-normal text-default"},Gt={class:"w-[60px] h-[60px] bg-[#F4F6F8] rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Nt=["src"],qt={class:"text-xs font-light text-center text-default opacity-30"},jt={class:"bg-white rounded-xl overflow-hidden mt-2.5 px-2.5 title"},zt={key:0,class:"border-[#EAEAEA] border-b border-solid"},Ot={class:"font-normal text-default"},Zt={key:1,class:"border-[#EAEAEA] border-b border-solid"},Ht={class:"font-normal text-default"},Jt={key:2,class:"border-[#EAEAEA] border-b border-solid"},Kt={class:"font-normal text-default"},Qt={class:"border-[#EAEAEA] border-b border-solid"},Yt={class:"font-normal text-default"},Wt={class:"border-[#EAEAEA] border-b border-solid"},Xt={class:"font-normal text-default"},eo={class:"block"},to={key:0},oo={key:1},ao={class:"border-[#EAEAEA] border-b border-solid"},lo={class:"font-normal text-default"},so={class:"font-normal text-default"},no=P("%"),io={class:"bg-white rounded-xl overflow-hidden mt-2.5 py-2.5"},uo={class:"font-normal text-default"},ro=["src"],co={key:0,class:"text-xs font-normal no-wrap"},mo={key:1,class:"no-wrap text-[#bfbcb6] font-normal"},po={class:"font-normal text-default"},vo=["src"],fo={key:0,class:"text-xs font-normal no-wrap"},ho={key:1,class:"no-wrap text-[#bfbcb6] font-normal"},go={class:"bg-white rounded-xl overflow-hidden mt-2.5 py-2.5"},yo={class:"font-normal text-default"},_o={class:"flex items-center mt-3 justify-evenly"},bo=oe({setup(c){const{getCurrentStoreId:_}=Je(),{t:r}=Me(),k=ze(),j=je(),{upShelf:x}=he(),F=m(0),f=m(1),z=N(()=>[{value:3,text:r("common.pay methods one")},{value:2,text:r("common.pay methods two")},{value:1,text:r("common.pay methods three")}]),[L,p]=B(!1),[b,A]=B(!1),[R,M]=B(!1),[ye,ae]=B(!1),[_e,O]=B(!1),t=m({id:null,title:null,mainImageUrls:null,categoryId:null,describe:null,detailImageUrls:null,price:null,totalPrice:null,purchaseLimit:null,startTime:null,endTime:null,status:null,shippingMethod:null,shopGoodsFlag:0,goodsId:null,discountRate:20}),S=m(),U=m(),Z=m(),be=m(new Date(new Date().getTime()+5*60*1e3)),le=m(new Date(new Date().getTime()+60*60*1e3)),se=m(new Date(new Date().getTime()+10*24*60*60*1e3)),y=m([]),V=m([]),C=m(1),$e=N(()=>[{value:1,text:r("common.send")},{value:2,text:r("common.offline")}]),we=N(()=>+q(t.value.cardPrice).times(S.value)||0),Te=e=>{(e>50||e<20)&&(h.value=r("flashSale.pleaseInputPoint"),p(!0)),t.value.discountRate=+e>50?50:+e<20?20:e},I=m(0);Y(C,()=>{let e=J.value.filter(o=>o.type===C.value);I.value=e.length&&e[0].id}),Y(L,e=>{e&&setTimeout(()=>{p(!1)},3e3)}),Y(f,e=>{e!==T.MC?t.value.discountRate=20:t.value.cardPrice=null,e===T.STORE_CARD&&(t.value.price=null)});const ne=()=>{A(!1),M(!1),(!t.value.startTime||!t.value.endTime)&&(t.value.endTime=null,t.value.startTime=null)},xe=e=>{U.value=W(e),t.value.startTime=U.value,le.value=e;const o=new Date(e);se.value=new Date(o.getTime()+10*24*60*60*1e3),new Date(U.value)>new Date(t.value.endTime)&&(t.value.endTime=null),A(!1)},Se=e=>{Z.value=W(e),t.value.endTime=W(e),M(!1)},Ve=async e=>{const o=await ce(e,"goodsImg"),n=await pe(o);if(!n.success)return y.value.length-=1;y.value[y.value.length-1]={url:ee.imgUrl+n.data}},Ie=async e=>{const o=await ce(e,"goodsDesc"),n=await pe(o);if(!n.success)return V.value.length-=1;V.value[V.value.length-1]={url:ee.imgUrl+n.data}},ie=m(!1),D=m(!1),H=()=>{t.value.price<0&&(qe(r("goods.price tips")),t.value.price=Math.abs(t.value.price))},h=m(null),Ee=async()=>{if(!t.value.title)return h.value=`${r("shop.pleaseInput")}${r("goods.goodsName")}`,p(!0);if(!y.value.length||!y.value[0].url)return h.value=r("goods.emptyImg"),p(!0);if(!I.value)return h.value=`${r("shop.pleaseSelect")}${r("common.category")}`,p(!0);if(!t.value.title||!t.value.price)return h.value=r("goods.notEmpty"),p(!0);if(!S.value)return h.value=`${r("shop.pleaseInput")}${r("flashSale.totalUnit")}`,p(!0);if(!t.value.purchaseLimit)return h.value=`${r("shop.pleaseInput")}${r("flashSale.numberPurchasesPer")}`,p(!0);if(t.value.purchaseLimit<=0)return h.value=`${r("flashSale.numberPurchasesPer")}${r("flashSale.mustLtZero")}`,p(!0);if(+t.value.purchaseLimit>+S.value)return h.value=r("flashSale.numberPurchasesLimit"),p(!0);if(!+t.value.discountRate||+t.value.discountRate<20)return h.value=r("shop.emptyRadio"),p(!0);if(!t.value.startTime||!t.value.endTime)return h.value=r("goods.selectTime"),p(!0);D.value=!0,ie.value=!1,t.value.status=We.OnShelf,Ae(),ae(!0)},Ae=()=>{const e=y.value.map(n=>n.url),o=V.value.map(n=>n.url);t.value.mainImageUrls=e.join(","),t.value.detailImageUrls=o.join(","),t.value.shippingMethod=C.value,t.value.categoryId=I.value||null};function Ce(){D.value=!1,ie.value=!0,ae(!1)}const Pe=async()=>{var $;O(!0);const e=await Qe({...t.value,shopId:($=await _())==null?void 0:$.id});if(!e.success){D.value=!1,O(!1);return}const o={id:e.data&&e.data.id,limitEach:t.value.purchaseLimit,totalAmount:S.value,price:+t.value.price,startTime:me(t.value.startTime),endTime:me(t.value.endTime),discountRate:+q(t.value.discountRate).times(1e4)},n=await x(o);setTimeout(()=>{O(!1),D.value=!1},1500),n.success&&j.replace({path:"saleGoodDetail",query:{id:e.data.id}})},J=m([]),{currentLocale:ke}=Ke(),Re=async()=>{const e=await et();e.success&&(J.value=(e.data||[]).map(o=>({value:o.id,text:o[`${tt[ke.value]}Name`]})),I.value=e.data&&e.data.length?+e.data[0].id:0)},Ue=async()=>{const e=k.query.id;if(!e)return;const o=await Xe(+e);if(!o.success)return;const n=o.data.goods;n.icons&&(y.value=(n.icons||"").split(",").map($=>({url:$}))),n.goodsPic&&(V.value=n.goodsPic.split(",").map($=>({url:$}))),C.value=n.deliveryType,t.value.title=n.goodsName,t.value.describe=n.goodsDesc,t.value.shippingMethod=n.deliveryType,t.value.categoryId=o.data.stores.classId||null,t.value.shopGoodsFlag=0,t.value.goodsId=n.id};return Ge(()=>{t.value.totalPrice=+q(t.value.price).times(S.value)||0}),ve(async()=>{Re(),Ue()}),(e,o)=>{const n=w("van-field"),$=w("van-uploader"),K=w("van-dropdown-item"),Q=w("van-dropdown-menu"),de=w("van-datetime-picker"),ue=w("van-popup"),De=w("VanButton");return v(),g("div",Et,[a("header",null,[a("div",At,[i(Ye),a("span",Ct,l(e.$t("flashSale.publishProduct")),1)])]),a("div",Pt,[a("div",kt,l(`*${e.$t("goods.goodsName")}`),1),i(n,{modelValue:t.value.title,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.title=s),autosize:"",type:"text",placeholder:e.$t("goods.pleaseInputTitle"),maxlength:"50"},null,8,["modelValue","placeholder"]),a("div",Rt,[i($,{modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=s=>y.value=s),accept:"image/*","max-count":5,"preview-size":"60",afterRead:Ve},{default:d(()=>[a("div",Ut,[a("img",{src:u(G)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,Dt),a("div",Bt,l(e.$t("goods.goodsImage")),1)])]),_:1},8,["modelValue"])]),a("div",Ft,[i(n,{"input-align":"right",autocomplete:"off"},{label:d(()=>[a("div",Lt,l(`*${e.$t("common.category")}`),1)]),input:d(()=>[i(Q,{"active-color":"#FEA021",class:"flex-1"},{default:d(()=>[i(K,{modelValue:I.value,"onUpdate:modelValue":o[2]||(o[2]=s=>I.value=s),options:J.value,title:I.value?"":e.$t("shop.pleaseSelect")},null,8,["modelValue","options","title"])]),_:1})]),_:1})]),a("div",Mt,l(`*${e.$t("goods.goodsDesc")}`),1),i(n,{modelValue:t.value.describe,"onUpdate:modelValue":o[3]||(o[3]=s=>t.value.describe=s),rows:"1",autosize:"",type:"textarea",placeholder:e.$t("goods.pleaseInputDesc")},null,8,["modelValue","placeholder"]),i($,{modelValue:V.value,"onUpdate:modelValue":o[4]||(o[4]=s=>V.value=s),accept:"image/*","max-count":5,"preview-size":"60",afterRead:Ie},{default:d(()=>[a("div",Gt,[a("img",{src:u(G)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,Nt),a("div",qt,l(e.$t("goods.descImage")),1)])]),_:1},8,["modelValue"])]),a("div",jt,[F.value?(v(),g("div",zt,[i(n,{"input-align":"right",autocomplete:"off"},{label:d(()=>[a("div",Ot,l(`*${e.$t("goods.pay methods")}`),1)]),input:d(()=>[i(Q,{"active-color":"#FEA021",class:"flex-1"},{default:d(()=>[i(K,{modelValue:f.value,"onUpdate:modelValue":o[5]||(o[5]=s=>f.value=s),options:u(z),title:f.value?"":e.$t("shop.pleaseSelect")},null,8,["modelValue","options","title"])]),_:1})]),_:1})])):E("",!0),f.value!==u(T).MC?(v(),g("div",Zt,[i(n,{"input-align":"right",type:"number",autocomplete:"off",modelValue:t.value.cardPrice,"onUpdate:modelValue":o[6]||(o[6]=s=>t.value.cardPrice=s),onBlur:H,placeholder:e.$t("shop.pleaseInputCardPrice")},{label:d(()=>[a("div",Ht,l(`*${e.$t("goods.stored card single price")} `),1)]),_:1},8,["modelValue","placeholder"])])):E("",!0),f.value!==u(T).STORE_CARD?(v(),g("div",Jt,[i(n,{"input-align":"right",type:"number",autocomplete:"off",modelValue:t.value.price,"onUpdate:modelValue":o[7]||(o[7]=s=>t.value.price=s),onBlur:H,placeholder:e.$t("shop.pleaseInput")+"MC"+e.$t("flashSale.unitPrice")},{label:d(()=>[a("div",Kt,l(`*MC${e.$t("flashSale.unitPrice")}`),1)]),_:1},8,["modelValue","placeholder"])])):E("",!0),a("div",Qt,[i(n,{"input-align":"right",type:"number",autocomplete:"off",modelValue:S.value,"onUpdate:modelValue":o[8]||(o[8]=s=>S.value=s),onBlur:H,placeholder:e.$t("shop.pleaseInput")+e.$t("flashSale.totalUnit")},{label:d(()=>[a("div",Yt,l(`*${e.$t("flashSale.totalUnit")}`),1)]),_:1},8,["modelValue","placeholder"])]),a("div",Wt,[i(n,{"input-align":"right",type:"number",autocomplete:"off",readonly:"",placeholder:e.$t("shop.pleaseInput")+e.$t("flashSale.totalPrice")},{label:d(()=>[a("div",Xt,l(`*${e.$t("flashSale.totalPrice")}`),1)]),input:d(()=>[a("div",eo,[f.value!==u(T).MC?(v(),g("div",to,l(u(we))+" Symbol ",1)):E("",!0),f.value!==u(T).STORE_CARD?(v(),g("div",oo,l(t.value.totalPrice)+" MC ",1)):E("",!0)])]),_:1},8,["placeholder"])]),a("div",ao,[i(n,{"input-align":"right",type:"digit",autocomplete:"off",modelValue:t.value.purchaseLimit,"onUpdate:modelValue":o[9]||(o[9]=s=>t.value.purchaseLimit=s),placeholder:e.$t("shop.pleaseInput")+e.$t("flashSale.numberPurchases")},{label:d(()=>[a("div",lo,l(`*${e.$t("flashSale.numberPurchasesPer")}`),1)]),_:1},8,["modelValue","placeholder"])]),i(n,{"input-align":"right",type:"digit",autocomplete:"off",modelValue:t.value.discountRate,"onUpdate:modelValue":o[10]||(o[10]=s=>t.value.discountRate=s),placeholder:e.$t("flashSale.pleaseInputPoint"),onBlur:o[11]||(o[11]=s=>Te(t.value.discountRate)),readonly:f.value!==u(T).MC,disabled:f.value!==u(T).MC},{label:d(()=>[a("div",so,l(`*${e.$t("goods.discountRatio")}`),1)]),"right-icon":d(()=>[no]),_:1},8,["modelValue","placeholder","readonly","disabled"])]),a("div",io,[i(n,{"input-align":"right",autocomplete:"off",onClick:o[12]||(o[12]=s=>u(A)(!0))},{label:d(()=>[a("div",uo,l(`*${e.$t("flashSale.activityStartTime")}`),1)]),"right-icon":d(()=>[a("img",{src:u(G)("calander.svg"),class:"w-6",alt:""},null,8,ro)]),input:d(()=>[t.value.startTime?(v(),g("div",co,l(t.value.startTime),1)):(v(),g("div",mo,l(e.$t("goods.selectStartTime")),1))]),_:1}),i(n,{"input-align":"right",autocomplete:"off",onClick:o[13]||(o[13]=s=>u(M)(!0))},{label:d(()=>[a("div",po,l(`*${e.$t("flashSale.activityEndTime")}`),1)]),"right-icon":d(()=>[a("img",{src:u(G)("calander.svg"),class:"w-6",alt:""},null,8,vo)]),input:d(()=>[t.value.endTime?(v(),g("div",fo,l(t.value.endTime),1)):(v(),g("div",ho,l(e.$t("goods.selectEndTime")),1))]),_:1}),i(ue,{show:u(b),"onUpdate:show":o[15]||(o[15]=s=>re(b)?b.value=s:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1},{default:d(()=>[i(de,{modelValue:U.value,"onUpdate:modelValue":o[14]||(o[14]=s=>U.value=s),"min-date":be.value,type:"datetime",title:e.$t("goods.selectStartTime"),onCancel:ne,onConfirm:xe},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),i(ue,{show:u(R),"onUpdate:show":o[17]||(o[17]=s=>re(R)?R.value=s:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1},{default:d(()=>[i(de,{modelValue:Z.value,"onUpdate:modelValue":o[16]||(o[16]=s=>Z.value=s),onConfirm:Se,"min-date":le.value,"max-date":se.value,onCancel:ne,type:"datetime",title:e.$t("goods.selectEndTime")},null,8,["modelValue","min-date","max-date","title"])]),_:1},8,["show"])]),a("div",go,[i(n,{"input-align":"right",autocomplete:"off",label:`*${e.$t("goods.deliveryType")}`},{label:d(()=>[a("div",yo,l(`*${e.$t("goods.deliveryType")}`),1)]),input:d(()=>[i(Q,{"active-color":"#FEA021"},{default:d(()=>[i(K,{modelValue:C.value,"onUpdate:modelValue":o[18]||(o[18]=s=>C.value=s),options:u($e),disabled:""},null,8,["modelValue","options"])]),_:1})]),_:1},8,["label"])]),a("div",_o,[i(De,{class:Ne(["min-w-[130px] h-[40px] rounded-full bg-gray2 text-white",{"btn-orange":y.value.length>0&&t.value.title&&t.value.price>0}]),onClick:o[19]||(o[19]=s=>Ee()),disabled:t.value.price<=0,loading:D.value},{default:d(()=>[P(l(e.$t("goods.upimmediately")),1)]),_:1},8,["disabled","loading","class"])]),u(L)?(v(),X(Oe,{key:0,onClose:o[20]||(o[20]=s=>u(p)(!1)),text:h.value},null,8,["text"])):E("",!0),i(It,{show:u(ye),goods:t.value,loading:u(_e),onClose:Ce,onOnConfirm:Pe},null,8,["show","goods","loading"])])}}}),Uo=te(bo,[["__scopeId","data-v-7e824476"]]);export{Uo as default};
