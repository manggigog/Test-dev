import{_ as Ie}from"./MCOIN-Bodfn-v1.js";import{_ as be,z as X,x as Ce,q as Fe,o as we,a2 as $,r as E,bl as H,y as W,E as Te,bm as xe,ad as De,F as P,Z as C,H as g,$ as r,P as d,I as h,O as s,G as Y,K as Ee,Q as v,U as k,a4 as F,J as ke,N as Ge,X as Oe,Y as Ve}from"./vendor-Dr_RpJ_Y.js";import{C as Be}from"./CommonVanProvider-KZuKVOde.js";import{_ as Re}from"./OfflineGoods-DKMaiwr2.js";import{S as Le}from"./SearchBox-B2zPkiHG.js";import{B as $e}from"./BetweenTab-nGcUWfRT.js";import{_ as Pe}from"./RegionBox-Dwor092Q.js";import{b as Ae,u as Ne,a as je,C as Q,b$ as qe,c0 as Me,aU as Ue,a1 as ze}from"./index-BckdT6oc.js";import{D as Ke}from"./goods-BVwS8oFG.js";import{c as u}from"./offlineGoods-DvT2Go6q.js";import{S as Je}from"./shop-CeqcS6K2.js";import"./BackIcon-CDrGaEPo.js";import"./ImgBoutiqueLable-B-2xCcw4.js";import"./search-C4fLtTfY.js";import"./filter-DRLh1k_O.js";import"./category-D2HQzb2Y.js";/* empty css                                                               */const He=c=>(Oe("data-v-e4a7f210"),c=c(),Ve(),c),We={class:"px-3 mt-3"},Ye={class:"flex items-center"},Qe=He(()=>h("img",{src:Ie,class:"w-4 h-4 mr-1.5"},null,-1)),Xe={class:"text-newOrigin"},Ze={class:"relative flex justify-end text-xs mt-3"},eo={class:"w-[calc(100%-32px)] max-w-[343px] mx-auto safe-bottom"},oo=X({beforeRouteEnter(c,w,S){console.log("GoodsManage beforeRouteEnter",c.path,w.path),c.path==="/offlineGoodsManage"&&w.path!=="/offlineGoodsEditGoods"&&S(_=>{_.initEditGoodsStorage()}),S()}});function to(c,{expose:w}){var J;const{checkLoginAuth:S}=Ae(),{t:_}=Ce(),T=Fe(),A=we(),{getCurrentStoreId:Z}=Ne(),{accountStore:f,clerkStore:ee}=je(),[oe,G]=$(!1),te=E(null),se=[{label:_("offline.onSale"),value:u.Published},{label:_("shop.watiShelf"),value:u.OffShelf},{label:_("offline.drafts"),value:u.DRAFT}],t=H({shopInfo:null,list:[],total:0,loading:!1,finished:!1}),a=H({shopId:(J=t.shopInfo)==null?void 0:J.id,page:0,size:10,goodsNameLike:"",goodsCategoryId1:"",goodsStatus:u.Published,goodsType:null,sortBy:"desc|create_time",distinctFlag:!0,deleteFlag:!1}),ne=W(()=>{var e;return(e=t==null?void 0:t.shopInfo)==null?void 0:e.type}),le=e=>{T.push(e)},ae=async e=>{a.goodsType=(e==null?void 0:e.type)>=Je.SD?e.type:void 0,a.startTime=(e==null?void 0:e.upStartTime)||void 0,a.endTime=(e==null?void 0:e.upEndTime)||void 0,a.goodsCategoryId1=(e==null?void 0:e.subclassId)||void 0,m()},ie=e=>{a.goodsStatus=e,T.replace({path:"offlineGoodsManage",query:{status:e}}),m()},N=async(e,o)=>{e.loading=!0;const{success:n}=await qe({goodsId:e.goodsId,shopId:e.shopId,goodsStatus:o});e.loading=!1,n&&(t.list=t.list.filter(i=>i.goodsId!==e.goodsId))},m=async()=>{t.finished=!1,t.total=0,t.list=[],a.page=0,O()},O=async()=>{var e,o;if(!((e=t.shopInfo)!=null&&e.id))return t.finished=!0;t.loading=!0,a.shopId=(o=t.shopInfo)==null?void 0:o.id,a.page+=1,await re(),t.loading=!1},re=async()=>{const e=a.goodsStatus,{success:o,data:n}=await Ue(a);if(t.loading=!1,!o){t.finished=!0;return}if(e!=a.goodsStatus)return;const{records:i,total:D,current:l,pages:p}=n;if(!D||!i||!(i!=null&&i.length)){t.finished=!0;return}t.total=D;const L=E([]);L.value=i.map(_e=>({btnLoading:!1,..._e})),t.list=a.page===1?L.value:t.list.concat(L.value),+l>=+p&&(t.finished=!0)};let I=null;const de=async()=>{const e=localStorage.getItem("shopOffline_scrollTop");+e?I.scrollTo({top:+e,left:0,behavior:"instant"}):localStorage.removeItem("shopOffline_scrollTop")},V=E(!1),j=()=>{V.value||(V.value=!0,setTimeout(()=>{localStorage.setItem("shopOffline_scrollTop",I.scrollTop+""),V.value=!1},500))},[ue,B]=$(!1),[q,R]=$(!1),b=E(null),ce=async e=>{b.value=e,B(!0)},M=()=>{B(!1)},fe=async()=>{var o,n;if(q.value)return;R(!0);const{success:e}=await Me({goodsId:(o=b.value)==null?void 0:o.goodsId,shopId:((n=b.value)==null?void 0:n.shopId)||null});if(!e){R(!1);return}pe(b.value),b.value=null,B(!1),setTimeout(()=>{R(!1)},1e3)},pe=e=>{if(!t.list||!e)return;const o=t.list.findIndex(n=>n.goodsId==e.goodsId);o>-1&&(t.list.splice(o,1),t.total-=1)},x="offline_draft_data",y=W(()=>{var e;return((e=f.store)==null?void 0:e.id)+"_"+f.account}),ge=()=>{const e=z();e&&!e.isManualSave&&G(!0)},U=()=>{try{const e=localStorage.getItem(x);return e?JSON.parse(e):null}catch(e){return console.error("获取缓存数据失败:",e),null}},z=()=>{var e;try{const o=U();return!o||!o[y.value]||!((e=o[y.value])!=null&&e.goods)?null:o[y.value]}catch(o){return console.error("恢复表单数据失败:",o),null}},he=()=>{var o,n;const e=z();if(e){let i={};(o=e.goods)!=null&&o.goodsId&&(i.goodsId=(n=e.goods)==null?void 0:n.goodsId),T.push({name:"EditOfflineGoods",query:i,params:{restoreWithoutInquire:1}})}G(!1)},K=()=>{me(),G(!1)},me=()=>{try{let e=U();e&&e[y.value]&&e[y.value].goods?(delete e[y.value],Object.keys(e).length===0?localStorage.removeItem(x):localStorage.setItem(x,JSON.stringify(e))):localStorage.removeItem(x)}catch(e){console.error("清空表单数据失败:",e)}},ye=async()=>{S(!0)&&T.push("/offlineGoodsEditGoods")},ve=async()=>{var e,o;I=document.querySelector(".shopGoodsPage"),I.addEventListener("scroll",j),(e=A.query)!=null&&e.status&&(a.goodsStatus=Number((o=A.query)==null?void 0:o.status)),t.shopInfo=await Z(),O()},Se=async()=>{S(!0)&&ve()};return Te(async()=>{Se()}),xe(async()=>{ee.isClerk&&m();try{de();const e=sessionStorage.getItem("shop_offline_refresh_id");if(e==="add")m();else if(e){const o=await ze({id:e}),n=t.list.findIndex(i=>i.goodsId===e);n>-1?o.data.goodsStatus!==t.list[n].goodsStatus?t.list.splice(n,1):t.list[n]=o.data:m()}}finally{sessionStorage.removeItem("shop_offline_refresh_id")}}),De(()=>{I.removeEventListener("scroll",j)}),w({initEditGoodsStorage:ge}),(e,o)=>{const n=P("VanButton"),i=P("VanList"),D=P("router-view");return g(),C(Be,{title:e.$t("offline.sale_services"),class:"bg-gray1 font-Puhui font-normal relative","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(l,p)=>{p.shopGoodsRef=l,te.value=l}},{right:r(()=>[d(Pe)]),default:r(()=>[d($e,{options:se,"label-key":"label","value-key":"value",modelValue:s(a).goodsStatus,"onUpdate:modelValue":o[0]||(o[0]=l=>s(a).goodsStatus=l),onChange:ie},null,8,["modelValue"]),h("div",We,[d(Le,{modelValue:s(a).goodsNameLike,"onUpdate:modelValue":o[1]||(o[1]=l=>s(a).goodsNameLike=l),deliveryType:s(Ke).offeline,shopType:s(ne),onOnSubmit:m,onOnFilter:ae},null,8,["modelValue","deliveryType","shopType"])]),h("div",{class:Ge(["m-3 overflow-y-auto shopGoodsPage",{"safe-body":!s(f).isOnlyView}])},[d(i,{loading:s(t).loading,"onUpdate:loading":o[2]||(o[2]=l=>s(t).loading=l),finished:s(t).finished,"immediate-check":!1,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:O},{default:r(()=>[(g(!0),Y(ke,null,Ee(s(t).list,l=>(g(),Y("div",{class:"offline-crad-box mb-3",key:l.goodsId},[d(Re,{showSale:"",showGoodsType:"",goods:l},{"bottom-price":r(()=>[h("div",Ye,[Qe,h("div",Xe,v(l.goodsPrice),1)])]),_:2},1032,["goods"]),h("section",Ze,[s(a).goodsStatus===s(u).Published&&!s(f).isOnlyView?(g(),C(n,{key:0,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:l.loading,onClick:p=>N(l,s(u).OffShelf)},{default:r(()=>[F(v(e.$t("shop.down")),1)]),_:2},1032,["loading","onClick"])):k("",!0),s(a).goodsStatus===s(u).OffShelf&&!s(f).isOnlyView?(g(),C(n,{key:1,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:l.loading,onClick:p=>N(l,s(u).Published)},{default:r(()=>[F(v(e.$t("shop.up")),1)]),_:2},1032,["loading","onClick"])):k("",!0),s(a).goodsStatus!=s(u).Published&&!s(f).isOnlyView?(g(),C(n,{key:2,color:"#F5F5F5",round:"",class:"!text-b2 h-[32px] rounded-md px-3 mr-2",loading:l.loading,onClick:p=>ce(l,e.index)},{default:r(()=>[F(v(e.$t("shop.delete")),1)]),_:2},1032,["loading","onClick"])):k("",!0),d(n,{color:"#FED73A",round:"",class:"!text-b1 font-semibold h-[32px] rounded-md px-3",onClick:p=>le(`/offlineGoodsEditGoods?goodsId=${l.goodsId.toString()}`)},{default:r(()=>[F(v(e.$t("shop.modify")),1)]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])],2),h("div",eo,[s(f).isOnlyView?k("",!0):(g(),C(n,{key:0,onClick:ye,class:"bg-btnOrBg w-full h-[46px] flex-center text-b1 text-base font-semibold z-50 rounded-3xl"},{default:r(()=>[F(v(e.$t("offline.published_goods")),1)]),_:1}))]),d(Q,{show:s(ue),title:"重要操作",content:"确认删除？删除后将无法恢复。",showConfirm:!0,showReject:!0,confirmText:"确认",rejectText:"取消",loading:s(q),onClose:M,onReject:M,onConfirm:fe,confirmStyle:{background:"#07C160",color:"white"},rejectStyle:{background:"#F44",color:"white",borderColor:"#F44",borderWidth:"0 !important"}},null,8,["show","loading"]),d(Q,{show:s(oe),noHeader:"",content:"你有未编辑完成的商品，是否继续？",showConfirm:!0,showReject:!0,confirmText:"编辑",rejectText:"放弃",onClose:K,onConfirm:he,onReject:K},null,8,["show"]),d(D,{class:"child-view bg-gray1"})]),_:1},8,["title"])}}const so=X({...oo,setup:to}),bo=be(so,[["__scopeId","data-v-e4a7f210"]]);export{bo as default};
