import{_ as Q,z as G,y as M,G as l,H as a,U as c,O as _,N as z,Q as x,I as s,J as O,K as Y,x as ie,Z as y,P as S,a4 as we,a3 as $e,T as X,F as E,X as de,Y as ce,o as Te,q as Ie,r as u,aa as Ce,D as oe,bm as Le,E as Se,$ as j}from"./vendor-Dr_RpJ_Y.js";import{a as Ae,z as qe,k as De,e as Re,b as Ne,ar as Be,by as ze,w as Ge,as as Ue,a0 as je,bz as Ee,bA as Me,aU as Fe,bm as Oe}from"./index-BckdT6oc.js";import{a as Pe}from"./shop-CeqcS6K2.js";import{_ as Ve}from"./buy-cart-m4kq4Bzt.js";import{_ as He}from"./BoutiqueLable-DDlxeK08.js";import{R as J}from"./RatioBox-BcgP5qRZ.js";import{_ as Ke}from"./ShopMaskTips-ClYuWX9C.js";import{_ as le}from"./GoodsPrice-Dz5PcG19.js";import{_ as ne}from"./CardPrice-DihLnH8_.js";import{D as Ye}from"./goods-BVwS8oFG.js";import{M as Xe}from"./MallTabBar-B4NGHTvo.js";import{B as Je}from"./BackIcon-CDrGaEPo.js";import{a as Qe}from"./category-D2HQzb2Y.js";import{c as We}from"./mall-BsPFqNQo.js";import{_ as Ze}from"./DefaultPage-Dw2KbFq2.js";import{_ as et}from"./ServiceIcon-C-6e9qNo.js";import{_ as tt}from"./MCOIN-Bodfn-v1.js";import{_ as st}from"./ImgBoutiqueLable-B-2xCcw4.js";import"./convertToImage-CVnklL6A.js";import"./upload-DmJ1cHIQ.js";import"./active_empty-OYjsVrLW.js";import"./HelpPop-DNergf7K.js";const at=""+new URL("../images/flashSale-DOaFK4_-.png",import.meta.url).href,ot=""+new URL("../images/unflashSale-CjYqec_P.png",import.meta.url).href,lt={class:"relative z-20 whitespace-nowrap flex justify-center gap-16 px-12 py-2.5 overflow-hidden bg-white rounded-t-lg sort-shadow text-black-400 text-sm font-normal"},nt={class:"flex items-center gap-1"},it={key:0,class:"w-4 h-4",src:at},dt={key:1,class:"w-4 h-4",src:ot},ct=G({props:{deliveryType:null},emits:["change"],setup(e,{emit:f}){const{useShopStore:r}=Ae(),h=M(()=>r.shopMenus&&r.shopMenus.includes(4)),d=M(()=>r.shopMenus&&r.shopMenus.includes(3));return(i,k)=>(a(),l("div",lt,[_(h)?(a(),l("div",{key:0,class:z({active:e.deliveryType===1}),onClick:k[0]||(k[0]=n=>f("change",1))},x(i.$t("common.send")),3)):c("",!0),_(h)?(a(),l("div",{key:1,class:z({active:e.deliveryType===2}),onClick:k[1]||(k[1]=n=>f("change",2))},x(i.$t("shop.offline server")),3)):c("",!0),_(d)?(a(),l("div",{key:2,class:z({active:e.deliveryType===3}),onClick:k[2]||(k[2]=n=>f("change",3))},[s("div",nt,[e.deliveryType===3?(a(),l("img",it)):(a(),l("img",dt)),s("span",null,x(i.$t("order.onesale order")),1)])],2)):c("",!0)]))}}),rt=Q(ct,[["__scopeId","data-v-3069830c"]]),ut={class:"relative w-[100px] h-full overflow-hidden border-solid border-r-2 border-primary-008"},vt={class:"w-[98px] h-full overflow-y-auto flex flex-col gap-2 py-4"},mt=["onClick"],yt={class:"font-normal leading-6 text-center"},ft=G({props:{list:{default:()=>[]},flashSaleList:{default:()=>[]},classId:{default:null},shopId:null,deliveryType:null},emits:["change"],setup(e,{emit:f}){const r=e,{currentLocale:h}=qe(),d=M(()=>r.deliveryType===3?r.flashSaleList.map(i=>({...i,name:i[`${Pe[h.value]}Name`]})):r.list.filter(i=>+i.type==+r.deliveryType||!i.type));return(i,k)=>(a(),l("div",ut,[s("div",vt,[(a(!0),l(O,null,Y(_(d),n=>(a(),l("div",{class:z(["relative py-1.5 pl-4 pr-2 text-sm text-black-400",{"text-black-800 bg-primary-008":e.classId===n.id}]),key:n.id,onClick:w=>f("change",n.id)},[s("span",yt,x(n.name),1)],10,mt))),128))])]))}}),ht=""+new URL("../images/offline-black-OiwvbEll.svg",import.meta.url).href,gt=""+new URL("../images/cart-icon-ibBU6cSG.svg",import.meta.url).href,pt=""+new URL("../images/Rob-CY-NIaX_.png",import.meta.url).href,xt=""+new URL("../images/Robed-BOyO2jaS.png",import.meta.url).href,kt={class:"flex items-start justify-between"},bt={class:"w-[90px] h-[90px] relative"},_t=["src"],wt={class:"text-sm flex items-center mb-1.5 relative"},$t={class:"text-sm flex-1 w-0 font-semibold leading-[0.875rem] truncate text-default mr-1"},Tt={class:"flex items-center"},It={class:"flex-1"},Ct={class:"mb-2 text-xs leading-normal line-clamp-1 text-black-400"},Lt={key:0,class:"flex items-center gap-1"},St={class:"inline-flex bg-[#FED73A] items-center gap-1 px-1.5 py-1 text-xs font-bold rounded bg-ratio text-black no-wrap"},At=s("img",{class:"w-[1rem] h-[1rem]",src:ht},null,-1),qt={key:1,class:"text-sm font-bold"},Dt={class:"flex items-end mt-1"},Rt=["onClick"],Nt={key:0,class:"w-6 h-6",src:gt},Bt={key:1,class:"w-6 h-6",src:Ve},zt={key:1,class:"flex w-full"},Gt={key:0,class:"text-sm font-bold"},Ut={class:"ml-auto"},jt={key:0,class:"w-5 h-5 mr-2",src:pt},Et={key:1,class:"w-5 h-5 mr-2",src:xt},Mt=s("div",{class:"flex items-center h-2.5"},[s("div",{class:"h-[1px] w-full bg-black-100"})],-1),Ft=G({props:{data:null,deliveryType:null},emits:["handleAddCart","click"],setup(e,{emit:f}){const r=e,{t:h}=ie(),d=async()=>{if(r.data.goods.stock===0&&r.data.goods.goodsTypes!=2){X(h("order.Insufficient stock"));return}r.data.goods.deliveryType===1?f("handleAddCart",r.data.goods):f("click")};return(i,k)=>(a(),l(O,null,[e.data.goods?(a(),l("div",{key:0,class:"w-full py-3 bg-white rounded",onClick:k[0]||(k[0]=n=>f("click"))},[s("section",kt,[s("div",bt,[(e.data.goods.status!=1||!+e.data.goods.stock)&&e.deliveryType!==3&&e.data.goods.goodsTypes!=2?(a(),y(Ke,{key:0,status:e.data.goods.status,stock:e.data.goods.stock},null,8,["status","stock"])):c("",!0),s("img",{src:e.data&&e.data.goods&&e.data.goods.icons&&e.data.goods.icons.split(",")[0]||_(De)("images/activity/boutique/squre_empty.png"),class:"rounded w-[90px] h-[90px] aspect-square object-cover"},null,8,_t)]),s("section",{class:z(["flex-1 min-h-[90px] ml-2 flex flex-col",{" justify-between":e.deliveryType==3}])},[s("div",wt,[e.data.goods.type?(a(),y(He,{key:0,type:e.data.goods.type,class:"flex-shrink-0 mr-1"},null,8,["type"])):c("",!0),s("div",$t,x(e.data.goods.goodsName),1)]),s("div",Tt,[s("div",It,[s("div",Ct,x(e.data.goods.goodsDesc),1),e.deliveryType===2?(a(),l("div",Lt,[s("div",St,[At,we(" "+x(i.$t("common.offline")),1)]),S(J,{ratio:e.data.goods.discountRatio},null,8,["ratio"])])):c("",!0),e.deliveryType!==3?(a(),l("div",qt,[e.data.goods.payType!==2?(a(),y(le,{key:0,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.price},null,8,["price"])):c("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),y(ne,{key:1,color:"#000000",class:"mt-1.5 text-base",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):c("",!0)])):c("",!0)])]),s("div",Dt,[s("div",null,[e.data.goods.payType!==2&&Number(e.data.goods.deliveryType)===_(Ye).online&&e.deliveryType!=3?(a(),y(J,{key:0,class:"flex-shrink-0",tag:i.$t("common.rebate"),ratio:e.data.goods.discountRatio||0},null,8,["tag","ratio"])):c("",!0)]),e.deliveryType!=3?(a(),l("div",{key:0,onClick:$e(d,["stop"]),class:"px-1.5 ml-auto"},[e.data.goods.deliveryType===1?(a(),l("img",Nt)):(a(),l("img",Bt))],8,Rt)):(a(),l("div",zt,[e.deliveryType===3?(a(),l("div",Gt,[e.data.goods.payType!==2?(a(),y(le,{key:0,price:e.data.goods.price},null,8,["price"])):c("",!0),e.data.goods.payType===2||e.data.goods.payType===3?(a(),y(ne,{key:1,class:"ml-auto",price:e.data.goods.cardPrice,symbol:e.data.card&&e.data.card.symbol},null,8,["price","symbol"])):c("",!0)])):c("",!0),s("div",Ut,[+e.data.goods.status>=15?(a(),l("img",jt)):(a(),l("img",Et))])]))])],2)])])):c("",!0),Mt],64))}}),Ot=e=>(de("data-v-332bed3a"),e=e(),ce(),e),Pt=["data-store-name"],Vt={class:"shrink-0 w-[80px] h-[80px] overflow-hidden relative"},Ht={class:"ml-2 flex-1 flex flex-col justify-between min-h-[80px]",style:{width:"calc(100% - 80px - 8px)"}},Kt={class:"w-full"},Yt={class:"w-full"},Xt={class:"font-semibold text-sm text-b1 line-clamp-1"},Jt={class:"w-full"},Qt={class:"font-normal text-sm text-b3 line-clamp-1"},Wt={class:"flex items-center justify-start"},Zt={class:"flex items-center"},es=Ot(()=>s("img",{src:tt,class:"w-4 h-4 mr-1"},null,-1)),ts={class:"text-b1 font-semibold text-sm"},ss=G({props:{goods:{type:Object,default:()=>({})}},setup(e){const f=e,r=M(()=>{var d;return(((d=f.goods.goodsIcons)==null?void 0:d.split(","))||[""])[0]});return(h,d)=>{const i=E("VanImage");return a(),l("section",{class:"flex items-start font-Puhui","data-store-name":e.goods.shopName},[s("div",Vt,[S(i,{src:_(r),class:"w-[80px] h-[80px] rounded-lg overflow-hidden",alt:h.$t("goods.goodsImage"),fit:"cover"},null,8,["src","alt"]),S(st,{type:e.goods.goodsType||null},null,8,["type"])]),s("div",Ht,[s("div",Kt,[s("div",Yt,[s("div",Xt,x(e.goods.goodsName||""),1)]),s("div",Jt,[s("div",Qt,x(e.goods.goodsDesc||""),1)])]),s("div",Wt,[s("div",Zt,[es,s("div",ts,x(_(Re)(e.goods.goodsPrice)),1)]),e.goods.goodsDiscountRatio?(a(),y(J,{key:0,class:"ratio-box ml-1 !px-1",tag:h.$t("common.rebate"),ratio:e.goods.goodsDiscountRatio},null,8,["tag","ratio"])):c("",!0)])])],8,Pt)}}}),as=Q(ss,[["__scopeId","data-v-332bed3a"]]),os=e=>(de("data-v-2635e96a"),e=e(),ce(),e),ls={class:"z-50 overflow-y-auto parent-view mall-header-bg"},ns={class:"sticky top-0 z-50 text-sm font-normal mall-header-bg"},is={class:"flex relative justify-center items-center h-[44px] px-2.5"},ds={class:"absolute left-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},cs={class:"font-semibold"},rs={class:"absolute right-2.5 flex items-center gap-1 -translate-y-1/2 top-1/2"},us={class:"px-2.5 sticky top-[44px]"},vs={key:0,class:"bg-gradient-7 text-white px-2.5 py-0.5 text-xxs leading-normal rounded-xl"},ms=os(()=>s("div",{class:"h-[16px]"},null,-1)),ys={class:"overflow-hidden shadow-box"},fs={class:"mall-header-bg mall-header-bg-box"},hs={key:0,class:"px-2.5 py-2.5"},gs={key:1,class:"p-3"},ps=G({name:"CategoryShopDetail"});function xs(e){const{checkLoginAuth:f,checkRegisterAuth:r}=Ne(),{t:h}=ie(),d=Te(),i=Ie(),k=Be(),n=u(1);d.query.deliveryType&&(n.value=Number(d.query.deliveryType));const w=M(()=>d.query.shopId||null),P=u(null);P.value=d.query.shopId;const F=u(null),{y:W}=Ce(F);oe(()=>w,async t=>{t.value&&t.value!==P.value&&(P.value=t.value,b.value&&(b.value=null),ae(),A())},{deep:!0});const b=u(null),re=t=>{b.value!==t&&(b.value=t,A())};oe(()=>d.query.deliveryType,()=>{d.query.deliveryType&&+d.query.deliveryType!=+n.value&&(n.value=Number(d.query.deliveryType),b.value=null,V(),A())},{deep:!0});const g=u(null),ue=async()=>{if(!w.value)return;const t=await je(w.value);!t.success||!t.data||(g.value=t.data,A())},ve=t=>{n.value!==t&&(C.value="",i.replace({path:"category",query:{deliveryType:t,shopId:w.value}}),n.value=t,b.value=null,D.value=[],D.value.unshift({name:"推薦",id:null}),V(),A())},D=u([]),V=async()=>{if(n.value===2){try{const{success:o,data:$}=await Ee({shopId:w.value});if(!o)return;const v=($||[]).filter(R=>R.goodsCount>0).map(R=>({name:R.goodsCategoryName,id:R.goodsCategoryId}));v.unshift({name:"推薦",id:null}),D.value=v}catch(o){console.error("获取线下服务类目数据失败:",o),D.value=[]}return}const t=await Qe({address:g.value.merchant});t.success&&(D.value=t.data||[],D.value.unshift({name:"推薦",id:null}))},H=u([]),me=async()=>{const t=await Me(g.value.merchant);t.success&&(H.value=t.data||[],H.value.unshift({cnName:"推薦",jpName:"推薦する",enName:"recommend",id:null}))},p=u([]),N=u(!1),I=u(!1),L=u(0),K=u(10),B=u(0),ye=u,Z=async()=>{!g.value&&w.value||(N.value=!0,L.value+=1,await fe(),setTimeout(()=>{N.value=!1},1500))},C=u(""),fe=async()=>{if(n.value===2){await he();return}await ge()},he=async()=>{var v;let t=null,o=null;b.value===null?(o="desc|goods_sales_volume,asc|goods_id",t=null):(o="asc|goods_id",t=b.value||null);const $={page:L.value,size:K.value,goodsStatus:1,goodsNameLike:C.value,shopId:((v=g.value)==null?void 0:v.id)||"",goodsCategoryId1:t,sortBy:o,distinctFlag:!0,deleteFlag:!1},T=await Fe($);if(N.value=!1,!T.success||!T.data||!T.data.total){I.value=!0,p.value=L.value===1?[]:p.value;return}B.value=T.data.total;const q=T.data.records||[];p.value=L.value===1?q:p.value.concat(q),p.value.length>=B.value&&(I.value=!0)},ge=async()=>{var T,q;const t={page:L.value,size:K.value,status:1,subclassId:b.value,deliveryType:n.value,merchant:(T=g.value)==null?void 0:T.merchant,keyword:C.value,deleteFlag:!1};let o=null;if(n.value===3?o=await Oe({page:L.value,size:K.value,merchant:(q=g.value)==null?void 0:q.merchant,categoryId:b.value?b.value:null,title:C.value}):o=await We(t),N.value=!1,!o.success){I.value=!0;return}if(!o.data||!+o.total){I.value=!0,p.value=L.value===1?[]:p.value;return}B.value=o.total;const $=u([]);n.value===3?$.value=o.data.map(v=>({goods:{...v,goodsName:v.title,icons:v.mainImageUrls,deliveryType:v.shippingMethod}})):$.value=o.data.map(v=>({goods:v.goods,stores:v.stores||ye,card:v.card})),p.value=L.value===1?$.value:p.value.concat($.value),p.value.length>=B.value&&(I.value=!0)},{loadingToggle:ee}=Ge(),pe=async t=>{if(t.stock===0&&t.goodsTypes!=2){X(h("order.Insufficient stock"));return}ee(!0);const o=await Ue(t.id);ee(!1),o.success&&(X(h("cart.addTips")),k.getCartCount())},xe=t=>{f(!0)&&i.push(t)},te=t=>{i.push(t)},se=u(null),ke=t=>{t.code==="Enter"&&(A(),se.value.blur())},be=()=>{C.value="",A()},A=()=>{if(W.value=0,g.value&&+g.value.status!=1){I.value=!0;return}p.value=[],L.value=0,B.value=0,I.value=!1,Z()},_e=t=>{let o={};t.goodsId&&(o.goodsId=t.goodsId),t.storeId&&(o.storeId=t.storeId),i.push({path:"/offlineGoodsDetail",query:o})},ae=async()=>{if(await ue(),g.value&&+g.value.status!=1){I.value=!0;return}C.value="",V(),me()};return Le(()=>{F.value&&F.value.scrollTo(0,W.value)}),Se(()=>{ae()}),(t,o)=>{var R;const $=E("van-icon"),T=E("van-field"),q=E("van-sticky"),v=E("VanList");return a(),l("div",ls,[s("section",ns,[s("section",is,[s("div",ds,[S(Je,null,{default:j(()=>[s("span",null,x(t.$t("common.return")),1)]),_:1})]),s("div",cs,x(t.$t("shop.Classification")),1),s("div",rs,[S(et,{shop:g.value,showInfo:"",onHandleTo:te},null,8,["shop"])])]),s("section",us,[S(T,{ref:(m,U)=>{U.searchRef=m,se.value=m},"model-value":C.value,"onUpdate:model-value":o[0]||(o[0]=m=>C.value=m),clearable:"",class:"flex-1 rounded-3xl flex items-center h-[30px] text-black-300",onKeypress:ke,placeholder:t.$t("mall.Enter search keywords"),onClear:be,enterkeyhint:"search"},{"left-icon":j(()=>[C.value?c("",!0):(a(),y($,{key:0,name:"search",size:"18"}))]),"right-icon":j(()=>[s("div",{onClick:A},[C.value?(a(),y($,{key:1,name:"search",size:"18"})):(a(),l("div",vs,x(t.$t("common.search")),1))])]),_:1},8,["model-value","placeholder"])]),ms]),s("div",ys,[S(q,{"offset-top":90},{default:j(()=>[s("div",fs,[S(rt,{deliveryType:n.value,onChange:ve},null,8,["deliveryType"])])]),_:1}),s("div",{class:z(["relative flex bg-white h-[calc(100vh-84px)] overflow-hidden",{"safe-bottom-page":_(w)}])},[S(ft,{shopId:_(w),classId:b.value,list:D.value,flashSaleList:H.value,onChange:re,deliveryType:n.value},null,8,["shopId","classId","list","flashSaleList","deliveryType"]),s("div",{class:"relative flex-1 h-full overflow-y-auto",ref:(m,U)=>{U.listPageRef=m,F.value=m}},[I.value&&B.value===0?(a(),y(Ze,{key:0,title:t.$t("common.No products")},null,8,["title"])):(a(),y(v,{key:1,loading:N.value,"onUpdate:loading":o[1]||(o[1]=m=>N.value=m),finished:I.value,"finished-text":t.$t("common.noMore"),"loading-text":t.$t("common.loading"),onLoad:Z},{default:j(()=>[n.value!==2?(a(),l("div",hs,[(a(!0),l(O,null,Y(p.value,m=>(a(),y(Ft,{data:m,onClick:U=>n.value==3?xe(`/saleGoodDetail?id=${m.goods.id}`):te(`/goodsDetail?id=${m.goods.id}`),onHandleAddCart:pe,deliveryType:n.value},null,8,["data","onClick","deliveryType"]))),256))])):(a(),l("div",gs,[(a(!0),l(O,null,Y(p.value,m=>(a(),y(as,{goods:m,class:"mb-4 :last:mb-0",onClick:U=>_e(m),"show-store-name":""},null,8,["goods","onClick"]))),256))]))]),_:1},8,["loading","finished","finished-text","loading-text"]))],512)],2)]),_(w)?(a(),y(Xe,{key:0,shopId:_(w),shopType:(R=g.value)==null?void 0:R.type},null,8,["shopId","shopType"])):c("",!0),n.value!==3?(a(),y(ze,{key:1})):c("",!0)])}}const ks=G({...ps,setup:xs}),Os=Q(ks,[["__scopeId","data-v-2635e96a"]]);export{Os as default};
