import{b as je,S as ze,c as Oe,G as Ve,_ as He,a as Me}from"./GivePointsLable-DRySqe7F.js";import{_ as Z,z,r as c,E as O,F as L,G as n,H as o,I as e,U as f,O as d,Q as l,P as _,$ as I,N as B,X as $e,Y as ke,a2 as ie,ab as qe,a4 as R,a3 as ue,bl as Ge,y as G,Z as b,K as re,J as de,x as Se,T as ee,a9 as Ze,B as ce,o as Je,q as Ke,A as Qe}from"./vendor-Dr_RpJ_Y.js";import{P as j}from"./flashSale-DDyqLyYN.js";import{S as We}from"./SubmitOrderPop-C4oVuLcL.js";import{h as X,p as _e,an as te,f as Te,e as we,c as Xe,b as Ye,ar as et,w as tt,bq as st,bk as k,as as ot,bl as lt,r as nt}from"./index-7OiUoGXy.js";import{_ as at}from"./OrderPopBorder-DFisj2bb.js";import{l as Ae}from"./luckyShopContract-DfZqYfy3.js";import{c as it}from"./goods-BMcs_teV.js";import{_ as ut}from"./BoutiqueLable-DDlxeK08.js";import{_ as rt}from"./GoodsPrice-Dz5PcG19.js";import{R as dt}from"./RatioBox-C8BvsGJW.js";import{D as ae}from"./goods-BVwS8oFG.js";import{F as Y}from"./enums-DlE-aiss.js";import{R as ct}from"./RemovedShelves-BUe_2pOD.js";import"./shop-CeqcS6K2.js";import"./OrderGoodsBox-5PjaZvBT.js";import"./mall-DLd1UK-E.js";import"./MCOIN-Bodfn-v1.js";import"./OrderGoods-C5ohlmD4.js";import"./ShopMaskTips-ClYuWX9C.js";import"./ApproveButton-BB8qyFWg.js";import"./BackIcon-CDrGaEPo.js";const mt=""+new URL("../images/prize-redeem-BgHjSMZp.png",import.meta.url).href,vt=""+new URL("../images/gongxi-Cs9STMoQ.png",import.meta.url).href,J=t=>($e("data-v-1a85a397"),t=t(),ke(),t),pt={class:"bg-sale flex-center-bw p-2.5 mb-4"},ft={key:0,class:"text-[#FB1A18] text-3xl font-semibold mb-1"},ht=J(()=>e("span",{class:"text-sm font-normal"},"Mcoin",-1)),gt={key:1,class:"text-[#FB1A18] text-3xl mb-1"},yt={class:"text-xs"},xt=J(()=>e("span",{class:"text-sm font-normal"},"Symbol",-1)),bt={class:"flex items-center"},wt={class:"text-[#D7894E] text-xs line-through mr-2.5"},$t={key:0,class:"bg-[#FB1A18] text-white h-4 text-xs flex items-center px-1 rounded"},kt={key:2,class:"text-[#FB1A18] text-base mb-1"},St={class:"text-xs font-normal"},_t=J(()=>e("span",{class:"text-sm font-normal"},"Symbol",-1)),Tt={class:"mb-1 text-lg text-white"},At=J(()=>e("span",{class:"text-[#C96C26] mr-1"},":",-1)),Ct=J(()=>e("span",{class:"text-[#C96C26] mr-1"},":",-1)),It=z({props:{goods:null,systemTime:null,cutdownTimestamp:null,startTime:null,totalAmount:null},emits:["changeTime"],setup(t,{expose:S,emit:v}){const i=t,y=c(null),h=()=>{y.value.pause()},w=()=>{y.value.reset()},p=async()=>{v("changeTime")};return O(async()=>{}),S({pause:h,reset:w}),(u,m)=>{const s=L("van-count-down");return o(),n("div",pt,[e("div",null,[t.goods.payType!==d(j).STORE_CARD?(o(),n("div",ft,[e("span",null,l(i.goods.price),1),ht])):f("",!0),t.goods.payType===d(j).STORE_CARD?(o(),n("div",gt,[e("span",yt,l(u.$t("flashSale.storePrice"))+"：",1),e("span",null,l(i.goods.cardPrice),1),xt])):f("",!0),e("div",bt,[e("div",wt,l(i.goods.totalPrice)+" Mcoin ",1),t.goods.purchaseLimit!==t.totalAmount&&t.totalAmount?(o(),n("div",$t,l(u.$t("flashSale.purchaseLimit",{number:t.goods.purchaseLimit})),1)):f("",!0)]),t.goods.payType===d(j).MIX?(o(),n("div",kt,[e("span",St,l(u.$t("flashSale.storePrice"))+"：",1),e("span",null,l(i.goods.cardPrice),1),_t])):f("",!0)]),e("div",null,[e("div",Tt,l(u.$t("common.one sale actives")),1),_(s,{class:"text-[#000] flex items-center",ref:(a,g)=>{g.countDown=a,y.value=a},time:i.cutdownTimestamp,format:"DD 天 HH 时 mm 分 ss 秒",onFinish:p},{default:I(a=>[e("div",{class:B(["min-w-[32px] text-center text-lg rounded-lg p-1 mr-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},l(a.hours+a.days*24<10?`0${a.hours+a.days*24}`:a.hours+a.days*24),3),At,e("div",{class:B(["w-[32px] text-center text-lg rounded-lg p-1 mr-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},l(a.minutes<10?`0${a.minutes}`:a.minutes),3),Ct,e("div",{class:B(["w-[32px] text-center text-lg rounded-lg p-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},l(a.seconds<10?`0${a.seconds}`:a.seconds),3)]),_:1},8,["time"])])])}}}),Ft=Z(It,[["__scopeId","data-v-1a85a397"]]),Et={class:"font-semibold text-[#000] bg-white rounded-lg text-sm mt-1 text-left flex items-center justify-between overflow-hidden"},Rt={class:"w-full bg-[#F9F5F7] rounded-lg text-[#333] px-2 text-xs font-normal"},Bt={class:"text-[#FA1A17]"},Lt=z({props:{lucklyInfo:{type:Object,default:()=>({amount:null,sn:null,time:null})},totalAmount:{type:Number,default:0}},setup(t){const S=t,v=c([]),i=u=>{v.value=u},[y,h]=ie(!1),w=c(null),p=u=>{w.value.contains(u.target)||h(!1)};return O(()=>{document.addEventListener("click",p)}),qe(()=>{document.removeEventListener("click",p)}),(u,m)=>{const s=L("van-collapse-item"),a=L("van-collapse");return S.lucklyInfo.amount>0?(o(),n("div",{key:0,class:"pt-1 relative",onClick:m[7]||(m[7]=g=>d(h)(!1))},[e("div",Et,[_(a,{modelValue:v.value,"onUpdate:modelValue":m[5]||(m[5]=g=>v.value=g),onChange:i,class:"w-full rounded-xl",border:!1},{default:I(()=>[_(s,{title:u.$t("flashSale.openInfo"),name:"1","right-icon":"play",border:!1},{"right-icon":I(()=>[e("div",{class:B(v.value.length===0?"triangle-down":"triangle-up")},null,2)]),default:I(()=>[e("div",Rt,[e("div",{class:"flex justify-between py-1.5 pt-2.5 border-solid border-[#DEDEDE]/20 border-b",onClick:m[0]||(m[0]=g=>d(X)(t.lucklyInfo.amount))},[R(l(u.$t("flashSale.circulation"))+": ",1),e("div",null,l(t.lucklyInfo.amount),1)]),e("div",{class:"flex justify-between py-1.5 border-solid border-[#DEDEDE]/20 border-b",onClick:m[1]||(m[1]=g=>d(X)(t.lucklyInfo.time))},[R(l(u.$t("flashSale.timestamp"))+": ",1),e("div",null,l(t.lucklyInfo.time),1)]),e("div",{class:"flex justify-between py-1.5 border-solid border-[#DEDEDE]/20 border-b",onClick:m[2]||(m[2]=g=>d(X)(t.lucklyInfo.totalAmount))},[R(l(u.$t("flashSale.totalAmount"))+" ",1),e("div",null,l(t.totalAmount),1)]),e("div",{class:"flex justify-between py-1 font-semibold pb-2",onClick:m[3]||(m[3]=g=>d(X)(t.lucklyInfo.totalAmount))},[R(l(u.$t("flashSale.lucklySn"))+" ",1),e("div",Bt,l(t.lucklyInfo.sn),1)])]),e("div",{class:"w-full bg-white text-[#777] text-xs font-normal mt-4",onClick:m[4]||(m[4]=ue(()=>{},["stop"]))},l(u.$t("flashSale.openExplanation")),1)]),_:1},8,["title"])]),_:1},8,["modelValue"])]),d(y)?(o(),n("div",{key:0,class:"w-[80%] absolute bg-default/80 text-white right-2 top-8 p-2 rounded text-xs text-justify",onClick:m[6]||(m[6]=ue(()=>{},["stop"]))},l(u.$t("flashSale.openExplanation")),1)):f("",!0)])):f("",!0)}}}),Dt=Z(Lt,[["__scopeId","data-v-5d91f7ee"]]),Pt={class:"h-full pb-4 mt-4"},Nt={class:"flex justify-between text-sm text-[#2E2008] opacity-60 px-4"},Ut={class:"bg-white rounded-lg mt-2.5 text-sm text-[#2E2008] px-4 max-h-[70vh] overflow-y-auto"},jt={class:"flex-1 text-left"},zt={class:"flex-1"},Ot={class:"flex justify-end flex-1"},Vt=z({props:{show:{type:Boolean,default:!1},list:{default:[]},countList:{default:[]},luckUser:null,goodsId:null,totalAmount:null},emits:["close"],setup(t,{emit:S}){const v=t,{orderRandomRecords:i}=Ae(),y=Ge({lucklyInfo:{amount:null,sn:null,time:null}}),h=()=>{S("close")},w=G(()=>{const u=v.list.map((s,a)=>({address:s,count:+v.countList[a],number:_e(+a)||[]})),m=v.list.findIndex(s=>te(s)===te(v.luckUser));if(m!==-1){let s=u.splice(m,1)[0];u.unshift(s)}return u}),p=async()=>{const u=await i(v.goodsId);u.success&&(y.lucklyInfo=u.result)};return O(()=>{p()}),(u,m)=>(o(),b(at,{show:v.show,onClose:h,title:u.$t("flashSale.ParticipationRecord")},{default:I(()=>[_(Dt,{"luckly-info":d(y).lucklyInfo,totalAmount:t.totalAmount},null,8,["luckly-info","totalAmount"]),e("div",Pt,[e("div",Nt,[e("div",null,l(u.$t("flashSale.wallet-address")),1),e("div",null,l(u.$t("flashSale.Buy copies")),1),e("div",null,l(u.$t("flashSale.Lottery number")),1)]),e("div",Ut,[(o(!0),n(de,null,re(d(w),(s,a)=>(o(),n("div",{class:B(["flex justify-between py-4 border-solid",{"border-[#7F169A]/20 border-b":a<d(w).length-1}]),key:a},[e("div",jt,l(d(Te)(s.address,"...",3,4)),1),e("div",zt,l(s.count),1),e("div",Ot,[(o(!0),n(de,null,re(s.number,(g,F)=>(o(),n("div",{class:B(["bg-[#D8D8D8] font-semibold text-lg text-white leading-5 rounded-sm w-4 text-center",{"mr-0.5":F!==s.number.lenght-1,"bg-[#FA1A17]":a==0}]),key:F},l(g),3))),128))])],2))),128))])])]),_:1},8,["show","title"]))}}),Ht=Z(Vt,[["__scopeId","data-v-2250f780"]]),Mt=""+new URL("../images/shop-ChcGIVIz.svg",import.meta.url).href,qt=""+new URL("../images/shop-KzfS1F29.svg",import.meta.url).href,Gt=""+new URL("../images/sale-people-B9j4520v.svg",import.meta.url).href,Ce=t=>($e("data-v-7ff404de"),t=t(),ke(),t),Zt={class:"fixed bottom-0 left-0 w-full px-2.5 safe-bottom sm:bottom-[0%] lg:bottom-[0%] z-20 flex-center"},Jt={class:"w-full h-14 flex items-center justify-between pb-0.5 pr-2 bg-white rounded-full sm:w-[355px] shadow-2"},Kt={class:"flex flex-1 justify-evenly"},Qt={key:0,src:Mt,class:"w-5 h-5 m-auto mb-0.5"},Wt={key:1,src:qt,class:"w-5 h-5 m-auto mb-0.5"},Xt=Ce(()=>e("img",{src:je,class:"w-5 h-5 m-auto mb-0.5"},null,-1)),Yt={key:1,class:"text-xs text-center"},es={class:"text-[#e2e2e2]"},ts={key:0,class:"flex"},ss={class:"flex items-center"},os=Ce(()=>e("img",{src:Gt,class:"h-6 m-auto mr-1 w-11"},null,-1)),ls={key:0,class:"text-center text-white"},ns={class:"text-sm leading-3"},as={class:"text-lg font-medium leading-5"},is=R(" Mcoin "),us={class:"text-[0.675rem]"},rs={class:"mr-0.5"},ds={key:1,class:"py-2.5 ml-2 text-[#999] text-base"},cs={key:2,class:"py-2.5 ml-2 text-[#999] text-base"},ms=z({props:{isFollow:{type:Boolean},goodsId:null,isSale:{type:Boolean},isSaleEnd:{type:Boolean},isSaleStart:{type:Boolean},isSaleOver:{type:Boolean},goods:null,systemTime:null,currentAmount:null,totalAmount:null,payType:null,boutiqueFlag:{type:Boolean}},emits:["handeToShop","handleConnect","handleBuy","handleAddCart","toPurchase"],setup(t,{expose:S,emit:v}){const i=t,{t:y}=Se(),h=c(!1);O(()=>{h.value=i.isFollow,i.isSale});const w=c(!1),p=G(()=>[{text:y("piggy.normalBuy"),id:1}]),u=s=>{v("handleBuy",`payType=${s.id}`)},m=()=>{it({goodsIds:[i.goodsId],type:h.value?2:1,collectType:i.isSale?2:1}).then(s=>{s.success&&(h.value?ee(y("common.cancel collect")):ee(y("common.collect success")),h.value=!h.value)})};return S({}),(s,a)=>{const g=L("van-icon"),F=L("VanButton"),K=L("van-popover");return o(),n("div",Zt,[e("div",Jt,[e("div",Kt,[e("div",{class:"text-xs text-center",onClick:a[0]||(a[0]=()=>v("handeToShop"))},[t.isSale?(o(),n("img",Wt)):(o(),n("img",Qt)),e("div",null,l(s.$t("mall.shop")),1)]),e("div",{class:"text-xs text-center",onClick:a[1]||(a[1]=()=>v("handleConnect"))},[Xt,e("div",null,l(s.$t("common.service")),1)]),t.isSale?(o(),n("div",Yt,[_(g,{name:"star",color:"#e2e2e2",size:20}),e("div",es,l(s.$t("common.collect")),1)])):(o(),n("div",{key:0,class:"text-xs text-center",onClick:m},[h.value?(o(),b(g,{key:0,name:"star",color:"#ffd21e",size:20})):(o(),b(g,{key:1,name:"star-o",color:"#2E2008",size:20})),e("div",null,l(s.$t("common.collect")),1)]))]),t.isSale?(o(),b(F,{key:1,class:B(["min-w-[60px] rounded-3xl px-2.5",i.isSaleEnd||i.isSaleStart||i.currentAmount>=i.totalAmount?"bg-[#D9D9D9]":"bg-[#FB1A18]"]),disabled:i.isSaleStart||i.isSaleEnd||i.currentAmount>=i.totalAmount,onClick:a[5]||(a[5]=()=>{v("toPurchase")})},{default:I(()=>[e("div",ss,[os,!i.isSaleEnd&&!i.isSaleStart&&i.currentAmount<i.totalAmount?(o(),n("div",ls,[e("div",ns,[e("span",as,l(t.goods.price),1),is]),e("div",us,[e("span",rs,l(s.$t("refund.TotalNum",{num:t.totalAmount})),1),e("span",null,l(s.$t("flashSale.Already snatched"))+l(i.currentAmount)+l(s.$t("common.pieces")),1)])])):i.isSaleStart?(o(),n("div",ds,l(s.$t("common.no start")),1)):(o(),n("div",cs,l(i.currentAmount>=i.totalAmount?s.$t("flashSale.Alreadygrabbed"):s.$t("flashSale.gooderror")),1))])]),_:1},8,["disabled","class"])):(o(),n("div",ts,[_(F,{class:"px-3 text-sm text-white linear-btn rounded-l-3xl",onClick:a[2]||(a[2]=ue(Q=>v("handleAddCart"),["stop"]))},{default:I(()=>[R(l(s.$t("common.addCart")),1)]),_:1}),t.payType!==3||t.boutiqueFlag?(o(),b(F,{key:0,class:"px-5 text-sm text-white bg-primary rounded-r-3xl",onClick:a[3]||(a[3]=()=>v("handleBuy",t.payType===2?"":"payType=1"))},{default:I(()=>[R(l(t.payType===2?s.$t("piggy.cardBuy"):s.$t("common.buy")),1)]),_:1})):(o(),b(K,{key:1,placement:"top",show:w.value,"onUpdate:show":a[4]||(a[4]=Q=>w.value=Q),actions:d(p),onSelect:u},{reference:I(()=>[_(F,{class:"px-5 text-sm text-white bg-primary rounded-r-3xl"},{default:I(()=>[R(l(s.$t("common.buy")),1)]),_:1})]),_:1},8,["show","actions"]))]))])])}}}),vs=Z(ms,[["__scopeId","data-v-7ff404de"]]),ps=""+new URL("../images/online-V-h6qWLs.svg",import.meta.url).href,fs=""+new URL("../images/online-BHRPZ7Z2.svg",import.meta.url).href,hs=""+new URL("../images/outline-C86leE1s.svg",import.meta.url).href,gs=""+new URL("../images/inline-NC3d5N9J.svg",import.meta.url).href,ys={class:"rounded-b-lg px-2.5 pt-2.5 pb-3 bg-white box-shadow"},xs={key:0},bs={class:"text-sm font-semibold break-all"},ws={class:"mr-1.5"},$s={key:0,class:"mt-1.5 text-xs leading-normal text-black-400 line-clamp-2"},ks={class:"flex items-center mt-2"},Ss={key:1,class:"flex items-center"},_s={key:2,class:"gap-2 ml-auto mr-4 text-right"},Ts={key:1},As={class:"mb-2 font-semibold break-all"},Cs={class:"flex items-center justify-between mt-3"},Is={key:0,class:"flex-start"},Fs={key:0,src:ps,class:"w-6 mr-2"},Es={key:1,src:fs,class:"w-6 mr-2"},Rs={key:1,class:"flex-start"},Bs={key:0,src:hs,class:"w-6 mr-2"},Ls={key:1,src:gs,class:"w-6 mr-2"},Ds={class:"mt-1 mr-4 text-xs flex justify-start items-center text-black/50"},Ps={key:0},Ns={key:1},Us={key:2},js={key:3},zs={class:"ml-auto"},Os={key:0},Vs={key:1},Hs=z({props:{tokenRate:null,stores:null,goods:null,isSale:{type:Boolean,default:!1},card:null,shippingTemplate:{default:()=>({})},discountRatio:null},setup(t){const S=t,{tradeContributeSelfRate:v}=Xe(),i=c(0),y=G(()=>{if(Ze.isNil(S.discountRatio))return"0";const p=+new ce(new ce(S.discountRatio||0).div(100)).times(S.goods.price).times(i.value);return we(p,2)}),h=async()=>{i.value=await v()},w=async()=>{h()};return O(()=>{w()}),(p,u)=>(o(),n("div",ys,[t.isSale?(o(),n("div",Ts,[e("div",As,l(t.goods.title||""),1),_(dt,{ratio:t.goods.discountRate||20,class:"h-6"},null,8,["ratio"]),e("div",Cs,[t.goods.deliveryType===1||t.goods.shippingMethod===1?(o(),n("div",Is,[t.isSale?(o(),n("img",Es)):(o(),n("img",Fs)),e("div",null,l(p.$t("common.send")),1)])):(o(),n("div",Rs,[t.isSale?(o(),n("img",Ls)):(o(),n("img",Bs)),e("div",null,l(p.$t("common.offline")+p.$t("common.Payment")),1)]))])])):(o(),n("div",xs,[e("div",bs,[t.goods.type?(o(),b(ut,{key:0,type:t.goods.type,class:"inline-block align-text-top mr-1.5"},null,8,["type"])):f("",!0),e("span",ws,l(t.goods.goodsName||""),1),_(ze,{class:"align-text-bottom",deliveryType:t.goods.deliveryType},null,8,["deliveryType"])]),t.goods.goodsDesc?(o(),n("div",$s,l(t.goods.goodsDesc),1)):f("",!0),e("div",ks,[t.goods.payType!==d(j).STORE_CARD?(o(),b(rt,{key:0,style:{"margin-right":"0"},price:t.goods.price},null,8,["price"])):f("",!0),t.goods.payType!==d(j).STORE_CARD&&t.goods.deliveryType===d(ae).online?(o(),n("div",Ss)):f("",!0),t.goods.deliveryType===d(ae).online?(o(),n("div",_s,[t.goods.payType!==d(j).STORE_CARD?(o(),b(Oe,{key:0,class:"inline-block",showType:"balance",goods:t.goods},null,8,["goods"])):f("",!0)])):f("",!0)])])),e("div",Ds,[e("span",null,[t.shippingTemplate.type===d(Y).FREE&&t.shippingTemplate.threshold?(o(),n("span",Ps,l(p.$t("shop.shippingTemplate.actualPayment"))+l(d(we)(t.shippingTemplate.threshold))+"MC"+l(p.$t("shop.shippingTemplate.freeShipping")),1)):f("",!0),t.shippingTemplate.type===d(Y).FREE&&t.shippingTemplate.threshold===0?(o(),n("span",Ns,l(p.$t("shop.shippingTemplate.freeShipping")),1)):f("",!0),t.shippingTemplate.type===d(Y).NO_SHIPPING?(o(),n("span",Us,l(p.$t("shop.shippingTemplate.noShipping")),1)):f("",!0),t.shippingTemplate.type===d(Y).CASH_ON_DELIVERY?(o(),n("span",js,l(p.$t("shop.shippingTemplate.cashOnDelivery")),1)):f("",!0)]),e("span",zs,[t.goods.deliveryType===d(ae).online||!t.discountRatio?(o(),n("span",Os,l(p.$t("goods.confirming receipt")),1)):(o(),n("span",Vs,l(p.$t("goods.order completed get integral",{num:d(y)})),1))])])]))}}),Ms=Z(Hs,[["__scopeId","data-v-197d209d"]]),qs={class:"relative w-full h-full bg-white safe-bottom-page"},Gs={key:0},Zs={class:"relative"},Js={key:0,class:"absolute top-0 left-0 w-full h-full z-40 bg-[#000000]/70"},Ks={class:"absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-50%]"},Qs=e("img",{src:mt,class:"h-auto w-52",alt:""},null,-1),Ws={class:"flex items-center whitespace-nowrap justify-center mb-0.5"},Xs={class:"text-xs"},Ys={key:0,class:"flex items-center whitespace-nowrap"},eo={key:0,class:"text-[0.675rem] text-[#999999]"},to={class:"text-xs text-[#999] text-center underline mt-0.5"},so=e("img",{class:"w-8 h-8",src:Me},null,-1),oo=[so],lo={class:"px-2.5"},no={key:3,class:"fixed left-2.5 top-[13.2rem] bg-white/80 text-default rounded-2xl px-2 py-1.5 text-xs font-semibold z-50"},ao={class:"flex items-center"},io=e("img",{src:vt,class:"w-3 h-3 mr-1.5"},null,-1),Eo=z({setup(t){const{checkLoginAuth:S}=Ye(),{commodities:v,orderList:i}=Ae(),y=c(!1),{loadingToggle:h}=tt(),{t:w}=Se(),p=Je(),u=Ke(),m=et(),s=c(null),[a,g]=ie(!1),[F,K]=ie(!1);c();const Q=c(null),Ie=c(null),me=p.query.id,Fe=async()=>{const r=p.query.id,$=await st(+r);s.value=$.data},Ee=G(()=>s.value.mainImageUrls.split(",").filter(r=>r!==""&&r!==null&&r!==void 0&&!Number.isNaN(r))),Re=async()=>{g(!1),await ge()},V=c(null),H=c(null),ve=async()=>{V.value=k(s.value.startTime)*1e3-k(T.value)*1e3>0,H.value=k(s.value.endTime)*1e3-k(T.value)*1e3<=0,be()},Be=async()=>{if(console.log(V.value,H.value,A.value,x.value,"currentAmount.value, totalAmount.value"),A.value>=x.value&&x.value>0){E.value=0;return}if(V.value&&H.value&&A.value<x.value&&x.value>0){E.value=0;return}await Pe(),k(s.value.startTime)*1e3-k(T.value)*1e3<=0&&k(s.value.endTime)*1e3-k(T.value)*1e3&&(D.value=0,E.value=k(s.value.endTime)*1e3-k(T.value)*1e3),await ve()},Le=()=>{u.push(`submitOrder?id=${s.value.id}`)},De=async()=>{if(s.value.stock===0&&s.value.goodsTypes!=2){ee(w("order.Insufficient stock"));return}h(!0);const r=await ot(s.value.id);h(!1),r.success&&(ee(w("cart.addTips")),m.getCartCount())},pe=r=>{u.push(r)},E=c(0),se=c(0),D=c(0),T=c(""),Pe=async()=>{const{data:r}=await lt();T.value=r||null,se.value=k(s.value.endTime)*1e3-k(T.value)*1e3,D.value=k(s.value.startTime)*1e3-k(T.value)*1e3,D.value>0&&(E.value=D.value),D.value<=0&&se.value>0&&(E.value=se.value)},A=c(0),x=c(0),fe=c(0),he=c(0),M=c(null),oe=c(""),ge=async()=>{const r=await v(s.value.id);A.value=+r.currentAmount,x.value=+r.totalAmount,fe.value=x.value-A.value,he.value=+r.limitEach,s.value.discountRate=+ce(+r.discountRate).div(1e4).toNumber(),r.lucky!==Qe&&(M.value=s.value.luckyNickName||Te(r.lucky,"...",4,2)),r.status===20&&(oe.value=nt(r.nextActionTime*1e3)),be()},le=c(!1),W=c(1),q=c(1e3),P=c([]),ne=c([]),ye=async()=>{if(!M.value||le.value)return;const r=await i(s.value.id+"",(W.value-1)*q.value,q.value);if(!r.success)return;const $=+r.result.total;if(P.value=W.value===1?r.result.rows:P.value.concat(r.result.rows),ne.value=W.value===1?r.result.counts:ne.value.concat(r.result.counts),P.value.length===$){le.value=!0;return}W.value+=1;const N=$-P.value.length;q.value=N>q.value?q.value:N,await ye()},xe=G(()=>{const r=P.value.findIndex(N=>te(N)===te(s.value.lucky));return _e(+r)||[]}),Ne=()=>{try{window.history.state.back?u.back():window.history.length>2?window.history.back():u.replace({path:"/flashSale"})}catch{u.push("/")}},Ue=()=>{K(!0)},be=()=>{if(A.value>=x.value&&x.value>0){E.value=0;return}if(V.value&&H.value&&A.value<x.value&&x.value>0){E.value=0;return}};return O(async()=>{S(!0)&&(h(!0),await Fe(),await ge(),ye(),ve(),h(!1))}),(r,$)=>{const N=L("VanLoading");return o(),n("div",qs,[s.value?(o(),n("div",Gs,[e("div",Zs,[A.value>=x.value&&M.value?(o(),n("div",Js,[e("div",Ks,[Qs,e("div",{class:"absolute bottom-2 left-1/2 translate-x-[-50%] whitespace-nowrap",onClick:Ue},[e("div",Ws,[e("span",Xs,l(r.$t("flashSale.Winning-number")),1),le.value?(o(),n("div",Ys,[(o(!0),n(de,null,re(d(xe),(C,U)=>(o(),n("div",{class:B(["bg-[#FA1A17] font-semibold text-lg text-white leading-5 rounded-sm w-4 text-center",{"mr-0.5":U!==d(xe).length-1}]),key:U},l(C),3))),128))])):(o(),b(N,{key:1,size:"18"}))]),oe.value?(o(),n("div",eo,l(r.$t("flashSale.Prizeredemptiondeadline"))+":"+l(oe.value),1)):f("",!0),e("div",to,l(r.$t("flashSale.check-the-details")),1)])])])):f("",!0),e("header",{class:"flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-3 py-[9px] fixed transition-all duration-200"},[e("div",{class:"flex flex-wrap items-center",onClick:Ne},oo)]),s.value.mainImageUrls?(o(),b(Ve,{key:1,imgs:d(Ee)||"",class:"mb-2.5",indicatorColor:"#FB1A18",bgColor:"#F4C5C4"},null,8,["imgs"])):f("",!0)]),_(Ft,{goods:s.value,onChangeTime:Be,ref:(C,U)=>{U.cutdown=C,Q.value=C},startTime:D.value,cutdownTimestamp:E.value,systemTime:T.value,totalAmount:x.value},null,8,["goods","startTime","cutdownTimestamp","systemTime","totalAmount"]),e("div",lo,[_(Ms,{goods:s.value,discountRatio:s.value.discountRate,class:"mb-2.5",isSale:!0},null,8,["goods","discountRatio"]),s.value.describe||s.value.detailImageUrls?(o(),b(He,{key:0,text:s.value.describe,imgs:(s.value.detailImageUrls||"").split(",")},null,8,["text","imgs"])):f("",!0),_(vs,{goodsId:s.value.id,systemTime:T.value,goods:s.value,ref:(C,U)=>{U.goodsBar=C,Ie.value=C},isFollow:y.value,onHandleBuy:Le,isSale:!0,isSaleEnd:H.value,isSaleStart:V.value,totalAmount:x.value,currentAmount:A.value,onToPurchase:$[0]||($[0]=C=>d(g)(!0)),onHandeToShop:$[1]||($[1]=C=>pe(`/category?deliveryType=1&shopId=${s.value.shopId}`)),onHandleConnect:$[2]||($[2]=C=>pe(`/shopInfo?address=${s.value.address}`)),onHandleAddCart:De},null,8,["goodsId","systemTime","goods","isFollow","isSaleEnd","isSaleStart","totalAmount","currentAmount"])])])):s.value?(o(),b(ct,{key:1,type:"good"})):f("",!0),s.value?(o(),b(We,{key:2,show:d(a),onClose:Re,goods:s.value,remaining:fe.value,limitEach:he.value},null,8,["show","goods","remaining","limitEach"])):f("",!0),A.value>=x.value&&M.value?(o(),n("div",no,[e("div",ao,[io,e("div",null,l(r.$t("flashSale.Congratulations-tips",{user:` ${M.value} `})),1)])])):f("",!0),d(me)?(o(),b(Ht,{key:4,goodsId:d(me),totalAmount:x.value,list:P.value,countList:ne.value,show:d(F),luckUser:s.value&&s.value.lucky,onClose:$[3]||($[3]=()=>d(K)(!1))},null,8,["goodsId","totalAmount","list","countList","show","luckUser"])):f("",!0)])}}});export{Eo as default};
