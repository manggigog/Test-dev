import{G as fe,_ as ge,a as he}from"./GivePointsLable-DiIMmI_A.js";import{_ as Ie,a as Q,G as ye,S as xe,b as we,c as Se,d as be}from"./ShareGoodPopup-C45e1c9R.js";import{z as E,bl as _e,y as $,D as X,G as w,H as i,O as r,J,I as n,Q as x,a4 as H,K as Ce,Z as T,by as $e,_ as Z,o as W,U as S,a3 as R,X as ee,Y as te,q as Ne,x as Te,a2 as K,r as C,E as ke,ad as De,bE as Be,P,N as Ae,T as Le,n as Fe}from"./vendor-Dr_RpJ_Y.js";import{aO as Pe,a as oe,h as Ee,Y as ae,aP as Ge,C as qe,w as Oe,a1 as Re,a0 as je}from"./index-CU2nzZe6.js";import{u as se}from"./useCityMap-gT1oK5g9.js";import{R as He}from"./RemovedShelves-CK5gRgpW.js";import{S as Me}from"./shop-CeqcS6K2.js";import{O as ze}from"./offlineGoods-DvT2Go6q.js";import{D as j}from"./goods-BVwS8oFG.js";import"./flashSale-DDyqLyYN.js";import"./avatarRing-DtI_kRg6.js";import"./shop-arrow-right-BueA_z4m.js";import"./BoutiqueLabelInLogo-6zoXLJ5H.js";import"./RatioBox-BwMA7vB_.js";import"./goods-CMFNhadQ.js";import"./ServiceIcon-Ce2ytRnc.js";import"./convertToImage-Cfv7lGZo.js";import"./upload-GBdaxjFw.js";import"./active_empty-ofPcrP74.js";import"./HelpPop-DStj4MIe.js";import"./MCOIN-BOqZVkND.js";import"./enums-DlE-aiss.js";import"./logo-JjZ15zkW.js";import"./BackIcon-CDrGaEPo.js";const Ue={class:"relative mb-3 w-full flex justify-between items-center"},Ve={class:"text-base font-semibold text-b1 text-left"},Ye={class:"text-xs text-b3 font-normal flex justify-center items-center"},Je=n("img",{src:Q,class:"w-3 h-3",alt:""},null,-1),Ke={key:1,class:"text-base font-semibold text-b1 text-left"},Qe=E({props:{goodsId:null},emits:["handleTo"],setup(s,{emit:p}){const m=s,c=_e({commentList:[],total:0}),d=$(()=>Number(c.total)>100?100:c.total),b=async()=>{const l=await Pe({goodsId:m.goodsId,page:1,size:1,commentStatus:1,sortBy:"desc|comment_time"});l.success&&(c.commentList=l.data.records||[],c.total=l.data.total)},k=$(()=>{if(c.commentList&&c.commentList.length>0){const l=[];for(let u=0;u<c.commentList.length;u++)c.commentList[u].commentPics&&c.commentList[u].commentPics.length>0&&l.push(...c.commentList[u].commentPics.split(","));return l}return[]}),g=l=>{const u=k.value.findIndex(h=>h===l);$e({images:k.value,closeable:!0,showIndex:!0,startPosition:u})};return X(()=>m.goodsId,()=>{b()},{immediate:!0}),(l,u)=>(i(),w("div",{class:"px-4 py-3 mt-2 bg-white text-base",onClick:u[0]||(u[0]=h=>p("handleTo",`/offline-evaluate-home?goodsId=${s.goodsId}`))},[r(c).commentList.length>0?(i(),w(J,{key:0},[n("div",Ue,[n("div",Ve,x(l.$t("evaluate.Buyer Reviews"))+"（"+x(r(d))+"） ",1),n("div",Ye,[H(x(l.$t("common.all"))+" ",1),Je])]),(i(!0),w(J,null,Ce(r(c).commentList,(h,D)=>(i(),T(Ie,{onImgPre:g,key:h.id,data:h,isOffline:""},null,8,["data"]))),128))],64)):(i(),w("div",Ke,x(l.$t("evaluate.Buyer Reviews none")),1))]))}}),Xe=s=>(ee("data-v-39d4dbcd"),s=s(),te(),s),Ze={class:"px-4 py-3 mt-2 bg-white text-base"},We={class:"relative mb-3 w-full flex justify-start items-center"},et={class:"text-base text-b1 font-semibold text-left"},tt=["onClick"],ot=Xe(()=>n("img",{src:Q,class:"w-3 h-3",alt:""},null,-1)),at={key:0,class:"w-full h-full map-texture-bg flex items-center justify-between p-2"},st={class:"text-xs text-[#2E2008] leading-[18px] font-semibold"},rt={class:"mt-1 text-xs text-[#585654] leading-[18px] line-clamp-1"},lt={key:0,class:"mr-1"},nt=["src"],dt={class:"mt-[1px] text-xs text-[#585654] leading-[18px]"},it=E({props:{store:null,goods:null,storeTitle:null},emits:["handleTo","toStorefrontDetail"],setup(s,{emit:p}){const m=s,c=W(),{cityMapStore:d}=oe(),{distanceFormat:b}=se(),k=()=>{const g=c.path.replace("offlineGoodsDetail","availableStores");p("handleTo",`${g}?goodsId=${m.goods.goodsId}`+(m.store.storeId?`&storeId=${m.store.storeId}`:""))};return(g,l)=>{var u,h,D,_,t,v,I;return i(),w("div",Ze,[n("div",We,[n("div",et,x(s.storeTitle),1),+s.store.storeCount>0?(i(),w("div",{key:0,class:"absolute right-0 top-0 text-xs leading-[18px] text-b3 flex justify-center items-center",onClick:R(k,["stop"])},[H(x(g.$t("city.Available at xx stores",{val:s.store.storeCount}))+" ",1),ot],8,tt)):S("",!0)]),n("div",{class:"map-texture w-full h-fit rounded-lg overflow-hidden mt-3",onClick:l[1]||(l[1]=R(G=>p("toStorefrontDetail"),["stop"]))},[(u=s.store)!=null&&u.storeAddress?(i(),w("div",at,[n("div",null,[n("p",st,x((h=s.store)==null?void 0:h.storeName),1),n("div",rt,[(D=s.store)!=null&&D.distance&&((_=r(d).locationCoords)!=null&&_.lat)&&((t=r(d).locationCoords)!=null&&t.lng)?(i(),w("span",lt,x(r(b)(((v=s.store)==null?void 0:v.distance)||0,g.$t("city.straight line distance from you"))),1)):S("",!0),H(x((I=s.store)==null?void 0:I.storeAddress),1)])]),n("div",{class:"shrink-0 flex flex-col items-center",onClick:l[0]||(l[0]=R(G=>{var L;return r(Ee)((L=s.store)==null?void 0:L.storeAddress)},["stop"]))},[n("img",{class:"w-4 h-4",src:r(ae)("cityMap/copy.svg"),alt:""},null,8,nt),n("div",dt,x(g.$t("common.copy")),1)])])):S("",!0)])])}}}),ct=Z(it,[["__scopeId","data-v-39d4dbcd"]]),re=s=>(ee("data-v-329ed170"),s=s(),te(),s),ut={class:"relative w-full h-full !bg-[#F6F6F5] detail-page font-Puhui detail__wrap"},mt={key:0},vt=re(()=>n("img",{class:"w-8 h-8",src:he},null,-1)),pt=[vt],ft=re(()=>n("img",{class:"w-8 h-8",src:be},null,-1)),gt=[ft],ht={class:"pb-[calc(76px+8px-12px)] -translate-y-3 bg-[#F6F6F5]"},It=E({name:"GoodsDetail"});function yt(s){const p=W(),m=Ne(),{orderGoodsStore:c,cityMapStore:d}=oe(),{loadingToggle:b}=Oe(),{getUserLocation:k}=se(),{t:g}=Te(),[l,u]=K(!1),[h,D]=K(!1),_=$(()=>{var o;return(o=p.query)!=null&&o.child?document.querySelector(".detail-page"):document.getElementById("fm-page")}),t=C(null),v=C(null),I=C({}),G=$(()=>y.value?g("city.Current store"):g("city.Nearest store")),L=$(()=>{var o;return y.value==((o=t.value)==null?void 0:o.recentStoreId)}),le=C(!1),q=C(p.query.goodsId),y=$(()=>p.query.storeId),ne=$(()=>window.location.origin+`/#/offlineGoodsDetail?goodsId=${q.value}`+(y.value?`&storeId=${y.value}`:"")),M=async()=>{var f,N,V,Y;const o=q.value;if(o==null||o==="")return;let a={id:o,longitude:((f=d.locationCoords)==null?void 0:f.lng)||((N=d.currentActiveCity)==null?void 0:N.areaLongitude),latitude:((V=d.locationCoords)==null?void 0:V.lat)||((Y=d.currentActiveCity)==null?void 0:Y.areaLatitude)};y.value&&(a.storeId=y.value);const e=await Re(a);if(!e.success||e.data.deleteFlag){D(!0);return}t.value=e.data,t.value.icons=t.value.goodsIcons,t.value.type=t.value.goodsType,t.value.deliveryType=j.offeline,t.value.price=t.value.goodsPrice,!y.value||L.value?I.value={storeId:e.data.recentStoreId,storeName:e.data.recentStoreName,storeAddress:e.data.recentStoreAddress,areaExtName1:e.data.recentAreaExtName1,areaExtName2:e.data.recentAreaExtName2,areaExtName3:e.data.recentAreaExtName3,areaId1:e.data.recentAreaId1,areaId2:e.data.recentAreaId2,areaId3:e.data.recentAreaId3,areaName1:e.data.recentAreaName1,areaName2:e.data.recentAreaName2,areaName3:e.data.recentAreaName3,areaPath:e.data.recentAreaPath,distance:e.data.recentDistance,storeCount:e.data.storeCount,storeBrandId:e.data.storeBrandId,storeBrandName:e.data.storeBrandName,storeBrandIcon:e.data.storeBrandIcon}:I.value={storeId:e.data.storeId,storeName:e.data.storeName,storeAddress:e.data.storeAddress,areaExtName1:e.data.areaExtName1,areaExtName2:e.data.areaExtName2,areaExtName3:e.data.areaExtName3,areaId1:e.data.areaId1,areaId2:e.data.areaId2,areaId3:e.data.areaId3,areaName1:e.data.areaName1,areaName2:e.data.areaName2,areaName3:e.data.areaName3,areaPath:e.data.areaPath,distance:e.data.distance,storeCount:e.data.storeCount,storeBrandId:e.data.storeBrandId,storeBrandName:e.data.storeBrandName,storeBrandIcon:e.data.storeBrandIcon}},z=async()=>{var e;if(!((e=t.value)!=null&&e.shopId))return;const{success:o,data:a}=await je(t.value.shopId);o&&(v.value=a)},B=C(null),A=o=>{m.push(o)},de=()=>{var e;const o=p.path.replace("offlineGoodsDetail","storefront"),a={storeId:y.value||((e=I.value)==null?void 0:e.storeId),child:"1"};m.push({path:o,query:a})},ie=()=>{Le({message:g("common.Saved successfully"),icon:ae("toast-success.svg"),duration:3e3})},ce=()=>{try{window.history.state.back?m.back():window.history.length>2?window.history.back():m.replace({path:"/mall"})}catch{m.push("/")}},ue=()=>{var a,e;c.changeOfflineInfo({goods:t.value,shop:v.value});let o=`/offlineSubmit?key=${q.value}&orderType=${ze.GOODS}`;(y.value||(a=I.value)!=null&&a.storeId)&&(o+=`&storeId=${y.value||((e=I.value)==null?void 0:e.storeId)}`),A(o)},U=C(0);let F=C(!0);const O=Be(()=>{U.value=_.value.scrollY||_.value.scrollTop,U.value<100?(F.value=!1,B.value&&B.value.resumeSwiper()):(F.value=!0,B.value&&B.value.pauseSwiper())},100),me=()=>{_.value.addEventListener("scroll",O),O()},ve=async()=>{var o,a;if(d.availableStore){let e={goodsId:p.query.goodsId,storeId:(o=d.availableStore)==null?void 0:o.storeId};(a=p.query)!=null&&a.child&&(e.child="1"),d.setSelectedAvailableStore(null),m.replace({path:p.path,query:e});const f=setInterval(async()=>{e.storeId==p.query.storeId&&(clearInterval(f),b(!0),await M(),await z(),b(!1))},100);return}b(!0),await M(),await z(),b(!1)},pe=$(()=>{var o,a,e;return{longitude:d.locationCoords.lng||((o=d.currentActiveCity)==null?void 0:o.areaLongitude)||null,latitude:d.locationCoords.lat||((a=d.currentActiveCity)==null?void 0:a.areaLatitude)||null,areaIdPreviousLastLeaf:((e=d.currentActiveCity)==null?void 0:e.areaId)||""}});return X(()=>pe.value,async(o,a)=>{o!=null&&o.areaIdPreviousLastLeaf&&(await Fe(),ve())},{immediate:!0,deep:!0}),ke(async()=>{d.currentActiveCity||await k(),me()}),De(()=>{_.value&&_.value.removeEventListener("scroll",O)}),(o,a)=>{var e;return i(),w("div",ut,[t.value&&v.value&&+t.value.goodsStatus==1&&+v.value.status!=3&&+v.value.status!=4&&+v.value.status!=0?(i(),w("div",mt,[n("header",{class:Ae(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-3 py-[9px] fixed transition-all duration-200",{"bg-white":r(F)," bg-black/0":!r(F)}])},[n("div",{class:"flex flex-wrap items-center",onClick:ce},pt),n("div",{onClick:a[0]||(a[0]=f=>r(u)(!0))},gt)],2),P(fe,{ref:(f,N)=>{N.goodsImgRef=f,B.value=f},imgs:(t.value.goodsIcons||"").split(","),goodsTypes:r(j).offeline},null,8,["imgs","goodsTypes"]),P(ye,{shops:v.value,goods:t.value,discountRatio:t.value.goodsDiscountRatio,class:"relative z-10"},null,8,["shops","goods","discountRatio"]),n("div",ht,[P(Qe,{onHandleTo:A,goodsId:t.value.goodsId},null,8,["goodsId"]),v.value.id?(i(),T(xe,{key:0,shop:v.value,onHandleTo:A},null,8,["shop"])):S("",!0),(e=I.value)!=null&&e.storeId?(i(),T(ct,{key:1,store:I.value,goods:t.value,storeTitle:r(G),onHandleTo:A,onToStorefrontDetail:de},null,8,["store","goods","storeTitle"])):S("",!0),t.value.goodsDesc||t.value.goodsPics?(i(),T(ge,{key:2,text:t.value.goodsDesc,imgs:t.value.goodsPics?t.value.goodsPics.split(","):[]},null,8,["text","imgs"])):S("",!0)]),t.value.goodsId?(i(),T(we,{key:0,goods:t.value,goodsId:t.value.goodsId,boutiqueFlag:t.value.goodsType>=r(Me).SD,isFollow:le.value,deliveryType:r(j).offeline,shop:v.value,onHandleConnect:a[1]||(a[1]=f=>{var N;return A(`/shopInfo?address=${(N=v.value)==null?void 0:N.merchant}`)}),onHandleOffline:a[2]||(a[2]=f=>ue())},null,8,["goods","goodsId","boutiqueFlag","isFollow","deliveryType","shop"])):S("",!0)])):t.value&&!r(Ge)?(i(),T(He,{key:1,type:"good"})):S("",!0),r(l)?(i(),T(Se,{key:2,show:r(l),onOnSuceess:ie,onClose:a[3]||(a[3]=f=>r(u)(!1)),goods:t.value,"code-url":r(ne)},null,8,["show","goods","code-url"])):S("",!0),P(qe,{show:r(h),title:"商品不存在",content:"商品不存在，无法购买",showConfirm:!0,showReject:!1,noClose:"",confirmText:"返回",onConfirm:a[4]||(a[4]=f=>r(m).back())},null,8,["show"])])}}const xt=E({...It,setup:yt}),Ut=Z(xt,[["__scopeId","data-v-329ed170"]]);export{Ut as default};
