import{_ as Fe,y as Ne,w as Pe,bc as Ae,r as S,z as Ye,o as $e,x as ye,bd as Ee,D as Me,E as R,F as y,G as p,H as s,O as g,N as v,bI as qe,P as a,Q as i,a2 as B,I as re,J as ge,K as Y,a0 as M,R as xe,a4 as De,$ as Se,X as Ce,Y as Oe,Z as He,bn as je,T as C,B as be,a1 as Ke,l as ze,t as We}from"./vendor-CjApaIpB.js";import{_ as Je}from"./avatarRing-DpEnkbQ2.js";import{_ as Qe}from"./credit-Chkxk9-q.js";import{_ as Xe}from"./MCOIN-BcbOHmhy.js";import{_ as Ze}from"./copy-w-7FY5xbhR.js";import{U as et}from"./UnfreezePop-NJaVbMpT.js";import{u as Ge,a6 as ke,e as tt,o as st,b as Ie,l as Z,h as nt,r as ot,d as at,R as it,C as rt}from"./index-DBW_ANsl.js";import{a as lt}from"./refund-BqZ6tLl4.js";import{a as dt}from"./useRefundStatus-BOTs0ra-.js";import{P as ct}from"./flashSale-DDyqLyYN.js";import{w as ut,c as mt,n as ft,l as Be,v as pt}from"./order-DMAXIMUy.js";import{f as Ue}from"./useOrderStatus-DMn11Py2.js";import{_ as ht,a as vt}from"./filter-C_V9W5ek.js";import{_ as xt,e as yt}from"./excel-BtFGf-Fb.js";import{a as gt}from"./category-DVpJ-7Jx.js";function bt(o,V=1){o=o.replace("#",""),o.length===3&&(o=o.split("").map(T=>T+T).join(""));const b=parseInt(o.substring(0,2),16),k=parseInt(o.substring(2,4),16),A=parseInt(o.substring(4,6),16),P=Math.min(Math.max(V,0),1);return`rgba(${b}, ${k}, ${A}, ${P})`}const Le=o=>(Oe("data-v-692c6171"),o=o(),He(),o),wt={class:"pb-2.5 pt-3.5 flex items-center"},Tt={class:"flex-1 bg-white rounded-3xl"},_t=Le(()=>s("img",{src:ht,class:"w-5 h-5"},null,-1)),kt=[_t],$t=Le(()=>s("img",{src:vt,class:"w-5 h-5"},null,-1)),Ct=[$t],Rt=Le(()=>s("img",{src:xt,class:"w-5 h-5"},null,-1)),At=[Rt],St={class:"flex flex-col h-[75vh] justify-between px-5 pb-[80px]"},Lt={class:"mt-[18px] pb-2.5 font-semibold text-base text-center"},It={class:"overflow-y-auto flex-1"},Ft={class:"text-base font-semibold"},Nt={class:"flex items-center gap-2 mt-3"},Pt={class:"pt-3 flex-start"},Et=Le(()=>s("div",{class:"mx-3"},"-",-1)),Vt={key:0,class:"pt-4"},Dt={class:"text-base font-semibold"},jt={class:"flex items-center justify-start gap-5 mt-3"},Bt={key:1},Mt={class:"text-base font-semibold mt-[16px]"},Ot={class:"flex flex-wrap items-center gap-2 gap-y-3 mt-3"},Ht={key:2,class:"pt-4"},Gt={class:"text-base font-semibold"},Ut={class:"p-4 flex justify-between gap-6 fixed bottom-0 left-0 right-0 bg-white"},Yt=Ne({props:{modelValue:null,noType:{type:Boolean},active:null},emits:["update:modelValue","onSubmit","onFilter","getList","onExport"],setup(o,{expose:V,emit:b}){const k=o,{getCurrentStoreId:A}=Ge(),{t:P}=Pe(),[T,G]=Ae(!1),q=S(!1),n=S(!1),w=S([]),j=S([]);Ye(()=>k.active,m=>{c.state=null,c.waitBuyerReceive=null,c.waitSellerReceive=null});const I=$e().format("YYYY-MM-DD"),l=$e().subtract("days",7).format("YYYY-MM-DD"),W=$e().subtract("month",1).format("YYYY-MM-DD"),ee=$e().subtract("month",3).format("YYYY-MM-DD"),we=ye(()=>[{id:1,label:P("shop.Last 7 days")},{id:2,label:P("shop.last month")},{id:3,label:P("shop.last 3 months")}]),_e=ye(()=>[{id:1,label:P("common.confirmed buyer_received")},{id:2,label:P("common.confirmed seller_received")}]),le=ye(()=>[{id:1,label:P("goods.commonOrderWaitDeal"),value:[1]},{id:2,label:P("goods.creditPendingUnfreeze"),value:[11]},{id:3,label:P("refund.Platform intervention"),value:[10]}]),J=async()=>{var m;ut({page:1,size:300,shopId:(m=await A())==null?void 0:m.id}).then(u=>{w.value=u.data.map(E=>({id:E.id,content:E.content,colorHex:E.colorHex})),q.value=!1,w.value.length>=u.total&&(n.value=!0)})},[K,z]=Ae(!1),[de,te]=Ae(!1),D=S(),r=S(),h=S(),F=S(new Date(new Date("2020/1/1").getTime())),O=S(),c=Ee({startTime:null,endTime:null,state:null,waitBuyerReceive:!1,waitSellerReceive:!1}),se=(m=!0)=>{c.endTime=null,c.startTime=null,c.state=null,c.waitBuyerReceive=null,c.waitSellerReceive=null,$.value=null,ne.value=null,D.value=null,r.value=null,h.value=null,j.value=[],m&&H()},Te=()=>{z(!1),te(!1),(!c.startTime||!c.endTime)&&(c.endTime=null,c.startTime=null)},f=m=>{D.value=new Date(ke(m)),O.value=new Date(new Date(m).getTime()),c.startTime=ke(D.value),$.value=null,z(!1),te(!0)},x=m=>{r.value=new Date(ke(m)),c.startTime=ke(D.value),c.endTime=ke(m),$.value=null,te(!1)},d=()=>{var u;return{createStartTime:c.startTime||null,createEndTime:c.endTime||null,subclassId:ne.value,orderLabelIdList:j.value,refundStatusList:h.value?(u=le.value.find(E=>E.id===h.value))==null?void 0:u.value:null,waitBuyerReceive:c.waitBuyerReceive||null,waitSellerReceive:c.waitSellerReceive||null}},H=()=>{const m=d();b("getList",m),G(!1)},U=S(null),_=()=>{b("onSubmit"),U.value.blur()},$=S(null),ce=m=>{if($.value!==m){switch(r.value=new Date(I),c.endTime=I,m){case 1:c.startTime=l,D.value=new Date(l),O.value=new Date(new Date(l).getTime()+60*1e3);break;case 2:c.startTime=W,D.value=new Date(W),O.value=new Date(new Date(W).getTime()+60*1e3);break;case 3:c.startTime=ee,D.value=new Date(ee),O.value=new Date(new Date(ee).getTime()+60*1e3);break}$.value=m}},ue=m=>{c.state===m?c.state=null:c.state=m,c.state==1?(c.waitBuyerReceive=!0,c.waitSellerReceive=!1):c.state==2?(c.waitBuyerReceive=!1,c.waitSellerReceive=!0):(c.waitBuyerReceive=!1,c.waitSellerReceive=!1)},me=S([]),ne=S(null),Q=async()=>{var u;const m=await gt({address:(u=await A())==null?void 0:u.merchant});me.value=m.data||[]},fe=ye(()=>k.active&&(k.active==2||k.active==4)),oe=()=>{var u;const m={createStartTime:c.startTime||null,createEndTime:c.endTime||null,subclassId:ne.value,orderLabelIdList:j.value,refundStatusList:h.value?(u=le.value.find(E=>E.id===h.value))==null?void 0:u.value:null,waitBuyerReceive:c.waitBuyerReceive||null,waitSellerReceive:c.waitSellerReceive||null};b("onExport",m)};return Me(()=>{Q(),J()}),V({onLoadTagList:J,handleReset:se}),(m,u)=>{const E=R("VanField"),t=R("VanButton"),pe=R("van-datetime-picker"),ae=R("van-popup"),he=R("van-icon"),ve=R("van-checkbox"),L=R("van-checkbox-group"),ie=R("van-list"),X=R("VanPopup");return p(),y(re,null,[s("div",wt,[s("div",Tt,[g(E,{ref:(e,N)=>{N.searchRef=e,U.value=e},onKeyup:qe(_,["enter"]),"model-value":o.modelValue,"onUpdate:modelValue":u[0]||(u[0]=e=>b("update:modelValue",e)),placeholder:m.$t("common.searchTips"),class:"w-[100% - 20px] text-center bg-transparent iconfont",clearable:"",enterkeyhint:"search"},{"right-icon":v(()=>[s("div",{onClick:_},kt)]),_:1},8,["onKeyup","model-value","placeholder"])]),s("div",{class:"flex-shrink-0 w-5 ml-3",onClick:u[1]||(u[1]=e=>a(G)(!0))},Ct),s("div",{class:"flex-shrink-0 w-5 ml-3",onClick:oe},At)]),g(X,{teleport:"body",show:a(T),"onUpdate:show":u[10]||(u[10]=e=>Se(T)?T.value=e:null),round:"",position:"bottom",closeable:"",style:{height:"75vh"},"close-on-click-overlay":"",onClickOverlay:u[11]||(u[11]=e=>a(G)(!1)),onClickCloseIcon:u[12]||(u[12]=e=>a(G)(!1))},{default:v(()=>[s("div",St,[s("div",Lt,i(m.$t("common.OrderScreening")),1),s("div",It,[s("div",Ft,i(m.$t("common.orderTime")),1),s("div",Nt,[(p(!0),y(re,null,ge(a(we),e=>(p(),Y(t,{class:xe(["rounded text-sm px-3 h-[35px] flex-1 text-black whitespace-nowrap border-0",$.value==e.id?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:e.id,onClick:N=>ce(e.id)},{default:v(()=>[M(i(e.label),1)]),_:2},1032,["class","onClick"]))),128))]),s("div",Pt,[s("div",{class:"rounded bg-[#F5F5F5] h-[35px] van-cell p-0 leading-[35px] flex justify-center",onClick:u[2]||(u[2]=De(e=>a(z)(!0),["stop"]))},[s("div",{class:xe({"opacity-30":!a(c).startTime})},i(a(c).startTime||m.$t("goods.selectStartTime")),3)]),g(ae,{show:a(K),"onUpdate:show":u[4]||(u[4]=e=>Se(K)?K.value=e:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:v(()=>[g(pe,{modelValue:D.value,"onUpdate:modelValue":u[3]||(u[3]=e=>D.value=e),"min-date":F.value,type:"date",title:m.$t("goods.selectStartTime"),onCancel:Te,onConfirm:f},null,8,["modelValue","min-date","title"])]),_:1},8,["show"]),Et,s("div",{class:"rounded bg-[#F5F5F5] h-[35px] van-cell p-0 leading-[35px] flex justify-center",onClick:u[5]||(u[5]=De(e=>a(z)(!0),["stop"]))},[s("div",{class:xe({"opacity-30":!a(c).endTime})},i(a(c).endTime||m.$t("goods.selectEndTime")),3)]),g(ae,{show:a(de),"onUpdate:show":u[7]||(u[7]=e=>Se(de)?de.value=e:null),position:"bottom",round:"",style:{height:"50%"},"close-on-click-overlay":!1,teleport:"body"},{default:v(()=>[g(pe,{modelValue:r.value,"onUpdate:modelValue":u[6]||(u[6]=e=>r.value=e),onConfirm:x,"min-date":O.value,onCancel:Te,type:"date",title:m.$t("goods.selectEndTime")},null,8,["modelValue","min-date","title"])]),_:1},8,["show"])]),a(fe)?(p(),y("div",Vt,[s("div",Dt,i(m.$t("common.confirmedStatus")),1),s("div",jt,[(p(!0),y(re,null,ge(a(_e),e=>(p(),Y(t,{class:xe(["rounded text-sm px-3 h-[35px] text-black min-w-min border-0",a(c).state==e.id?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:e.id,onClick:N=>ue(e.id)},{default:v(()=>[M(i(e.label),1)]),_:2},1032,["class","onClick"]))),128))])])):B("",!0),o.noType?B("",!0):(p(),y("div",Bt,[s("div",Mt,i(m.$t("common.category")),1),s("div",Ot,[(p(!0),y(re,null,ge(a(le),e=>(p(),Y(t,{class:xe(["rounded text-sm px-3 h-[35px] text-black whitespace-nowrap border-0",h.value==e.id?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:e.id,onClick:N=>h.value=e.id},{default:v(()=>[M(i(e.label),1)]),_:2},1032,["class","onClick"]))),128))])])),w.value&&w.value.length?(p(),y("div",Ht,[s("div",Gt,i(m.$t("common.tag")),1),s("div",{class:xe(["pt-[10px] pr-[10px] mt-[10px]",[a(fe)?"max-h-[150px]":"max-h-[300px]"]])},[g(ie,{loading:q.value,"onUpdate:loading":u[9]||(u[9]=e=>q.value=e),finished:n.value,onLoad:J},{default:v(()=>[g(L,{modelValue:j.value,"onUpdate:modelValue":u[8]||(u[8]=e=>j.value=e),max:5},{default:v(()=>[(p(!0),y(re,null,ge(w.value,(e,N)=>(p(),Y(ve,{name:e.id,key:N,class:"relative flex radioList"},{icon:v(Re=>[Re.checked?(p(),Y(he,{key:0,name:"success",color:"white",class:"tag-icon absolute right-[15px] border-0 top-[1px] bg-transparent",size:"30"})):B("",!0)]),default:v(()=>[s("div",{style:Ce({backgroundColor:a(bt)(e.colorHex,.12),color:e.colorHex}),class:xe(["rounded-[6px] min-h-[40px] p-[10px] text-white text-[0.875rem]",N===w.value.length-1?"":"mb-[16px]"])},i(e.content),7)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished"])],2)])):B("",!0)]),s("div",Ut,[g(t,{class:"bg-[#f5f5f5] text-default rounded-md h-[46px] flex-1 border-0",onClick:se},{default:v(()=>[M(i(m.$t("common.reset")),1)]),_:1}),g(t,{class:"rounded-md text-default h-[46px] flex-1 bg-btnOrBg border-0",onClick:H},{default:v(()=>[M(i(m.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"])],64)}}}),qt=Fe(Yt,[["__scopeId","data-v-692c6171"]]),Ve=o=>(Oe("data-v-13380470"),o=o(),He(),o),Kt={class:"bg-white rounded-lg mt-4 py-4 px-2.5"},zt={class:"flex"},Wt=Ve(()=>s("img",{class:"self-center mr-2 rounded-full w-9 h-9",src:Je},null,-1)),Jt={key:0,class:"mb-1 text-base font-medium"},Qt={class:"text-[#2E2008] text-sm opacity-60"},Xt={key:0},Zt={key:1},es={class:"ml-auto text-sm opacity-60"},ts=["onClick"],ss=["src"],ns={class:"flex flex-col flex-1"},os={class:"flex items-center gap-2 line-clamp-1"},as={class:"font-semibold line-clamp-1"},is={key:0,class:"flex-shrink-0 flex items-center text-xs text-[#34C2A9]"},rs=Ve(()=>s("img",{src:Qe,class:"w-5 h-5"},null,-1)),ls={class:"text-sm font-medium text-[#2E2008] opacity-60"},ds={class:"mt-auto text-[#2E2008] font-semibold flex items-center"},cs={key:0,src:Xe,class:"w-4 h-4 mr-1",alt:""},us={class:"text-base"},ms={class:"ml-auto text-base text-[#2E2008] opacity-60 self-end"},fs={class:"mt-6"},ps={key:0,class:"text-base font-semibold"},hs={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},vs={class:"font-medium"},xs={class:"opacity-60"},ys={class:"flex justify-between items-center mt-2.5 text-sm text-[#2E2008]"},gs={class:"font-medium whitespace-nowrap"},bs={class:"opacity-60 line-clamp-1 break-all max-w-[200px]"},ws={class:"flex justify-between items-center mt-2.5 text-sm text-[#2E2008]"},Ts={class:"font-medium whitespace-nowrap"},_s=Ve(()=>s("img",{src:Ze,class:"w-5 h-5 ml-1",alt:""},null,-1)),ks={class:"flex justify-between items-center mt-2.5 text-sm text-[#2E2008]"},$s={class:"font-medium whitespace-nowrap"},Cs={class:"opacity-60"},Rs={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},As={class:"font-medium"},Ss={class:"opacity-60"},Ls={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},Is={class:"font-medium"},Fs={class:"opacity-60"},Ns={class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},Ps={class:"font-medium"},Es={class:"opacity-60"},Vs={class:"flex justify-end mt-4"},Ds={key:0,class:"mr-auto flex align-middle leading-[44px] opacity-60 text-sm text-[red]"},js={key:3},Bs={key:0,class:"flex justify-between mt-2.5 text-sm text-[#2E2008]"},Ms={key:0,class:"text-sm leading-6 text-black"},Os={class:"text-primary"},Hs={key:1,class:"text-sm leading-6 text-black"},Gs={class:"text-primary"},Us={class:"p-2.5 pb-[150px]"},Ys={class:"relative text-center mb-2.5 text-base font-semibold"},qs={class:"flex justify-between text-sm text-[#2E2008] font-medium mb-3"},Ks=Ne({props:{order:null,creditFlag:{default:0}},emits:["resetHandler","handleTo","recompute"],setup(o,{emit:V}){const b=o,{accountStore:k,clerkStore:A}=tt(),{cancel:P}=st(),{t:T}=Pe(),{loadingToggle:G}=ot(),[q,n]=je(!1),w=Ee({buttonStyle:{"padding-left":"2rem","padding-right":"2rem"},buttonPlainStyle:{"padding-left":"3rem","padding-right":"3rem"},refundReason:"",btnLoading:!1}),j=S(!1),I=()=>{j.value=!0},l=ye(()=>{if(b.order.refundStatus===11&&b.order.platformInterventionCustomerTime){const r=new Date(b.order.systemTime).getTime();return+b.order.platformInterventionCustomerTime+24*60*60*1e3*10-r}return null}),[W,ee]=je(!1),we=S(1),_e=async()=>{if(k.isOnlyView)return C(T("order.Requires merchant account operation"));if(A.isClerk&&!A.clerkAuth)return C(T("order.Requires merchant account operation"));b.order.creditFlag?J(1):z()},le=()=>{if(k.isOnlyView)return C(T("order.Requires merchant account operation"));if(A.isClerk&&!A.clerkAuth)return C(T("order.Requires merchant account operation"));K(2)},J=r=>{if(k.isOnlyView)return C(T("order.Requires merchant account operation"));if(A.isClerk&&!A.clerkAuth)return C(T("order.Requires merchant account operation"));we.value=r,ee(!0)},K=async r=>{w.btnLoading=!0,G(!0);const h=await lt({orderId:b.order.id,type:r});G(!1),w.btnLoading=!1,h.success&&(V("resetHandler"),V("recompute"))},z=async()=>{if(k.isOnlyView)return C(T("order.Requires merchant account operation"));if(A.isClerk&&!A.clerkAuth)return C(T("order.Requires merchant account operation"));w.btnLoading=!0;try{const h=(await mt({orderIds:b.order.id+""})).data.ordIds,F=await P(h);if(!F.success||!(await ft({ordIds:h,hash:F.result.transactionHash})).success)return;V("resetHandler"),V("recompute")}catch(r){C(r.message||r)}finally{w.btnLoading=!1}},de=()=>{b.order.refundStatus===4&&b.order.status===1?V("handleTo","/orderDelivery?id="+b.order.id):V("handleTo","/merchantRefundDetail?id="+b.order.id)},te=ye(()=>{const r=Ue();return b.order.fmRefundReason?b.order.fmRefundReason[r]:""}),D=r=>{const h=new be(r.price).minus(new be(r.goodsActivityReduceAmount||0).div(r.number)).plus(new be(r.goodsAdjustChangeAmount||0).div(r.number)).toNumber();return at(h||0)};return(r,h)=>{const F=R("van-button"),O=R("van-icon"),c=R("i18n-t"),se=R("van-count-down"),Te=R("van-field"),f=R("VanButton"),x=R("van-popup");return p(),y("div",Kt,[s("div",zt,[Wt,s("div",null,[o.order.userAddress&&o.order.userAddress.address?(p(),y("div",Jt,i(a(Ie)(o.order.userAddress.address,"...",5,5)),1)):B("",!0),s("div",Qt,[o.order.status==5&&o.order.refundStatus<10?(p(),y("div",Xt,i(a(Z)(o.order.closeTime))+i(r.$t("order.close")),1)):(p(),y("div",Zt,i(o.order.refundTime)+i(r.$t("refund.Apply")),1))])]),s("div",es,i(a(dt)(o.order.refundStatus)),1)]),(p(!0),y(re,null,ge(o.order.orderGoods,d=>(p(),y("div",{class:"flex mt-6",key:d.goodsName},[s("div",{onClick:H=>V("handleTo","/sellerOrderList/detail?id="+d.goodsId)},[s("img",{class:"self-center object-cover w-20 h-20 mr-2 rounded-xl",src:(d.icons||"").split(",")[0]},null,8,ss)],8,ts),s("div",ns,[s("div",os,[s("div",as,i(d.goodsName),1),o.creditFlag?(p(),y("div",is,[rs,M(" "+i(r.$t("order.Credit Collection")),1)])):B("",!0)]),s("div",ls,i(r.$t("refund.TotalNum",{num:d.number})),1),s("div",ds,[o.order.payType!==a(ct).STORE_CARD?(p(),y("img",cs)):B("",!0),s("span",us,i(o.order.payType===2?d.cardPrice:D(d)),1),s("span",null,i(o.order.payType===2?o.order.fmStoredCard.symbol:""),1)])]),s("div",ms," x"+i(d.number),1)]))),128)),s("div",fs,[o.order.refundStatus===1?(p(),y("div",ps,i(r.$t("refund.Refundonly")),1)):B("",!0),s("div",hs,[s("div",vs,i(r.$t("order.orderNumber")),1),s("div",xs,i(o.order.id),1)]),s("div",ys,[s("div",gs,i(r.$t("refund.BuyerName")),1),s("div",bs,i(o.order.userAddress&&o.order.userAddress.userName||"-"),1)]),s("div",ws,[s("div",Ts,i(r.$t("order.create address")),1),s("div",{class:"text-b1 text-sm font-normal text-right flex items-center opacity-60",onClick:h[0]||(h[0]=d=>a(nt)(o.order.address))},[M(i(a(Ie)(o.order.address,"...",5,5))+" ",1),_s])]),s("div",ks,[s("div",$s,i(r.$t("common.payOrderTime")),1),s("div",Cs,i(a(Z)(o.order.createTime)),1)]),s("div",Rs,[s("div",As,i(r.$t("order.txHash")),1),s("div",Ss,i(a(Ie)(o.order.hash,"***",9,5)||"-"),1)]),s("div",Ls,[s("div",Is,i(r.$t("refund.RefundMoney")),1),s("div",Fs,i(o.order.totalAmount)+i(o.order.payType===2?o.order.fmStoredCard.symbol:"Mcoin"),1)]),s("div",Ns,[s("div",Ps,i(r.$t("refund.RefundReason")),1),s("div",Es,i(a(te)),1)])]),s("div",null,[s("div",Vs,[o.order.refundStatus==4&&o.order.status===1?(p(),y("div",Ds,i(r.$t("refund.shopRejectedTip")),1)):B("",!0),!a(k).isOnlyView&&(o.order.refundStatus===11||o.order.refundStatus===30&&o.order.creditFlag)?(p(),Y(F,{key:1,class:"mr-4 btn-plain whitespace-nowrap",style:Ce(a(w).buttonStyle),color:"#FEA021",plain:"",round:"",loading:a(w).btnLoading,onClick:h[1]||(h[1]=d=>o.order.creditFlag?J(2):z())},{default:v(()=>[M(i(o.order.creditFlag?r.$t("refund.Unfreeze quota"):a(T)("refund.Agree to refund")),1)]),_:1},8,["style","loading"])):B("",!0),o.order.refundStatus!==1||o.order.status===5?(p(),Y(F,{key:2,class:"btn-plain whitespace-nowrap",style:Ce(a(w).buttonPlainStyle),color:"#FEA021",plain:"",round:"",onClick:de},{default:v(()=>[M(i(r.$t("common.details")),1)]),_:1},8,["style"])):(p(),y("div",js,[a(k).isOnlyView?B("",!0):(p(),Y(F,{key:0,onClick:_e,style:Ce(a(w).buttonStyle),class:"btn-green whitespace-nowrap ml-2.5 text-white text-sm font-medium",disabled:a(w).btnLoading,"loading-text":r.$t("refund.Agreetoapply")},{default:v(()=>[M(i(r.$t("refund.Agreetoapply")),1)]),_:1},8,["style","disabled","loading-text"])),a(k).isOnlyView?B("",!0):(p(),Y(F,{key:1,onClick:le,style:Ce(a(w).buttonStyle),class:"btn-pink whitespace-nowrap ml-2.5 text-white text-sm font-medium",disabled:a(w).btnLoading,"loading-text":r.$t("refund.rejecttheapplication")},{default:v(()=>[M(i(r.$t("refund.rejecttheapplication")),1)]),_:1},8,["style","disabled","loading-text"]))]))]),o.order.refundStatus===11&&a(l)>0&&!j.value?(p(),y("div",Bs,[g(O,{name:"info-o",color:"red",size:"18px ",class:"mr-1"}),o.order.creditFlag?(p(),y("div",Ms,[g(se,{time:a(l),onFinish:I},{default:v(d=>[g(c,{keypath:"refund.shopLockRefundTip",tag:"span"},{time:v(()=>[s("span",Os,i(r.$t("refund.time",{days:d.days,hours:d.hours,minutes:d.minutes,seconds:d.seconds})),1)]),_:2},1024)]),_:1},8,["time"])])):(p(),y("div",Hs,[g(se,{time:a(l),onFinish:I},{default:v(d=>[g(c,{keypath:"refund.autoRefundTip",tag:"span"},{time:v(()=>[s("span",Gs,i(r.$t("refund.time",{days:d.days,hours:d.hours,minutes:d.minutes,seconds:d.seconds})),1)]),_:2},1024)]),_:1},8,["time"])]))])):B("",!0)]),g(x,{show:a(q),"onUpdate:show":h[5]||(h[5]=d=>Se(q)?q.value=d:null),position:"bottom",round:"",style:{"text-align":"center"}},{default:v(()=>[s("div",Us,[s("div",Ys,[M(i(r.$t("refund.rejecttheapplication"))+" ",1),s("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:h[2]||(h[2]=d=>a(n)(!1))},[g(O,{name:"cross"})])]),s("div",qs,[s("div",null,i(r.$t("refund.reasonforreturn")),1),s("div",null,i(a(te)),1)]),g(Te,{modelValue:a(w).refundReason,"onUpdate:modelValue":h[3]||(h[3]=d=>a(w).refundReason=d),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:r.$t("refund.enterrejection"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),g(f,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",onClick:h[4]||(h[4]=d=>a(n)(!1))},{default:v(()=>[M(i(r.$t("common.confirm")),1)]),_:1})]),_:1},8,["show"]),g(et,{order:o.order,show:a(W),type:we.value,onClose:h[6]||(h[6]=d=>a(ee)(!1)),loading:a(w).btnLoading,onHandleSubmit:z},null,8,["order","show","type","loading"])])}}}),zs=Fe(Ks,[["__scopeId","data-v-13380470"]]),Ws={class:"bg-[#f2f0ef]"},Js=Ne({emits:["recompute"],setup(o,{emit:V}){const b=S(null),{getCurrentStoreId:k}=Ge(),{getMerchantDhKey:A,decryptAddressKey:P,decryptKey:T,cryptoAESWithSearch:G}=it(),q=ze(),{t:n}=Pe(),[w,j]=Ae(!1),I=S(""),l=Ee({active:1,page:0,size:30,finished:!1,list:[],loading:!1,total:0,refundTabList:[{id:1,name:n("order.applying")},{id:2,name:n("order.refund block confirmation")},{id:3,name:n("order.refund completed")},{id:4,name:n("order.refund rejection")},{id:5,name:n("order.cancellation refund")},{id:10,name:n("order.platform intervention")},{id:11,name:n("order.platforms step in to support buyers")},{id:12,name:n("order.platform intervention to support sellers")},{id:13,name:n("order.freeze thawed")},{id:14,name:n("order.user forced liquidation")},{id:20,name:n("order.Long time no delivery")},{id:30,name:n("refund.refund success tips")}],statusTabList:[{id:0,name:n("order.waitPay")},{id:1,name:n("order.wait")},{id:2,name:n("order.already")},{id:3,name:n("order.fail")},{id:4,name:n("order.trade success")},{id:5,name:n("order.trade close")},{id:6,name:n("order.trade close")},{id:7,name:n("order.platform intervention")},{id:8,name:n("order.canceled")},{id:-1,name:n("order.canceled")}],query:{}}),W=ye(()=>[{id:1,name:n("refund.Pending")},{id:99,name:n("order.all")}]),ee=Ue(),we=f=>f.fmRefundReason?f.fmRefundReason[ee]:"",_e=f=>{l.loading||(b.value.handleReset(!1),q.replace({path:"sellerOrderList",query:{type:2,active:f}}),l.active=f,V("recompute"),J())},le=async()=>{if(I.value&&I.value.length<2)return C(n("common.Please enter at least two keywords"));J()},J=()=>{l.page=0,l.finished=!1,l.list=[],C.loading({message:n("common.loading"),forbidClick:!0}),K()},K=async()=>{l.loading=!0,l.page+=1,await O(l.query),C.clear(),l.loading=!1},z=async f=>{l.list=[],l.page=1,await O(f)},de=f=>{q.push(f)},te=async f=>{var u,E;const x=navigator.userAgent.toLowerCase(),d=/mobile|android|iphone|ipad|phone/i.test(x),H=/tablet|ipad/i.test(x),U=/webview|wv/i.test(x),_=/fbav|instagram|line|twitter|whatsapp/i.test(x),$=/metamask/i.test(x),ce=/tokenpocket/i.test(x),ue=(window==null?void 0:window.$onekey)||!1;if(We.isConnected()){j(!0);return}if(ue){j(!0);return}if((d||H)&&(U||_||$||ce||ue)&&!window.chrome&&!window.safari){j(!0);return}let me=null;I.value&&(me=await G(I.value));const ne={page:1,size:99999,status:-1,refundStatus:W.value[l.active].id,type:1,tab:2,keyword:me,keywordPlain:I.value,storeId:(u=await k())==null?void 0:u.id,...f};C.loading({duration:0,message:n("common.loading")});const Q=await Be(ne);if(!Q.success||!Q.data||Q.data.length===0){C.clear(),C(n("common.No data download"));return}const fe=Q.data.map(t=>new Promise(async pe=>{var ae,he,ve;if(t!=null&&t.userAddress&&(t.userAddress.postscript=t.postscript),t!=null&&t.userAddress&&((ae=t==null?void 0:t.userAddress)!=null&&ae.encryptFlag)){const L=await A(t.address,t==null?void 0:t.submitUserPubKey);L&&(t.userAddress=P(t.userAddress,L))}if(t!=null&&t.shippingHash){const L=await A(t.address,t==null?void 0:t.shippingUserPubKey);if(L){const ie=T(t.expressNo,L);ie.hash===t.shippingHash&&(t.expressNo=ie.decrypt,t.expressCompany=T(t.expressCompany,L).decrypt)}}pe([{text:t.id},{text:t.address},{text:t.hash||""},{text:t.orderGoods&&t.orderGoods.length?F(t.orderGoods,"goodsName"):""},{text:t.orderGoods&&t.orderGoods.length?F(t.orderGoods,"goodsId"):""},{text:t.orderGoods&&t.orderGoods.length?F(t.orderGoods,"number"):0},{text:t.orderGoods&&t.orderGoods.length?F(t.orderGoods,"price"):0},{text:((he=l.statusTabList.find(L=>L.id==t.status))==null?void 0:he.name)||""},{text:t.totalAmountOriginal||0},{text:t.merchantAdjustAmount||0},{text:t.activityReduceAmount||0},{text:t.voucherAmount||0},{text:r(t)},{text:t.orderGoods&&t.orderGoods.length?F(t.orderGoods,"discountRatio","%"):"0%"},{text:t.createTime?Z(t.createTime):""},{text:t.chainCreateTime?Z(t.chainCreateTime):""},{text:t.expressTime?Z(t.expressTime):""},{text:t.finishTime?Z(t.finishTime):""},{text:t.userAddress.postscript||""},{text:`${t.userAddress.provinceName??""}${t.userAddress.cityName??""}${t.userAddress.countyName??""}${t.userAddress.detailInfo??""} ${t.userAddress.userName??""} ${t.userAddress.telNumber??""}`},{text:t.creditFlag?n("common.yes"):n("common.no")},{text:t.merchantsConfirm?n("common.yes"):n("common.no")},{text:t.orderLabelList.map(L=>L.content).join(",")},{text:t.expressCompany||""},{text:t.expressNo||""},{text:we(t)},{text:((ve=l.refundTabList.find(L=>L.id==t.refundStatus))==null?void 0:ve.name)||""},{text:t.refundTime?Z(t.refundTime):""},{text:t.refundSuccessTime?Z(t.refundSuccessTime):""},{text:t.refundCancelTime?Z(t.refundCancelTime):""}])})),oe=await Promise.all(fe);if(!oe||oe.length===0){C.clear(),C(n("common.No data download"));return}const m=[{text:n("order.export.orderId")},{text:n("order.export.buyerAddress")},{text:n("order.export.transactionHash")},{text:n("order.export.goodsName")+"("+n("order.export.goodsName-tips")+")"},{text:n("order.export.goodsId")+"("+n("order.export.goodsId-tips")+")"},{text:n("order.export.goodsNumber")+"("+n("order.export.goodsName-tips")+")"},{text:n("order.goodsPrice")+"("+n("order.export.goodsName-tips")+")"},{text:n("order.orderStatus")},{text:n("order.export.goodsPrice total")},{text:n("order.merchant modify price total")},{text:n("order.export.activityReduceAmount total")},{text:n("voucher.voucher_deduction total")},{text:n("order.export.actualAmount total")},{text:n("common.ratio")},{text:n("order.createTime")},{text:n("order.export.paymentTime")},{text:n("order.Shipping time")},{text:n("order.Complete time")},{text:n("order.remark")},{text:n("order.receive address")},{text:n("order.export.isCreditReceive")},{text:n("order.export.merchantsConfirm")},{text:n("order.export.orderLabelList")},{text:n("order.deliveryCompany")},{text:n("order.deliveryId")},{text:n("refund.RefundReason")},{text:n("refund.refundStatus")},{text:n("refund.refundTime")},{text:n("refund.refundSuccessTime")},{text:n("refund.refundCancelTime")}];try{const t=((E=await k())==null?void 0:E.storeName)+"_退款或售后订单_"+$e().format("YYYY-MM-DD HH:mm:ss");yt([m,...oe],{excelName:t,worksheet:"sheet"}),C.clear()}catch{C.clear()}},D=()=>{j(!1)},r=f=>{const x=new be(f.totalAmountOriginal).plus(new be(f.merchantAdjustAmount||0)).minus(new be(f.activityReduceAmount||0)).minus(new be(f.voucherAmount||0)).toNumber();return h(x)},h=f=>Number.isInteger(f)?f.toString():f.toFixed(4).replace(/\.?0+$/,""),F=(f,x,d)=>f.map(U=>{let _=U[x];return d&&(_=_+d),_}).join(","),O=async f=>{var U,_,$,ce,ue,me,ne,Q,fe,oe,m,u,E,t,pe,ae,he,ve,L;let x=null;I.value&&(x=await G(I.value)),l.query=Object.keys(f).length>0?f:l.query;const d=await Be({page:l.page,size:l.size,status:-1,refundStatus:W.value[l.active].id,type:1,tab:2,keyword:x,keywordPlain:I.value,storeId:(U=await k())==null?void 0:U.id,...f});if((d==null?void 0:d.total)===0&&(l.list=[]),!d.success){l.finished=!0,l.loading=!1;return}if(!d.data||!d.total){l.finished=!0,l.loading=!1;return}l.total=d.total;const H=[];for(let ie=0;ie<d.data.length;ie++){let X="";const e=d.data[ie];if(e.userAddress&&(e.userAddress.postscript=e.postscript),e.userAddress&&((_=e.userAddress)!=null&&_.encryptFlag)){const N=await A(e.address,e.submitUserPubKey);N&&(e.userAddress=P(e.userAddress,N),($=e.userAddress)!=null&&$.success&&!e.merchantEns&&(X+=((ce=e.userAddress)==null?void 0:ce.userName)+((ue=e.userAddress)==null?void 0:ue.telNumber)+(((me=e.userAddress)==null?void 0:me.postalCode)??"")+((ne=e.userAddress)==null?void 0:ne.provinceName)+((Q=e.userAddress)==null?void 0:Q.cityName)+((fe=e.userAddress)==null?void 0:fe.countyName)+((oe=e.userAddress)==null?void 0:oe.detailInfo)+((m=e.userAddress)==null?void 0:m.postscript)))}else e.merchantEns||(X+=((u=e.userAddress)==null?void 0:u.userName)+((E=e.userAddress)==null?void 0:E.telNumber)+(((t=e.userAddress)==null?void 0:t.postalCode)??"")+((pe=e.userAddress)==null?void 0:pe.provinceName)+((ae=e.userAddress)==null?void 0:ae.cityName)+((he=e.userAddress)==null?void 0:he.countyName)+((ve=e.userAddress)==null?void 0:ve.detailInfo)+((L=e.userAddress)==null?void 0:L.postscript));if(e.shippingHash){const N=await A(e.address,e.shippingUserPubKey);if(N){const Re=T(e.expressNo,N);Re.hash===e.shippingHash&&(e.expressNo=Re.decrypt,e.expressCompany=T(e.expressCompany,N).decrypt,e.merchantEns||(X+=(e==null?void 0:e.expressNo)+(e==null?void 0:e.expressCompany)))}}else e.merchantEns||(X+=(e==null?void 0:e.expressNo)+(e==null?void 0:e.expressCompany));if(e.merchantEns||(X+=(e==null?void 0:e.hash)+(e==null?void 0:e.address)),X)try{H.push({id:e.id,merchantEns:await G(X)})}catch(N){console.log(N)}}H.length>0&&pt({enInfoList:H}),l.list=l.page===1?d.data:l.list.concat(d.data),l.list.length>=l.total&&(l.finished=!0),l.loading=!1},c=()=>{l.page=0,l.finished=!1,l.list=[],K()},se=Ke();se.query.active&&(l.active=Number(se.query.active));const Te=S(null);return Me(async()=>{var f;K(),Te.value=(f=await k())==null?void 0:f.merchant}),(f,x)=>{const d=R("VanList"),H=R("VanTab"),U=R("VanTabs");return p(),y("div",null,[g(U,{active:a(l).active,"onUpdate:active":x[3]||(x[3]=_=>a(l).active=_),onChange:_e,background:"#f2f0ef",sticky:"","offset-top":"44"},{"nav-bottom":v(()=>[s("div",Ws,[g(qt,{modelValue:I.value,"onUpdate:modelValue":x[0]||(x[0]=_=>I.value=_),onOnSubmit:le,onGetList:z,ref:(_,$)=>{$.searchBox=_,b.value=_},onOnExport:te},null,8,["modelValue"])])]),default:v(()=>[(p(!0),y(re,null,ge(a(W),_=>(p(),Y(H,{title:_.name,key:_.id},{default:v(()=>[g(d,{class:"mt-2.5",loading:a(l).loading,"onUpdate:loading":x[2]||(x[2]=$=>a(l).loading=$),finished:a(l).finished,"finished-text":f.$t("common.noMore"),"loading-text":f.$t("common.loading"),onLoad:K},{default:v(()=>[(p(!0),y(re,null,ge(a(l).list,$=>(p(),Y(zs,{creditFlag:$.creditFlag,key:$.id,order:$,onResetHandler:c,onHandleTo:de,onRecompute:x[1]||(x[1]=ce=>V("recompute"))},null,8,["creditFlag","order"]))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),_:2},1032,["title"]))),128))]),_:1},8,["active"]),g(rt,{show:a(w),title:"导出账单",content:"请在PC端操作账单导出",showConfirm:!0,showReject:!1,confirmText:"我知道了",rejectText:"拒绝",onClose:D,onConfirm:D},null,8,["show"])])}}}),Qs=Fe(Js,[["__scopeId","data-v-16d260d9"]]),pn=Object.freeze(Object.defineProperty({__proto__:null,default:Qs},Symbol.toStringTag,{value:"Module"}));export{Qs as M,qt as S,pn as a,bt as h};
