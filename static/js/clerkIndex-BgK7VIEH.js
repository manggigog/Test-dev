import{z as b,y as H,bA as X,G as I,H as w,I as l,U as B,bj as Y,Z as R,O as r,Q as x,_ as U,F as ee,$ as T,P as g,a4 as V,x as te,o as se,q as oe,a2 as E,bl as ae,r as v,D as ne,E as le,bm as re,T as ie}from"./vendor-Dr_RpJ_Y.js";import{a as ce,_ as ue}from"./SelectShopPop-DCVgR0Gp.js";import{a as O,y as de,ct as pe,cu as fe,S as me}from"./index-CU2nzZe6.js";import{a as he,b as ve}from"./Merchant-q3vusJJS.js";import{g as ge,u as we}from"./user-CDTMM2rk.js";import"./close-Dwemq2UR.js";import"./clerk-select-CyxOtqoc.js";import"./shop-CeqcS6K2.js";import"./avatarRing2-DK_wiJ33.js";import"./level-Ck9QIocm.js";import"./profileEnum-CXsMKuND.js";import"./offlineGoods-DvT2Go6q.js";import"./UpgradeStorePop-GdUvp0Hc.js";import"./BoutiqueLable-DDlxeK08.js";import"./order-D4JYoGRo.js";import"./notice-CboPmXRH.js";import"./mall-COk3vM6s.js";const xe={class:"mb-4 bg-[#FFF] rounded-[12px] p-[12px] text-sm font-normal"},_e={class:"flex items-center w-full justify-between"},ke={class:"shrink-1 flex items-center w-full"},ye={class:"shrink-0 relative"},be={class:"w-[40px] h-[40px] aspect-square object-cover bg-black-100 rounded-[4px]",fit:"cover"},Ce={class:"flex flex-col items-start justify-between w-full ml-2 text-sm"},Se={class:"flex items-center w-full text-sm font-semibold text-[#2E2008]"},$e={class:"truncate"},Le={class:"text-xs text-[#999] mt-[2px]"},Ne={key:0,class:"shrink-0 w-fit h-[22px] px-[8px] text-[12px] leading-[20px] border border-solid rounded-2xl text-[#FF8812] border-[#FF8812]"},Pe=b({props:{shopList:{default:()=>[]}},emits:["click"],setup(c,{emit:p}){const{accountStore:s}=O(),n=H(()=>s.store||{});return(f,u)=>{const h=X("lazy");return w(),I("div",xe,[l("section",{class:"relative",onClick:u[0]||(u[0]=_=>c.shopList&&c.shopList.length>0?p("click"):"")},[l("div",_e,[l("div",ke,[l("div",ye,[Y(l("img",be,null,512),[[h,r(n).logo]]),r(n).type?(w(),R(ce,{key:0,class:"absolute right-0 top-0 z-2 mr-0",type:r(n).type},null,8,["type"])):B("",!0)]),l("div",Ce,[l("div",Se,[l("div",$e,x(r(n).storeName),1)]),l("div",Le,x(f.$t("storeClerk.Store Management")),1)])]),c.shopList&&c.shopList.length>0?(w(),I("div",Ne,x(f.$t("storeClerk.Switch store")),1)):B("",!0)])])])}}}),Fe={class:"py-8 text-base text-center text-black"},Te={class:"flex"},Ie=b({props:{show:{type:Boolean},data:null,loading:{type:Boolean}},emits:["close","confirm"],setup(c,{emit:p}){return(s,n)=>{const f=ee("van-button");return w(),R(de,{noClose:!0,width:"90%",show:c.show,name:s.$t("common.tip"),teleport:"body",onClose:n[2]||(n[2]=()=>{p("close")})},{default:T(()=>{var u,h;return[l("div",Fe,x(s.$t("storeClerk.noticeTip",{shop:(h=(u=c.data)==null?void 0:u.shop)==null?void 0:h.storeName})),1),l("div",Te,[g(f,{loading:c.loading,class:"plain-btn w-1/2 mx-2.5 text-[#FEA021] font-semibold",onClick:n[0]||(n[0]=()=>{p("confirm",2)})},{default:T(()=>[V(x(s.$t("common.reject")),1)]),_:1},8,["loading"]),g(f,{loading:c.loading,class:"w-1/2 mx-2.5 btn-orange btn-shadow text-white font-semibold",onClick:n[1]||(n[1]=()=>{p("confirm",1)})},{default:T(()=>[V(x(s.$t("common.agree")),1)]),_:1},8,["loading"])])]}),_:1},8,["show","name"])}}}),Be=U(Ie,[["__scopeId","data-v-4279a62e"]]),y={"|-1|":["allOrder","offlineOrder","cashierCollect","fund","goods","service","shop","category","shippingTemplate","clerk"],"|1|":["allOrder"],"|4|":["offlineOrder","cashierCollect","fund"],"|2|":["goods","service","shop","category","shippingTemplate"],"|3|":["cashierCollect","fund"]},Oe={class:"linear-bg"},Re={class:"w-full z-[10] overflow-hidden p-[12px] pt-[16px]"},De=b({name:"ClerkIndex"});function je(c){const{t:p}=te(),{accountStore:s,clerkStore:n}=O();O();const f=se(),u=oe(),[h,_]=E(!1),[q,C]=E(!1),D=ae({userInfo:{address:s.account}}),j=async()=>{const e=await we(s.account);!e.success||!e.data||(D.userInfo=e.data)},S=v(!1),k=v(null),d=v([]),z=async()=>{var t,o,a,m;const e=await me();if(e.success){if(d.value=e.data||[],(t=s.store)!=null&&t.merchant){const i=d.value.find(W=>{var M;return W.merchant===((M=s.store)==null?void 0:M.merchant)});if(i){k.value=i==null?void 0:i.pers,L(i==null?void 0:i.id),await s.changeStore(i),await F(i==null?void 0:i.id),S.value=!0;return}}L((o=d.value[0])==null?void 0:o.id),await s.changeStore(d.value[0]||{}),await F((a=d.value[0])==null?void 0:a.id),k.value=(m=d.value[0])==null?void 0:m.pers,S.value=!0}},$=v(null),L=async e=>{if(!e)return;const{success:t,data:o}=await fe(e);t&&o&&(C(!0),$.value=o)},N=v(!1),G=async e=>{var o;N.value=!0;const{success:t}=await pe({id:(o=$.value)==null?void 0:o.id,agreeFlag:e});N.value=!1,t&&(ie(p("admin.Successful-operation")),C(!1))},A=v(null),P=async()=>{var e;(e=A.value)==null||e.init()},Q=async e=>{k.value=e==null?void 0:e.pers,L(e==null?void 0:e.id),await s.changeStore(e),await F(e==null?void 0:e.id),_(!1),P()},F=async e=>{e&&await ge(e)},Z=e=>{e==="/collect"?u.push({path:e,query:{from:"clerk"}}):u.push(e)},J=(e,t)=>{u.replace({path:e,query:t})},K=H(()=>{var o;if(s.isOnlyView)return y["|-1|"].filter(a=>a!=="clerk");if(!n.isClerk)return y["|-1|"];const e=(o=k.value)==null?void 0:o.split(",");if(!e||e.length<1)return[];let t=[];for(let a=0;a<e.length;a++){const m=e[a];y[m]&&(t=[...y[m],...t])}return t});return ne(()=>f.path,async e=>{console.log("route val",e),e==="/clerk/index"&&(await j(),await z(),P())},{immediate:!0,deep:!0}),le(async()=>{const e=new Date().getTime();sessionStorage.setItem("browser_clerk",e.toString())}),re(async()=>{await j(),await z(),P()}),(e,t)=>{var o;return w(),I("div",Oe,[g(he,{info:r(D).userInfo},null,8,["info"]),l("div",Re,[g(Pe,{onClick:t[0]||(t[0]=a=>r(_)(!0)),shopList:d.value},null,8,["shopList"]),S.value?(w(),R(ve,{key:0,isClerk:!0,Permissions:r(K),ref:(a,m)=>{m.MerchantRef=a,A.value=a},onHandleTo:Z,onHandleReplace:J},null,8,["Permissions"])):B("",!0)]),g(ue,{list:d.value,show:r(h),shopId:(o=r(s).store)==null?void 0:o.id,onClose:t[1]||(t[1]=a=>r(_)(!1)),onOnSelect:Q},null,8,["list","show","shopId"]),g(Be,{show:r(q),onClose:t[2]||(t[2]=a=>r(C)(!1)),onConfirm:G,data:$.value,loading:N.value},null,8,["show","data","loading"])])}}const ze=b({...De,setup:je}),st=U(ze,[["__scopeId","data-v-3e3aed7e"]]);export{st as default};
