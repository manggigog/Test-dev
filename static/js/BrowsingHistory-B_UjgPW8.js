import{C as ls}from"./CommonVanProvider-BpsZUrD3.js";import{B as cs}from"./BetweenTab-Bn5ZVRk8.js";import{_ as j,y as T,l as R,x as V,E as C,F as v,G as n,H as o,O as k,P as u,Q as _,K as h,a2 as I,a4 as N,Y as q,Z as F,o as rs,I as O,J as D,ab as ds,w as us,bf as ms,a1 as fs,r as $,be as U,D as ps,N as L}from"./vendor-BUT0HZ5j.js";import{_ as J}from"./MCOIN-BcbOHmhy.js";import{_ as K}from"./store-CPx32ymB.js";import{_ as Q}from"./shop-arrow-right-Br6r0Qcd.js";import{R as Y}from"./RatioBox-ys008e7W.js";import{_ as W}from"./ImgBoutiqueLable-BF5Xoxsv.js";import{d as X,N as ss,a4 as hs,C as gs,a5 as _s}from"./index-k1FFr-1T.js";import{_ as vs}from"./EmptyTipsPop-_FH8A6A8.js";import"./BackIcon-biFt6cm7.js";/* empty css                                                               */import"./shop-CeqcS6K2.js";const ys="/Test-dev/static/images/dark-delete-Bo7Z4RyI.svg",H=s=>(q("data-v-3c4891f6"),s=s(),F(),s),xs=["data-store-name"],ws={class:"shrink-0 offline-goods-img__wrap w-[60px] h-[60px] overflow-hidden relative"},bs={class:"offline-goods-info__wrap ml-2 flex-1 min-h-[60px]",style:{width:"calc(100% - 60px - 8px)"}},$s={class:"w-full items-start flex flex-col justify-between h-[60px]"},ks={class:"w-full"},Cs={class:"font-semibold text-sm line-clamp-1"},Is={class:"flex items-center justify-start font-Puhui"},Bs={class:"flex items-center"},Ss=H(()=>o("img",{src:J,class:"w-4 h-4 mr-1"},null,-1)),Es={class:"text-b1 font-semibold text-sm"},Ls=["onClick"],Ns={class:"font-normal text-b3 text-sm flex items-center justify-start"},Os=H(()=>o("img",{src:K,class:"w-4 h-4"},null,-1)),Ds={class:"line-clamp-1"},js=H(()=>o("img",{src:Q,class:"w-4 h-4"},null,-1)),Ts=T({props:{goods:{type:Object,default:()=>({})}},setup(s){const i=s,f=R(),y=V(()=>{var t;return(((t=i.goods.icons)==null?void 0:t.split(","))||[""])[0]}),b=()=>{var t,e;const r=((t=i.goods)==null?void 0:t.id)||((e=i.goods)==null?void 0:e.goodsId);r&&f.push({path:"/goodsDetail",query:{id:r}})},c=()=>{var t;const r=(t=i.goods)==null?void 0:t.shopId;r&&f.push({path:"/shop",query:{shopId:r}})};return(r,t)=>{const e=C("VanImage");return n(),v("section",{class:"flex items-start bg-white p-3 rounded-xl","data-store-name":s.goods.shopName,onClick:b},[o("div",ws,[k(e,{src:u(y),class:"offline-goods-img w-[60px] h-[60px] rounded-lg overflow-hidden",alt:"商品主图",fit:"cover"},null,8,["src"]),k(W,{type:+s.goods.type||null},null,8,["type"])]),o("div",bs,[o("div",$s,[o("div",ks,[o("div",Cs,_(s.goods.goodsName||""),1)]),o("div",Is,[o("div",Bs,[Ss,o("div",Es,_(u(X)(s.goods.price)),1)]),s.goods.discountRatio?(n(),h(Y,{key:0,class:"ratio-box ml-2 !px-1",tag:r.$t("common.rebate"),ratio:s.goods.discountRatio},null,8,["tag","ratio"])):I("",!0)]),o("div",{class:"w-full",onClick:N(c,["stop"])},[o("div",Ns,[Os,o("span",Ds,_(s.goods.storeName||"--"),1),js])],8,Ls)])])],8,xs)}}}),Rs=j(Ts,[["__scopeId","data-v-3c4891f6"]]),P=s=>(q("data-v-610d7d8e"),s=s(),F(),s),Vs=["data-store-name"],qs={class:"shrink-0 offline-goods-img__wrap w-[60px] h-[60px] overflow-hidden relative"},Fs={class:"offline-goods-info__wrap ml-2 flex-1 min-h-[60px]",style:{width:"calc(100% - 60px - 8px)"}},Hs={class:"w-full items-start flex flex-col justify-between h-[60px]"},Ps={class:"w-full"},As={class:"font-semibold text-sm line-clamp-1"},Gs={class:"flex items-center justify-start font-Puhui"},zs={class:"flex items-center"},Ms=P(()=>o("img",{src:J,class:"w-4 h-4 mr-1"},null,-1)),Us={class:"text-b1 font-semibold text-sm"},Zs={class:"w-full"},Js={class:"font-normal text-b3 text-sm flex items-center justify-start"},Ks=P(()=>o("img",{src:K,class:"w-4 h-4"},null,-1)),Qs={class:"line-clamp-1"},Ys=["onClick"],Ws={key:0},Xs=["onClick"],so=P(()=>o("img",{src:Q,class:"w-4 h-4"},null,-1)),oo=T({props:{goods:{type:Object,default:()=>({})}},setup(s){const i=s,f=R(),y=V(()=>{var e;return(((e=i.goods.goodsIcons)==null?void 0:e.split(","))||[""])[0]}),b=()=>{var e,p;const t=((e=i.goods)==null?void 0:e.id)||((p=i.goods)==null?void 0:p.goodsId);t&&f.push({path:"/goodsDetail",query:{id:t}})},c=()=>{var e;const t=(e=i.goods)==null?void 0:e.shopId;t&&f.push({path:"/shop",query:{shopId:t}})},r=()=>{var e;const t=(e=i.goods)==null?void 0:e.storeId;t&&f.push({path:"/city/storefront",query:{storeId:t}})};return(t,e)=>{const p=C("VanImage");return n(),v("section",{class:"flex items-start bg-white p-3 rounded-xl","data-store-name":s.goods.shopName,onClick:b},[o("div",qs,[k(p,{src:u(y),class:"offline-goods-img w-[60px] h-[60px] rounded-lg overflow-hidden",alt:"商品主图",fit:"cover"},null,8,["src"]),k(W,{type:+s.goods.goodsType||null},null,8,["type"])]),o("div",Fs,[o("div",Hs,[o("div",Ps,[o("div",As,_(s.goods.goodsName||""),1)]),o("div",Gs,[o("div",zs,[Ms,o("div",Us,_(u(X)(s.goods.goodsPrice)),1)]),s.goods.goodsDiscountRatio?(n(),h(Y,{key:0,class:"ratio-box ml-2 !px-1",tag:t.$t("common.rebate"),ratio:s.goods.goodsDiscountRatio},null,8,["tag","ratio"])):I("",!0)]),o("div",Zs,[o("div",Js,[Ks,o("span",Qs,[o("span",{onClick:N(c,["stop"])},_(s.goods.shopName||""),9,Ys),s.goods.storeName&&s.goods.shopName?(n(),v("span",Ws," · ")):I("",!0),o("span",{onClick:N(r,["stop"])},_(s.goods.storeName||""),9,Xs)]),so])])])])],8,Vs)}}}),to=j(oo,[["__scopeId","data-v-610d7d8e"]]),eo={class:""},ao={class:"dat__wrap text-sm font-b1 font-normal"},no={class:"log-list__wrap mt-3"},Z={props:{data:{type:Object,default:()=>({})},isOffline:{type:Boolean,default:!1}},setup(s){const i=s,f=V(()=>rs().isSame(i.data.day,"day"));return(y,b)=>(n(),v("div",eo,[o("p",ao,_(u(f)?y.$t("common.today"):s.data.day),1),o("div",no,[(n(!0),v(O,null,D(s.data.goodsList||[],(c,r)=>(n(),v("div",{key:r},[(n(),h(ds(s.isOffline?to:Rs),{goods:c,class:"mb-3 :last:mb-0"},null,8,["goods"]))]))),128))])]))}},io=s=>ss("GET","/goodsLook/history",s),lo=()=>ss("POST","/goodsLook/clear",null),co=s=>(q("data-v-bfd98f6a"),s=s(),F(),s),ro=co(()=>o("img",{class:"w-[20px] h-auto",src:ys},null,-1)),uo=[ro],mo={class:"p-3 h-[calc(100vh-83px)] overflow-y-auto"},fo=T({setup(s){const{t:i}=us(),f=R(),y=fs(),b=[{label:i("shop.on-line"),value:1},{label:i("shop.off-line"),value:2}],c=ms({type:Number(y.query.type)||1}),r=a=>{c.type=a||1,f.replace({query:{type:a}}),G()},t=$(!1),e=$(!1),p=$(0),A=$(5),B=$(0),x=$([]),G=()=>{p.value=0,B.value=0,e.value=!1,x.value=[],S()},S=async()=>{t.value=!0,p.value+=1,await os(),t.value=!1},os=async()=>{let a=null;if(c.type===1&&(a=await io({page:p.value,size:A.value})),c.type===2){const m=await hs({page:p.value,size:A.value,sortBy:"desc|create_time"});a={success:m.success,data:m.data.records||[],total:m.data.total||0},a.data&&a.data.forEach(g=>{g.goodsList=g.goodsLooks||[]})}if(!a.success){e.value=!0;return}if(!a.data||!a.total){e.value=!0;return}B.value=a.total;const d=a.data||[];x.value=ts(x.value,d),x.value.length>=B.value&&(e.value=!0)},ts=(a,d)=>{if(p.value===1)return d;const m=[...a];return d.forEach(g=>{const l=m.findIndex(w=>w.day===g.day);l!==-1?m[l].goodsList=[...m[l].goodsList,...g.goodsList]:m.push(g)}),m},[es,E]=U(!1),[as,z]=U(!1),ns=async()=>{let a=null;c.type===1&&(a=await lo()),c.type===2&&(a=await _s()),a.success&&(G(),z(!0))},M=()=>{E(!1)},is=()=>{ns(),E(!1)};return ps(()=>{S()}),(a,d)=>{const m=C("Empty"),g=C("van-list");return n(),h(ls,{title:a.$t("common.browsing history"),class:"bg-gray1 font-Puhui font-normal relative shopGoodsPage","theme-vars":{"field-placeholder-text-color":"#A6A6A6"},ref:(l,w)=>{w.browsingHistoryRef=l}},{right:L(()=>[o("div",{onClick:d[0]||(d[0]=l=>u(E)(!0))},uo)]),default:L(()=>[o("div",null,[k(cs,{class:"between-tab__wrap",options:b,"label-key":"label","value-key":"value",modelValue:u(c).type,"onUpdate:modelValue":d[1]||(d[1]=l=>u(c).type=l),onChange:r},null,8,["modelValue"]),o("div",mo,[x.value.length===0&&!t.value?(n(),h(m,{key:0,name:a.$t("common.no records")},null,8,["name"])):(n(),h(g,{key:1,loading:t.value,"onUpdate:loading":d[2]||(d[2]=l=>t.value=l),"finished-text":a.$t("common.noMore"),"loading-text":a.$t("common.loading"),finished:e.value,onLoad:S,"immediate-check":!0},{default:L(()=>[u(c).type===1?(n(!0),v(O,{key:0},D(x.value,(l,w)=>(n(),h(Z,{key:w,data:l,isOffline:!1},null,8,["data"]))),128)):(n(!0),v(O,{key:1},D(x.value,(l,w)=>(n(),h(Z,{key:w,data:l,isOffline:!0},null,8,["data"]))),128))]),_:1},8,["loading","finished-text","loading-text","finished"]))])]),k(gs,{show:u(es),title:"删除确认",content:"确定要删除全部浏览记录吗？",showConfirm:!0,showReject:!0,rejectText:"取消",confirmText:"确认",onClose:M,onReject:M,onConfirm:is,confirmStyle:{background:"#f44",color:"white"}},null,8,["show"]),u(as)?(n(),h(vs,{key:0,isError:!1,onClose:d[3]||(d[3]=l=>u(z)(!1)),text:"删除成功"})):I("",!0)]),_:1},8,["title"])}}}),Bo=j(fo,[["__scopeId","data-v-bfd98f6a"]]);export{Bo as default};
