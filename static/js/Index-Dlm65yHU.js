import{B as Q}from"./BackIcon-D2Vm_lyR.js";import{B as G}from"./BetweenTab-B_wy4hnL.js";import{l as D}from"./shop-CeqcS6K2.js";import{v as J,l as W}from"./index-DBW_ANsl.js";import{_ as R,w as q,x as X,F as v,G as l,H as a,a2 as N,Q as m,P as y,y as Y,l as Z,a1 as ee,r as c,z as te,bc as ae,D as ne,E as w,O as k,K as I,bp as se,N as g,I as oe,J as le,T as C}from"./vendor-CjApaIpB.js";import{g as ie,r as re,q as ce,s as ue}from"./notice-D5Uup1CP.js";const de="/Test-dev/static/images/clear-post-DKfITiOp.svg",me={class:"w-full bg-white rounded-xl p-3 overflow-x-hidden"},pe={class:"title__wrap w-full flex justify-start items-center"},fe={key:0,class:"w-[8px] h-[8px] rounded-full mr-1.5 bg-[#FF8812] flex-shrink-0"},ve={class:"text-base text-b1 font-normal text-ellipsis line-clamp-1 flex-1 min-w-0"},xe={key:1,class:"text-xs font-normal border border-[#FF8812] rounded-[2px] px-1 text-[#FF8812] ml-1 flex-shrink-0"},he=["innerHTML"],_e={class:"time__wrap w-full mt-2 no-wrap text-right"},ge={class:"text-sm text-b3 font-normal"},ye={props:{item:{type:Object,default:()=>{}}},setup(n){const u=n,{t:x}=q(),{currentLocale:h}=J(),T={1:x("notice.type.platform"),2:x("notice.type.site")},p=X(()=>{const _=u.item[`content${D[h.value]}`]||u.item.contentCn||u.item.contentEn;return _?_.replace(/<[^>]*>/g,""):""});return(_,i)=>(l(),v("div",me,[a("div",pe,[n.item.readFlag?N("",!0):(l(),v("div",fe)),a("p",ve,m(n.item[`title${y(D)[y(h)]}`]||n.item.titleCn||n.item.titleEn),1),n.item.type?(l(),v("p",xe,m(T[n.item.type]),1)):N("",!0)]),a("div",{class:"content__wrap w-full text-sm text-b2 font-normal mt-2 line-clamp-2",innerHTML:y(p)},null,8,he),a("div",_e,[a("p",ge,m(y(W)(n.item.updateTime||n.item.createTime)),1)])]))}},be=R(ye,[["__scopeId","data-v-4256b51e"]]),we={class:"w-full h-full bg-[#f2f0ef]"},ke={class:"header-bar sticky top-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 bg-white"},Ce={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},Te={class:"font-bold text-base text-b1"},Ue={key:1,class:"w-5 h-5",src:de,alt:"一键清空已读"},Le={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Fe={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},$e={class:"bg-[#f44] rounded-[12px] leading-[14px] h-[14px] px-1 text-xxs font-normal text-center text-white scale-100 ml-1 min-w-[14px]"},Ie={class:"list__wrap w-full h-[calc(100vh-50px-34px)] z-10 overflow-y-auto scroll-smooth px-3"},Ne=Y({name:"PostList"});function Ve(n){const{t:u}=q(),x=Z(),h=ee(),T=[{label:u("notice.type.all"),value:0},{label:u("notice.type.platform"),value:1},{label:u("notice.type.site"),value:2}],p=c(0),_=c(20),i=c(!1),f=c(!1),r=c([]),b=c({type:(()=>{const e=h.query.type;if(e!==void 0){const t=parseInt(e);return[0,1,2].includes(t)?t:0}return 0})()});te(()=>b.value.type,e=>{const t={...h.query};e===0?delete t.type:t.type=e.toString(),x.replace({query:t})},{immediate:!1});const[V,B]=ae(!1),U=c(null),j=()=>{if(V.value)return;const e=Date.now();if(U.value&&e-U.value<2e3){C("请勿频繁点击");return}const t={type:null};B(!0),re(t).then(s=>{s.success&&(C("已清除未读消息"),O(),L())}).catch(s=>{console.error("清空已读失败:",s)}).finally(()=>{B(!1)}),U.value=e},O=async()=>{r.value.forEach(e=>{e.readFlag=!0})},L=()=>{p.value=0,r.value=[],f.value=!1,E(),z()},E=()=>{f.value||(i.value=!0,p.value+=1,H())},H=()=>{const e={...b.value,page:p.value,size:_.value};ce(e).then(t=>{if(t.success===!1){C(t.message||"获取数据失败"),f.value=!0;return}const s=t.data||[],$=t.total||0;r.value=p.value===1?s:r.value.concat(s),(r.value.length>=$||s.length===0)&&(f.value=!0)}).catch(t=>{console.error("获取公告列表失败:",t),C("网络错误，请稍后重试"),f.value=!0}).finally(()=>{i.value=!1})},M=e=>{L()},P=e=>{const t=e.id;e.readFlag=!0,S(t),x.push("/postDetail?id="+t)},S=async e=>{await ue(e)},d=c({versionUnread:0,platformUnread:0,totalUnread:0}),z=async()=>{const e=await ie();if(e.success){d.value=e.data||{};return}console.log(e.data)};ne(()=>{z()});const F=e=>e===0?0:e>99?"99+":e;return(e,t)=>{const s=w("van-loading"),$=w("Empty"),A=w("van-list"),K=w("van-pull-refresh");return l(),v("div",we,[a("section",ke,[a("div",Ce,[k(Q)]),a("div",Te,m(e.$t("home.Announcement List Public")),1),a("div",{class:"absolute right-4 flex items-center gap-1 -translate-y-1/2 top-1/2 w-5 h-5",onClick:j},[y(V)?(l(),I(s,{key:0,size:"20"})):(l(),v("img",Ue))])]),a("section",null,[k(G,{options:T,modelValue:b.value.type,"onUpdate:modelValue":t[0]||(t[0]=o=>b.value.type=o),onChange:M,"label-key":"label","value-key":"value"},se({_:2},[d.value.totalUnread>0?{name:"badge0",fn:g(()=>[a("span",Le,m(F(d.value.totalUnread)),1)])}:void 0,d.value.platformUnread>0?{name:"badge1",fn:g(()=>[a("span",Fe,m(F(d.value.platformUnread)),1)])}:void 0,d.value.versionUnread>0?{name:"badge2",fn:g(()=>[a("span",$e,m(F(d.value.versionUnread)),1)])}:void 0]),1032,["modelValue"])]),a("section",Ie,[k(K,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=o=>i.value=o),onRefresh:L,"animation-duration":"0"},{default:g(()=>[r.value.length===0&&!i.value?(l(),I($,{key:0,name:"暂无消息"})):N("",!0),k(A,{loading:i.value,"onUpdate:loading":t[1]||(t[1]=o=>i.value=o),finished:f.value,"finished-text":r.value.length===0?"":"没有更多了",onLoad:E},{default:g(()=>[(l(!0),v(oe,null,le(r.value,o=>(l(),I(be,{key:o.id,item:o,class:"mb-3 first:mt-3",onClick:ze=>P(o)},null,8,["item","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])])}}const Be=Object.assign(Ne,{setup:Ve}),Me=R(Be,[["__scopeId","data-v-3c0cd0a6"]]);export{Me as default};
