import{y as Z,r as y,x as G,z as we,E as S,K as T,G as _,N as g,H as s,Q as p,O as h,a4 as N,F as k,J as Oe,a2 as I,R as B,P as u,I as Me,n as je,_ as ze,w as Ge,a1 as Ae,l as Ke,bc as H,D as He,bx as ve,bJ as me,a0 as Y,Y as Je,Z as Qe,T as V,br as fe}from"./vendor-D6JO6WHW.js";import{C as Xe}from"./CommonVanProvider-CI5dtYow.js";import{_ as Ye}from"./search-B34EARrH.js";import{_ as Ze}from"./checked-CkJ-Z4or.js";import{u as he}from"./upload-RtFxx1Ln.js";import{e as We,u as eo,r as oo,V as J,_ as to,S as so,X as ao,ba as lo,bb as be,a2 as ye,q as _e}from"./index-CbIwihlz.js";import{i as Q,b as xe}from"./offlineGoods-Biq4pIIG.js";import{S as X}from"./shop-CeqcS6K2.js";import"./BackIcon-CPUEW9je.js";const no={class:"w-full py-4 pl-4 pr-2 bg-b6 rounded-[10px] overflow-hidden font-Puhui"},io={class:"text-center felx-1 relative mr-2"},ro={class:"text-base font-bold"},uo={class:"absolute right-0 top-0 pl-2"},co={class:"flex-1 bg-b5 rounded-3xl mr-2 mt-4 mb-2"},go=s("div",null,[s("img",{src:Ye,class:"w-4 h-4"})],-1),po={class:"categoryList pr-2 mr-2 overflow-y-auto"},vo=["id","onClick"],mo=["innerHTML"],fo={key:0,class:"w-4 h-4",src:Ze,alt:""},ho=Z({props:{list:null,id:null,level:null},emits:["close","select"],setup(x,{emit:c}){const D=x,F=y(!0),w=y(""),L=G(()=>{if(!w.value.trim())return D.list;const n=P(w.value),i=new RegExp(`(${n})`,"gi");return D.list.filter(f=>f.goodsCategoryName.match(i))}),q=n=>{if(!w.value.trim())return n;const i=P(w.value),f=new RegExp(`(${i})`,"gi");return n.replace(f,'<span class="highlight">$1</span>')},P=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),o=n=>{c("select",n.goodsCategoryId,n.goodsCategoryName),c("close")},U=n=>{const i=document.getElementById(n);i&&i.scrollIntoView({behavior:"smooth"})};return we(()=>D.id,async n=>{n&&(await je(),U(n))},{immediate:!0,deep:!0}),(n,i)=>{const f=S("van-icon"),b=S("VanField"),E=S("VanPopup");return _(),T(E,{teleport:"body",show:F.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:i[2]||(i[2]=v=>n.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"50%","border-radius":"16px 16px 0 0"}},{default:g(()=>[s("div",no,[s("header",io,[s("div",ro,p([n.$t("offline.one_category"),n.$t("offline.two_category"),n.$t("offline.three_category")][(x.level||1)-1])+" （"+p((x.list||[]).length)+"） ",1),s("div",uo,[h(f,{name:"cross",size:"20",onClick:i[0]||(i[0]=N(()=>{c("close")},["stop"]))})])]),s("div",co,[h(b,{modelValue:w.value,"onUpdate:modelValue":i[1]||(i[1]=v=>w.value=v),placeholder:n.$t("mall.Enter search keywords"),class:"w-[100% - 20px] text-center bg-transparent items-center",clearable:""},{"left-icon":g(()=>[go]),_:1},8,["modelValue","placeholder"])]),s("div",po,[(_(!0),k(Me,null,Oe(u(L),v=>(_(),k("div",{key:v.goodsCategoryId,id:v.goodsCategoryId,class:"flex flex-1 justify-between py-4 border-b border-b-b4 last:border-none",onClick:A=>o(v)},[s("span",{class:B({"text-newOrigin":v.goodsCategoryId===x.id}),innerHTML:q(v.goodsCategoryName)},null,10,mo),v.goodsCategoryId===x.id?(_(),k("img",fo)):I("",!0)],8,vo))),128))])])]),_:1},8,["show"])}}}),Ce=x=>(Je("data-v-3c308831"),x=x(),Qe(),x),bo={class:"bg-white rounded-xl overflow-hidden mx-3 px-3 py-4 title"},yo={class:"text-b1 font-semibold"},_o={class:"border-b4 border-b border-solid pb-4 van-uploader__wrapper gap-1.5"},xo=["onClick"],wo={class:"van-image van-uploader__preview-image",style:{width:"60px",height:"60px"}},Co=["src"],$o=["onClick"],Io=Ce(()=>s("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),So=[Io],ko={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Vo=["src"],Do={class:"text-xs font-light text-center text-b1 opacity-30"},Po={class:"border-b4 border-b border-solid"},Ro={class:"text-default font-semibold"},To={key:0,class:"border-b4 border-b border-solid"},No={class:"text-default font-semibold"},Bo={key:1,class:"border-b4 border-b border-solid"},Fo={class:"text-default font-semibold"},Lo={class:"pt-4 font-semibold text-b1"},qo={class:"van-uploader__wrapper gap-1.5"},Uo=["onClick"],Eo={class:"van-image van-uploader__preview-image",style:{width:"60px",height:"60px"}},Oo=["src"],Mo=["onClick"],jo=Ce(()=>s("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),zo=[jo],Go={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Ao=["src"],Ko={class:"text-xs font-light text-center text-b1 opacity-30"},Ho={key:0,class:"bg-white rounded-xl m-3 overflow-hidden"},Jo={class:"text-default font-semibold"},Qo={class:"bg-white rounded-xl overflow-hidden m-3 px-3 title"},Xo={class:"border-b4 border-b border-solid"},Yo={class:"text-default font-semibold"},Zo={class:"text-default font-semibold"},Wo=Y("%"),et={key:1,class:"fixed bottom-0 left-0 w-full flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper"},ot={class:"text-b3 text-center text-sm mt-6"},tt={class:"flex items-center justify-between mt-6"},st=Z({name:"EditOfflineGoods"});function at(x){const{t:c}=Ge(),{accountStore:D,serviceCategoriesStore:F}=We(),{getCurrentStoreId:w}=eo(),{loadingToggle:L}=oo(),q=Ae(),P=Ke(),o=y({goodsId:null,shopId:null,goodsName:"",goodsIcons:"",goodsPrice:null,goodsDiscountRatio:null,goodsDesc:null,goodsPics:"",goodsStatus:1,goodsType:null,goodsCategoryId1:null,goodsCategoryName1:null,goodsCategoryId2:null,goodsCategoryName2:null,goodsCategoryId3:null,goodsCategoryName3:null,goodsCategoryId:null}),U=G(()=>!o.value.goodsName||n.value.length<=0||!o.value.goodsCategoryId1||!o.value.goodsCategoryId2||!o.value.goodsCategoryId3||!o.value.goodsPrice||!o.value.goodsDiscountRatio),n=y([]),i=y([]),f=y(0),b=y(0),E=y([]),v=y(1),A=y(null),[W,O]=H(!1),[M,ee]=H(!1),[$e,j]=H(!1),oe=G(()=>({1:c("common.boutique"),2:c("mall.Best"),3:c("shop.Star Selection")})),te=[[1,80],[4,30],[10,80],[20,80]],C=G(()=>{let e=[1,80];return f.value&&(e=te[b.value]),e}),Ie=e=>e.replace(/^(\d*\.?\d{0,4}).*$/,"$1"),se=e=>{function t(a){let d=a.replace(/[^\d.]/g,"");return d=d.replace(/(\..*)\./g,"$1"),d=f.value?d.replace(/^(\d*\.?\d{0,0}).*$/,"$1"):d.replace(/^(\d*\.?\d{0,2}).*$/,"$1"),d}return e>C.value[1]?C.value[1].toString():t(e.toString())};we(()=>f.value,()=>{o.value.goodsDiscountRatio>0&&(o.value.goodsDiscountRatio=se(o.value.goodsDiscountRatio))});const Se=()=>{if(!f.value&&b.value&&o.value.goodsDiscountRatio>0){const e=te[b.value];o.value.goodsDiscountRatio>=e[0]&&o.value.goodsDiscountRatio<=e[1]&&(f.value=b.value)}},z=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e==="x"?t:t&3|8;return a.toString(16)}),ae=e=>{let t=!1;const a=Q.split(",");for(let d=0;d<a.length;d++)if(console.log(e==null?void 0:e.type,a[d]),(e==null?void 0:e.type)===a[d]){t=!0;break}return t||V(c("common.uploadImgTypeTips",{format:a.map(d=>d.slice(6)).join("/")})),t},le=y(5),ke=async e=>{if(n.value.length>=le.value||!ae(e.file))return;V.loading({message:c("common.uploading"),forbidClick:!0,duration:0});const t=await ye(e,"goodsImg"),a=await he(t);V.clear(),a.success&&n.value.push({id:z(),url:_e.imgUrl+a.data})},Ve=e=>{n.value.splice(e,1)},De=e=>{fe({images:n.value.map(t=>t.url),startPosition:e})},ne=y(5),Pe=async e=>{if(i.value.length>=ne.value||!ae(e.file))return;V.loading({message:c("common.uploading"),forbidClick:!0,duration:0});const t=await ye(e,"goodsDesc"),a=await he(t);V.clear(),a.success&&i.value.push({id:z(),url:_e.imgUrl+a.data})},Re=e=>{i.value.splice(e,1)},Te=e=>{fe({images:i.value.map(t=>t.url),startPosition:e})},K=(e,t,a)=>{E.value=lo(F.fullCategories,{idKey:"goodsCategoryId",parentKey:"goodsCategoryParentId",rootId:t}),A.value=e,v.value=a,ee(!0)},Ne=(e,t)=>{if(o.value[`goodsCategoryId${v.value}`]=e,o.value[`goodsCategoryName${v.value}`]=t,v.value<3)for(let a=v.value;a<3;a++)o.value[`goodsCategoryId${a+1}`]=null,o.value[`goodsCategoryName${a+1}`]=null},$=e=>{V({message:e,icon:J("toast-warn.svg"),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},Be=()=>{o.value.goodsPrice<0&&($(c("offline.price_tips")),o.value.goodsPrice=Math.abs(o.value.goodsPrice))},ie=()=>{var e;return o.value.goodsName?n.value.length?((e=o.value)==null?void 0:e.goodsPrice)<=0?($(c("shop.pleaseInput")+c("goods.price")),!1):!0:($(c("offline.empty_image")),!1):($(c("offline.offline_name_placeholder")),!1)},de=async()=>{var a;const e=n.value.map(d=>d.url),t=i.value.map(d=>d.url);o.value.goodsType=f.value?b.value:X.SD,o.value.goodsIcons=e.join(","),o.value.goodsPics=t.join(","),o.value.shopId=(a=await w())==null?void 0:a.id},Fe=async()=>{if(!ie())return;O(!0),o.value.goodsStatus=xe.DRAFT,await de();const{success:e,data:t}=await be(o.value);O(!1),e&&(o.value.goodsId=t,re())},Le=async()=>{if(!ie())return;if(!o.value.goodsCategoryId1)return $(c("shop.pleaseSelect")+c("offline.one_category"));if(!o.value.goodsCategoryId2)return $(c("shop.pleaseSelect")+c("offline.two_category"));if(!o.value.goodsCategoryId3)return $(c("shop.pleaseSelect")+c("offline.three_category"));if(!o.value.goodsDiscountRatio||o.value.goodsDiscountRatio<C.value[0]||+o.value.goodsDiscountRatio>C.value[1]){const a=c("offline.empty_discount")+`<div class="text-center ">(${C.value[0]}-${C.value[1]}%)</div>`;return $(a)}O(!0),o.value.goodsStatus=xe.Published,await de();const{success:e,data:t}=await be(o.value);O(!1),e&&(o.value.goodsId=t,j(!0))},qe=()=>{var e,t;ue(),j(!1),(e=o.value)!=null&&e.goodsId&&P.replace({path:"/offlineGoodsDetail",query:{goodsId:(t=o.value)==null?void 0:t.goodsId}})},re=()=>{ue(),j(!1),P.back()},ue=()=>{var t;const e=((t=o.value)==null?void 0:t.goodsId)||q.query.goodsId||null;e&&sessionStorage.setItem("shop_offline_refresh_id",e.toString())},Ue=async()=>{var a,d;const e=(a=q.query)==null?void 0:a.goodsId;if(!e)return;const t=await ao(e.toString());t.success&&(o.value=t.data,o.value.goodsId=e.toString(),((d=o.value)==null?void 0:d.goodsType)!==X.SD&&b.value!==X.SD&&(f.value=1),o.value.goodsIcons&&(n.value=(o.value.goodsIcons||"").split(",").map(R=>({id:z(),url:R}))),o.value.goodsPics&&(i.value=o.value.goodsPics.split(",").map(R=>({id:z(),url:R}))),o.value.goodsDiscountRatio<=0&&(o.value.goodsDiscountRatio=null))},Ee=async()=>{var a;const{success:e,data:t}=await so((a=await w())==null?void 0:a.merchant);e&&(b.value=t==null?void 0:t.type)};return He(async()=>{L(!0),F.init(),await Ee(),Ue(),L(!1)}),(e,t)=>{const a=S("van-field"),d=S("van-uploader"),R=S("van-switch"),ce=S("VanButton");return _(),T(Xe,{title:e.$t("offline.published_goods"),class:"font-Puhui font-normal relative pb-20 bg-gray1",themeVars:{navBarBackgroundColor:"#F2F0EF"}},{default:g(()=>{var ge,pe;return[s("div",bo,[s("div",yo,p(e.$t("offline.offline_name")),1),h(a,{modelValue:o.value.goodsName,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.goodsName=l),autosize:"",type:"text",placeholder:e.$t("offline.offline_name_placeholder"),maxlength:"50",class:"no-bt"},null,8,["modelValue","placeholder"]),s("div",_o,[h(u(me),ve({class:"flex flex-wrap gap-1.5",modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=l=>n.value=l),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:g(({element:l,index:r})=>[s("div",{class:"van-uploader__preview",onClick:N(m=>De(r),["stop"])},[s("div",wo,[s("img",{src:l.url,class:"van-image__img rounded-md",style:{"object-fit":"cover"}},null,8,Co)]),s("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:N(m=>Ve(r),["stop"])},So,8,$o)],8,xo)]),_:1},16,["modelValue","handle"]),n.value.length<le.value?(_(),T(d,{key:0,accept:u(Q),afterRead:ke},{default:g(()=>[s("div",ko,[s("img",{src:u(J)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,Vo),s("div",Do,p(e.$t("offline.main_image")),1)])]),_:1},8,["accept"])):I("",!0)]),s("div",Po,[h(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[2]||(t[2]=l=>{var r;return K((r=o.value)==null?void 0:r.goodsCategoryId1,0,1)})},{label:g(()=>[s("div",Ro,p(e.$t("offline.one_category")),1)]),input:g(()=>{var l,r,m;return[s("div",{class:B(["dropdown text-b3",{"!text-b2":(l=o.value)==null?void 0:l.goodsCategoryId1,"down-active":v.value===1&&u(M)}])},p((r=o.value)!=null&&r.goodsCategoryId1?(m=o.value)==null?void 0:m.goodsCategoryName1:e.$t("shop.pleaseSelect")),3)]}),_:1})]),(ge=o.value)!=null&&ge.goodsCategoryId1?(_(),k("div",To,[h(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[3]||(t[3]=l=>{var r,m;return K((r=o.value)==null?void 0:r.goodsCategoryId2,(m=o.value)==null?void 0:m.goodsCategoryId1,2)})},{label:g(()=>[s("div",No,p(e.$t("offline.two_category")),1)]),input:g(()=>{var l,r,m;return[s("div",{class:B(["dropdown text-b3",{"!text-b2":(l=o.value)==null?void 0:l.goodsCategoryId2,"down-active":v.value===2&&u(M)}])},p((r=o.value)!=null&&r.goodsCategoryId2?(m=o.value)==null?void 0:m.goodsCategoryName2:e.$t("shop.pleaseSelect")),3)]}),_:1})])):I("",!0),(pe=o.value)!=null&&pe.goodsCategoryId2?(_(),k("div",Bo,[h(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[4]||(t[4]=l=>{var r,m;return K((r=o.value)==null?void 0:r.goodsCategoryId3,(m=o.value)==null?void 0:m.goodsCategoryId2,3)})},{label:g(()=>[s("div",Fo,p(e.$t("offline.three_category")),1)]),input:g(()=>{var l,r,m;return[s("div",{class:B(["dropdown text-b3",{"!text-b2":(l=o.value)==null?void 0:l.goodsCategoryId3,"down-active":v.value===3&&u(M)}])},p((r=o.value)!=null&&r.goodsCategoryId3?(m=o.value)==null?void 0:m.goodsCategoryName3:e.$t("shop.pleaseSelect")),3)]}),_:1})])):I("",!0),s("div",Lo,p(`${e.$t("goods.goodsDesc")}`),1),h(a,{modelValue:o.value.goodsDesc,"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.goodsDesc=l),rows:"1",autosize:"",type:"textarea",placeholder:e.$t("goods.pleaseInputDesc"),class:"no-bt",style:{"padding-top":"8px !important","padding-bottom":"8px !important"}},null,8,["modelValue","placeholder"]),s("div",qo,[h(u(me),ve({class:"flex flex-wrap gap-1.5",modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=l=>i.value=l),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:g(({element:l,index:r})=>[s("div",{class:"van-uploader__preview",onClick:N(m=>Te(r),["stop"])},[s("div",Eo,[s("img",{src:l.url,class:"van-image__img rounded-md",style:{"object-fit":"cover"}},null,8,Oo)]),s("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:N(m=>Re(r),["stop"])},zo,8,Mo)],8,Uo)]),_:1},16,["modelValue","handle"]),i.value.length<ne.value?(_(),T(d,{key:0,accept:u(Q),afterRead:Pe},{default:g(()=>[s("div",Go,[s("img",{src:u(J)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,Ao),s("div",Ko,p(e.$t("goods.descImage")),1)])]),_:1},8,["accept"])):I("",!0)])]),b.value?(_(),k("div",Ho,[h(a,{"input-align":"right",autocomplete:"off",class:"no-bt",style:{"padding-top":"16px !important","padding-bottom":"16px !important"},label:`*${e.$t("goods.setting boutique good"),{type:u(oe)[b.value]}}`},{label:g(()=>[s("div",Jo,p(`${e.$t("goods.setting boutique good",{type:u(oe)[b.value]})}`),1)]),input:g(()=>[h(R,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=l=>f.value=l),"active-color":"#FF8812","inactive-color":"#B7B4B0","active-value":1,"inactive-value":0,size:"20"},null,8,["modelValue"])]),_:1},8,["label"])])):I("",!0),s("div",Qo,[s("div",Xo,[h(a,{"input-align":"right",type:"number",autocomplete:"off",modelValue:o.value.goodsPrice,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.goodsPrice=l),onBlur:Be,formatter:Ie,placeholder:e.$t("shop.pleaseInput"),class:"no-bt"},{label:g(()=>[s("div",Yo,p(e.$t("offline.mcPrice")),1)]),_:1},8,["modelValue","placeholder"])]),h(a,{class:"no-bt","input-align":"right",type:f.value?"digit":"number",autocomplete:"off",modelValue:o.value.goodsDiscountRatio,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.goodsDiscountRatio=l),formatter:se,placeholder:`${e.$t("shop.pleaseInput")}${u(C)[0]}-${u(C)[1]}`,onBlur:Se},{label:g(()=>[s("div",Zo,p(`${e.$t("offline.discountRatio")} `),1)]),"right-icon":g(()=>[Wo]),_:1},8,["type","modelValue","placeholder"])]),u(D).isOnlyView?I("",!0):(_(),k("div",et,[h(ce,{round:"",type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-full border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:t[10]||(t[10]=l=>Fe()),loading:u(W)},{default:g(()=>[Y(p(e.$t("goods.saveDraft")),1)]),_:1},8,["loading"]),h(ce,{round:"",class:B(["flex-1 min-w-[130px] h-[46px] text-base font-semibold",u(U)?"bg-b4 text-b2":"bg-btnOrBg text-b1"]),disabled:u(U),onClick:t[11]||(t[11]=l=>Le()),loading:u(W)},{default:g(()=>[Y(p(e.$t("goods.upimmediately")),1)]),_:1},8,["disabled","class","loading"])])),u(M)?(_(),T(ho,{key:2,list:E.value,level:v.value,id:A.value,onSelect:Ne,onClose:t[12]||(t[12]=l=>u(ee)(!1))},null,8,["list","level","id"])):I("",!0),h(to,{noClose:"",name:e.$t("offline.published_success"),show:u($e),onClose:t[14]||(t[14]=l=>u(j)(!1))},{default:g(()=>[s("div",ot,p(e.$t("offline.published_success_desc")),1),s("div",tt,[s("div",{class:"flex-1 h-[46px] leading-[44px] rounded-full text-center border border-solid-b4 mr-3",onClick:qe},p(e.$t("flashSale.check-the-details")),1),s("div",{class:"flex-1 h-[46px] leading-[46px] rounded-full text-center bg-yellow",onClick:t[13]||(t[13]=l=>re())},p(e.$t("common.back list")),1)])]),_:1},8,["name","show"])]}),_:1},8,["title"])}}const lt=Z({...st,setup:at}),mt=ze(lt,[["__scopeId","data-v-3c308831"]]);export{mt as default};
