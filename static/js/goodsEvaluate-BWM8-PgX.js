import{z,F as b,G as d,H as n,J as V,K as U,N as Q,Z as y,U as L,I as A,Q as x,x as Y,o as Z,q as W,r as i,y as w,D as X,E as ee,P as G,O as m,$ as te,V as ae,by as oe}from"./vendor-Dr_RpJ_Y.js";import{_ as le}from"./GoodsEvaluateItem-A2TGR4vS.js";import{_ as P}from"./DefaultPage-BbbCICPU.js";import{_ as ue}from"./EvalHeader-BnKRlnel.js";import{j as ne,k as se,l as ie}from"./order-D0_No2Ew.js";import{az as ve,k as S}from"./index-7OiUoGXy.js";import"./BackIcon-CDrGaEPo.js";const re={class:"flex items-center gap-2 overflow-x-auto"},de=["onClick"],ce={key:1},me=z({props:{list:null,value:null},emits:["change"],setup(_,{emit:f}){return(p,T)=>{const r=b("van-icon");return n(),d("div",re,[(n(!0),d(V,null,U(_.list,l=>(n(),d("div",{class:Q(["flex items-center flex-shrink-0 px-2 text-sm leading-6 rounded",{" bg-primary text-white":_.value===l.id,"bg-yellow-004":_.value!==l.id}]),key:l.id,onClick:C=>f("change",l.id)},[l.id===1?(n(),y(r,{key:0,class:"mr-1.5",name:"photo-o",size:"16"})):L("",!0),A("span",null,x(l.name),1),l.id?(n(),d("span",ce,"("+x(l.count)+")",1)):L("",!0)],10,de))),128))])}}}),fe={class:"px-2.5 font-normal"},ge={class:"bg-white rounded-xl p-2.5 min-h-[calc(100%-44px)]"},pe=z({name:"EvaluateGood"});function Ce(_){const{t:f}=Y(),p=Z(),T=W(),r=i(null),l=i(null),C=i(!0),a=i({}),F=async()=>{const e=await ne(l.value);e.success&&(C.value=e.data.defaultGoodFlag,a.value=e.data)},u=i(null),M=w(()=>{let e=0;const t=a.value.goodCount-a.value.defaultGoodCount,o=a.value.differenceCount-a.value.notContentDifferenceCount;switch(u.value){case 1:e=a.value.imgCount;break;case 2:e=t;break;case 3:e=o;break;default:e=o+t+a.value.imgCount;break}return e}),N=w(()=>{var t,o,$,v;let e=0;switch(u.value){case 1:e=0;break;case 2:e=(t=a.value)==null?void 0:t.defaultGoodCount;break;case 3:e=(o=a.value)==null?void 0:o.notContentDifferenceCount;break;default:e=(($=a.value)==null?void 0:$.defaultGoodCount)+((v=a.value)==null?void 0:v.notContentDifferenceCount);break}return e}),O=w(()=>{var e,t,o;return[{id:null,name:f("common.all"),count:k.value},{id:1,name:f("evaluate.picture"),count:(e=a.value)==null?void 0:e.imgCount},{id:2,name:f("evaluate.Good reviews"),count:(t=a.value)==null?void 0:t.goodCount},{id:3,name:f("evaluate.Bad review"),count:(o=a.value)==null?void 0:o.differenceCount}]}),R=e=>{u.value!==e&&(u.value=e,q())},g=i(!1),c=i(!1),s=i([]),h=i(0),B=i(10),k=i(0),j=async()=>{const e=r.value?se:ie,t=r.value?{page:h.value,size:B.value,shopId:r.value}:{page:h.value,size:B.value,goodsId:l.value,commentLevel:u.value,commentDefaultGoodFlag:0},o=await e(t);if(!o.success){c.value=!0;return}if(!o.data||!o.total){c.value=!0;return}k.value=o.total,s.value=h.value===1?o.data:s.value.concat(o.data),s.value.length>=k.value&&(c.value=!0)},D=w(()=>{if(s.value&&s.value.length>0){const e=[];for(let t=0;t<s.value.length;t++)s.value[t].commentImages&&s.value[t].commentImages.length>0&&e.push(...s.value[t].commentImages.split(","));return e}return[]}),H=e=>{const t=D.value.findIndex(o=>o===e);oe({images:D.value,closeable:!0,showIndex:!0,startPosition:t})},E=async()=>{var e;if(C.value&&((e=a.value)==null?void 0:e.defaultGoodCount)>0){g.value=!1,c.value=!0;return}g.value=!0,h.value+=1,await j(),setTimeout(()=>{g.value=!1},1e3)},q=()=>{s.value=[],h.value=0,k.value=0,c.value=!1,g.value=!1,E()},J=async()=>{u.value=null,C.value=!0,await F(),q()},I=e=>{T.push(e)};return X(()=>p.query.goodsId,e=>{p.path.includes("/evaluate-good?goodsId=")&&l.value!==e&&l.value&&(l.value=e,console.log("222"),J())},{deep:!0,immediate:!0}),ee(()=>{l.value=p.query.goodsId,r.value=p.query.shopId,l.value&&F(),r.value}),(e,t)=>{const o=b("VanList"),$=b("router-view");return n(),d("div",fe,[G(ue,{title:r.value?"門店評價":e.$t("evaluate.product review")},null,8,["title"]),A("div",ge,[G(me,{list:m(O),value:u.value,onChange:R},null,8,["list","value"]),a.value.defaultGoodCount>0&&(C.value&&u.value!==1&&u.value!==3||u.value===2&&a.value.defaultGoodCount===a.value.goodCount)?(n(),y(P,{key:0,class:"text-sm",needTextTop:!0,titleColor:"#222221",url:m(S)("images/default_evaluate.png"),title:`<div style='margin-bottom:8px;'>${e.$t("evaluate.default positive reviews",{num:a.value.defaultGoodCount})}</div><div>${e.$t("evaluate.positive review time",{time:m(ve)(a.value.defaultLastTime,"Y-m-d")})}</div>`,top:"9rem"},null,8,["url","title"])):!m(M)&&m(N)>0?(n(),d("div",{key:1,class:"py-8 text-sm text-center",onClick:t[0]||(t[0]=v=>I(`/evaluate-good-default?goodsId=${l.value}&commentLevel=${u.value}`))},x(e.$t("evaluate.without content",{num:m(N)})),1)):c.value&&k.value===0?(n(),y(P,{key:2,needTextTop:!0,titleColor:"#A45E00",url:m(S)("images/evaluate_empty.png"),title:e.$t("evaluate.No reviews yet"),top:"9rem",iconSize:"16rem"},null,8,["url","title"])):(n(),y(o,{key:3,class:"mt-4",loading:g.value,"onUpdate:loading":t[2]||(t[2]=v=>g.value=v),finished:c.value,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:E},{default:te(()=>[(n(!0),d(V,null,U(s.value,(v,K)=>(n(),y(le,{onImgPre:H,style:ae(K===s.value.length-1?"margin-bottom: 1rem":""),onClick:he=>I(`/evaluate-detail?goodOrderId=${v.id}`),data:v,key:v.id},null,8,["style","onClick","data"]))),128)),a.value.defaultGoodCount>0&&u.value!==1&&u.value!==3?(n(),d("div",{key:0,class:"text-sm text-center",onClick:t[1]||(t[1]=v=>I(`/evaluate-good-default?goodsId=${l.value}&commentLevel=${u.value}`))},x(e.$t("evaluate.without content",{num:a.value.defaultGoodCount})),1)):L("",!0)]),_:1},8,["loading","finished","finished-text","loading-text"]))]),G($,{class:"child-view bg-[#f2f0ef]"})])}}const Ge=z({...pe,setup:Ce});export{Ge as default};
