import{S as U,G as V,a as N,_ as j,b as X}from"./ShareGoodPopup-zhyrvy1f.js";import{y as P,bd as Y,x as D,z as J,F as _,G as d,H as u,Q as $,P as n,I as K,J as M,K as p,X as Q,br as W,_ as Z,bc as A,r as m,w as ee,a1 as oe,l as se,bh as te,bH as ae,D as le,a2 as h,O as F,R as ne,Y as ie,Z as re,T as de}from"./vendor-D6JO6WHW.js";import{_ as ue}from"./GoodsEvaluateItem-CPvsHAUn.js";import{aU as ce,e as me,r as pe,ar as ge,X as fe,W as ve,V as ye}from"./index-Ds2hFbCb.js";import{G as he,c as Ie,d as we}from"./GoodsInfo-Di_lfOlS.js";import{R as _e}from"./RemovedShelves-Cm467x07.js";import{S as Se}from"./shop-CeqcS6K2.js";import{O as be}from"./offlineGoods-Biq4pIIG.js";import{D as L}from"./goods-BVwS8oFG.js";import"./kefu-BZ7ykajd.js";import"./goods-D9J6xzPW.js";import"./convertToImage-BC1GnIIG.js";import"./browser-DFlSdkZC.js";import"./upload-EllNmkoq.js";import"./active_empty-CBz3QrKQ.js";import"./HelpPop-nJzX1W44.js";import"./BoutiqueLabelInLogo-Cv7_YziD.js";import"./RatioBox-OiqLR9-W.js";import"./MCOIN-BcbOHmhy.js";import"./logo-CT48NEDW.js";import"./BoutiqueLable-B4X4LLB8.js";import"./flashSale-DDyqLyYN.js";import"./GoodsPrice-DdCD8Nfm.js";import"./enums-DlE-aiss.js";import"./BackIcon-CPUEW9je.js";const Te={class:"relative mb-2 w-full flex justify-center items-center"},xe={class:"text-sm font-semibold text-center"},ke={class:"absolute right-0 top-0 text-[12px] text-[#999999] leading-[20px]"},$e=P({props:{goodsId:null},emits:["handleTo"],setup(c,{emit:S}){const g=c,t=Y({commentList:[],total:0}),b=async()=>{const i=await ce({goodsId:g.goodsId,page:1,size:1,commentStatus:1,sortBy:"desc|comment_time"});i.success&&(t.commentList=i.data.records||[],t.total=i.data.total)},f=D(()=>{if(t.commentList&&t.commentList.length>0){const i=[];for(let s=0;s<t.commentList.length;s++)t.commentList[s].commentPics&&t.commentList[s].commentPics.length>0&&i.push(...t.commentList[s].commentPics.split(","));return i}return[]}),T=i=>{const s=f.value.findIndex(e=>e===i);W({images:f.value,closeable:!0,showIndex:!0,startPosition:s})};return J(()=>g.goodsId,()=>{b()},{immediate:!0}),(i,s)=>(d(),_("div",{class:"p-2.5 mb-2.5 bg-white rounded-xl text-base",onClick:s[0]||(s[0]=e=>S("handleTo",`/offline-evaluate-home?goodsId=${c.goodsId}`))},[u("div",Te,[u("div",xe,$(i.$t("evaluate.Buyer Reviews"))+"（"+$(n(t).total)+"） ",1),u("div",ke,$(i.$t("common.all"))+" > ",1)]),(d(!0),_(K,null,M(n(t).commentList,(e,a)=>(d(),p(ue,{onImgPre:T,key:e.id,data:e,class:"border-none",style:Q(a===n(t).commentList.length-1?"margin-bottom:0":"")},null,8,["data","style"]))),128))]))}}),C=c=>(ie("data-v-1de02726"),c=c(),re(),c),Fe={class:"relative w-full h-full !bg-[#F8F8F8]"},Le={key:0},Pe=C(()=>u("img",{class:"w-[1.375rem] h-[1.375rem]",src:j},null,-1)),Be=[Pe],De=C(()=>u("img",{class:"w-[1.375rem] h-[1.375rem]",src:X},null,-1)),Ce=[De],Ge={class:"safe-bottom-page pt-4 px-2.5 bg-[#F8F8F8]"},Oe=P({name:"GoodsDetail"});function He(c){const{orderGoodsStore:S}=me(),[g,t]=A(!1),b=m(!1),{loadingToggle:f}=pe(),{t:T}=ee(),i=oe(),s=se(),e=m(null),a=m(null),x=m(i.query.goodsId),G=D(()=>window.location.origin+"/#/offlineGoodsDetail?goodsId="+x.value),O=async()=>{const o=x.value;if(o==null||o==="")return;const l=await fe(o);e.value=l.data,e.value.icons=e.value.goodsIcons,e.value.type=e.value.goodsType,e.value.deliveryType=L.offeline,e.value.price=e.value.goodsPrice},H=async()=>{var r;if(!((r=e.value)!=null&&r.shopId))return;const{success:o,data:l}=await ve(e.value.shopId);o&&(a.value=l)},v=m(null),y=o=>{s.push(o)},R=()=>{de({message:T("common.Saved successfully"),icon:ye("toast-success.svg"),duration:3e3})},q=()=>{try{window.history.state.back?s.back():window.history.length>2?window.history.back():s.replace({path:"/mall"})}catch{s.push("/")}},z=()=>{S.changeOfflineInfo({goods:e.value,store:a.value}),y(`/offlineSubmit?key=${x.value}&orderType=${be.GOODS}`)},B=m(0);let I=m(!0);const k=ae(()=>{const o=document.getElementById("fm-page");B.value=o.scrollY||o.scrollTop,B.value<100?(I.value=!1,v.value&&v.value.resumeSwiper()):(I.value=!0,v.value&&v.value.pauseSwiper())},100),E=()=>{document.getElementById("fm-page").addEventListener("scroll",k),k()};return te(()=>{const o=document.getElementById("fm-page");o&&o.removeEventListener("scroll",k)}),le(async()=>{E(),f(!0),await O(),await H(),f(!1)}),(o,l)=>(d(),_("div",Fe,[e.value&&a.value&&+e.value.goodsStatus==1&&+a.value.status!=3&&+a.value.status!=4&&+a.value.status!=0?(d(),_("div",Le,[u("header",{class:ne(["flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[44px] px-2.5 fixed",{"bg-white":n(I)," bg-black/0":!n(I)}])},[u("div",{class:"flex flex-wrap items-center",onClick:q},Be),u("div",{onClick:l[0]||(l[0]=r=>n(t)(!0))},Ce)],2),F(he,{ref:(r,w)=>{w.goodsImgRef=r,v.value=r},imgs:(e.value.goodsIcons||"").split(","),goodsTypes:n(L).offeline},null,8,["imgs","goodsTypes"]),F(Ie,{stores:a.value,goods:e.value,class:"relative z-10"},null,8,["stores","goods"]),u("div",Ge,[F($e,{onHandleTo:y,goodsId:e.value.goodsId},null,8,["goodsId"]),a.value.id?(d(),p(U,{key:0,store:a.value,onHandleTo:y},null,8,["store"])):h("",!0),e.value.goodsDesc||e.value.goodsPics?(d(),p(we,{key:1,text:e.value.goodsDesc,imgs:(e.value.goodsPics||"").split(",")},null,8,["text","imgs"])):h("",!0)]),e.value.goodsId?(d(),p(V,{key:0,goods:e.value,goodsId:e.value.goodsId,boutiqueFlag:e.value.goodsType>=n(Se).SD,isFollow:b.value,deliveryType:n(L).offeline,storeInfo:a.value,onHandeToShop:l[1]||(l[1]=r=>y(`/category?deliveryType=1&shopId=${a.value.id}`)),onHandleConnect:l[2]||(l[2]=r=>{var w;return y(`/shopInfo?address=${(w=a.value)==null?void 0:w.merchant}`)}),onHandleOffine:l[3]||(l[3]=r=>z())},null,8,["goods","goodsId","boutiqueFlag","isFollow","deliveryType","storeInfo"])):h("",!0)])):e.value&&!n(ge)?(d(),p(_e,{key:1,type:"good"})):h("",!0),n(g)?(d(),p(N,{key:2,show:n(g),onOnSuceess:R,onClose:l[4]||(l[4]=r=>n(t)(!1)),goods:e.value,"code-url":n(G)},null,8,["show","goods","code-url"])):h("",!0)]))}const Re=P({...Oe,setup:He}),uo=Z(Re,[["__scopeId","data-v-1de02726"]]);export{uo as default};
