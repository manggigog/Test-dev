import{_ as He}from"./arrow-down-585654-DxqU-60D.js";import{_ as Ue,z as Te,x as qe,q as Oe,r as y,o as je,a2 as Fe,bl as Re,E as ze,F as x,G as C,H as N,I as o,U as Ge,P as i,Q as v,$ as A,O as m,J as Je,K as Qe,a4 as We,X as Xe,Y as Ye,T as w}from"./vendor-Dr_RpJ_Y.js";import{a as Ze,v as es,B as ss}from"./order-D4JYoGRo.js";import{B as as}from"./BackIcon-CDrGaEPo.js";import{V as ts}from"./index-CU2nzZe6.js";const Ie=f=>(Xe("data-v-2d8fd5e7"),f=f(),Ye(),f),os={class:"font-Puhui main-bg safe-bottom-page"},rs={class:"header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md"},ds={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ns={class:"font-bold text-base text-b1"},ls={key:0,class:"safe-bottom pt-[50px] rounded-xl px-3"},is={class:"rounded-xl bg-white overflow-hidden px-3"},ps=Ie(()=>o("img",{src:He,class:"w-4 h-4 m-[2px]",alt:""},null,-1)),cs=Ie(()=>o("div",{class:"h-px bg-[#e5e5e5]"},null,-1)),us={class:"flex justify-center items-center relative h-14 font-bold text-[22px] text-[#3a2e13]"},ms={class:"flex-1 text-center text-base font-semibold text-b1"},fs={class:"pl-4 pr-4 pb-4 h-[calc(100%-56px)] overflow-y-scroll"},hs=["onClick"],ys={class:"text-b1"},xs={class:"popup-footer w-full fixed bottom-0 left-0 right-0 safe-bottom px-3"},vs=Te({name:"SellerDelivery"});function _s(f){const{t:I}=qe(),k=Oe(),{getMerchantDhKey:_,decryptAddressKey:ke,decryptKey:D,cryptoAESWithSearch:De,encryptKey:V}=ts();y(!1);const E=je(),Ve=E.query.id,Ee=E.query.detail,h=y(null),L=y(!1),Le=async()=>{var d,l,t,b,g,K,S,$,B,M,P,H,U,T,q,O,j,F,R,z,G,J,Q,W,X,Y,Z,ee,se,ae,te,oe,re,de,ne,le,ie,pe,ce,ue,me,fe,he,ye,xe,ve,_e,be,ge,Ce,Ne,Ae;const e=await Ze({id:Ve});let s="";if((d=e.data)!=null&&d.userAddress&&(e.data.userAddress.postscript=e.data.postscript),(l=e.data)!=null&&l.userAddress&&((b=(t=e.data)==null?void 0:t.userAddress)!=null&&b.encryptFlag)){const n=await _(e.data.address,(g=e.data)==null?void 0:g.submitUserPubKey);n&&(e.data.userAddress=ke(e.data.userAddress,n),(S=(K=e.data)==null?void 0:K.userAddress)!=null&&S.success&&!(($=e.data)!=null&&$.merchantEns)&&(s+=((M=(B=e.data)==null?void 0:B.userAddress)==null?void 0:M.userName)+((H=(P=e.data)==null?void 0:P.userAddress)==null?void 0:H.telNumber)+(((T=(U=e.data)==null?void 0:U.userAddress)==null?void 0:T.postalCode)??"")+((O=(q=e.data)==null?void 0:q.userAddress)==null?void 0:O.provinceName)+((F=(j=e.data)==null?void 0:j.userAddress)==null?void 0:F.cityName)+((z=(R=e.data)==null?void 0:R.userAddress)==null?void 0:z.countyName)+((J=(G=e.data)==null?void 0:G.userAddress)==null?void 0:J.detailInfo)+((W=(Q=e.data)==null?void 0:Q.userAddress)==null?void 0:W.postscript)))}else(X=e.data)!=null&&X.merchantEns||(s+=((Z=(Y=e.data)==null?void 0:Y.userAddress)==null?void 0:Z.userName)+((se=(ee=e.data)==null?void 0:ee.userAddress)==null?void 0:se.telNumber)+(((te=(ae=e.data)==null?void 0:ae.userAddress)==null?void 0:te.postalCode)??"")+((re=(oe=e.data)==null?void 0:oe.userAddress)==null?void 0:re.provinceName)+((ne=(de=e.data)==null?void 0:de.userAddress)==null?void 0:ne.cityName)+((ie=(le=e.data)==null?void 0:le.userAddress)==null?void 0:ie.countyName)+((ce=(pe=e.data)==null?void 0:pe.userAddress)==null?void 0:ce.detailInfo)+((me=(ue=e.data)==null?void 0:ue.userAddress)==null?void 0:me.postscript));if(e.data.shippingHash){const n=await _(e.data.address,(fe=e.data)==null?void 0:fe.shippingUserPubKey);if(n){const we=D(e.data.expressNo,n);we.hash===e.data.shippingHash&&(e.data.expressNo=we.decrypt,e.data.expressCompany=D(e.data.expressCompany,n).decrypt,(he=e.data)!=null&&he.merchantEns||(s+=((ye=e.data)==null?void 0:ye.expressNo)+((xe=e.data)==null?void 0:xe.expressCompany)))}else(ve=e.data)!=null&&ve.merchantEns||(s+=((_e=e.data)==null?void 0:_e.expressNo)+((be=e.data)==null?void 0:be.expressCompany));(ge=e.data)!=null&&ge.merchantEns||(s+=((Ce=e.data)==null?void 0:Ce.hash)+((Ne=e.data)==null?void 0:Ne.address))}const u=[{id:(Ae=e.data)==null?void 0:Ae.id,merchantEns:await De(s)}].filter(n=>n.merchantEns);u.length>0&&es({enInfoList:u}),h.value=e.data},[Ke,Se]=Fe(!1),p=y(!1),$e=["无需发货","到付运费","顺丰速运","中国邮政EMS","京东物流","中通快递","圆通速递","韵达快递","申通快递","极兔速递","其他"],a=Re({expressCompany:"",expressNo:"",orderId:""}),Be=e=>{a.expressCompany=e,p.value=!1},Me=()=>{p.value=!1},Pe=async()=>{var s;if(L.value)return;c(!0),a.orderId=h.value.id;const e=await _((s=h.value)==null?void 0:s.address);try{if(!a.expressCompany){w.fail(I("order.deliveryCompanyPlaceholder")),c(!1);return}if(a.expressCompany!=="无需发货"&&!a.expressNo){w.fail(I("order.express empty")),c(!1);return}let r={expressCompany:a.expressCompany,expressNo:a.expressNo,orderId:a.orderId,shippingHash:null};if(e){const d=V(a.expressNo,e);r.expressNo=d.encrypt,r.shippingHash=d.hash;const l=V(a.expressCompany,e);r.expressCompany=l.encrypt}if((await ss(r)).success){const d=Ee?-2:-1;k.go(d),setTimeout(()=>{k.replace({path:"/sellerOrderList",query:{active:3,type:1}})},50)}c(!1)}catch(r){c(!1),w.fail(r.message)}},c=(e=!0)=>{Se(e),L.value=e};return ze(async()=>{await Le()}),(e,s)=>{const r=x("van-field"),u=x("van-icon"),d=x("van-popup"),l=x("VanButton");return N(),C("div",os,[o("section",rs,[o("div",ds,[i(as)]),o("div",ns,v(e.$t("order.deliveryInfo")),1)]),h.value?(N(),C("div",ls,[o("div",is,[i(r,{modelValue:m(a).expressCompany,"onUpdate:modelValue":s[0]||(s[0]=t=>m(a).expressCompany=t),label:e.$t("order.deliveryCompany"),placeholder:e.$t("order.deliveryCompanyPlaceholder"),border:!1,"input-align":"right",readonly:"",onClick:s[1]||(s[1]=t=>p.value=!0)},{"right-icon":A(()=>[ps]),_:1},8,["modelValue","label","placeholder"]),cs,i(r,{modelValue:m(a).expressNo,"onUpdate:modelValue":s[2]||(s[2]=t=>m(a).expressNo=t),label:e.$t("order.deliveryId"),placeholder:e.$t("order.deliveryPlaceholder"),border:!1,"input-align":"right",maxlength:150},null,8,["modelValue","label","placeholder"]),i(d,{show:p.value,"onUpdate:show":s[3]||(s[3]=t=>p.value=t),position:"bottom",round:"",style:{width:"100%",borderRadius:"20px 20px 0 0",maxHeight:"90vh",height:"660px"}},{default:A(()=>[o("div",us,[o("span",ms,v(e.$t("order.deliveryCompany")),1),i(u,{name:"cross",class:"absolute right-4 top-1/2 -translate-y-1/2 text-2xl",onClick:Me})]),o("div",fs,[(N(),C(Je,null,Qe($e,(t,b)=>o("div",{key:t,class:"text-b1 py-4 border-b border-[#D9D9D9]",onClick:g=>Be(t)},[o("span",ys,v(t),1)],8,hs)),64))])]),_:1},8,["show"])]),o("div",xs,[i(l,{round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full w-full",loading:m(Ke),onClick:Pe},{default:A(()=>[We(v(e.$t("order.Ship")),1)]),_:1},8,["loading"])])])):Ge("",!0)])}}const bs=Object.assign(vs,{setup:_s}),Is=Ue(bs,[["__scopeId","data-v-2d8fd5e7"]]);export{Is as default};
