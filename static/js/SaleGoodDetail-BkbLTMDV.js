import{b as ze,S as Oe,c as Ue,G as Ve,_ as He,a as Me}from"./GivePointsLable-DiIMmI_A.js";import{_ as Z,z as O,r,E as U,F as D,G as a,H as o,I as e,U as f,O as d,Q as l,P as _,$ as I,N as R,X as we,Y as ke,a2 as ie,ab as qe,a4 as B,a3 as ue,bl as Ge,y as G,Z as b,K as ce,J as de,x as Se,T as ee,a9 as Ze,B as re,o as Je,q as Ke,A as Qe}from"./vendor-Dr_RpJ_Y.js";import{P as z}from"./flashSale-DDyqLyYN.js";import{S as We}from"./SubmitOrderPop-XED6G3TY.js";import{h as X,p as _e,an as te,f as Te,e as $e,c as Xe,b as Ye,ar as et,w as tt,bq as st,bk as k,as as ot,bl as lt,r as at}from"./index-CU2nzZe6.js";import{_ as nt}from"./OrderPopBorder-DFisj2bb.js";import{l as Ae}from"./luckyShopContract-DunEf0Vg.js";import{c as it}from"./goods-CMFNhadQ.js";import{_ as ut}from"./BoutiqueLable-DDlxeK08.js";import{_ as ct}from"./GoodsPrice-BO5T8eoh.js";import{R as dt}from"./RatioBox-BwMA7vB_.js";import{D as ne}from"./goods-BVwS8oFG.js";import{F as Y}from"./enums-DlE-aiss.js";import{R as rt}from"./RemovedShelves-CK5gRgpW.js";import"./shop-CeqcS6K2.js";import"./OrderGoodsBox-CaKjIkvQ.js";import"./mall-C69gPh5W.js";import"./MCOIN-BOqZVkND.js";import"./OrderGoods-GRYu2N4C.js";import"./ShopMaskTips-ClYuWX9C.js";import"./ApproveButton-j0GrW5es.js";import"./BackIcon-CDrGaEPo.js";const mt="/static/images/prize-redeem-BgHjSMZp.png",vt="/static/images/gongxi-Cs9STMoQ.png",J=t=>(we("data-v-1a85a397"),t=t(),ke(),t),pt={class:"bg-sale flex-center-bw p-2.5 mb-4"},ft={key:0,class:"text-[#FB1A18] text-3xl font-semibold mb-1"},ht=J(()=>e("span",{class:"text-sm font-normal"},"Mcoin",-1)),gt={key:1,class:"text-[#FB1A18] text-3xl mb-1"},yt={class:"text-xs"},xt=J(()=>e("span",{class:"text-sm font-normal"},"Symbol",-1)),bt={class:"flex items-center"},$t={class:"text-[#D7894E] text-xs line-through mr-2.5"},wt={key:0,class:"bg-[#FB1A18] text-white h-4 text-xs flex items-center px-1 rounded"},kt={key:2,class:"text-[#FB1A18] text-base mb-1"},St={class:"text-xs font-normal"},_t=J(()=>e("span",{class:"text-sm font-normal"},"Symbol",-1)),Tt={class:"mb-1 text-lg text-white"},At=J(()=>e("span",{class:"text-[#C96C26] mr-1"},":",-1)),Ct=J(()=>e("span",{class:"text-[#C96C26] mr-1"},":",-1)),It=O({props:{goods:null,systemTime:null,cutdownTimestamp:null,startTime:null,totalAmount:null},emits:["changeTime"],setup(t,{expose:S,emit:v}){const i=t,y=r(null),h=()=>{y.value.pause()},$=()=>{y.value.reset()},p=async()=>{v("changeTime")};return U(async()=>{}),S({pause:h,reset:$}),(u,m)=>{const s=D("van-count-down");return o(),a("div",pt,[e("div",null,[t.goods.payType!==d(z).STORE_CARD?(o(),a("div",ft,[e("span",null,l(i.goods.price),1),ht])):f("",!0),t.goods.payType===d(z).STORE_CARD?(o(),a("div",gt,[e("span",yt,l(u.$t("flashSale.storePrice"))+"：",1),e("span",null,l(i.goods.cardPrice),1),xt])):f("",!0),e("div",bt,[e("div",$t,l(i.goods.totalPrice)+" Mcoin ",1),t.goods.purchaseLimit!==t.totalAmount&&t.totalAmount?(o(),a("div",wt,l(u.$t("flashSale.purchaseLimit",{number:t.goods.purchaseLimit})),1)):f("",!0)]),t.goods.payType===d(z).MIX?(o(),a("div",kt,[e("span",St,l(u.$t("flashSale.storePrice"))+"：",1),e("span",null,l(i.goods.cardPrice),1),_t])):f("",!0)]),e("div",null,[e("div",Tt,l(u.$t("common.one sale actives")),1),_(s,{class:"text-[#000] flex items-center",ref:(n,g)=>{g.countDown=n,y.value=n},time:i.cutdownTimestamp,format:"DD 天 HH 时 mm 分 ss 秒",onFinish:p},{default:I(n=>[e("div",{class:R(["min-w-[32px] text-center text-lg rounded-lg p-1 mr-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},l(n.hours+n.days*24<10?`0${n.hours+n.days*24}`:n.hours+n.days*24),3),At,e("div",{class:R(["w-[32px] text-center text-lg rounded-lg p-1 mr-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},l(n.minutes<10?`0${n.minutes}`:n.minutes),3),Ct,e("div",{class:R(["w-[32px] text-center text-lg rounded-lg p-1",i.startTime>0?"bg-[#d9d9d9] text-white":"bg-gradient-to-r from-[#FFF8F3] from-1% to-[#EFB683] to-101% text-[#C96C26]"])},l(n.seconds<10?`0${n.seconds}`:n.seconds),3)]),_:1},8,["time"])])])}}}),Ft=Z(It,[["__scopeId","data-v-1a85a397"]]),Et={class:"font-semibold text-[#000] bg-white rounded-lg text-sm mt-1 text-left flex items-center justify-between overflow-hidden"},Bt={class:"w-full bg-[#F9F5F7] rounded-lg text-[#333] px-2 text-xs font-normal"},Rt={class:"text-[#FA1A17]"},Dt=O({props:{lucklyInfo:{type:Object,default:()=>({amount:null,sn:null,time:null})},totalAmount:{type:Number,default:0}},setup(t){const S=t,v=r([]),i=u=>{v.value=u},[y,h]=ie(!1),$=r(null),p=u=>{$.value.contains(u.target)||h(!1)};return U(()=>{document.addEventListener("click",p)}),qe(()=>{document.removeEventListener("click",p)}),(u,m)=>{const s=D("van-collapse-item"),n=D("van-collapse");return S.lucklyInfo.amount>0?(o(),a("div",{key:0,class:"pt-1 relative",onClick:m[7]||(m[7]=g=>d(h)(!1))},[e("div",Et,[_(n,{modelValue:v.value,"onUpdate:modelValue":m[5]||(m[5]=g=>v.value=g),onChange:i,class:"w-full rounded-xl",border:!1},{default:I(()=>[_(s,{title:u.$t("flashSale.openInfo"),name:"1","right-icon":"play",border:!1},{"right-icon":I(()=>[e("div",{class:R(v.value.length===0?"triangle-down":"triangle-up")},null,2)]),default:I(()=>[e("div",Bt,[e("div",{class:"flex justify-between py-1.5 pt-2.5 border-solid border-[#DEDEDE]/20 border-b",onClick:m[0]||(m[0]=g=>d(X)(t.lucklyInfo.amount))},[B(l(u.$t("flashSale.circulation"))+": ",1),e("div",null,l(t.lucklyInfo.amount),1)]),e("div",{class:"flex justify-between py-1.5 border-solid border-[#DEDEDE]/20 border-b",onClick:m[1]||(m[1]=g=>d(X)(t.lucklyInfo.time))},[B(l(u.$t("flashSale.timestamp"))+": ",1),e("div",null,l(t.lucklyInfo.time),1)]),e("div",{class:"flex justify-between py-1.5 border-solid border-[#DEDEDE]/20 border-b",onClick:m[2]||(m[2]=g=>d(X)(t.lucklyInfo.totalAmount))},[B(l(u.$t("flashSale.totalAmount"))+" ",1),e("div",null,l(t.totalAmount),1)]),e("div",{class:"flex justify-between py-1 font-semibold pb-2",onClick:m[3]||(m[3]=g=>d(X)(t.lucklyInfo.totalAmount))},[B(l(u.$t("flashSale.lucklySn"))+" ",1),e("div",Rt,l(t.lucklyInfo.sn),1)])]),e("div",{class:"w-full bg-white text-[#777] text-xs font-normal mt-4",onClick:m[4]||(m[4]=ue(()=>{},["stop"]))},l(u.$t("flashSale.openExplanation")),1)]),_:1},8,["title"])]),_:1},8,["modelValue"])]),d(y)?(o(),a("div",{key:0,class:"w-[80%] absolute bg-default/80 text-white right-2 top-8 p-2 rounded text-xs text-justify",onClick:m[6]||(m[6]=ue(()=>{},["stop"]))},l(u.$t("flashSale.openExplanation")),1)):f("",!0)])):f("",!0)}}}),Lt=Z(Dt,[["__scopeId","data-v-5d91f7ee"]]),Pt={class:"h-full pb-4 mt-4"},Nt={class:"flex justify-between text-sm text-[#2E2008] opacity-60 px-4"},jt={class:"bg-white rounded-lg mt-2.5 text-sm text-[#2E2008] px-4 max-h-[70vh] overflow-y-auto"},zt={class:"flex-1 text-left"},Ot={class:"flex-1"},Ut={class:"flex justify-end flex-1"},Vt=O({props:{show:{type:Boolean,default:!1},list:{default:[]},countList:{default:[]},luckUser:null,goodsId:null,totalAmount:null},emits:["close"],setup(t,{emit:S}){const v=t,{orderRandomRecords:i}=Ae(),y=Ge({lucklyInfo:{amount:null,sn:null,time:null}}),h=()=>{S("close")},$=G(()=>{const u=v.list.map((s,n)=>({address:s,count:+v.countList[n],number:_e(+n)||[]})),m=v.list.findIndex(s=>te(s)===te(v.luckUser));if(m!==-1){let s=u.splice(m,1)[0];u.unshift(s)}return u}),p=async()=>{const u=await i(v.goodsId);u.success&&(y.lucklyInfo=u.result)};return U(()=>{p()}),(u,m)=>(o(),b(nt,{show:v.show,onClose:h,title:u.$t("flashSale.ParticipationRecord")},{default:I(()=>[_(Lt,{"luckly-info":d(y).lucklyInfo,totalAmount:t.totalAmount},null,8,["luckly-info","totalAmount"]),e("div",Pt,[e("div",Nt,[e("div",null,l(u.$t("flashSale.wallet-address")),1),e("div",null,l(u.$t("flashSale.Buy copies")),1),e("div",null,l(u.$t("flashSale.Lottery number")),1)]),e("div",jt,[(o(!0),a(de,null,ce(d($),(s,n)=>(o(),a("div",{class:R(["flex justify-between py-4 border-solid",{"border-[#7F169A]/20 border-b":n<d($).length-1}]),key:n},[e("div",zt,l(d(Te)(s.address,"...",3,4)),1),e("div",Ot,l(s.count),1),e("div",Ut,[(o(!0),a(de,null,ce(s.number,(g,F)=>(o(),a("div",{class:R(["bg-[#D8D8D8] font-semibold text-lg text-white leading-5 rounded-sm w-4 text-center",{"mr-0.5":F!==s.number.lenght-1,"bg-[#FA1A17]":n==0}]),key:F},l(g),3))),128))])],2))),128))])])]),_:1},8,["show","title"]))}}),Ht=Z(Vt,[["__scopeId","data-v-2250f780"]]),Mt="/static/images/shop-ChcGIVIz.svg",qt="/static/images/shop-KzfS1F29.svg",Gt="/static/images/sale-people-B9j4520v.svg",Ce=t=>(we("data-v-7ff404de"),t=t(),ke(),t),Zt={class:"fixed bottom-0 left-0 w-full px-2.5 safe-bottom sm:bottom-[0%] lg:bottom-[0%] z-20 flex-center"},Jt={class:"w-full h-14 flex items-center justify-between pb-0.5 pr-2 bg-white rounded-full sm:w-[355px] shadow-2"},Kt={class:"flex flex-1 justify-evenly"},Qt={key:0,src:Mt,class:"w-5 h-5 m-auto mb-0.5"},Wt={key:1,src:qt,class:"w-5 h-5 m-auto mb-0.5"},Xt=Ce(()=>e("img",{src:ze,class:"w-5 h-5 m-auto mb-0.5"},null,-1)),Yt={key:1,class:"text-xs text-center"},es={class:"text-[#e2e2e2]"},ts={key:0,class:"flex"},ss={class:"flex items-center"},os=Ce(()=>e("img",{src:Gt,class:"h-6 m-auto mr-1 w-11"},null,-1)),ls={key:0,class:"text-center text-white"},as={class:"text-sm leading-3"},ns={class:"text-lg font-medium leading-5"},is=B(" Mcoin "),us={class:"text-[0.675rem]"},cs={class:"mr-0.5"},ds={key:1,class:"py-2.5 ml-2 text-[#999] text-base"},rs={key:2,class:"py-2.5 ml-2 text-[#999] text-base"},ms=O({props:{isFollow:{type:Boolean},goodsId:null,isSale:{type:Boolean},isSaleEnd:{type:Boolean},isSaleStart:{type:Boolean},isSaleOver:{type:Boolean},goods:null,systemTime:null,currentAmount:null,totalAmount:null,payType:null,boutiqueFlag:{type:Boolean}},emits:["handeToShop","handleConnect","handleBuy","handleAddCart","toPurchase"],setup(t,{expose:S,emit:v}){const i=t,{t:y}=Se(),h=r(!1);U(()=>{h.value=i.isFollow,i.isSale});const $=r(!1),p=G(()=>[{text:y("piggy.normalBuy"),id:1}]),u=s=>{v("handleBuy",`payType=${s.id}`)},m=()=>{it({goodsIds:[i.goodsId],type:h.value?2:1,collectType:i.isSale?2:1}).then(s=>{s.success&&(h.value?ee(y("common.cancel collect")):ee(y("common.collect success")),h.value=!h.value)})};return S({}),(s,n)=>{const g=D("van-icon"),F=D("VanButton"),K=D("van-popover");return o(),a("div",Zt,[e("div",Jt,[e("div",Kt,[e("div",{class:"text-xs text-center",onClick:n[0]||(n[0]=()=>v("handeToShop"))},[t.isSale?(o(),a("img",Wt)):(o(),a("img",Qt)),e("div",null,l(s.$t("mall.shop")),1)]),e("div",{class:"text-xs text-center",onClick:n[1]||(n[1]=()=>v("handleConnect"))},[Xt,e("div",null,l(s.$t("common.service")),1)]),t.isSale?(o(),a("div",Yt,[_(g,{name:"star",color:"#e2e2e2",size:20}),e("div",es,l(s.$t("common.collect")),1)])):(o(),a("div",{key:0,class:"text-xs text-center",onClick:m},[h.value?(o(),b(g,{key:0,name:"star",color:"#ffd21e",size:20})):(o(),b(g,{key:1,name:"star-o",color:"#2E2008",size:20})),e("div",null,l(s.$t("common.collect")),1)]))]),t.isSale?(o(),b(F,{key:1,class:R(["min-w-[60px] rounded-3xl px-2.5",i.isSaleEnd||i.isSaleStart||i.currentAmount>=i.totalAmount?"bg-[#D9D9D9]":"bg-[#FB1A18]"]),disabled:i.isSaleStart||i.isSaleEnd||i.currentAmount>=i.totalAmount,onClick:n[5]||(n[5]=()=>{v("toPurchase")})},{default:I(()=>[e("div",ss,[os,!i.isSaleEnd&&!i.isSaleStart&&i.currentAmount<i.totalAmount?(o(),a("div",ls,[e("div",as,[e("span",ns,l(t.goods.price),1),is]),e("div",us,[e("span",cs,l(s.$t("refund.TotalNum",{num:t.totalAmount})),1),e("span",null,l(s.$t("flashSale.Already snatched"))+l(i.currentAmount)+l(s.$t("common.pieces")),1)])])):i.isSaleStart?(o(),a("div",ds,l(s.$t("common.no start")),1)):(o(),a("div",rs,l(i.currentAmount>=i.totalAmount?s.$t("flashSale.Alreadygrabbed"):s.$t("flashSale.gooderror")),1))])]),_:1},8,["disabled","class"])):(o(),a("div",ts,[_(F,{class:"px-3 text-sm text-white linear-btn rounded-l-3xl",onClick:n[2]||(n[2]=ue(Q=>v("handleAddCart"),["stop"]))},{default:I(()=>[B(l(s.$t("common.addCart")),1)]),_:1}),t.payType!==3||t.boutiqueFlag?(o(),b(F,{key:0,class:"px-5 text-sm text-white bg-primary rounded-r-3xl",onClick:n[3]||(n[3]=()=>v("handleBuy",t.payType===2?"":"payType=1"))},{default:I(()=>[B(l(t.payType===2?s.$t("piggy.cardBuy"):s.$t("common.buy")),1)]),_:1})):(o(),b(K,{key:1,placement:"top",show:$.value,"onUpdate:show":n[4]||(n[4]=Q=>$.value=Q),actions:d(p),onSelect:u},{reference:I(()=>[_(F,{class:"px-5 text-sm text-white bg-primary rounded-r-3xl"},{default:I(()=>[B(l(s.$t("common.buy")),1)]),_:1})]),_:1},8,["show","actions"]))]))])])}}}),vs=Z(ms,[["__scopeId","data-v-7ff404de"]]),ps="/static/images/online-V-h6qWLs.svg",fs="/static/images/online-BHRPZ7Z2.svg",hs="/static/images/outline-C86leE1s.svg",gs="/static/images/inline-NC3d5N9J.svg",ys={class:"rounded-b-lg px-2.5 pt-2.5 pb-3 bg-white box-shadow"},xs={key:0},bs={class:"text-sm font-semibold break-all"},$s={class:"mr-1.5"},ws={key:0,class:"mt-1.5 text-xs leading-normal text-black-400 line-clamp-2"},ks={class:"flex items-center mt-2"},Ss={key:1,class:"flex items-center"},_s={key:2,class:"gap-2 ml-auto mr-4 text-right"},Ts={key:1},As={class:"mb-2 font-semibold break-all"},Cs={class:"flex items-center justify-between mt-3"},Is={key:0,class:"flex-start"},Fs={key:0,src:ps,class:"w-6 mr-2"},Es={key:1,src:fs,class:"w-6 mr-2"},Bs={key:1,class:"flex-start"},Rs={key:0,src:hs,class:"w-6 mr-2"},Ds={key:1,src:gs,class:"w-6 mr-2"},Ls={class:"mt-1 mr-4 text-xs flex justify-start items-center text-black/50"},Ps={key:0},Ns={key:1},js={key:2},zs={key:3},Os={class:"ml-auto"},Us={key:0},Vs={key:1},Hs=O({props:{tokenRate:null,stores:null,goods:null,isSale:{type:Boolean,default:!1},card:null,shippingTemplate:{default:()=>({})},discountRatio:null},setup(t){const S=t,{tradeContributeSelfRate:v}=Xe(),i=r(0),y=G(()=>{if(Ze.isNil(S.discountRatio))return"0";const p=+new re(new re(S.discountRatio||0).div(100)).times(S.goods.price).times(i.value);return $e(p,2)}),h=async()=>{i.value=await v()},$=async()=>{h()};return U(()=>{$()}),(p,u)=>(o(),a("div",ys,[t.isSale?(o(),a("div",Ts,[e("div",As,l(t.goods.title||""),1),_(dt,{ratio:t.goods.discountRate||20,class:"h-6"},null,8,["ratio"]),e("div",Cs,[t.goods.deliveryType===1||t.goods.shippingMethod===1?(o(),a("div",Is,[t.isSale?(o(),a("img",Es)):(o(),a("img",Fs)),e("div",null,l(p.$t("common.send")),1)])):(o(),a("div",Bs,[t.isSale?(o(),a("img",Ds)):(o(),a("img",Rs)),e("div",null,l(p.$t("common.offline")+p.$t("common.Payment")),1)]))])])):(o(),a("div",xs,[e("div",bs,[t.goods.type?(o(),b(ut,{key:0,type:t.goods.type,class:"inline-block align-text-top mr-1.5"},null,8,["type"])):f("",!0),e("span",$s,l(t.goods.goodsName||""),1),_(Oe,{class:"align-text-bottom",deliveryType:t.goods.deliveryType},null,8,["deliveryType"])]),t.goods.goodsDesc?(o(),a("div",ws,l(t.goods.goodsDesc),1)):f("",!0),e("div",ks,[t.goods.payType!==d(z).STORE_CARD?(o(),b(ct,{key:0,style:{"margin-right":"0"},price:t.goods.price},null,8,["price"])):f("",!0),t.goods.payType!==d(z).STORE_CARD&&t.goods.deliveryType===d(ne).online?(o(),a("div",Ss)):f("",!0),t.goods.deliveryType===d(ne).online?(o(),a("div",_s,[t.goods.payType!==d(z).STORE_CARD?(o(),b(Ue,{key:0,class:"inline-block",showType:"balance",goods:t.goods},null,8,["goods"])):f("",!0)])):f("",!0)])])),e("div",Ls,[e("span",null,[t.shippingTemplate.type===d(Y).FREE&&t.shippingTemplate.threshold?(o(),a("span",Ps,l(p.$t("shop.shippingTemplate.actualPayment"))+l(d($e)(t.shippingTemplate.threshold))+"MC"+l(p.$t("shop.shippingTemplate.freeShipping")),1)):f("",!0),t.shippingTemplate.type===d(Y).FREE&&t.shippingTemplate.threshold===0?(o(),a("span",Ns,l(p.$t("shop.shippingTemplate.freeShipping")),1)):f("",!0),t.shippingTemplate.type===d(Y).NO_SHIPPING?(o(),a("span",js,l(p.$t("shop.shippingTemplate.noShipping")),1)):f("",!0),t.shippingTemplate.type===d(Y).CASH_ON_DELIVERY?(o(),a("span",zs,l(p.$t("shop.shippingTemplate.cashOnDelivery")),1)):f("",!0)]),e("span",Os,[t.goods.deliveryType===d(ne).online||!t.discountRatio?(o(),a("span",Us,l(p.$t("goods.confirming receipt")),1)):(o(),a("span",Vs,l(p.$t("goods.order completed get integral",{num:d(y)})),1))])])]))}}),Ms=Z(Hs,[["__scopeId","data-v-197d209d"]]),qs={class:"relative w-full h-full bg-white safe-bottom-page"},Gs={key:0},Zs={class:"relative"},Js={key:0,class:"absolute top-0 left-0 w-full h-full z-40 bg-[#000000]/70"},Ks={class:"absolute top-1/2 left-1/2 translate-x-[-50%] translate-y-[-50%]"},Qs=e("img",{src:mt,class:"h-auto w-52",alt:""},null,-1),Ws={class:"flex items-center whitespace-nowrap justify-center mb-0.5"},Xs={class:"text-xs"},Ys={key:0,class:"flex items-center whitespace-nowrap"},eo={key:0,class:"text-[0.675rem] text-[#999999]"},to={class:"text-xs text-[#999] text-center underline mt-0.5"},so=e("img",{class:"w-8 h-8",src:Me},null,-1),oo=[so],lo={class:"px-2.5"},ao={key:3,class:"fixed left-2.5 top-[13.2rem] bg-white/80 text-default rounded-2xl px-2 py-1.5 text-xs font-semibold z-50"},no={class:"flex items-center"},io=e("img",{src:vt,class:"w-3 h-3 mr-1.5"},null,-1),Eo=O({setup(t){const{checkLoginAuth:S}=Ye(),{commodities:v,orderList:i}=Ae(),y=r(!1),{loadingToggle:h}=tt(),{t:$}=Se(),p=Je(),u=Ke(),m=et(),s=r(null),[n,g]=ie(!1),[F,K]=ie(!1);r();const Q=r(null),Ie=r(null),me=p.query.id,Fe=async()=>{const c=p.query.id,w=await st(+c);s.value=w.data},Ee=G(()=>s.value.mainImageUrls.split(",").filter(c=>c!==""&&c!==null&&c!==void 0&&!Number.isNaN(c))),Be=async()=>{g(!1),await ge()},V=r(null),H=r(null),ve=async()=>{V.value=k(s.value.startTime)*1e3-k(T.value)*1e3>0,H.value=k(s.value.endTime)*1e3-k(T.value)*1e3<=0,be()},Re=async()=>{if(console.log(V.value,H.value,A.value,x.value,"currentAmount.value, totalAmount.value"),A.value>=x.value&&x.value>0){E.value=0;return}if(V.value&&H.value&&A.value<x.value&&x.value>0){E.value=0;return}await Pe(),k(s.value.startTime)*1e3-k(T.value)*1e3<=0&&k(s.value.endTime)*1e3-k(T.value)*1e3&&(L.value=0,E.value=k(s.value.endTime)*1e3-k(T.value)*1e3),await ve()},De=()=>{u.push(`submitOrder?id=${s.value.id}`)},Le=async()=>{if(s.value.stock===0&&s.value.goodsTypes!=2){ee($("order.Insufficient stock"));return}h(!0);const c=await ot(s.value.id);h(!1),c.success&&(ee($("cart.addTips")),m.getCartCount())},pe=c=>{u.push(c)},E=r(0),se=r(0),L=r(0),T=r(""),Pe=async()=>{const{data:c}=await lt();T.value=c||null,se.value=k(s.value.endTime)*1e3-k(T.value)*1e3,L.value=k(s.value.startTime)*1e3-k(T.value)*1e3,L.value>0&&(E.value=L.value),L.value<=0&&se.value>0&&(E.value=se.value)},A=r(0),x=r(0),fe=r(0),he=r(0),M=r(null),oe=r(""),ge=async()=>{const c=await v(s.value.id);A.value=+c.currentAmount,x.value=+c.totalAmount,fe.value=x.value-A.value,he.value=+c.limitEach,s.value.discountRate=+re(+c.discountRate).div(1e4).toNumber(),c.lucky!==Qe&&(M.value=s.value.luckyNickName||Te(c.lucky,"...",4,2)),c.status===20&&(oe.value=at(c.nextActionTime*1e3)),be()},le=r(!1),W=r(1),q=r(1e3),P=r([]),ae=r([]),ye=async()=>{if(!M.value||le.value)return;const c=await i(s.value.id+"",(W.value-1)*q.value,q.value);if(!c.success)return;const w=+c.result.total;if(P.value=W.value===1?c.result.rows:P.value.concat(c.result.rows),ae.value=W.value===1?c.result.counts:ae.value.concat(c.result.counts),P.value.length===w){le.value=!0;return}W.value+=1;const N=w-P.value.length;q.value=N>q.value?q.value:N,await ye()},xe=G(()=>{const c=P.value.findIndex(N=>te(N)===te(s.value.lucky));return _e(+c)||[]}),Ne=()=>{try{window.history.state.back?u.back():window.history.length>2?window.history.back():u.replace({path:"/flashSale"})}catch{u.push("/")}},je=()=>{K(!0)},be=()=>{if(A.value>=x.value&&x.value>0){E.value=0;return}if(V.value&&H.value&&A.value<x.value&&x.value>0){E.value=0;return}};return U(async()=>{S(!0)&&(h(!0),await Fe(),await ge(),ye(),ve(),h(!1))}),(c,w)=>{const N=D("VanLoading");return o(),a("div",qs,[s.value?(o(),a("div",Gs,[e("div",Zs,[A.value>=x.value&&M.value?(o(),a("div",Js,[e("div",Ks,[Qs,e("div",{class:"absolute bottom-2 left-1/2 translate-x-[-50%] whitespace-nowrap",onClick:je},[e("div",Ws,[e("span",Xs,l(c.$t("flashSale.Winning-number")),1),le.value?(o(),a("div",Ys,[(o(!0),a(de,null,ce(d(xe),(C,j)=>(o(),a("div",{class:R(["bg-[#FA1A17] font-semibold text-lg text-white leading-5 rounded-sm w-4 text-center",{"mr-0.5":j!==d(xe).length-1}]),key:j},l(C),3))),128))])):(o(),b(N,{key:1,size:"18"}))]),oe.value?(o(),a("div",eo,l(c.$t("flashSale.Prizeredemptiondeadline"))+":"+l(oe.value),1)):f("",!0),e("div",to,l(c.$t("flashSale.check-the-details")),1)])])])):f("",!0),e("header",{class:"flex items-center sm:w-[375px] w-full justify-between top-0 z-50 h-[50px] px-3 py-[9px] fixed transition-all duration-200"},[e("div",{class:"flex flex-wrap items-center",onClick:Ne},oo)]),s.value.mainImageUrls?(o(),b(Ve,{key:1,imgs:d(Ee)||"",class:"mb-2.5",indicatorColor:"#FB1A18",bgColor:"#F4C5C4"},null,8,["imgs"])):f("",!0)]),_(Ft,{goods:s.value,onChangeTime:Re,ref:(C,j)=>{j.cutdown=C,Q.value=C},startTime:L.value,cutdownTimestamp:E.value,systemTime:T.value,totalAmount:x.value},null,8,["goods","startTime","cutdownTimestamp","systemTime","totalAmount"]),e("div",lo,[_(Ms,{goods:s.value,discountRatio:s.value.discountRate,class:"mb-2.5",isSale:!0},null,8,["goods","discountRatio"]),s.value.describe||s.value.detailImageUrls?(o(),b(He,{key:0,text:s.value.describe,imgs:(s.value.detailImageUrls||"").split(",")},null,8,["text","imgs"])):f("",!0),_(vs,{goodsId:s.value.id,systemTime:T.value,goods:s.value,ref:(C,j)=>{j.goodsBar=C,Ie.value=C},isFollow:y.value,onHandleBuy:De,isSale:!0,isSaleEnd:H.value,isSaleStart:V.value,totalAmount:x.value,currentAmount:A.value,onToPurchase:w[0]||(w[0]=C=>d(g)(!0)),onHandeToShop:w[1]||(w[1]=C=>pe(`/category?deliveryType=1&shopId=${s.value.shopId}`)),onHandleConnect:w[2]||(w[2]=C=>pe(`/shopInfo?address=${s.value.address}`)),onHandleAddCart:Le},null,8,["goodsId","systemTime","goods","isFollow","isSaleEnd","isSaleStart","totalAmount","currentAmount"])])])):s.value?(o(),b(rt,{key:1,type:"good"})):f("",!0),s.value?(o(),b(We,{key:2,show:d(n),onClose:Be,goods:s.value,remaining:fe.value,limitEach:he.value},null,8,["show","goods","remaining","limitEach"])):f("",!0),A.value>=x.value&&M.value?(o(),a("div",ao,[e("div",no,[io,e("div",null,l(c.$t("flashSale.Congratulations-tips",{user:` ${M.value} `})),1)])])):f("",!0),d(me)?(o(),b(Ht,{key:4,goodsId:d(me),totalAmount:x.value,list:P.value,countList:ae.value,show:d(F),luckUser:s.value&&s.value.lucky,onClose:w[3]||(w[3]=()=>d(K)(!1))},null,8,["goodsId","totalAmount","list","countList","show","luckUser"])):f("",!0)])}}});export{Eo as default};
