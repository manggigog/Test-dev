import{_ as H,y as Y,r as p,bc as B,D as X,E as T,F as k,G as i,H as a,O as x,N as F,K as S,P as s,I as ee,a4 as A,Q as C,w as Be,$ as Fe,o as Q,Y as de,Z as ve,J as he,R as U,a2 as M,l as Ae,x as W,bI as De,bp as Pe}from"./vendor-CjApaIpB.js";import{N as Le}from"./NoRanking-DGMOKvLl.js";import{R as fe,_ as Me,a as Ee}from"./RankingShopItem-C9ahR_js.js";import{u as Ne,S as qe,g as ce,b as Ye,aS as pe,V as ze,C as je}from"./index-B3VH42pz.js";import{q as me,a as Qe,b as Ue}from"./beiRanking-BxzIQw7r.js";import{q as He}from"./user-DYGd6ROD.js";import{b as ge}from"./beiExtRewardContract-DdWVCmLm.js";import{_ as Oe}from"./calendar-yellow-CXVdbyCS.js";import{S as Ke}from"./ShopVotePop-Qp5cJ_hC.js";import{V as Ge}from"./VoteRewardPop-Cf4XYtP8.js";import{C as Ze}from"./CommonVanProvider-B8cLU3Mi.js";import{B as Je}from"./BackIcon-D2Vm_lyR.js";import"./Lottie_v2-DtzXb0bK.js";import"./member-BMygrgIC.js";import"./SkewCard-BD-urNEn.js";import"./shop-CeqcS6K2.js";import"./beiConstContract-GhbsAZrb.js";import"./Lottie-ni5dUCha.js";const We="/Test-dev/static/images/cat-ip-B1otGVvA.png",Xe="/Test-dev/static/images/store_title-BHZZnPgm.png",et="/Test-dev/static/images/search-line-DiUN1tEO.svg",tt=["onClick"],ot={class:"box-bg"},st=["onClick"],nt=Y({props:{month:null},emits:["toApply","toApplyShop","toQuit"],setup(h,{expose:y,emit:w}){const{voteMonthTimestampView:V}=ge(),R=Ne().getCurrentAccount(),e=p(null),d=p(null),v=()=>{var m,r;(m=e.value)!=null&&m.id&&((r=e.value)==null?void 0:r.status)===1?w("toApply"):w("toApplyShop")},[_,I]=B(!0),f=async()=>{I(!0);const{success:m,data:r}=await qe();if(!m||(r==null?void 0:r.status)!==1){if(e.value={...r,status:0,shopAddress:R},!e.value.storeName){const{success:b,data:c}=await He();b&&(c!=null&&c.nickName)&&(e.value.storeName=c==null?void 0:c.nickName)}I(!1);return}e.value=r,e.value.shopAddress=r==null?void 0:r.merchant,e.value.shopId=r==null?void 0:r.id,u()},u=async()=>{var c,g,l;if(!((c=e.value)!=null&&c.shopId))return;I(!0);const{result:m}=await V(),{success:r,data:b}=await me({shopId:(g=e.value)==null?void 0:g.shopId,month:+m.thisMonthTime});I(!1),!(!r||!b)&&(d.value=b,((l=d.value)==null?void 0:l.status)!==1&&(d.value.sort=null))};return X(()=>{f()}),y({getRankingInfo:u}),(m,r)=>{var c;const b=T("VanLoading");return i(),k("div",{class:"fixed bottom-0 w-full sm:w-[375px] mx-auto",onClick:A(v,["stop"])},[a("div",ot,[x(fe,{rankItem:d.value||e.value,hideScore:((c=d.value)==null?void 0:c.status)!==1,showPower:!0,class:"pl-4 pr-5"},{right:F(()=>{var g,l,D,P;return[s(_)?(i(),S(b,{key:0,size:"20"})):(i(),k(ee,{key:1},[((g=e.value)==null?void 0:g.status)===1&&((l=d.value)==null?void 0:l.status)===1?(i(),k("div",{key:0,class:"bg-[#FFF8EC] text-[#7D3619] font-semibold rounded-md px-3 py-1.5 min-w-[52px]",onClick:r[0]||(r[0]=A($=>w("toQuit"),["stop"]))},C(m.$t("ranking.Exit list")),1)):(i(),k("div",{key:1,class:"btn-linear text-b6 font-semibold px-3 py-1.5 min-w-[52px]",onClick:A(v,["stop"])},C((D=e.value)!=null&&D.id&&((P=e.value)==null?void 0:P.status)===1?m.$t("ranking.Go and apply"):m.$t("shop.applyShop")),9,st))],64))]}),_:1},8,["rankItem","hideScore"])])],8,tt)}}}),at=H(nt,[["__scopeId","data-v-481becc4"]]),lt=h=>(de("data-v-5e4382be"),h=h(),ve(),h),rt=lt(()=>a("img",{class:"w-5 h-5",src:Oe,alt:""},null,-1)),ut={key:0},it={key:1},ct={class:"flex items-end px-5 py-4 text-sm"},pt=Y({props:{pageType:null},emits:["changeTime"],setup(h,{emit:y}){const w=h,{t:V}=Be(),[R,e]=B(!1),{voteMonthTimestampView:d}=ge(),v=p(),_=p(new Date),I=p(new Date),f=p(""),u=p(""),m=()=>{v.value=_.value,u.value=Q(v.value).format("MM"),f.value=Q(v.value).format("YYYY"),e(!1),y("changeTime",{years:f.value,cycle:u.value})},r=async()=>{const{result:g}=await d();_.value=new Date(+g.thisMonthTime*1e3),u.value=Q(_.value).format("MM"),f.value=Q(_.value).format("YYYY")},b=()=>{v.value=null,_.value=I.value,u.value="",f.value="",e(!1),y("changeTime",{years:1e4})},c=(g,l)=>g==="month"?`${l}${V("common.month")}`:l;return X(async()=>{w.pageType!=="record"&&await r(),f.value&&y("changeTime",{years:f.value,cycle:u.value})}),(g,l)=>{const D=T("van-datetime-picker"),P=T("van-popup");return i(),k("div",{class:"text-[#663D15] font-semibold flex flex-shrink-0 px-2 pr-3 items-center gap-1 h-8 bg-white rounded-3xl",onClick:l[3]||(l[3]=$=>s(e)(!0))},[rt,f.value&&u.value?(i(),k("span",ut,C(f.value+"-"+u.value),1)):(i(),k("span",it,C(g.$t("ranking.overall_ranking")),1)),x(P,{round:"",teleport:"body",show:s(R),"onUpdate:show":l[2]||(l[2]=$=>Fe(R)?R.value=$:null),position:"bottom",style:{height:"40%"}},{default:F(()=>[a("div",ct,[a("div",{class:"opacity-50",onClick:b},C(g.$t("ranking.overall_ranking")),1),a("div",{class:"ml-auto text-[#FEA021] text-sm",onClick:l[0]||(l[0]=$=>m())},C(g.$t("common.confirm")),1)]),x(D,{"swipe-duration":"200",modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=$=>_.value=$),type:"year-month",title:"","max-date":I.value,"show-toolbar":!1,formatter:c},null,8,["modelValue","max-date"])]),_:1},8,["show"])])}}}),dt=H(pt,[["__scopeId","data-v-5e4382be"]]),vt={class:"flex items-end justify-center mx-[7px] mt-12"},ht=["onClick"],ft=["onClick"],mt={class:"relative w-[50px] h-[50px] rounded-full avatar-img mx-auto"},gt=["src"],wt=["src"],_t=["onClick"],kt={class:"max-w-[90%] line-clamp-1 text-center text-[#7D3100]"},xt={key:0,class:"flex flex-col items-center"},yt={class:"text-xs text-b2 leading-[18px]"},bt=["onClick"],$t={class:"relative text-[#4D2E0F] text-right text-[22px] font-BebasNeue"},Ct={key:0,class:"absolute right-[-22px] bottom-0 text-xs flex gap-x-1 min-w-fit"},It=Y({props:{rankingTopList:null,showPower:{type:Boolean}},emits:["voteShop","toDetail"],setup(h,{emit:y}){const{rankingTopList:w}=h;return(V,R)=>(i(),k("div",vt,[(i(!0),k(ee,null,he(h.rankingTopList,(e,d)=>(i(),k("div",{key:d,class:U(["min-h-[120px] text-center relative px-1",`bg-linear__${d==1?"one":d==0?"two":"three"}`]),onClick:A(v=>y("voteShop",e),["stop"])},[a("div",{class:"-mt-[15px] relative",onClick:A(v=>y("toDetail",e),["stop"])},[a("div",mt,[a("img",{src:((e==null?void 0:e.logo)||"").split()[0]||s(ce)("images/ranking/noPosition.png"),class:"object-cover w-full h-full rounded-full"},null,8,gt),a("img",{src:s(ce)(`images/ranking/top_${d}.png`),class:"w-8 h-auto absolute -top-4 -left-4"},null,8,wt)])],8,ft),a("div",{class:"mt-2 flex justify-center items-center",onClick:A(v=>y("toDetail",e),["stop"])},[a("div",kt,C((e==null?void 0:e.storeName)||V.$t("ranking.Waiting for a vacant position")),1)],8,_t),e?(i(),k("div",xt,[a("div",yt,C(s(Ye)(e==null?void 0:e.shopAddress,"**",0,4)),1),a("div",{class:"flex items-center justify-center gap-x-1 mt-2",onClick:A(v=>y("voteShop",e),["stop"])},[a("div",$t,[x(Me,{score:e==null?void 0:e.score},null,8,["score"]),h.showPower?(i(),k("div",Ct,[x(Ee,{direction:e==null?void 0:e.direction,onCompletePlay:()=>{e.direction=null}},null,8,["direction","onCompletePlay"])])):M("",!0)])],8,bt),a("div",{class:U(["-mt-6 w-8 h-4 font-bold text-base text-center text-[#995C1F] index-number",{up:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)<+(e==null?void 0:e.preHeat),down:(e==null?void 0:e.preHeat)&&+(e==null?void 0:e.sort)>+(e==null?void 0:e.preHeat)}])},null,2)])):M("",!0)],10,ht))),128))]))}}),St=H(It,[["__scopeId","data-v-5aa8ab90"]]),O=h=>(de("data-v-42bdcbcb"),h=h(),ve(),h),Tt={class:"parent-view",id:"ranking"},Vt={class:"flex flex-col w-full h-auto bg-mask parent-view"},Rt=O(()=>a("img",{src:We,class:"w-auto h-[160px] absolute right-3 top-8 -z-0"},null,-1)),Bt={class:"h-[50px] text-b2 flex items-center justify-between px-3"},Ft={class:"px-4 pt-5 pb-3 relative"},At=O(()=>a("div",{class:"min-h-[44px] relative -z-10"},[a("img",{src:Xe,class:"min-w-[200px] h-auto w-[53%]"})],-1)),Dt={class:"mt-[25px] flex items-center gap-x-3 relative"},Pt=O(()=>a("img",{src:et,class:"w-5 h-5"},null,-1)),Lt=O(()=>a("span",{class:"text-sm text-[#663D15]"},"奖励记录",-1)),Mt=Y({name:"TalentRanking"});function Et(h){const y=Ae(),w=p(null),V=p(null),R=o=>{+o.years>=1e4?w.value=1e4:w.value=pe(`${o.years}-${o.cycle}`),Ce()},e=p(!1),d=p(!1),v=p(!1),_=p(0),I=p(20),f=p(0),u=p([]),m=p(null),[r,b]=B(!1),[c,g]=B(!1),l=p(null),[D,P]=B(!1),$=W(()=>+pe()==+w.value),we=async()=>{const{success:o,data:t,params:E}=await Ue({page:_.value,size:I.value,month:w.value,shopNameLike:l.value});if(!o||!t||!(t!=null&&t.total)||E.month&&+E.month!=+w.value){f.value=t==null?void 0:t.total,v.value=!0;return}const N=(t==null?void 0:t.records)||[];f.value=t.total,u.value=_.value===1?N:u.value.concat(N),u.value&&u.value.length>=f.value&&(v.value=!0)},te=W(()=>u.value?c.value?u.value:u.value.slice(3):[]),_e=W(()=>c.value?[]:[u.value[1],u.value[0],u.value[2]]),K=p({shopId:null}),[oe,se]=B(!1),ne=o=>{!(o!=null&&o.shopId)||!$.value||(K.value=o,se(!0))},ae=o=>{o!=null&&o.shopId&&q(`/talentRanking/rankingShop?shopId=${o.shopId}`)},[ke,z]=B(!1),[xe,le]=B(!1),ye=async()=>{var t;le(!0);const{success:o}=await Qe();z(!1),o&&(j(),(t=V.value)==null||t.getRankingInfo(),le(!1))},re=async()=>{d.value=!0,_.value+=1,await we(),d.value=!1},be=async(o,t,E=!1)=>{o!=null&&o.shopId&&(t.direct===200?o.score+=t==null?void 0:t.differ:o.score-=t==null?void 0:t.differ,o.direction=t.direct,setTimeout(()=>{o.direction=null,P(E)},2e3),setTimeout(async()=>{const{success:N,data:J}=await me({shopId:o==null?void 0:o.shopId,month:w.value});N&&(o.score=J.score)},5e3))},j=()=>{_.value=0,v.value=!1,u.value=[],re()},G=()=>{var o;g(!!(l!=null&&l.value)),(o=m.value)==null||o.blur(),j()},$e=()=>{e.value=!1,j()},Ce=()=>{Z&&(Ie.value=Z.scrollTop),j()},q=o=>{y.push(o)};let Z=null;const Ie=p(0);return X(()=>{Z=document.querySelector(".list__wrap")}),(o,t)=>{const E=T("VanField"),N=T("VanConfigProvider"),J=T("VanImage"),Se=T("VanList"),Te=T("van-pull-refresh"),Ve=T("router-view");return i(),S(Ze,{class:"h-full font-Puhui font-normal relative",style:{background:"linear-gradient(180deg, #fed820 4%, #fea020 30%, #fed820 85%)"},themeVars:{navBarBackgroundColor:"transparent",navBarIconColor:"#000"}},{default:F(()=>{var ue;return[a("div",Tt,[a("div",Vt,[Rt,a("div",Bt,[x(Je),a("div",{class:"pl-2",onClick:t[0]||(t[0]=n=>q("/talentRanking/rankingRule"))},C("规则"))]),a("div",Ft,[At,a("div",Dt,[x(dt,{pageType:"list",onChangeTime:R}),x(N,{"theme-vars":{"field-placeholder-text-color":"#663D15","field-input-text-color":"#663D15"}},{default:F(()=>[x(E,{ref:(n,L)=>{L.searchRef=n,m.value=n},class:U(["bg-b6 rounded-full h-8 flex items-center font-normal pl-2 pr-3 transition-all duration-300 relative z-10",s(r)||l.value?"flex-1":"w-[72px]"]),onFocus:t[1]||(t[1]=n=>s(b)(!0)),onBlur:t[2]||(t[2]=n=>s(b)(!1)),modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=n=>l.value=n),clearable:"",placeholder:s(r)?"":o.$t("common.search"),onClear:G,onKeyup:De(G,["enter"]),enterkeyhint:"search"},Pe({"left-icon":F(()=>[Pt]),_:2},[s(r)||l.value?{name:"right-icon",fn:F(()=>[a("div",{class:"text-newOrigin font-semibold",onClick:G},C(o.$t("common.search")),1)])}:void 0]),1032,["class","modelValue","placeholder","onKeyup"])]),_:1})])]),x(Te,{modelValue:e.value,"onUpdate:modelValue":t[7]||(t[7]=n=>e.value=n),onRefresh:$e,class:"list__wrap relative flex-1 overflow-auto rounded-t-xl mx-2"},{default:F(()=>[s(c)?M("",!0):(i(),k("div",{key:0,class:"absolute z-10 -right-1 top-4 w-fit h-fit py-[5px] px-2 bg-[#FFE4AD] border border-solid border-[rgba(255,255,255,0.64)] rounded-s-full flex items-center",onClick:t[4]||(t[4]=A(n=>q("/rankingReward"),["stop"]))},[Lt,x(J,{class:"ml-[2px] w-4 h-4",src:s(ze)("ranking/record_arrow.svg")},null,8,["src"])])),!s(c)&&u.value.length>0?(i(),S(St,{key:1,rankingTopList:s(_e),showPower:s($),onVoteShop:t[5]||(t[5]=n=>ne(n)),onToDetail:t[6]||(t[6]=n=>ae(n))},null,8,["rankingTopList","showPower"])):M("",!0),!d.value&&v.value&&f.value==0?(i(),S(Le,{key:2})):(i(),S(Se,{key:3,loading:d.value,finished:v.value,"finished-text":o.$t("common.noMore"),"immediate-check":!1,class:"min-h-[40vh] pb-[100px] relative z-10",onLoad:re},{default:F(()=>[(i(!0),k(ee,null,he(s(te),(n,L)=>{var ie;return i(),S(fe,{key:n.id,rankItem:n,showPower:s($),onVoteShop:Re=>ne(n),onToDetail:Re=>ae(n),class:U(["relative",{"active-bottom":L+1!==((ie=s(te))==null?void 0:ie.length)}])},null,8,["rankItem","showPower","onVoteShop","onToDetail","class"])}),128))]),_:1},8,["loading","finished","finished-text"]))]),_:1},8,["modelValue"])]),s($)&&!s(c)?(i(),S(at,{key:0,ref:(n,L)=>{L.userOwnerRef=n,V.value=n},month:w.value,onToApply:t[8]||(t[8]=n=>q("/joinRanking")),onToApplyShop:t[9]||(t[9]=n=>q("/editShopInfo")),onToQuit:t[10]||(t[10]=n=>s(z)(!0))},null,8,["month"])):M("",!0)]),s(oe)?(i(),S(Ke,{key:0,show:s(oe),shopId:(ue=K.value)==null?void 0:ue.shopId,teleport:"#ranking",onClose:t[11]||(t[11]=n=>s(se)(!1)),onVoteSuccess:t[12]||(t[12]=(n,L)=>be(K.value,n,L))},null,8,["show","shopId"])):M("",!0),s(D)?(i(),S(Ge,{key:1,show:s(D),onClose:t[13]||(t[13]=n=>s(P)(!1))},null,8,["show"])):M("",!0),x(je,{show:s(ke),content:"您的店铺本月已存在被投票充电记录，本次退出榜单操作将在下月生效",showConfirm:!0,showReject:!0,loading:s(xe),confirmText:"确认退榜",noClose:"","content-class":"text-b1 font-semibold",onClose:t[14]||(t[14]=n=>s(z)(!1)),onConfirm:ye,onReject:t[15]||(t[15]=n=>s(z)(!1))},null,8,["show","loading"]),x(Ve,{class:"child-view"})]}),_:1})}}const Nt=Y({...Mt,setup:Et}),no=H(Nt,[["__scopeId","data-v-42bdcbcb"]]);export{no as default};
