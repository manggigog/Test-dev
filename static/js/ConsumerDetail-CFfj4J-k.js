import{y as w,B as fe,G as l,H as n,I as e,Q as o,U as h,O as s,a4 as N,J as X,r as g,j as b,E as ee,ab as he,F as xe,P as T,$ as te,_ as _e,x as ve,a2 as j,o as pe,Z as P,T as Y,q as ye}from"./vendor-Dr_RpJ_Y.js";import{_ as be}from"./OfflineGoods-DKMaiwr2.js";import{_ as ge}from"./OfflineStore-D-5bM32y.js";import{_ as we,O as Ce}from"./OrderCancelSelectorPop-DYxa-GPk.js";import{_ as I}from"./MCOIN-Bodfn-v1.js";import{_ as Te}from"./USDT-Dlu99aCg.js";import{_ as se}from"./FMCP-f3k58DsE.js";import{_ as Se}from"./link-DvRTrysK.js";import{_ as W}from"./copy-w-F2Lv8QkV.js";import{e as C,g as $e,f as G,h as K,r as q,V as ke,i as Ae,b as Ee,c4 as je,C as Pe,c5 as Ne}from"./index-BckdT6oc.js";import{P as Oe}from"./order-H59PKTFP.js";import{p as De}from"./useOrderStatus-B4sCDXOr.js";import{a as x,o as Re}from"./offlineGoods-DvT2Go6q.js";import{C as Ie}from"./CommonVanProvider-KZuKVOde.js";import{_ as Le}from"./ServiceByStore-CQqG_4O_.js";import{_ as Be}from"./EmptyTipsPop-DFfFg0cQ.js";import"./ImgBoutiqueLable-B-2xCcw4.js";import"./shop-CeqcS6K2.js";import"./check-DoEtABZT.js";import"./BackIcon-CDrGaEPo.js";const Me={class:"p-3 py-4 break-all bg-white rounded-xl"},Ue={class:"title text-b1 text-sm font-semibold"},He={class:"content"},Fe={class:"flex justify-between items-center mt-[16px]"},Ve={class:"text-b3 text-sm font-normal"},Ye={class:"text-b1 text-sm font-normal text-right"},Ge={class:"flex justify-between items-center mt-[16px]"},Ke={class:"text-b3 text-sm font-normal"},qe={class:"text-b1 text-sm font-normal text-right"},We={class:"flex justify-start items-center"},Je=e("img",{class:"w-[17px] h-[17px] flex-shrink-0",src:I},null,-1),Qe={class:"text-b1 text-sm font-normal ml-1"},Ze={key:0,class:"flex justify-between items-center mt-[16px]"},ze={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Xe={class:"text-b1 text-sm font-normal text-right"},et={class:"flex justify-start items-center"},tt=e("span",{class:"text-b1 text-sm font-normal"}," - ",-1),st=e("img",{class:"w-[17px] h-[17px] ml-1",src:I},null,-1),ot={class:"text-b1 text-sm font-normal ml-1"},nt={class:"flex justify-between items-center mt-[16px]"},rt={class:"text-b3 text-sm font-normal"},at={class:"text-b1 text-sm font-normal text-right"},lt={key:0,class:"flex justify-start items-center"},it={class:"text-b1 text-sm font-normal ml-1 flex justify-end items-center"},ct={class:"flex justify-start items-center"},dt=e("img",{class:"w-[17px] h-[17px] mx-1",src:Te},null,-1),mt={class:"flex justify-start items-center ml-1"},ut=e("span",{class:"text-b3"},"(",-1),ft=e("img",{class:"w-[17px] h-[17px] mx-1",src:I},null,-1),ht=e("span",{class:"text-b3"}," ) ",-1),xt={key:0,class:"flex justify-start items-center"},_t=e("span",{class:"text-b3 mx-1"},"+",-1),vt=e("img",{src:se,class:"w-4 h-4 mr-1"},null,-1),pt={class:""},yt={key:1,class:"flex justify-start items-center"},bt=e("img",{class:"w-[17px] h-[17px] mx-1",src:I},null,-1),gt={class:"text-b1 text-sm font-normal flex items-center gap-1"},wt=e("span",{class:"text-b3 mx-1"},"+",-1),Ct=e("img",{src:se,class:"w-4 h-4"},null,-1),Tt={class:""},St={class:"flex justify-between items-center mt-[16px]"},$t={class:"text-b3 text-sm font-normal"},kt={class:"text-b1 text-sm font-normal text-right"},At={class:"flex justify-between items-center mt-[16px]"},Et={class:"text-b3 text-sm font-normal"},jt=["href"],Pt=e("img",{src:Se,class:"w-5 h-5 ml-1",alt:""},null,-1),Nt={key:1},Ot={class:"flex justify-between items-center mt-[16px]"},Dt={class:"text-b3 text-sm font-normal"},Rt=e("img",{src:W,class:"w-5 h-5 ml-1",alt:""},null,-1),It={class:"flex justify-between items-center mt-[16px]"},Lt={class:"text-b3 text-sm font-normal"},Bt=e("img",{src:W,class:"w-5 h-5 ml-1",alt:""},null,-1),Mt={key:1},Ut={key:1,class:"flex justify-between items-center mt-[16px]"},Ht={class:"text-b3 text-sm font-normal"},Ft={class:"text-b1 text-sm font-normal text-right"},Vt={key:2,class:"flex justify-between items-center mt-[16px]"},Yt={class:"text-b3 text-sm font-normal"},Gt={class:"text-b1 text-sm font-normal text-right"},Kt={key:3,class:"flex justify-between items-center mt-[16px]"},qt={class:"text-b3 text-sm font-normal"},Wt={key:0},Jt={key:1},Qt={class:"text-b1 text-sm font-normal text-right"},Zt={key:4,class:"flex justify-between items-center mt-[16px]"},zt={class:"text-b3 text-sm font-normal"},Xt={class:"text-b1 text-sm font-normal text-right"},es={class:"flex justify-between items-center mt-[16px]"},ts={class:"text-b3 text-sm font-normal whitespace-nowrap"},ss={class:"text-b1 text-sm font-normal text-right flex items-center"},os={class:"break-all flex-1"},ns=e("img",{src:W,class:"w-5 h-5",alt:""},null,-1),rs=[ns],as={props:{order:{type:Object,required:!0,default:()=>({})}},setup(t){const c=t,v=w(()=>{var i,_;const r=((i=c.order)==null?void 0:i.orderRealAmount)||0,d=((_=c.order)==null?void 0:_.voucherAmount)||0;return new fe(r).minus(d).toNumber()});return(r,d)=>{var i;return n(),l("div",Me,[e("div",Ue,[e("span",null,o(r.$t("order.orderInfo")),1)]),e("div",He,[e("div",Fe,[e("div",Ve,o(r.$t("offline.pay type method")),1),e("div",Ye,o(t.order.orderPaySource?s(De)(+t.order.orderPaySource):"--"),1)]),e("div",Ge,[e("div",Ke,o(r.$t("offline.order_price")),1),e("div",qe,[e("p",We,[Je,e("span",Qe,o(s(C)(t.order.orderTotalAmount)),1)])])]),t.order.actAmount?(n(),l("div",Ze,[e("div",ze,o(((i=t.order.fmGeneralActivity)==null?void 0:i.name)||"-"),1),e("div",Xe,[e("p",et,[tt,st,e("span",ot,o(s(C)(t.order.actAmount)),1)])])])):h("",!0),e("div",nt,[e("div",rt,o(r.$t("order.total price actual buyer")),1),e("div",at,[+t.order.orderPaySource===s(Oe).USDT_WALLET?(n(),l("div",lt,[e("span",it,[e("span",ct,[dt,N(" "+o(s(C)(t.order.orderRealUsdt||0)),1)]),e("span",mt,[ut,ft,e("span",null,o(s(C)(s(v))),1),ht]),t.order.voucherAmount?(n(),l("span",xt,[_t,vt,e("span",pt,o(s(C)(t.order.voucherAmount||0)),1)])):h("",!0)])])):(n(),l("div",yt,[bt,e("span",gt,[e("span",null,o(s(C)(s(v)||0)),1),t.order.voucherAmount?(n(),l(X,{key:0},[wt,Ct,e("span",Tt,o(s(C)(t.order.voucherAmount||0)),1)],64)):h("",!0)])]))])]),e("div",St,[e("div",$t,o(r.$t("common.ratio")),1),e("div",kt,o(t.order.orderDiscountRatio)+"% ",1)]),e("div",At,[e("div",Et,o(r.$t("order.hash")),1),t.order.orderTransactionHash?(n(),l("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${s($e).chainConfig.blockExplorerUrls[0]}/tx/${t.order.orderTransactionHash}`},[N(o(s(G)(t.order.orderTransactionHash,"***",9,5)||"--")+" ",1),Pt],8,jt)):(n(),l("span",Nt," -- "))]),e("div",Ot,[e("div",Dt,o(r.$t("offline.create address")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:d[0]||(d[0]=_=>s(K)(t.order.orderCustomerAddress))},[N(o(s(G)(t.order.orderCustomerAddress,"...",5,5))+" ",1),Rt])]),e("div",It,[e("div",Lt,o(r.$t("order.payAddress")),1),e("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:d[1]||(d[1]=_=>s(K)(t.order.orderPayAddress))},[t.order.orderPayAddress?(n(),l(X,{key:0},[N(o(s(G)(t.order.orderPayAddress,"...",5,5))+" ",1),Bt],64)):(n(),l("span",Mt,"--"))])]),t.order.createTime?(n(),l("div",Ut,[e("div",Ht,o(r.$t("order.createTime")),1),e("div",Ft,o(s(q)(t.order.createTime)),1)])):h("",!0),t.order.payTime?(n(),l("div",Vt,[e("div",Yt,o(r.$t("order.chainFinishTime")),1),e("div",Gt,o(s(q)(t.order.payTime)),1)])):h("",!0),t.order.finishTime?(n(),l("div",Kt,[e("div",qt,[t.order.orderStatus===s(x).CANCELLED?(n(),l("span",Wt,o(r.$t("offline.cancel_time")),1)):(n(),l("span",Jt,o(r.$t("order.finishTime")),1))]),e("div",Qt,o(s(q)(t.order.finishTime)),1)])):h("",!0),t.order.orderStatus===s(x).CANCELLED?(n(),l("div",Zt,[e("div",zt,o(r.$t("offline.cancel_reason")),1),e("div",Xt,o(t.order.cancelReason||"--"),1)])):h("",!0),e("div",es,[e("div",ts,o(r.$t("order.orderNumber")),1),e("div",ss,[e("div",os,o(t.order.orderId||"--"),1),e("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:d[2]||(d[2]=_=>s(K)(t.order.orderId))},rs)])])])])}}},ls={class:"p-3 break-all bg-white rounded-xl"},is={class:"font-semibold text-base text-b1"},cs={key:0},ds={key:1},ms={key:2,class:"text-[#FF8812] mx-1"},us={class:"mt-1 font-normal text-sm text-b2"},fs={key:0},hs={key:1},xs={props:{order:{type:Object,required:!0}},emits:["timeDone"],setup(t,{emit:c}){const v=t,r=g(!1),d=g(b());let i=null;const _=g(null),S=w(()=>b(v.order.payTime).add(24,"hours")),k=w(()=>{const u=S.value.diff(d.value);return Math.max(0,u)}),L=w(()=>{const u=b(),p=b(v.order.payTime);return u.diff(p,"hours")>=24}),O=w(()=>{const u=k.value;if(u<=0)return"";const p=b.duration(u),A=Math.floor(p.asHours()),R=p.minutes(),B=p.seconds(),M=A*3600+R*60+B;return b.utc(M*1e3).format("HH:mm:ss")}),D=()=>{d.value=b(),k.value<=0&&i&&_.value>0&&(clearInterval(i),i=null,r.value=!0,c("timeDone")),_.value=k.value};return ee(()=>{d.value=b(),L.value?r.value=!0:(D(),i=setInterval(D,1e3))}),he(()=>{i&&(clearInterval(i),i=null)}),(u,p)=>(n(),l("div",ls,[e("div",is,[r.value?(n(),l("span",ds,o(u.$t("offline.long time not confirm by merchant")),1)):(n(),l("span",cs,o(u.$t("offline.wait merchant confirm")),1)),!r.value&&s(O)?(n(),l("span",ms,o(s(O)||""),1)):h("",!0)]),e("div",us,[r.value?(n(),l("span",hs,o(u.$t("offline.can be cancel order and refund")),1)):(n(),l("span",fs,o(u.$t("offline.countdown end can be cancel order and refund")),1))])]))}},_s={class:"flex justify-between items-center gap-3 fixed bottom-0 left-0 right-0 px-3 pb-4"},vs={key:0,class:"relative w-full"},ps={props:{order:{type:Object,default:()=>({})},cancelLoading:{type:Boolean,default:!1},cancelDisabled:{type:Boolean,default:!1}},emits:["handleCancel"],setup(t,{emit:c}){const v=()=>{c("handleCancel")};return(r,d)=>{const i=xe("VanButton");return n(),l("div",_s,[t.order.orderStatus===s(x).PAYMENT_SUCCESS?(n(),l("div",vs,[T(i,{round:"",class:"w-full main-btn font-normal text-base h-[46px] rounded-full",onClick:v,loading:t.cancelLoading,disabled:t.cancelDisabled},{default:te(()=>[N(o(r.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"])])):h("",!0)])}}},ys={class:"px-3 pb-20 flex flex-col gap-3 safe-body overflow-y-auto"},bs={class:"w-full p-3 rounded-xl bg-white font-Puhui"},gs={setup(t){var z;const{t:c}=ve(),v=pe(),r=ye(),[d,i]=j(!1),[_,S]=j(!1),{getUserDhKey:k,decryptKey:L}=ke(),{offlineUserCancel:O}=Ae(),{checkLoginAuth:D}=Ee(),[u,p]=j(!1),A=g("取消成功"),R=g(!1),B={[x.PAYMENT_FAILED]:c("order.fail"),[x.PAYING]:c("order.paying"),[x.PAYMENT_SUCCESS]:c("order.To be confirmed"),[x.CANCELLED]:c("order.canceled"),[x.COMPLETED]:c("order.completed"),[x.CLOSED]:c("order.closed")},M=24*60*60*1e3,a=g({}),J=g(((z=v.query)==null?void 0:z.id)||""),U=async(f=!1)=>{var y,$;f||Y.loading({message:c("common.loading"),forbidClick:!0}),i(!0);const m=await je({id:J.value});if(Y.clear(),i(!1),m.success&&m.data&&(a.value=m.data||{},(y=m.data)!=null&&y.orderRemark&&(($=m.data)!=null&&$.orderSubmitShopPubKey)))try{const E=await k(m.data.shopId,m.data.orderSubmitShopPubKey);if(console.log("dhkey:",E),E){const ue=L(m.data.orderRemark,E);a.value.orderRemark=ue.decrypt}}catch(E){console.error("解密失败:",E)}},H=g(null),[oe,F]=j(!1),ne=()=>{(a.value.orderStatus||null)===x.PAYMENT_SUCCESS?F(!0):Y(c("offline.order status does not support cancel"))},re=f=>{H.value=f,console.log("cancelReason",H.value),F(!1),ie()},[ae,V]=j(!1),le=c("offline.cancel important msg buyer"),ie=()=>{V(!0)},Q=()=>{V(!1)},ce=async()=>{V(!1);const f={orderId:a.value.orderId,cancelReason:H.value.value||"其他",cancelSource:1};S(!0);const m=await Ne(f);if(S(!1),!m.success)return;const y=[a.value.chainOrderId];S(!0);const $=await O(y);S(!1),$.success&&(U(!0),R.value=!1,A.value=c("offline.successful of cancel "),p(!0),sessionStorage.setItem("consumer_offline_refresh_chainOrderId",J.value.toString()),setTimeout(()=>{r.go(-1)},1950))},Z=w(()=>Re(a.value.orderType)),de=w(()=>B[a.value.orderStatus]||"--"),me=w(()=>{if(!a.value.payTime)return!1;const f=a.value.payTime;return Date.now()-f<M});return ee(()=>{D(!0)&&U()}),(f,m)=>(n(),P(Ie,{title:f.$t("order.orderDetail"),class:"font-Puhui font-normal relative app-container main-bg","theme-vars":{"field-placeholder-text-color":"#A6A6A6",navBarBackgroundColor:"transparent"},ref:(y,$)=>{$.EvaluateDetailRef=y}},{default:te(()=>[e("section",ys,[a.value.orderStatus===s(x).PAYMENT_SUCCESS&&a.value.payTime?(n(),P(xs,{key:0,order:a.value,onTimeDone:U},null,8,["order"])):h("",!0),e("div",bs,[T(ge,{status:s(de),"show-order-status":"",loading:s(d),shop:{images:a.value.shopPics,name:a.value.shopName}},null,8,["status","loading","shop"]),s(Z).GOODS?(n(),P(be,{key:0,class:"mt-3",showNum:"",goods:{goodsName:a.value.relName||"-",goodsIcons:a.value.relIcons,goodsPrice:a.value.relPrice||0,goodsNumber:a.value.relNumber||0,areaExtName2:a.value.areaExtName2,storeName:a.value.storeName}},null,8,["goods"])):s(Z).STORE?(n(),P(Le,{key:1,price:a.value.orderRealAmount,loading:s(d)},null,8,["price","loading"])):h("",!0)]),T(as,{order:a.value},null,8,["order"]),T(we,{order:a.value,isBuyer:""},null,8,["order"]),T(ps,{order:a.value,cancelLoading:s(_),cancelDisabled:s(me),onHandleCancel:ne},null,8,["order","cancelLoading","cancelDisabled"])]),T(Ce,{show:s(oe),isBuyer:"",onClose:m[0]||(m[0]=y=>s(F)(!1)),onSelected:re},null,8,["show"]),T(Pe,{show:s(ae),title:f.$t("common.tip"),content:s(le),showConfirm:!0,showReject:!0,confirmText:f.$t("common.confirm"),noClose:"",onClose:Q,onConfirm:ce,onReject:Q},null,8,["show","title","content","confirmText"]),s(u)?(n(),P(Be,{key:0,onClose:m[1]||(m[1]=y=>s(p)(!1)),text:A.value,isError:R.value},null,8,["text","isError"])):h("",!0)]),_:1},8,["title"]))}},Fs=_e(gs,[["__scopeId","data-v-74701614"]]);export{Fs as default};
