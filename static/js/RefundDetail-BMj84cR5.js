import{_ as te}from"./copy-DlqB7kPH.js";import{_ as pe,y as ve,w as he,a1 as ye,r as b,x as G,bc as _e,D as xe,bh as we,F as i,G as n,H as s,a2 as l,K as C,O as p,Q as o,N as c,E as R,P as r,l as be,Y as ge,Z as Te,I as ke,J as Se,a0 as h,R as Ce,T as j}from"./vendor-D6JO6WHW.js";import{_ as Re}from"./RefundGoodItem-BhZgnTVv.js";import{B as $e}from"./BackIcon-CPUEW9je.js";import{a as Ie,c as Q,n as Z}from"./order-CiG11MXW.js";import{b as Ae}from"./refund-CX3StdUB.js";import{R as Ee,o as De,h as X,b as ee,l as Fe,r as Ne}from"./index-Ds2hFbCb.js";import{a as Be}from"./useRefundStatus-DY13i5Fs.js";import{P as $}from"./flashSale-DDyqLyYN.js";import{f as Oe}from"./useOrderStatus-DeHjEZ0k.js";import{_ as Ve}from"./RecommendationFeed-BSmjB-pW.js";import"./useShipTemplate-DNIdMMsN.js";import"./enums-DlE-aiss.js";import"./GoodsList-BR4FGHnZ.js";import"./buy-cart-3M2I0Qjc.js";import"./goods-BVwS8oFG.js";import"./ShopMaskTips-wgA1ZEjb.js";import"./shop-CeqcS6K2.js";import"./GoodsPrice-DdCD8Nfm.js";import"./MCOIN-BcbOHmhy.js";import"./mall-DVcn-9Y7.js";import"./cart-DAeJxrsl.js";import"./useShowActiveInfo-Dr0UG97x.js";import"./festivalActivities-STADYvlw.js";const je="/Test-dev/static/images/ic_round-auto-mode-l7j5TmeY.png",K=E=>(ge("data-v-b930b960"),E=E(),Te(),E),Ke={class:"refund-detail__container px-3 bg-transparent bg-gray1"},Le={class:"gap-2 mt-2 flex-start"},He={key:0,class:"px-2 py-4 mt-3 bg-white rounded-xl"},Me={key:0},Pe={class:"flex items-start",style:{}},Je={class:"w-2/6"},Ue={key:0,class:"flex-1 w-full pl-1 ml-1 opacity-60 line flex-nowrap"},ze={key:1,class:"text-[#2E2008] text-xs"},We={key:0,class:"flex-1 mt-2 text-xs opacity-60"},Ye={key:1},qe={class:"flex items-center justify-between"},Ge={class:"gap-2 flex-start"},Qe=K(()=>s("img",{src:je,class:"w-[16px]"},null,-1)),Ze={class:"text-[#2E2008] font-semibold"},Xe={class:"flex items-center justify-between mt-3"},et={class:"opacity-60 text-[#2E2008]"},tt={class:"font-semibold"},st={key:0,class:"mt-2 text-xs opacity-60"},at={key:1,class:"mt-2 text-xs opacity-60"},ot={key:2,class:"opacity-60 text-[#2E2008] mt-3"},nt={class:"mt-4 flex-center-bw"},rt={class:"opacity-60"},it={class:"mt-4 flex-center-bw"},lt={class:"opacity-60"},dt={key:1},ut={class:"mt-4 flex-center-bw"},ct={class:"opacity-60"},mt=K(()=>s("img",{src:te,class:"w-4 h-4 ml-2",alt:""},null,-1)),ft={class:"mt-4 flex-center-bw"},pt={class:"opacity-60"},vt=K(()=>s("img",{src:te,class:"w-4 h-4 ml-2",alt:""},null,-1)),ht={class:"mt-4 flex-center-bw"},yt={class:"opacity-60"},_t={class:"mt-4 flex-center-bw"},xt={class:"opacity-60"},wt={class:"flex justify-between gap-2 mt-4 text-right break-all"},bt={class:"opacity-60 whitespace-nowrap"},gt={key:2,class:"flex flex-wrap items-center justify-center gap-[20px] mt-[15px] overflow-hidden"},Tt=h(" 未發貨強制退款 "),kt={key:3,class:"flex justify-center text-sm text-[#2E2008]"},St={class:"text-sm leading-6 text-black"},Ct={class:"text-primary"},Rt={key:4,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},$t={key:5,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},It={key:6,class:"flex justify-center text-[#2E2008] text-xs text-center mt-5 pb-5"},At=ve({setup(E){const{getUserDhKey:L,decryptAddressKey:se,decryptKey:H}=Ee(),{loadingToggle:M}=Ne(),{senderForceCancel:ae,senderCancelUnsend:oe}=De(),{t:m}=he(),ne=ye(),P=be(),re=ne.query.id,e=b(null),g=b(null),y=b(null),T=b(!1),I=async()=>{var d,x,N,S,_,B;const t=JSON.parse(JSON.stringify(e.value)),a=await Ie({id:re});if((d=a.data)!=null&&d.userAddress&&(a.data.userAddress.postscript=a.data.postscript),(x=a.data)!=null&&x.userAddress&&((S=(N=a.data)==null?void 0:N.userAddress)!=null&&S.encryptFlag)){const u=await L(a.data.stores.id,(_=a.data)==null?void 0:_.submitMerchantPubKey);u&&(a.data.userAddress=se(a.data.userAddress,u))}if(a.data.shippingHash){const u=await L(a.data.stores.id,(B=a.data)==null?void 0:B.shippingMerchantPubKey);if(u){const w=H(a.data.expressNo,u);w.hash===a.data.shippingHash&&(a.data.expressNo=w.decrypt,a.data.expressCompany=H(a.data.expressCompany,u).decrypt)}}if(e.value=a.data,e.value.refundStatus===1){const u=new Date(e.value.systemTime).getTime(),w=new Date(e.value.autoRefundTime).getTime();g.value=w-u}T.value&&(t.payType==e.value.payType&&t.refundStatus==e.value.refundStatus||(T.value=!1))},ie=G(()=>e.value.payType===$.STORE_CARD?[{title:m("refund.apply refund"),value:0},{title:m("order.status4"),value:1},{title:m("refund.refund success tips"),value:3}]:[{title:m("refund.apply refund"),value:0},{title:m("refund.waiting deal with"),value:1},{title:m("order.blok comfirm"),value:2},{title:m("refund.refund success tips"),value:3}]),[V,J]=_e(!1),le=()=>{const t=Oe();return e.value.fmRefundReason&&e.value.fmRefundReason[t]},de=async()=>{M(!0);const{success:t}=await Ae({orderId:e.value.id});M(!1),t&&(j(m("common.revoke success")),P.go(-1))},U=()=>{P.push(`/category?deliveryType=1&shopId=${e.value.stores.id}`)},k=b(!1),ue=async()=>{k.value=!0;try{const a=(await Q({orderIds:e.value.id+""})).data.ordIds,d=await ae(a[0]);if(!d.success||!(await Z({ordIds:a,hash:d.result.transactionHash})).success)return;T.value=!0,setTimeout(()=>{I(),y.value=setInterval(()=>{T.value?I():(clearInterval(y.value),y.value=null)},3e3)},1500)}catch(t){j(t.message||t)}finally{k.value=!1}},ce=async()=>{k.value=!0;try{const a=(await Q({orderIds:e.value.id+""})).data.ordIds,d=await oe(a[0]);if(!d.success||!(await Z({ordIds:a,hash:d.result.transactionHash})).success)return;T.value=!0,setTimeout(()=>{I(),y.value=setInterval(()=>{T.value?I():(clearInterval(y.value),y.value=null)},3e3)},1500)}catch(t){j(t.message||t)}finally{k.value=!1}},D=G(()=>{var t,a;if(((t=e.value)==null?void 0:t.refundStatus)===11&&((a=e.value)!=null&&a.platformInterventionCustomerTime)){const d=new Date(e.value.systemTime).getTime();return+e.value.platformInterventionCustomerTime+24*60*60*1e3*10-d}return null}),F=b(!1),me=()=>{F.value=!0},A=b(!1),fe=()=>{A.value=!0};return xe(async()=>{await I()}),we(()=>{clearInterval(y.value),y.value=null}),(t,a)=>{var u,w,z,W,Y,q;const d=R("van-count-down"),x=R("VanStep"),N=R("VanSteps"),S=R("van-icon"),_=R("VanButton"),B=R("i18n-t");return n(),i("div",Ke,[s("div",Le,[p($e),s("div",null,o(t.$t("order.refund title")),1)]),e.value?(n(),i("div",He,[e.value.refundStatus===1||e.value.refundStatus===2?(n(),i("div",Me,[p(N,{direction:"vertical",active:e.value.refundStatus},{default:c(()=>[(n(!0),i(ke,null,Se(r(ie),(v,f)=>(n(),C(x,{class:Ce(["text-xs",{"van-icon-checked::before":f===1}]),key:f},{default:c(()=>[s("div",Pe,[s("div",Je,o(f===1&&e.value.refundStatus>=2?t.$t("refund.shop completed"):v.title),1),f===1&&e.value.payType!==r($).STORE_CARD&&e.value.refundStatus<2&&g.value>0&&!A.value?(n(),i("div",Ue,[p(d,{time:g.value,onFinish:fe},{default:c(O=>[h(o(t.$t("common.shop will",{time:O.days+t.$t("common.days")+O.hours+t.$t("common.hours")+O.minutes+t.$t("common.minutes")+O.seconds+t.$t("common.seconds")})),1)]),_:1},8,["time"])])):f===1?(n(),i("div",ze,o(t.$t("refund.not delivered the goods")),1)):l("",!0)]),f===1&&e.value.payType!==r($).STORE_CARD&&e.value.refundStatus<2&&g.value>0&&!A.value?(n(),i("div",We,o(t.$t("refund.waiting refund tips")),1)):l("",!0)]),_:2},1032,["class"]))),128))]),_:1},8,["active"])])):(n(),i("div",Ye,[s("div",qe,[s("div",Ge,[Qe,s("div",Ze,o(t.$t("refund.order status")),1)])]),s("div",Xe,[s("div",et,o(t.$t("order.Current status of after-sales order")),1),s("div",tt,o(r(Be)(e.value.refundStatus)),1)]),e.value.refundStatus===5?(n(),i("div",st,o(r(m)("refund.cancel order tips")),1)):l("",!0),e.value.refundStatus===5?(n(),i("div",at,o(t.$t("common.cancel refund time"))+" ："+o(e.value.refundCancelTime||"-"),1)):l("",!0),e.value.refundSuccessTime?(n(),i("div",ot,o(e.value.refundSuccessTime),1)):l("",!0)]))])):l("",!0),e.value?(n(),C(Re,{key:1,order:e.value},{default:c(()=>{var v;return[s("div",nt,[s("div",rt,o(t.$t("refund.No")),1),s("div",null,o(e.value.id),1)]),s("div",it,[s("div",lt,o(t.$t("refund.reason text")),1),s("div",null,o(le()),1)]),r(V)?l("",!0):(n(),i("div",{key:0,class:"mt-4 text-center text-[#2E2008]",onClick:a[0]||(a[0]=f=>r(J)(!0))},[s("span",null,o(t.$t("common.check more")),1),p(S,{class:"ml-2",name:"arrow-down"})])),r(V)?(n(),i("div",dt,[s("div",ut,[s("div",ct,o(t.$t("order.hash")),1),s("div",{class:"flex items-center",onClick:a[1]||(a[1]=f=>r(X)(e.value.hash))},[h(o(r(ee)(e.value.hash,"***",9,5)||"-")+" ",1),mt])]),s("div",ft,[s("div",pt,o(t.$t("order.payAddress")),1),s("div",{class:"flex items-center",onClick:a[2]||(a[2]=f=>r(X)(e.value.stores.merchant))},[h(o(r(ee)(e.value.stores.merchant,"...",5,5))+" ",1),vt])]),s("div",ht,[s("div",yt,o(t.$t("order.payTime")),1),s("div",null,o(r(Fe)(e.value.createTime)),1)]),s("div",_t,[s("div",xt,o(t.$t("order.orderNumber")),1),s("div",null,o(e.value.id),1)]),s("div",wt,[s("div",bt,o(t.$t("order.orderRemark")),1),s("div",null,o(((v=e.value.userAddress)==null?void 0:v.postscript)||"-"),1)])])):l("",!0),r(V)?(n(),i("div",{key:2,class:"mt-4 text-center text-[#2E2008]",onClick:a[3]||(a[3]=f=>r(J)(!1))},[h(o(t.$t("refund.put way")),1),p(S,{class:"ml-2",name:"arrow-up"})])):l("",!0)]}),_:1},8,["order"])):l("",!0),e.value?(n(),i("div",gt,[e.value.refundStatus===1?(n(),C(_,{key:0,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:de},{default:c(()=>[h(o(t.$t("refund.cancel refund")),1)]),_:1})):(n(),C(_,{key:1,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:U},{default:c(()=>[h(o(t.$t("refund.make order")),1)]),_:1})),e.value.refundStatus===11?(n(),C(_,{key:2,loading:k.value,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold",onClick:ue,disabled:!(!(r(D)>0)||F.value)},{default:c(()=>[h(o(t.$t("order.forced refund")),1)]),_:1},8,["loading","disabled"])):l("",!0),e.value.payType!==r($).STORE_CARD&&e.value.refundStatus<2&&(g.value<0||A.value)?(n(),C(_,{key:3,onClick:ce,loading:k.value,class:"btn h-[40px] min-w-[130px] px-4 text-white font-semibold"},{default:c(()=>[Tt]),_:1},8,["loading"])):l("",!0),p(_,{class:"text-[#FEA021] h-[40px] min-w-[130px] px-4 font-semibold btn-border",onClick:U},{default:c(()=>[h(o(t.$t("refund.concat sales")),1)]),_:1})])):l("",!0),((u=e.value)==null?void 0:u.refundStatus)===11&&r(D)>0&&!F.value?(n(),i("div",kt,[p(S,{name:"info-o",color:"red",size:"18px ",class:"mr-1"}),s("div",St,[p(d,{time:r(D),onFinish:me},{default:c(v=>[p(B,{keypath:"refund.userShopLockRefundTip",tag:"span"},{time:c(()=>[s("span",Ct,o(t.$t("refund.time",{days:v.days,hours:v.hours,minutes:v.minutes,seconds:v.seconds})),1)]),_:2},1024)]),_:1},8,["time"])])])):l("",!0),((w=e.value)==null?void 0:w.refundStatus)===11&&(r(D)<0||F.value)?(n(),i("div",Rt," *"+o(t.$t("refund.directly force a refund")),1)):l("",!0),((z=e.value)==null?void 0:z.payType)!==r($).STORE_CARD&&((W=e.value)==null?void 0:W.refundStatus)<2&&(g.value<0||A.value)?(n(),i("div",$t," *"+o(t.$t("refund.not delivered the goods")),1)):l("",!0),((Y=e.value)==null?void 0:Y.payType)!==r($).STORE_CARD&&+((q=e.value)==null?void 0:q.refundStatus)==30?(n(),i("div",It," *"+o(t.$t("refund.refund has been forced")),1)):l("",!0),p(Ve,{"title-text":r(m)("common.recommend_for_you"),class:"pt-[10px]"},null,8,["title-text"])])}}}),ts=pe(At,[["__scopeId","data-v-b930b960"]]);export{ts as default};
