import{o as ae,_ as oe}from"./BillItem-DjVJEQ1M.js";import{B as ne}from"./BackIcon-CPUEW9je.js";import{o as le}from"./bill-CuHmtJ6L.js";import{R as re,a as ce,e as de,u as ie,b0 as ue,b as fe}from"./index-Ds2hFbCb.js";import{_ as ve,y as me,w as pe,r as a,x as P,D as he,F as b,G as d,H as o,O as k,a2 as xe,Q as c,P as i,N as m,E as j,a1 as ye,I as S,J as A,K as O,a0 as C,R as z,ad as D,ac as _e}from"./vendor-D6JO6WHW.js";import"./useOrderStatus-DeHjEZ0k.js";const be={class:"px-3 text-sm text-default"},ke={class:"gap-2 mt-2 flex-start"},we={class:"max-h-[calc(100vh-28px)] overflow-y-scroll"},ge={class:"flex flex-col min-h-[70vh] justify-between px-5"},Ce={class:"flex-1 overflow-y-scroll"},$e={class:"mt-[18px] font-semibold text-base text-center"},Ie={class:"mt-[20px]"},Le={class:"text-base font-semibold"},Be={class:"flex items-center justify-start gap-2 mt-3 flex-wrap"},Fe={class:"mt-[20px]"},Se={class:"text-base font-semibold"},Ae={class:"flex items-center justify-start gap-2 mt-3 flex-wrap"},Oe={class:"py-4 flex justify-between gap-6"},Ve=me({setup(Re){var K,N;const{t:V}=pe(),{getMerchantDhKey:E,decryptKey:M}=re(),{userInfo:Te}=ce(),{accountStore:l}=de();ye();const{getCurrentStoreId:H}=ie(),u=a([]),w=a(!1),f=a(!1),p=a(0),q=a(20),R=a(0),G=2,h=a(!1),x=a(null),g=a(""),J=P(()=>ae()),r=a([]),Q=e=>{if(e===""){r.value=[];return}const s=r.value.findIndex(n=>n==e);s>-1?r.value.splice(s,1):r.value.push(+e)},$=a(l.store.merchant),v=a(l.account),U=a((K=l.store)==null?void 0:K.nickname),W=a((N=l==null?void 0:l.store)==null?void 0:N.id),y=P(()=>{if(!l.store.id)return!0;const e=$.value?$.value.toLowerCase():"",s=v.value?v.value.toLowerCase():"";return e==s?X():Y(),e==s}),X=async()=>{const e=await H();if(!(e!=null&&e.id))return;const s=await ue({shopId:e.id,page:1,size:100});s.success&&(x.value=s.data||[],y.value&&(x.value.unshift({nickname:V("common.myself"),address:v.value}),x.value.unshift({nickname:V("common.all"),address:""})))},Y=()=>{x.value=[{id:1,nickname:U.value,address:v.value}]},I=async()=>{w.value||(w.value=!0,p.value+=1,await T(),w.value=!1)},Z=async()=>{p.value=1,f.value=!1,u.value=[],await T()},L=a([]),T=async()=>{const e=await le({page:p.value,size:q.value,shopId:W.value,merchantAddress:l.store.id?$.value:v.value,orderCashierAddress:y.value?g.value||null:v.value,orderTypes:y.value?r.value.length>0?r.value:null:[3]});if(w.value=!1,!e.success){f.value=!0;return}if(!e.data||!e.data.total){f.value=!0;return}R.value=e.data.total;for(let s=0;s<e.data.records.length;s++){const n=e.data.records[s];if(n.merchantAddress&&n.orderSubmitCustomerPubKey){const _=await E(n.merchantAddress,n.orderSubmitCustomerPubKey);if(_){const{decrypt:t}=M(n.orderRemark,_);t&&(n.orderRemark=t)}}}L.value=e.data.records,u.value=p.value===1?L.value:u.value.concat(L.value),u.value.length>=R.value&&(f.value=!0)},ee=()=>{h.value=!1,p.value=0,f.value=!1,u.value=[],I()},B=()=>{h.value=!1},te=()=>{y.value&&(g.value=""),r.value=[],Z(),B()},se=e=>{g.value=e};return he(()=>{I()}),(e,s)=>{const n=j("VanList"),_=j("VanButton");return d(),b("div",be,[o("div",ke,[k(ne),o("div",null,c(e.$t("shop.fundDetail")),1),i(y)&&i(l).store.id?(d(),b("div",{key:0,class:"ml-auto text-sm font-normal whitespace-nowrap",onClick:s[0]||(s[0]=t=>h.value=!0)},c(e.$t("common.filter")),1)):xe("",!0)]),o("div",we,[k(n,{finished:f.value,"finished-text":e.$t("common.noMore"),"loading-text":e.$t("common.loading"),onLoad:I},{default:m(()=>[(d(!0),b(S,null,A(u.value,t=>(d(),O(oe,{key:t.id,type:G,bill:t},null,8,["bill"]))),128))]),_:1},8,["finished","finished-text","loading-text"])]),k(i(_e),{teleport:"body",show:h.value,"onUpdate:show":s[1]||(s[1]=t=>h.value=t),round:"",position:"bottom",closeable:"",style:{minHeight:"70vh"},"close-on-click-overlay":"",onClickOverlay:B,onClickCloseIcon:B},{default:m(()=>[o("div",ge,[o("div",Ce,[o("div",$e,c(e.$t("shop.fundFilter")),1),o("div",Ie,[o("div",Le,c(e.$t("common.cashierStatus")),1),o("div",Be,[(d(!0),b(S,null,A(x.value,t=>(d(),O(_,{class:z(["rounded-[6px] text-sm px-3 h-[35px] text-black min-w-min whitespace-nowrap border-none",g.value==t.address?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:t.id,onClick:F=>se(t.address)},{default:m(()=>[C(c(t.nickname||i(fe)(t.address,"...",4,4)),1)]),_:2},1032,["class","onClick"]))),128))]),o("div",Fe,[o("div",Se,c(e.$t("common.orderType")),1),o("div",Ae,[(d(!0),b(S,null,A(i(J),t=>(d(),O(_,{class:z(["rounded-[6px] text-sm px-3 h-[35px] text-black min-w-min whitespace-nowrap border-none",t.key===""&&!r.value.length||t.key!==""&&r.value.findIndex(F=>F==t.key)>-1?"bg-yellow text-black":"bg-[#F5F5F5] text-black"]),key:t.key,onClick:F=>Q(t.key)},{default:m(()=>[C(c(t.label),1)]),_:2},1032,["class","onClick"]))),128))])])])]),o("div",Oe,[k(i(D),{class:"bg-[#f5f5f5] text-default rounded-md h-[46px] flex-1 border-none",onClick:te},{default:m(()=>[C(c(e.$t("common.reset")),1)]),_:1}),k(i(D),{class:"rounded-md text-default h-[46px] flex-1 bg-btnOrBg border-none",onClick:ee},{default:m(()=>[C(c(e.$t("common.confirm")),1)]),_:1})])])]),_:1},8,["show"])])}}}),Ee=ve(Ve,[["__scopeId","data-v-c7424700"]]);export{Ee as default};
