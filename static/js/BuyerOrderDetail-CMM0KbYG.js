import{y as tt,x as B,F as y,G as u,H as t,Q as n,a2 as c,O as I,w as Z,B as q,P as r,I as J,a0 as R,E as _t,K as x,N as M,a4 as he,S as Je,r as p,D as ae,a9 as st,_ as Ut,a1 as Gt,be as O,T as S,R as Wt,l as Ht}from"./vendor-BUT0HZ5j.js";import{d as G,q as T,b as Ye,h as ye,l as oe,R as Kt,e as Vt,o as zt,f as Ze,s as Y,C as ve,B as Jt,bu as Yt}from"./index-hbwLMIYO.js";import{a as Zt,_ as Qe,b as Qt,c as Xt}from"./remark-BjLM3vf1.js";import{B as es,V as ts}from"./VoucherConfirm-DmbsSs33.js";import{_ as ot}from"./CountdownLabel-D3fsbYlX.js";import{_ as Q}from"./MCOIN-BcbOHmhy.js";import{_ as ss}from"./USDT-BFPkoPAz.js";import{_ as os}from"./FMCP-CFalj3L2.js";import{_ as as}from"./link-BVzz25qg.js";import{_ as we}from"./copy-w-7FY5xbhR.js";import{P as j}from"./order-H59PKTFP.js";import{P as pe}from"./flashSale-DDyqLyYN.js";import{p as rs}from"./useOrderStatus-BSCfQVBG.js";import{i as ns,b as is,a as ge,g as ls}from"./orderTime-wuAm_Rxx.js";import{_ as be}from"./SubmitApprove-dtpMOaFi.js";import{P as us}from"./PaySwitchPop-tsgWrntJ.js";import{_ as Xe}from"./EmptyTipsPop-_FH8A6A8.js";import{B as ds}from"./BackIcon-biFt6cm7.js";import{a as cs,C as ms,l as fs,D as hs,c as xe,n as et,E as ys,F as vs,t as bs,u as xs}from"./order-CKUhc8Y9.js";import{p as ps}from"./piggyBank-DIfLFOiI.js";import"./useShipTemplate-SAWfRcmZ.js";import"./enums-DlE-aiss.js";import"./default-avatar-C3GeIXRh.js";import"./selected-icon-DEJAhYK1.js";import"./useRefundStatus-DsYoZX36.js";import"./success_logo-DWbMJpkY.js";const ws={class:"p-3 break-all bg-white rounded-xl"},gs={class:"font-semibold text-sm text-b1"},Ts={class:"mt-1 text-b2 text-sm font-normal"},$s={class:"ml-1"},Cs=tt({props:{order:null,showCopy:{type:Boolean,default:!0}},setup(e){const{order:h}=e;return B(()=>`${h.userAddress.provinceName??""}${h.userAddress.cityName??""}${h.userAddress.countyName??""}${h.userAddress.detailInfo??""} ${h.userAddress.userName??""} ${h.userAddress.telNumber??""}`),(D,v)=>(u(),y("div",ws,[t("div",gs,n(h.userAddress.provinceName??"")+n(h.userAddress.cityName??"")+n(h.userAddress.countyName??"")+n(h.userAddress.detailInfo??""),1),t("div",Ts,[t("span",null,n(h.userAddress.userName),1),t("span",$s,n(h.userAddress.telNumber??""),1)])]))}}),ks={key:0,class:"p-3 break-all bg-white rounded-xl"},As={class:"font-semibold text-base text-b1"},Ss=t("span",null,"请在",-1),Ds={class:"text-[#FF8812] mx-1"},Rs=t("span",null,"内支付",-1),Ps=t("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后订单将超时关闭 ",-1),Is={props:{order:{type:Object,required:!0}},emits:["timeDone"],setup(e,{emit:h}){return(D,v)=>e.order.status===0?(u(),y("div",ks,[t("div",As,[Ss,t("span",Ds,[I(ot,{class:"inline-block w-auto",startTime:e.order.createTime,duration:15,durationType:"minutes",showZero:!0,onDone:v[0]||(v[0]=w=>h("timeDone"))},null,8,["startTime"])]),Rs]),Ps])):c("",!0)}},Bs={class:"p-3 py-4 break-all bg-white rounded-xl"},Ls={class:"title text-b1 text-sm font-semibold"},Ns={class:"content"},Os={class:"flex justify-between items-center mt-4"},js={class:"text-b3 text-sm font-normal"},Fs={class:"text-b1 text-sm font-normal text-right"},Es={class:"flex justify-between items-center mt-4"},Ms={class:"text-b3 text-sm font-normal"},qs={class:"text-b1 text-sm font-normal text-right flex items-center"},_s=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Q})],-1),Us={class:"ml-1"},Gs={key:0,class:"flex justify-between items-center mt-4"},Ws={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Hs={class:"text-b1 text-sm font-normal text-right flex items-center"},Ks={class:"mr-1"},Vs=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Q})],-1),zs={class:"ml-1"},Js={key:1,class:"flex justify-between items-center mt-4"},Ys={class:"text-b3 text-sm font-normal line-clamp-1 max-w-[100px]"},Zs={class:"text-b1 text-sm font-normal text-right flex items-center"},Qs=t("div",{class:"mr-1"},"-",-1),Xs=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Q})],-1),eo={class:"ml-1"},to={class:"flex justify-between items-center mt-4"},so={class:"text-b3 text-sm font-normal"},oo={class:"text-b1 text-sm font-normal text-right flex items-center gap-1"},ao=t("img",{class:"w-4 h-4",src:ss},null,-1),ro=R("( "),no=t("img",{class:"w-4 h-4",src:Q},null,-1),io=t("div",{class:"flex-shrink-0"},[t("img",{class:"w-4 h-4",src:Q})],-1),lo=t("span",{class:"text-[#999]"},"+",-1),uo=t("img",{class:"w-4 h-4",src:os},null,-1),co={class:"flex justify-between items-center mt-4"},mo={class:"text-b3 text-sm font-normal"},fo={class:"text-b1 text-sm font-normal text-right"},ho={class:"flex items-center"},yo={class:"flex justify-between items-center mt-4"},vo={class:"text-b3 text-sm font-normal"},bo=["href"],xo=t("img",{src:as,class:"w-5 h-5 ml-1",alt:""},null,-1),po={key:1},wo={class:"flex justify-between items-center mt-4"},go={class:"text-b3 text-sm font-normal"},To=t("img",{src:we,class:"w-5 h-5 ml-1",alt:""},null,-1),$o={key:2,class:"flex justify-between items-center mt-4"},Co={class:"text-b3 text-sm font-normal"},ko={class:"text-b1 text-sm font-normal text-right"},Ao={key:3,class:"flex justify-between items-center mt-4"},So={class:"text-b3 text-sm font-normal"},Do={class:"text-b1 text-sm font-normal text-right"},Ro={key:4,class:"flex justify-between items-center mt-4"},Po={class:"text-b3 text-sm font-normal"},Io={class:"text-b1 text-sm font-normal text-right"},Bo={key:5,class:"flex justify-between items-center mt-4"},Lo={class:"text-b3 text-sm font-normal"},No={class:"text-b1 text-sm font-normal text-right"},Oo={key:6,class:"flex justify-between items-center mt-4"},jo={class:"text-b3 text-sm font-normal whitespace-nowrap"},Fo={class:"text-b1 text-sm font-normal text-right flex items-center"},Eo={class:"break-all flex-1"},Mo=t("img",{src:we,class:"w-5 h-5",alt:""},null,-1),qo=[Mo],_o={key:7,class:"flex justify-between items-center mt-4"},Uo={class:"text-b3 text-sm font-normal whitespace-nowrap"},Go={class:"text-b1 text-sm font-normal text-right break-all"},Wo={key:8,class:"flex justify-between items-center mt-4"},Ho={class:"text-b3 text-sm font-normal whitespace-nowrap"},Ko={class:"text-b1 text-sm font-normal text-right flex items-center"},Vo={class:"break-all flex-1"},zo=t("img",{src:we,class:"w-5 h-5",alt:""},null,-1),Jo=[zo],Yo={props:{order:{type:Object,required:!0}},setup(e){const h=e,{t:D}=Z(),v=B(()=>{let l=0;return l=new q(h.order.totalAmount||0).minus(h.order.voucherAmount||0),G(l)}),w=B(()=>{var m;const l=h.order.orderGoods||[];return l.length>0?l[0].discountRatio||0:((m=h.order.stores)==null?void 0:m.discountRatio)||0});return(l,m)=>{var $,A;return u(),y("div",Bs,[t("div",Ls,[t("span",null,n(l.$t("order.orderInfo")),1)]),t("div",Ns,[t("div",Os,[t("div",js,n(l.$t("common.pay type method")),1),t("div",Fs,n(r(rs)(+e.order.paySource)),1)]),t("div",Es,[t("div",Ms,n(l.$t("order.total price detail")),1),t("div",qs,[_s,t("div",Us,n(r(G)(e.order.totalAmountOriginal||e.order.totalAmount)),1)])]),e.order.merchantAdjustAmount?(u(),y("div",Gs,[t("div",Ws,n(l.$t("order.merchant modify price")),1),t("div",Hs,[t("div",Ks,n(e.order.merchantAdjustAmount>0?"+":"-"),1),Vs,t("div",zs,n(Math.abs(e.order.merchantAdjustAmount)||0),1)])])):c("",!0),e.order.fmGeneralActivity&&e.order.activityReduceAmount?(u(),y("div",Js,[t("div",Ys,n((($=e.order.fmGeneralActivity)==null?void 0:$.name)||"-"),1),t("div",Zs,[Qs,Xs,t("div",eo,n(r(G)(e.order.activityReduceAmount)),1)])])):c("",!0),t("div",to,[t("div",so,n(l.$t("order.total price actual buyer")),1),t("div",oo,[+e.order.paySource===r(j).USDT_WALLET?(u(),y(J,{key:0},[ao,R(" "+n(r(G)(e.order.totalUsdt))+" ",1),e.order.payType===r(pe).STORE_CARD?(u(),y(J,{key:0},[R(" （"+n(r(G)(e.order.totalAmount))+n((A=e.order.fmStoredCard)==null?void 0:A.symbol)+"） ",1)],64)):(u(),y(J,{key:1},[ro,no,R(n(r(v))+" Mcoin)",1)],64))],64)):(u(),y(J,{key:1},[io,t("div",null,n(r(v)),1),e.order.voucherAmount?(u(),y(J,{key:0},[lo,uo,R(" "+n(r(G)(e.order.voucherAmount||0)),1)],64)):c("",!0)],64))])]),t("div",co,[t("div",mo,n(l.$t("common.ratio")),1),t("div",fo,[t("div",ho,n(r(w))+"%",1)])]),t("div",yo,[t("div",vo,n(l.$t("order.hash")),1),e.order.hash?(u(),y("a",{key:0,class:"text-sm font-normal text-right flex items-center underline text-[#FF8812]",href:`${r(T).chainConfig.blockExplorerUrls[0]}/tx/${e.order.hash}`},[R(n(r(Ye)(e.order.hash,"***",9,5)||"--")+" ",1),xo],8,bo)):(u(),y("span",po," -- "))]),t("div",wo,[t("div",go,n(l.$t("order.payAddress")),1),t("div",{class:"text-b1 text-sm font-normal text-right flex items-center",onClick:m[0]||(m[0]=L=>r(ye)(e.order.address))},[R(n(r(Ye)(e.order.address,"...",5,5))+" ",1),To])]),e.order.createTime?(u(),y("div",$o,[t("div",Co,n(l.$t("order.createTime")),1),t("div",ko,n(r(oe)(e.order.createTime)),1)])):c("",!0),e.order.chainCreateTime?(u(),y("div",Ao,[t("div",So,n(l.$t("order.chainFinishTime")),1),t("div",Do,n(r(oe)(e.order.chainCreateTime)),1)])):c("",!0),e.order.expressTime?(u(),y("div",Ro,[t("div",Po,n(l.$t("order.expressTime")),1),t("div",Io,n(r(oe)(e.order.expressTime)),1)])):c("",!0),e.order.finishTime?(u(),y("div",Bo,[t("div",Lo,n(l.$t("order.finishTime")),1),t("div",No,n(e.order.finishTime?r(oe)(e.order.finishTime):"-"),1)])):c("",!0),e.order.id&&e.order.status!==0?(u(),y("div",Oo,[t("div",jo,n(l.$t("order.orderNumber")),1),t("div",Fo,[t("div",Eo,n(e.order.id),1),t("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:m[1]||(m[1]=L=>r(ye)(e.order.id))},qo)])])):c("",!0),e.order.expressCompany?(u(),y("div",_o,[t("div",Uo,n(l.$t("order.deliveryCompany")),1),t("div",Go,n(e.order.expressCompany),1)])):c("",!0),e.order.expressNo?(u(),y("div",Wo,[t("div",Ho,n(l.$t("order.deliveryNum")),1),t("div",Ko,[t("div",Vo,n(e.order.expressNo),1),t("div",{class:"ml-1 w-5 h-5 min-w-5 min-h-5",onClick:m[2]||(m[2]=L=>r(ye)(e.order.expressNo))},Jo)])])):c("",!0)])])}}},Zo={class:"flex justify-between items-center gap-3 mt-5 fixed left-0 right-0 bottom-0 safe-bottom px-3"},Qo={key:0,class:"flex justify-between items-center gap-3 w-full"},Xo={class:"relative w-full flex-1"},ea={class:"relative w-full flex-1"},ta={key:0},sa={props:{order:{type:Object,required:!0},btnLoading:{type:Boolean,default:!1},nowTime:{type:Number,default:0},continuePayLoading:{type:Boolean,default:!1},cancelLoading:{type:Boolean,default:!1},voucherPrice:{type:Number,default:0}},emits:["handleDelay","handleDelayReceipt","handleTo","cancelOrder","continuePay","timeDone"],setup(e,{emit:h}){const{t:D}=Z();return(v,w)=>{const l=_t("VanButton");return u(),y("div",Zo,[e.order.status===0&&!e.order.hash?(u(),y("div",Qo,[t("div",Xo,[e.order.hash?c("",!0):(u(),x(l,{key:0,round:"",class:"w-full flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:e.btnLoading||e.cancelLoading,disabled:e.continuePayLoading||e.order.hash,onClick:w[0]||(w[0]=he(m=>v.$emit("cancelOrder"),["stop"]))},{default:M(()=>[R(n(v.$t("order.cancelOrder")),1)]),_:1},8,["loading","disabled"]))]),t("div",ea,[e.order.paySource!=r(j).PIGGY_BANK&&e.order.paySource!=r(j).WITHDRAW_POINTS?(u(),y("div",ta,[e.order.paySource==r(j).USDT_WALLET?(u(),x(be,{key:0,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(T).order,token:r(T).USDT,symbol:"USDT",loading:e.btnLoading,approveAmount:Number(e.order.paySource==r(j).USDT_WALLET?e.order.totalUsdt:0)},null,8,["contract","token","loading","approveAmount"])):c("",!0),e.order.paySource!=r(j).USDT_WALLET?(u(),x(be,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(T).order,token:r(T).MCOIN,symbol:"mcoin",loading:e.btnLoading,approveAmount:Number(e.order.paySource===r(j).USDT_WALLET?0:e.order.totalAmount)},null,8,["contract","token","loading","approveAmount"])):c("",!0)])):c("",!0),e.order.paySource==r(j).WITHDRAW_POINTS&&e.voucherPrice&&e.voucherPrice>0?(u(),x(be,{key:1,class:"absolute w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full z-10",contract:r(T).order,token:r(T).FMCP,symbol:v.$t("voucher.voucher"),loading:e.btnLoading,approveAmount:Number(e.voucherPrice)},null,8,["contract","token","symbol","loading","approveAmount"])):c("",!0),e.order.hash?c("",!0):(u(),x(l,{key:2,round:"",class:"w-full flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",disabled:e.order.hash,loading:e.continuePayLoading||e.btnLoading,onClick:w[1]||(w[1]=he(m=>v.$emit("continuePay"),["stop"]))},{default:M(()=>[t("span",null,n(v.$t("order.continuePay")),1),I(ot,{class:"inline-block ml-1",startTime:e.order.createTime,duration:15,durationType:"minutes",showZero:!1},null,8,["startTime"])]),_:1},8,["disabled","loading"]))])])):c("",!0),e.order.status===2&&r(ns)(e.order.chainCreateTime,e.order.confirmLimit)&&r(is)(e.order.expressTime,e.nowTime)>0&&e.order.payType!==r(pe).STORE_CARD?(u(),x(l,{key:1,round:"",class:"flex-1 gray-btn border-btn font-normal text-base h-[46px] rounded-full",loading:e.btnLoading,onClick:w[2]||(w[2]=he(m=>v.$emit("handleDelay"),["stop"]))},{default:M(()=>[R(n(v.$t("order.delayGeted")),1)]),_:1},8,["loading"])):c("",!0),+e.order.payType==+r(j).PIGGY_BANK&&e.order.status===4?(u(),x(r(Je),{key:2,to:`/refundService?id=${e.order.id}`,class:"flex-1"},{default:M(()=>[I(l,{round:"",class:"w-full gray-btn border-btn font-normal text-base h-[46px] rounded-full"},{default:M(()=>[R(n(v.$t("order.complaints")),1)]),_:1})]),_:1},8,["to"])):c("",!0),e.order.creditFlag&&e.order.refundStatus!=null&&e.order.status===1&&e.order.refundStatus===4?(u(),x(r(Je),{key:3,to:`/refundService?id=${e.order.id}&type=credit`,class:"flex-1"},{default:M(()=>[I(l,{round:"",class:"w-full gray-btn border-btn font-normal text-base h-[46px] rounded-full"},{default:M(()=>[R(n(v.$t("order.Platform intervention")),1)]),_:1})]),_:1},8,["to"])):c("",!0),e.order.status===2&&(!e.order.merchantsConfirm||r(ge)(e.order.merchantsConfirm,e.nowTime)>0)?(u(),x(l,{key:4,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:w[3]||(w[3]=m=>v.$emit("handleDelayReceipt")),loading:e.btnLoading},{default:M(()=>[R(n(v.$t("order.confirmGeted")),1)]),_:1},8,["loading"])):c("",!0),e.order.status===1&&e.order.refundStatus!==1&&e.order.refundStatus<10&&e.order.payType!==r(pe).STORE_CARD?(u(),x(l,{key:5,round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full",onClick:w[4]||(w[4]=m=>v.$emit("handleTo",`/refundService?id=${e.order.id}`)),loading:e.btnLoading},{default:M(()=>[R(n(v.$t("order.refund")),1)]),_:1},8,["loading"])):c("",!0)])}}},oa={key:0,class:"p-3 mt-3 break-all bg-white rounded-xl"},aa={class:"font-semibold text-base text-b1"},ra=t("span",null,"请在",-1),na={class:"text-[#FF8812] mx-1"},ia=t("span",null,"内确认收货",-1),la=t("div",{class:"mt-1 font-normal text-sm text-b2"}," 倒计时结束后商家可确认收货 ",-1),ua={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(e,{emit:h}){const D=e,{t:v}=Z(),w=p(Date.now());let l=null;const m=B(()=>{const b=ls(D.order.expressTime,D.order.confirmLimit,D.nowTime);return b>0?b:0}),$=B(()=>m.value>0),A=B(()=>{const b=m.value;if(b<=0)return"00天00时00分00秒";const a=Math.floor(b/(1e3*60*60*24)),W=Math.floor(b%(1e3*60*60*24)/(1e3*60*60)),E=Math.floor(b%(1e3*60*60)/(1e3*60)),H=Math.floor(b%(1e3*60)/1e3);return`${a.toString().padStart(2,"0")}天${W.toString().padStart(2,"0")}时${E.toString().padStart(2,"0")}分${H.toString().padStart(2,"0")}秒`}),L=()=>{w.value=Date.now(),m.value<=0&&l&&(clearInterval(l),l=null,h("timeDone"))};return ae(()=>{L(),m.value>0&&(l=setInterval(L,1e3))}),st(()=>{l&&(clearInterval(l),l=null)}),(b,a)=>r($)?(u(),y("div",oa,[t("div",aa,[ra,t("span",na,n(r(A)),1),ia]),la])):c("",!0)}},da={key:0,class:"p-3 break-all bg-white rounded-xl"},ca={class:"font-semibold text-base text-b1"},ma=t("span",null,"请在",-1),fa={class:"text-[#FF8812] mx-1"},ha=t("span",null,"内确认收货",-1),ya=t("div",{class:"mt-1 font-normal text-sm text-b2"}," 商家已确认收货，倒计时结束后将自动确认收货 ",-1),va={props:{order:{type:Object,required:!0},nowTime:{type:Number,required:!0}},emits:["timeDone"],setup(e,{emit:h}){const D=e,{t:v}=Z(),w=p(Date.now());let l=null;const m=B(()=>{const b=ge(D.order.merchantsConfirm,D.nowTime);return b>0?b:0}),$=B(()=>m.value>0),A=B(()=>{const b=m.value;if(b<=0)return"00天00时00分00秒";const a=Math.floor(b/(1e3*60*60*24)),W=Math.floor(b%(1e3*60*60*24)/(1e3*60*60)),E=Math.floor(b%(1e3*60*60)/(1e3*60)),H=Math.floor(b%(1e3*60)/1e3);return`${a.toString().padStart(2,"0")}天${W.toString().padStart(2,"0")}时${E.toString().padStart(2,"0")}分${H.toString().padStart(2,"0")}秒`}),L=()=>{w.value=Date.now(),m.value<=0&&l&&(clearInterval(l),l=null,h("timeDone"))};return ae(()=>{L(),m.value>0&&(l=setInterval(L,1e3))}),st(()=>{l&&(clearInterval(l),l=null)}),(b,a)=>r($)?(u(),y("div",da,[t("div",ca,[ma,t("span",fa,n(r(A)),1),ha]),ya])):c("",!0)}},ba={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},xa={class:"font-bold text-base text-b1"},pa={class:"px-3 safe-bottom pt-[50px] flex flex-col gap-3"},wa=tt({props:{nowTime:null},setup(e){const h=e,{getUserDhKey:D,decryptAddressKey:v,decryptKey:w,cryptoAESWithBuyerSearch:l}=Kt(),{t:m}=Z(),$=Ht(),A=Gt(),{reloadStore:L}=Vt(),b=A.query.id,a=p(null),[W,E]=O(!1),[H,X]=O(!1),[at,re]=O(!1),[rt,Te]=O(!1),$e=p(null),Ce=p(!1),nt=s=>{const o=s.target.scrollTop;Ce.value=o>25},[it,ke]=O(!1),[lt,Ae]=O(!1),ut=p(null),K=p(0),[dt,ee]=O(!1),Se=p("");p(0);const ne=p(!1),De=p(0),te=p(0),Re=p(0),Pe=p(0),Ie=p(0),[ct,V]=O(!1);p(!1);const{confirm:Be,senderDelay:mt,submit:ft}=zt(),{pointBalances:ht,mcoinRate:yt}=Ze(),{userMerchantCashs:vt,userTotalAmount:bt}=ps(),ie=p(null),Le=B(()=>ie.value?1/ie.value:1),Ne=p(0),Oe=p([]),U=async()=>{var o,d,i,f,C,g,_,N,F;const s=await cs({id:b});if((o=s.data)!=null&&o.userAddress&&(s.data.userAddress.postscript=s.data.postscript),(d=s.data)!=null&&d.userAddress&&((f=(i=s.data)==null?void 0:i.userAddress)!=null&&f.encryptFlag)){const P=await D(s.data.stores.id,(C=s.data)==null?void 0:C.submitMerchantPubKey);P&&(s.data.userAddress=v(s.data.userAddress,P))}if((g=s.data)!=null&&g.shippingHash){const P=await D(s.data.stores.id,(_=s.data)==null?void 0:_.shippingMerchantPubKey);if(P){const z=w(s.data.expressNo,P);z.hash===s.data.shippingHash&&(s.data.expressNo=z.decrypt,s.data.expressCompany=w(s.data.expressCompany,P).decrypt)}}!((N=s.data)!=null&&N.userEns)&&((F=s.data)!=null&&F.id)&&setTimeout(()=>{xt()}),a.value=s.data},xt=async()=>{var d,i,f,C,g,_,N,F,P,z,Ue,Ge,We,He,Ke,Ve,ze;let s=[(i=(d=a.value)==null?void 0:d.userAddress)==null?void 0:i.postscript,""+(((C=(f=a.value)==null?void 0:f.userAddress)==null?void 0:C.provinceName)||"")+(((_=(g=a.value)==null?void 0:g.userAddress)==null?void 0:_.cityName)||"")+(((F=(N=a.value)==null?void 0:N.userAddress)==null?void 0:F.countyName)||"")+(((z=(P=a.value)==null?void 0:P.userAddress)==null?void 0:z.detailInfo)||""),(Ge=(Ue=a.value)==null?void 0:Ue.userAddress)==null?void 0:Ge.telNumber,(We=a.value)==null?void 0:We.address,(Ke=(He=a.value)==null?void 0:He.stores)==null?void 0:Ke.storeName,(ze=(Ve=a.value)==null?void 0:Ve.stores)==null?void 0:ze.merchant],o=[];for(let se=0;se<s.length;se++)if(s[se]){let qt=await l(s[se]);o.push(qt)}ms({enInfoList:[{id:a.value.id,userEns:o.join("")}]})},pt=async()=>{const s=await fs({page:1,size:999,status:2,type:2});s.success&&(Ne.value=s.total,Oe.value=s.data.filter(o=>!o.merchantsConfirm||ge(o.merchantsConfirm,h.nowTime)>0))},le=p(1),{tradeContributeSelfRate:wt}=Ze(),gt=B(()=>{var o;if(!((o=a.value)!=null&&o.orderGoods))return 0;let s=new q(0);return a.value.orderGoods.forEach(d=>{if(+a.value.payType==1&&+d.payType==3||+d.payType!=2&&+d.payType!=3){const i=new q(d.price).times(d.number).minus(d.goodsActivityReduceAmount||0).plus(d.goodsAdjustChangeAmount||0).times(new q(d.discountRatio||0).div(100));s=s.plus(i)}}),s.times(le.value).toNumber()}),ue=B(()=>{var i;if(!((i=a.value)!=null&&i.orderGoods)||te.value<=0)return 0;const s=gt.value||0,o=le.value;return Math.min(te.value,new q(s).div(o).times(.5).toNumber())});ae(async()=>{le.value=await wt()});const Tt=async()=>{try{const{balanceOf:s}=Y(T.MCOIN),o=await s();De.value=+o;const d=await Y(T.FMCP).balanceOf();te.value=+d;const i=await Y(T.USDT).balanceOf();Re.value=+i,Pe.value=+await ht(),await Ct()}catch(s){console.error("获取余额失败:",s)}},$t=async()=>{try{ie.value=await yt()}catch(s){console.error("获取汇率失败:",s)}},Ct=async()=>{try{const{success:s,result:o}=await vt();if(!s)return;let d=0;const i=+await bt(),f=o.amounts.map(g=>Jt(g));o.cashIds.map(g=>+g).forEach((g,_)=>{g!==0&&(d=+q(d).plus(f[_]||0).toString())}),Ie.value=+q(i).minus(d)}catch(s){console.error("获取余额宝余额失败:",s)}},kt=()=>{Ae(!1),U()},At=s=>{$.push(s)},[je,de]=O(!1),[St,ce]=O(!1),Fe=async()=>{ce(!0)},Dt=async()=>{if(je.value)return;de(!0),(await hs({orderId:a.value.id})).success?(S.success(m("common. cancel success")),de(!1),$.go(-1),setTimeout(()=>{$.replace({path:"/buyerOrderList",query:{active:4,type:1}})},50),setTimeout(()=>{location.reload()},100)):de(!1)},me=async(s,o)=>{try{const{allowance:d}=Y(s);return+(await d(o)).result}catch{return 0}},Rt=async()=>{var s,o,d;try{const i=(s=a.value)==null?void 0:s.paySource,f=(o=a.value)==null?void 0:o.totalAmount,C=Math.max(((d=a.value)==null?void 0:d.voucherAmount)||0,ue.value);if(C&&i==j.WITHDRAW_POINTS&&await me(T.FMCP,T.order)<ue.value)return S({message:m("common.approve")+m("voucher.voucher"),forbidClick:!0,duration:2e3}),!1;if(i==1){if(De.value<f)return V(!0),!1;if(await me(T.MCOIN,T.order)<f)return S({message:m("common.approve")+"MCOIN",forbidClick:!0,duration:2e3}),!1}else if(i==5){if(Re.value<f*Le.value)return V(!0),!1;if(await me(T.USDT,T.order)<f*Le.value)return S({message:m("common.approve")+"USDT",forbidClick:!0,duration:2e3}),!1}else if(i==4){if(+q(Pe.value).times(.9)<+q(f).minus(C))return V(!0),!1}else if(i==2&&Ie.value<f)return V(!0),!1;return!0}catch{return!1}finally{E(!1),k(!1)}},Ee=async()=>{if(await Rt())try{if(!a.value.id||!a.value.allOrderId){S.fail(m("order.orderIdError")),k(!1);return}k(!0),await U();const o=await ys({allOrderId:a.value.allOrderId,orderId:a.value.id});if(!o.success){k(!1);return}const{allOrderId:d,merchants:i,discounts:f,amounts:C,sources:g}=o.data;if(a.value.allOrderId=d,!(await vs({allOrderId:a.value.allOrderId})).data){S.fail("有一笔交易正在进行中，请稍候再试"),k(!1);return}const N=await ft(d,i,f,C,g);if(!N.success){bs({allOrderId:d}),k(!1),await U();return}if(S.loading({message:m("order.wait block chain"),forbidClick:!0,duration:0}),await xs({allOrderId:d,hash:N.result.hash,orderId:a.value.id}),S.clear(),ut.value=N.result.hash,!N.result.hash){k(!1);return}let F;const P=async()=>{if(K.value>=5){k(!1),Ae(!0),K.value=0,await U();return}if(F=await Yt(N.result.hash),(F==null?void 0:F.status)===1){k(!1),ke(!0),K.value=0,setTimeout(()=>{$.go(-1),setTimeout(()=>{$.replace({path:"/buyerOrderList",query:{active:1,type:1}})},50),setTimeout(()=>{location.reload()},100)},1e3);return}setTimeout(async()=>{K.value++,P()},5e3)};P()}catch{k(!1),K.value=0}},Me=p(!1),[Pt,k]=O(!1),qe=async()=>{var o;k(!0),Me.value=!0;try{await U()}catch{k(!1);return}if(((o=a.value)==null?void 0:o.status)!==0){S.fail("已支付订单，无需重复支付"),k(!1);return}if(_e()){ne.value=!0,k(!1);return}await Ee()},fe=()=>{U()},It=async()=>{X(!0)},Bt=async s=>{E(!0);try{const d=(await xe({orderIds:s.id})).data.ordIds;if(!(await mt(d)).success)return;s.delayReceiveFlag=!0,s.confirmLimit=h.nowTime+T.datePeriod*10,X(!1),S.success(m("order.delaySuccess")),setTimeout(()=>{L.reload()},3e3)}finally{E(!1)}},Lt=async s=>{var o;E(!0);try{const i=(await xe({orderIds:s})).data.ordIds,f=await Be(i);if(!f.success||!(await et({ordIds:i,hash:f.result.hash})).success)return;a.value.status=4,$e.value.showToastPop(((o=f.result)==null?void 0:o.logs)||[])||(S.success(m("order.confirmSuccess")),$.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{A.params.refresh="1",$.push("/evaluate-my")},2e3))}finally{E(!1)}},Nt=async()=>{Ne.value>1?re(!0):Lt(b)},Ot=async s=>{const o=s.join();Te(!0);try{const i=(await xe({orderIds:o})).data.ordIds,f=await Be(i);if(!f.success||!(await et({ordIds:i,hash:f.result.hash})).success)return;a.value.status=4,re(!1),S.success(m("order.confirmSuccess")),$.replace({path:"/buyerOrderList",query:{active:3,type:1}}),setTimeout(()=>{A.params.refresh="1",$.push("/evaluate-my")},2e3)}finally{Te(!1)}},jt=()=>{var s,o;((s=A.params)==null?void 0:s.quick)==="quickPay"&&Ft(),((o=A.params)==null?void 0:o.quick)==="quickCancel"&&Et()},Ft=()=>{S.loading({message:m("order.continuePay"),forbidClick:!0,duration:2e3}),qe()},Et=()=>{Fe()},Mt=()=>{ee(!1),ne.value&&(ne.value=!1,Ee())},_e=()=>{var f,C;if(!((f=a.value)!=null&&f.id))return!1;const s="orderMerchantAdjustMap";let o={};try{o=JSON.parse(localStorage.getItem(s)||"{}")}catch{o={}}const d=o[a.value.id],i=(C=a.value)==null?void 0:C.merchantAdjustAmount;return i&&(d===void 0||d!==String(i))?(sessionStorage.setItem("refreshOrderID",a.value.id.toString()),Se.value="订单金额发生变动，请留意订单信息变化",ee(!0),o[a.value.id]=String(i),localStorage.setItem(s,JSON.stringify(o)),!0):!1};return ae(async()=>{var s,o,d,i;if(((s=A.params)==null?void 0:s.quick)==="quickPay"&&(S.loading({message:m("order.continuePay"),forbidClick:!0,duration:6e3}),k(!0)),pt(),await U(),await Tt(),await $t(),((o=a.value)==null?void 0:o.paySource)==j.WITHDRAW_POINTS){const f=await Y(T.FMCP).balanceOf();te.value=+f}((d=a.value)==null?void 0:d.status)===0&&!((i=A.params)!=null&&i.quick)&&_e(),jt()}),(s,o)=>{var d;return a.value?(u(),y("div",{key:0,class:"app-container font-Puhui main-bg safe-bottom-page",onScroll:nt},[t("section",{class:Wt(["header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md transition-all duration-300",{"bg-white":Ce.value}])},[t("div",ba,[I(ds)]),t("div",xa,[t("span",null,n(s.$t("order.orderDetail")),1)])],2),t("section",pa,[a.value.status===2?(u(),x(ua,{key:0,order:a.value,nowTime:e.nowTime,onTimeDone:fe},null,8,["order","nowTime"])):c("",!0),a.value.status===2?(u(),x(va,{key:1,order:a.value,nowTime:e.nowTime,onTimeDone:fe},null,8,["order","nowTime"])):c("",!0),a.value.status===0&&!a.value.hash?(u(),x(Is,{key:2,order:a.value,onTimeDone:fe},null,8,["order"])):c("",!0),a.value.userAddress?(u(),x(Cs,{key:3,order:a.value,showCopy:!1},null,8,["order"])):c("",!0),I(Zt,{order:a.value,"show-price":!1,"show-shipping-template":!0},null,8,["order"]),a.value.status===0?(u(),x(Qe,{key:4,order:a.value,isBuyer:""},null,8,["order"])):c("",!0),a.value.status===0&&!a.value.hash?(u(),x(Qt,{key:5,order:a.value,isBuyer:""},null,8,["order"])):c("",!0),a.value.status!==0||a.value.hash?(u(),x(Yo,{key:6,order:a.value},null,8,["order"])):c("",!0),a.value.status!==0?(u(),x(Qe,{key:7,order:a.value,isBuyer:""},null,8,["order"])):c("",!0),a.value.id&&a.value.status===0?(u(),x(Xt,{key:8,order:a.value},null,8,["order"])):c("",!0),a.value.status==0&&a.value.hash?c("",!0):(u(),x(sa,{key:9,voucherPrice:r(ue),order:a.value,btnLoading:r(W),cancelLoading:r(je),continuePayLoading:r(Pt),nowTime:e.nowTime,onHandleDelay:It,onHandleDelayReceipt:Nt,onHandleTo:At,onCancelOrder:Fe,onContinuePay:qe},null,8,["voucherPrice","order","btnLoading","cancelLoading","continuePayLoading","nowTime"]))]),I(ve,{show:r(H),title:s.$t("order.delayConfirm"),content:s.$t("order.delayTips"),showConfirm:!0,showReject:!0,confirmText:"确定",rejectText:"取消",noClose:"",onClose:o[0]||(o[0]=i=>r(X)(!1)),onReject:o[1]||(o[1]=i=>r(X)(!1)),onConfirm:o[2]||(o[2]=i=>Bt(a.value))},null,8,["show","title","content"]),I(es,{loading:r(rt),show:r(at),list:Oe.value,currentId:+r(b),onClose:o[3]||(o[3]=i=>r(re)(!1)),onReceipt:Ot},null,8,["loading","show","list","currentId"]),I(ts,{ref:(i,f)=>{f.voucherConfirmRef=i,$e.value=i},onReload:o[4]||(o[4]=i=>r(L).reload()),onHandleTo:o[5]||(o[5]=()=>{r($).push("/voucher?active=1")})},null,512),r(it)?(u(),x(Xe,{key:0,onClose:o[6]||(o[6]=i=>r(ke)(!1)),text:s.$t("common.pay success")},null,8,["text"])):c("",!0),r(lt)?(u(),x(Xe,{key:1,isError:!0,onClose:kt,text:s.$t("order.fail")},null,8,["text"])):c("",!0),I(us,{paySource:+((d=a.value)==null?void 0:d.paySource),show:r(ct),onClose:o[7]||(o[7]=i=>r(V)(!1))},null,8,["paySource","show"]),I(ve,{show:r(dt),title:s.$t("common.tip"),content:Se.value,showConfirm:!0,showReject:Me.value,confirmText:"确定",noClose:"",onClose:o[8]||(o[8]=i=>r(ee)(!1)),onConfirm:Mt,onReject:o[9]||(o[9]=i=>r(ee)(!1))},null,8,["show","title","content","showReject"]),I(ve,{show:r(St),title:s.$t("order.cancelOrder"),content:s.$t("order.cancelOrderTips"),showConfirm:!0,showReject:!0,confirmText:"确定",noClose:"",onClose:o[10]||(o[10]=i=>r(ce)(!1)),onConfirm:Dt,onReject:o[11]||(o[11]=i=>r(ce)(!1))},null,8,["show","title","content"])],32)):c("",!0)}}}),Va=Ut(wa,[["__scopeId","data-v-94024ff0"]]);export{Va as default};
