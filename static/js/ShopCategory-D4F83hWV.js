import{_ as Y,z as Z,x as W,a2 as V,y as ee,bl as se,r as C,D as A,E as te,G as r,H as a,I as l,U as g,P as m,Q as n,$ as f,F as k,O as c,Z as y,X as oe,Y as ae,J as le,K as ne,a4 as x,T as ce}from"./vendor-Dr_RpJ_Y.js";import{B as de}from"./BackIcon-CDrGaEPo.js";import{a as re,u as ie,w as ue}from"./index-BckdT6oc.js";import{b as pe,a as he,d as be,e as ge}from"./category-D2HQzb2Y.js";import{C as me}from"./ChangeRegion-DppjEEXa.js";import"./ChangeRegionPop-DleaIXjr.js";const fe=""+new URL("../images/delete-Czpqz061.svg",import.meta.url).href,E=v=>(oe("data-v-16243342"),v=v(),ae(),v),ye={class:"px-3 text-sm text-default bg-gray1"},xe={class:"gap-2 mt-2 flex-start"},ve={class:"mt-4 px-2 py-4 bg-white rounded-xl"},_e={class:"flex gap-1 opacity-60 text-center mb-[10px]"},we=E(()=>l("div",{class:"w-[10%]"},null,-1)),Ce={class:"w-[30%]"},ke={class:"w-[20%]"},Oe={class:"w-[25%]"},je=E(()=>l("div",{class:"w-[15%]"},null,-1)),Ve={class:"w-[10%] flex-center"},Ee={key:0,class:"w-[30%]"},Se={class:"text-black text-center whitespace-nowrap bg-[#EBEBEB] px-2 py-1 rounded-3xl"},Ie={class:"relative flex justify-center w-[20%]"},Be={key:1,class:"inline-flex border border-black border-solid rounded-[20px] h-[1.75rem] px-2 justify-center items-center w-10"},Te={key:2,class:"relative w-[25%]"},$e=["onClick"],De=E(()=>l("img",{src:fe,class:"w-4 h-4",alt:""},null,-1)),Le=["onClick"],Fe={key:0,class:"px-2 py-4 mt-4 bg-white rounded-xl flex-center-bw"},Ue={key:1},Ae=Z({setup(v){const{accountStore:_}=re(),{getCurrentStoreId:S}=ie(),{t:I}=W(),{loadingToggle:B}=ue(),[T,p]=V(!1),[$,b]=V(!1),[q,D]=V(!1),N=ee(()=>[{id:1,name:I("shop.goods")}]),e=se({active:0,goodsClass:[],goodsTypeClass:[],classObj:{id:null,name:null,sortOrder:0,type:1,isEdit:!0}}),h=C([]),R=C(null),O=C(!1),G=C(null),z=s=>{h.value=s?e.goodsTypeClass.map(o=>o.id):[]},H=s=>{const o=s.length;O.value=o===e.goodsTypeClass.length&&e.goodsTypeClass.length>0},J=async()=>{D(!0);const s=await pe(h.value);D(!1),s.success&&(h.value=[],p(!1),w())},w=async()=>{var s;B(!0);try{const o=await he({address:(s=await S())==null?void 0:s.merchant,type:N.value[e.active].id});e.goodsClass=(o.data||[]).map(i=>({...i,isEdit:!1})),console.log(e.classObj),!e.classObj.id&&(e.classObj.name||e.classObj.sortOrder)&&(p(!0),e.goodsClass.push(e.classObj))}finally{B(!1)}};A(()=>e.goodsClass,s=>{e.goodsTypeClass=s.filter(o=>o.type===e.active+1)},{deep:!0}),A(()=>e.active,s=>{e.goodsTypeClass=e.goodsClass.filter(o=>o.type===s+1)});const K=()=>{p(!0),L(),e.classObj.type=e.active+1,e.goodsClass.push(e.classObj)},L=()=>{e.classObj.id=null,e.classObj.name=null,e.classObj.sortOrder=null,e.classObj.type=1,e.classObj.isEdit=!0},M=s=>{T.value||(p(!0),e.classObj=s,s.isEdit=!0)},F=(s,o)=>{const i=s.target.value.replace(/[^\d]/g,"");e.goodsTypeClass[o].sortOrder=i},P=async()=>{var o;if(!e.classObj.name)return ce(I("shop.emptySubClass"));b(!0);const s=await be({...e.classObj,shopId:(o=await S())==null?void 0:o.id});b(!1),s.success&&(p(!1),L(),w())},Q=async(s,o)=>{if(b(!0),!s.id){e.goodsClass.splice(o,1),p(!1),b(!1);return}const i=await ge(s.id);b(!1),!e.classObj.id&&(e.classObj.name||e.classObj.sortOrder)||p(!1),i.success&&w()};return te(async()=>{w()}),(s,o)=>{const i=k("van-checkbox"),U=k("VanField"),X=k("van-checkbox-group"),j=k("VanButton");return a(),r("div",ye,[l("div",xe,[m(de),l("div",null,n(s.$t("profile.category")),1),m(me,{showIcon:!0,showDownIcon:!1,class:"ml-auto bg-gray1 px-2 rounded-[20px] border-2 border-solid border-white",style:{"box-shadow":"0px 0px 15px 0px rgba(51, 47, 42, 0.3) inset"}})]),l("div",ve,[l("div",_e,[we,l("div",Ce,n(s.$t("shop.categoryName")),1),l("div",ke,n(s.$t("shop.position")),1),l("div",Oe,n(s.$t("shop.operation")),1),je]),m(X,{modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=t=>h.value=t),ref:(t,u)=>{u.checkboxGroup=t,R.value=t},onChange:H},{default:f(()=>[(a(!0),r(le,null,ne(c(e).goodsTypeClass,(t,u)=>(a(),r("div",{class:"w-full py-[10px] bg-[#F9F9F9] rounded flex gap-1 mb-2.5 px-1 text-center",key:u},[l("div",Ve,[t.isEdit?g("",!0):(a(),y(i,{key:0,name:t.id,class:""},null,8,["name"]))]),t.isEdit?(a(),y(U,{key:1,class:"w-[30%] text-black whitespace-nowrap text-center items-center justify-center h-[1.75rem] px-[5px] mx-auto border border-black border-solid rounded-[20px]",modelValue:t.name,"onUpdate:modelValue":d=>t.name=d,placeholder:s.$t("shop.emptySubClass"),maxlength:"5"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(a(),r("div",Ee,[l("div",Se,n(t.name),1)])),l("div",Ie,[t.isEdit?(a(),y(U,{key:0,modelValue:t.sortOrder,"onUpdate:modelValue":d=>t.sortOrder=d,"input-align":"center",class:"absolute text-center items-center justify-center h-[1.75rem] border border-black border-solid rounded-[20px]",onInput:d=>F(d,u),onBlur:d=>F(d,u)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])):(a(),r("div",Be,n(t.sortOrder),1))]),c(_).isOnlyView?g("",!0):(a(),r("div",Te,[l("div",{class:"absolute right-0 inline-flex items-center justify-center h-[1.75rem] px-3 mx-auto border border-black border-solid rounded-[20px]",onClick:d=>Q(t,u)},[De,x(" "+n(s.$t("shop.delete")),1)],8,$e)])),!t.isEdit&&!c(_).isOnlyView?(a(),r("div",{key:3,class:"w-[15%] inline-flex items-center justify-center text-primary",onClick:d=>M(t)},n(s.$t("shop.edit")),9,Le)):g("",!0)]))),128))]),_:1},8,["modelValue"])]),c(e).goodsTypeClass.length>0&&!c(_).isOnlyView?(a(),r("div",Fe,[m(i,{modelValue:O.value,"onUpdate:modelValue":o[1]||(o[1]=t=>O.value=t),onChange:z,ref:(t,u)=>{u.checkAll=t,G.value=t}},{default:f(()=>[x(n(s.$t("common.check all")),1)]),_:1},8,["modelValue"]),m(j,{round:"",hairline:"",class:"btn text-[#EF1D10] py-3 px-[35px]",disabled:h.value.length===0,onClick:J,loading:c(q)},{default:f(()=>[x(n(s.$t("common.batch delete")),1)]),_:1},8,["disabled","loading"])])):g("",!0),c(_).isOnlyView?g("",!0):(a(),r("div",Ue,[c(T)?(a(),y(j,{key:1,class:"btn-orange w-[180px] h-10 flex-center text-white font-semibold fixed x-center bottom-9",loading:c($),onClick:P},{default:f(()=>[x(n(s.$t("common.finish")),1)]),_:1},8,["loading"])):(a(),y(j,{key:0,class:"btn-orange w-[180px] h-10 flex-center text-white font-semibold fixed x-center bottom-9",loading:c($),onClick:K},{default:f(()=>[x(n(s.$t("shop.addClass")),1)]),_:1},8,["loading"]))]))])}}}),Je=Y(Ae,[["__scopeId","data-v-16243342"]]);export{Je as default};
