var F=Object.defineProperty;var H=(a,t,c)=>t in a?F(a,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[t]=c;var w=(a,t,c)=>H(a,typeof t!="symbol"?t+"":t,c);import{bm as N,bU as R,n as U,_ as K,z as E,x as O,q as V,r as n,E as M,F as A,G as p,H as u,I as s,Q as C,bj as J,U as P,bt as Q,bv as W,J as L,K as B,N as X,Z as k,$ as Y,X as Z,Y as ee}from"./vendor-Dr_RpJ_Y.js";import{_ as oe}from"./search-C4fLtTfY.js";import{_ as se}from"./delete-BlDblrKv.js";import{H as te}from"./HomeGoodsItem-DE5ButzL.js";import{B as le,aU as ae,bz as re}from"./index-LRhcxFAI.js";import"./MCOIN-Bodfn-v1.js";import"./store-odfdGeH-.js";import"./useCityMap-B_oYsQIQ.js";import"./RatioBox-n6itzF1h.js";import"./ImgBoutiqueLable-B-2xCcw4.js";import"./shop-CeqcS6K2.js";class ne{constructor(t,c){w(this,"scrollTop");w(this,"selector");w(this,"key");this.scrollTop=0,this.selector=t,this.key=c,N(()=>{if(sessionStorage.getItem(this.key)=="1"){sessionStorage.removeItem(this.key),this.clearScrollTop();return}U(()=>{const i=document.querySelector(this.selector);i&&(i.scrollTop=this.scrollTop)})}),R(()=>{const r=document.querySelector(this.selector);this.scrollTop=r?r.scrollTop:0})}clearScrollTop(){this.scrollTop=0}getScrollTop(){return this.scrollTop}setScrollTop(t){this.scrollTop=t}}const x=a=>(Z("data-v-d4265c86"),a=a(),ee(),a),ce={class:"app-container"},ie={class:"header__wrap w-full h-[50px]"},de={class:"header__title h-full"},ue={class:"h-full flex items-center justify-center"},_e={class:"text-b1 text-base font-bold"},me={class:"search__wrap w-full h-[48px] px-3 pb-3"},fe={class:"search__input w-full h-full bg-white rounded-3xl flex items-center justify-center px-3 py-2.5"},he=x(()=>s("div",{class:"search__icon flex-shrink-0"},[s("img",{src:oe,class:"w-4 h-4"})],-1)),pe=["placeholder","onKeyup"],ge=x(()=>s("img",{src:se,class:"w-4 h-4",alt:""},null,-1)),ve=[ge],ye={class:"text-[#FF8812] text-sm font-semibold whitespace-nowrap"},we={class:"list__wrap safe-bottom"},xe=x(()=>s("div",{class:"category__shadow fixed left-0 bottom-0 w-[80px] h-14 safe-bottom sm:bottom-[0%] lg:bottom-[0%] z-[10] box-content"},null,-1)),be={class:"category__wrap overflow-y-scroll"},Ce=["onClick"],ke={class:"text-sm category-name"},Se=x(()=>s("div",{class:"bg-[#f5f5f5] h-[88px]"},null,-1)),Ie={class:"goods__wrap overflow-y-scroll"},Te=E({name:"OfflineHome"});function Le(a){const{t}=O(),c=V(),r=n(""),i=n("-1"),m=n(!1),h=n(0),$=n(20),f=n(!1),_=n([]),g=n([]),G=o=>{i.value=o,I()},j=async()=>{try{const{success:o,data:d}=await re();if(!o)return;let e=(d||[]).filter(l=>+l.goodsCount>0);e=e.map(l=>({...l,goodsCategoryName:l.goodsCategoryName.slice(0,4)})),e.unshift({goodsCategoryId:"-1",goodsCategoryName:t("common.recommend")}),g.value=e}catch(o){console.error("获取类目数据失败:",o),g.value=[]}},z=()=>{r.value="",b()},S=n(null),b=()=>{m.value||(h.value=0,f.value=!1,_.value=[],v(),S.value.blur())},I=()=>{h.value=0,f.value=!1,_.value=[],v()},v=async()=>{m.value=!0,h.value+=1,f.value=!1,await q(),m.value=!1},q=async()=>{let o={};i.value==="-1"?o={sortBy:"desc|goods_sales_volume,asc|goods_id",goodsCategoryId1:null}:o={sortBy:null,goodsCategoryId1:i.value||null};const d={page:h.value,size:$.value,goodsStatus:1,goodsNameLike:r.value,...o,deleteFlag:!1},{success:y,data:e}=await ae(d);if(!y||!e||!e.total){f.value=!0;return}const l=e.records||[];_.value=h.value===1?l:[..._.value,...l],_.value.length>=e.total&&(f.value=!0)},D=o=>{c.push({path:"/offlineGoodsDetail",query:{goodsId:o.goodsId}})};return M(()=>{new ne(".goods__wrap","offline_home_scroll"),v()}),N(()=>{sessionStorage.getItem("reset_offline_home_scroll")=="1"&&(sessionStorage.removeItem("reset_offline_home_scroll"),I()),j()}),(o,d)=>{const y=A("van-list");return u(),p("div",ce,[s("div",ie,[s("div",de,[s("div",ue,[s("div",_e,C(o.$t("offline.main title")),1)])])]),s("div",me,[s("div",fe,[he,J(s("input",{ref:(e,l)=>{l.searchRef=e,S.value=e},type:"text","onUpdate:modelValue":d[0]||(d[0]=e=>r.value=e),class:"w-full h-full bg-transparent ml-1 font-normal",placeholder:o.$t("mall.Enter search keywords"),onKeyup:W(b,["enter"]),enterkeyhint:"search"},null,40,pe),[[Q,r.value]]),r.value?(u(),p("div",{key:0,class:"flex-shrink-0 flex items-center justify-center",onClick:z},ve)):P("",!0),s("div",{class:"search__btn ml-2 flex-shrink-0",onClick:b},[s("span",ye,C(o.$t("common.search")),1)])])]),s("div",we,[xe,s("div",be,[(u(!0),p(L,null,B(g.value,(e,l)=>{var T;return u(),p("div",{key:e.goodsCategoryId,class:X(["category__item h-[44px] min-h-[44px] w-full flex items-center justify-center font-normal text-b2",{"bg-white !text-b1 font-semibold selected-category":i.value===e.goodsCategoryId,"selected-category-prev":i.value===((T=g.value[l+1])==null?void 0:T.goodsCategoryId)}]),onClick:Ne=>G(e.goodsCategoryId)},[s("span",ke,C(e.goodsCategoryName||"/"),1)],10,Ce)}),128)),Se]),s("div",Ie,[_.value.length===0&&!m.value?(u(),k(le,{key:0,name:o.$t("common.search_result_null")},null,8,["name"])):(u(),k(y,{key:1,loading:m.value,"onUpdate:loading":d[1]||(d[1]=e=>m.value=e),finished:f.value,"finished-text":o.$t("common.no more"),onLoad:v},{default:Y(()=>[(u(!0),p(L,null,B(_.value,e=>(u(),k(te,{key:e.goodsId,goods:e,class:"mb-4 :last:mb-0",onClick:l=>D(e),"show-store-name":""},null,8,["goods","onClick"]))),128))]),_:1},8,["loading","finished","finished-text"]))])])])}}const Be=Object.assign(Te,{setup:Le}),Oe=K(Be,[["__scopeId","data-v-d4265c86"]]);export{Oe as default};
