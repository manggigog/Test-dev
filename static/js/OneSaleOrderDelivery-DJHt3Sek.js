import{y as C,E as $,F as h,G as n,O as f,H as e,Q as o,P as d,_ as B,l as T,bc as P,bd as G,a2 as D,K as V,N as H,a0 as M,a1 as F,r as R,D as U}from"./vendor-CjApaIpB.js";import{_ as A}from"./mcoin-logo-1-BPG653EL.js";import{a as L}from"./useOrderStatus-DMn11Py2.js";import{l as O,R as S,aL as j,e as E,aG as q}from"./index-DBW_ANsl.js";import{l as K}from"./luckyShopContract-4MaHABcp.js";import{B as Q}from"./BackIcon-D2Vm_lyR.js";const z={class:"gap-2 mt-3 flex-center-bw"},J={class:"flex flex-col justify-between flex-1 h-20"},W={class:"font-semibold flex-center-bw"},X=e("div",{class:"flex items-baseline gap-1 text-primary"},[e("img",{src:A,class:"w-3 h-3",alt:""}),e("span",null,"0"),e("span",{class:"text-xs"},"Mcoin")],-1),Y={class:"font-semibold text-primary flex-center-bw"},Z=e("div",{class:"opacity-60 text-default"},"x1",-1),ee={class:"flex justify-end opacity-60"},se=C({props:{order:null},setup(r){const{order:c}=r,v=L();return(l,x)=>{const p=$("VanImage");return n(),h("div",z,[f(p,{src:r.order.goodsMainImageUrls.split(",")[0],class:"w-20 h-20 overflow-hidden rounded-xl",fit:"cover",alt:""},null,8,["src"]),e("div",J,[e("div",null,[e("div",W,[e("div",null,o(r.order.goodsTitle),1),X]),e("div",Y,[e("div",null,o(d(v)[r.order.commitStatus+""]),1),Z])]),e("div",ee,o(l.$t("order.deliveryTime"))+" "+o(r.order.shippingTime&&d(O)(r.order.shippingTime)||"-"),1)])])}}}),te={class:"px-3 py-4 mt-3 bg-white rounded-xl"},oe={class:"flex-center-bw"},ae={class:"opacity-60"},re={class:"mt-3 flex-center-bw"},ie={class:"opacity-60"},de={key:1,class:"text-right"},ne={class:"mt-3 flex-center-bw"},le={class:"opacity-60"},ce={key:1,class:"text-right"},pe={key:0,class:"mt-5 flex-center"},me=C({props:{order:null},setup(r){const c=r,{getMerchantDhKey:v,encryptKey:l}=S(),x=T(),{merchantComfirmSent:p}=K(),[w,_]=P(!1),s=G({expressCompany:"",expressNo:"",id:c.order.id}),g=async()=>{var m;const a=await v((m=c.order)==null?void 0:m.address);let t={expressCompany:s.expressCompany,expressNo:s.expressNo,id:s.id,shippingHash:null};if(a){const i=l(s.expressNo,a);t.expressNo=i.encrypt,t.shippingHash=i.hash;const b=l(s.expressCompany,a);t.expressCompany=b.encrypt}_(!0),(await j(t)).success&&(await p(c.order.odGoodsId)).success&&x.back(),_(!1)};return(a,t)=>{const y=$("VanField"),m=$("VanButton");return n(),h("div",null,[e("div",te,[e("div",oe,[e("div",ae,o(a.$t("order.deliveryType")),1),e("div",null,o(a.$t("order.deliveryMyself")),1)]),e("div",re,[e("div",ie,o(a.$t("order.deliveryId")),1),r.order.commitStatus===30?(n(),V(y,{key:0,class:"flex-1","input-align":"right",modelValue:d(s).expressNo,"onUpdate:modelValue":t[0]||(t[0]=i=>d(s).expressNo=i),placeholder:a.$t("shop.pleaseInput")},null,8,["modelValue","placeholder"])):(n(),h("div",de,o(r.order.expressNo),1))]),e("div",ne,[e("div",le,o(a.$t("order.deliveryCompany")),1),r.order.commitStatus===30?(n(),V(y,{key:0,class:"flex-1","input-align":"right",modelValue:d(s).expressCompany,"onUpdate:modelValue":t[1]||(t[1]=i=>d(s).expressCompany=i),placeholder:a.$t("shop.pleaseInput")},null,8,["modelValue","placeholder"])):(n(),h("div",ce,o(r.order.expressCompany),1))])]),r.order.commitStatus===30?(n(),h("div",pe,[f(m,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",loading:d(w),disabled:!d(s).expressNo||!d(s).expressCompany,onClick:g},{default:H(()=>[M(o(a.$t("order.Ship")),1)]),_:1},8,["loading","disabled"])])):D("",!0)])}}}),ue=B(me,[["__scopeId","data-v-3f7112b0"]]),he={key:0,class:"px-3 bg-[#f2f0ef]"},ve={class:"gap-2 mt-2 flex-start"},ye={class:"px-3 py-4 mt-3 bg-white rounded-xl"},fe={class:"flex-center-bw"},xe={class:"opacity-60"},_e={class:"font-semibold"},be={class:"break-all"},ge={class:"mt-4 text-base font-semibold text-black"},$e={class:"mt-1 opacity-60"},De=C({setup(r){const{commodities:c}=K(),{orderGoodsStore:v}=E(),{getMerchantDhKey:l,decryptAddressKey:x,decryptKey:p}=S(),_=F().query.id,s=R(null),g=async()=>{var i,b,N,k;const a=v.orderGood.id||_,t=await q({id:a}),y=["receiverCity","receiverCounty","receiverDetailInfo","receiverProvince","receiverPhone","receiver","postscript"];if((i=t.data)!=null&&i.submitHash){const u=await l((b=t.data)==null?void 0:b.address,(N=t.data)==null?void 0:N.submitUserPubKey);u&&(t.data=x(t.data,u,y))}if(t.data.shippingHash){const u=await l(t.data.address,(k=t.data)==null?void 0:k.shippingUserPubKey);if(u){const I=p(t.data.expressNo,u);I.hash===t.data.shippingHash&&(t.data.expressNo=I.decrypt,t.data.expressCompany=p(t.data.expressCompany,u).decrypt)}}s.value=t.data;const m=await c(s.value.odGoodsId);s.value.commitStatus=m.status};return U(async()=>{g()}),(a,t)=>s.value?(n(),h("div",he,[e("div",ve,[f(Q),e("div",null,o(a.$t("order.deliver")),1)]),e("div",ye,[e("div",fe,[e("div",xe,o(a.$t("order.orderNumber")),1),e("div",_e,o(s.value.id),1)]),f(se,{order:s.value},null,8,["order"]),e("div",be,[e("div",ge,o(s.value.receiverProvince??"")+o(s.value.receiverCity)+" "+o(s.value.receiverCounty)+o(s.value.receiverDetailInfo),1),e("div",$e,o(s.value.receiver)+o(s.value.receiverPhone),1)])]),f(ue,{order:s.value},null,8,["order"])])):D("",!0)}});export{De as default};
