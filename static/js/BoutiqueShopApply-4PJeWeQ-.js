import{_ as oo}from"./mall-BNNzTN-n.js";import{_ as so}from"./upload-B7OBZe8E.js";import{_ as P,y as z,E as R,K as N,G as g,N as I,H as s,a3 as to,O as k,F as $,Q as i,a0 as T,Y as O,Z as M,w as H,l as eo,r as b,z as J,I as ao,J as no,a2 as G,a4 as j,T as q,bd as io,bh as lo,D as co,P as _}from"./vendor-CjApaIpB.js";import{_ as K}from"./MCOIN-BcbOHmhy.js";import{q as ro}from"./mall-CSm_yT_y.js";import{u as Q,N as Y,e as uo,a2 as po,q as mo,S as go}from"./index-B3VH42pz.js";import{B as fo}from"./BackIcon-D2Vm_lyR.js";import{u as ho}from"./upload-BLqJoIae.js";const Z=e=>(O("data-v-0578eb03"),e=e(),M(),e),vo={class:"flex gap-2 py-3 relative"},_o={class:"flex flex-col flex-1 h-[65px] justify-between"},bo={class:"flex items-start justify-between"},xo={class:"line-clamp-2"},yo={key:0,class:"flex items-center"},Io={class:"flex items-baseline"},$o={class:"mr-1"},wo={class:"text-[#999] text-xs font-normal"},ko={class:"text-[#FEA021]"},Ro={key:1,class:"flex-center-bw f-wrap flex-1"},So={class:"flex-center"},Vo=Z(()=>s("img",{src:K,class:"w-4 h-4 mr-1.5"},null,-1)),Do={class:"flex items-baseline"},Co={class:"mr-1"},Lo={class:"flex items-baseline"},Bo={class:"flex-start mr-1"},Fo={class:"text-[#999] text-xs font-normal flex-shrink-0"},qo={class:"text-[#FEA021]"},Eo={key:2,class:"flex items-center"},Ao=Z(()=>s("img",{src:K,class:"w-4 h-4 mr-1.5"},null,-1)),No={class:"flex items-baseline"},To={class:"mr-1"},Uo=z({props:{goods:null,card:null,chooseDisabled:{type:Boolean}},setup(e){const{goods:E,card:w}=e;return(x,d)=>{const S=R("VanImage"),l=R("van-checkbox");return g(),N(l,{name:e.goods.id,class:""},{default:I(()=>{var c;return[s("div",vo,[k(S,{src:e.goods.icons&&e.goods.icons.split(",")[0],class:"w-[60px] h-[60px] rounded-md overflow-hidden",alt:"",fit:"cover"},null,8,["src"]),s("div",_o,[s("div",bo,[s("div",xo,i(e.goods.goodsName),1)]),e.goods.payType===2?(g(),$("div",yo,[s("div",Io,[s("div",$o,[s("span",wo,i(x.$t("piggy.cardPrice")),1),s("span",ko,i(e.goods.cardPrice),1),T(i(e.card.symbol),1)])])])):e.goods.payType===3?(g(),$("div",Ro,[s("div",So,[Vo,s("div",Do,[s("div",Co,i(e.goods.price)+"Mcoin",1)])]),s("div",Lo,[s("div",Bo,[s("div",Fo,i(x.$t("piggy.cardPrice")),1),s("div",qo,i(e.goods.cardPrice),1),T(" "+i(((c=e.card)==null?void 0:c.symbol)||""),1)])])])):(g(),$("div",Eo,[Ao,s("div",No,[s("div",To,i(e.goods.price)+"Mcoin",1)])]))])]),to(x.$slots,"default",{},void 0,!0)]}),_:3},8,["name"])}}}),jo=P(Uo,[["__scopeId","data-v-0578eb03"]]),W=e=>(O("data-v-026710e9"),e=e(),M(),e),Go={key:0},Po={key:0,class:"w-full py-2 rounded-lg bg-[#f5f5f5] mb-2"},zo={class:"font-normal text-default"},Oo=W(()=>s("span",{class:"text-[#000]"},"%",-1)),Mo={class:"font-normal text-default"},Jo=W(()=>s("span",{class:"text-[#000]"},"%",-1)),Ho={key:1,class:"min-h-[200px] text-center py-4 flex items-end justify-center"},Ko=z({props:{shopStatus:null,goodInfos:null},setup(e,{expose:E}){const w=e,{t:x}=H(),d=eo(),S=b(null),l=b([]),c=b([]),V=b(!1),C=b(!1),L=b(0),U=b(10),A=b(0),{getCurrentStoreId:a}=Q();J(()=>l.value,o=>{if(o.length>3)return l.value=l.value.slice(0,3),q(x("common.choose tips"));c.value.forEach(t=>{o.includes(t.goods.id)?t.checked=!0:t.checked=!1})},{deep:!0,immediate:!0}),J(()=>w.goodInfos,()=>{c.value.forEach(o=>{w.goodInfos.map(t=>(o.goods.id===t.goodsId&&(o.goods.balanceDiscountRatio=t.balanceDiscountRatio,o.goods.balanceDiscountRatio=t.balanceDiscountRatio),t))})},{deep:!0,immediate:!0});const r=async()=>{V.value=!0,L.value+=1,await p(),V.value=!1},f=o=>{w.shopStatus===1&&d.push(o)},y=o=>o>30?"30":o||"",B=o=>o>36?"36":o||"",D=o=>{var u,h;const t=Number(o.goods.discountRatio)>9?6:11;+((u=o.goods)==null?void 0:u.discountRatio)>0?o.goods.balanceDiscountRatio=+((h=o.goods)==null?void 0:h.discountRatio)+t:o.goods.balanceDiscountRatio=null},p=async()=>{var u;const o=await ro({merchant:(u=await a())==null?void 0:u.merchant,status:1,type:1,page:L.value,size:U.value,deliveryType:1});if(V.value=!1,!o.success){C.value=!0;return}if(!o.data||!o.total){C.value=!0,c.value=L.value===1?[]:c.value;return}A.value=o.total;const t=b([]);t.value=o.data.map(h=>({btnLoading:!1,...h})),c.value=L.value===1?t.value:c.value.concat(t.value),c.value.length>=A.value&&(C.value=!0)};return E({goodsChecked:l,list:c}),(o,t)=>{const u=R("van-field"),h=R("van-checkbox-group"),v=R("VanList");return g(),N(v,{class:"px-3 min-h-[200px] mb-[70px]",loading:V.value,"onUpdate:loading":t[5]||(t[5]=n=>V.value=n),finished:C.value,"loading-text":o.$t("common.loading"),onLoad:r},{default:I(()=>[k(h,{modelValue:l.value,"onUpdate:modelValue":t[3]||(t[3]=n=>l.value=n),ref:(n,F)=>{F.checkboxGroup=n,S.value=n},max:4,"checked-color":"#FEA021",onClick:t[4]||(t[4]=j(()=>{},["stop"]))},{default:I(()=>[c.value.length>0?(g(),$("div",Go,[(g(!0),$(ao,null,no(c.value,(n,F)=>(g(),N(jo,{key:n.goods.id,index:F,goods:n.goods,card:n.card,class:"relative w-full pl-5"},{default:I(()=>[n.checked?(g(),$("div",Po,[k(u,{onClick:t[0]||(t[0]=j(()=>{},["stop"])),"input-align":"right",type:"digit",autocomplete:"off",disabled:"",formatter:y,modelValue:n.goods.discountRatio,"onUpdate:modelValue":[m=>n.goods.discountRatio=m,m=>D(n)],placeholder:`${o.$t("shop.pleaseInput")}4-30`},{label:I(()=>[s("div",zo,i(`${o.$t("goods.discountRatio")} `),1)]),"right-icon":I(()=>[Oo]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),k(u,{onClick:t[1]||(t[1]=j(()=>{},["stop"])),"input-align":"right",type:"digit",autocomplete:"off",modelValue:n.goods.balanceDiscountRatio,"onUpdate:modelValue":m=>n.goods.balanceDiscountRatio=m,formatter:B,disabled:"",placeholder:`${o.$t("shop.pleaseInput")}10-36`},{label:I(()=>[s("div",Mo,i(`*${o.$t("goods.goods balance discount placeholder")} `),1)]),"right-icon":I(()=>[Jo]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])):G("",!0)]),_:2},1032,["index","goods","card"]))),128))])):(g(),$("div",Ho,[s("div",{onClick:t[2]||(t[2]=n=>f("/shopGoods/editgoods")),class:"opacity-60 text-sm font-normal mb-2.5"},i(o.$t("common.goods no data")),1)]))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished","loading-text"])}}}),Qo=P(Ko,[["__scopeId","data-v-026710e9"]]),Yo=e=>Y("GET","/boutiqueShopApply/last",e),Zo=e=>Y("POST","/boutiqueShopApply/sub",e),X=e=>(O("data-v-7d9da84f"),e=e(),M(),e),Wo={class:"bg-[#FEECE9] px-1.5"},Xo={class:"flex-start px-1 py-2.5"},os={key:0,class:"flex-start py-2 px-2.5 border-[2px] border-[#FB1A18] border-solid rounded-xl mb-2.5"},ss={class:"text-[#FB1A18] font-sm"},ts={class:"bg-white rounded-lg p-3.5 mb-2.5"},es={class:"mb-5 flex-start"},as=X(()=>s("img",{src:oo,class:"w-[18px] mr-1"},null,-1)),ns={class:"font-normal mb-2.5"},ds={class:"w-full"},is=X(()=>s("img",{src:so,class:"w-[40px] h-[40px] m-auto object-cover"},null,-1)),ls={class:"opacity-60"},cs={class:"bg-white rounded-lg"},rs={class:"p-2.5"},us={class:"absolute bottom-0 left-0 right-0 bg-[#FEECE9] px-2.5 py-4 mx-auto text-center z-10"},ps=z({setup(e){const{accountStore:E}=uo(),{getCurrentStoreId:w}=Q(),{t:x}=H(),d=io({shopInfo:{status:-1},formData:{},imgList:[],goodInfos:[]}),S=b(!1),l=b(null),c=b(!1),V=async()=>{var r;const a=await go((r=await w())==null?void 0:r.merchant);a.success&&a.data&&(d.shopInfo=a.data)},C=async a=>{const r=await po(a,"shopScenery"),f=await ho(r);if(!f.success)return d.imgList.length-=1;d.imgList[d.imgList.length-1]={url:mo.imgUrl+f.data}},L=async()=>{var f,y,B,D;if(E.isOnlyView)return q(x("order.Requires merchant account operation"));let a=[];if(S.value=!1,(y=(f=l.value)==null?void 0:f.goodsChecked)==null||y.map(p=>{var t,u,h,v,n,F;const o=(u=(t=l.value)==null?void 0:t.list)==null?void 0:u.findIndex(m=>m.goods.id===p);if(o>-1){const m=(h=l.value)==null?void 0:h.list[o];if(!((v=m.goods)!=null&&v.discountRatio)||((n=m.goods)==null?void 0:n.discountRatio)<4||((F=m.goods)==null?void 0:F.discountRatio)>30){q(x("shop.emptyRadio")+"4-30"),S.value=!0;return}(+m.goods.discountRatio<4?4:+m.goods.discountRatio)+6,a.push(m)}return p}),S.value)return;c.value=!0;const r=await Zo({shopId:(B=await w())==null?void 0:B.id,masterImg:d.imgList.map(p=>p.url).join(","),goodIds:(D=l.value)==null?void 0:D.goodsChecked.join(","),goodInfos:JSON.stringify(a.map(p=>({goodsId:p.goods.id,balanceDiscountRatio:p.goods.balanceDiscountRatio,discountRatio:p.goods.discountRatio})))});setTimeout(()=>{c.value=!1},1e3),r.success&&(q(x("common.submit success wait review")),A())},U=async()=>{var r,f;const a=await Yo({shopId:(r=await w())==null?void 0:r.id});a.success&&(d.formData=a.data||{},d.imgList=(f=a.data)!=null&&f.masterImg?a.data.masterImg.split(",").map(y=>({url:y})):[],d.formData.status<3?l.value.goodsChecked=a.data.goodIds?a.data.goodIds.split(",").map(y=>+y):[]:l.value.goodsChecked=[])},A=async()=>{await V(),d.shopInfo.status===1?U():q({message:x("shop.noShop"),duration:0})};return lo(()=>{q.clear()}),co(async()=>{A()}),(a,r)=>{var D,p,o,t,u,h;const f=R("van-icon"),y=R("van-uploader"),B=R("VanButton");return g(),$("div",Wo,[s("div",Xo,[k(fo),s("div",null,i(a.$t("profile.Featured Display")),1)]),((D=_(d).formData)==null?void 0:D.status)===3&&((p=_(d).formData)!=null&&p.reasonRejection)?(g(),$("div",os,[k(f,{name:"warning",color:"#FB1A18",size:"20",class:"mr-1.5"}),s("div",ss,i(((o=_(d).formData)==null?void 0:o.reasonRejection)||"-"),1)])):G("",!0),s("div",ts,[s("div",es,[as,T(" "+i(((t=_(d).shopInfo)==null?void 0:t.storeName)||"-"),1)]),s("div",ns,i(a.$t("shop.up boutique img")),1),k(y,{class:"w-[150px] h-[150px] bg-[#F4F6F8] rounded-lg flex-center",modelValue:_(d).imgList,"onUpdate:modelValue":r[0]||(r[0]=v=>_(d).imgList=v),accept:"image/*","preview-size":[150,150],"max-count":1,afterRead:C},{default:I(()=>[s("div",ds,[is,s("div",ls,i(a.$t("shop.img")),1)])]),_:1},8,["modelValue"])]),s("div",cs,[s("div",rs,i(a.$t("shop.choose boutique goods"))+i(a.$t("shop.limit three")),1),k(Qo,{ref:(v,n)=>{n.goodsContainer=v,l.value=v},shopStatus:_(d).shopInfo.status,goodInfos:_(d).goodInfos},null,8,["shopStatus","goodInfos"])]),s("div",us,[_(E).isOnlyView?G("",!0):(g(),N(B,{key:0,loading:c.value,disabled:((u=l.value)==null?void 0:u.goodsChecked.length)<=0||_(d).imgList.length<=0||((h=l.value)==null?void 0:h.goodsChecked.length)>3,class:"w-[160px] h-[40px] btn-orange text-white",onClick:L},{default:I(()=>{var v,n;return[T(i(((v=_(d).formData)==null?void 0:v.status)<=2?a.$t("common.edit"):((n=_(d).formData)==null?void 0:n.status)>2?a.$t("common.Resubmit"):a.$t("common.submit")),1)]}),_:1},8,["loading","disabled"]))])])}}}),ys=P(ps,[["__scopeId","data-v-7d9da84f"]]);export{ys as default};
