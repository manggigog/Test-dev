import{_ as Te,y as He,w as Oe,l as Ue,r as y,a1 as Fe,bc as Re,bd as je,D as qe,E as x,F as Ae,a2 as Ze,G as we,H as o,O as i,Q as v,N as C,P as m,I as ze,J as Ge,a0 as Je,Y as Qe,Z as We,T as N}from"./vendor-CjApaIpB.js";import{a as Ye,v as Xe,B as es}from"./order-DMAXIMUy.js";import{B as ss}from"./BackIcon-D2Vm_lyR.js";import{R as as}from"./index-DBW_ANsl.js";const ts="/Test-dev/static/images/arrow-down-585654-BFZgiOT1.svg",Ie=f=>(Qe("data-v-caacff9c"),f=f(),We(),f),os={key:0,class:"font-Puhui main-bg safe-bottom-page"},rs={class:"header-bar fixed top-0 left-0 right-0 flex font-normal justify-center text-sm items-center h-[50px] px-4 z-50 backdrop-blur-md"},ds={class:"absolute left-4 flex items-center gap-1 -translate-y-1/2 top-1/2"},ns={class:"font-bold text-base text-b1"},ls={class:"safe-bottom pt-[50px] rounded-xl px-3"},is={class:"rounded-xl bg-white overflow-hidden px-3"},ps=Ie(()=>o("img",{src:ts,class:"w-4 h-4 m-[2px]",alt:""},null,-1)),cs=Ie(()=>o("div",{class:"h-px bg-[#e5e5e5]"},null,-1)),us={class:"flex justify-center items-center relative h-14 font-bold text-[22px] text-[#3a2e13]"},ms={class:"flex-1 text-center text-base font-semibold text-b1"},fs={class:"pl-4 pr-4 pb-4 h-[calc(100%-56px)] overflow-y-scroll"},hs=["onClick"],ys={class:"text-b1"},xs={class:"popup-footer w-full fixed bottom-0 left-0 right-0 safe-bottom px-3"},vs=He({name:"SellerDelivery"});function bs(f){const{t:A}=Oe(),w=Ue(),{getMerchantDhKey:b,decryptAddressKey:ke,decryptKey:I,cryptoAESWithSearch:De,encryptKey:k}=as();y(!1);const D=Fe(),Ee=D.query.id,Ve=D.query.detail,h=y(null),E=y(!1),Le=async()=>{var d,l,t,g,_,V,L,B,S,K,$,M,P,T,H,O,U,F,R,j,q,Z,z,G,J,Q,W,Y,X,ee,se,ae,te,oe,re,de,ne,le,ie,pe,ce,ue,me,fe,he,ye,xe,ve,be,ge,_e,Ce;const e=await Ye({id:Ee});let s="";if((d=e.data)!=null&&d.userAddress&&(e.data.userAddress.postscript=e.data.postscript),(l=e.data)!=null&&l.userAddress&&((g=(t=e.data)==null?void 0:t.userAddress)!=null&&g.encryptFlag)){const n=await b(e.data.address,(_=e.data)==null?void 0:_.submitUserPubKey);n&&(e.data.userAddress=ke(e.data.userAddress,n),(L=(V=e.data)==null?void 0:V.userAddress)!=null&&L.success&&!((B=e.data)!=null&&B.merchantEns)&&(s+=((K=(S=e.data)==null?void 0:S.userAddress)==null?void 0:K.userName)+((M=($=e.data)==null?void 0:$.userAddress)==null?void 0:M.telNumber)+(((T=(P=e.data)==null?void 0:P.userAddress)==null?void 0:T.postalCode)??"")+((O=(H=e.data)==null?void 0:H.userAddress)==null?void 0:O.provinceName)+((F=(U=e.data)==null?void 0:U.userAddress)==null?void 0:F.cityName)+((j=(R=e.data)==null?void 0:R.userAddress)==null?void 0:j.countyName)+((Z=(q=e.data)==null?void 0:q.userAddress)==null?void 0:Z.detailInfo)+((G=(z=e.data)==null?void 0:z.userAddress)==null?void 0:G.postscript)))}else(J=e.data)!=null&&J.merchantEns||(s+=((W=(Q=e.data)==null?void 0:Q.userAddress)==null?void 0:W.userName)+((X=(Y=e.data)==null?void 0:Y.userAddress)==null?void 0:X.telNumber)+(((se=(ee=e.data)==null?void 0:ee.userAddress)==null?void 0:se.postalCode)??"")+((te=(ae=e.data)==null?void 0:ae.userAddress)==null?void 0:te.provinceName)+((re=(oe=e.data)==null?void 0:oe.userAddress)==null?void 0:re.cityName)+((ne=(de=e.data)==null?void 0:de.userAddress)==null?void 0:ne.countyName)+((ie=(le=e.data)==null?void 0:le.userAddress)==null?void 0:ie.detailInfo)+((ce=(pe=e.data)==null?void 0:pe.userAddress)==null?void 0:ce.postscript));if(e.data.shippingHash){const n=await b(e.data.address,(ue=e.data)==null?void 0:ue.shippingUserPubKey);if(n){const Ne=I(e.data.expressNo,n);Ne.hash===e.data.shippingHash&&(e.data.expressNo=Ne.decrypt,e.data.expressCompany=I(e.data.expressCompany,n).decrypt,(me=e.data)!=null&&me.merchantEns||(s+=((fe=e.data)==null?void 0:fe.expressNo)+((he=e.data)==null?void 0:he.expressCompany)))}else(ye=e.data)!=null&&ye.merchantEns||(s+=((xe=e.data)==null?void 0:xe.expressNo)+((ve=e.data)==null?void 0:ve.expressCompany));(be=e.data)!=null&&be.merchantEns||(s+=((ge=e.data)==null?void 0:ge.hash)+((_e=e.data)==null?void 0:_e.address))}const u=[{id:(Ce=e.data)==null?void 0:Ce.id,merchantEns:await De(s)}].filter(n=>n.merchantEns);u.length>0&&Xe({enInfoList:u}),h.value=e.data},[Be,Se]=Re(!1),p=y(!1),Ke=["无需发货","到付运费","顺丰速运","中国邮政EMS","京东物流","中通快递","圆通速递","韵达快递","申通快递","极兔速递","其他"],a=je({expressCompany:"",expressNo:"",orderId:""}),$e=e=>{a.expressCompany=e,p.value=!1},Me=()=>{p.value=!1},Pe=async()=>{var s;if(E.value)return;c(!0),a.orderId=h.value.id;const e=await b((s=h.value)==null?void 0:s.address);try{if(!a.expressCompany){N.fail(A("order.deliveryCompanyPlaceholder")),c(!1);return}if(a.expressCompany!=="无需发货"&&!a.expressNo){N.fail(A("order.express empty")),c(!1);return}let r={expressCompany:a.expressCompany,expressNo:a.expressNo,orderId:a.orderId,shippingHash:null};if(e){const d=k(a.expressNo,e);r.expressNo=d.encrypt,r.shippingHash=d.hash;const l=k(a.expressCompany,e);r.expressCompany=l.encrypt}if((await es(r)).success){const d=Ve?-2:-1;w.go(d),setTimeout(()=>{w.replace({path:"/sellerOrderList",query:{active:1,type:1}})},50)}c(!1)}catch(r){c(!1),N.fail(r.message)}},c=(e=!0)=>{Se(e),E.value=e};return qe(async()=>{await Le()}),(e,s)=>{const r=x("van-field"),u=x("van-icon"),d=x("van-popup"),l=x("VanButton");return h.value?(we(),Ae("div",os,[o("section",rs,[o("div",ds,[i(ss)]),o("div",ns,v(e.$t("order.deliveryInfo")),1)]),o("div",ls,[o("div",is,[i(r,{modelValue:m(a).expressCompany,"onUpdate:modelValue":s[0]||(s[0]=t=>m(a).expressCompany=t),label:e.$t("order.deliveryCompany"),placeholder:e.$t("order.deliveryCompanyPlaceholder"),border:!1,"input-align":"right",readonly:"",onClick:s[1]||(s[1]=t=>p.value=!0)},{"right-icon":C(()=>[ps]),_:1},8,["modelValue","label","placeholder"]),cs,i(r,{modelValue:m(a).expressNo,"onUpdate:modelValue":s[2]||(s[2]=t=>m(a).expressNo=t),label:e.$t("order.deliveryId"),placeholder:e.$t("order.deliveryPlaceholder"),border:!1,"input-align":"right",maxlength:150},null,8,["modelValue","label","placeholder"]),i(d,{show:p.value,"onUpdate:show":s[3]||(s[3]=t=>p.value=t),position:"bottom",round:"",style:{width:"100%",borderRadius:"20px 20px 0 0",maxHeight:"90vh",height:"660px"}},{default:C(()=>[o("div",us,[o("span",ms,v(e.$t("order.deliveryCompany")),1),i(u,{name:"cross",class:"absolute right-4 top-1/2 -translate-y-1/2 text-2xl",onClick:Me})]),o("div",fs,[(we(),Ae(ze,null,Ge(Ke,(t,g)=>o("div",{key:t,class:"text-b1 py-4 border-b border-[#D9D9D9]",onClick:_=>$e(t)},[o("span",ys,v(t),1)],8,hs)),64))])]),_:1},8,["show"])]),o("div",xs,[i(l,{round:"",class:"flex-1 main-btn font-semibold text-b1 text-base h-[46px] rounded-full w-full",loading:m(Be),onClick:Pe},{default:C(()=>[Je(v(e.$t("order.Ship")),1)]),_:1},8,["loading"])])])])):Ze("",!0)}}const gs=Object.assign(vs,{setup:bs}),ws=Te(gs,[["__scopeId","data-v-caacff9c"]]);export{ws as default};
