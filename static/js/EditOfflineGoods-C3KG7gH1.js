import{z as Ne,r as x,y as te,D as Fe,F as B,Z as O,H as _,$ as g,I as s,Q as c,P as i,a3 as ye,G as T,K as yo,U as k,N as ce,O as l,J as Ke,n as K,x as bo,bl as We,E as _o,bj as lt,bk as nt,a4 as se,T as he,_ as rt,o as ut,q as dt,a2 as H,bU as it,bK as ro,bJ as uo,V as ct,a9 as Ce,X as gt,Y as vt,by as io}from"./vendor-Dr_RpJ_Y.js";import{a as wo,Y as Ae,aE as ft,b as pt,u as mt,w as ht,y as yt,C as pe,$ as bt,a1 as _t,bI as me,ax as co,ay as go,a7 as vo,g as fo,aW as wt,c1 as po,s as xt}from"./index-BckdT6oc.js";import{C as It}from"./CommonVanProvider-KZuKVOde.js";import{_ as Ct}from"./search-C4fLtTfY.js";import{_ as xo}from"./checked-C8-rw1H8.js";import{_ as Ft}from"./BrandSelectPop-DUxI0Azz.js";import{u as mo}from"./upload-DmJ1cHIQ.js";import{c as ie,i as ho}from"./offlineGoods-DvT2Go6q.js";import{S as He}from"./shop-CeqcS6K2.js";import"./BackIcon-CDrGaEPo.js";const St={class:"w-full py-4 pl-4 pr-2 bg-b6 rounded-[10px] overflow-hidden font-Puhui"},Dt={class:"text-center felx-1 relative mr-2"},$t={class:"text-base font-bold"},Bt={class:"absolute right-0 top-0 pl-2"},kt={class:"flex-1 bg-b5 rounded-3xl mr-2 mt-4 mb-2"},Et=s("div",null,[s("img",{src:Ct,class:"w-4 h-4"})],-1),At={class:"categoryList pr-2 mr-2 overflow-y-auto"},Nt=["id","onClick"],Vt=["innerHTML"],Pt={key:0,class:"w-4 h-4",src:xo,alt:""},Rt=Ne({props:{list:null,id:null,level:null},emits:["close","select"],setup(A,{emit:W}){const m=A,re=x(!0),q=x(""),be=te(()=>{if(!q.value.trim())return m.list;const o=J(q.value),D=new RegExp(`(${o})`,"gi");return m.list.filter(G=>G.goodsCategoryName.match(D))}),h=o=>{if(!q.value.trim())return o;const D=J(q.value),G=new RegExp(`(${D})`,"gi");return o.replace(G,'<span class="highlight">$1</span>')},J=o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),b=o=>{W("select",o.goodsCategoryId,o.goodsCategoryName),W("close")},P=o=>{const D=document.getElementById(o);D&&D.scrollIntoView({behavior:"smooth"})};return Fe(()=>m.id,async o=>{o&&(await K(),P(o))},{immediate:!0,deep:!0}),(o,D)=>{const G=B("van-icon"),I=B("VanField"),F=B("VanPopup");return _(),O(F,{teleport:"body",show:re.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:D[2]||(D[2]=y=>o.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"50%","border-radius":"16px 16px 0 0"}},{default:g(()=>[s("div",St,[s("header",Dt,[s("div",$t,c([o.$t("offline.one_category"),o.$t("offline.two_category"),o.$t("offline.three_category")][(A.level||1)-1])+" （"+c((A.list||[]).length)+"） ",1),s("div",Bt,[i(G,{name:"cross",size:"20",onClick:D[0]||(D[0]=ye(()=>{W("close")},["stop"]))})])]),s("div",kt,[i(I,{modelValue:q.value,"onUpdate:modelValue":D[1]||(D[1]=y=>q.value=y),placeholder:o.$t("mall.Enter search keywords"),class:"w-[100% - 20px] text-center bg-transparent items-center",clearable:""},{"left-icon":g(()=>[Et]),_:1},8,["modelValue","placeholder"])]),s("div",At,[(_(!0),T(Ke,null,yo(l(be),y=>(_(),T("div",{key:y.goodsCategoryId,id:y.goodsCategoryId,class:"flex flex-1 justify-between py-4 border-b border-b-b4 last:border-none",onClick:R=>b(y)},[s("span",{class:ce({"text-newOrigin":y.goodsCategoryId===A.id}),innerHTML:h(y.goodsCategoryName)},null,10,Vt),y.goodsCategoryId===A.id?(_(),T("img",Pt)):k("",!0)],8,Nt))),128))])])]),_:1},8,["show"])}}}),Tt={class:"w-full py-4 px-3 safe-bottom bg-b6 rounded-[10px] overflow-hidden font-Puhui"},Lt={class:"text-center felx-1 relative mx-1"},Ot={class:"text-base font-bold"},qt={class:"absolute right-0 top-0 pl-2"},Gt={class:"rounded-[10px] bg-[#F5F5F5] h-[56px] w-full mt-4"},Mt={class:"flex items-center justify-start w-full h-full p-3"},Ut={class:"w-8 h-8 rounded-[4px] bg-[#D9D9D9]"},zt={class:"ml-2"},jt={class:"text-base font-semibold text-b1 line-clamp-1 flex-shrink-0"},Ht={class:"ml-auto pl-1 flex-shrink-0"},Kt={class:"flex-1 flex items-center gap-1 text-sm"},Wt={class:"flex-1"},Jt={class:"text-b3 flex items-center gap-x-1"},Yt={class:"line-clamp-1"},Xt={key:0,class:"w-4 h-4",src:xo,alt:""},Qt={class:"flex items-center gap-x-3 pt-4"},Zt={class:"text-b1 text-sm"},es={key:0},os=Ne({props:{brand:null,ids:null},emits:["close","selectStore","changeBrand","selectAllStore"],setup(A,{emit:W}){var p,C;const m=A,{t:re}=bo(),{cityMapStore:q}=wo(),be=x(!0),h=We({total:0,loading:!1,finished:!1,list:[]}),J=We({page:0,size:20,storeBrandId:(p=m.brand)==null?void 0:p.storeBrandId,overseasFlag:((C=q.currentActiveCity)==null?void 0:C.overseasFlag)||!1,storeNameLike:void 0}),b=x([]),P=x(null),o=te(()=>{var r,d;return(r=h.list)!=null&&r.length?((d=h.list)==null?void 0:d.length)===b.value.length:!1}),D=()=>{P.value.toggleAll(!o.value)},G=()=>{if(!b.value.length)return y(re("city.Please select a store"));W("selectStore",h.list.filter(r=>b.value.includes(r.storeId)))},I=()=>{W("selectAllStore")},F=()=>{W("changeBrand")},y=(r="",d="toast-warn.svg")=>{he({message:r,icon:Ae(d),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},R=r=>{const d=document.getElementById(r);d&&d.scrollIntoView({behavior:"smooth"})};Fe(()=>m.ids,async r=>{r!=null&&r.length&&(b.value=r,await K(),R(r[0]))},{immediate:!0,deep:!0});const _e=async()=>{h.loading=!0,J.page+=1,await M(),h.loading=!1},M=async()=>{var Z;J.storeBrandId=(Z=m.brand)==null?void 0:Z.storeBrandId;const{success:r,data:d}=await ft(J),{records:Y,total:U,current:ue,pages:ae}=d;if(!r){h.finished=!0;return}if(!U||!Y||!(Y!=null&&Y.length)){h.finished=!0;return}h.total=U,h.list=J.page===1?Y:h.list.concat(Y),o.value&&(b.value=h.list.map(ge=>ge.storeId)),+ue>=+ae&&(h.finished=!0)},Se=r=>{let d="";return r.storeAddress?(r.areaExtName3&&r.storeAddress.indexOf(r.areaExtName3)>-1?d=r.storeAddress:d=`${r.areaExtName3}${r.storeAddress}`,r.areaExtName2&&r.storeAddress.indexOf(r.areaExtName2)>-1?d=d:d=`${r.areaExtName2}${d}`,r.areaExtName1&&r.storeAddress.indexOf(r.areaExtName1)>-1?d=d:d=`${r.areaExtName1}${d}`,d||""):(d=`${r.areaExtName3||""}${r.areaExtName2||""}${r.areaExtName1||""}${r.storeName||""}`,d)};return _o(()=>{_e()}),(r,d)=>{const Y=B("van-icon"),U=B("VanImage"),ue=B("Empty"),ae=B("van-checkbox"),Z=B("van-checkbox-group"),ge=B("VanList"),Ve=B("van-radio"),de=B("VanButton"),Pe=B("VanPopup");return _(),O(Pe,{teleport:"body",show:be.value,position:"bottom",round:"","close-on-click-overlay":!1,onClickOverlay:d[3]||(d[3]=ee=>r.$emit("close")),"overlay-class":"categoryOverlay",class:"sm:w-[375px] sm:left-[50%] sm:translate-x-[-50%]",style:{"min-height":"50%","border-radius":"16px 16px 0 0"}},{default:g(()=>{var ee,De;return[s("div",Tt,[s("header",Lt,[s("div",Ot,c(r.$t("offline.select_branch_store")),1),s("div",qt,[i(Y,{name:"cross",size:"20",onClick:d[0]||(d[0]=ye(()=>{W("close")},["stop"]))})])]),s("section",Gt,[s("div",Mt,[s("div",Ut,[i(U,{src:((ee=A.brand)==null?void 0:ee.storeBrandIcon)||"",radius:"4px",width:"32px",height:"32px",fit:"cover"},null,8,["src"])]),s("div",zt,[s("span",jt,c((De=A.brand)==null?void 0:De.storeBrandName),1)]),s("div",Ht,[s("span",{class:"text-[#FF8812] text-sm font-normal",onClick:F},c(r.$t("city.Change brand")),1)])])]),l(h).list.length===0&&!l(h).loading?(_(),O(ue,{key:0,name:r.$t("city.The brand currently has no physical stores")},null,8,["name"])):k("",!0),lt(i(ge,{loading:l(h).loading,"onUpdate:loading":d[2]||(d[2]=S=>l(h).loading=S),finished:l(h).finished,"immediate-check":!1,"loading-text":r.$t("common.loading"),onLoad:_e,class:"shopList h-[calc(100vh-230px)] mx-1 overflow-y-auto"},{default:g(()=>[i(Z,{modelValue:b.value,"onUpdate:modelValue":d[1]||(d[1]=S=>b.value=S),ref:(S,we)=>{we.checkboxGroup=S,P.value=S}},{default:g(()=>[(_(!0),T(Ke,null,yo(l(h).list,S=>(_(),O(ae,{key:S.storeId,name:S.storeId,id:S,"label-position":"left",class:"flex flex-1 justify-between py-4 border-b border-b-b4 last:border-none"},{icon:g(we=>[we.checked?(_(),T("img",Xt)):k("",!0)]),default:g(()=>[s("div",Kt,[s("div",Wt,[s("div",{class:ce([{"text-newOrigin font-semibold":b.value.includes(S.storeId)},"line-clamp-1"])},c(S.storeName),3),s("div",Jt,[s("span",Yt,c(Se(S)),1)])])])]),_:2},1032,["name","id"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["loading","finished","loading-text"]),[[nt,l(h).list.length>0]]),s("div",Qt,[l(h).list.length>0?(_(),T(Ke,{key:0},[s("div",{onClick:D},[i(Ve,{checked:l(o),"checked-color":"#FF8812","icon-size":"16px"},{default:g(()=>[s("span",Zt,c(r.$t("common.check all")),1)]),_:1},8,["checked"])]),i(de,{class:"submit-btn flex-1 bg-yellow text-b1 text-base font-semibold border-none h-[46px]",round:"",onClick:G},{default:g(()=>[se(c(r.$t("city.choose store")),1),b.value.length?(_(),T("span",es,"("+c(b.value.length)+")",1)):k("",!0)]),_:1})],64)):l(h).loading?k("",!0):(_(),O(de,{key:1,class:"submit-btn flex-1 bg-yellow text-b1 text-base font-semibold border-none h-[46px]",round:"",onClick:I},{default:g(()=>[se(c(r.$t("city.Select all branches including supplements")),1)]),_:1}))])])]}),_:1},8,["show"])}}}),Je=A=>(gt("data-v-00cf61c6"),A=A(),vt(),A),ts={class:"bg-white rounded-xl overflow-hidden mx-3 px-3 py-4 title"},ss={class:"text-b1 font-semibold"},as={class:"border-b4 border-b border-solid pb-4 van-uploader__wrapper gap-1.5"},ls=["onClick"],ns={class:"van-image van-uploader__preview-image handle",style:{width:"60px",height:"60px"}},rs=["onClick"],us=Je(()=>s("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),ds=[us],is={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},cs=["src"],gs={class:"text-xs font-light text-center text-b1 opacity-30"},vs={class:"border-b4 border-b border-solid"},fs={class:"text-default font-semibold"},ps={key:0,class:"border-b4 border-b border-solid"},ms={class:"text-default font-semibold"},hs={key:1,class:"border-b4 border-b border-solid"},ys={class:"text-default font-semibold"},bs={class:"pt-4 font-semibold text-b1"},_s={class:"van-uploader__wrapper gap-1.5"},ws=["onClick"],xs={class:"van-image van-uploader__preview-image handle",style:{width:"60px",height:"60px"}},Is=["onClick"],Cs=Je(()=>s("i",{class:"van-badge__wrapper van-icon van-icon-cross van-uploader__preview-delete-icon"},null,-1)),Fs=[Cs],Ss={class:"w-[60px] h-[60px] bg-b5 rounded-xl text-center flex flex-col justify-center items-center text-[#d9d9d9]"},Ds=["src"],$s={class:"text-xs font-light text-center text-b1 opacity-30"},Bs={class:"bg-white rounded-xl overflow-hidden m-3 px-3 title"},ks={class:"text-default font-semibold"},Es={key:0,class:"text-b3"},As={key:0,class:"rounded-[10px] bg-[#F5F5F5] min-h-[56px] w-full mb-4 p-3"},Ns={class:"flex items-center justify-start w-full h-full"},Vs={class:"shrink-0 w-8 h-8 rounded-[4px] bg-[#D9D9D9]"},Ps={class:"ml-2 w-full flex justify-between items-center"},Rs={class:"text-base font-semibold text-b1 line-clamp-1"},Ts={key:0,class:"bg-white rounded-xl m-3 overflow-hidden"},Ls={class:"text-default font-semibold"},Os={class:"bg-white rounded-xl overflow-hidden m-3 px-3 title"},qs={class:"border-b4 border-b border-solid"},Gs={class:"text-default font-semibold"},Ms={class:"text-default font-semibold"},Us=se("%"),zs={key:1,class:"fixed bottom-0 flex items-center px-3 pt-4 safe-bottom justify-evenly gap-x-3 btn-wrapper sm:w-[375px] w-full left-[50%]",style:{transform:"translateX(-50%)"}},js={class:"text-b3 text-center text-sm mt-6"},Hs={class:"flex items-center justify-between mt-6"},Ks=Je(()=>s("div",null,[se(" 您修改了"),s("span",{style:{color:"#f44"}},"正在上架"),se("的商品的信息，还未保存,离开页面会丢失这些更改，您确定要离开吗 ")],-1)),Ws=Ne({name:"EditOfflineGoods"});function Js(A){const{checkLoginAuth:W}=pt(),{t:m}=bo(),{accountStore:re,serviceCategoriesStore:q,reloadStore:be}=wo(),{getCurrentStoreId:h}=mt(),{loadingToggle:J}=ht(),b=ut(),P=dt(),o=x({goodsId:null,shopId:null,goodsName:"",goodsIcons:"",goodsPrice:null,goodsDiscountRatio:null,goodsDesc:null,goodsPics:"",goodsStatus:1,goodsType:null,goodsCategoryId1:null,goodsCategoryName1:null,goodsCategoryId2:null,goodsCategoryName2:null,goodsCategoryId3:null,goodsCategoryName3:null,goodsCategoryId:null,storeBrandId:void 0,includeAllStoreFlag:!1}),D=te(()=>!o.value.goodsName||I.value.length<=0||!o.value.goodsCategoryId1||!o.value.goodsCategoryId2||!o.value.goodsCategoryId3||!o.value.goodsPrice||!o.value.goodsDiscountRatio||!o.value.includeAllStoreFlag&&!C.value.length),G=te(()=>{const e=!!(o.value.goodsName&&o.value.goodsName.trim()),t=!!(o.value.goodsDesc&&o.value.goodsDesc.trim()),a=!!(I.value&&I.value.length>0),n=!!(F.value&&F.value.length>0),v=o.value.goodsPrice!==null&&o.value.goodsPrice!==void 0&&o.value.goodsPrice>0,L=!!o.value.goodsDiscountRatio,j=o.value.goodsCategoryId1!==null&&o.value.goodsCategoryId1!==void 0,f=o.value.goodsCategoryId2!==null&&o.value.goodsCategoryId2!==void 0,E=o.value.goodsCategoryId3!==null&&o.value.goodsCategoryId3!==void 0,ke=p.storeBrandId!==null&&p.storeBrandId!==void 0,Ee=C.value&&C.value.length>0;return Object.values({hasGoodsName:e,hasGoodsDesc:t,hasMainImg:a,hasDescImg:n,hasPrice:v,hasDiscountRatio:L,hasCategory1:j,hasCategory2:f,hasCategory3:E,hasBrand:ke,hasStores:Ee}).every(u=>u===!1)}),I=x([]),F=x([]),y=x(0),R=x(0),_e=x([]),M=x(1),Se=x(null),p=We({storeBrandId:null,storeBrandName:null,storeBrandIcon:null}),C=x([]),[r,d]=H(!1),[Y,U]=H(!1),[ue,ae]=H(!1),[Z,ge]=H(!1),[Ve,de]=H(!1),[Pe,ee]=H(!1),[De,S]=H(!1),[we,xe]=H(!1),[Io,ve]=H(!1),[Co,$e]=H(!1),[Fo,Ye]=H(!1),Xe=te(()=>({1:m("common.boutique"),2:m("mall.Best"),3:m("shop.Star Selection")})),Qe=[[1,80],[4,30],[10,80],[20,80]],le=te(()=>{let e=[1,80];return y.value&&(e=Qe[R.value]),e}),So=te(()=>{const e=b.query.goodsId?"编辑服务":"发布服务";return document.title=b.query.goodsId?"线下服务编辑":"线下服务发布",e}),Do=te(()=>o.value.goodsStatus===ie.DRAFT?"立即上架":o.value.goodsStatus===ie.Published?"保存并发布":"立即上架"),$o=e=>e.replace(/^(\d*\.?\d{0,4}).*$/,"$1"),Ze=e=>{function t(a){let n=a.replace(/[^\d.]/g,"");return n=n.replace(/(\..*)\./g,"$1"),n=y.value?n.replace(/^(\d*\.?\d{0,0}).*$/,"$1"):n.replace(/^(\d*\.?\d{0,2}).*$/,"$1"),n}return e>le.value[1]?le.value[1].toString():t(e.toString())};Fe(()=>y.value,()=>{o.value.goodsDiscountRatio>0&&(o.value.goodsDiscountRatio=Ze(o.value.goodsDiscountRatio))});const Bo=()=>{if(!y.value&&R.value&&o.value.goodsDiscountRatio>0){const e=Qe[R.value];o.value.goodsDiscountRatio>=e[0]&&o.value.goodsDiscountRatio<=e[1]&&(y.value=R.value)}},eo=x(5),ko=async e=>{if(I.value.length>=eo.value)return;const t=co(e.file);if(!t.valid)return N(t.tips);const a=go(e.file);if(!a.valid)return N(a.tips);he.loading({message:m("common.uploading"),forbidClick:!0,duration:0});const n=await vo(e,"goodsImg"),v=await mo(n);if(he.clear(),!v.success)return N(m("comomn.Image upload failed"));I.value.push({id:me(),url:fo.imgUrl+v.data})},Eo=e=>{I.value.splice(e,1)},Ao=e=>{io({images:I.value.map(t=>t.url),startPosition:e})},oo=x(5),No=async e=>{if(F.value.length>=oo.value)return;const t=co(e.file);if(!t.valid)return N(t.tips);const a=go(e.file);if(!a.valid)return N(a.tips);he.loading({message:m("common.uploading"),forbidClick:!0,duration:0});const n=await vo(e,"goodsDesc"),v=await mo(n);if(he.clear(),!v.success)return N(m("comomn.Image upload failed"));F.value.push({id:me(),url:fo.imgUrl+v.data})},Vo=e=>{F.value.splice(e,1)},Po=e=>{io({images:F.value.map(t=>t.url),startPosition:e})},Re=(e,t,a)=>{_e.value=wt(q.fullCategories,{idKey:"goodsCategoryId",parentKey:"goodsCategoryParentId",rootId:t}),Se.value=e,M.value=a,ge(!0)},Ro=(e,t)=>{if(o.value[`goodsCategoryId${M.value}`]=e,o.value[`goodsCategoryName${M.value}`]=t,M.value<3)for(let a=M.value;a<3;a++)o.value[`goodsCategoryId${a+1}`]=null,o.value[`goodsCategoryName${a+1}`]=null},To=()=>{var e;p.storeBrandId&&((e=C.value)!=null&&e.length)?U(!0):d(!0)},Lo=e=>{p.storeBrandId!==e.storeBrandId&&(C.value=[],o.value.includeAllStoreFlag=!1),p.storeBrandId=e.storeBrandId,p.storeBrandName=e.storeBrandName,p.storeBrandIcon=e.storeBrandIcon},to=()=>{C.value=[],o.value.includeAllStoreFlag=!0,d(!1),U(!1)},Oo=()=>{U(!0)},qo=e=>{const t=e||[];C.value=t.map(a=>a.storeId),o.value.includeAllStoreFlag=!1,U(!1)},Go=()=>{U(!1),d(!0)},N=e=>{he({message:e,icon:Ae("toast-warn.svg"),duration:2e3,overlay:!0,overlayClass:"toastOverlay",className:"toastCard",type:"html"})},Mo=()=>{o.value.goodsPrice<0&&(N(m("offline.price_tips")),o.value.goodsPrice=Math.abs(o.value.goodsPrice))},Uo=()=>{var e;return o.value.goodsName?I.value.length?((e=o.value)==null?void 0:e.goodsPrice)<=0?(N(m("shop.pleaseInput")+m("goods.price")),!1):!0:(N(m("offline.empty_image")),!1):(N(m("offline.offline_name_placeholder")),!1)},so=async()=>{var a;const e=I.value.map(n=>n.url),t=F.value.map(n=>n.url);o.value.goodsType=y.value?R.value:He.SD,o.value.goodsIcons=e.join(","),o.value.goodsPics=t.join(","),o.value.shopId=(a=await h())==null?void 0:a.id,o.value.storeBrandId=p.storeBrandId||void 0,o.value.storeIds=C.value.length?C.value:void 0},Te=async()=>{ae(!0),o.value.goodsStatus=ie.DRAFT,await so();const{success:e,data:t}=await po(o.value);ae(!1),e&&(o.value.goodsId=t,Q(),X.value=!1,z.value=!0,V.value=null,ao())},zo=async()=>{if(!Uo())return;if(!o.value.goodsCategoryId1)return N(m("shop.pleaseSelect")+m("offline.one_category"));if(!o.value.goodsCategoryId2)return N(m("shop.pleaseSelect")+m("offline.two_category"));if(!o.value.goodsCategoryId3)return N(m("shop.pleaseSelect")+m("offline.three_category"));if(!o.value.goodsDiscountRatio||o.value.goodsDiscountRatio<le.value[0]||+o.value.goodsDiscountRatio>le.value[1]){const a=m("offline.empty_discount")+`<div class="text-center ">(${le.value[0]}-${le.value[1]}%)</div>`;return N(a)}ae(!0),o.value.goodsStatus=ie.Published,await so();const{success:e,data:t}=await po(o.value);ae(!1),e&&(o.value.goodsId=t,Q(),X.value=!1,z.value=!0,V.value=null,de(!0))},jo=()=>{var e,t,a;if(lo(),de(!1),(e=o.value)!=null&&e.goodsId){let n={};(t=o.value)!=null&&t.goodsId&&(n.goodsId=(a=o.value)==null?void 0:a.goodsId.toString()),P.replace({path:"/offlineGoodsDetail",query:n})}},ao=()=>{lo(),de(!1),P.back()},lo=()=>{var t;const e=((t=o.value)==null?void 0:t.goodsId)||b.query.goodsId||"add";sessionStorage.setItem("shop_offline_refresh_id",e.toString())},Ie="offline_draft_data",ne=te(()=>{var e;return((e=re.store)==null?void 0:e.id)+"_"+re.account}),V=x(null),fe=x(null),X=x(!1),z=x(!1),Le=x(!1),oe=()=>({goods:Ce.cloneDeep(o.value),imgList:Ce.cloneDeep(I.value),descImgList:Ce.cloneDeep(F.value),boutiqueFlag:y.value,brandInfo:Ce.cloneDeep(p),storeIds:Ce.cloneDeep(C.value)}),Oe=(e,t=!1)=>{try{const a={...e,isManualSave:t,timestamp:Date.now()};let n=qe();n&&!n.goods?n={...n,[ne.value]:a}:n={[ne.value]:a},localStorage.setItem(Ie,JSON.stringify(n))}catch(a){console.error("保存表单数据失败:",a)}},qe=()=>{try{const e=localStorage.getItem(Ie);return e?JSON.parse(e):null}catch(e){return console.error("获取缓存数据失败:",e),null}},Ge=()=>{var e;try{const t=qe();return!t||!t[ne.value]||!((e=t[ne.value])!=null&&e.goods)?null:t[ne.value]}catch(t){return console.error("恢复表单数据失败:",t),null}},Q=()=>{try{let e=qe();e&&e[ne.value]&&e[ne.value].goods?(delete e[ne.value],Object.keys(e).length===0?localStorage.removeItem(Ie):localStorage.setItem(Ie,JSON.stringify(e))):localStorage.removeItem(Ie)}catch(e){console.error("清空表单数据失败:",e)}},Ho=e=>{if(e)try{e.goods&&Object.assign(o.value,e.goods),e.imgList&&Array.isArray(e.imgList)&&(I.value=e.imgList.map(t=>({id:t.id||me(),url:t.url}))),e.descImgList&&Array.isArray(e.descImgList)&&(F.value=e.descImgList.map(t=>({id:t.id||me(),url:t.url}))),e.boutiqueFlag!==void 0&&(y.value=e.boutiqueFlag),e.brandInfo&&Object.assign(p,e.brandInfo),e.storeIds&&Array.isArray(e.storeIds)&&(C.value=e.storeIds)}catch(t){console.error("填充表单数据失败:",t)}},Me=e=>{if(!e)return!1;const t=oe();if(!t)return!1;const a=(n,v)=>{if(n===v)return!0;if(!n||!v||typeof n!="object"||typeof v!="object")return!1;const L=Object.keys(n),j=Object.keys(v);if(L.length!==j.length)return!1;for(const f of L){if(!j.includes(f))return!1;if(Array.isArray(n[f])&&Array.isArray(v[f])){if(n[f].length!==v[f].length)return!1;for(let E=0;E<n[f].length;E++)if(f==="imgList"||f==="descImgList"){if(n[f][E].url!==v[f][E].url)return!1}else if(!a(n[f][E],v[f][E]))return!1}else if(typeof n[f]=="object"&&typeof v[f]=="object"&&n[f]!==null&&v[f]!==null){if(!a(n[f],v[f]))return!1}else if(n[f]!==v[f])return!1}return!0};return!a(t,e)};Fe([()=>o.value,()=>I.value,()=>F.value,()=>y.value,()=>p.storeBrandId,()=>C.value],()=>{if(no.value&&V.value){if(X.value=Me(V.value),!Me(fe.value))Q();else if(G.value)Q();else if(!z.value){const t=oe();Oe(t,!1)}}},{deep:!0});const Ko=()=>{o.value={goodsId:null,shopId:null,goodsName:"",goodsIcons:"",goodsPrice:null,goodsDiscountRatio:null,goodsDesc:null,goodsPics:"",goodsStatus:1,goodsType:null,goodsCategoryId1:null,goodsCategoryName1:null,goodsCategoryId2:null,goodsCategoryName2:null,goodsCategoryId3:null,goodsCategoryName3:null,goodsCategoryId:null,storeBrandId:void 0,includeAllStoreFlag:!1},I.value=[],F.value=[],y.value=0,p.storeBrandId=null,p.storeBrandName=null,p.storeBrandIcon=null,C.value=[]},Wo=()=>{const e=oe();Oe(e,!0),ee(!1),z.value=!0,X.value=!1,K(()=>{P.back()})},Jo=()=>{Q(),ee(!1),z.value=!0,Ko(),X.value=!1,V.value=null,K(()=>{P.back()})},Ue=()=>{const e=Ge();e&&(Ho(e),K(()=>{V.value=oe(),Oe(e,!0)})),$e(!1)},Be=()=>{Q(),$e(!1),Ye(!1),K(()=>{V.value=oe(),X.value=!1})},Yo=()=>{Q(),S(!1),z.value=!0,X.value=!1,V.value=null,K(()=>{P.back()})},Xo=()=>{S(!1)},Qo=async()=>{xe(!1),z.value=!0,await Te()},Zo=()=>{Q(),xe(!1),z.value=!0,X.value=!1,V.value=null,K(()=>{P.back()})},et=async()=>{ve(!1),z.value=!0;try{await Te(),Q(),ve(!1)}catch(e){console.error("保存草稿并退出失败:",e)}},ot=()=>{Q(),ve(!1),z.value=!0,K(()=>{P.back()})},tt=()=>{var a,n;const e=Ge();let t={};(a=e.goods)!=null&&a.goodsId&&(t.goodsId=(n=e.goods)==null?void 0:n.goodsId),P.replace({name:"EditOfflineGoods",query:t,params:{restoreWithoutInquire:1}}),be.reload()};it((e,t,a)=>{if(ue.value){a();return}if(z.value){a();return}if(xt.versions.ios&&!Le.value){a();return}Le.value=!1;const n=!!b.query.goodsId,v=!n,L=o.value.goodsStatus===ie.Published,j=o.value.goodsStatus===ie.DRAFT,f=o.value.goodsStatus===ie.OffShelf,E=Me(fe.value);if(n&&L&&V.value&&E){S(!0),a(!1);return}if(n&&j&&V.value&&E){xe(!0),a(!1);return}if(n&&f&&V.value&&E){ve(!0),a(!1);return}if(v&&V.value&&!G.value){ee(!0),a(!1);return}a()}),Fe(()=>b.path,e=>{e!=="/shopGoods/editGoods"&&(S(!1),xe(!1),ve(!1),ee(!1))},{immediate:!0,deep:!0});const no=x(!1),st=async()=>{var a,n,v,L,j;const e=(a=b.query)==null?void 0:a.goodsId;if(!e)return;const t=await _t({id:e.toString()});t.success&&(o.value=t.data,o.value.goodsId=e.toString(),((n=o.value)==null?void 0:n.goodsType)!==He.SD&&R.value!==He.SD&&(y.value=1),o.value.goodsIcons&&(I.value=(o.value.goodsIcons||"").split(",").map(f=>({id:me(),url:f}))),o.value.goodsPics&&(F.value=o.value.goodsPics.split(",").map(f=>({id:me(),url:f}))),o.value.goodsDiscountRatio<=0&&(o.value.goodsDiscountRatio=null),+o.value.storeBrandId&&(p.storeBrandId=o.value.storeBrandId,p.storeBrandName=((v=o.value)==null?void 0:v.storeBrandName)||null,p.storeBrandIcon=((L=o.value)==null?void 0:L.storeBrandIcon)||null,C.value=((j=o.value)==null?void 0:j.storeIds)||[]))},at=async()=>{var a;const{success:e,data:t}=await bt((a=await h())==null?void 0:a.merchant);e&&(R.value=t==null?void 0:t.type)};return _o(async()=>{var a,n,v;if(!W(!0))return;J(!0),q.init(),await at();const e=!b.query.goodsId,t=Ge();t&&e&&!((a=t.goods)!=null&&a.goodsId)&&(t.isManualSave||b.params.restoreWithoutInquire?(fe.value={...oe()},Ue(),await K(),X.value=!0):$e(!0)),await st(),t&&!e&&((n=t.goods)==null?void 0:n.goodsId)==b.query.goodsId&&(b.params.restoreWithoutInquire?(fe.value={...oe()},Ue(),await K(),X.value=!0):$e(!0)),V.value=oe(),fe.value||(fe.value={...oe()}),t&&((v=t.goods)==null?void 0:v.goodsId)!=b.query.goodsId&&Ye(!0),no.value=!0,J(!1)}),(e,t)=>{const a=B("van-field"),n=B("VanImage"),v=B("van-uploader"),L=B("VanIcon"),j=B("van-switch"),f=B("VanButton");return _(),O(It,{title:l(So),class:"font-Puhui font-normal relative pb-20 bg-gray1",themeVars:{navBarBackgroundColor:"#F2F0EF"},onBack:t[21]||(t[21]=E=>Le.value=!0)},{default:g(()=>{var E,ke,Ee,ze,je;return[s("div",ts,[s("div",ss,c(e.$t("offline.offline_name")),1),i(a,{modelValue:o.value.goodsName,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.goodsName=u),autosize:"",type:"text",placeholder:e.$t("offline.offline_name_placeholder"),maxlength:"50",class:"no-bt"},null,8,["modelValue","placeholder"]),s("div",as,[i(l(uo),ro({class:"flex flex-wrap gap-1.5",modelValue:I.value,"onUpdate:modelValue":t[1]||(t[1]=u=>I.value=u),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:g(({element:u,index:w})=>[s("div",{class:"van-uploader__preview",onClick:ye($=>Ao(w),["stop"])},[s("div",ns,[i(n,{src:u.url,class:"van-image__img",radius:"6px",fit:"cover"},null,8,["src"])]),s("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:ye($=>Eo(w),["stop"])},ds,8,rs)],8,ls)]),_:1},16,["modelValue","handle"]),I.value.length<eo.value?(_(),O(v,{key:0,accept:l(ho),afterRead:ko},{default:g(()=>[s("div",is,[s("img",{src:l(Ae)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,cs),s("div",gs,c(e.$t("offline.main_image")),1)])]),_:1},8,["accept"])):k("",!0)]),s("div",vs,[i(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[2]||(t[2]=u=>{var w;return Re((w=o.value)==null?void 0:w.goodsCategoryId1,0,1)})},{label:g(()=>[s("div",fs,c(e.$t("offline.one_category")),1)]),input:g(()=>{var u,w,$;return[s("div",{class:ce(["dropdown text-b3",{"!text-b2":(u=o.value)==null?void 0:u.goodsCategoryId1,"down-active":M.value===1&&l(Z)}])},c((w=o.value)!=null&&w.goodsCategoryId1?($=o.value)==null?void 0:$.goodsCategoryName1:e.$t("shop.pleaseSelect")),3)]}),_:1})]),(E=o.value)!=null&&E.goodsCategoryId1?(_(),T("div",ps,[i(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[3]||(t[3]=u=>{var w,$;return Re((w=o.value)==null?void 0:w.goodsCategoryId2,($=o.value)==null?void 0:$.goodsCategoryId1,2)})},{label:g(()=>[s("div",ms,c(e.$t("offline.two_category")),1)]),input:g(()=>{var u,w,$;return[s("div",{class:ce(["dropdown text-b3",{"!text-b2":(u=o.value)==null?void 0:u.goodsCategoryId2,"down-active":M.value===2&&l(Z)}])},c((w=o.value)!=null&&w.goodsCategoryId2?($=o.value)==null?void 0:$.goodsCategoryName2:e.$t("shop.pleaseSelect")),3)]}),_:1})])):k("",!0),(ke=o.value)!=null&&ke.goodsCategoryId2?(_(),T("div",hs,[i(a,{"input-align":"right",autocomplete:"off",class:"no-bt",onClick:t[4]||(t[4]=u=>{var w,$;return Re((w=o.value)==null?void 0:w.goodsCategoryId3,($=o.value)==null?void 0:$.goodsCategoryId2,3)})},{label:g(()=>[s("div",ys,c(e.$t("offline.three_category")),1)]),input:g(()=>{var u,w,$;return[s("div",{class:ce(["dropdown text-b3",{"!text-b2":(u=o.value)==null?void 0:u.goodsCategoryId3,"down-active":M.value===3&&l(Z)}])},c((w=o.value)!=null&&w.goodsCategoryId3?($=o.value)==null?void 0:$.goodsCategoryName3:e.$t("shop.pleaseSelect")),3)]}),_:1})])):k("",!0),s("div",bs,c(`${e.$t("goods.goodsDesc")}`),1),i(a,{modelValue:o.value.goodsDesc,"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.goodsDesc=u),rows:"1",autosize:"",type:"textarea",placeholder:e.$t("goods.pleaseInputDesc"),class:"no-bt",style:{"padding-top":"8px !important","padding-bottom":"8px !important"}},null,8,["modelValue","placeholder"]),s("div",_s,[i(l(uo),ro({class:"flex flex-wrap gap-1.5",modelValue:F.value,"onUpdate:modelValue":t[6]||(t[6]=u=>F.value=u),"item-key":"id",distance:"12",delay:"200",touchStartThreshold:"15"},{animation:200,group:"description",disabled:!1,ghostClass:"ghost"},{handle:".handle"}),{item:g(({element:u,index:w})=>[s("div",{class:"van-uploader__preview",onClick:ye($=>Po(w),["stop"])},[s("div",xs,[i(n,{src:u.url,class:"van-image__img",radius:"6px",fit:"cover"},null,8,["src"])]),s("div",{role:"button",class:"van-uploader__preview-delete van-uploader__preview-delete--shadow",tabindex:"0","aria-label":"删除",onClick:ye($=>Vo(w),["stop"])},Fs,8,Is)],8,ws)]),_:1},16,["modelValue","handle"]),F.value.length<oo.value?(_(),O(v,{key:0,accept:l(ho),afterRead:No},{default:g(()=>[s("div",Ss,[s("img",{src:l(Ae)("image-default.svg"),class:"w-6 mx-auto",alt:""},null,8,Ds),s("div",$s,c(e.$t("goods.descImage")),1)])]),_:1},8,["accept"])):k("",!0)])]),s("div",Bs,[s("div",{onClick:To},[i(a,{"input-align":"right",autocomplete:"off",class:"no-bt",style:ct(l(p).storeBrandId?"padding-bottom: 12px !important":"")},{label:g(()=>[s("div",ks,c(e.$t("offline.brandInfo")),1)]),input:g(()=>[l(p).storeBrandId?k("",!0):(_(),T("div",Es,[se(c(e.$t("shop.pleaseSelect"))+" ",1),i(L,{name:"arrow",class:"text-xs font-bold"})]))]),_:1},8,["style"]),l(p).storeBrandId?(_(),T("div",As,[s("div",Ns,[s("div",Vs,[i(n,{src:l(p).storeBrandIcon||"",radius:"4px",width:"32px",height:"32px",fit:"cover"},null,8,["src"])]),s("div",Ps,[s("div",Rs,c(l(p).storeBrandName||""),1),s("div",{class:ce(["shrink-0 text-b3",{"!text-b2":(Ee=C.value)==null?void 0:Ee.length}])},[se(c(o.value.includeAllStoreFlag?e.$t("city.All branches selected including supplements"):(ze=C.value)!=null&&ze.length?e.$t("offline.store_selected",{num:(je=C.value)==null?void 0:je.length}):l(p).storeBrandId?e.$t("city.No store selected"):e.$t("shop.pleaseSelect"))+" ",1),i(L,{name:"arrow",class:"text-xs font-bold"})],2)])])])):k("",!0)])]),R.value?(_(),T("div",Ts,[i(a,{"input-align":"right",autocomplete:"off",class:"no-bt",style:{"padding-top":"16px !important","padding-bottom":"16px !important"},label:`*${e.$t("goods.setting boutique good"),{type:l(Xe)[R.value]}}`},{label:g(()=>[s("div",Ls,c(`${e.$t("goods.setting boutique good",{type:l(Xe)[R.value]})}`),1)]),input:g(()=>[i(j,{modelValue:y.value,"onUpdate:modelValue":t[7]||(t[7]=u=>y.value=u),"active-color":"#FF8812","inactive-color":"#B7B4B0","active-value":1,"inactive-value":0,size:"20"},null,8,["modelValue"])]),_:1},8,["label"])])):k("",!0),s("div",Os,[s("div",qs,[i(a,{"input-align":"right",type:"number",autocomplete:"off",modelValue:o.value.goodsPrice,"onUpdate:modelValue":t[8]||(t[8]=u=>o.value.goodsPrice=u),onBlur:Mo,formatter:$o,placeholder:e.$t("shop.pleaseInput"),class:"no-bt"},{label:g(()=>[s("div",Gs,c(e.$t("offline.mcPrice")),1)]),_:1},8,["modelValue","placeholder"])]),i(a,{class:"no-bt","input-align":"right",type:y.value?"digit":"number",autocomplete:"off",modelValue:o.value.goodsDiscountRatio,"onUpdate:modelValue":t[9]||(t[9]=u=>o.value.goodsDiscountRatio=u),formatter:Ze,placeholder:`${e.$t("shop.pleaseInput")}${l(le)[0]}-${l(le)[1]}`,onBlur:Bo},{label:g(()=>[s("div",Ms,c(`${e.$t("offline.discountRatio")} `),1)]),"right-icon":g(()=>[Us]),_:1},8,["type","modelValue","placeholder"])]),l(re).isOnlyView?k("",!0):(_(),T("div",zs,[!l(b).query.goodsId||o.value.goodsStatus!==1?(_(),O(f,{key:0,round:"",type:"primary",class:"flex-1 min-w-[130px] h-[46px] rounded-full border border-solid border-b4 bg-white text-b2 text-base font-semibold",onClick:t[10]||(t[10]=u=>Te()),loading:l(ue),disabled:l(G)},{default:g(()=>[se(c(e.$t("goods.saveDraft")),1)]),_:1},8,["loading","disabled"])):k("",!0),i(f,{round:"",class:ce(["flex-1 min-w-[130px] h-[46px] text-base font-semibold",l(D)?"bg-b4 text-b2":"bg-btnOrBg text-b1"]),disabled:l(D),onClick:t[11]||(t[11]=u=>zo()),loading:l(ue)},{default:g(()=>[se(c(l(Do)),1)]),_:1},8,["disabled","class","loading"])])),l(Z)?(_(),O(Rt,{key:2,list:_e.value,level:M.value,id:Se.value,onSelect:Ro,onClose:t[12]||(t[12]=u=>l(ge)(!1))},null,8,["list","level","id"])):k("",!0),l(r)?(_(),O(Ft,{key:3,brand:l(p),includeAllStoreFlag:o.value.includeAllStoreFlag,"select-store":"",onSelectStore:Oo,onSelectAllStore:to,onSelectBrand:Lo,onClose:t[13]||(t[13]=u=>l(d)(!1))},null,8,["brand","includeAllStoreFlag"])):k("",!0),l(Y)?(_(),O(os,{key:4,ids:C.value,brand:l(p),onSelectStore:qo,onChangeBrand:Go,onSelectAllStore:to,onClose:t[14]||(t[14]=u=>l(U)(!1))},null,8,["ids","brand"])):k("",!0),i(yt,{noClose:"",name:e.$t("offline.published_success"),show:l(Ve),onClose:t[16]||(t[16]=u=>l(de)(!1))},{default:g(()=>[s("div",js,c(e.$t("offline.published_success_desc")),1),s("div",Hs,[s("div",{class:"flex-1 h-[46px] leading-[44px] rounded-full text-center border border-solid-b4 mr-3",onClick:jo},c(e.$t("flashSale.check-the-details")),1),s("div",{class:"flex-1 h-[46px] leading-[46px] rounded-full text-center bg-yellow",onClick:t[15]||(t[15]=u=>ao())},c(e.$t("common.back list")),1)])]),_:1},8,["name","show"]),i(pe,{show:l(Pe),noHeader:"",content:"保留此次编辑？",showConfirm:!0,showReject:!0,confirmText:"保留",rejectText:"不保留",onClose:t[17]||(t[17]=u=>l(ee)(!1)),onConfirm:Wo,onReject:Jo},null,8,["show"]),i(pe,{show:l(Co),noHeader:"",content:"你有未编辑完成的商品，是否继续？",showConfirm:!0,showReject:!0,confirmText:"编辑",rejectText:"放弃",onClose:Be,onConfirm:Ue,onReject:Be},null,8,["show"]),i(pe,{show:l(Fo),noHeader:"",content:"检测到你有一个上次编辑未保存的商品，是否离开当前页面前往编辑？",showConfirm:!0,showReject:!0,confirmText:"前往编辑",rejectText:"放弃",contentClass:"!text-left",onClose:Be,onConfirm:tt,onReject:Be},null,8,["show"]),i(pe,{show:l(De),noHeader:"",showConfirm:!0,showReject:!0,confirmText:"取消",rejectText:"离开",contentClass:"!text-left",onClose:t[18]||(t[18]=u=>l(S)(!1)),onConfirm:Xo,onReject:Yo},{default:g(()=>[Ks]),_:1},8,["show"]),i(pe,{show:l(we),noHeader:"",content:"是否保存修改？",showConfirm:!0,showReject:!0,confirmText:"保存",rejectText:"不保存",onClose:t[19]||(t[19]=u=>l(xe)(!1)),onConfirm:Qo,onReject:Zo},null,8,["show"]),i(pe,{show:l(Io),noHeader:"",content:"退出后不会保存本次编辑内容,您可以选择保存草稿,以便后续编辑",showConfirm:!0,showReject:!0,confirmText:"保存草稿并退出",rejectText:"直接退出",contentClass:"!text-left",confirmStyle:{width:"100%",fontSize:"16px",whiteSpace:"nowrap"},rejectStyle:{width:"100%",whiteSpace:"nowrap"},onClose:t[20]||(t[20]=u=>l(ve)(!1)),onConfirm:et,onReject:ot},null,8,["show"])]}),_:1},8,["title"])}}const Ys=Ne({...Ws,setup:Js}),ra=rt(Ys,[["__scopeId","data-v-00cf61c6"]]);export{ra as default};
