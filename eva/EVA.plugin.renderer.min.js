function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}window.EVA=window.EVA||{},window.EVA.plugin=window.EVA.plugin||{};var _EVA_IIFE_renderer=function(e,t,r,n){"use strict";var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},o(e,t)};function _(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var a=function(){return a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)};function i(e,t,r,n){var o,_=arguments.length,a=_<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(_<3?o(a):_>3?o(t,r,a):o(t,r))||a);return _>3&&a&&Object.defineProperty(t,r,a),a}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,_=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=_.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=_.return)&&r.call(_)}finally{if(o)throw o.error}}return a}function E(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function u(e,t){return e===t||e!=e&&t!=t}function S(e,t){for(var r=e.length;r--;)if(u(e[r][0],t))return r;return-1}var l=Array.prototype.splice;function R(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}R.prototype.clear=function(){this.__data__=[],this.size=0},R.prototype.delete=function(e){var t=this.__data__,r=S(t,e);return!(r<0)&&(r==t.length-1?t.pop():l.call(t,r,1),--this.size,!0)},R.prototype.get=function(e){var t=this.__data__,r=S(t,e);return r<0?void 0:t[r][1]},R.prototype.has=function(e){return S(this.__data__,e)>-1},R.prototype.set=function(e,t){var r=this.__data__,n=S(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var p="object"==typeof global&&global&&global.Object===Object&&global,f="object"==typeof self&&self&&self.Object===Object&&self,C=p||f||Function("return this")(),h=C.Symbol,A=Object.prototype,d=A.hasOwnProperty,P=A.toString,v=h?h.toStringTag:void 0;var T=Object.prototype.toString;var y=h?h.toStringTag:void 0;function O(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":y&&y in Object(e)?function(e){var t=d.call(e,v),r=e[v];try{e[v]=void 0;var n=!0}catch(e){}var o=P.call(e);return n&&(t?e[v]=r:delete e[v]),o}(e):function(e){return T.call(e)}(e)}function G(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function m(e){if(!G(e))return!1;var t=O(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var B,D=C["__core-js_shared__"],M=(B=/[^.]+$/.exec(D&&D.keys&&D.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"";var g=Function.prototype.toString;function x(e){if(null!=e){try{return g.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var b=/^\[object .+?Constructor\]$/,H=Function.prototype,L=Object.prototype,w=H.toString,j=L.hasOwnProperty,I=RegExp("^"+w.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function X(e){return!(!G(e)||(t=e,M&&M in t))&&(m(e)?I:b).test(x(e));var t}function K(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return X(r)?r:void 0}var W=K(C,"Map"),U=K(Object,"create");var N=Object.prototype.hasOwnProperty;var V=Object.prototype.hasOwnProperty;function z(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function F(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function k(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}z.prototype.clear=function(){this.__data__=U?U(null):{},this.size=0},z.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},z.prototype.get=function(e){var t=this.__data__;if(U){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return N.call(t,e)?t[e]:void 0},z.prototype.has=function(e){var t=this.__data__;return U?void 0!==t[e]:V.call(t,e)},z.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=U&&void 0===t?"__lodash_hash_undefined__":t,this},k.prototype.clear=function(){this.size=0,this.__data__={hash:new z,map:new(W||R),string:new z}},k.prototype.delete=function(e){var t=F(this,e).delete(e);return this.size-=t?1:0,t},k.prototype.get=function(e){return F(this,e).get(e)},k.prototype.has=function(e){return F(this,e).has(e)},k.prototype.set=function(e,t){var r=F(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Y(e){var t=this.__data__=new R(e);this.size=t.size}Y.prototype.clear=function(){this.__data__=new R,this.size=0},Y.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Y.prototype.get=function(e){return this.__data__.get(e)},Y.prototype.has=function(e){return this.__data__.has(e)},Y.prototype.set=function(e,t){var r=this.__data__;if(r instanceof R){var n=r.__data__;if(!W||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new k(n)}return r.set(e,t),this.size=r.size,this};function $(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new k;++t<r;)this.add(e[t])}function q(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}$.prototype.add=$.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},$.prototype.has=function(e){return this.__data__.has(e)};function J(e,t,r,n,o,_){var a=1&r,i=e.length,s=t.length;if(i!=s&&!(a&&s>i))return!1;var c=_.get(e),E=_.get(t);if(c&&E)return c==t&&E==e;var u=-1,S=!0,l=2&r?new $:void 0;for(_.set(e,t),_.set(t,e);++u<i;){var R=e[u],p=t[u];if(n)var f=a?n(p,R,u,t,e,_):n(R,p,u,e,t,_);if(void 0!==f){if(f)continue;S=!1;break}if(l){if(!q(t,(function(e,t){if(a=t,!l.has(a)&&(R===e||o(R,e,r,n,_)))return l.push(t);var a}))){S=!1;break}}else if(R!==p&&!o(R,p,r,n,_)){S=!1;break}}return _.delete(e),_.delete(t),S}var Q=C.Uint8Array;function Z(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function ee(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var te=h?h.prototype:void 0,re=te?te.valueOf:void 0;var ne=Array.isArray;var oe=Object.prototype.propertyIsEnumerable,_e=Object.getOwnPropertySymbols,ae=_e?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,_=[];++r<n;){var a=e[r];t(a,r,e)&&(_[o++]=a)}return _}(_e(e),(function(t){return oe.call(e,t)})))}:function(){return[]},ie=ae;function se(e){return null!=e&&"object"==typeof e}function ce(e){return se(e)&&"[object Arguments]"==O(e)}var Ee=Object.prototype,ue=Ee.hasOwnProperty,Se=Ee.propertyIsEnumerable,le=ce(function(){return arguments}())?ce:function(e){return se(e)&&ue.call(e,"callee")&&!Se.call(e,"callee")},Re=le;var pe="object"==typeof e&&e&&!e.nodeType&&e,fe=pe&&"object"==typeof module&&module&&!module.nodeType&&module,Ce=fe&&fe.exports===pe?C.Buffer:void 0,he=(Ce?Ce.isBuffer:void 0)||function(){return!1},Ae=/^(?:0|[1-9]\d*)$/;function de(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ae.test(e))&&e>-1&&e%1==0&&e<t}function Pe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var ve={};ve["[object Float32Array]"]=ve["[object Float64Array]"]=ve["[object Int8Array]"]=ve["[object Int16Array]"]=ve["[object Int32Array]"]=ve["[object Uint8Array]"]=ve["[object Uint8ClampedArray]"]=ve["[object Uint16Array]"]=ve["[object Uint32Array]"]=!0,ve["[object Arguments]"]=ve["[object Array]"]=ve["[object ArrayBuffer]"]=ve["[object Boolean]"]=ve["[object DataView]"]=ve["[object Date]"]=ve["[object Error]"]=ve["[object Function]"]=ve["[object Map]"]=ve["[object Number]"]=ve["[object Object]"]=ve["[object RegExp]"]=ve["[object Set]"]=ve["[object String]"]=ve["[object WeakMap]"]=!1;var Te,ye="object"==typeof e&&e&&!e.nodeType&&e,Oe=ye&&"object"==typeof module&&module&&!module.nodeType&&module,Ge=Oe&&Oe.exports===ye&&p.process,me=function(){try{var e=Oe&&Oe.require&&Oe.require("util").types;return e||Ge&&Ge.binding&&Ge.binding("util")}catch(e){}}(),Be=me&&me.isTypedArray,De=Be?(Te=Be,function(e){return Te(e)}):function(e){return se(e)&&Pe(e.length)&&!!ve[O(e)]},Me=Object.prototype.hasOwnProperty;function ge(e,t){var r=ne(e),n=!r&&Re(e),o=!r&&!n&&he(e),_=!r&&!n&&!o&&De(e),a=r||n||o||_,i=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],s=i.length;for(var c in e)!t&&!Me.call(e,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||_&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||de(c,s))||i.push(c);return i}var xe=Object.prototype;var be=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),He=be,Le=Object.prototype.hasOwnProperty;function we(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||xe))return He(e);var t,r,n=[];for(var o in Object(e))Le.call(e,o)&&"constructor"!=o&&n.push(o);return n}function je(e){return null!=(t=e)&&Pe(t.length)&&!m(t)?ge(e):we(e);var t}function Ie(e){return function(e,t,r){var n=t(e);return ne(e)?n:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(n,r(e))}(e,je,ie)}var Xe=Object.prototype.hasOwnProperty;var Ke=K(C,"DataView"),We=K(C,"Promise"),Ue=K(C,"Set"),Ne=K(C,"WeakMap"),Ve="[object Map]",ze="[object Promise]",Fe="[object Set]",ke="[object WeakMap]",Ye="[object DataView]",$e=x(Ke),qe=x(W),Je=x(We),Qe=x(Ue),Ze=x(Ne),et=O;(Ke&&et(new Ke(new ArrayBuffer(1)))!=Ye||W&&et(new W)!=Ve||We&&et(We.resolve())!=ze||Ue&&et(new Ue)!=Fe||Ne&&et(new Ne)!=ke)&&(et=function(e){var t=O(e),r="[object Object]"==t?e.constructor:void 0,n=r?x(r):"";if(n)switch(n){case $e:return Ye;case qe:return Ve;case Je:return ze;case Qe:return Fe;case Ze:return ke}return t});var tt=et,rt="[object Arguments]",nt="[object Array]",ot="[object Object]",_t=Object.prototype.hasOwnProperty;function at(e,t,r,n,o,_){var a=ne(e),i=ne(t),s=a?nt:tt(e),c=i?nt:tt(t),E=(s=s==rt?ot:s)==ot,S=(c=c==rt?ot:c)==ot,l=s==c;if(l&&he(e)){if(!he(t))return!1;a=!0,E=!1}if(l&&!E)return _||(_=new Y),a||De(e)?J(e,t,r,n,o,_):function(e,t,r,n,o,_,a){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!_(new Q(e),new Q(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return u(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var i=Z;case"[object Set]":var s=1&n;if(i||(i=ee),e.size!=t.size&&!s)return!1;var c=a.get(e);if(c)return c==t;n|=2,a.set(e,t);var E=J(i(e),i(t),n,o,_,a);return a.delete(e),E;case"[object Symbol]":if(re)return re.call(e)==re.call(t)}return!1}(e,t,s,r,n,o,_);if(!(1&r)){var R=E&&_t.call(e,"__wrapped__"),p=S&&_t.call(t,"__wrapped__");if(R||p){var f=R?e.value():e,C=p?t.value():t;return _||(_=new Y),o(f,C,r,n,_)}}return!!l&&(_||(_=new Y),function(e,t,r,n,o,_){var a=1&r,i=Ie(e),s=i.length;if(s!=Ie(t).length&&!a)return!1;for(var c=s;c--;){var E=i[c];if(!(a?E in t:Xe.call(t,E)))return!1}var u=_.get(e),S=_.get(t);if(u&&S)return u==t&&S==e;var l=!0;_.set(e,t),_.set(t,e);for(var R=a;++c<s;){var p=e[E=i[c]],f=t[E];if(n)var C=a?n(f,p,E,t,e,_):n(p,f,E,e,t,_);if(!(void 0===C?p===f||o(p,f,r,n,_):C)){l=!1;break}R||(R="constructor"==E)}if(l&&!R){var h=e.constructor,A=t.constructor;h==A||!("constructor"in e)||!("constructor"in t)||"function"==typeof h&&h instanceof h&&"function"==typeof A&&A instanceof A||(l=!1)}return _.delete(e),_.delete(t),l}(e,t,r,n,o,_))}function it(e,t,r,n,o){return e===t||(null==e||null==t||!se(e)&&!se(t)?e!=e&&t!=t:at(e,t,r,n,it,o))}var st=function(){function e(e){var t=e.game,r=e.rendererSystem;this.renderers=[],this.game=t,this.rendererSystem=r}return e.prototype.register=function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{for(var o=s(r),_=o.next();!_.done;_=o.next()){var a=_.value;a.game=this.game,a.rendererManager=this.rendererSystem.rendererManager,a.containerManager=this.rendererSystem.containerManager,this.renderers.push(a)}}catch(t){e={error:t}}finally{try{_&&!_.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.componentChanged=function(e){var r,n,o=function(e){var r,n;try{for(var o=(r=void 0,s(_.renderers)),a=o.next();!a.done;a=o.next()){var i=a.value,c=i.observerInfo[e.componentName];if(c){if([t.OBSERVER_TYPE.ADD,t.OBSERVER_TYPE.REMOVE].indexOf(e.type)>-1){try{i.componentChanged&&i.componentChanged(e)}catch(t){console.error("gameObject: "+e.gameObject.name+", "+e.componentName+" is error.",e,t)}continue}if(c.findIndex((function(t){return r=t,n=e.prop,it(r,n);var r,n}))>-1)try{i.componentChanged&&i.componentChanged(e)}catch(t){console.error("gameObject: "+(e.gameObject&&e.gameObject.name)+", "+e.componentName+" is componentChanged error.",e,t)}}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},_=this;try{for(var a=s(e),i=a.next();!i.done;i=a.next()){o(i.value)}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},e.prototype.update=function(e){var t,r,n,o;try{for(var _=s(e.components),a=_.next();!a.done;a=_.next()){var i=a.value;try{for(var c=(n=void 0,s(this.renderers)),E=c.next();!E.done;E=c.next()){var u=E.value,S=[];if(u.observerInfo[i.name]&&-1===S.indexOf(e)){S.push(e);try{u.rendererUpdate&&u.rendererUpdate(e)}catch(t){console.info("gameObject: "+e.name+", "+i.name+" is update error",t)}}}}catch(e){n={error:e}}finally{try{E&&!E.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}},e}(),ct=st,Et=function(){function e(){this.containerMap={}}return e.prototype.addContainer=function(e){var t=e.name,r=e.container;this.containerMap[t]=r},e.prototype.getContainer=function(e){return this.containerMap[e]},e.prototype.removeContainer=function(e){var t;null===(t=this.containerMap[e])||void 0===t||t.destroy({children:!0}),delete this.containerMap[e]},e.prototype.updateTransform=function(e){var t=e.name,r=e.transform,n=this.containerMap[t];if(n&&r){var o=r.anchor,_=r.origin,a=r.position,i=r.rotation,s=r.scale,c=r.size,E=r.skew;n.rotation=i,n.scale=s,n.pivot.x=c.width*_.x,n.pivot.y=c.height*_.y,n.skew=E;var u=a.x,S=a.y;if(r.parent){var l=r.parent;u+=l.size.width*o.x,S+=l.size.height*o.y}n.position={x:u,y:S}}},e}(),ut=Et;var St=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function _(e,t,n,_,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var i=new o(n,_||e,a),s=r?r+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],i]:e._events[s].push(i):(e._events[s]=i,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function i(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),i.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},i.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,_=n.length,a=new Array(_);o<_;o++)a[o]=n[o].fn;return a},i.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},i.prototype.emit=function(e,t,n,o,_,a){var i=r?r+e:e;if(!this._events[i])return!1;var s,c,E=this._events[i],u=arguments.length;if(E.fn){switch(E.once&&this.removeListener(e,E.fn,void 0,!0),u){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,t),!0;case 3:return E.fn.call(E.context,t,n),!0;case 4:return E.fn.call(E.context,t,n,o),!0;case 5:return E.fn.call(E.context,t,n,o,_),!0;case 6:return E.fn.call(E.context,t,n,o,_,a),!0}for(c=1,s=new Array(u-1);c<u;c++)s[c-1]=arguments[c];E.fn.apply(E.context,s)}else{var S,l=E.length;for(c=0;c<l;c++)switch(E[c].once&&this.removeListener(e,E[c].fn,void 0,!0),u){case 1:E[c].fn.call(E[c].context);break;case 2:E[c].fn.call(E[c].context,t);break;case 3:E[c].fn.call(E[c].context,t,n);break;case 4:E[c].fn.call(E[c].context,t,n,o);break;default:if(!s)for(S=1,s=new Array(u-1);S<u;S++)s[S-1]=arguments[S];E[c].fn.apply(E[c].context,s)}}return!0},i.prototype.on=function(e,t,r){return _(this,e,t,r,!1)},i.prototype.once=function(e,t,r){return _(this,e,t,r,!0)},i.prototype.removeListener=function(e,t,n,o){var _=r?r+e:e;if(!this._events[_])return this;if(!t)return a(this,_),this;var i=this._events[_];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||a(this,_);else{for(var s=0,c=[],E=i.length;s<E;s++)(i[s].fn!==t||o&&!i[s].once||n&&i[s].context!==n)&&c.push(i[s]);c.length?this._events[_]=1===c.length?c[0]:c:a(this,_)}return this},i.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i})),lt=function(e){function n(t){var r=t.system,n=t.containerManager,o=e.call(this)||this;return o.name="Transform",o.waitRemoveIds=[],o.waitChangeScenes=[],o.containerManager=n,o.init(r),o}return _(n,e),n.prototype.init=function(e){var t=this;this.system=e,this.on("changeScene",(function(e){var r=e.scene,n=e.mode,o=e.application;t.waitChangeScenes.push({scene:r,mode:n,application:o})}))},n.prototype.update=function(){var e,t,r,n;try{for(var o=s(this.waitRemoveIds),_=o.next();!_.done;_=o.next()){var a=_.value;this.containerManager.removeContainer(a)}}catch(t){e={error:t}}finally{try{_&&!_.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.waitRemoveIds=[];try{for(var i=s(this.waitChangeScenes),c=i.next();!c.done;c=i.next()){var E=c.value,u=this.containerManager.getContainer(E.scene.id);u&&(E.application.stage.removeChildren(),E.application.stage.addChild(u))}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}this.waitChangeScenes=[]},n.prototype.componentChanged=function(e){e.type===t.OBSERVER_TYPE.ADD?this.addContainer(e):e.type===t.OBSERVER_TYPE.CHANGE?this.change(e):e.type===t.OBSERVER_TYPE.REMOVE&&this.waitRemoveIds.push(e.gameObject.id)},n.prototype.addContainer=function(e){var t=new r.Container;t.name=e.gameObject.name,this.containerManager.addContainer({name:e.gameObject.id,container:t}),e.component.worldTransform=t.transform.worldTransform},n.prototype.change=function(e){var t=e.component;if(t.parent){this.containerManager.getContainer(t.parent.gameObject.id).addChild(this.containerManager.getContainer(e.gameObject.id));var r=e.gameObject.transform.parent&&e.gameObject.transform.parent.gameObject.getComponent("Render");r&&(r.sortDirty=!0)}else{var n=this.containerManager.getContainer(e.gameObject.id);delete t.worldTransform,n.parent&&n.parent.removeChild(n)}},n.prototype.destroy=function(){this.removeAllListeners(),this.waitRemoveIds=null,this.waitChangeScenes=null,this.system=null,this.containerManager=null},n=i([t.decorators.componentObserver({Transform:["_parent"]})],n)}(St),Rt=lt,pt=void 0;function ft(e){if(pt)return pt;if(!e)return console.warn("WebGL not available for compressed textures. Silently failing."),{s3tc:!1,etc:!1,etc1:!1,pvrtc:!1,atc:!1,astc:!1};pt={s3tc:!!e.getExtension("WEBGL_compressed_texture_s3tc"),etc:!!e.getExtension("WEBGL_compressed_texture_etc"),etc1:!!e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:!!e.getExtension("WEBGL_compressed_texture_pvrtc")||!!e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:!!e.getExtension("WEBGL_compressed_texture_atc"),astc:!!e.getExtension("WEBGL_compressed_texture_astc")};try{console.log("Eva.js Supported Compressed Texture Format List: "+Object.keys(pt).filter((function(e){return pt[e]})).join(", "))}catch(e){}return pt}var Ct,ht,At,dt=t.resourceLoader.XhrLoadStrategy;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=3781]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR"}(At||(At={}));var Pt=((Ct={})[At.COMPRESSED_RGB_S3TC_DXT1_EXT]=[4,4],Ct[At.COMPRESSED_RGBA_S3TC_DXT1_EXT]=[4,4],Ct[At.COMPRESSED_RGBA_S3TC_DXT3_EXT]=[4,4],Ct[At.COMPRESSED_RGBA_S3TC_DXT5_EXT]=[4,4],Ct[At.COMPRESSED_SRGB_S3TC_DXT1_EXT]=[4,4],Ct[At.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=[4,4],Ct[At.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=[4,4],Ct[At.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=[4,4],Ct[At.COMPRESSED_R11_EAC]=[4,4],Ct[At.COMPRESSED_SIGNED_R11_EAC]=[4,4],Ct[At.COMPRESSED_RG11_EAC]=[4,4],Ct[At.COMPRESSED_SIGNED_RG11_EAC]=[4,4],Ct[At.COMPRESSED_RGB8_ETC2]=[4,4],Ct[At.COMPRESSED_RGBA8_ETC2_EAC]=[4,4],Ct[At.COMPRESSED_SRGB8_ETC2]=[4,4],Ct[At.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=[4,4],Ct[At.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=[4,4],Ct[At.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=[4,4],Ct[At.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=[4,4],Ct[At.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=[4,4],Ct[At.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=[8,4],Ct[At.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=[8,4],Ct[At.COMPRESSED_RGB_ETC1_WEBGL]=[4,4],Ct[At.COMPRESSED_RGB_ATC_WEBGL]=[4,4],Ct[At.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=[4,4],Ct[At.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=[4,4],Ct[At.COMPRESSED_RGBA_ASTC_4x4_KHR]=[4,4],Ct[At.COMPRESSED_RGBA_ASTC_5x5_KHR]=[5,5],Ct[At.COMPRESSED_RGBA_ASTC_6x6_KHR]=[6,6],Ct[At.COMPRESSED_RGBA_ASTC_8x8_KHR]=[8,8],Ct[At.COMPRESSED_RGBA_ASTC_10x10_KHR]=[10,10],Ct[At.COMPRESSED_RGBA_ASTC_12x12_KHR]=[12,12],Ct[At.COMPRESSED_RGBA_ASTC_10x5_KHR]=[10,5],Ct[At.COMPRESSED_RGBA_ASTC_10x6_KHR]=[10,6],Ct[At.COMPRESSED_RGBA_ASTC_10x8_KHR]=[10,8],Ct[At.COMPRESSED_RGBA_ASTC_12x10_KHR]=[12,10],Ct[At.COMPRESSED_RGBA_ASTC_5x4_KHR]=[5,4],Ct[At.COMPRESSED_RGBA_ASTC_6x5_KHR]=[6,5],Ct[At.COMPRESSED_RGBA_ASTC_8x5_KHR]=[8,5],Ct[At.COMPRESSED_RGBA_ASTC_8x6_KHR]=[8,6],Ct),vt=((ht={})[At.COMPRESSED_RGB_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc",ht[At.COMPRESSED_RGBA_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc",ht[At.COMPRESSED_RGBA_S3TC_DXT3_EXT]="WEBGL_compressed_texture_s3tc",ht[At.COMPRESSED_RGBA_S3TC_DXT5_EXT]="WEBGL_compressed_texture_s3tc",ht[At.COMPRESSED_SRGB_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc_srgb",ht[At.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc_srgb",ht[At.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]="WEBGL_compressed_texture_s3tc_srgb",ht[At.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]="WEBGL_compressed_texture_s3tc_srgb",ht[At.COMPRESSED_R11_EAC]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_SIGNED_R11_EAC]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_RG11_EAC]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_SIGNED_RG11_EAC]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_RGB8_ETC2]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_RGBA8_ETC2_EAC]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_SRGB8_ETC2]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]="WEBGL_compressed_texture_etc",ht[At.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]="WEBGL_compressed_texture_pvrtc",ht[At.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]="WEBGL_compressed_texture_pvrtc",ht[At.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]="WEBGL_compressed_texture_pvrtc",ht[At.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]="WEBGL_compressed_texture_pvrtc",ht[At.COMPRESSED_RGB_ETC1_WEBGL]="WEBGL_compressed_texture_etc1",ht[At.COMPRESSED_RGB_ATC_WEBGL]="WEBGL_compressed_texture_atc",ht[At.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]="WEBGL_compressed_texture_atc",ht[At.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]="WEBGL_compressed_texture_atc",ht[At.COMPRESSED_RGBA_ASTC_4x4_KHR]="WEBGL_compressed_texture_astc",ht[At.COMPRESSED_RGBA_ASTC_5x5_KHR]="WEBGL_compressed_texture_astc",ht[At.COMPRESSED_RGBA_ASTC_6x6_KHR]="WEBGL_compressed_texture_astc",ht[At.COMPRESSED_RGBA_ASTC_8x8_KHR]="WEBGL_compressed_texture_astc",ht[At.COMPRESSED_RGBA_ASTC_10x10_KHR]="WEBGL_compressed_texture_astc",ht[At.COMPRESSED_RGBA_ASTC_12x12_KHR]="WEBGL_compressed_texture_astc",ht),Tt=function(){function e(){this.levelBuffers=[]}return e.prototype.upload=function(e){var t=this.levels,r=vt[this.internalFormat];e[r]||(e[r]=!0,"WEBGL_compressed_texture_pvrtc"===r?e.getExtension(r)||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"):e.getExtension(r));for(var n=0;n<this.levels;++n){var o=this.levelBuffers[n],_=o.levelWidth,a=o.levelHeight,i=o.levelBuffer;e.compressedTexImage2D(e.TEXTURE_2D,n,this.internalFormat,_,a,0,i)}t>1?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR))},e}(),yt=12,Ot=28,Gt=36,mt=40,Bt=44,Dt=48,Mt=52,gt=56,xt=60,bt=[171,75,84,88,32,49,49,187,13,10,26,10],Ht=function(e){function r(r,n){var o,_=e.call(this)||this;_.complete=!0,_.src=n.url;var a=new DataView(r);if(!function(e){for(var t=0;t<bt.length;t++)if(e.getUint8(t)!==bt[t])return!1;return!0}(a))throw new Error("Not a valid KTX Texture");var i=67305985===a.getUint32(yt,!0);_.internalFormat=a.getUint32(Ot,i);var s=_.formerWidth=a.getUint32(Gt,i),c=_.formerHeight=a.getUint32(mt,i)||1,E=Pt[_.internalFormat];_.width=s%E[0]==0?s:s+E[0]-s%E[0],_.height=c%E[1]==0?c:c+E[1]-c%E[1];var u=t.resource.resourcesMap[n.metadata.name].src[n.metadata.key],S=null!==(o=null==u?void 0:u.size)&&void 0!==o?o:{},l=S.width,R=S.height;l&&R&&(_.naturalWidth=l,_.naturalHeight=R);var p=a.getUint32(Bt,i)||1,f=a.getUint32(Dt,i)||1,C=a.getUint32(Mt,i),h=_.levels=a.getUint32(gt,i),A=a.getUint32(xt,i);if(0===c||1!==p)throw new Error("Only 2D textures are supported!");if(1!==C)throw new Error("CubeTextures are not supported!");if(1!==f)throw new Error("It does not support array textures!");for(var d=s,P=c,v=64+A,T=0;T<h;T++){var y=a.getUint32(v,i);v+=4;var O=Pt[_.internalFormat],G={levelID:T,levelWidth:d%O[0]==0?d:d+O[0]-d%O[0],levelHeight:P%O[1]==0?P:P+O[1]-P%O[1],levelBuffer:new Uint8Array(r,v,y)};_.levelBuffers.push(G),v+=y,v+=3-(v+3)%4,d=d>>1||1,P=P>>1||1}return _}return _(r,e),r}(Tt);var Lt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _(t,e),t.prototype._complete=function(t,r){e.prototype._complete.call(this,t,new Ht(r,this.config))},t}(dt),wt=Lt,jt=t.resourceLoader.XhrResponseType;var It,Xt={isCompressed:!1,uploadNotCompressed:n.glCore.GLTexture.prototype.upload,upload:function(e){if(!(e instanceof Tt))return this.uploadNotCompressed(e);this.bind();var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),this.isCompressed=!0,e.upload(t)},enableMipmap:function(){if(!this.isCompressed){var e=this.gl;this.bind(),this.mipmap=!0,e.generateMipmap(e.TEXTURE_2D)}}},Kt={oldFrom:n.Texture.from,from:function(e){return e instanceof Tt?new n.Texture(n.BaseTexture.from(e)):this.oldFrom(e)}},Wt={oldFrom:n.BaseTexture.from,from:function(e,t,r){if(!(e instanceof Tt))return this.oldFrom(e,t,r);var o=e.src,_=n.utils.BaseTextureCache[o];return _||((_=new n.BaseTexture(e,t)).imageUrl=o,r&&(_.sourceScale=r),n.BaseTexture.addToCache(_,o)),_}};function Ut(e){!function(e,t){e.addPreProcessResourceHandler((function(e){var r,n,o,_=null===(n=null===(r=e.src)||void 0===r?void 0:r.image)||void 0===n?void 0:n.texture;if(_){Array.isArray(_)||(_=[_]);var a=null!==(o=ft(t))&&void 0!==o?o:{},i=_.find((function(e){return a[e.type]}));i&&_extends(e.src.image,i)}}))}(t.resource,e),_extends(t.RESOURCE_TYPE_STRATEGY,{astc:wt,etc:wt,pvrtc:wt,s3tc:wt,atc:wt}),wt.setExtensionXhrType("ktx",jt.Buffer),_extends(n.glCore.GLTexture.prototype,Xt),_extends(n.Texture,Kt),_extends(n.BaseTexture,Wt)}e.RENDERER_TYPE=void 0,(It=e.RENDERER_TYPE||(e.RENDERER_TYPE={}))[It.UNKNOWN=0]="UNKNOWN",It[It.WEBGL=1]="WEBGL",It[It.CANVAS=2]="CANVAS";var Nt=function(e){e.plugins.interaction.autoPreventDefault=!0,e.view.style.touchAction="none"},Vt=function(e){e.plugins.interaction.autoPreventDefault=!1,e.view.style.touchAction="auto"},zt=function(o){function c(){var e=null!==o&&o.apply(this,arguments)||this;return e.multiApps=[],e}return _(c,o),c.prototype.init=function(e){var r=this;this.params=e,this.application=this.createApplication(e),this.containerManager=new ut,this.rendererManager=new ct({game:this.game,rendererSystem:this}),this.game.canvas=this.application.view,this.transform=new Rt({system:this,containerManager:this.containerManager}),this.game.on("sceneChanged",(function(e){var n,o=e.scene,_=e.mode,a=e.params;switch(_){case t.LOAD_SCENE_MODE.SINGLE:n=r.application;break;case t.LOAD_SCENE_MODE.MULTI_CANVAS:n=r.createMultiApplication({params:a})}o.canvas=n.view,r.transform.emit("changeScene",{scene:o,mode:_,application:n})}));var n=this.application.renderer.gl;n&&(this.suportedCompressedTextureFormats=ft(n),Ut(n))},c.prototype.registerObserver=function(e){var t,r=this.constructor.observerInfo;for(var n in e)r[n]||(r[n]=[]),(t=r[n]).push.apply(t,E(e[n]))},c.prototype.createMultiApplication=function(e){var t=e.params,r=this.createApplication(t);return this.multiApps.push(r),r},c.prototype.createApplication=function(t){var o;t.view=t.canvas,t.renderType===e.RENDERER_TYPE.CANVAS&&(t.forceCanvas=!0);try{o=new r.Application(a({sharedTicker:!0},t))}catch(e){void 0!==e.message.match(/not support webgl/i)&&(o=new r.Application(a(a({sharedTicker:!0},t),{forceCanvas:!0})))}return n.ticker.shared.stop(),n.ticker.shared.autoStart=!1,void 0!==t.preventScroll&&(console.warn("PreventScroll property will deprecate at next major version, please use enableScroll instead. https://eva.js.org/#/tutorials/game"),t.preventScroll?Vt(o.renderer):Nt(o.renderer)),void 0!==t.enableScroll&&(t.enableScroll?Vt(o.renderer):Nt(o.renderer)),void 0===t.preventScroll&&void 0===t.enableScroll&&Vt(o.renderer),o},c.prototype.update=function(){var e,t,r,n,o=this.componentObserver.clear();try{for(var _=s(o),a=_.next();!a.done;a=_.next()){var i=a.value;this.transform.componentChanged(i)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=_.return)&&t.call(_)}finally{if(e)throw e.error}}try{for(var c=s(this.game.gameObjects),E=c.next();!E.done;E=c.next()){var u=E.value;this.containerManager.updateTransform({name:u.id,transform:u.transform}),this.rendererManager.update(u)}}catch(e){r={error:e}}finally{try{E&&!E.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}},c.prototype.lateUpdate=function(e){this.transform.update(),this.application.ticker.update(e.time)},c.prototype.onDestroy=function(){var e,t;this.application.destroy();try{for(var r=s(this.multiApps),n=r.next();!n.done;n=r.next()){var o=n.value;o&&o.destroy()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.transform.destroy(),this.transform=null,this.params=null,this.rendererManager=null,this.containerManager=null,this.application=null,this.game=null,this.multiApps=null},c.prototype.resize=function(e,t){this.params.width=e,this.params.height=t,this.application.renderer.resize(e,t)},c.systemName="Renderer",c=i([t.decorators.componentObserver({Transform:["_parent"]})],c)}(t.System),Ft=zt,kt=function(e){function t(t){var r=e.call(this,t)||this;return r.asyncIdMap={},r.observerInfo=r.constructor.observerInfo,r}return _(t,e),t.prototype.componentChanged=function(e){},t.prototype.rendererUpdate=function(e){},t.prototype.update=function(e){var t,r,n=this.componentObserver.clear();try{for(var o=s(n),_=o.next();!_.done;_=o.next()){var a=_.value;this.componentChanged(a)}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.increaseAsyncId=function(e){return this.asyncIdMap[e]=(this.asyncIdMap[e]||0)+1,this.asyncIdMap[e]},t.prototype.validateAsyncId=function(e,t){return this.asyncIdMap[e]===t},t}(t.System),Yt=kt;return n.BaseTexture.prototype.destroy=function(){this.imageUrl&&(delete n.utils.TextureCache[this.imageUrl],this.imageUrl=null),this.source=null,this.dispose(),n.BaseTexture.removeFromCache(this),this.textureCacheIds=null,this._destroyed=!0},e.ContainerManager=ut,e.Renderer=Yt,e.RendererManager=ct,e.RendererSystem=Ft,Object.defineProperty(e,"__esModule",{value:!0}),e}({},EVA,EVA.rendererAdapter,PIXI);window.EVA.plugin.renderer=window.EVA.plugin.renderer||_EVA_IIFE_renderer;
